parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({64:[function(require,module,exports) {
Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function r(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(a,e){return Array.isArray(e)?a.push.apply(a,r.call(e,t-1)):a.push(e),a},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(r){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});
},{}],74:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");const e=Object(t);for(let t=1;t<arguments.length;t++){const n=arguments[t];if(null!=n)for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e});const t="118",e={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},n={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},i=0,r=1,o=2,s=3,a=0,c=1,l=0,h=1,u=2,p=3,d=0,f=1,m=2,g=1,v=2,y=0,x=1,b=2,_=3,w=4,M=5,S=100,T=101,E=102,A=103,L=104,R=200,P=201,C=202,O=203,D=204,I=205,N=206,B=207,z=208,U=209,F=210,G=0,H=1,k=2,V=3,j=4,W=5,q=6,X=7,Y=0,Z=1,J=2,Q=0,K=1,$=2,tt=3,et=4,nt=5,it=300,rt=301,ot=302,st=303,at=304,ct=306,lt=307,ht=1e3,ut=1001,pt=1002,dt=1003,ft=1004,mt=1004,gt=1005,vt=1005,yt=1006,xt=1007,bt=1007,_t=1008,wt=1008,Mt=1009,St=1010,Tt=1011,Et=1012,At=1013,Lt=1014,Rt=1015,Pt=1016,Ct=1017,Ot=1018,Dt=1019,It=1020,Nt=1021,Bt=1022,zt=1023,Ut=1024,Ft=1025,Gt=zt,Ht=1026,kt=1027,Vt=1028,jt=1029,Wt=1030,qt=1031,Xt=1032,Yt=1033,Zt=33776,Jt=33777,Qt=33778,Kt=33779,$t=35840,te=35841,ee=35842,ne=35843,ie=36196,re=37492,oe=37496,se=37808,ae=37809,ce=37810,le=37811,he=37812,ue=37813,pe=37814,de=37815,fe=37816,me=37817,ge=37818,ve=37819,ye=37820,xe=37821,be=36492,_e=37840,we=37841,Me=37842,Se=37843,Te=37844,Ee=37845,Ae=37846,Le=37847,Re=37848,Pe=37849,Ce=37850,Oe=37851,De=37852,Ie=37853,Ne=2200,Be=2201,ze=2202,Ue=2300,Fe=2301,Ge=2302,He=2400,ke=2401,Ve=2402,je=2500,We=2501,qe=0,Xe=1,Ye=2,Ze=3e3,Je=3001,Qe=3007,Ke=3002,$e=3003,tn=3004,en=3005,nn=3006,rn=3200,on=3201,sn=0,an=1,cn=0,ln=7680,hn=7681,un=7682,pn=7683,dn=34055,fn=34056,mn=5386,gn=512,vn=513,yn=514,xn=515,bn=516,_n=517,wn=518,Mn=519,Sn=35044,Tn=35048,En=35040,An=35045,Ln=35049,Rn=35041,Pn=35046,Cn=35050,On=35042;function Dn(){}Object.assign(Dn.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}},dispatchEvent:function(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,i=n.length;e<i;e++)n[e].call(this,t)}}});const In=[];for(let t=0;t<256;t++)In[t]=(t<16?"0":"")+t.toString(16);const Nn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(In[255&t]+In[t>>8&255]+In[t>>16&255]+In[t>>24&255]+"-"+In[255&e]+In[e>>8&255]+"-"+In[e>>16&15|64]+In[e>>24&255]+"-"+In[63&n|128]+In[n>>8&255]+"-"+In[n>>16&255]+In[n>>24&255]+In[255&i]+In[i>>8&255]+In[i>>16&255]+In[i>>24&255]).toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*Nn.DEG2RAD},radToDeg:function(t){return t*Nn.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,i,r){const o=Math.cos,s=Math.sin,a=o(n/2),c=s(n/2),l=o((e+i)/2),h=s((e+i)/2),u=o((e-i)/2),p=s((e-i)/2),d=o((i-e)/2),f=s((i-e)/2);switch(r){case"XYX":t.set(a*h,c*u,c*p,a*l);break;case"YZY":t.set(c*p,a*h,c*u,a*l);break;case"ZXZ":t.set(c*u,c*p,a*h,a*l);break;case"XZX":t.set(a*h,c*f,c*d,a*l);break;case"YXY":t.set(c*d,a*h,c*f,a*l);break;case"ZYZ":t.set(c*f,c*d,a*h,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}};function Bn(t=0,e=0){this.x=t,this.y=e}function zn(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}let Un;Object.defineProperties(Bn.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(Bn.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*n-o*i+t.x,this.y=r*i+o*n+t.y,this},random:function(){return this.x=Math.random(),this.y=Math.random(),this}}),Object.assign(zn.prototype,{isMatrix3:!0,set:function(t,e,n,i,r,o,s,a,c){const l=this.elements;return l[0]=t,l[1]=i,l[2]=s,l[3]=e,l[4]=r,l[5]=a,l[6]=n,l[7]=o,l[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},extractBasis:function(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){const n=t.elements,i=e.elements,r=this.elements,o=n[0],s=n[3],a=n[6],c=n[1],l=n[4],h=n[7],u=n[2],p=n[5],d=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],x=i[7],b=i[2],_=i[5],w=i[8];return r[0]=o*f+s*v+a*b,r[3]=o*m+s*y+a*_,r[6]=o*g+s*x+a*w,r[1]=c*f+l*v+h*b,r[4]=c*m+l*y+h*_,r[7]=c*g+l*x+h*w,r[2]=u*f+p*v+d*b,r[5]=u*m+p*y+d*_,r[8]=u*g+p*x+d*w,this},multiplyScalar:function(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],s=t[5],a=t[6],c=t[7],l=t[8];return e*o*l-e*s*c-n*r*l+n*s*a+i*r*c-i*o*a},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");const n=t.elements,i=this.elements,r=n[0],o=n[1],s=n[2],a=n[3],c=n[4],l=n[5],h=n[6],u=n[7],p=n[8],d=p*c-l*u,f=l*h-p*a,m=u*a-c*h,g=r*d+o*f+s*m;if(0===g)return this.set(0,0,0,0,0,0,0,0,0);const v=1/g;return i[0]=d*v,i[1]=(s*u-p*o)*v,i[2]=(l*o-s*c)*v,i[3]=f*v,i[4]=(p*r-s*h)*v,i[5]=(s*a-l*r)*v,i[6]=m*v,i[7]=(o*h-u*r)*v,i[8]=(c*r-o*a)*v,this},transpose:function(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,n,i,r,o,s){const a=Math.cos(r),c=Math.sin(r);this.set(n*a,n*c,-n*(a*o+c*s)+o+t,-i*c,i*a,-i*(-c*o+a*s)+s+e,0,0,1)},scale:function(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},rotate:function(t){const e=Math.cos(t),n=Math.sin(t),i=this.elements,r=i[0],o=i[3],s=i[6],a=i[1],c=i[4],l=i[7];return i[0]=e*r+n*a,i[3]=e*o+n*c,i[6]=e*s+n*l,i[1]=-n*r+e*a,i[4]=-n*o+e*c,i[7]=-n*s+e*l,this},translate:function(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},equals:function(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}});const Fn={getDataURL:function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Un&&(Un=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Un.width=t.width,Un.height=t.height;const n=Un.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Un}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}};let Gn=0;function Hn(t,e,n,i,r,o,s,a,c,l){Object.defineProperty(this,"id",{value:Gn++}),this.uuid=Nn.generateUUID(),this.name="",this.image=void 0!==t?t:Hn.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:Hn.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:ut,this.wrapT=void 0!==i?i:ut,this.magFilter=void 0!==r?r:yt,this.minFilter=void 0!==o?o:_t,this.anisotropy=void 0!==c?c:1,this.format=void 0!==s?s:zt,this.internalFormat=null,this.type=void 0!==a?a:Mt,this.offset=new Bn(0,0),this.repeat=new Bn(1,1),this.center=new Bn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new zn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==l?l:Ze,this.version=0,this.onUpdate=null}function kn(t=0,e=0,n=0,i=1){this.x=t,this.y=e,this.z=n,this.w=i}function Vn(t,e,n){this.width=t,this.height=e,this.scissor=new kn(0,0,t,e),this.scissorTest=!1,this.viewport=new kn(0,0,t,e),n=n||{},this.texture=new Hn(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:yt,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function jn(t,e,n){Vn.call(this,t,e,n),this.samples=4}function Wn(t=0,e=0,n=0,i=1){this._x=t,this._y=e,this._z=n,this._w=i}Hn.DEFAULT_IMAGE=void 0,Hn.DEFAULT_MAPPING=300,Hn.prototype=Object.assign(Object.create(Dn.prototype),{constructor:Hn,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=Nn.generateUUID()),!e&&void 0===t.images[i.uuid]){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)e.push(Fn.getDataURL(i[t]))}else e=Fn.getDataURL(i);t.images[i.uuid]={uuid:i.uuid,url:e}}n.image=i.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case ht:t.x=t.x-Math.floor(t.x);break;case ut:t.x=t.x<0?0:1;break;case pt:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case ht:t.y=t.y-Math.floor(t.y);break;case ut:t.y=t.y<0?0:1;break;case pt:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Hn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.defineProperties(kn.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(kn.prototype,{isVector4:!0,set:function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){const e=this.x,n=this.y,i=this.z,r=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*e+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*e+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*e+o[7]*n+o[11]*i+o[15]*r,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){let e,n,i,r;const o=t.elements,s=o[0],a=o[4],c=o[8],l=o[1],h=o[5],u=o[9],p=o[2],d=o[6],f=o[10];if(Math.abs(a-l)<.01&&Math.abs(c-p)<.01&&Math.abs(u-d)<.01){if(Math.abs(a+l)<.1&&Math.abs(c+p)<.1&&Math.abs(u+d)<.1&&Math.abs(s+h+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const t=(s+1)/2,o=(h+1)/2,m=(f+1)/2,g=(a+l)/4,v=(c+p)/4,y=(u+d)/4;return t>o&&t>m?t<.01?(n=0,i=.707106781,r=.707106781):(i=g/(n=Math.sqrt(t)),r=v/n):o>m?o<.01?(n=.707106781,i=0,r=.707106781):(n=g/(i=Math.sqrt(o)),r=y/i):m<.01?(n=.707106781,i=.707106781,r=0):(n=v/(r=Math.sqrt(m)),i=y/r),this.set(n,i,r,e),this}let m=Math.sqrt((d-u)*(d-u)+(c-p)*(c-p)+(l-a)*(l-a));return Math.abs(m)<.001&&(m=1),this.x=(d-u)/m,this.y=(c-p)/m,this.z=(l-a)/m,this.w=Math.acos((s+h+f-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},clampLength:function(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}),Vn.prototype=Object.assign(Object.create(Dn.prototype),{constructor:Vn,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),jn.prototype=Object.assign(Object.create(Vn.prototype),{constructor:jn,isWebGLMultisampleRenderTarget:!0,copy:function(t){return Vn.prototype.copy.call(this,t),this.samples=t.samples,this}}),Object.assign(Wn,{slerp:function(t,e,n,i){return n.copy(t).slerp(e,i)},slerpFlat:function(t,e,n,i,r,o,s){let a=n[i+0],c=n[i+1],l=n[i+2],h=n[i+3];const u=r[o+0],p=r[o+1],d=r[o+2],f=r[o+3];if(h!==f||a!==u||c!==p||l!==d){let t=1-s,e=a*u+c*p+l*d+h*f,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,e*n);t=Math.sin(t*o)/r,s=Math.sin(s*o)/r}const r=s*n;if(a=a*t+u*r,c=c*t+p*r,l=l*t+d*r,h=h*t+f*r,t===1-s){const t=1/Math.sqrt(a*a+c*c+l*l+h*h);a*=t,c*=t,l*=t,h*=t}}t[e]=a,t[e+1]=c,t[e+2]=l,t[e+3]=h},multiplyQuaternionsFlat:function(t,e,n,i,r,o){const s=n[i],a=n[i+1],c=n[i+2],l=n[i+3],h=r[o],u=r[o+1],p=r[o+2],d=r[o+3];return t[e]=s*d+l*h+a*p-c*u,t[e+1]=a*d+l*u+c*h-s*p,t[e+2]=c*d+l*p+s*u-a*h,t[e+3]=l*d-s*h-a*u-c*p,t}}),Object.defineProperties(Wn.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(Wn.prototype,{isQuaternion:!0,set:function(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,i=t._y,r=t._z,o=t.order,s=Math.cos,a=Math.sin,c=s(n/2),l=s(i/2),h=s(r/2),u=a(n/2),p=a(i/2),d=a(r/2);switch(o){case"XYZ":this._x=u*l*h+c*p*d,this._y=c*p*h-u*l*d,this._z=c*l*d+u*p*h,this._w=c*l*h-u*p*d;break;case"YXZ":this._x=u*l*h+c*p*d,this._y=c*p*h-u*l*d,this._z=c*l*d-u*p*h,this._w=c*l*h+u*p*d;break;case"ZXY":this._x=u*l*h-c*p*d,this._y=c*p*h+u*l*d,this._z=c*l*d+u*p*h,this._w=c*l*h-u*p*d;break;case"ZYX":this._x=u*l*h-c*p*d,this._y=c*p*h+u*l*d,this._z=c*l*d-u*p*h,this._w=c*l*h+u*p*d;break;case"YZX":this._x=u*l*h+c*p*d,this._y=c*p*h+u*l*d,this._z=c*l*d-u*p*h,this._w=c*l*h-u*p*d;break;case"XZY":this._x=u*l*h-c*p*d,this._y=c*p*h-u*l*d,this._z=c*l*d+u*p*h,this._w=c*l*h+u*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(t){const e=t.elements,n=e[0],i=e[4],r=e[8],o=e[1],s=e[5],a=e[9],c=e[2],l=e[6],h=e[10],u=n+s+h;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(l-a)*t,this._y=(r-c)*t,this._z=(o-i)*t}else if(n>s&&n>h){const t=2*Math.sqrt(1+n-s-h);this._w=(l-a)/t,this._x=.25*t,this._y=(i+o)/t,this._z=(r+c)/t}else if(s>h){const t=2*Math.sqrt(1+s-n-h);this._w=(r-c)/t,this._x=(i+o)/t,this._y=.25*t,this._z=(a+l)/t}else{const t=2*Math.sqrt(1+h-n-s);this._w=(o-i)/t,this._x=(r+c)/t,this._y=(a+l)/t,this._z=.25*t}return this._onChangeCallback(),this},setFromUnitVectors:function(t,e){let n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(Nn.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){const n=t._x,i=t._y,r=t._z,o=t._w,s=e._x,a=e._y,c=e._z,l=e._w;return this._x=n*l+o*s+i*c-r*a,this._y=i*l+o*a+r*s-n*c,this._z=r*l+o*c+n*a-i*s,this._w=o*l-n*s-i*a-r*c,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,o=this._w;let s=o*t._w+n*t._x+i*t._y+r*t._z;if(s<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,s=-s):this.copy(t),s>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const a=1-s*s;if(a<=Number.EPSILON){const t=1-e;return this._w=t*o+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(a),l=Math.atan2(c,s),h=Math.sin((1-e)*l)/c,u=Math.sin(e*l)/c;return this._w=o*h+this._w*u,this._x=n*h+this._x*u,this._y=i*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},fromBufferAttribute:function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});const qn=new Yn,Xn=new Wn;function Yn(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}Object.assign(Yn.prototype,{isVector3:!0,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Xn.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(Xn.setFromAxisAngle(t,e))},applyMatrix3:function(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){const e=this.x,n=this.y,i=this.z,r=t.elements,o=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*o,this},applyQuaternion:function(t){const e=this.x,n=this.y,i=this.z,r=t.x,o=t.y,s=t.z,a=t.w,c=a*e+o*i-s*n,l=a*n+s*e-r*i,h=a*i+r*n-o*e,u=-r*e-o*n-s*i;return this.x=c*a+u*-r+l*-s-h*-o,this.y=l*a+u*-o+h*-r-c*-s,this.z=h*a+u*-s+c*-o-l*-r,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){const n=t.x,i=t.y,r=t.z,o=e.x,s=e.y,a=e.z;return this.x=i*a-r*s,this.y=r*o-n*a,this.z=n*s-i*o,this},projectOnVector:function(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)},projectOnPlane:function(t){return qn.copy(this).projectOnVector(t),this.sub(qn)},reflect:function(t){return this.sub(qn.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Nn.clamp(n,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},setFromMatrix3Column:function(t,e){return this.fromArray(t.elements,3*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}});const Zn=new Yn,Jn=new ni,Qn=new Yn(0,0,0),Kn=new Yn(1,1,1),$n=new Yn,ti=new Yn,ei=new Yn;function ni(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(ni.prototype,{isMatrix4:!0,set:function(t,e,n,i,r,o,s,a,c,l,h,u,p,d,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=c,g[6]=l,g[10]=h,g[14]=u,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new ni).fromArray(this.elements)},copy:function(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},copyPosition:function(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},extractBasis:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},extractRotation:function(t){const e=this.elements,n=t.elements,i=1/Zn.setFromMatrixColumn(t,0).length(),r=1/Zn.setFromMatrixColumn(t,1).length(),o=1/Zn.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,i=t.y,r=t.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(i),c=Math.sin(i),l=Math.cos(r),h=Math.sin(r);if("XYZ"===t.order){const t=o*l,n=o*h,i=s*l,r=s*h;e[0]=a*l,e[4]=-a*h,e[8]=c,e[1]=n+i*c,e[5]=t-r*c,e[9]=-s*a,e[2]=r-t*c,e[6]=i+n*c,e[10]=o*a}else if("YXZ"===t.order){const t=a*l,n=a*h,i=c*l,r=c*h;e[0]=t+r*s,e[4]=i*s-n,e[8]=o*c,e[1]=o*h,e[5]=o*l,e[9]=-s,e[2]=n*s-i,e[6]=r+t*s,e[10]=o*a}else if("ZXY"===t.order){const t=a*l,n=a*h,i=c*l,r=c*h;e[0]=t-r*s,e[4]=-o*h,e[8]=i+n*s,e[1]=n+i*s,e[5]=o*l,e[9]=r-t*s,e[2]=-o*c,e[6]=s,e[10]=o*a}else if("ZYX"===t.order){const t=o*l,n=o*h,i=s*l,r=s*h;e[0]=a*l,e[4]=i*c-n,e[8]=t*c+r,e[1]=a*h,e[5]=r*c+t,e[9]=n*c-i,e[2]=-c,e[6]=s*a,e[10]=o*a}else if("YZX"===t.order){const t=o*a,n=o*c,i=s*a,r=s*c;e[0]=a*l,e[4]=r-t*h,e[8]=i*h+n,e[1]=h,e[5]=o*l,e[9]=-s*l,e[2]=-c*l,e[6]=n*h+i,e[10]=t-r*h}else if("XZY"===t.order){const t=o*a,n=o*c,i=s*a,r=s*c;e[0]=a*l,e[4]=-h,e[8]=c*l,e[1]=t*h+r,e[5]=o*l,e[9]=n*h-i,e[2]=i*h-n,e[6]=s*l,e[10]=r*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(Qn,t,Kn)},lookAt:function(t,e,n){const i=this.elements;return ei.subVectors(t,e),0===ei.lengthSq()&&(ei.z=1),ei.normalize(),$n.crossVectors(n,ei),0===$n.lengthSq()&&(1===Math.abs(n.z)?ei.x+=1e-4:ei.z+=1e-4,ei.normalize(),$n.crossVectors(n,ei)),$n.normalize(),ti.crossVectors(ei,$n),i[0]=$n.x,i[4]=ti.x,i[8]=ei.x,i[1]=$n.y,i[5]=ti.y,i[9]=ei.y,i[2]=$n.z,i[6]=ti.z,i[10]=ei.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){const n=t.elements,i=e.elements,r=this.elements,o=n[0],s=n[4],a=n[8],c=n[12],l=n[1],h=n[5],u=n[9],p=n[13],d=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],b=n[15],_=i[0],w=i[4],M=i[8],S=i[12],T=i[1],E=i[5],A=i[9],L=i[13],R=i[2],P=i[6],C=i[10],O=i[14],D=i[3],I=i[7],N=i[11],B=i[15];return r[0]=o*_+s*T+a*R+c*D,r[4]=o*w+s*E+a*P+c*I,r[8]=o*M+s*A+a*C+c*N,r[12]=o*S+s*L+a*O+c*B,r[1]=l*_+h*T+u*R+p*D,r[5]=l*w+h*E+u*P+p*I,r[9]=l*M+h*A+u*C+p*N,r[13]=l*S+h*L+u*O+p*B,r[2]=d*_+f*T+m*R+g*D,r[6]=d*w+f*E+m*P+g*I,r[10]=d*M+f*A+m*C+g*N,r[14]=d*S+f*L+m*O+g*B,r[3]=v*_+y*T+x*R+b*D,r[7]=v*w+y*E+x*P+b*I,r[11]=v*M+y*A+x*C+b*N,r[15]=v*S+y*L+x*O+b*B,this},multiplyScalar:function(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},determinant:function(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],o=t[1],s=t[5],a=t[9],c=t[13],l=t[2],h=t[6],u=t[10],p=t[14];return t[3]*(+r*a*h-i*c*h-r*s*u+n*c*u+i*s*p-n*a*p)+t[7]*(+e*a*p-e*c*u+r*o*u-i*o*p+i*c*l-r*a*l)+t[11]*(+e*c*h-e*s*p-r*o*h+n*o*p+r*s*l-n*c*l)+t[15]*(-i*s*l-e*a*h+e*s*u+i*o*h-n*o*u+n*a*l)},transpose:function(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");const n=this.elements,i=t.elements,r=i[0],o=i[1],s=i[2],a=i[3],c=i[4],l=i[5],h=i[6],u=i[7],p=i[8],d=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],x=i[15],b=d*y*u-v*f*u+v*h*m-l*y*m-d*h*x+l*f*x,_=g*f*u-p*y*u-g*h*m+c*y*m+p*h*x-c*f*x,w=p*v*u-g*d*u+g*l*m-c*v*m-p*l*x+c*d*x,M=g*d*h-p*v*h-g*l*f+c*v*f+p*l*y-c*d*y,S=r*b+o*_+s*w+a*M;if(0===S)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/S;return n[0]=b*T,n[1]=(v*f*a-d*y*a-v*s*m+o*y*m+d*s*x-o*f*x)*T,n[2]=(l*y*a-v*h*a+v*s*u-o*y*u-l*s*x+o*h*x)*T,n[3]=(d*h*a-l*f*a-d*s*u+o*f*u+l*s*m-o*h*m)*T,n[4]=_*T,n[5]=(p*y*a-g*f*a+g*s*m-r*y*m-p*s*x+r*f*x)*T,n[6]=(g*h*a-c*y*a-g*s*u+r*y*u+c*s*x-r*h*x)*T,n[7]=(c*f*a-p*h*a+p*s*u-r*f*u-c*s*m+r*h*m)*T,n[8]=w*T,n[9]=(g*d*a-p*v*a-g*o*m+r*v*m+p*o*x-r*d*x)*T,n[10]=(c*v*a-g*l*a+g*o*u-r*v*u-c*o*x+r*l*x)*T,n[11]=(p*l*a-c*d*a-p*o*u+r*d*u+c*o*m-r*l*m)*T,n[12]=M*T,n[13]=(p*v*s-g*d*s+g*o*f-r*v*f-p*o*y+r*d*y)*T,n[14]=(g*l*s-c*v*s-g*o*h+r*v*h+c*o*y-r*l*y)*T,n[15]=(c*d*s-p*l*s+p*o*h-r*d*h-c*o*f+r*l*f)*T,this},scale:function(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this},getMaxScaleOnAxis:function(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},makeRotationY:function(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},makeRotationZ:function(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,o=t.x,s=t.y,a=t.z,c=r*o,l=r*s;return this.set(c*o+n,c*s-i*a,c*a+i*s,0,c*s+i*a,l*s+n,l*a-i*o,0,c*a-i*s,l*a+i*o,r*a*a+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,n){const i=this.elements,r=e._x,o=e._y,s=e._z,a=e._w,c=r+r,l=o+o,h=s+s,u=r*c,p=r*l,d=r*h,f=o*l,m=o*h,g=s*h,v=a*c,y=a*l,x=a*h,b=n.x,_=n.y,w=n.z;return i[0]=(1-(f+g))*b,i[1]=(p+x)*b,i[2]=(d-y)*b,i[3]=0,i[4]=(p-x)*_,i[5]=(1-(u+g))*_,i[6]=(m+v)*_,i[7]=0,i[8]=(d+y)*w,i[9]=(m-v)*w,i[10]=(1-(u+f))*w,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this},decompose:function(t,e,n){const i=this.elements;let r=Zn.set(i[0],i[1],i[2]).length(),o=Zn.set(i[4],i[5],i[6]).length(),s=Zn.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],Jn.copy(this);const a=1/r,c=1/o,l=1/s;return Jn.elements[0]*=a,Jn.elements[1]*=a,Jn.elements[2]*=a,Jn.elements[4]*=c,Jn.elements[5]*=c,Jn.elements[6]*=c,Jn.elements[8]*=l,Jn.elements[9]*=l,Jn.elements[10]*=l,e.setFromRotationMatrix(Jn),n.x=r,n.y=o,n.z=s,this},makePerspective:function(t,e,n,i,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,a=2*r/(e-t),c=2*r/(n-i),l=(e+t)/(e-t),h=(n+i)/(n-i),u=-(o+r)/(o-r),p=-2*o*r/(o-r);return s[0]=a,s[4]=0,s[8]=l,s[12]=0,s[1]=0,s[5]=c,s[9]=h,s[13]=0,s[2]=0,s[6]=0,s[10]=u,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(t,e,n,i,r,o){const s=this.elements,a=1/(e-t),c=1/(n-i),l=1/(o-r),h=(e+t)*a,u=(n+i)*c,p=(o+r)*l;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-h,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-u,s[2]=0,s[6]=0,s[10]=-2*l,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}});const ii=new ni,ri=new Wn;function oi(t=0,e=0,n=0,i=oi.DefaultOrder){this._x=t,this._y=e,this._z=n,this._order=i}function si(){this.mask=1}oi.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],oi.DefaultOrder="XYZ",Object.defineProperties(oi.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(oi.prototype,{isEuler:!0,set:function(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._order=i||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,n){const i=Nn.clamp,r=t.elements,o=r[0],s=r[4],a=r[8],c=r[1],l=r[5],h=r[9],u=r[2],p=r[6],d=r[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(i(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(p,l),this._z=0);break;case"YXZ":this._x=Math.asin(-i(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-u,o),this._z=0);break;case"ZXY":this._x=Math.asin(i(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-i(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(p,d),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(i(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-i(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(p,l),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,n){return ii.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ii,e,n)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return ri.setFromEuler(this),this.setFromQuaternion(ri,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new Yn(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(si.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}});let ai=0;const ci=new Yn,li=new Wn,hi=new ni,ui=new Yn,pi=new Yn,di=new Yn,fi=new Wn,mi=new Yn(1,0,0),gi=new Yn(0,1,0),vi=new Yn(0,0,1),yi={type:"added"},xi={type:"removed"};function bi(){Object.defineProperty(this,"id",{value:ai++}),this.uuid=Nn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=bi.DefaultUp.clone();const t=new Yn,e=new oi,n=new Wn,i=new Yn(1,1,1);e._onChange(function(){n.setFromEuler(e,!1)}),n._onChange(function(){e.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new ni},normalMatrix:{value:new zn}}),this.matrix=new ni,this.matrixWorld=new ni,this.matrixAutoUpdate=bi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new si,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function _i(){bi.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}bi.DefaultUp=new Yn(0,1,0),bi.DefaultMatrixAutoUpdate=!0,bi.prototype=Object.assign(Object.create(Dn.prototype),{constructor:bi,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return li.setFromAxisAngle(t,e),this.quaternion.multiply(li),this},rotateOnWorldAxis:function(t,e){return li.setFromAxisAngle(t,e),this.quaternion.premultiply(li),this},rotateX:function(t){return this.rotateOnAxis(mi,t)},rotateY:function(t){return this.rotateOnAxis(gi,t)},rotateZ:function(t){return this.rotateOnAxis(vi,t)},translateOnAxis:function(t,e){return ci.copy(t).applyQuaternion(this.quaternion),this.position.add(ci.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(mi,t)},translateY:function(t){return this.translateOnAxis(gi,t)},translateZ:function(t){return this.translateOnAxis(vi,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(hi.getInverse(this.matrixWorld))},lookAt:function(t,e,n){t.isVector3?ui.copy(t):ui.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),pi.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?hi.lookAt(pi,ui,this.up):hi.lookAt(ui,pi,this.up),this.quaternion.setFromRotationMatrix(hi),i&&(hi.extractRotation(i.matrixWorld),li.setFromRotationMatrix(hi),this.quaternion.premultiply(li.inverse()))},add:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(yi)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(xi)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),hi.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),hi.multiply(t.parent.matrixWorld)),t.applyMatrix4(hi),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Yn),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Wn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(pi,t,di),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Yn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(pi,fi,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Yn),this.updateMatrixWorld(!0);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)},traverseAncestors:function(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}},toJSON:function(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];r(t.shapes,i)}else r(t.shapes,n)}}if(void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(r(t.materials,this.material[n]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(e){const e=o(t.geometries),i=o(t.materials),r=o(t.textures),s=o(t.images),a=o(t.shapes);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a)}return n.object=i,n;function o(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}),_i.prototype=Object.assign(Object.create(bi.prototype),{constructor:_i,isScene:!0,copy:function(t,e){return bi.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){const e=bi.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e},dispose:function(){this.dispatchEvent({type:"dispose"})}});const wi=[new Yn,new Yn,new Yn,new Yn,new Yn,new Yn,new Yn,new Yn],Mi=new Yn,Si=new Ni,Ti=new Yn,Ei=new Yn,Ai=new Yn,Li=new Yn,Ri=new Yn,Pi=new Yn,Ci=new Yn,Oi=new Yn,Di=new Yn,Ii=new Yn;function Ni(t,e){this.min=void 0!==t?t:new Yn(1/0,1/0,1/0),this.max=void 0!==e?e:new Yn(-1/0,-1/0,-1/0)}function Bi(t,e,n,i,r){for(let o=0,s=t.length-3;o<=s;o+=3){Ii.fromArray(t,o);const s=r.x*Math.abs(Ii.x)+r.y*Math.abs(Ii.y)+r.z*Math.abs(Ii.z),a=e.dot(Ii),c=n.dot(Ii),l=i.dot(Ii);if(Math.max(-Math.max(a,c,l),Math.min(a,c,l))>s)return!1}return!0}Object.assign(Ni.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){let e=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,s=-1/0;for(let a=0,c=t.length;a<c;a+=3){const c=t[a],l=t[a+1],h=t[a+2];c<e&&(e=c),l<n&&(n=l),h<i&&(i=h),c>r&&(r=c),l>o&&(o=l),h>s&&(s=h)}return this.min.set(e,n,i),this.max.set(r,o,s),this},setFromBufferAttribute:function(t){let e=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,s=-1/0;for(let a=0,c=t.count;a<c;a++){const c=t.getX(a),l=t.getY(a),h=t.getZ(a);c<e&&(e=c),l<n&&(n=l),h<i&&(i=h),c>r&&(r=c),l>o&&(o=l),h>s&&(s=h)}return this.min.set(e,n,i),this.max.set(r,o,s),this},setFromPoints:function(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){const n=Mi.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Yn),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Yn),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),Si.copy(e.boundingBox),Si.applyMatrix4(t.matrixWorld),this.union(Si));const n=t.children;for(let t=0,e=n.length;t<e;t++)this.expandByObject(n[t]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Yn),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,Mi),Mi.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant},intersectsTriangle:function(t){if(this.isEmpty())return!1;this.getCenter(Ci),Oi.subVectors(this.max,Ci),Ti.subVectors(t.a,Ci),Ei.subVectors(t.b,Ci),Ai.subVectors(t.c,Ci),Li.subVectors(Ei,Ti),Ri.subVectors(Ai,Ei),Pi.subVectors(Ti,Ai);let e=[0,-Li.z,Li.y,0,-Ri.z,Ri.y,0,-Pi.z,Pi.y,Li.z,0,-Li.x,Ri.z,0,-Ri.x,Pi.z,0,-Pi.x,-Li.y,Li.x,0,-Ri.y,Ri.x,0,-Pi.y,Pi.x,0];return!!Bi(e,Ti,Ei,Ai,Oi)&&(!!Bi(e=[1,0,0,0,1,0,0,0,1],Ti,Ei,Ai,Oi)&&(Di.crossVectors(Li,Ri),Bi(e=[Di.x,Di.y,Di.z],Ti,Ei,Ai,Oi)))},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Yn),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return Mi.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(Mi).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()?this:(wi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),wi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),wi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),wi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),wi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),wi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),wi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),wi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(wi),this)},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});const zi=new Ni;function Ui(t,e){this.center=void 0!==t?t:new Yn,this.radius=void 0!==e?e:-1}Object.assign(Ui.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(t,e){const n=this.center;void 0!==e?n.copy(e):zi.setFromPoints(t).getCenter(n);let i=0;for(let e=0,r=t.length;e<r;e++)i=Math.max(i,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},isEmpty:function(){return this.radius<0},makeEmpty:function(){return this.center.set(0,0,0),this.radius=-1,this},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){const n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Yn),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Ni),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});const Fi=new Yn,Gi=new Yn,Hi=new Yn,ki=new Yn,Vi=new Yn,ji=new Yn,Wi=new Yn;function qi(t,e){this.origin=void 0!==t?t:new Yn,this.direction=void 0!==e?e:new Yn(0,0,-1)}Object.assign(qi.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Yn),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,Fi)),this},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Yn),e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){const e=Fi.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Fi.copy(this.direction).multiplyScalar(e).add(this.origin),Fi.distanceToSquared(t))},distanceSqToSegment:function(t,e,n,i){Gi.copy(t).add(e).multiplyScalar(.5),Hi.copy(e).sub(t).normalize(),ki.copy(this.origin).sub(Gi);const r=.5*t.distanceTo(e),o=-this.direction.dot(Hi),s=ki.dot(this.direction),a=-ki.dot(Hi),c=ki.lengthSq(),l=Math.abs(1-o*o);let h,u,p,d;if(l>0)if(u=o*s-a,d=r*l,(h=o*a-s)>=0)if(u>=-d)if(u<=d){const t=1/l;p=(h*=t)*(h+o*(u*=t)+2*s)+u*(o*h+u+2*a)+c}else u=r,p=-(h=Math.max(0,-(o*u+s)))*h+u*(u+2*a)+c;else u=-r,p=-(h=Math.max(0,-(o*u+s)))*h+u*(u+2*a)+c;else u<=-d?p=-(h=Math.max(0,-(-o*r+s)))*h+(u=h>0?-r:Math.min(Math.max(-r,-a),r))*(u+2*a)+c:u<=d?(h=0,p=(u=Math.min(Math.max(-r,-a),r))*(u+2*a)+c):p=-(h=Math.max(0,-(o*r+s)))*h+(u=h>0?r:Math.min(Math.max(-r,-a),r))*(u+2*a)+c;else u=o>0?-r:r,p=-(h=Math.max(0,-(o*u+s)))*h+u*(u+2*a)+c;return n&&n.copy(this.direction).multiplyScalar(h).add(this.origin),i&&i.copy(Hi).multiplyScalar(u).add(Gi),p},intersectSphere:function(t,e){Fi.subVectors(t.center,this.origin);const n=Fi.dot(this.direction),i=Fi.dot(Fi)-n*n,r=t.radius*t.radius;if(i>r)return null;const o=Math.sqrt(r-i),s=n-o,a=n+o;return s<0&&a<0?null:s<0?this.at(a,e):this.at(s,e)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null},intersectPlane:function(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)},intersectsPlane:function(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){let n,i,r,o,s,a;const c=1/this.direction.x,l=1/this.direction.y,h=1/this.direction.z,u=this.origin;return c>=0?(n=(t.min.x-u.x)*c,i=(t.max.x-u.x)*c):(n=(t.max.x-u.x)*c,i=(t.min.x-u.x)*c),l>=0?(r=(t.min.y-u.y)*l,o=(t.max.y-u.y)*l):(r=(t.max.y-u.y)*l,o=(t.min.y-u.y)*l),n>o||r>i?null:((r>n||n!=n)&&(n=r),(o<i||i!=i)&&(i=o),h>=0?(s=(t.min.z-u.z)*h,a=(t.max.z-u.z)*h):(s=(t.max.z-u.z)*h,a=(t.min.z-u.z)*h),n>a||s>i?null:((s>n||n!=n)&&(n=s),(a<i||i!=i)&&(i=a),i<0?null:this.at(n>=0?n:i,e)))},intersectsBox:function(t){return null!==this.intersectBox(t,Fi)},intersectTriangle:function(t,e,n,i,r){Vi.subVectors(e,t),ji.subVectors(n,t),Wi.crossVectors(Vi,ji);let o,s=this.direction.dot(Wi);if(s>0){if(i)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}ki.subVectors(this.origin,t);const a=o*this.direction.dot(ji.crossVectors(ki,ji));if(a<0)return null;const c=o*this.direction.dot(Vi.cross(ki));if(c<0)return null;if(a+c>s)return null;const l=-o*ki.dot(Wi);return l<0?null:this.at(l/s,r)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});const Xi=new Yn,Yi=new Yn,Zi=new zn;function Ji(t,e){this.normal=void 0!==t?t:new Yn(1,0,0),this.constant=void 0!==e?e:0}Object.assign(Ji.prototype,{isPlane:!0,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,n){const i=Xi.subVectors(n,e).cross(Yi.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Yn),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new Yn);const n=t.delta(Xi),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):void 0;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?void 0:e.copy(n).multiplyScalar(r).add(t.start)},intersectsLine:function(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Yn),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,e){const n=e||Zi.getNormalMatrix(t),i=this.coplanarPoint(Xi).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});const Qi=new Yn,Ki=new Yn,$i=new Yn,tr=new Yn,er=new Yn,nr=new Yn,ir=new Yn,rr=new Yn,or=new Yn,sr=new Yn;function ar(t,e,n){this.a=void 0!==t?t:new Yn,this.b=void 0!==e?e:new Yn,this.c=void 0!==n?n:new Yn}Object.assign(ar,{getNormal:function(t,e,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Yn),i.subVectors(n,e),Qi.subVectors(t,e),i.cross(Qi);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)},getBarycoord:function(t,e,n,i,r){Qi.subVectors(i,e),Ki.subVectors(n,e),$i.subVectors(t,e);const o=Qi.dot(Qi),s=Qi.dot(Ki),a=Qi.dot($i),c=Ki.dot(Ki),l=Ki.dot($i),h=o*c-s*s;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new Yn),0===h)return r.set(-2,-1,-1);const u=1/h,p=(c*a-s*l)*u,d=(o*l-s*a)*u;return r.set(1-p-d,d,p)},containsPoint:function(t,e,n,i){return ar.getBarycoord(t,e,n,i,tr),tr.x>=0&&tr.y>=0&&tr.x+tr.y<=1},getUV:function(t,e,n,i,r,o,s,a){return this.getBarycoord(t,e,n,i,tr),a.set(0,0),a.addScaledVector(r,tr.x),a.addScaledVector(o,tr.y),a.addScaledVector(s,tr.z),a},isFrontFacing:function(t,e,n,i){return Qi.subVectors(n,e),Ki.subVectors(t,e),Qi.cross(Ki).dot(i)<0}}),Object.assign(ar.prototype,{set:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},setFromPointsAndIndices:function(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return Qi.subVectors(this.c,this.b),Ki.subVectors(this.a,this.b),.5*Qi.cross(Ki).length()},getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Yn),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return ar.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Ji),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return ar.getBarycoord(t,this.a,this.b,this.c,e)},getUV:function(t,e,n,i,r){return ar.getUV(t,this.a,this.b,this.c,e,n,i,r)},containsPoint:function(t){return ar.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return ar.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Yn);const n=this.a,i=this.b,r=this.c;let o,s;er.subVectors(i,n),nr.subVectors(r,n),rr.subVectors(t,n);const a=er.dot(rr),c=nr.dot(rr);if(a<=0&&c<=0)return e.copy(n);or.subVectors(t,i);const l=er.dot(or),h=nr.dot(or);if(l>=0&&h<=l)return e.copy(i);const u=a*h-l*c;if(u<=0&&a>=0&&l<=0)return o=a/(a-l),e.copy(n).addScaledVector(er,o);sr.subVectors(t,r);const p=er.dot(sr),d=nr.dot(sr);if(d>=0&&p<=d)return e.copy(r);const f=p*c-a*d;if(f<=0&&c>=0&&d<=0)return s=c/(c-d),e.copy(n).addScaledVector(nr,s);const m=l*d-p*h;if(m<=0&&h-l>=0&&p-d>=0)return ir.subVectors(r,i),s=(h-l)/(h-l+(p-d)),e.copy(i).addScaledVector(ir,s);const g=1/(m+f+u);return o=f*g,s=u*g,e.copy(n).addScaledVector(er,o).addScaledVector(nr,s)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});const cr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},lr={h:0,s:0,l:0},hr={h:0,s:0,l:0};function ur(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}function pr(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function dr(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function fr(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}function mr(t,e,n,i,r,o){this.a=t,this.b=e,this.c=n,this.normal=i&&i.isVector3?i:new Yn,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new ur,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==o?o:0}Object.assign(ur.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,n){return this.r=t,this.g=e,this.b=n,this},setHSL:function(t,e,n){if(t=Nn.euclideanModulo(t,1),e=Nn.clamp(e,0,1),n=Nn.clamp(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=pr(r,i,t+1/3),this.g=pr(r,i,t),this.b=pr(r,i,t-1/3)}return this},setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){let t;const i=n[1],r=n[2];switch(i){case"rgb":case"rgba":if(t=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[5]),this;if(t=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[5]),this;break;case"hsl":case"hsla":if(t=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r)){const n=parseFloat(t[1])/360,i=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100;return e(t[5]),this.setHSL(n,i,r)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(t)){const t=n[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this},setColorName:function(t){const e=cr[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);const n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=dr(t.r),this.g=dr(t.g),this.b=dr(t.b),this},copyLinearToSRGB:function(t){return this.r=fr(t.r),this.g=fr(t.g),this.b=fr(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const e=this.r,n=this.g,i=this.b,r=Math.max(e,n,i),o=Math.min(e,n,i);let s,a;const c=(o+r)/2;if(o===r)s=0,a=0;else{const t=r-o;switch(a=c<=.5?t/(r+o):t/(2-r-o),r){case e:s=(n-i)/t+(n<i?6:0);break;case n:s=(i-e)/t+2;break;case i:s=(e-n)/t+4}s/=6}return t.h=s,t.s=a,t.l=c,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,n){return this.getHSL(lr),lr.h+=t,lr.s+=e,lr.l+=n,this.setHSL(lr.h,lr.s,lr.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:function(t,e){this.getHSL(lr),t.getHSL(hr);const n=Nn.lerp(lr.h,hr.h,e),i=Nn.lerp(lr.s,hr.s,e),r=Nn.lerp(lr.l,hr.l,e);return this.setHSL(n,i,r),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},fromBufferAttribute:function(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this},toJSON:function(){return this.getHex()}}),ur.NAMES=cr,Object.assign(mr.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(let e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});let gr=0;function vr(){Object.defineProperty(this,"id",{value:gr++}),this.uuid=Nn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=x,this.side=d,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=D,this.blendDst=I,this.blendEquation=S,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=V,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Mn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ln,this.stencilZFail=ln,this.stencilZPass=ln,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function yr(t){vr.call(this),this.type="MeshBasicMaterial",this.color=new ur(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}vr.prototype=Object.assign(Object.create(Dn.prototype),{constructor:vr,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}},toJSON:function(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==x&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==d&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=i(t.textures),r=i(t.images);e.length>0&&(n.textures=e),r.length>0&&(n.images=r)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(vr.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),yr.prototype=Object.create(vr.prototype),yr.prototype.constructor=yr,yr.prototype.isMeshBasicMaterial=!0,yr.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};const xr=new Yn,br=new Bn;function _r(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=Sn,this.updateRange={offset:0,count:-1},this.version=0}function wr(t,e,n){_r.call(this,new Int8Array(t),e,n)}function Mr(t,e,n){_r.call(this,new Uint8Array(t),e,n)}function Sr(t,e,n){_r.call(this,new Uint8ClampedArray(t),e,n)}function Tr(t,e,n){_r.call(this,new Int16Array(t),e,n)}function Er(t,e,n){_r.call(this,new Uint16Array(t),e,n)}function Ar(t,e,n){_r.call(this,new Int32Array(t),e,n)}function Lr(t,e,n){_r.call(this,new Uint32Array(t),e,n)}function Rr(t,e,n){_r.call(this,new Float32Array(t),e,n)}function Pr(t,e,n){_r.call(this,new Float64Array(t),e,n)}function Cr(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Or(t){if(0===t.length)return-1/0;let e=t[0];for(let n=1,i=t.length;n<i;++n)t[n]>e&&(e=t[n]);return e}Object.defineProperty(_r.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(_r.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new ur),e[n++]=r.r,e[n++]=r.g,e[n++]=r.b}return this},copyVector2sArray:function(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new Bn),e[n++]=r.x,e[n++]=r.y}return this},copyVector3sArray:function(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new Yn),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z}return this},copyVector4sArray:function(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new kn),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z,e[n++]=r.w}return this},applyMatrix3:function(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)br.fromBufferAttribute(this,e),br.applyMatrix3(t),this.setXY(e,br.x,br.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)xr.fromBufferAttribute(this,e),xr.applyMatrix3(t),this.setXYZ(e,xr.x,xr.y,xr.z);return this},applyMatrix4:function(t){for(let e=0,n=this.count;e<n;e++)xr.x=this.getX(e),xr.y=this.getY(e),xr.z=this.getZ(e),xr.applyMatrix4(t),this.setXYZ(e,xr.x,xr.y,xr.z);return this},applyNormalMatrix:function(t){for(let e=0,n=this.count;e<n;e++)xr.x=this.getX(e),xr.y=this.getY(e),xr.z=this.getZ(e),xr.applyNormalMatrix(t),this.setXYZ(e,xr.x,xr.y,xr.z);return this},transformDirection:function(t){for(let e=0,n=this.count;e<n;e++)xr.x=this.getX(e),xr.y=this.getY(e),xr.z=this.getZ(e),xr.transformDirection(t),this.setXYZ(e,xr.x,xr.y,xr.z);return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this},setXYZW:function(t,e,n,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),wr.prototype=Object.create(_r.prototype),wr.prototype.constructor=wr,Mr.prototype=Object.create(_r.prototype),Mr.prototype.constructor=Mr,Sr.prototype=Object.create(_r.prototype),Sr.prototype.constructor=Sr,Tr.prototype=Object.create(_r.prototype),Tr.prototype.constructor=Tr,Er.prototype=Object.create(_r.prototype),Er.prototype.constructor=Er,Ar.prototype=Object.create(_r.prototype),Ar.prototype.constructor=Ar,Lr.prototype=Object.create(_r.prototype),Lr.prototype.constructor=Lr,Rr.prototype=Object.create(_r.prototype),Rr.prototype.constructor=Rr,Pr.prototype=Object.create(_r.prototype),Pr.prototype.constructor=Pr,Object.assign(Cr.prototype,{computeGroups:function(t){const e=[];let n,i,r=void 0;const o=t.faces;for(i=0;i<o.length;i++){const t=o[i];t.materialIndex!==r&&(r=t.materialIndex,void 0!==n&&(n.count=3*i-n.start,e.push(n)),n={start:3*i,materialIndex:r})}void 0!==n&&(n.count=3*i-n.start,e.push(n)),this.groups=e},fromGeometry:function(t){const e=t.faces,n=t.vertices,i=t.faceVertexUvs,r=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=t.morphTargets,a=s.length;let c;if(a>0){c=[];for(let t=0;t<a;t++)c[t]={name:s[t].name,data:[]};this.morphTargets.position=c}const l=t.morphNormals,h=l.length;let u;if(h>0){u=[];for(let t=0;t<h;t++)u[t]={name:l[t].name,data:[]};this.morphTargets.normal=u}const p=t.skinIndices,d=t.skinWeights,f=p.length===n.length,m=d.length===n.length;n.length>0&&0===e.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let t=0;t<e.length;t++){const g=e[t];this.vertices.push(n[g.a],n[g.b],n[g.c]);const v=g.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{const t=g.normal;this.normals.push(t,t,t)}const y=g.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{const t=g.color;this.colors.push(t,t,t)}if(!0===r){const e=i[0][t];void 0!==e?this.uvs.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",t),this.uvs.push(new Bn,new Bn,new Bn))}if(!0===o){const e=i[1][t];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",t),this.uvs2.push(new Bn,new Bn,new Bn))}for(let t=0;t<a;t++){const e=s[t].vertices;c[t].data.push(e[g.a],e[g.b],e[g.c])}for(let e=0;e<h;e++){const n=l[e].vertexNormals[t];u[e].data.push(n.a,n.b,n.c)}f&&this.skinIndices.push(p[g.a],p[g.b],p[g.c]),m&&this.skinWeights.push(d[g.a],d[g.b],d[g.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});let Dr=1;const Ir=new ni,Nr=new bi,Br=new Yn,zr=new Ni,Ur=new Ni,Fr=new Yn;function Gr(){Object.defineProperty(this,"id",{value:Dr+=2}),this.uuid=Nn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Gr.prototype=Object.assign(Object.create(Dn.prototype),{constructor:Gr,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(Or(t)>65535?Lr:Er)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,n){this.groups.push({start:t,count:e,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new zn).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return Ir.makeRotationX(t),this.applyMatrix4(Ir),this},rotateY:function(t){return Ir.makeRotationY(t),this.applyMatrix4(Ir),this},rotateZ:function(t){return Ir.makeRotationZ(t),this.applyMatrix4(Ir),this},translate:function(t,e,n){return Ir.makeTranslation(t,e,n),this.applyMatrix4(Ir),this},scale:function(t,e,n){return Ir.makeScale(t,e,n),this.applyMatrix4(Ir),this},lookAt:function(t){return Nr.lookAt(t),Nr.updateMatrix(),this.applyMatrix4(Nr.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Br).negate(),this.translate(Br.x,Br.y,Br.z),this},setFromObject:function(t){const e=t.geometry;if(t.isPoints||t.isLine){const t=new Rr(3*e.vertices.length,3),n=new Rr(3*e.colors.length,3);if(this.setAttribute("position",t.copyVector3sArray(e.vertices)),this.setAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){const t=new Rr(e.lineDistances.length,1);this.setAttribute("lineDistance",t.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Rr(e,3)),this},updateFromObject:function(t){let e=t.geometry;if(t.isMesh){let t=e.__directGeometry;if(!0===e.elementsNeedUpdate&&(t=void 0,e.elementsNeedUpdate=!1),void 0===t)return this.fromGeometry(e);t.verticesNeedUpdate=e.verticesNeedUpdate,t.normalsNeedUpdate=e.normalsNeedUpdate,t.colorsNeedUpdate=e.colorsNeedUpdate,t.uvsNeedUpdate=e.uvsNeedUpdate,t.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=t}if(!0===e.verticesNeedUpdate){const t=this.attributes.position;void 0!==t&&(t.copyVector3sArray(e.vertices),t.needsUpdate=!0),e.verticesNeedUpdate=!1}if(!0===e.normalsNeedUpdate){const t=this.attributes.normal;void 0!==t&&(t.copyVector3sArray(e.normals),t.needsUpdate=!0),e.normalsNeedUpdate=!1}if(!0===e.colorsNeedUpdate){const t=this.attributes.color;void 0!==t&&(t.copyColorsArray(e.colors),t.needsUpdate=!0),e.colorsNeedUpdate=!1}if(e.uvsNeedUpdate){const t=this.attributes.uv;void 0!==t&&(t.copyVector2sArray(e.uvs),t.needsUpdate=!0),e.uvsNeedUpdate=!1}if(e.lineDistancesNeedUpdate){const t=this.attributes.lineDistance;void 0!==t&&(t.copyArray(e.lineDistances),t.needsUpdate=!0),e.lineDistancesNeedUpdate=!1}return e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new Cr).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){const e=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new _r(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){const e=new Float32Array(3*t.normals.length);this.setAttribute("normal",new _r(e,3).copyVector3sArray(t.normals))}if(t.colors.length>0){const e=new Float32Array(3*t.colors.length);this.setAttribute("color",new _r(e,3).copyColorsArray(t.colors))}if(t.uvs.length>0){const e=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new _r(e,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){const e=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new _r(e,2).copyVector2sArray(t.uvs2))}this.groups=t.groups;for(const e in t.morphTargets){const n=[],i=t.morphTargets[e];for(let t=0,e=i.length;t<e;t++){const e=i[t],r=new Rr(3*e.data.length,3);r.name=e.name,n.push(r.copyVector3sArray(e.data))}this.morphAttributes[e]=n}if(t.skinIndices.length>0){const e=new Rr(4*t.skinIndices.length,4);this.setAttribute("skinIndex",e.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){const e=new Rr(4*t.skinWeights.length,4);this.setAttribute("skinWeight",e.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ni);const t=this.attributes.position,e=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];zr.setFromBufferAttribute(n),this.morphTargetsRelative?(Fr.addVectors(this.boundingBox.min,zr.min),this.boundingBox.expandByPoint(Fr),Fr.addVectors(this.boundingBox.max,zr.max),this.boundingBox.expandByPoint(Fr)):(this.boundingBox.expandByPoint(zr.min),this.boundingBox.expandByPoint(zr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ui);const t=this.attributes.position,e=this.morphAttributes.position;if(t){const n=this.boundingSphere.center;if(zr.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Ur.setFromBufferAttribute(n),this.morphTargetsRelative?(Fr.addVectors(zr.min,Ur.min),zr.expandByPoint(Fr),Fr.addVectors(zr.max,Ur.max),zr.expandByPoint(Fr)):(zr.expandByPoint(Ur.min),zr.expandByPoint(Ur.max))}zr.getCenter(n);let i=0;for(let e=0,r=t.count;e<r;e++)Fr.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(Fr));if(e)for(let r=0,o=e.length;r<o;r++){const o=e[r],s=this.morphTargetsRelative;for(let e=0,r=o.count;e<r;e++)Fr.fromBufferAttribute(o,e),s&&(Br.fromBufferAttribute(t,e),Fr.add(Br)),i=Math.max(i,n.distanceToSquared(Fr))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new _r(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new Yn,r=new Yn,o=new Yn,s=new Yn,a=new Yn,c=new Yn,l=new Yn,h=new Yn;if(t)for(let u=0,p=t.count;u<p;u+=3){const p=t.getX(u+0),d=t.getX(u+1),f=t.getX(u+2);i.fromBufferAttribute(e,p),r.fromBufferAttribute(e,d),o.fromBufferAttribute(e,f),l.subVectors(o,r),h.subVectors(i,r),l.cross(h),s.fromBufferAttribute(n,p),a.fromBufferAttribute(n,d),c.fromBufferAttribute(n,f),s.add(l),a.add(l),c.add(l),n.setXYZ(p,s.x,s.y,s.z),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(f,c.x,c.y,c.z)}else for(let t=0,s=e.count;t<s;t+=3)i.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),o.fromBufferAttribute(e,t+2),l.subVectors(o,r),h.subVectors(i,r),l.cross(h),n.setXYZ(t+0,l.x,l.y,l.z),n.setXYZ(t+1,l.x,l.y,l.z),n.setXYZ(t+2,l.x,l.y,l.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===t.attributes[i])continue;const r=n[i].array,o=t.attributes[i],s=o.array,a=o.itemSize*e,c=Math.min(s.length,r.length-a);for(let t=0,e=a;t<c;t++,e++)r[e]=s[t]}return this},normalizeNormals:function(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Fr.fromBufferAttribute(t,e),Fr.normalize(),t.setXYZ(e,Fr.x,Fr.y,Fr.z)},toNonIndexed:function(){function t(t,e){const n=t.array,i=t.itemSize,r=t.normalized,o=new n.constructor(e.length*i);let s=0,a=0;for(let t=0,r=e.length;t<r;t++){s=e[t]*i;for(let t=0;t<i;t++)o[a++]=n[s++]}return new _r(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const e=new Gr,n=this.index.array,i=this.attributes;for(const r in i){const o=t(i[r],n);e.setAttribute(r,o)}const r=this.morphAttributes;for(const i in r){const o=[],s=r[i];for(let e=0,i=s.length;e<i;e++){const i=t(s[e],n);o.push(i)}e.morphAttributes[i]=o}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let t=0,n=o.length;t<n;t++){const n=o[t];e.addGroup(n.start,n.count,n.materialIndex)}return e},toJSON:function(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const i=n[e],r=i.toJSON(t.data);""!==i.name&&(r.name=i.name),t.data.attributes[e]=r}const i={};let r=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],o=[];for(let e=0,i=n.length;e<i;e++){const i=n[e],r=i.toJSON(t.data);""!==i.name&&(r.name=i.name),o.push(r)}o.length>0&&(i[e]=o,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(t.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),t},clone:function(){return(new Gr).copy(this)},copy:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const i=t.attributes;for(const t in i){const n=i[t];this.setAttribute(t,n.clone(e))}const r=t.morphAttributes;for(const t in r){const n=[],i=r[t];for(let t=0,r=i.length;t<r;t++)n.push(i[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let t=0,e=o.length;t<e;t++){const e=o[t];this.addGroup(e.start,e.count,e.materialIndex)}const s=t.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const Hr=new ni,kr=new qi,Vr=new Ui,jr=new Yn,Wr=new Yn,qr=new Yn,Xr=new Yn,Yr=new Yn,Zr=new Yn,Jr=new Yn,Qr=new Yn,Kr=new Yn,$r=new Bn,to=new Bn,eo=new Bn,no=new Yn,io=new Yn;function ro(t,e){bi.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new Gr,this.material=void 0!==e?e:new yr,this.updateMorphTargets()}function oo(t,e,n,i,r,o,s,a){let c;if(null===(c=e.side===f?i.intersectTriangle(s,o,r,!0,a):i.intersectTriangle(r,o,s,e.side!==m,a)))return null;io.copy(a),io.applyMatrix4(t.matrixWorld);const l=n.ray.origin.distanceTo(io);return l<n.near||l>n.far?null:{distance:l,point:io.clone(),object:t}}function so(t,e,n,i,r,o,s,a,c,l,h,u){jr.fromBufferAttribute(r,l),Wr.fromBufferAttribute(r,h),qr.fromBufferAttribute(r,u);const p=t.morphTargetInfluences;if(e.morphTargets&&o&&p){Jr.set(0,0,0),Qr.set(0,0,0),Kr.set(0,0,0);for(let t=0,e=o.length;t<e;t++){const e=p[t],n=o[t];0!==e&&(Xr.fromBufferAttribute(n,l),Yr.fromBufferAttribute(n,h),Zr.fromBufferAttribute(n,u),s?(Jr.addScaledVector(Xr,e),Qr.addScaledVector(Yr,e),Kr.addScaledVector(Zr,e)):(Jr.addScaledVector(Xr.sub(jr),e),Qr.addScaledVector(Yr.sub(Wr),e),Kr.addScaledVector(Zr.sub(qr),e)))}jr.add(Jr),Wr.add(Qr),qr.add(Kr)}t.isSkinnedMesh&&(t.boneTransform(l,jr),t.boneTransform(h,Wr),t.boneTransform(u,qr));const d=oo(t,e,n,i,jr,Wr,qr,no);if(d){a&&($r.fromBufferAttribute(a,l),to.fromBufferAttribute(a,h),eo.fromBufferAttribute(a,u),d.uv=ar.getUV(no,jr,Wr,qr,$r,to,eo,new Bn)),c&&($r.fromBufferAttribute(c,l),to.fromBufferAttribute(c,h),eo.fromBufferAttribute(c,u),d.uv2=ar.getUV(no,jr,Wr,qr,$r,to,eo,new Bn));const t=new mr(l,h,u);ar.getNormal(jr,Wr,qr,t.normal),d.face=t}return d}ro.prototype=Object.assign(Object.create(bi.prototype),{constructor:ro,isMesh:!0,copy:function(t){return bi.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Vr.copy(n.boundingSphere),Vr.applyMatrix4(r),!1===t.ray.intersectsSphere(Vr))return;if(Hr.getInverse(r),kr.copy(t.ray).applyMatrix4(Hr),null!==n.boundingBox&&!1===kr.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const r=n.index,s=n.attributes.position,a=n.morphAttributes.position,c=n.morphTargetsRelative,l=n.attributes.uv,h=n.attributes.uv2,u=n.groups,p=n.drawRange;if(null!==r)if(Array.isArray(i))for(let n=0,d=u.length;n<d;n++){const d=u[n],f=i[d.materialIndex];for(let n=Math.max(d.start,p.start),i=Math.min(d.start+d.count,p.start+p.count);n<i;n+=3){const i=r.getX(n),u=r.getX(n+1),p=r.getX(n+2);(o=so(this,f,t,kr,s,a,c,l,h,i,u,p))&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=d.materialIndex,e.push(o))}}else{for(let n=Math.max(0,p.start),u=Math.min(r.count,p.start+p.count);n<u;n+=3){const u=r.getX(n),p=r.getX(n+1),d=r.getX(n+2);(o=so(this,i,t,kr,s,a,c,l,h,u,p,d))&&(o.faceIndex=Math.floor(n/3),e.push(o))}}else if(void 0!==s)if(Array.isArray(i))for(let n=0,r=u.length;n<r;n++){const r=u[n],d=i[r.materialIndex];for(let n=Math.max(r.start,p.start),i=Math.min(r.start+r.count,p.start+p.count);n<i;n+=3){(o=so(this,d,t,kr,s,a,c,l,h,n,n+1,n+2))&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=r.materialIndex,e.push(o))}}else{for(let n=Math.max(0,p.start),r=Math.min(s.count,p.start+p.count);n<r;n+=3){(o=so(this,i,t,kr,s,a,c,l,h,n,n+1,n+2))&&(o.faceIndex=Math.floor(n/3),e.push(o))}}}else if(n.isGeometry){const r=Array.isArray(i),s=n.vertices,a=n.faces;let c;const l=n.faceVertexUvs[0];l.length>0&&(c=l);for(let n=0,l=a.length;n<l;n++){const l=a[n],h=r?i[l.materialIndex]:i;if(void 0===h)continue;const u=s[l.a],p=s[l.b],d=s[l.c];if(o=oo(this,h,t,kr,u,p,d,no)){if(c&&c[n]){const t=c[n];$r.copy(t[0]),to.copy(t[1]),eo.copy(t[2]),o.uv=ar.getUV(no,u,p,d,$r,to,eo,new Bn)}o.face=l,o.faceIndex=n,e.push(o)}}}}});let ao=0;const co=new ni,lo=new bi,ho=new Yn;function uo(){Object.defineProperty(this,"id",{value:ao+=2}),this.uuid=Nn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}uo.prototype=Object.assign(Object.create(Dn.prototype),{constructor:uo,isGeometry:!0,applyMatrix4:function(t){const e=(new zn).getNormalMatrix(t);for(let e=0,n=this.vertices.length;e<n;e++){this.vertices[e].applyMatrix4(t)}for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t];n.normal.applyMatrix3(e).normalize();for(let t=0,i=n.vertexNormals.length;t<i;t++)n.vertexNormals[t].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return co.makeRotationX(t),this.applyMatrix4(co),this},rotateY:function(t){return co.makeRotationY(t),this.applyMatrix4(co),this},rotateZ:function(t){return co.makeRotationZ(t),this.applyMatrix4(co),this},translate:function(t,e,n){return co.makeTranslation(t,e,n),this.applyMatrix4(co),this},scale:function(t,e,n){return co.makeScale(t,e,n),this.applyMatrix4(co),this},lookAt:function(t){return lo.lookAt(t),lo.updateMatrix(),this.applyMatrix4(lo.matrix),this},fromBufferGeometry:function(t){const e=this,n=null!==t.index?t.index:void 0,i=t.attributes;if(void 0===i.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const r=i.position,o=i.normal,s=i.color,a=i.uv,c=i.uv2;void 0!==c&&(this.faceVertexUvs[1]=[]);for(let t=0;t<r.count;t++)e.vertices.push((new Yn).fromBufferAttribute(r,t)),void 0!==s&&e.colors.push((new ur).fromBufferAttribute(s,t));function l(t,n,i,r){const l=void 0===s?[]:[e.colors[t].clone(),e.colors[n].clone(),e.colors[i].clone()],h=new mr(t,n,i,void 0===o?[]:[(new Yn).fromBufferAttribute(o,t),(new Yn).fromBufferAttribute(o,n),(new Yn).fromBufferAttribute(o,i)],l,r);e.faces.push(h),void 0!==a&&e.faceVertexUvs[0].push([(new Bn).fromBufferAttribute(a,t),(new Bn).fromBufferAttribute(a,n),(new Bn).fromBufferAttribute(a,i)]),void 0!==c&&e.faceVertexUvs[1].push([(new Bn).fromBufferAttribute(c,t),(new Bn).fromBufferAttribute(c,n),(new Bn).fromBufferAttribute(c,i)])}const h=t.groups;if(h.length>0)for(let t=0;t<h.length;t++){const e=h[t],i=e.start;for(let t=i,r=i+e.count;t<r;t+=3)void 0!==n?l(n.getX(t),n.getX(t+1),n.getX(t+2),e.materialIndex):l(t,t+1,t+2,e.materialIndex)}else if(void 0!==n)for(let t=0;t<n.count;t+=3)l(n.getX(t),n.getX(t+1),n.getX(t+2));else for(let t=0;t<r.count;t+=3)l(t,t+1,t+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ho).negate(),this.translate(ho.x,ho.y,ho.z),this},normalize:function(){this.computeBoundingSphere();const t=this.boundingSphere.center,e=this.boundingSphere.radius,n=0===e?1:1/e,i=new ni;return i.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix4(i),this},computeFaceNormals:function(){const t=new Yn,e=new Yn;for(let n=0,i=this.faces.length;n<i;n++){const i=this.faces[n],r=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];t.subVectors(s,o),e.subVectors(r,o),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){void 0===t&&(t=!0);const e=new Array(this.vertices.length);for(let t=0,n=this.vertices.length;t<n;t++)e[t]=new Yn;if(t){const t=new Yn,n=new Yn;for(let i=0,r=this.faces.length;i<r;i++){const r=this.faces[i],o=this.vertices[r.a],s=this.vertices[r.b],a=this.vertices[r.c];t.subVectors(a,s),n.subVectors(o,s),t.cross(n),e[r.a].add(t),e[r.b].add(t),e[r.c].add(t)}}else{this.computeFaceNormals();for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t];e[n.a].add(n.normal),e[n.b].add(n.normal),e[n.c].add(n.normal)}}for(let t=0,n=this.vertices.length;t<n;t++)e[t].normalize();for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t],i=n.vertexNormals;3===i.length?(i[0].copy(e[n.a]),i[1].copy(e[n.b]),i[2].copy(e[n.c])):(i[0]=e[n.a].clone(),i[1]=e[n.b].clone(),i[2]=e[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],n=e.vertexNormals;3===n.length?(n[0].copy(e.normal),n[1].copy(e.normal),n[2].copy(e.normal)):(n[0]=e.normal.clone(),n[1]=e.normal.clone(),n[2]=e.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let t=0,n=e.vertexNormals.length;t<n;t++)e.__originalVertexNormals[t]?e.__originalVertexNormals[t].copy(e.vertexNormals[t]):e.__originalVertexNormals[t]=e.vertexNormals[t].clone()}const t=new uo;t.faces=this.faces;for(let e=0,n=this.morphTargets.length;e<n;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];const t=this.morphNormals[e].faceNormals,n=this.morphNormals[e].vertexNormals;for(let e=0,i=this.faces.length;e<i;e++){const e=new Yn,i={a:new Yn,b:new Yn,c:new Yn};t.push(e),n.push(i)}}const n=this.morphNormals[e];t.vertices=this.morphTargets[e].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],i=n.faceNormals[t],r=n.vertexNormals[t];i.copy(e.normal),r.a.copy(e.vertexNormals[0]),r.b.copy(e.vertexNormals[1]),r.c.copy(e.vertexNormals[2])}}for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ni),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ui),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if(!t||!t.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);let i,r=this.vertices.length,o=this.vertices,s=t.vertices,a=this.faces,c=t.faces,l=this.colors,h=t.colors;void 0===n&&(n=0),void 0!==e&&(i=(new zn).getNormalMatrix(e));for(let t=0,n=s.length;t<n;t++){const n=s[t].clone();void 0!==e&&n.applyMatrix4(e),o.push(n)}for(let t=0,e=h.length;t<e;t++)l.push(h[t].clone());for(let t=0,e=c.length;t<e;t++){let e,o,s,l=c[t],h=l.vertexNormals,u=l.vertexColors;(e=new mr(l.a+r,l.b+r,l.c+r)).normal.copy(l.normal),void 0!==i&&e.normal.applyMatrix3(i).normalize();for(let t=0,n=h.length;t<n;t++)o=h[t].clone(),void 0!==i&&o.applyMatrix3(i).normalize(),e.vertexNormals.push(o);e.color.copy(l.color);for(let t=0,n=u.length;t<n;t++)s=u[t],e.vertexColors.push(s.clone());e.materialIndex=l.materialIndex+n,a.push(e)}for(let e=0,n=t.faceVertexUvs.length;e<n;e++){const n=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);for(let t=0,i=n.length;t<i;t++){const i=n[t],r=[];for(let t=0,e=i.length;t<e;t++)r.push(i[t].clone());this.faceVertexUvs[e].push(r)}}},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){const t={},e=[],n=[],i=Math.pow(10,4);for(let r=0,o=this.vertices.length;r<o;r++){const o=this.vertices[r],s=Math.round(o.x*i)+"_"+Math.round(o.y*i)+"_"+Math.round(o.z*i);void 0===t[s]?(t[s]=r,e.push(this.vertices[r]),n[r]=e.length-1):n[r]=n[t[s]]}const r=[];for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.a=n[e.a],e.b=n[e.b],e.c=n[e.c];const i=[e.a,e.b,e.c];for(let e=0;e<3;e++)if(i[e]===i[(e+1)%3]){r.push(t);break}}for(let t=r.length-1;t>=0;t--){const e=r[t];this.faces.splice(e,1);for(let t=0,n=this.faceVertexUvs.length;t<n;t++)this.faceVertexUvs[t].splice(e,1)}const o=this.vertices.length-e.length;return this.vertices=e,o},setFromPoints:function(t){this.vertices=[];for(let e=0,n=t.length;e<n;e++){const n=t[e];this.vertices.push(new Yn(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){const t=this.faces,e=t.length;for(let n=0;n<e;n++)t[n]._id=n;t.sort(function(t,e){return t.materialIndex-e.materialIndex});const n=this.faceVertexUvs[0],i=this.faceVertexUvs[1];let r,o;n&&n.length===e&&(r=[]),i&&i.length===e&&(o=[]);for(let s=0;s<e;s++){const e=t[s]._id;r&&r.push(n[e]),o&&o.push(i[e])}r&&(this.faceVertexUvs[0]=r),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){const t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}const e=[];for(let t=0;t<this.vertices.length;t++){const n=this.vertices[t];e.push(n.x,n.y,n.z)}const n=[],i=[],r={},o=[],s={},a=[],c={};for(let t=0;t<this.faces.length;t++){const e=this.faces[t],i=!0,r=!1,o=void 0!==this.faceVertexUvs[0][t],s=e.normal.length()>0,a=e.vertexNormals.length>0,c=1!==e.color.r||1!==e.color.g||1!==e.color.b,d=e.vertexColors.length>0;let f=0;if(f=l(f,0,0),f=l(f,1,i),f=l(f,2,r),f=l(f,3,o),f=l(f,4,s),f=l(f,5,a),f=l(f,6,c),f=l(f,7,d),n.push(f),n.push(e.a,e.b,e.c),n.push(e.materialIndex),o){const e=this.faceVertexUvs[0][t];n.push(p(e[0]),p(e[1]),p(e[2]))}if(s&&n.push(h(e.normal)),a){const t=e.vertexNormals;n.push(h(t[0]),h(t[1]),h(t[2]))}if(c&&n.push(u(e.color)),d){const t=e.vertexColors;n.push(u(t[0]),u(t[1]),u(t[2]))}}function l(t,e,n){return n?t|1<<e:t&~(1<<e)}function h(t){const e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==r[e]?r[e]:(r[e]=i.length/3,i.push(t.x,t.y,t.z),r[e])}function u(t){const e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==s[e]?s[e]:(s[e]=o.length,o.push(t.getHex()),s[e])}function p(t){const e=t.x.toString()+t.y.toString();return void 0!==c[e]?c[e]:(c[e]=a.length/2,a.push(t.x,t.y),c[e])}return t.data={},t.data.vertices=e,t.data.normals=i,o.length>0&&(t.data.colors=o),a.length>0&&(t.data.uvs=[a]),t.data.faces=n,t},clone:function(){return(new uo).copy(this)},copy:function(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;const e=t.vertices;for(let t=0,n=e.length;t<n;t++)this.vertices.push(e[t].clone());const n=t.colors;for(let t=0,e=n.length;t<e;t++)this.colors.push(n[t].clone());const i=t.faces;for(let t=0,e=i.length;t<e;t++)this.faces.push(i[t].clone());for(let e=0,n=t.faceVertexUvs.length;e<n;e++){const n=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);for(let t=0,i=n.length;t<i;t++){const i=n[t],r=[];for(let t=0,e=i.length;t<e;t++){const e=i[t];r.push(e.clone())}this.faceVertexUvs[e].push(r)}}const r=t.morphTargets;for(let t=0,e=r.length;t<e;t++){const e={};if(e.name=r[t].name,void 0!==r[t].vertices){e.vertices=[];for(let n=0,i=r[t].vertices.length;n<i;n++)e.vertices.push(r[t].vertices[n].clone())}if(void 0!==r[t].normals){e.normals=[];for(let n=0,i=r[t].normals.length;n<i;n++)e.normals.push(r[t].normals[n].clone())}this.morphTargets.push(e)}const o=t.morphNormals;for(let t=0,e=o.length;t<e;t++){const e={};if(void 0!==o[t].vertexNormals){e.vertexNormals=[];for(let n=0,i=o[t].vertexNormals.length;n<i;n++){const i=o[t].vertexNormals[n],r={};r.a=i.a.clone(),r.b=i.b.clone(),r.c=i.c.clone(),e.vertexNormals.push(r)}}if(void 0!==o[t].faceNormals){e.faceNormals=[];for(let n=0,i=o[t].faceNormals.length;n<i;n++)e.faceNormals.push(o[t].faceNormals[n].clone())}this.morphNormals.push(e)}const s=t.skinWeights;for(let t=0,e=s.length;t<e;t++)this.skinWeights.push(s[t].clone());const a=t.skinIndices;for(let t=0,e=a.length;t<e;t++)this.skinIndices.push(a[t].clone());const c=t.lineDistances;for(let t=0,e=c.length;t<e;t++)this.lineDistances.push(c[t]);const l=t.boundingBox;null!==l&&(this.boundingBox=l.clone());const h=t.boundingSphere;return null!==h&&(this.boundingSphere=h.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class po extends uo{constructor(t,e,n,i,r,o){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:o},this.fromBufferGeometry(new fo(t,e,n,i,r,o)),this.mergeVertices()}}class fo extends Gr{constructor(t,e,n,i,r,o){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const s=this;t=t||1,e=e||1,n=n||1,i=Math.floor(i)||1,r=Math.floor(r)||1,o=Math.floor(o)||1;const a=[],c=[],l=[],h=[];let u=0,p=0;function d(t,e,n,i,r,o,d,f,m,g,v){const y=o/m,x=d/g,b=o/2,_=d/2,w=f/2,M=m+1,S=g+1;let T=0,E=0;const A=new Yn;for(let o=0;o<S;o++){const s=o*x-_;for(let a=0;a<M;a++){const u=a*y-b;A[t]=u*i,A[e]=s*r,A[n]=w,c.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=f>0?1:-1,l.push(A.x,A.y,A.z),h.push(a/m),h.push(1-o/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const n=u+e+M*t,i=u+e+M*(t+1),r=u+(e+1)+M*(t+1),o=u+(e+1)+M*t;a.push(n,i,o),a.push(i,r,o),E+=6}s.addGroup(p,E,v),p+=E,u+=T}d("z","y","x",-1,-1,n,e,t,o,r,0),d("z","y","x",1,-1,n,e,-t,o,r,1),d("x","z","y",1,1,t,n,e,i,o,2),d("x","z","y",1,-1,t,n,-e,i,o,3),d("x","y","z",1,-1,t,e,n,i,r,4),d("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(a),this.setAttribute("position",new Rr(c,3)),this.setAttribute("normal",new Rr(l,3)),this.setAttribute("uv",new Rr(h,2))}}function mo(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function go(t){const e={};for(let n=0;n<t.length;n++){const i=mo(t[n]);for(const t in i)e[t]=i[t]}return e}const vo={clone:mo,merge:go};var yo="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",xo="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function bo(t){vr.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=yo,this.fragmentShader=xo,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function _o(){bi.call(this),this.type="Camera",this.matrixWorldInverse=new ni,this.projectionMatrix=new ni,this.projectionMatrixInverse=new ni}function wo(t,e,n,i){_o.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}bo.prototype=Object.create(vr.prototype),bo.prototype.constructor=bo,bo.prototype.isShaderMaterial=!0,bo.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=mo(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this},bo.prototype.toJSON=function(t){const e=vr.prototype.toJSON.call(this,t);e.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?e.uniforms[n]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[n]={type:"m4",value:i.toArray()}:e.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e},_o.prototype=Object.assign(Object.create(bi.prototype),{constructor:_o,isCamera:!0,copy:function(t,e){return bi.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Yn),this.updateMatrixWorld(!0);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){bi.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,e){bi.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),wo.prototype=Object.assign(Object.create(_o.prototype),{constructor:wo,isPerspectiveCamera:!0,copy:function(t,e){return _o.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Nn.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){const t=Math.tan(.5*Nn.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Nn.RAD2DEG*Math.atan(Math.tan(.5*Nn.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,i,r,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){let t=this.near,e=t*Math.tan(.5*Nn.DEG2RAD*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i,o=this.view;if(null!==this.view&&this.view.enabled){const t=o.fullWidth,s=o.fullHeight;r+=o.offsetX*i/t,e-=o.offsetY*n/s,i*=o.width/t,n*=o.height/s}const s=this.filmOffset;0!==s&&(r+=t*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){const e=bi.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});const Mo=90,So=1;function To(t,e,n){if(bi.call(this),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new wo(Mo,So,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Yn(1,0,0)),this.add(i);const r=new wo(Mo,So,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Yn(-1,0,0)),this.add(r);const o=new wo(Mo,So,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new Yn(0,1,0)),this.add(o);const s=new wo(Mo,So,t,e);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new Yn(0,-1,0)),this.add(s);const a=new wo(Mo,So,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Yn(0,0,1)),this.add(a);const c=new wo(Mo,So,t,e);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new Yn(0,0,-1)),this.add(c),this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();const l=t.xr.enabled,h=t.getRenderTarget();t.xr.enabled=!1;const u=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,r),t.setRenderTarget(n,2),t.render(e,o),t.setRenderTarget(n,3),t.render(e,s),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=u,t.setRenderTarget(n,5),t.render(e,c),t.setRenderTarget(h),t.xr.enabled=l},this.clear=function(t,e,i,r){const o=t.getRenderTarget();for(let o=0;o<6;o++)t.setRenderTarget(n,o),t.clear(e,i,r);t.setRenderTarget(o)}}function Eo(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),Vn.call(this,t,t,e)}function Ao(t,e,n,i,r,o,s,a,c,l,h,u){Hn.call(this,null,o,s,a,c,l,i,r,h,u),this.image={data:t||null,width:e||1,height:n||1},this.magFilter=void 0!==c?c:dt,this.minFilter=void 0!==l?l:dt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}To.prototype=Object.create(bi.prototype),To.prototype.constructor=To,Eo.prototype=Object.create(Vn.prototype),Eo.prototype.constructor=Eo,Eo.prototype.isWebGLCubeRenderTarget=!0,Eo.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=e.format,this.texture.encoding=e.encoding;const n=new _i,i={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#include <common>","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV = equirectUv( direction );","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},r=new bo({name:"CubemapFromEquirect",uniforms:mo(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:f,blending:y});r.uniforms.tEquirect.value=e;const o=new ro(new fo(5,5,5),r);return n.add(o),new To(1,10,this).update(t,n),o.geometry.dispose(),o.material.dispose(),this},Ao.prototype=Object.create(Hn.prototype),Ao.prototype.constructor=Ao,Ao.prototype.isDataTexture=!0;const Lo=new Ui,Ro=new Yn;function Po(t,e,n,i,r,o){this.planes=[void 0!==t?t:new Ji,void 0!==e?e:new Ji,void 0!==n?n:new Ji,void 0!==i?i:new Ji,void 0!==r?r:new Ji,void 0!==o?o:new Ji]}Object.assign(Po.prototype,{set:function(t,e,n,i,r,o){const s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(n),s[3].copy(i),s[4].copy(r),s[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this},setFromProjectionMatrix:function(t){const e=this.planes,n=t.elements,i=n[0],r=n[1],o=n[2],s=n[3],a=n[4],c=n[5],l=n[6],h=n[7],u=n[8],p=n[9],d=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return e[0].setComponents(s-i,h-a,f-u,y-m).normalize(),e[1].setComponents(s+i,h+a,f+u,y+m).normalize(),e[2].setComponents(s+r,h+c,f+p,y+g).normalize(),e[3].setComponents(s-r,h-c,f-p,y-g).normalize(),e[4].setComponents(s-o,h-l,f-d,y-v).normalize(),e[5].setComponents(s+o,h+l,f+d,y+v).normalize(),this},intersectsObject:function(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Lo.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Lo)},intersectsSprite:function(t){return Lo.center.set(0,0,0),Lo.radius=.7071067811865476,Lo.applyMatrix4(t.matrixWorld),this.intersectsSphere(Lo)},intersectsSphere:function(t){const e=this.planes,n=t.center,i=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(n)<i)return!1}return!0},intersectsBox:function(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(Ro.x=i.normal.x>0?t.max.x:t.min.x,Ro.y=i.normal.y>0?t.max.y:t.min.y,Ro.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(Ro)<0)return!1}return!0},containsPoint:function(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}});const Co={common:{diffuse:{value:new ur(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new zn},uv2Transform:{value:new zn},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Bn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ur(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new ur(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new zn}},sprite:{diffuse:{value:new ur(15658734)},opacity:{value:1},center:{value:new Bn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new zn}}};function Oo(){let t=null,e=!1,n=null,i=null;function r(e,o){n(e,o),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function Do(t,e){const n=e.isWebGL2,i=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=i.get(e);n&&(t.deleteBuffer(n.buffer),i.delete(e))},update:function(e,r){e.isInterleavedBufferAttribute&&(e=e.data);const o=i.get(e);void 0===o?i.set(e,function(e,n){const i=e.array,r=e.usage,o=t.createBuffer();t.bindBuffer(n,o),t.bufferData(n,i,r),e.onUploadCallback();let s=5126;return i instanceof Float32Array?s=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?s=5123:i instanceof Int16Array?s=5122:i instanceof Uint32Array?s=5125:i instanceof Int32Array?s=5124:i instanceof Int8Array?s=5120:i instanceof Uint8Array&&(s=5121),{buffer:o,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}(e,r)):o.version<e.version&&(function(e,i,r){const o=i.array,s=i.updateRange;t.bindBuffer(r,e),-1===s.count?t.bufferSubData(r,0,o):(n?t.bufferSubData(r,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):t.bufferSubData(r,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1)}(o.buffer,e,r),o.version=e.version)}}}function Io(t,e,n,i){uo.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i},this.fromBufferGeometry(new No(t,e,n,i)),this.mergeVertices()}function No(t,e,n,i){Gr.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=(t=t||1)/2,o=(e=e||1)/2,s=Math.floor(n)||1,a=Math.floor(i)||1,c=s+1,l=a+1,h=t/s,u=e/a,p=[],d=[],f=[],m=[];for(let t=0;t<l;t++){const e=t*u-o;for(let n=0;n<c;n++){const i=n*h-r;d.push(i,-e,0),f.push(0,0,1),m.push(n/s),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<s;e++){const n=e+c*t,i=e+c*(t+1),r=e+1+c*(t+1),o=e+1+c*t;p.push(n,i,o),p.push(i,r,o)}this.setIndex(p),this.setAttribute("position",new Rr(d,3)),this.setAttribute("normal",new Rr(f,3)),this.setAttribute("uv",new Rr(m,2))}Io.prototype=Object.create(uo.prototype),Io.prototype.constructor=Io,No.prototype=Object.create(Gr.prototype),No.prototype.constructor=No;var Bo="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",zo="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",Uo="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",Fo="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",Go="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",Ho="vec3 transformed = vec3( position );",ko="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",Vo="vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",jo="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",Wo="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",qo="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",Xo="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",Yo="#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",Zo="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",Jo="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",Qo="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",Ko="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",$o="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",ts="#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);    } else if (face == 1.0) {\n      uv = vec2(-direction.x, -direction.z) / abs(direction.y);    } else if (face == 2.0) {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);    } else if (face == 3.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);    } else if (face == 4.0) {\n      uv = vec2(-direction.x, direction.z) / abs(direction.y);    } else {\n      uv = vec2(direction.x, direction.y) / abs(direction.z);    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",es="vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",ns="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",is="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",rs="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",os="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",ss="gl_FragColor = linearToOutputTexel( gl_FragColor );",as="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",cs="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",ls="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",hs="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",us="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",ps="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",ds="#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fs="#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",ms="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",gs="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",vs="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",ys="#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",xs="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",bs="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",_s="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",ws="#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",Ms="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",Ss="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",Ts="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",Es="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",As="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",Ls="struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",Rs="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",Ps="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",Cs="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",Os="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",Ds="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",Is="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",Ns="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",Bs="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",zs="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",Us="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",Fs="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",Gs="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",Hs="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",ks="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",Vs="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",js="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",Ws="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",qs="#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",Xs="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",Ys="#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",Zs="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",Js="#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",Qs="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",Ks="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",$s="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",ta="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",ea="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",na="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",ia="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",ra="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",oa="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",sa="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",aa="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",ca="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",la="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",ha="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",ua="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",pa="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",da="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",fa="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",ma="#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",ga="#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",va="#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",ya="#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",xa="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",ba="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",_a="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",wa="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",Ma="uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",Sa="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",Ta="#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",Ea="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",Aa="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",La="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",Ra="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",Pa="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",Ca="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",Oa="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",Da="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",Ia="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",Na="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Ba="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",za="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Ua="#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Fa="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Ga="#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",Ha="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",ka="#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Va="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",ja="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Wa="#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",qa="#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Xa="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",Ya="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",Za="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",Ja="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",Qa="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",Ka="#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",$a="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",tc="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}";const ec={alphamap_fragment:Bo,alphamap_pars_fragment:zo,alphatest_fragment:Uo,aomap_fragment:Fo,aomap_pars_fragment:Go,begin_vertex:Ho,beginnormal_vertex:ko,bsdfs:Vo,bumpmap_pars_fragment:jo,clipping_planes_fragment:Wo,clipping_planes_pars_fragment:qo,clipping_planes_pars_vertex:Xo,clipping_planes_vertex:Yo,color_fragment:Zo,color_pars_fragment:Jo,color_pars_vertex:Qo,color_vertex:Ko,common:$o,cube_uv_reflection_fragment:ts,defaultnormal_vertex:es,displacementmap_pars_vertex:ns,displacementmap_vertex:is,emissivemap_fragment:rs,emissivemap_pars_fragment:os,encodings_fragment:ss,encodings_pars_fragment:as,envmap_fragment:cs,envmap_common_pars_fragment:ls,envmap_pars_fragment:hs,envmap_pars_vertex:us,envmap_physical_pars_fragment:ws,envmap_vertex:ps,fog_vertex:ds,fog_pars_vertex:fs,fog_fragment:ms,fog_pars_fragment:gs,gradientmap_pars_fragment:vs,lightmap_fragment:ys,lightmap_pars_fragment:xs,lights_lambert_vertex:bs,lights_pars_begin:_s,lights_toon_fragment:Ms,lights_toon_pars_fragment:Ss,lights_phong_fragment:Ts,lights_phong_pars_fragment:Es,lights_physical_fragment:As,lights_physical_pars_fragment:Ls,lights_fragment_begin:Rs,lights_fragment_maps:Ps,lights_fragment_end:Cs,logdepthbuf_fragment:Os,logdepthbuf_pars_fragment:Ds,logdepthbuf_pars_vertex:Is,logdepthbuf_vertex:Ns,map_fragment:Bs,map_pars_fragment:zs,map_particle_fragment:Us,map_particle_pars_fragment:Fs,metalnessmap_fragment:Gs,metalnessmap_pars_fragment:Hs,morphnormal_vertex:ks,morphtarget_pars_vertex:Vs,morphtarget_vertex:js,normal_fragment_begin:Ws,normal_fragment_maps:qs,normalmap_pars_fragment:Xs,clearcoat_normal_fragment_begin:Ys,clearcoat_normal_fragment_maps:Zs,clearcoat_pars_fragment:Js,packing:Qs,premultiplied_alpha_fragment:Ks,project_vertex:$s,dithering_fragment:ta,dithering_pars_fragment:ea,roughnessmap_fragment:na,roughnessmap_pars_fragment:ia,shadowmap_pars_fragment:ra,shadowmap_pars_vertex:oa,shadowmap_vertex:sa,shadowmask_pars_fragment:aa,skinbase_vertex:ca,skinning_pars_vertex:la,skinning_vertex:ha,skinnormal_vertex:ua,specularmap_fragment:pa,specularmap_pars_fragment:da,tonemapping_fragment:fa,tonemapping_pars_fragment:ma,uv_pars_fragment:ga,uv_pars_vertex:va,uv_vertex:ya,uv2_pars_fragment:xa,uv2_pars_vertex:ba,uv2_vertex:_a,worldpos_vertex:wa,background_frag:Ma,background_vert:Sa,cube_frag:Ta,cube_vert:Ea,depth_frag:Aa,depth_vert:La,distanceRGBA_frag:Ra,distanceRGBA_vert:Pa,equirect_frag:Ca,equirect_vert:Oa,linedashed_frag:Da,linedashed_vert:Ia,meshbasic_frag:Na,meshbasic_vert:Ba,meshlambert_frag:za,meshlambert_vert:Ua,meshmatcap_frag:Fa,meshmatcap_vert:Ga,meshtoon_frag:Ha,meshtoon_vert:ka,meshphong_frag:Va,meshphong_vert:ja,meshphysical_frag:Wa,meshphysical_vert:qa,normal_frag:Xa,normal_vert:Ya,points_frag:Za,points_vert:Ja,shadow_frag:Qa,shadow_vert:Ka,sprite_frag:$a,sprite_vert:tc},nc={basic:{uniforms:go([Co.common,Co.specularmap,Co.envmap,Co.aomap,Co.lightmap,Co.fog]),vertexShader:ec.meshbasic_vert,fragmentShader:ec.meshbasic_frag},lambert:{uniforms:go([Co.common,Co.specularmap,Co.envmap,Co.aomap,Co.lightmap,Co.emissivemap,Co.fog,Co.lights,{emissive:{value:new ur(0)}}]),vertexShader:ec.meshlambert_vert,fragmentShader:ec.meshlambert_frag},phong:{uniforms:go([Co.common,Co.specularmap,Co.envmap,Co.aomap,Co.lightmap,Co.emissivemap,Co.bumpmap,Co.normalmap,Co.displacementmap,Co.fog,Co.lights,{emissive:{value:new ur(0)},specular:{value:new ur(1118481)},shininess:{value:30}}]),vertexShader:ec.meshphong_vert,fragmentShader:ec.meshphong_frag},standard:{uniforms:go([Co.common,Co.envmap,Co.aomap,Co.lightmap,Co.emissivemap,Co.bumpmap,Co.normalmap,Co.displacementmap,Co.roughnessmap,Co.metalnessmap,Co.fog,Co.lights,{emissive:{value:new ur(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ec.meshphysical_vert,fragmentShader:ec.meshphysical_frag},toon:{uniforms:go([Co.common,Co.aomap,Co.lightmap,Co.emissivemap,Co.bumpmap,Co.normalmap,Co.displacementmap,Co.gradientmap,Co.fog,Co.lights,{emissive:{value:new ur(0)}}]),vertexShader:ec.meshtoon_vert,fragmentShader:ec.meshtoon_frag},matcap:{uniforms:go([Co.common,Co.bumpmap,Co.normalmap,Co.displacementmap,Co.fog,{matcap:{value:null}}]),vertexShader:ec.meshmatcap_vert,fragmentShader:ec.meshmatcap_frag},points:{uniforms:go([Co.points,Co.fog]),vertexShader:ec.points_vert,fragmentShader:ec.points_frag},dashed:{uniforms:go([Co.common,Co.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ec.linedashed_vert,fragmentShader:ec.linedashed_frag},depth:{uniforms:go([Co.common,Co.displacementmap]),vertexShader:ec.depth_vert,fragmentShader:ec.depth_frag},normal:{uniforms:go([Co.common,Co.bumpmap,Co.normalmap,Co.displacementmap,{opacity:{value:1}}]),vertexShader:ec.normal_vert,fragmentShader:ec.normal_frag},sprite:{uniforms:go([Co.sprite,Co.fog]),vertexShader:ec.sprite_vert,fragmentShader:ec.sprite_frag},background:{uniforms:{uvTransform:{value:new zn},t2D:{value:null}},vertexShader:ec.background_vert,fragmentShader:ec.background_frag},cube:{uniforms:go([Co.envmap,{opacity:{value:1}}]),vertexShader:ec.cube_vert,fragmentShader:ec.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ec.equirect_vert,fragmentShader:ec.equirect_frag},distanceRGBA:{uniforms:go([Co.common,Co.displacementmap,{referencePosition:{value:new Yn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ec.distanceRGBA_vert,fragmentShader:ec.distanceRGBA_frag},shadow:{uniforms:go([Co.lights,Co.fog,{color:{value:new ur(0)},opacity:{value:1}}]),vertexShader:ec.shadow_vert,fragmentShader:ec.shadow_frag}};function ic(t,e,n,i){const r=new ur(0);let o,s,a=0,c=null,l=0,h=null;function u(t,n){e.buffers.color.setClear(t.r,t.g,t.b,n,i)}return{getClearColor:function(){return r},setClearColor:function(t,e){r.set(t),u(r,a=void 0!==e?e:1)},getClearAlpha:function(){return a},setClearAlpha:function(t){u(r,a=t)},render:function(e,i,p,m){let g=!0===i.isScene?i.background:null;const v=t.xr,y=v.getSession&&v.getSession();if(y&&"additive"===y.environmentBlendMode&&(g=null),null===g?u(r,a):g&&g.isColor&&(u(g,1),m=!0),(t.autoClear||m)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),g&&(g.isCubeTexture||g.isWebGLCubeRenderTarget||g.mapping===ct)){void 0===s&&((s=new ro(new fo(1,1,1),new bo({name:"BackgroundCubeMaterial",uniforms:mo(nc.cube.uniforms),vertexShader:nc.cube.vertexShader,fragmentShader:nc.cube.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(s));const i=g.isWebGLCubeRenderTarget?g.texture:g;s.material.uniforms.envMap.value=i,s.material.uniforms.flipEnvMap.value=i.isCubeTexture?-1:1,c===g&&l===i.version&&h===t.toneMapping||(s.material.needsUpdate=!0,c=g,l=i.version,h=t.toneMapping),e.unshift(s,s.geometry,s.material,0,0,null)}else g&&g.isTexture&&(void 0===o&&((o=new ro(new No(2,2),new bo({name:"BackgroundMaterial",uniforms:mo(nc.background.uniforms),vertexShader:nc.background.vertexShader,fragmentShader:nc.background.fragmentShader,side:d,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=g,!0===g.matrixAutoUpdate&&g.updateMatrix(),o.material.uniforms.uvTransform.value.copy(g.matrix),c===g&&l===g.version&&h===t.toneMapping||(o.material.needsUpdate=!0,c=g,l=g.version,h=t.toneMapping),e.unshift(o,o.geometry,o.material,0,0,null))}}}function rc(t,e,n,i){const r=t.getParameter(34921),o=null,s=!1,a={},c=p(null);let l=c;function h(e){return i.isWebGL2?t.bindVertexArray(e):o.bindVertexArrayOES(e)}function u(e){return i.isWebGL2?t.deleteVertexArray(e):o.deleteVertexArrayOES(e)}function p(t){const e=[],n=[],i=[];for(let t=0;t<r;t++)e[t]=0,n[t]=0,i[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:i,object:t,attributes:{}}}function d(){const t=l.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function f(t){m(t,0)}function m(n,r){const o=l.newAttributes,s=l.enabledAttributes,a=l.attributeDivisors;if(o[n]=1,0===s[n]&&(t.enableVertexAttribArray(n),s[n]=1),a[n]!==r){(i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),a[n]=r}}function g(){const e=l.newAttributes,n=l.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function v(e,n,r,o,s,a){!0!==i.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,n,r,o,s,a):t.vertexAttribIPointer(e,n,r,o,s,a)}function y(){x(),l!==c&&h((l=c).object)}function x(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function(r,c,u,y,x){let b=!1;if(s){const e=function(e,n,r){const s=!0===r.wireframe;let c=a[e.id];void 0===c&&(c={},a[e.id]=c);let l=c[n.id];void 0===l&&(l={},c[n.id]=l);let h=l[s];return void 0===h&&(h=p(i.isWebGL2?t.createVertexArray():o.createVertexArrayOES()),l[s]=h),h}(y,u,c);l!==e&&h((l=e).object),(b=function(t){const e=l.attributes,n=t.attributes;if(Object.keys(e).length!==Object.keys(n).length)return!0;for(const t in n){const i=e[t],r=n[t];if(i.attribute!==r)return!0;if(i.data!==r.data)return!0}return!1}(y))&&function(t){const e={},n=t.attributes;for(const t in n){const i=n[t],r={};r.attribute=i,i.data&&(r.data=i.data),e[t]=r}l.attributes=e}(y)}else{const t=!0===c.wireframe;l.geometry===y.id&&l.program===u.id&&l.wireframe===t||(l.geometry=y.id,l.program=u.id,l.wireframe=t,b=!0)}!0===r.isInstancedMesh&&(b=!0),null!==x&&n.update(x,34963),b&&(function(r,o,s,a){if(!1===i.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;d();const c=a.attributes,l=s.getAttributes(),h=o.defaultAttributeValues;for(const e in l){const i=l[e];if(i>=0){const o=c[e];if(void 0!==o){const e=o.normalized,r=o.itemSize,s=n.get(o);if(void 0===s)continue;const c=s.buffer,l=s.type,h=s.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,s=n.stride,u=o.offset;n&&n.isInstancedInterleavedBuffer?(m(i,n.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)):f(i),t.bindBuffer(34962,c),v(i,r,l,e,s*h,u*h)}else o.isInstancedBufferAttribute?(m(i,o.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)):f(i),t.bindBuffer(34962,c),v(i,r,l,e,0,0)}else if("instanceMatrix"===e){const e=n.get(r.instanceMatrix);if(void 0===e)continue;const o=e.buffer,s=e.type;m(i+0,1),m(i+1,1),m(i+2,1),m(i+3,1),t.bindBuffer(34962,o),t.vertexAttribPointer(i+0,4,s,!1,64,0),t.vertexAttribPointer(i+1,4,s,!1,64,16),t.vertexAttribPointer(i+2,4,s,!1,64,32),t.vertexAttribPointer(i+3,4,s,!1,64,48)}else if(void 0!==h){const n=h[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(i,n);break;case 3:t.vertexAttrib3fv(i,n);break;case 4:t.vertexAttrib4fv(i,n);break;default:t.vertexAttrib1fv(i,n)}}}}g()}(r,c,u,y),null!==x&&t.bindBuffer(34963,n.get(x).buffer))},reset:y,resetDefaultState:x,dispose:function(){y();for(const t in a){const e=a[t];for(const t in e){const n=e[t];for(const t in n)u(n[t].object),delete n[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const n=e[t];for(const t in n)u(n[t].object),delete n[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const n=a[e];if(void 0===n[t.id])continue;const i=n[t.id];for(const t in i)u(i[t].object),delete i[t];delete n[t.id]}},initAttributes:d,enableAttribute:f,disableUnusedAttributes:g}}function oc(t,e,n,i){const r=i.isWebGL2;let o;this.setMode=function(t){o=t},this.render=function(e,i){t.drawArrays(o,e,i),n.update(i,o)},this.renderInstances=function(i,s,a,c){if(0===c)return;let l,h;if(r)l=t,h="drawArraysInstanced";else if(h="drawArraysInstancedANGLE",null===(l=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[h](o,s,a,c),n.update(a,o,c)}}function sc(t,e,n){let i;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let s=void 0!==n.precision?n.precision:"highp";const a=r(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const c=!0===n.logarithmicDepthBuffer,l=t.getParameter(34930),h=t.getParameter(35660),u=t.getParameter(3379),p=t.getParameter(34076),d=t.getParameter(34921),f=t.getParameter(36347),m=t.getParameter(36348),g=t.getParameter(36349),v=h>0,y=o||!!e.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==i)return i;const n=e.get("EXT_texture_filter_anisotropic");return i=null!==n?t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:s,logarithmicDepthBuffer:c,maxTextures:l,maxVertexTextures:h,maxTextureSize:u,maxCubemapSize:p,maxAttributes:d,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?t.getParameter(36183):0}}function ac(){const t=this;let e=null,n=0,i=!1,r=!1;const o=new Ji,s=new zn,a={value:null,needsUpdate:!1};function c(){a.value!==e&&(a.value=e,a.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function l(e,n,i,r){let c=null!==e?e.length:0,l=null;if(0!==c){if(l=a.value,!0!==r||null===l){const t=i+4*c,r=n.matrixWorldInverse;s.getNormalMatrix(r),(null===l||l.length<t)&&(l=new Float32Array(t));for(let t=0,n=i;t!==c;++t,n+=4)o.copy(e[t]).applyMatrix4(r,s),o.normal.toArray(l,n),l[n+3]=o.constant}a.value=l,a.needsUpdate=!0}return t.numPlanes=c,t.numIntersection=0,l}this.uniform=a,this.numPlanes=0,this.numIntersection=0,this.init=function(t,r,o){const s=0!==t.length||r||0!==n||i;return i=r,e=l(t,o,0),n=t.length,s},this.beginShadows=function(){r=!0,l(null)},this.endShadows=function(){r=!1,c()},this.setState=function(t,o,s,h,u,p){if(!i||null===t||0===t.length||r&&!s)r?l(null):c();else{const i=r?0:n,s=4*i;let c=u.clippingState||null;a.value=c,c=l(t,h,s,p);for(let t=0;t!==s;++t)c[t]=e[t];u.clippingState=c,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=i}}}function cc(t){const e={};return{get:function(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return null===i&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),e[n]=i,i}}}function lc(t,e,n,i){const r=new WeakMap,o=new WeakMap;function s(t){const a=t.target,c=r.get(a);null!==c.index&&e.remove(c.index);for(const t in c.attributes)e.remove(c.attributes[t]);a.removeEventListener("dispose",s),r.delete(a);const l=o.get(c);l&&(e.remove(l),o.delete(c)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){const n=[],i=t.index,r=t.attributes.position;let s=0;if(null!==i){const t=i.array;s=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],r=t[e+1],o=t[e+2];n.push(i,r,r,o,o,i)}}else{const t=r.array;s=r.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,r=e+2;n.push(t,i,i,r,r,t)}}const a=new(Or(n)>65535?Lr:Er)(n,1);a.version=s;const c=o.get(t);c&&e.remove(c),o.set(t,a)}return{get:function(t,e){let i=r.get(e);return i||(e.addEventListener("dispose",s),e.isBufferGeometry?i=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new Gr).setFromObject(t)),i=e._bufferGeometry),r.set(e,i),n.memory.geometries++,i)},update:function(t){const n=t.attributes;for(const t in n)e.update(n[t],34962);const i=t.morphAttributes;for(const t in i){const n=i[t];for(let t=0,i=n.length;t<i;t++)e.update(n[t],34962)}},getWireframeAttribute:function(t){const e=o.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return o.get(t)}}}function hc(t,e,n,i){const r=i.isWebGL2;let o,s,a;this.setMode=function(t){o=t},this.setIndex=function(t){s=t.type,a=t.bytesPerElement},this.render=function(e,i){t.drawElements(o,i,s,e*a),n.update(i,o)},this.renderInstances=function(i,c,l,h){if(0===h)return;let u,p;if(r)u=t,p="drawElementsInstanced";else if(p="drawElementsInstancedANGLE",null===(u=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[p](o,l,s,c*a,h),n.update(l,o,h)}}function uc(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,i){switch(i=i||1,e.calls++,n){case 4:e.triangles+=i*(t/3);break;case 1:e.lines+=i*(t/2);break;case 3:e.lines+=i*(t-1);break;case 2:e.lines+=i*t;break;case 0:e.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function pc(t,e){return t[0]-e[0]}function dc(t,e){return Math.abs(e[1])-Math.abs(t[1])}function fc(t){const e={},n=new Float32Array(8),i=[];for(let t=0;t<8;t++)i[t]=[t,0];return{update:function(r,o,s,a){const c=r.morphTargetInfluences,l=void 0===c?0:c.length;let h=e[o.id];if(void 0===h){h=[];for(let t=0;t<l;t++)h[t]=[t,0];e[o.id]=h}for(let t=0;t<l;t++){const e=h[t];e[0]=t,e[1]=c[t]}h.sort(dc);for(let t=0;t<8;t++)t<l&&h[t][1]?(i[t][0]=h[t][0],i[t][1]=h[t][1]):(i[t][0]=Number.MAX_SAFE_INTEGER,i[t][1]=0);i.sort(pc);const u=s.morphTargets&&o.morphAttributes.position,p=s.morphNormals&&o.morphAttributes.normal;let d=0;for(let t=0;t<8;t++){const e=i[t],r=e[0],s=e[1];r!==Number.MAX_SAFE_INTEGER&&s?(u&&o.getAttribute("morphTarget"+t)!==u[r]&&o.setAttribute("morphTarget"+t,u[r]),p&&o.getAttribute("morphNormal"+t)!==p[r]&&o.setAttribute("morphNormal"+t,p[r]),n[t]=s,d+=s):(u&&void 0!==o.getAttribute("morphTarget"+t)&&o.deleteAttribute("morphTarget"+t),p&&void 0!==o.getAttribute("morphNormal"+t)&&o.deleteAttribute("morphNormal"+t),n[t]=0)}const f=o.morphTargetsRelative?1:1-d;a.getUniforms().setValue(t,"morphTargetBaseInfluence",f),a.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function mc(t,e,n,i){let r=new WeakMap;return{update:function(t){const o=i.render.frame,s=t.geometry,a=e.get(t,s);return r.get(a)!==o&&(s.isGeometry&&a.updateFromObject(t),e.update(a),r.set(a,o)),t.isInstancedMesh&&n.update(t.instanceMatrix,34962),a},dispose:function(){r=new WeakMap}}}function gc(t,e,n,i,r,o,s,a,c,l){t=void 0!==t?t:[],e=void 0!==e?e:rt,s=void 0!==s?s:Bt,Hn.call(this,t,e,n,i,r,o,s,a,c,l),this.flipY=!1}function vc(t,e,n,i){Hn.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:i||1},this.magFilter=dt,this.minFilter=dt,this.wrapR=ut,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function yc(t,e,n,i){Hn.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:i||1},this.magFilter=dt,this.minFilter=dt,this.wrapR=ut,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}nc.physical={uniforms:go([nc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Bn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new ur(0)},transparency:{value:0}}]),vertexShader:ec.meshphysical_vert,fragmentShader:ec.meshphysical_frag},gc.prototype=Object.create(Hn.prototype),gc.prototype.constructor=gc,gc.prototype.isCubeTexture=!0,Object.defineProperty(gc.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),vc.prototype=Object.create(Hn.prototype),vc.prototype.constructor=vc,vc.prototype.isDataTexture2DArray=!0,yc.prototype=Object.create(Hn.prototype),yc.prototype.constructor=yc,yc.prototype.isDataTexture3D=!0;const xc=new Hn,bc=new vc,_c=new yc,wc=new gc,Mc=[],Sc=[],Tc=new Float32Array(16),Ec=new Float32Array(9),Ac=new Float32Array(4);function Lc(t,e,n){const i=t[0];if(i<=0||i>0)return t;let r=e*n,o=Mc[r];if(void 0===o&&(o=new Float32Array(r),Mc[r]=o),0!==e){i.toArray(o,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(o,r)}return o}function Rc(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Pc(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function Cc(t,e){let n=Sc[e];void 0===n&&(n=new Int32Array(e),Sc[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function Oc(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Dc(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Rc(n,e))return;t.uniform2fv(this.addr,e),Pc(n,e)}}function Ic(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Rc(n,e))return;t.uniform3fv(this.addr,e),Pc(n,e)}}function Nc(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Rc(n,e))return;t.uniform4fv(this.addr,e),Pc(n,e)}}function Bc(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Rc(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Pc(n,e)}else{if(Rc(n,i))return;Ac.set(i),t.uniformMatrix2fv(this.addr,!1,Ac),Pc(n,i)}}function zc(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Rc(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Pc(n,e)}else{if(Rc(n,i))return;Ec.set(i),t.uniformMatrix3fv(this.addr,!1,Ec),Pc(n,i)}}function Uc(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Rc(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Pc(n,e)}else{if(Rc(n,i))return;Tc.set(i),t.uniformMatrix4fv(this.addr,!1,Tc),Pc(n,i)}}function Fc(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(e||xc,r)}function Gc(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||bc,r)}function Hc(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||_c,r)}function kc(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(e||wc,r)}function Vc(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function jc(t,e){const n=this.cache;Rc(n,e)||(t.uniform2iv(this.addr,e),Pc(n,e))}function Wc(t,e){const n=this.cache;Rc(n,e)||(t.uniform3iv(this.addr,e),Pc(n,e))}function qc(t,e){const n=this.cache;Rc(n,e)||(t.uniform4iv(this.addr,e),Pc(n,e))}function Xc(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Yc(t){switch(t){case 5126:return Oc;case 35664:return Dc;case 35665:return Ic;case 35666:return Nc;case 35674:return Bc;case 35675:return zc;case 35676:return Uc;case 5124:case 35670:return Vc;case 35667:case 35671:return jc;case 35668:case 35672:return Wc;case 35669:case 35673:return qc;case 5125:return Xc;case 35678:case 36198:case 36298:case 36306:case 35682:return Fc;case 35679:case 36299:case 36307:return Hc;case 35680:case 36300:case 36308:case 36293:return kc;case 36289:case 36303:case 36311:case 36292:return Gc}}function Zc(t,e){t.uniform1fv(this.addr,e)}function Jc(t,e){t.uniform1iv(this.addr,e)}function Qc(t,e){t.uniform2iv(this.addr,e)}function Kc(t,e){t.uniform3iv(this.addr,e)}function $c(t,e){t.uniform4iv(this.addr,e)}function tl(t,e){const n=Lc(e,this.size,2);t.uniform2fv(this.addr,n)}function el(t,e){const n=Lc(e,this.size,3);t.uniform3fv(this.addr,n)}function nl(t,e){const n=Lc(e,this.size,4);t.uniform4fv(this.addr,n)}function il(t,e){const n=Lc(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function rl(t,e){const n=Lc(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function ol(t,e){const n=Lc(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function sl(t,e,n){const i=e.length,r=Cc(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.safeSetTexture2D(e[t]||xc,r[t])}function al(t,e,n){const i=e.length,r=Cc(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.safeSetTextureCube(e[t]||wc,r[t])}function cl(t){switch(t){case 5126:return Zc;case 35664:return tl;case 35665:return el;case 35666:return nl;case 35674:return il;case 35675:return rl;case 35676:return ol;case 5124:case 35670:return Jc;case 35667:case 35671:return Qc;case 35668:case 35672:return Kc;case 35669:case 35673:return $c;case 35678:case 36198:case 36298:case 36306:case 35682:return sl;case 35680:case 36300:case 36308:case 36293:return al}}function ll(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=Yc(e.type)}function hl(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=cl(e.type)}function ul(t){this.id=t,this.seq=[],this.map={}}hl.prototype.updateCache=function(t){let e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),Pc(e,t)},ul.prototype.setValue=function(t,e,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const o=i[r];o.setValue(t,e[o.id],n)}};const pl=/([\w\d_]+)(\])?(\[|\.)?/g;function dl(t,e){t.seq.push(e),t.map[e.id]=e}function fl(t,e,n){const i=t.name,r=i.length;for(pl.lastIndex=0;;){const o=pl.exec(i),s=pl.lastIndex;let a=o[1],c="]"===o[2],l=o[3];if(c&&(a|=0),void 0===l||"["===l&&s+2===r){dl(n,void 0===l?new ll(a,t,e):new hl(a,t,e));break}{let t=n.map[a];void 0===t&&dl(n,t=new ul(a)),n=t}}}function ml(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);fl(n,t.getUniformLocation(e,n.name),this)}}function gl(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}ml.prototype.setValue=function(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)},ml.prototype.setOptional=function(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)},ml.upload=function(t,e,n,i){for(let r=0,o=e.length;r!==o;++r){const o=e[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(t,s.value,i)}},ml.seqWithValue=function(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const r=t[i];r.id in e&&n.push(r)}return n};let vl=0;function yl(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}function xl(t){switch(t){case Ze:return["Linear","( value )"];case Je:return["sRGB","( value )"];case Ke:return["RGBE","( value )"];case tn:return["RGBM","( value, 7.0 )"];case en:return["RGBM","( value, 16.0 )"];case nn:return["RGBD","( value, 256.0 )"];case Qe:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case $e:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function bl(t,e,n){const i=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();return i&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+r+yl(t.getShaderSource(e))}function _l(t,e){const n=xl(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function wl(t,e){const n=xl(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Ml(t,e){let n;switch(e){case K:n="Linear";break;case $:n="Reinhard";break;case tt:n="OptimizedCineon";break;case et:n="ACESFilmic";break;case nt:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Sl(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Al).join("\n")}function Tl(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}function El(t,e){const n={},i=t.getProgramParameter(e,35721);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r).name;n[i]=t.getAttribLocation(e,i)}return n}function Al(t){return""!==t}function Ll(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Rl(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Pl=/^[ \t]*#include +<([\w\d.\/]+)>/gm;function Cl(t){return t.replace(Pl,Ol)}function Ol(t,e){const n=ec[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return Cl(n)}const Dl=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Il=/#pragma unroll_loop_start[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g;function Nl(t){return t.replace(Il,zl).replace(Dl,Bl)}function Bl(t,e,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),zl(t,e,n,i)}function zl(t,e,n,i){let r="";for(let t=parseInt(e);t<parseInt(n);t++)r+=i.replace(/\[ i \]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function Ul(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Fl(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===h?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===u?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===p&&(e="SHADOWMAP_TYPE_VSM"),e}function Gl(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case rt:case ot:e="ENVMAP_TYPE_CUBE";break;case ct:case lt:e="ENVMAP_TYPE_CUBE_UV";break;case st:case at:e="ENVMAP_TYPE_EQUIREC"}return e}function Hl(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case ot:case at:e="ENVMAP_MODE_REFRACTION"}return e}function kl(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Y:e="ENVMAP_BLENDING_MULTIPLY";break;case Z:e="ENVMAP_BLENDING_MIX";break;case J:e="ENVMAP_BLENDING_ADD"}return e}function Vl(t,e,n,i){const r=t.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const c=Fl(n),l=Gl(n),h=Hl(n),u=kl(n),p=t.gammaFactor>0?t.gammaFactor:1,d=n.isWebGL2?"":Sl(n),f=Tl(o),m=r.createProgram();let g,v;if(n.isRawShaderMaterial?((g=[f].filter(Al).join("\n")).length>0&&(g+="\n"),(v=[d,f].filter(Al).join("\n")).length>0&&(v+="\n")):(g=[Ul(n),"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+p,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Al).join("\n"),v=[d,Ul(n),"#define SHADER_NAME "+n.shaderName,f,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+h:"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Q?"#define TONE_MAPPING":"",n.toneMapping!==Q?ec.tonemapping_pars_fragment:"",n.toneMapping!==Q?Ml("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",ec.encodings_pars_fragment,n.map?_l("mapTexelToLinear",n.mapEncoding):"",n.matcap?_l("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?_l("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?_l("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?_l("lightMapTexelToLinear",n.lightMapEncoding):"",wl("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Al).join("\n")),s=Rl(s=Ll(s=Cl(s),n),n),a=Rl(a=Ll(a=Cl(a),n),n),s=Nl(s),a=Nl(a),n.isWebGL2&&!n.isRawShaderMaterial){let t=!1;const e=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&null!==s.match(e)&&null!==a.match(e)&&(t=!0,s=s.replace(e,""),a=a.replace(e,"")),g=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#version 300 es\n","#define varying in",t?"":"out highp vec4 pc_fragColor;",t?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v}const y=v+a,x=gl(r,35633,g+s),b=gl(r,35632,y);if(r.attachShader(m,x),r.attachShader(m,b),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(m).trim(),e=r.getShaderInfoLog(x).trim(),n=r.getShaderInfoLog(b).trim();let i=!0,o=!0;if(!1===r.getProgramParameter(m,35714)){i=!1;const e=bl(r,x,"vertex"),n=bl(r,b,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(m,35715),"gl.getProgramInfoLog",t,e,n)}else""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==e&&""!==n||(o=!1);o&&(this.diagnostics={runnable:i,programLog:t,vertexShader:{log:e,prefix:g},fragmentShader:{log:n,prefix:v}})}let _,w;return r.deleteShader(x),r.deleteShader(b),this.getUniforms=function(){return void 0===_&&(_=new ml(r,m)),_},this.getAttributes=function(){return void 0===w&&(w=El(r,m)),w},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=vl++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=b,this}function jl(t,e,n,i){const r=[],o=n.isWebGL2,s=n.logarithmicDepthBuffer,a=n.floatVertexTextures,c=n.maxVertexUniforms,l=n.vertexTextures;let h=n.precision;const u={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function d(t){let e;return t?t.isTexture?e=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=Ze,e}return{getParameters:function(i,r,p,g,v,y,x){const b=g.fog,_=i.isMeshStandardMaterial?g.environment:null,w=i.envMap||_,M=u[i.type],S=x.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(a)return 1024;{const t=c,n=Math.floor((t-20)/4),i=Math.min(n,e.length);return i<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+i+"."),0):i}}(x):0;null!==i.precision&&(h=n.getMaxPrecision(i.precision))!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",h,"instead.");const T=function(t,e){let n;if(e){const i=nc[e];n={name:t.name||t.type,uniforms:vo.clone(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}}else n={name:t.name||t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};return n}(i,M);i.onBeforeCompile(T,t);const E=t.getRenderTarget();return{isWebGL2:o,shaderID:M,shaderName:T.name,uniforms:T.uniforms,vertexShader:T.vertexShader,fragmentShader:T.fragmentShader,defines:i.defines,isRawShaderMaterial:i.isRawShaderMaterial,isShaderMaterial:i.isShaderMaterial,precision:h,instancing:!0===x.isInstancedMesh,supportsVertexTextures:l,outputEncoding:null!==E?d(E.texture):t.outputEncoding,map:!!i.map,mapEncoding:d(i.map),matcap:!!i.matcap,matcapEncoding:d(i.matcap),envMap:!!w,envMapMode:w&&w.mapping,envMapEncoding:d(w),envMapCubeUV:!!w&&(w.mapping===ct||w.mapping===lt),lightMap:!!i.lightMap,lightMapEncoding:d(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:d(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:i.normalMapType===an,tangentSpaceNormalMap:i.normalMapType===sn,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexUvs:!!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatMap||i.clearcoatRoughnessMap||i.clearcoatNormalMap||i.displacementMap),uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||!i.displacementMap),fog:!!b,useFog:i.fog,fogExp2:b&&b.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:s,skinning:i.skinning&&S>0,maxBones:S,useVertexTexture:a,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numDirLightShadows:r.directionalShadowMap.length,numPointLightShadows:r.pointShadowMap.length,numSpotLightShadows:r.spotShadowMap.length,numClippingPlanes:v,numClipIntersection:y,dithering:i.dithering,shadowMapEnabled:t.shadowMap.enabled&&p.length>0,shadowMapType:t.shadowMap.type,toneMapping:i.toneMapped?t.toneMapping:Q,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:i.side===m,flipSided:i.side===f,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:o||null!==e.get("EXT_frag_depth"),rendererExtensionDrawBuffers:o||null!==e.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:o||null!==e.get("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);if(void 0===e.isRawShaderMaterial){for(let t=0;t<p.length;t++)n.push(e[p[t]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},acquireProgram:function(e,n){let o;for(let t=0,e=r.length;t<e;t++){const e=r[t];if(e.cacheKey===n){++(o=e).usedTimes;break}}return void 0===o&&(o=new Vl(t,n,e,i),r.push(o)),o},releaseProgram:function(t){if(0==--t.usedTimes){const e=r.indexOf(t);r[e]=r[r.length-1],r.pop(),t.destroy()}},programs:r}}function Wl(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function ql(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Xl(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Yl(){const t=[];let e=0;const n=[],i=[],r={id:-1};function o(n,i,o,s,a,c){let l=t[e];return void 0===l?(l={id:n.id,object:n,geometry:i,material:o,program:o.program||r,groupOrder:s,renderOrder:n.renderOrder,z:a,group:c},t[e]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=o,l.program=o.program||r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=a,l.group=c),e++,l}return{opaque:n,transparent:i,init:function(){e=0,n.length=0,i.length=0},push:function(t,e,r,s,a,c){const l=o(t,e,r,s,a,c);(!0===r.transparent?i:n).push(l)},unshift:function(t,e,r,s,a,c){const l=o(t,e,r,s,a,c);(!0===r.transparent?i:n).unshift(l)},finish:function(){for(let n=e,i=t.length;n<i;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.program=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||ql),i.length>1&&i.sort(e||Xl)}}}function Zl(){let t=new WeakMap;function e(n){const i=n.target;i.removeEventListener("dispose",e),t.delete(i)}return{get:function(n,i){const r=t.get(n);let o;return void 0===r?(o=new Yl,t.set(n,new WeakMap),t.get(n).set(i,o),n.addEventListener("dispose",e)):void 0===(o=r.get(i))&&(o=new Yl,r.set(i,o)),o},dispose:function(){t=new WeakMap}}}function Jl(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Yn,color:new ur};break;case"SpotLight":n={position:new Yn,direction:new Yn,color:new ur,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Yn,color:new ur,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Yn,skyColor:new ur,groundColor:new ur};break;case"RectAreaLight":n={color:new ur,position:new Yn,halfWidth:new Yn,halfHeight:new Yn}}return t[e.id]=n,n}}}function Ql(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Bn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Bn,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}let Kl=0;function $l(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function th(){const t=new Jl,e=Ql(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)n.probe.push(new Yn);const i=new Yn,r=new ni,o=new ni;return{setup:function(s,a,c){let l=0,h=0,u=0;for(let t=0;t<9;t++)n.probe[t].set(0,0,0);let p=0,d=0,f=0,m=0,g=0,v=0,y=0,x=0;const b=c.matrixWorldInverse;s.sort($l);for(let a=0,c=s.length;a<c;a++){const c=s[a],_=c.color,w=c.intensity,M=c.distance,S=c.shadow&&c.shadow.map?c.shadow.map.texture:null;if(c.isAmbientLight)l+=_.r*w,h+=_.g*w,u+=_.b*w;else if(c.isLightProbe)for(let t=0;t<9;t++)n.probe[t].addScaledVector(c.sh.coefficients[t],w);else if(c.isDirectionalLight){const r=t.get(c);if(r.color.copy(c.color).multiplyScalar(c.intensity),r.direction.setFromMatrixPosition(c.matrixWorld),i.setFromMatrixPosition(c.target.matrixWorld),r.direction.sub(i),r.direction.transformDirection(b),c.castShadow){const t=c.shadow,i=e.get(c);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,n.directionalShadow[p]=i,n.directionalShadowMap[p]=S,n.directionalShadowMatrix[p]=c.shadow.matrix,v++}n.directional[p]=r,p++}else if(c.isSpotLight){const r=t.get(c);if(r.position.setFromMatrixPosition(c.matrixWorld),r.position.applyMatrix4(b),r.color.copy(_).multiplyScalar(w),r.distance=M,r.direction.setFromMatrixPosition(c.matrixWorld),i.setFromMatrixPosition(c.target.matrixWorld),r.direction.sub(i),r.direction.transformDirection(b),r.coneCos=Math.cos(c.angle),r.penumbraCos=Math.cos(c.angle*(1-c.penumbra)),r.decay=c.decay,c.castShadow){const t=c.shadow,i=e.get(c);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,n.spotShadow[f]=i,n.spotShadowMap[f]=S,n.spotShadowMatrix[f]=c.shadow.matrix,x++}n.spot[f]=r,f++}else if(c.isRectAreaLight){const e=t.get(c);e.color.copy(_).multiplyScalar(w),e.position.setFromMatrixPosition(c.matrixWorld),e.position.applyMatrix4(b),o.identity(),r.copy(c.matrixWorld),r.premultiply(b),o.extractRotation(r),e.halfWidth.set(.5*c.width,0,0),e.halfHeight.set(0,.5*c.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),n.rectArea[m]=e,m++}else if(c.isPointLight){const i=t.get(c);if(i.position.setFromMatrixPosition(c.matrixWorld),i.position.applyMatrix4(b),i.color.copy(c.color).multiplyScalar(c.intensity),i.distance=c.distance,i.decay=c.decay,c.castShadow){const t=c.shadow,i=e.get(c);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,n.pointShadow[d]=i,n.pointShadowMap[d]=S,n.pointShadowMatrix[d]=c.shadow.matrix,y++}n.point[d]=i,d++}else if(c.isHemisphereLight){const e=t.get(c);e.direction.setFromMatrixPosition(c.matrixWorld),e.direction.transformDirection(b),e.direction.normalize(),e.skyColor.copy(c.color).multiplyScalar(w),e.groundColor.copy(c.groundColor).multiplyScalar(w),n.hemi[g]=e,g++}}n.ambient[0]=l,n.ambient[1]=h,n.ambient[2]=u;const _=n.hash;_.directionalLength===p&&_.pointLength===d&&_.spotLength===f&&_.rectAreaLength===m&&_.hemiLength===g&&_.numDirectionalShadows===v&&_.numPointShadows===y&&_.numSpotShadows===x||(n.directional.length=p,n.spot.length=f,n.rectArea.length=m,n.point.length=d,n.hemi.length=g,n.directionalShadow.length=v,n.directionalShadowMap.length=v,n.pointShadow.length=y,n.pointShadowMap.length=y,n.spotShadow.length=x,n.spotShadowMap.length=x,n.directionalShadowMatrix.length=v,n.pointShadowMatrix.length=y,n.spotShadowMatrix.length=x,_.directionalLength=p,_.pointLength=d,_.spotLength=f,_.rectAreaLength=m,_.hemiLength=g,_.numDirectionalShadows=v,_.numPointShadows=y,_.numSpotShadows=x,n.version=Kl++)},state:n}}function eh(){const t=new th,e=[],n=[];return{init:function(){e.length=0,n.length=0},state:{lightsArray:e,shadowsArray:n,lights:t},setupLights:function(i){t.setup(e,n,i)},pushLight:function(t){e.push(t)},pushShadow:function(t){n.push(t)}}}function nh(){let t=new WeakMap;function e(n){const i=n.target;i.removeEventListener("dispose",e),t.delete(i)}return{get:function(n,i){let r;return!1===t.has(n)?(r=new eh,t.set(n,new WeakMap),t.get(n).set(i,r),n.addEventListener("dispose",e)):!1===t.get(n).has(i)?(r=new eh,t.get(n).set(i,r)):r=t.get(n).get(i),r},dispose:function(){t=new WeakMap}}}function ih(t){vr.call(this),this.type="MeshDepthMaterial",this.depthPacking=rn,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function rh(t){vr.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Yn,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}ih.prototype=Object.create(vr.prototype),ih.prototype.constructor=ih,ih.prototype.isMeshDepthMaterial=!0,ih.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},rh.prototype=Object.create(vr.prototype),rh.prototype.constructor=rh,rh.prototype.isMeshDistanceMaterial=!0,rh.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};var oh="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",sh="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function ah(t,e,n){let i=new Po;const r=new Bn,o=new Bn,s=new kn,a=[],c=[],l={},u={0:f,1:d,2:m},g=new bo({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Bn},radius:{value:4}},vertexShader:sh,fragmentShader:oh}),v=g.clone();v.defines.HORIZONAL_PASS=1;const x=new Gr;x.setAttribute("position",new _r(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new ro(x,g),_=this;function w(n,i){const r=e.update(b);g.uniforms.shadow_pass.value=n.map.texture,g.uniforms.resolution.value=n.mapSize,g.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,r,g,b,null),v.uniforms.shadow_pass.value=n.mapPass.texture,v.uniforms.resolution.value=n.mapSize,v.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,r,v,b,null)}function M(t,e,n){const i=t<<0|e<<1|n<<2;let r=a[i];return void 0===r&&(r=new ih({depthPacking:on,morphTargets:t,skinning:e}),a[i]=r),r}function S(t,e,n){const i=t<<0|e<<1|n<<2;let r=c[i];return void 0===r&&(r=new rh({morphTargets:t,skinning:e}),c[i]=r),r}function T(e,n,i,r,o,s,a){let c=null,h=M,d=e.customDepthMaterial;if(!0===r.isPointLight&&(h=S,d=e.customDistanceMaterial),void 0===d){let t=!1;!0===i.morphTargets&&(t=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let r=!1;!0===e.isSkinnedMesh&&(!0===i.skinning?r=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e)),c=h(t,r,!0===e.isInstancedMesh)}else c=d;if(t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){const t=c.uuid,e=i.uuid;let n=l[t];void 0===n&&(n={},l[t]=n);let r=n[e];void 0===r&&(r=c.clone(),n[e]=r),c=r}return c.visible=i.visible,c.wireframe=i.wireframe,c.side=a===p?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:u[i.side],c.clipShadows=i.clipShadows,c.clippingPlanes=i.clippingPlanes,c.clipIntersection=i.clipIntersection,c.wireframeLinewidth=i.wireframeLinewidth,c.linewidth=i.linewidth,!0===r.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(r.matrixWorld),c.nearDistance=o,c.farDistance=s),c}function E(n,r,o,s,a){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===p)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const i=e.update(n),r=n.material;if(Array.isArray(r)){const e=i.groups;for(let c=0,l=e.length;c<l;c++){const l=e[c],h=r[l.materialIndex];if(h&&h.visible){const e=T(n,i,h,s,o.near,o.far,a);t.renderBufferDirect(o,null,i,e,n,l)}}}else if(r.visible){const e=T(n,i,r,s,o.near,o.far,a);t.renderBufferDirect(o,null,i,e,n,null)}}const c=n.children;for(let t=0,e=c.length;t<e;t++)E(c[t],r,o,s,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=h,this.render=function(e,a,c){if(!1===_.enabled)return;if(!1===_.autoUpdate&&!1===_.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),h=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(y),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,h=e.length;l<h;l++){const h=e[l],u=h.shadow;if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;if(void 0===u){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}r.copy(u.mapSize);const f=u.getFrameExtents();if(r.multiply(f),o.copy(u.mapSize),(r.x>n||r.y>n)&&(r.x>n&&(o.x=Math.floor(n/f.x),r.x=o.x*f.x,u.mapSize.x=o.x),r.y>n&&(o.y=Math.floor(n/f.y),r.y=o.y*f.y,u.mapSize.y=o.y)),null===u.map&&!u.isPointLightShadow&&this.type===p){const t={minFilter:yt,magFilter:yt,format:zt};u.map=new Vn(r.x,r.y,t),u.map.texture.name=h.name+".shadowMap",u.mapPass=new Vn(r.x,r.y,t),u.camera.updateProjectionMatrix()}if(null===u.map){const t={minFilter:dt,magFilter:dt,format:zt};u.map=new Vn(r.x,r.y,t),u.map.texture.name=h.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const m=u.getViewportCount();for(let t=0;t<m;t++){const e=u.getViewport(t);s.set(o.x*e.x,o.y*e.y,o.x*e.z,o.y*e.w),d.viewport(s),u.updateMatrices(h,t),i=u.getFrustum(),E(a,c,u.camera,h,this.type)}u.isPointLightShadow||this.type!==p||w(u,c),u.needsUpdate=!1}_.needsUpdate=!1,t.setRenderTarget(l,h,u)}}function ch(t,e,n){const s=n.isWebGL2;const a=new function(){let e=!1;const n=new kn;let i=null;const r=new kn(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,o,s,a){!0===a&&(e*=s,i*=s,o*=s),n.set(e,i,o,s),!1===r.equals(n)&&(t.clearColor(e,i,o,s),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},c=new function(){let e=!1,n=null,i=null,r=null;return{setTest:function(t){t?ft(2929):mt(2929)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){if(e)switch(e){case G:t.depthFunc(512);break;case H:t.depthFunc(519);break;case k:t.depthFunc(513);break;case V:t.depthFunc(515);break;case j:t.depthFunc(514);break;case W:t.depthFunc(518);break;case q:t.depthFunc(516);break;case X:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}},l=new function(){let e=!1,n=null,i=null,r=null,o=null,s=null,a=null,c=null,l=null;return{setTest:function(t){e||(t?ft(2960):mt(2960))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,s){i===e&&r===n&&o===s||(t.stencilFunc(e,n,s),i=e,r=n,o=s)},setOp:function(e,n,i){s===e&&a===n&&c===i||(t.stencilOp(e,n,i),s=e,a=n,c=i)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,n=null,i=null,r=null,o=null,s=null,a=null,c=null,l=null}}};let h={},u=null,p=null,d=null,g=null,v=null,Y=null,Z=null,J=null,Q=null,K=!1,$=null,tt=null,et=null,nt=null,it=null;const rt=t.getParameter(35661);let ot=!1,st=0;const at=t.getParameter(7938);-1!==at.indexOf("WebGL")?(st=parseFloat(/^WebGL\ ([0-9])/.exec(at)[1]),ot=st>=1):-1!==at.indexOf("OpenGL ES")&&(st=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(at)[1]),ot=st>=2);let ct=null,lt={};const ht=new kn,ut=new kn;function pt(e,n,i){const r=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<i;e++)t.texImage2D(n+e,0,6408,1,1,0,6408,5121,r);return o}const dt={};function ft(e){!0!==h[e]&&(t.enable(e),h[e]=!0)}function mt(e){!1!==h[e]&&(t.disable(e),h[e]=!1)}dt[3553]=pt(3553,3553,1),dt[34067]=pt(34067,34069,6),a.setClear(0,0,0,1),c.setClear(1),l.setClear(0),ft(2929),c.setFunc(V),xt(!1),bt(r),ft(2884),yt(y);const gt={[S]:32774,[T]:32778,[E]:32779};if(s)gt[A]=32775,gt[L]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(gt[A]=t.MIN_EXT,gt[L]=t.MAX_EXT)}const vt={[R]:0,[P]:1,[C]:768,[D]:770,[F]:776,[z]:774,[N]:772,[O]:769,[I]:771,[U]:775,[B]:773};function yt(e,n,i,r,o,s,a,c){if(e!==y){if(p||(ft(3042),p=!0),e===M)o=o||n,s=s||i,a=a||r,n===g&&o===Z||(t.blendEquationSeparate(gt[n],gt[o]),g=n,Z=o),i===v&&r===Y&&s===J&&a===Q||(t.blendFuncSeparate(vt[i],vt[r],vt[s],vt[a]),v=i,Y=r,J=s,Q=a),d=e,K=null;else if(e!==d||c!==K){if(g===S&&Z===S||(t.blendEquation(32774),g=S,Z=S),c)switch(e){case x:t.blendFuncSeparate(1,771,1,771);break;case b:t.blendFunc(1,1);break;case _:t.blendFuncSeparate(0,0,769,771);break;case w:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case x:t.blendFuncSeparate(770,771,1,771);break;case b:t.blendFunc(770,1);break;case _:t.blendFunc(0,769);break;case w:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}v=null,Y=null,J=null,Q=null,d=e,K=c}}else p&&(mt(3042),p=!1)}function xt(e){$!==e&&(e?t.frontFace(2304):t.frontFace(2305),$=e)}function bt(e){e!==i?(ft(2884),e!==tt&&(e===r?t.cullFace(1029):e===o?t.cullFace(1028):t.cullFace(1032))):mt(2884),tt=e}function _t(e,n,i){e?(ft(32823),nt===n&&it===i||(t.polygonOffset(n,i),nt=n,it=i)):mt(32823)}function wt(e){void 0===e&&(e=33984+rt-1),ct!==e&&(t.activeTexture(e),ct=e)}return{buffers:{color:a,depth:c,stencil:l},enable:ft,disable:mt,useProgram:function(e){return u!==e&&(t.useProgram(e),u=e,!0)},setBlending:yt,setMaterial:function(t,e){t.side===m?mt(2884):ft(2884);let n=t.side===f;e&&(n=!n),xt(n),t.blending===x&&!1===t.transparent?yt(y):yt(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),c.setFunc(t.depthFunc),c.setTest(t.depthTest),c.setMask(t.depthWrite),a.setMask(t.colorWrite);const i=t.stencilWrite;l.setTest(i),i&&(l.setMask(t.stencilWriteMask),l.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),l.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),_t(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:xt,setCullFace:bt,setLineWidth:function(e){e!==et&&(ot&&t.lineWidth(e),et=e)},setPolygonOffset:_t,setScissorTest:function(t){t?ft(3089):mt(3089)},activeTexture:wt,bindTexture:function(e,n){null===ct&&wt();let i=lt[ct];void 0===i&&(i={type:void 0,texture:void 0},lt[ct]=i),i.type===e&&i.texture===n||(t.bindTexture(e,n||dt[e]),i.type=e,i.texture=n)},unbindTexture:function(){const e=lt[ct];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===ht.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),ht.copy(e))},viewport:function(e){!1===ut.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),ut.copy(e))},reset:function(){h={},ct=null,lt={},u=null,d=null,$=null,tt=null,a.reset(),c.reset(),l.reset()}}}function lh(t,e,n,i,r,o,s){const a=r.isWebGL2,c=r.maxTextures,l=r.maxCubemapSize,h=r.maxTextureSize,u=r.maxSamples,p=new WeakMap;let d,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function m(t,e){return f?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(t,e,n,i){let r=1;if((t.width>i||t.height>i)&&(r=i/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const i=e?Nn.floorPowerOfTwo:Math.floor,o=i(r*t.width),s=i(r*t.height);void 0===d&&(d=m(o,s));const a=n?m(o,s):d;return a.width=o,a.height=s,a.getContext("2d").drawImage(t,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+o+"x"+s+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function v(t){return Nn.isPowerOfTwo(t.width)&&Nn.isPowerOfTwo(t.height)}function y(t,e){return t.generateMipmaps&&e&&t.minFilter!==dt&&t.minFilter!==yt}function x(e,n,r,o){t.generateMipmap(e),i.get(n).__maxMipLevel=Math.log(Math.max(r,o))*Math.LOG2E}function b(n,i,r){if(!1===a)return i;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=i;return 6403===i&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),6407===i&&(5126===r&&(o=34837),5131===r&&(o=34843),5121===r&&(o=32849)),6408===i&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||e.get("EXT_color_buffer_float"),o}function _(t){return t===dt||t===ft||t===gt?9728:9729}function w(e){const n=e.target;n.removeEventListener("dispose",w),function(e){const n=i.get(e);if(void 0===n.__webglInit)return;t.deleteTexture(n.__webglTexture),i.remove(e)}(n),n.isVideoTexture&&p.delete(n),s.memory.textures--}function M(e){const n=e.target;n.removeEventListener("dispose",M),function(e){const n=i.get(e),r=i.get(e.texture);if(!e)return;void 0!==r.__webglTexture&&t.deleteTexture(r.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(n.__webglFramebuffer[e]),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[e]);else t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&t.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer);i.remove(e.texture),i.remove(e)}(n),s.memory.textures--}let S=0;function T(t,e){const r=i.get(t);if(t.isVideoTexture&&function(t){const e=s.render.frame;p.get(t)!==e&&(p.set(t,e),t.update())}(t),t.version>0&&r.__version!==t.version){const n=t.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void O(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,r.__webglTexture)}function E(e,r){if(6!==e.image.length)return;const s=i.get(e);if(e.version>0&&s.__version!==e.version){C(s,e),n.activeTexture(33984+r),n.bindTexture(34067,s.__webglTexture),t.pixelStorei(37440,e.flipY);const i=e&&(e.isCompressedTexture||e.image[0].isCompressedTexture),c=e.image[0]&&e.image[0].isDataTexture,h=[];for(let t=0;t<6;t++)h[t]=i||c?c?e.image[t].image:e.image[t]:g(e.image[t],!1,!0,l);const u=h[0],p=v(u)||a,d=o.convert(e.format),f=o.convert(e.type),m=b(e.internalFormat,d,f);let _;if(P(34067,e,p),i){for(let t=0;t<6;t++){_=h[t].mipmaps;for(let i=0;i<_.length;i++){const r=_[i];e.format!==zt&&e.format!==Bt?null!==d?n.compressedTexImage2D(34069+t,i,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+t,i,m,r.width,r.height,0,d,f,r.data)}}s.__maxMipLevel=_.length-1}else{_=e.mipmaps;for(let t=0;t<6;t++)if(c){n.texImage2D(34069+t,0,m,h[t].width,h[t].height,0,d,f,h[t].data);for(let e=0;e<_.length;e++){const i=_[e].image[t].image;n.texImage2D(34069+t,e+1,m,i.width,i.height,0,d,f,i.data)}}else{n.texImage2D(34069+t,0,m,d,f,h[t]);for(let e=0;e<_.length;e++){const i=_[e];n.texImage2D(34069+t,e+1,m,d,f,i.image[t])}}s.__maxMipLevel=_.length}y(e,p)&&x(34067,e,u.width,u.height),s.__version=e.version,e.onUpdate&&e.onUpdate(e)}else n.activeTexture(33984+r),n.bindTexture(34067,s.__webglTexture)}function A(t,e){n.activeTexture(33984+e),n.bindTexture(34067,i.get(t).__webglTexture)}const L={[ht]:10497,[ut]:33071,[pt]:33648},R={[dt]:9728,[ft]:9984,[gt]:9986,[yt]:9729,[xt]:9985,[_t]:9987};function P(n,o,s){s?(t.texParameteri(n,10242,L[o.wrapS]),t.texParameteri(n,10243,L[o.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,L[o.wrapR]),t.texParameteri(n,10240,R[o.magFilter]),t.texParameteri(n,10241,R[o.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),o.wrapS===ut&&o.wrapT===ut||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,_(o.magFilter)),t.texParameteri(n,10241,_(o.minFilter)),o.minFilter!==dt&&o.minFilter!==yt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const c=e.get("EXT_texture_filter_anisotropic");if(c){if(o.type===Rt&&null===e.get("OES_texture_float_linear"))return;if(o.type===Pt&&null===(a||e.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(t.texParameterf(n,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function C(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",w),e.__webglTexture=t.createTexture(),s.memory.textures++)}function O(e,i,r){let s=3553;i.isDataTexture2DArray&&(s=35866),i.isDataTexture3D&&(s=32879),C(e,i),n.activeTexture(33984+r),n.bindTexture(s,e.__webglTexture),t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment);const c=function(t){return!a&&(t.wrapS!==ut||t.wrapT!==ut||t.minFilter!==dt&&t.minFilter!==yt)}(i)&&!1===v(i.image),l=g(i.image,c,!1,h),u=v(l)||a,p=o.convert(i.format);let d,f=o.convert(i.type),m=b(i.internalFormat,p,f);P(s,i,u);const _=i.mipmaps;if(i.isDepthTexture)m=6402,a?m=i.type===Rt?36012:i.type===Lt?33190:i.type===It?35056:33189:i.type===Rt&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===Ht&&6402===m&&i.type!==Et&&i.type!==Lt&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=Et,f=o.convert(i.type)),i.format===kt&&6402===m&&(m=34041,i.type!==It&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=It,f=o.convert(i.type))),n.texImage2D(3553,0,m,l.width,l.height,0,p,f,null);else if(i.isDataTexture)if(_.length>0&&u){for(let t=0,e=_.length;t<e;t++)d=_[t],n.texImage2D(3553,t,m,d.width,d.height,0,p,f,d.data);i.generateMipmaps=!1,e.__maxMipLevel=_.length-1}else n.texImage2D(3553,0,m,l.width,l.height,0,p,f,l.data),e.__maxMipLevel=0;else if(i.isCompressedTexture){for(let t=0,e=_.length;t<e;t++)d=_[t],i.format!==zt&&i.format!==Bt?null!==p?n.compressedTexImage2D(3553,t,m,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,t,m,d.width,d.height,0,p,f,d.data);e.__maxMipLevel=_.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,m,l.width,l.height,l.depth,0,p,f,l.data),e.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,m,l.width,l.height,l.depth,0,p,f,l.data),e.__maxMipLevel=0;else if(_.length>0&&u){for(let t=0,e=_.length;t<e;t++)d=_[t],n.texImage2D(3553,t,m,p,f,d);i.generateMipmaps=!1,e.__maxMipLevel=_.length-1}else n.texImage2D(3553,0,m,p,f,l),e.__maxMipLevel=0;y(i,u)&&x(s,i,l.width,l.height),e.__version=i.version,i.onUpdate&&i.onUpdate(i)}function D(e,r,s,a){const c=o.convert(r.texture.format),l=o.convert(r.texture.type),h=b(r.texture.internalFormat,c,l);n.texImage2D(a,0,h,r.width,r.height,0,c,l,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,s,a,i.get(r.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function I(e,n,i){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===Rt?r=36012:e.type===Lt&&(r=33190));const i=B(n);t.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else t.renderbufferStorage(36161,r,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){if(i){const e=B(n);t.renderbufferStorageMultisample(36161,e,35056,n.width,n.height)}else t.renderbufferStorage(36161,34041,n.width,n.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=o.convert(n.texture.format),r=o.convert(n.texture.type),s=b(n.texture.internalFormat,e,r);if(i){const e=B(n);t.renderbufferStorageMultisample(36161,e,s,n.width,n.height)}else t.renderbufferStorage(36161,s,n.width,n.height)}t.bindRenderbuffer(36161,null)}function N(e){const n=i.get(e),r=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),T(n.depthTexture,0);const r=i.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===Ht)t.framebufferTexture2D(36160,36096,3553,r,0);else{if(n.depthTexture.format!==kt)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,r,0)}}(n.__webglFramebuffer,e)}else if(r){n.__webglDepthbuffer=[];for(let i=0;i<6;i++)t.bindFramebuffer(36160,n.__webglFramebuffer[i]),n.__webglDepthbuffer[i]=t.createRenderbuffer(),I(n.__webglDepthbuffer[i],e,!1)}else t.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=t.createRenderbuffer(),I(n.__webglDepthbuffer,e,!1);t.bindFramebuffer(36160,null)}function B(t){return a&&t.isWebGLMultisampleRenderTarget?Math.min(u,t.samples):0}let z=!1,U=!1;this.allocateTextureUnit=function(){const t=S;return t>=c&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+c),S+=1,t},this.resetTextureUnits=function(){S=0},this.setTexture2D=T,this.setTexture2DArray=function(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?O(r,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?O(r,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=E,this.setTextureCubeDynamic=A,this.setupRenderTarget=function(e){const r=i.get(e),c=i.get(e.texture);e.addEventListener("dispose",M),c.__webglTexture=t.createTexture(),s.memory.textures++;const l=!0===e.isWebGLCubeRenderTarget,h=!0===e.isWebGLMultisampleRenderTarget,u=v(e)||a;if(!a||e.texture.format!==Bt||e.texture.type!==Rt&&e.texture.type!==Pt||(e.texture.format=zt,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),l){r.__webglFramebuffer=[];for(let e=0;e<6;e++)r.__webglFramebuffer[e]=t.createFramebuffer()}else if(r.__webglFramebuffer=t.createFramebuffer(),h)if(a){r.__webglMultisampledFramebuffer=t.createFramebuffer(),r.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,r.__webglColorRenderbuffer);const n=o.convert(e.texture.format),i=o.convert(e.texture.type),s=b(e.texture.internalFormat,n,i),a=B(e);t.renderbufferStorageMultisample(36161,a,s,e.width,e.height),t.bindFramebuffer(36160,r.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,r.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(r.__webglDepthRenderbuffer=t.createRenderbuffer(),I(r.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){n.bindTexture(34067,c.__webglTexture),P(34067,e.texture,u);for(let t=0;t<6;t++)D(r.__webglFramebuffer[t],e,36064,34069+t);y(e.texture,u)&&x(34067,e.texture,e.width,e.height),n.bindTexture(34067,null)}else n.bindTexture(3553,c.__webglTexture),P(3553,e.texture,u),D(r.__webglFramebuffer,e,36064,3553),y(e.texture,u)&&x(3553,e.texture,e.width,e.height),n.bindTexture(3553,null);e.depthBuffer&&N(e)},this.updateRenderTargetMipmap=function(t){const e=t.texture;if(y(e,v(t)||a)){const r=t.isWebGLCubeRenderTarget?34067:3553,o=i.get(e).__webglTexture;n.bindTexture(r,o),x(r,e,t.width,t.height),n.bindTexture(r,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(a){const n=i.get(e);t.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,n.__webglFramebuffer);const r=e.width,o=e.height;let s=16384;e.depthBuffer&&(s|=256),e.stencilBuffer&&(s|=1024),t.blitFramebuffer(0,0,r,o,0,0,r,o,s,9728),t.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===z&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),z=!0),t=t.texture),T(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===U&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),U=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?E(t,e):A(t,e)}}function hh(t,e,n){const i=n.isWebGL2;return{convert:function(t){let n;if(t===Mt)return 5121;if(t===Ct)return 32819;if(t===Ot)return 32820;if(t===Dt)return 33635;if(t===St)return 5120;if(t===Tt)return 5122;if(t===Et)return 5123;if(t===At)return 5124;if(t===Lt)return 5125;if(t===Rt)return 5126;if(t===Pt)return i?5131:null!==(n=e.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(t===Nt)return 6406;if(t===Bt)return 6407;if(t===zt)return 6408;if(t===Ut)return 6409;if(t===Ft)return 6410;if(t===Ht)return 6402;if(t===kt)return 34041;if(t===Vt)return 6403;if(t===jt)return 36244;if(t===Wt)return 33319;if(t===qt)return 33320;if(t===Xt)return 36248;if(t===Yt)return 36249;if(t===Zt||t===Jt||t===Qt||t===Kt){if(null===(n=e.get("WEBGL_compressed_texture_s3tc")))return null;if(t===Zt)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Jt)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Qt)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Kt)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===$t||t===te||t===ee||t===ne){if(null===(n=e.get("WEBGL_compressed_texture_pvrtc")))return null;if(t===$t)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===te)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===ee)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===ne)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===ie)return null!==(n=e.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===re||t===oe)&&null!==(n=e.get("WEBGL_compressed_texture_etc"))){if(t===re)return n.COMPRESSED_RGB8_ETC2;if(t===oe)return n.COMPRESSED_RGBA8_ETC2_EAC}return t===se||t===ae||t===ce||t===le||t===he||t===ue||t===pe||t===de||t===fe||t===me||t===ge||t===ve||t===ye||t===xe||t===_e||t===we||t===Me||t===Se||t===Te||t===Ee||t===Ae||t===Le||t===Re||t===Pe||t===Ce||t===Oe||t===De||t===Ie?null!==(n=e.get("WEBGL_compressed_texture_astc"))?t:null:t===be?null!==(n=e.get("EXT_texture_compression_bptc"))?t:null:t===It?i?34042:null!==(n=e.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function uh(t){wo.call(this),this.cameras=t||[]}function ph(){bi.call(this),this.type="Group"}function dh(){this._targetRay=null,this._grip=null}function fh(t,e){const n=this;let i=null,r=1,o=null,s="local-floor",a=null;const c=[],l=new Map,h=new wo;h.layers.enable(1),h.viewport=new kn;const u=new wo;u.layers.enable(2),u.viewport=new kn;const p=[h,u],d=new uh;d.layers.enable(1),d.layers.enable(2);let f=null,m=null;function g(t){const e=l.get(t.inputSource);e&&e.dispatchEvent({type:t.type})}function v(){l.forEach(function(t,e){t.disconnect(e)}),l.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),S.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function y(t){o=t,S.setContext(i),S.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function x(t){const e=i.inputSources;for(let t=0;t<c.length;t++)l.set(e[t],c[t]);for(let e=0;e<t.removed.length;e++){const n=t.removed[e],i=l.get(n);i&&(i.dispatchEvent({type:"disconnected",data:n}),l.delete(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e],i=l.get(n);i&&i.dispatchEvent({type:"connected",data:n})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=c[t];return void 0===e&&(e=new dh,c[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=c[t];return void 0===e&&(e=new dh,c[t]=e),e.getGripSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){s=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return i},this.setSession=function(t){if(null!==(i=t)){i.addEventListener("select",g),i.addEventListener("selectstart",g),i.addEventListener("selectend",g),i.addEventListener("squeeze",g),i.addEventListener("squeezestart",g),i.addEventListener("squeezeend",g),i.addEventListener("end",v);const t=e.getContextAttributes();!0!==t.xrCompatible&&e.makeXRCompatible();const n={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:r},o=new XRWebGLLayer(i,e,n);i.updateRenderState({baseLayer:o}),i.requestReferenceSpace(s).then(y),i.addEventListener("inputsourceschange",x)}};const b=new Yn,_=new Yn;function w(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}this.getCamera=function(t){d.near=u.near=h.near=t.near,d.far=u.far=h.far=t.far,f===d.near&&m===d.far||(i.updateRenderState({depthNear:d.near,depthFar:d.far}),f=d.near,m=d.far);const e=t.parent,n=d.cameras;w(d,e);for(let t=0;t<n.length;t++)w(n[t],e);t.matrixWorld.copy(d.matrixWorld);const r=t.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(!0);return 2===n.length?function(t,e,n){b.setFromMatrixPosition(e.matrixWorld),_.setFromMatrixPosition(n.matrixWorld);const i=b.distanceTo(_),r=e.projectionMatrix.elements,o=n.projectionMatrix.elements,s=r[14]/(r[10]-1),a=r[14]/(r[10]+1),c=(r[9]+1)/r[5],l=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(o[8]+1)/o[0],p=s*h,d=s*u,f=i/(-h+u),m=f*-h;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);const g=s+f,v=a+f,y=p-m,x=d+(i-m),w=c*a/v*g,M=l*a/v*g;t.projectionMatrix.makePerspective(y,x,w,M,g,v)}(d,h,u):d.projectionMatrix.copy(h.projectionMatrix),d};let M=null;const S=new Oo;S.setAnimationLoop(function(e,n){if(null!==(a=n.getViewerPose(o))){const e=a.views,n=i.renderState.baseLayer;t.setFramebuffer(n.framebuffer);let r=!1;e.length!==d.cameras.length&&(d.cameras.length=0,r=!0);for(let t=0;t<e.length;t++){const i=e[t],o=n.getViewport(i),s=p[t];s.matrix.fromArray(i.transform.matrix),s.projectionMatrix.fromArray(i.projectionMatrix),s.viewport.set(o.x,o.y,o.width,o.height),0===t&&d.matrix.copy(s.matrix),!0===r&&d.cameras.push(s)}}const r=i.inputSources;for(let t=0;t<c.length;t++){const e=c[t],i=r[t];e.update(i,n,o)}M&&M(e,n)}),this.setAnimationLoop=function(t){M=t},this.dispose=function(){}}function mh(t){function e(e,n,i){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap);const r=n.envMap||i;let o,s;r&&(e.envMap.value=r,e.flipEnvMap.value=r.isCubeTexture?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio,e.maxMipLevel.value=t.get(r).__maxMipLevel),n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?o=n.map:n.specularMap?o=n.specularMap:n.displacementMap?o=n.displacementMap:n.normalMap?o=n.normalMap:n.bumpMap?o=n.bumpMap:n.roughnessMap?o=n.roughnessMap:n.metalnessMap?o=n.metalnessMap:n.alphaMap?o=n.alphaMap:n.emissiveMap&&(o=n.emissiveMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),e.uvTransform.value.copy(o.matrix)),n.aoMap?s=n.aoMap:n.lightMap&&(s=n.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uv2Transform.value.copy(s.matrix))}function n(t,e,n){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===f&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===f&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),(e.envMap||n)&&(t.envMapIntensity.value=e.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,i,r,o,s){i.isMeshBasicMaterial?e(t,i):i.isMeshLambertMaterial?(e(t,i),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,i)):i.isMeshToonMaterial?(e(t,i),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===f&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===f&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshPhongMaterial?(e(t,i),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===f&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===f&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshStandardMaterial?(e(t,i,r),i.isMeshPhysicalMaterial?function(t,e,i){n(t,e,i),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen),e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===f&&t.clearcoatNormalScale.value.negate()),t.transparency.value=e.transparency}(t,i,r):n(t,i,r)):i.isMeshMatcapMaterial?(e(t,i),function(t,e){e.matcap&&(t.matcap.value=e.matcap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===f&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===f&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshDepthMaterial?(e(t,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshDistanceMaterial?(e(t,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,i)):i.isMeshNormalMaterial?(e(t,i),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===f&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===f&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,i),i.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,i)):i.isPointsMaterial?function(t,e,n,i){let r;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*i,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?r=e.map:e.alphaMap&&(r=e.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,i,o,s):i.isSpriteMaterial?function(t,e){let n;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?n=e.map:e.alphaMap&&(n=e.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,i):i.isShadowMaterial?(t.color.value.copy(i.color),t.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function gh(t){const e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==t.context?t.context:null,i=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,o=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,c=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",h=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let u=null,p=null;this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Ze,this.physicallyCorrectLights=!1,this.toneMapping=Q,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const d=this;let f=!1,m=null,g=0,v=0,y=null,x=null,b=-1,_=null,w=null;const M=new kn,S=new kn;let T=null,E=e.width,A=e.height,L=1,R=null,P=null;const C=new kn(0,0,E,A),O=new kn(0,0,E,A);let D=!1;const I=new Po,N=new ac;let B=!1,z=!1;const U=new ni,F=new Yn,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function H(){return null===y?L:1}let k,V,j,W,q,X,Y,Z,J,K,$,tt,et,nt,it,rt,ot,st,at,ct=n;function lt(t,n){for(let i=0;i<t.length;i++){const r=t[i],o=e.getContext(r,n);if(null!==o)return o}return null}try{const t={alpha:i,depth:r,stencil:o,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:c,powerPreference:l,failIfMajorPerformanceCaveat:h};if(e.addEventListener("webglcontextlost",dt,!1),e.addEventListener("webglcontextrestored",ft,!1),null===ct){const e=["webgl2","webgl","experimental-webgl"];if(!0===d.isWebGL1Renderer&&e.shift(),null===(ct=lt(e,t)))throw lt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ct.getShaderPrecisionFormat&&(ct.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function ht(){k=new cc(ct),!1===(V=new sc(ct,k,t)).isWebGL2&&(k.get("WEBGL_depth_texture"),k.get("OES_texture_float"),k.get("OES_texture_half_float"),k.get("OES_texture_half_float_linear"),k.get("OES_standard_derivatives"),k.get("OES_element_index_uint"),k.get("OES_vertex_array_object"),k.get("ANGLE_instanced_arrays")),k.get("OES_texture_float_linear"),st=new hh(ct,k,V),(j=new ch(ct,k,V)).scissor(S.copy(O).multiplyScalar(L).floor()),j.viewport(M.copy(C).multiplyScalar(L).floor()),W=new uc(ct),q=new Wl,X=new lh(ct,k,j,q,V,st,W),Y=new Do(ct,V),at=new rc(ct,k,Y,V),Z=new lc(ct,Y,W,at),J=new mc(ct,Z,Y,W),it=new fc(ct),K=new jl(d,k,V,at),$=new mh(q),tt=new Zl,et=new nh,nt=new ic(d,j,J,a),rt=new oc(ct,k,W,V),ot=new hc(ct,k,W,V),W.programs=K.programs,d.capabilities=V,d.extensions=k,d.properties=q,d.renderLists=tt,d.state=j,d.info=W}ht();const ut=new fh(d,ct);this.xr=ut;const pt=new ah(d,J,V.maxTextureSize);function dt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),f=!0}function ft(){console.log("THREE.WebGLRenderer: Context Restored."),f=!1,ht()}function mt(t){const e=t.target;e.removeEventListener("dispose",mt),function(t){gt(t),q.remove(t)}(e)}function gt(t){const e=q.get(t).program;t.program=void 0,void 0!==e&&K.releaseProgram(e)}this.shadowMap=pt,this.getContext=function(){return ct},this.getContextAttributes=function(){return ct.getContextAttributes()},this.forceContextLoss=function(){const t=k.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=k.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(t){void 0!==t&&(L=t,this.setSize(E,A,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new Bn),t.set(E,A)},this.setSize=function(t,n,i){ut.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(E=t,A=n,e.width=Math.floor(t*L),e.height=Math.floor(n*L),!1!==i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new Bn),t.set(E*L,A*L).floor()},this.setDrawingBufferSize=function(t,n,i){E=t,A=n,L=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new kn),t.copy(M)},this.getViewport=function(t){return t.copy(C)},this.setViewport=function(t,e,n,i){t.isVector4?C.set(t.x,t.y,t.z,t.w):C.set(t,e,n,i),j.viewport(M.copy(C).multiplyScalar(L).floor())},this.getScissor=function(t){return t.copy(O)},this.setScissor=function(t,e,n,i){t.isVector4?O.set(t.x,t.y,t.z,t.w):O.set(t,e,n,i),j.scissor(S.copy(O).multiplyScalar(L).floor())},this.getScissorTest=function(){return D},this.setScissorTest=function(t){j.setScissorTest(D=t)},this.setOpaqueSort=function(t){R=t},this.setTransparentSort=function(t){P=t},this.getClearColor=function(){return nt.getClearColor()},this.setClearColor=function(){nt.setClearColor.apply(nt,arguments)},this.getClearAlpha=function(){return nt.getClearAlpha()},this.setClearAlpha=function(){nt.setClearAlpha.apply(nt,arguments)},this.clear=function(t,e,n){let i=0;(void 0===t||t)&&(i|=16384),(void 0===e||e)&&(i|=256),(void 0===n||n)&&(i|=1024),ct.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",dt,!1),e.removeEventListener("webglcontextrestored",ft,!1),tt.dispose(),et.dispose(),q.dispose(),J.dispose(),at.dispose(),ut.dispose(),yt.stop()},this.renderBufferImmediate=function(t,e){at.initAttributes();const n=q.get(t);t.hasPositions&&!n.position&&(n.position=ct.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=ct.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=ct.createBuffer()),t.hasColors&&!n.color&&(n.color=ct.createBuffer());const i=e.getAttributes();t.hasPositions&&(ct.bindBuffer(34962,n.position),ct.bufferData(34962,t.positionArray,35048),at.enableAttribute(i.position),ct.vertexAttribPointer(i.position,3,5126,!1,0,0)),t.hasNormals&&(ct.bindBuffer(34962,n.normal),ct.bufferData(34962,t.normalArray,35048),at.enableAttribute(i.normal),ct.vertexAttribPointer(i.normal,3,5126,!1,0,0)),t.hasUvs&&(ct.bindBuffer(34962,n.uv),ct.bufferData(34962,t.uvArray,35048),at.enableAttribute(i.uv),ct.vertexAttribPointer(i.uv,2,5126,!1,0,0)),t.hasColors&&(ct.bindBuffer(34962,n.color),ct.bufferData(34962,t.colorArray,35048),at.enableAttribute(i.color),ct.vertexAttribPointer(i.color,3,5126,!1,0,0)),at.disableUnusedAttributes(),ct.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,i,r,o){null===e&&(e=G);const s=r.isMesh&&r.matrixWorld.determinant()<0,a=wt(t,e,i,r);j.setMaterial(i,s);let c=n.index;const l=n.attributes.position;if(null===c){if(void 0===l||0===l.count)return}else if(0===c.count)return;let h,u=1;!0===i.wireframe&&(c=Z.getWireframeAttribute(n),u=2),(i.morphTargets||i.morphNormals)&&it.update(r,n,i,a),at.setup(r,i,a,n,c);let p=rt;null!==c&&(h=Y.get(c),(p=ot).setIndex(h));const d=null!==c?c.count:l.count,f=n.drawRange.start*u,m=n.drawRange.count*u,g=null!==o?o.start*u:0,v=null!==o?o.count*u:1/0,y=Math.max(f,g),x=Math.min(d,f+m,g+v)-1,b=Math.max(0,x-y+1);if(0!==b){if(r.isMesh)!0===i.wireframe?(j.setLineWidth(i.wireframeLinewidth*H()),p.setMode(1)):p.setMode(4);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),j.setLineWidth(t*H()),r.isLineSegments?p.setMode(1):r.isLineLoop?p.setMode(2):p.setMode(3)}else r.isPoints?p.setMode(0):r.isSprite&&p.setMode(4);if(r.isInstancedMesh)p.renderInstances(n,y,b,r.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);p.renderInstances(n,y,b,t)}else p.render(y,b)}},this.compile=function(t,e){(p=et.get(t,e)).init(),t.traverse(function(t){t.isLight&&(p.pushLight(t),t.castShadow&&p.pushShadow(t))}),p.setupLights(e);const n=new WeakMap;t.traverse(function(e){let i=e.material;if(i)if(Array.isArray(i))for(let r=0;r<i.length;r++){let o=i[r];!1===n.has(o)&&(_t(o,t,e),n.set(o))}else!1===n.has(i)&&(_t(i,t,e),n.set(i))})};let vt=null;const yt=new Oo;function xt(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let r=0,o=t.length;r<o;r++){const o=t[r],s=o.object,a=o.geometry,c=null===i?o.material:i,l=o.group;if(n.isArrayCamera){w=n;const t=n.cameras;for(let n=0,i=t.length;n<i;n++){const i=t[n];s.layers.test(i.layers)&&(j.viewport(M.copy(i.viewport)),p.setupLights(i),bt(s,e,i,a,c,l))}}else w=null,bt(s,e,n,a,c,l)}}function bt(t,e,n,i,r,o){if(t.onBeforeRender(d,e,n,i,r,o),p=et.get(e,w||n),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){const i=wt(n,e,r,t);j.setMaterial(r),at.reset(),function(t,e){t.render(function(t){d.renderBufferImmediate(t,e)})}(t,i)}else d.renderBufferDirect(n,e,i,r,t,o);t.onAfterRender(d,e,n,i,r,o),p=et.get(e,w||n)}function _t(t,e,n){!0!==e.isScene&&(e=G);const i=q.get(t),r=p.state.lights,o=p.state.shadowsArray,s=r.state.version,a=K.getParameters(t,r.state,o,e,N.numPlanes,N.numIntersection,n),c=K.getProgramCacheKey(a);let l=i.program,h=!0;if(void 0===l)t.addEventListener("dispose",mt);else if(l.cacheKey!==c)gt(t);else if(i.lightsStateVersion!==s)i.lightsStateVersion=s,h=!1;else{if(void 0!==a.shaderID)return;h=!1}h&&(l=K.acquireProgram(a,c),i.program=l,i.uniforms=a.uniforms,i.outputEncoding=a.outputEncoding,t.program=l);const u=l.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(let e=0;e<d.maxMorphTargets;e++)u["morphTarget"+e]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(let e=0;e<d.maxMorphNormals;e++)u["morphNormal"+e]>=0&&t.numSupportedMorphNormals++}const f=i.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(i.numClippingPlanes=N.numPlanes,i.numIntersection=N.numIntersection,f.clippingPlanes=N.uniform),i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=s,i.needsLights&&(f.ambientLightColor.value=r.state.ambient,f.lightProbe.value=r.state.probe,f.directionalLights.value=r.state.directional,f.directionalLightShadows.value=r.state.directionalShadow,f.spotLights.value=r.state.spot,f.spotLightShadows.value=r.state.spotShadow,f.rectAreaLights.value=r.state.rectArea,f.pointLights.value=r.state.point,f.pointLightShadows.value=r.state.pointShadow,f.hemisphereLights.value=r.state.hemi,f.directionalShadowMap.value=r.state.directionalShadowMap,f.directionalShadowMatrix.value=r.state.directionalShadowMatrix,f.spotShadowMap.value=r.state.spotShadowMap,f.spotShadowMatrix.value=r.state.spotShadowMatrix,f.pointShadowMap.value=r.state.pointShadowMap,f.pointShadowMatrix.value=r.state.pointShadowMatrix);const m=i.program.getUniforms(),g=ml.seqWithValue(m.seq,f);i.uniformsList=g}function wt(t,e,n,i){!0!==e.isScene&&(e=G),X.resetTextureUnits();const r=e.fog,o=n.isMeshStandardMaterial?e.environment:null,s=null===y?d.outputEncoding:y.texture.encoding,a=q.get(n),c=p.state.lights;if(!0===B&&(!0===z||t!==_)){const e=t===_&&n.id===b;N.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,t,a,e)}n.version===a.__version?void 0===a.program?_t(n,e,i):n.fog&&a.fog!==r?_t(n,e,i):a.environment!==o?_t(n,e,i):a.needsLights&&a.lightsStateVersion!==c.state.version?_t(n,e,i):void 0===a.numClippingPlanes||a.numClippingPlanes===N.numPlanes&&a.numIntersection===N.numIntersection?a.outputEncoding!==s&&_t(n,e,i):_t(n,e,i):(_t(n,e,i),a.__version=n.version);let l=!1,h=!1,u=!1;const f=a.program,m=f.getUniforms(),g=a.uniforms;if(j.useProgram(f.program)&&(l=!0,h=!0,u=!0),n.id!==b&&(b=n.id,h=!0),l||_!==t){if(m.setValue(ct,"projectionMatrix",t.projectionMatrix),V.logarithmicDepthBuffer&&m.setValue(ct,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),_!==t&&(_=t,h=!0,u=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=m.map.cameraPosition;void 0!==e&&e.setValue(ct,F.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&m.setValue(ct,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&m.setValue(ct,"viewMatrix",t.matrixWorldInverse)}if(n.skinning){m.setOptional(ct,i,"bindMatrix"),m.setOptional(ct,i,"bindMatrixInverse");const t=i.skeleton;if(t){const e=t.bones;if(V.floatVertexTextures){if(void 0===t.boneTexture){let n=Math.sqrt(4*e.length);n=Nn.ceilPowerOfTwo(n),n=Math.max(n,4);const i=new Float32Array(n*n*4);i.set(t.boneMatrices);const r=new Ao(i,n,n,zt,Rt);t.boneMatrices=i,t.boneTexture=r,t.boneTextureSize=n}m.setValue(ct,"boneTexture",t.boneTexture,X),m.setValue(ct,"boneTextureSize",t.boneTextureSize)}else m.setOptional(ct,t,"boneMatrices")}}var v,x;return(h||a.receiveShadow!==i.receiveShadow)&&(a.receiveShadow=i.receiveShadow,m.setValue(ct,"receiveShadow",i.receiveShadow)),h&&(m.setValue(ct,"toneMappingExposure",d.toneMappingExposure),a.needsLights&&(x=u,(v=g).ambientLightColor.needsUpdate=x,v.lightProbe.needsUpdate=x,v.directionalLights.needsUpdate=x,v.directionalLightShadows.needsUpdate=x,v.pointLights.needsUpdate=x,v.pointLightShadows.needsUpdate=x,v.spotLights.needsUpdate=x,v.spotLightShadows.needsUpdate=x,v.rectAreaLights.needsUpdate=x,v.hemisphereLights.needsUpdate=x),r&&n.fog&&$.refreshFogUniforms(g,r),$.refreshMaterialUniforms(g,n,o,L,A),void 0!==g.ltc_1&&(g.ltc_1.value=Co.LTC_1),void 0!==g.ltc_2&&(g.ltc_2.value=Co.LTC_2),ml.upload(ct,a.uniformsList,g,X)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(ml.upload(ct,a.uniformsList,g,X),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&m.setValue(ct,"center",i.center),m.setValue(ct,"modelViewMatrix",i.modelViewMatrix),m.setValue(ct,"normalMatrix",i.normalMatrix),m.setValue(ct,"modelMatrix",i.matrixWorld),f}yt.setAnimationLoop(function(t){ut.isPresenting||vt&&vt(t)}),"undefined"!=typeof window&&yt.setContext(window),this.setAnimationLoop=function(t){vt=t,ut.setAnimationLoop(t),null===t?yt.stop():yt.start()},this.render=function(t,e){let n,i;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===f)return;at.resetDefaultState(),b=-1,_=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===ut.enabled&&!0===ut.isPresenting&&(e=ut.getCamera(e)),!0===t.isScene&&t.onBeforeRender(d,t,e,n||y),(p=et.get(t,e)).init(),U.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),I.setFromProjectionMatrix(U),z=this.localClippingEnabled,B=N.init(this.clippingPlanes,z,e),(u=tt.get(t,e)).init(),function t(e,n,i,r){if(!1===e.visible)return;const o=e.layers.test(n.layers);if(o)if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(n);else if(e.isLight)p.pushLight(e),e.castShadow&&p.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||I.intersectsSprite(e)){r&&F.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U);const t=J.update(e),n=e.material;n.visible&&u.push(e,t,n,i,F.z,null)}}else if(e.isImmediateRenderObject)r&&F.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U),u.push(e,null,e.material,i,F.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==W.render.frame&&(e.skeleton.update(),e.skeleton.frame=W.render.frame),!e.frustumCulled||I.intersectsObject(e))){r&&F.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U);const t=J.update(e),n=e.material;if(Array.isArray(n)){const r=t.groups;for(let o=0,s=r.length;o<s;o++){const s=r[o],a=n[s.materialIndex];a&&a.visible&&u.push(e,t,a,i,F.z,s)}}else n.visible&&u.push(e,t,n,i,F.z,null)}const s=e.children;for(let e=0,o=s.length;e<o;e++)t(s[e],n,i,r)}(t,e,0,d.sortObjects),u.finish(),!0===d.sortObjects&&u.sort(R,P),!0===B&&N.beginShadows();const r=p.state.shadowsArray;pt.render(r,t,e),p.setupLights(e),!0===B&&N.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),nt.render(u,t,e,i);const o=u.opaque,s=u.transparent;o.length>0&&xt(o,t,e),s.length>0&&xt(s,t,e),!0===t.isScene&&t.onAfterRender(d,t,e),null!==y&&(X.updateRenderTargetMipmap(y),X.updateMultisampleRenderTarget(y)),j.buffers.depth.setTest(!0),j.buffers.depth.setMask(!0),j.buffers.color.setMask(!0),j.setPolygonOffset(!1),u=null,p=null},this.setFramebuffer=function(t){m!==t&&null===y&&ct.bindFramebuffer(36160,t),m=t},this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return v},this.getRenderTarget=function(){return y},this.setRenderTarget=function(t,e,n){y=t,g=e,v=n,t&&void 0===q.get(t).__webglFramebuffer&&X.setupRenderTarget(t);let i=m,r=!1;if(t){const n=q.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(i=n[e||0],r=!0):i=t.isWebGLMultisampleRenderTarget?q.get(t).__webglMultisampledFramebuffer:n,M.copy(t.viewport),S.copy(t.scissor),T=t.scissorTest}else M.copy(C).multiplyScalar(L).floor(),S.copy(O).multiplyScalar(L).floor(),T=D;if(x!==i&&(ct.bindFramebuffer(36160,i),x=i),j.viewport(M),j.scissor(S),j.setScissorTest(T),r){const i=q.get(t.texture);ct.framebufferTexture2D(36160,36064,34069+(e||0),i.__webglTexture,n||0)}},this.readRenderTargetPixels=function(t,e,n,i,r,o,s){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=q.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){let s=!1;a!==x&&(ct.bindFramebuffer(36160,a),s=!0);try{const a=t.texture,c=a.format,l=a.type;if(c!==zt&&st.convert(c)!==ct.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(l===Mt||st.convert(l)===ct.getParameter(35738)||l===Rt&&(V.isWebGL2||k.get("OES_texture_float")||k.get("WEBGL_color_buffer_float"))||l===Pt&&(V.isWebGL2?k.get("EXT_color_buffer_float"):k.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ct.checkFramebufferStatus(36160)?e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&ct.readPixels(e,n,i,r,st.convert(c),st.convert(l),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&ct.bindFramebuffer(36160,x)}}},this.copyFramebufferToTexture=function(t,e,n){void 0===n&&(n=0);const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),o=Math.floor(e.image.height*i),s=st.convert(e.format);X.setTexture2D(e,0),ct.copyTexImage2D(3553,n,s,t.x,t.y,r,o,0),j.unbindTexture()},this.copyTextureToTexture=function(t,e,n,i){void 0===i&&(i=0);const r=e.image.width,o=e.image.height,s=st.convert(n.format),a=st.convert(n.type);X.setTexture2D(n,0),ct.pixelStorei(37440,n.flipY),ct.pixelStorei(37441,n.premultiplyAlpha),ct.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?ct.texSubImage2D(3553,i,t.x,t.y,r,o,s,a,e.image.data):e.isCompressedTexture?ct.compressedTexSubImage2D(3553,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,s,e.mipmaps[0].data):ct.texSubImage2D(3553,i,t.x,t.y,s,a,e.image),0===i&&n.generateMipmaps&&ct.generateMipmap(3553),j.unbindTexture()},this.initTexture=function(t){X.setTexture2D(t,0),j.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function vh(t){gh.call(this,t)}function yh(t,e){this.name="",this.color=new ur(t),this.density=void 0!==e?e:25e-5}function xh(t,e,n){this.name="",this.color=new ur(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3}function bh(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Sn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Nn.generateUUID()}uh.prototype=Object.assign(Object.create(wo.prototype),{constructor:uh,isArrayCamera:!0}),ph.prototype=Object.assign(Object.create(bi.prototype),{constructor:ph,isGroup:!0}),Object.assign(dh.prototype,{constructor:dh,getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new ph,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new ph,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),this},update:function(t,e,n){let i=null,r=null;const o=this._targetRay,s=this._grip;return t&&(null!==o&&null!==(i=e.getPose(t.targetRaySpace,n))&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale)),null!==s&&t.gripSpace&&null!==(r=e.getPose(t.gripSpace,n))&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale))),null!==o&&(o.visible=null!==i),null!==s&&(s.visible=null!==r),this}}),Object.assign(fh.prototype,Dn.prototype),vh.prototype=Object.assign(Object.create(gh.prototype),{constructor:vh,isWebGL1Renderer:!0}),Object.assign(yh.prototype,{isFogExp2:!0,clone:function(){return new yh(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(xh.prototype,{isFog:!0,clone:function(){return new xh(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(bh.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(bh.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Nn.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new bh(new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),this.stride);return e.setUsage(this.usage),e},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Nn.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const _h=new Yn;function wh(t,e,n,i){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===i}function Mh(t){vr.call(this),this.type="SpriteMaterial",this.color=new ur(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}let Sh;Object.defineProperties(wh.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(wh.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(let e=0,n=this.data.count;e<n;e++)_h.x=this.getX(e),_h.y=this.getY(e),_h.z=this.getZ(e),_h.applyMatrix4(t),this.setXYZ(e,_h.x,_h.y,_h.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this},setXYZW:function(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this},clone:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new _r(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new wh(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),Mh.prototype=Object.create(vr.prototype),Mh.prototype.constructor=Mh,Mh.prototype.isSpriteMaterial=!0,Mh.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};const Th=new Yn,Eh=new Yn,Ah=new Yn,Lh=new Bn,Rh=new Bn,Ph=new ni,Ch=new Yn,Oh=new Yn,Dh=new Yn,Ih=new Bn,Nh=new Bn,Bh=new Bn;function zh(t){if(bi.call(this),this.type="Sprite",void 0===Sh){Sh=new Gr;const t=new bh(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Sh.setIndex([0,1,2,0,2,3]),Sh.setAttribute("position",new wh(t,3,0,!1)),Sh.setAttribute("uv",new wh(t,2,3,!1))}this.geometry=Sh,this.material=void 0!==t?t:new Mh,this.center=new Bn(.5,.5)}function Uh(t,e,n,i,r,o){Lh.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(Rh.x=o*Lh.x-r*Lh.y,Rh.y=r*Lh.x+o*Lh.y):Rh.copy(Lh),t.copy(e),t.x+=Rh.x,t.y+=Rh.y,t.applyMatrix4(Ph)}zh.prototype=Object.assign(Object.create(bi.prototype),{constructor:zh,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Eh.setFromMatrixScale(this.matrixWorld),Ph.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Ah.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Eh.multiplyScalar(-Ah.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const o=this.center;Uh(Ch.set(-.5,-.5,0),Ah,o,Eh,i,r),Uh(Oh.set(.5,-.5,0),Ah,o,Eh,i,r),Uh(Dh.set(.5,.5,0),Ah,o,Eh,i,r),Ih.set(0,0),Nh.set(1,0),Bh.set(1,1);let s=t.ray.intersectTriangle(Ch,Oh,Dh,!1,Th);if(null===s&&(Uh(Oh.set(-.5,.5,0),Ah,o,Eh,i,r),Nh.set(0,1),null===(s=t.ray.intersectTriangle(Ch,Dh,Oh,!1,Th))))return;const a=t.ray.origin.distanceTo(Th);a<t.near||a>t.far||e.push({distance:a,point:Th.clone(),uv:ar.getUV(Th,Ch,Oh,Dh,Ih,Nh,Bh,new Bn),face:null,object:this})},copy:function(t){return bi.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}});const Fh=new Yn,Gh=new Yn;function Hh(){bi.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function kh(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),ro.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ni,this.bindMatrixInverse=new ni}Hh.prototype=Object.assign(Object.create(bi.prototype),{constructor:Hh,isLOD:!0,copy:function(t){bi.prototype.copy.call(this,t,!1);const e=t.levels;for(let t=0,n=e.length;t<n;t++){const n=e[t];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);const n=this.levels;let i;for(i=0;i<n.length&&!(e<n[i].distance);i++);return n.splice(i,0,{distance:e,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){const e=this.levels;if(e.length>0){let n,i;for(n=1,i=e.length;n<i&&!(t<e[n].distance);n++);return e[n-1].object}return null},raycast:function(t,e){if(this.levels.length>0){Fh.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(Fh);this.getObjectForDistance(n).raycast(t,e)}},update:function(t){const e=this.levels;if(e.length>1){Fh.setFromMatrixPosition(t.matrixWorld),Gh.setFromMatrixPosition(this.matrixWorld);const n=Fh.distanceTo(Gh)/t.zoom;let i,r;for(e[0].object.visible=!0,i=1,r=e.length;i<r&&n>=e[i].distance;i++)e[i-1].object.visible=!1,e[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)e[i].object.visible=!1}},toJSON:function(t){const e=bi.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let t=0,i=n.length;t<i;t++){const i=n[t];e.object.levels.push({object:i.object.uuid,distance:i.distance})}return e}}),kh.prototype=Object.assign(Object.create(ro.prototype),{constructor:kh,isSkinnedMesh:!0,copy:function(t){return ro.prototype.copy.call(this,t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const t=new kn,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){ro.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(){const t=new Yn,e=new kn,n=new kn,i=new Yn,r=new ni;return function(o,s){const a=this.skeleton,c=this.geometry;e.fromBufferAttribute(c.attributes.skinIndex,o),n.fromBufferAttribute(c.attributes.skinWeight,o),t.fromBufferAttribute(c.attributes.position,o).applyMatrix4(this.bindMatrix),s.set(0,0,0);for(let o=0;o<4;o++){const c=n.getComponent(o);if(0!==c){const n=e.getComponent(o);r.multiplyMatrices(a.bones[n].matrixWorld,a.boneInverses[n]),s.addScaledVector(i.copy(t).applyMatrix4(r),c)}}return s.applyMatrix4(this.bindMatrixInverse)}}()});const Vh=new ni,jh=new ni;function Wh(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new ni)}}function qh(){bi.call(this),this.type="Bone"}Object.assign(Wh.prototype,{calculateInverses:function(){this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++){const e=new ni;this.bones[t]&&e.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(e)}},pose:function(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.getInverse(this.boneInverses[t])}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}},update:function(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,r=t.length;i<r;i++){const r=t[i]?t[i].matrixWorld:jh;Vh.multiplyMatrices(r,e[i]),Vh.toArray(n,16*i)}void 0!==i&&(i.needsUpdate=!0)},clone:function(){return new Wh(this.bones,this.boneInverses)},getBoneByName:function(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),qh.prototype=Object.assign(Object.create(bi.prototype),{constructor:qh,isBone:!0});const Xh=new ni,Yh=new ni,Zh=[],Jh=new ro;function Qh(t,e,n){ro.call(this,t,e),this.instanceMatrix=new _r(new Float32Array(16*n),16),this.count=n,this.frustumCulled=!1}function Kh(t){vr.call(this),this.type="LineBasicMaterial",this.color=new ur(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}Qh.prototype=Object.assign(Object.create(ro.prototype),{constructor:Qh,isInstancedMesh:!0,copy:function(t){return ro.prototype.copy.call(this,t),this.instanceMatrix.copy(t.instanceMatrix),this.count=t.count,this},getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){const n=this.matrixWorld,i=this.count;if(Jh.geometry=this.geometry,Jh.material=this.material,void 0!==Jh.material)for(let r=0;r<i;r++){this.getMatrixAt(r,Xh),Yh.multiplyMatrices(n,Xh),Jh.matrixWorld=Yh,Jh.raycast(t,Zh);for(let t=0,n=Zh.length;t<n;t++){const n=Zh[t];n.instanceId=r,n.object=this,e.push(n)}Zh.length=0}},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),Kh.prototype=Object.create(vr.prototype),Kh.prototype.constructor=Kh,Kh.prototype.isLineBasicMaterial=!0,Kh.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};const $h=new Yn,tu=new Yn,eu=new ni,nu=new qi,iu=new Ui;function ru(t,e,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),bi.call(this),this.type="Line",this.geometry=void 0!==t?t:new Gr,this.material=void 0!==e?e:new Kh,this.updateMorphTargets()}ru.prototype=Object.assign(Object.create(bi.prototype),{constructor:ru,isLine:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)$h.fromBufferAttribute(e,t-1),tu.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=$h.distanceTo(tu);t.setAttribute("lineDistance",new Rr(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,n=t.lineDistances;n[0]=0;for(let t=1,i=e.length;t<i;t++)n[t]=n[t-1],n[t]+=e[t-1].distanceTo(e[t])}return this},raycast:function(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),iu.copy(n.boundingSphere),iu.applyMatrix4(i),iu.radius+=r,!1===t.ray.intersectsSphere(iu))return;eu.getInverse(i),nu.copy(t.ray).applyMatrix4(eu);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,a=new Yn,c=new Yn,l=new Yn,h=new Yn,u=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,r=n.attributes.position.array;if(null!==i){const n=i.array;for(let i=0,o=n.length-1;i<o;i+=u){const o=n[i],u=n[i+1];if(a.fromArray(r,3*o),c.fromArray(r,3*u),nu.distanceSqToSegment(a,c,h,l)>s)continue;h.applyMatrix4(this.matrixWorld);const p=t.ray.origin.distanceTo(h);p<t.near||p>t.far||e.push({distance:p,point:l.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else for(let n=0,i=r.length/3-1;n<i;n+=u){if(a.fromArray(r,3*n),c.fromArray(r,3*n+3),nu.distanceSqToSegment(a,c,h,l)>s)continue;h.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(h);i<t.near||i>t.far||e.push({distance:i,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else if(n.isGeometry){const i=n.vertices,r=i.length;for(let n=0;n<r-1;n+=u){if(nu.distanceSqToSegment(i[n],i[n+1],h,l)>s)continue;h.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(h);r<t.near||r>t.far||e.push({distance:r,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const ou=new Yn,su=new Yn;function au(t,e){ru.call(this,t,e),this.type="LineSegments"}function cu(t,e){ru.call(this,t,e),this.type="LineLoop"}function lu(t){vr.call(this),this.type="PointsMaterial",this.color=new ur(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}au.prototype=Object.assign(Object.create(ru.prototype),{constructor:au,isLineSegments:!0,computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)ou.fromBufferAttribute(e,t),su.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+ou.distanceTo(su);t.setAttribute("lineDistance",new Rr(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,n=t.lineDistances;for(let t=0,i=e.length;t<i;t+=2)ou.copy(e[t]),su.copy(e[t+1]),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+ou.distanceTo(su)}return this}}),cu.prototype=Object.assign(Object.create(ru.prototype),{constructor:cu,isLineLoop:!0}),lu.prototype=Object.create(vr.prototype),lu.prototype.constructor=lu,lu.prototype.isPointsMaterial=!0,lu.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};const hu=new ni,uu=new qi,pu=new Ui,du=new Yn;function fu(t,e){bi.call(this),this.type="Points",this.geometry=void 0!==t?t:new Gr,this.material=void 0!==e?e:new lu,this.updateMorphTargets()}function mu(t,e,n,i,r,o,s){const a=uu.distanceSqToPoint(t);if(a<n){const n=new Yn;uu.closestPointToPoint(t,n),n.applyMatrix4(i);const c=r.ray.origin.distanceTo(n);if(c<r.near||c>r.far)return;o.push({distance:c,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:s})}}function gu(t,e,n,i,r,o,s,a,c){Hn.call(this,t,e,n,i,r,o,s,a,c),this.format=void 0!==s?s:Bt,this.minFilter=void 0!==o?o:yt,this.magFilter=void 0!==r?r:yt,this.generateMipmaps=!1}function vu(t,e,n,i,r,o,s,a,c,l,h,u){Hn.call(this,null,o,s,a,c,l,i,r,h,u),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function yu(t,e,n,i,r,o,s,a,c){Hn.call(this,t,e,n,i,r,o,s,a,c),this.needsUpdate=!0}function xu(t,e,n,i,r,o,s,a,c,l){if((l=void 0!==l?l:Ht)!==Ht&&l!==kt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&l===Ht&&(n=Et),void 0===n&&l===kt&&(n=It),Hn.call(this,null,i,r,o,s,a,l,n,c),this.image={width:t,height:e},this.magFilter=void 0!==s?s:dt,this.minFilter=void 0!==a?a:dt,this.flipY=!1,this.generateMipmaps=!1}function bu(t){Gr.call(this),this.type="WireframeGeometry";const e=[],n=[0,0],i={},r=["a","b","c"];if(t&&t.isGeometry){const o=t.faces;for(let t=0,e=o.length;t<e;t++){const e=o[t];for(let t=0;t<3;t++){const o=e[r[t]],s=e[r[(t+1)%3]];n[0]=Math.min(o,s),n[1]=Math.max(o,s);const a=n[0]+","+n[1];void 0===i[a]&&(i[a]={index1:n[0],index2:n[1]})}}for(const n in i){const r=i[n];let o=t.vertices[r.index1];e.push(o.x,o.y,o.z),o=t.vertices[r.index2],e.push(o.x,o.y,o.z)}}else if(t&&t.isBufferGeometry){let r=new Yn;if(null!==t.index){const o=t.attributes.position,s=t.index;let a=t.groups;0===a.length&&(a=[{start:0,count:s.count,materialIndex:0}]);for(let t=0,e=a.length;t<e;++t){const e=a[t],r=e.start;for(let t=r,o=r+e.count;t<o;t+=3)for(let e=0;e<3;e++){const r=s.getX(t+e),o=s.getX(t+(e+1)%3);n[0]=Math.min(r,o),n[1]=Math.max(r,o);const a=n[0]+","+n[1];void 0===i[a]&&(i[a]={index1:n[0],index2:n[1]})}}for(const t in i){const n=i[t];r.fromBufferAttribute(o,n.index1),e.push(r.x,r.y,r.z),r.fromBufferAttribute(o,n.index2),e.push(r.x,r.y,r.z)}}else{const n=t.attributes.position;for(let t=0,i=n.count/3;t<i;t++)for(let i=0;i<3;i++){const o=3*t+i;r.fromBufferAttribute(n,o),e.push(r.x,r.y,r.z);const s=3*t+(i+1)%3;r.fromBufferAttribute(n,s),e.push(r.x,r.y,r.z)}}}this.setAttribute("position",new Rr(e,3))}function _u(t,e,n){uo.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n},this.fromBufferGeometry(new wu(t,e,n)),this.mergeVertices()}function wu(t,e,n){Gr.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:n};const i=[],r=[],o=[],s=[],a=new Yn,c=new Yn,l=new Yn,h=new Yn,u=new Yn;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=e+1;for(let i=0;i<=n;i++){const p=i/n;for(let n=0;n<=e;n++){const i=n/e;t(i,p,c),r.push(c.x,c.y,c.z),i-1e-5>=0?(t(i-1e-5,p,l),h.subVectors(c,l)):(t(i+1e-5,p,l),h.subVectors(l,c)),p-1e-5>=0?(t(i,p-1e-5,l),u.subVectors(c,l)):(t(i,p+1e-5,l),u.subVectors(l,c)),a.crossVectors(h,u).normalize(),o.push(a.x,a.y,a.z),s.push(i,p)}}for(let t=0;t<n;t++)for(let n=0;n<e;n++){const e=t*p+n,r=t*p+n+1,o=(t+1)*p+n+1,s=(t+1)*p+n;i.push(e,r,s),i.push(r,o,s)}this.setIndex(i),this.setAttribute("position",new Rr(r,3)),this.setAttribute("normal",new Rr(o,3)),this.setAttribute("uv",new Rr(s,2))}function Mu(t,e,n,i){uo.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i},this.fromBufferGeometry(new Su(t,e,n,i)),this.mergeVertices()}function Su(t,e,n,i){Gr.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i},n=n||1;const r=[],o=[];function s(t,e,n,i){const r=Math.pow(2,i),o=[];for(let i=0;i<=r;i++){o[i]=[];const s=t.clone().lerp(n,i/r),a=e.clone().lerp(n,i/r),c=r-i;for(let t=0;t<=c;t++)o[i][t]=0===t&&i===r?s:s.clone().lerp(a,t/c)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const n=Math.floor(e/2);e%2==0?(a(o[t][n+1]),a(o[t+1][n]),a(o[t][n])):(a(o[t][n+1]),a(o[t+1][n+1]),a(o[t+1][n]))}}function a(t){r.push(t.x,t.y,t.z)}function c(e,n){const i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2]}function l(t,e,n,i){i<0&&1===t.x&&(o[e]=t.x-1),0===n.x&&0===n.z&&(o[e]=i/2/Math.PI+.5)}function h(t){return Math.atan2(t.z,-t.x)}!function(t){const n=new Yn,i=new Yn,r=new Yn;for(let o=0;o<e.length;o+=3)c(e[o+0],n),c(e[o+1],i),c(e[o+2],r),s(n,i,r,t)}(i=i||0),function(t){const e=new Yn;for(let n=0;n<r.length;n+=3)e.x=r[n+0],e.y=r[n+1],e.z=r[n+2],e.normalize().multiplyScalar(t),r[n+0]=e.x,r[n+1]=e.y,r[n+2]=e.z}(n),function(){const t=new Yn;for(let n=0;n<r.length;n+=3){t.x=r[n+0],t.y=r[n+1],t.z=r[n+2];const i=h(t)/2/Math.PI+.5,s=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);o.push(i,1-s)}var e;(function(){const t=new Yn,e=new Yn,n=new Yn,i=new Yn,s=new Bn,a=new Bn,c=new Bn;for(let u=0,p=0;u<r.length;u+=9,p+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),n.set(r[u+6],r[u+7],r[u+8]),s.set(o[p+0],o[p+1]),a.set(o[p+2],o[p+3]),c.set(o[p+4],o[p+5]),i.copy(t).add(e).add(n).divideScalar(3);const d=h(i);l(s,p+0,t,d),l(a,p+2,e,d),l(c,p+4,n,d)}})(),function(){for(let t=0;t<o.length;t+=6){const e=o[t+0],n=o[t+2],i=o[t+4],r=Math.max(e,n,i),s=Math.min(e,n,i);r>.9&&s<.1&&(e<.2&&(o[t+0]+=1),n<.2&&(o[t+2]+=1),i<.2&&(o[t+4]+=1))}}()}(),this.setAttribute("position",new Rr(r,3)),this.setAttribute("normal",new Rr(r.slice(),3)),this.setAttribute("uv",new Rr(o,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}function Tu(t,e){uo.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Eu(t,e)),this.mergeVertices()}function Eu(t,e){Su.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Au(t,e){uo.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Lu(t,e)),this.mergeVertices()}function Lu(t,e){Su.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Ru(t,e){uo.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Pu(t,e)),this.mergeVertices()}function Pu(t,e){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];Su.call(this,i,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Cu(t,e){uo.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ou(t,e)),this.mergeVertices()}function Ou(t,e){const n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i];Su.call(this,r,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Du(t,e,n,i,r,o){uo.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");const s=new Iu(t,e,n,i,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}function Iu(t,e,n,i,r){Gr.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r},e=e||64,n=n||1,i=i||8,r=r||!1;const o=t.computeFrenetFrames(e,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const s=new Yn,a=new Yn,c=new Bn;let l=new Yn;const h=[],u=[],p=[],d=[];function f(r){l=t.getPointAt(r/e,l);const c=o.normals[r],p=o.binormals[r];for(let t=0;t<=i;t++){const e=t/i*Math.PI*2,r=Math.sin(e),o=-Math.cos(e);a.x=o*c.x+r*p.x,a.y=o*c.y+r*p.y,a.z=o*c.z+r*p.z,a.normalize(),u.push(a.x,a.y,a.z),s.x=l.x+n*a.x,s.y=l.y+n*a.y,s.z=l.z+n*a.z,h.push(s.x,s.y,s.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=i;n++)c.x=t/e,c.y=n/i,p.push(c.x,c.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),o=(i+1)*t+e,s=(i+1)*(t-1)+e;d.push(n,r,s),d.push(r,o,s)}}()}(),this.setIndex(d),this.setAttribute("position",new Rr(h,3)),this.setAttribute("normal",new Rr(u,3)),this.setAttribute("uv",new Rr(p,2))}function Nu(t,e,n,i,r,o,s){uo.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:o},void 0!==s&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Bu(t,e,n,i,r,o)),this.mergeVertices()}function Bu(t,e,n,i,r,o){Gr.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:o},t=t||1,e=e||.4,n=Math.floor(n)||64,i=Math.floor(i)||8,r=r||2,o=o||3;const s=[],a=[],c=[],l=[],h=new Yn,u=new Yn,p=new Yn,d=new Yn,f=new Yn,m=new Yn,g=new Yn;for(let s=0;s<=n;++s){const y=s/n*r*Math.PI*2;v(y,r,o,t,p),v(y+.01,r,o,t,d),m.subVectors(d,p),g.addVectors(d,p),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=i;++t){const r=t/i*Math.PI*2,o=-e*Math.cos(r),d=e*Math.sin(r);h.x=p.x+(o*g.x+d*f.x),h.y=p.y+(o*g.y+d*f.y),h.z=p.z+(o*g.z+d*f.z),a.push(h.x,h.y,h.z),u.subVectors(h,p).normalize(),c.push(u.x,u.y,u.z),l.push(s/n),l.push(t/i)}}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),o=(i+1)*t+e,a=(i+1)*(t-1)+e;s.push(n,r,a),s.push(r,o,a)}function v(t,e,n,i,r){const o=Math.cos(t),s=Math.sin(t),a=n/e*t,c=Math.cos(a);r.x=i*(2+c)*.5*o,r.y=i*(2+c)*s*.5,r.z=i*Math.sin(a)*.5}this.setIndex(s),this.setAttribute("position",new Rr(a,3)),this.setAttribute("normal",new Rr(c,3)),this.setAttribute("uv",new Rr(l,2))}function zu(t,e,n,i,r){uo.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},this.fromBufferGeometry(new Uu(t,e,n,i,r)),this.mergeVertices()}function Uu(t,e,n,i,r){Gr.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},t=t||1,e=e||.4,n=Math.floor(n)||8,i=Math.floor(i)||6,r=r||2*Math.PI;const o=[],s=[],a=[],c=[],l=new Yn,h=new Yn,u=new Yn;for(let o=0;o<=n;o++)for(let p=0;p<=i;p++){const d=p/i*r,f=o/n*Math.PI*2;h.x=(t+e*Math.cos(f))*Math.cos(d),h.y=(t+e*Math.cos(f))*Math.sin(d),h.z=e*Math.sin(f),s.push(h.x,h.y,h.z),l.x=t*Math.cos(d),l.y=t*Math.sin(d),u.subVectors(h,l).normalize(),a.push(u.x,u.y,u.z),c.push(p/i),c.push(o/n)}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){const n=(i+1)*t+e-1,r=(i+1)*(t-1)+e-1,s=(i+1)*(t-1)+e,a=(i+1)*t+e;o.push(n,r,a),o.push(r,s,a)}this.setIndex(o),this.setAttribute("position",new Rr(s,3)),this.setAttribute("normal",new Rr(a,3)),this.setAttribute("uv",new Rr(c,2))}fu.prototype=Object.assign(Object.create(bi.prototype),{constructor:fu,isPoints:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),pu.copy(n.boundingSphere),pu.applyMatrix4(i),pu.radius+=r,!1===t.ray.intersectsSphere(pu))return;hu.getInverse(i),uu.copy(t.ray).applyMatrix4(hu);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(n.isBufferGeometry){const r=n.index,o=n.attributes.position.array;if(null!==r){const n=r.array;for(let r=0,a=n.length;r<a;r++){const a=n[r];du.fromArray(o,3*a),mu(du,a,s,i,t,e,this)}}else for(let n=0,r=o.length/3;n<r;n++)du.fromArray(o,3*n),mu(du,n,s,i,t,e,this)}else{const r=n.vertices;for(let n=0,o=r.length;n<o;n++)mu(r[n],n,s,i,t,e,this)}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),gu.prototype=Object.assign(Object.create(Hn.prototype),{constructor:gu,isVideoTexture:!0,update:function(){const t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),vu.prototype=Object.create(Hn.prototype),vu.prototype.constructor=vu,vu.prototype.isCompressedTexture=!0,yu.prototype=Object.create(Hn.prototype),yu.prototype.constructor=yu,yu.prototype.isCanvasTexture=!0,xu.prototype=Object.create(Hn.prototype),xu.prototype.constructor=xu,xu.prototype.isDepthTexture=!0,bu.prototype=Object.create(Gr.prototype),bu.prototype.constructor=bu,_u.prototype=Object.create(uo.prototype),_u.prototype.constructor=_u,wu.prototype=Object.create(Gr.prototype),wu.prototype.constructor=wu,Mu.prototype=Object.create(uo.prototype),Mu.prototype.constructor=Mu,Su.prototype=Object.create(Gr.prototype),Su.prototype.constructor=Su,Tu.prototype=Object.create(uo.prototype),Tu.prototype.constructor=Tu,Eu.prototype=Object.create(Su.prototype),Eu.prototype.constructor=Eu,Au.prototype=Object.create(uo.prototype),Au.prototype.constructor=Au,Lu.prototype=Object.create(Su.prototype),Lu.prototype.constructor=Lu,Ru.prototype=Object.create(uo.prototype),Ru.prototype.constructor=Ru,Pu.prototype=Object.create(Su.prototype),Pu.prototype.constructor=Pu,Cu.prototype=Object.create(uo.prototype),Cu.prototype.constructor=Cu,Ou.prototype=Object.create(Su.prototype),Ou.prototype.constructor=Ou,Du.prototype=Object.create(uo.prototype),Du.prototype.constructor=Du,Iu.prototype=Object.create(Gr.prototype),Iu.prototype.constructor=Iu,Iu.prototype.toJSON=function(){const t=Gr.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},Nu.prototype=Object.create(uo.prototype),Nu.prototype.constructor=Nu,Bu.prototype=Object.create(Gr.prototype),Bu.prototype.constructor=Bu,zu.prototype=Object.create(uo.prototype),zu.prototype.constructor=zu,Uu.prototype=Object.create(Gr.prototype),Uu.prototype.constructor=Uu;const Fu={triangulate:function(t,e,n){n=n||2;let i,r,o,s,a,c,l,h=e&&e.length,u=h?e[0]*n:t.length,p=Gu(t,0,u,n,!0),d=[];if(!p||p.next===p.prev)return d;if(h&&(p=Xu(t,e,p,n)),t.length>80*n){i=o=t[0],r=s=t[1];for(let e=n;e<u;e+=n)(a=t[e])<i&&(i=a),(c=t[e+1])<r&&(r=c),a>o&&(o=a),c>s&&(s=c);l=0!==(l=Math.max(o-i,s-r))?1/l:0}return ku(p,d,n,i,r,l),d}};function Gu(t,e,n,i,r){let o,s;if(r===gp(t,e,n,i)>0)for(o=e;o<n;o+=i)s=dp(o,t[o],t[o+1],s);else for(o=n-i;o>=e;o-=i)s=dp(o,t[o],t[o+1],s);return s&&op(s,s.next)&&(fp(s),s=s.next),s}function Hu(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!op(i,i.next)&&0!==rp(i.prev,i,i.next))i=i.next;else{if(fp(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function ku(t,e,n,i,r,o,s){if(!t)return;!s&&o&&Ku(t,i,r,o);let a,c,l=t;for(;t.prev!==t.next;)if(a=t.prev,c=t.next,o?ju(t,i,r,o):Vu(t))e.push(a.i/n),e.push(t.i/n),e.push(c.i/n),fp(t),t=c.next,l=c.next;else if((t=c)===l){s?1===s?ku(t=Wu(Hu(t),e,n),e,n,i,r,o,2):2===s&&qu(t,e,n,i,r,o):ku(Hu(t),e,n,i,r,o,1);break}}function Vu(t){let e=t.prev,n=t,i=t.next;if(rp(e,n,i)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(np(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&rp(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function ju(t,e,n,i){let r=t.prev,o=t,s=t.next;if(rp(r,o,s)>=0)return!1;let a=r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,c=r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,l=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,h=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,u=tp(a,c,e,n,i),p=tp(l,h,e,n,i),d=t.prevZ,f=t.nextZ;for(;d&&d.z>=u&&f&&f.z<=p;){if(d!==t.prev&&d!==t.next&&np(r.x,r.y,o.x,o.y,s.x,s.y,d.x,d.y)&&rp(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==t.prev&&f!==t.next&&np(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&rp(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&np(r.x,r.y,o.x,o.y,s.x,s.y,d.x,d.y)&&rp(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&np(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&rp(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Wu(t,e,n){let i=t;do{let r=i.prev,o=i.next.next;!op(r,o)&&sp(r,i,i.next,o)&&hp(r,o)&&hp(o,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(o.i/n),fp(i),fp(i.next),i=t=o),i=i.next}while(i!==t);return Hu(i)}function qu(t,e,n,i,r,o){let s=t;do{let t=s.next.next;for(;t!==s.prev;){if(s.i!==t.i&&ip(s,t)){let a=pp(s,t);return s=Hu(s,s.next),a=Hu(a,a.next),ku(s,e,n,i,r,o),void ku(a,e,n,i,r,o)}t=t.next}s=s.next}while(s!==t)}function Xu(t,e,n,i){let r,o,s,a,c,l=[];for(r=0,o=e.length;r<o;r++)(c=Gu(t,s=e[r]*i,a=r<o-1?e[r+1]*i:t.length,i,!1))===c.next&&(c.steiner=!0),l.push(ep(c));for(l.sort(Yu),r=0;r<l.length;r++)Zu(l[r],n),n=Hu(n,n.next);return n}function Yu(t,e){return t.x-e.x}function Zu(t,e){if(e=Ju(t,e)){const n=pp(e,t);Hu(e,e.next),Hu(n,n.next)}}function Ju(t,e){let n,i=e,r=t.x,o=t.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){let t=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=r&&t>s){if(s=t,t===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===s)return n;let a,c=n,l=n.x,h=n.y,u=1/0;i=n;do{r>=i.x&&i.x>=l&&r!==i.x&&np(o<h?r:s,o,l,h,o<h?s:r,o,i.x,i.y)&&(a=Math.abs(o-i.y)/(r-i.x),hp(i,t)&&(a<u||a===u&&(i.x>n.x||i.x===n.x&&Qu(n,i)))&&(n=i,u=a)),i=i.next}while(i!==c);return n}function Qu(t,e){return rp(t.prev,t,e.prev)<0&&rp(e.next,t,t.next)<0}function Ku(t,e,n,i){let r=t;do{null===r.z&&(r.z=tp(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,$u(r)}function $u(t){let e,n,i,r,o,s,a,c,l=1;do{for(n=t,t=null,o=null,s=0;n;){for(s++,i=n,a=0,e=0;e<l&&(a++,i=i.nextZ);e++);for(c=l;a>0||c>0&&i;)0!==a&&(0===c||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,c--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=i}o.nextZ=null,l*=2}while(s>1);return t}function tp(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ep(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function np(t,e,n,i,r,o,s,a){return(r-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(i-a)-(n-s)*(e-a)>=0&&(n-s)*(o-a)-(r-s)*(i-a)>=0}function ip(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!lp(t,e)&&(hp(t,e)&&hp(e,t)&&up(t,e)&&(rp(t.prev,t,e.prev)||rp(t,e.prev,e))||op(t,e)&&rp(t.prev,t,t.next)>0&&rp(e.prev,e,e.next)>0)}function rp(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function op(t,e){return t.x===e.x&&t.y===e.y}function sp(t,e,n,i){const r=cp(rp(t,e,n)),o=cp(rp(t,e,i)),s=cp(rp(n,i,t)),a=cp(rp(n,i,e));return r!==o&&s!==a||(!(0!==r||!ap(t,n,e))||(!(0!==o||!ap(t,i,e))||(!(0!==s||!ap(n,t,i))||!(0!==a||!ap(n,e,i)))))}function ap(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function cp(t){return t>0?1:t<0?-1:0}function lp(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&sp(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function hp(t,e){return rp(t.prev,t,t.next)<0?rp(t,e,t.next)>=0&&rp(t,t.prev,e)>=0:rp(t,e,t.prev)<0||rp(t,t.next,e)<0}function up(t,e){let n=t,i=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}function pp(t,e){let n=new mp(t.i,t.x,t.y),i=new mp(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function dp(t,e,n,i){const r=new mp(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function fp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function mp(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gp(t,e,n,i){let r=0;for(let o=e,s=n-i;o<n;o+=i)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}const vp={area:function(t){const e=t.length;let n=0;for(let i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n},isClockWise:function(t){return vp.area(t)<0},triangulateShape:function(t,e){const n=[],i=[],r=[];yp(t),xp(n,t);let o=t.length;e.forEach(yp);for(let t=0;t<e.length;t++)i.push(o),o+=e[t].length,xp(n,e[t]);const s=Fu.triangulate(n,i);for(let t=0;t<s.length;t+=3)r.push(s.slice(t,t+3));return r}};function yp(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function xp(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}function bp(t,e){uo.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new _p(t,e)),this.mergeVertices()}function _p(t,e){Gr.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],r=[];for(let e=0,n=t.length;e<n;e++){o(t[e])}function o(t){const o=[],s=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let c=void 0!==e.depth?e.depth:100,l=void 0===e.bevelEnabled||e.bevelEnabled,h=void 0!==e.bevelThickness?e.bevelThickness:6,u=void 0!==e.bevelSize?e.bevelSize:h-2,p=void 0!==e.bevelOffset?e.bevelOffset:0,d=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:wp;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),c=e.amount);let g,v,y,x,b,_=!1;f&&(g=f.getSpacedPoints(a),_=!0,l=!1,v=f.computeFrenetFrames(a,!1),y=new Yn,x=new Yn,b=new Yn),l||(d=0,h=0,u=0,p=0);const w=t.extractPoints(s);let M=w.shape;const S=w.holes;if(!vp.isClockWise(M)){M=M.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];vp.isClockWise(e)&&(S[t]=e.reverse())}}const T=vp.triangulateShape(M,S),E=M;for(let t=0,e=S.length;t<e;t++){const e=S[t];M=M.concat(e)}function A(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const L=M.length,R=T.length;function P(t,e,n){let i,r,o;const s=t.x-e.x,a=t.y-e.y,c=n.x-t.x,l=n.y-t.y,h=s*s+a*a,u=s*l-a*c;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),p=Math.sqrt(c*c+l*l),d=e.x-a/u,f=e.y+s/u,m=((n.x-l/p-d)*l-(n.y+c/p-f)*c)/(s*l-a*c),g=(i=d+s*m-t.x)*i+(r=f+a*m-t.y)*r;if(g<=2)return new Bn(i,r);o=Math.sqrt(g/2)}else{let t=!1;s>Number.EPSILON?c>Number.EPSILON&&(t=!0):s<-Number.EPSILON?c<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(l)&&(t=!0),t?(i=-a,r=s,o=Math.sqrt(h)):(i=s,r=a,o=Math.sqrt(h/2))}return new Bn(i/o,r/o)}const C=[];for(let t=0,e=E.length,n=e-1,i=t+1;t<e;t++,n++,i++)n===e&&(n=0),i===e&&(i=0),C[t]=P(E[t],E[n],E[i]);const O=[];let D,I=C.concat();for(let t=0,e=S.length;t<e;t++){const e=S[t];D=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),D[t]=P(e[t],e[i],e[r]);O.push(D),I=I.concat(D)}for(let t=0;t<d;t++){const e=t/d,n=h*Math.cos(e*Math.PI/2),i=u*Math.sin(e*Math.PI/2)+p;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],C[t],i);z(e.x,e.y,-n)}for(let t=0,e=S.length;t<e;t++){const e=S[t];D=O[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],D[t],i);z(r.x,r.y,-n)}}}const N=u+p;for(let t=0;t<L;t++){const e=l?A(M[t],I[t],N):M[t];_?(x.copy(v.normals[0]).multiplyScalar(e.x),y.copy(v.binormals[0]).multiplyScalar(e.y),b.copy(g[0]).add(x).add(y),z(b.x,b.y,b.z)):z(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<L;e++){const n=l?A(M[e],I[e],N):M[e];_?(x.copy(v.normals[t]).multiplyScalar(n.x),y.copy(v.binormals[t]).multiplyScalar(n.y),b.copy(g[t]).add(x).add(y),z(b.x,b.y,b.z)):z(n.x,n.y,c/a*t)}for(let t=d-1;t>=0;t--){const e=t/d,n=h*Math.cos(e*Math.PI/2),i=u*Math.sin(e*Math.PI/2)+p;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],C[t],i);z(e.x,e.y,c+n)}for(let t=0,e=S.length;t<e;t++){const e=S[t];D=O[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],D[t],i);_?z(r.x,r.y+g[a-1].y,g[a-1].x+n):z(r.x,r.y,c+n)}}}function B(t,e){let n=t.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=t.length-1);for(let t=0,n=a+2*d;t<n;t++){const n=L*t,o=L*(t+1);F(e+i+n,e+r+n,e+r+o,e+i+o)}}}function z(t,e,n){o.push(t),o.push(e),o.push(n)}function U(t,e,r){G(t),G(e),G(r);const o=i.length/3,s=m.generateTopUV(n,i,o-3,o-2,o-1);H(s[0]),H(s[1]),H(s[2])}function F(t,e,r,o){G(t),G(e),G(o),G(e),G(r),G(o);const s=i.length/3,a=m.generateSideWallUV(n,i,s-6,s-3,s-2,s-1);H(a[0]),H(a[1]),H(a[3]),H(a[1]),H(a[2]),H(a[3])}function G(t){i.push(o[3*t+0]),i.push(o[3*t+1]),i.push(o[3*t+2])}function H(t){r.push(t.x),r.push(t.y)}!function(){const t=i.length/3;if(l){let t=0,e=L*t;for(let t=0;t<R;t++){const n=T[t];U(n[2]+e,n[1]+e,n[0]+e)}e=L*(t=a+2*d);for(let t=0;t<R;t++){const n=T[t];U(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<R;t++){const e=T[t];U(e[2],e[1],e[0])}for(let t=0;t<R;t++){const e=T[t];U(e[0]+L*a,e[1]+L*a,e[2]+L*a)}}n.addGroup(t,i.length/3-t,0)}(),function(){const t=i.length/3;let e=0;B(E,e),e+=E.length;for(let t=0,n=S.length;t<n;t++){const n=S[t];B(n,e),e+=n.length}n.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new Rr(i,3)),this.setAttribute("uv",new Rr(r,2)),this.computeVertexNormals()}bp.prototype=Object.create(uo.prototype),bp.prototype.constructor=bp,bp.prototype.toJSON=function(){const t=uo.prototype.toJSON.call(this);return Mp(this.parameters.shapes,this.parameters.options,t)},_p.prototype=Object.create(Gr.prototype),_p.prototype.constructor=_p,_p.prototype.toJSON=function(){const t=Gr.prototype.toJSON.call(this);return Mp(this.parameters.shapes,this.parameters.options,t)};const wp={generateTopUV:function(t,e,n,i,r){const o=e[3*n],s=e[3*n+1],a=e[3*i],c=e[3*i+1],l=e[3*r],h=e[3*r+1];return[new Bn(o,s),new Bn(a,c),new Bn(l,h)]},generateSideWallUV:function(t,e,n,i,r,o){const s=e[3*n],a=e[3*n+1],c=e[3*n+2],l=e[3*i],h=e[3*i+1],u=e[3*i+2],p=e[3*r],d=e[3*r+1],f=e[3*r+2],m=e[3*o],g=e[3*o+1],v=e[3*o+2];return Math.abs(a-h)<.01?[new Bn(s,1-c),new Bn(l,1-u),new Bn(p,1-f),new Bn(m,1-v)]:[new Bn(a,1-c),new Bn(h,1-u),new Bn(d,1-f),new Bn(g,1-v)]}};function Mp(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,i=t.length;e<i;e++){const i=t[e];n.shapes.push(i.uuid)}else n.shapes.push(t.uuid);return void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}function Sp(t,e){uo.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new Tp(t,e)),this.mergeVertices()}function Tp(t,e){const n=(e=e||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new uo;const i=n.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),_p.call(this,i,e),this.type="TextBufferGeometry"}function Ep(t,e,n,i,r,o,s){uo.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Ap(t,e,n,i,r,o,s)),this.mergeVertices()}function Ap(t,e,n,i,r,o,s){Gr.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:s},t=t||1,e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6),i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI,o=void 0!==o?o:0,s=void 0!==s?s:Math.PI;const a=Math.min(o+s,Math.PI);let c=0;const l=[],h=new Yn,u=new Yn,p=[],d=[],f=[],m=[];for(let p=0;p<=n;p++){const g=[],v=p/n;let y=0;0==p&&0==o?y=.5/e:p==n&&a==Math.PI&&(y=-.5/e);for(let n=0;n<=e;n++){const a=n/e;h.x=-t*Math.cos(i+a*r)*Math.sin(o+v*s),h.y=t*Math.cos(o+v*s),h.z=t*Math.sin(i+a*r)*Math.sin(o+v*s),d.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(a+y,1-v),g.push(c++)}l.push(g)}for(let t=0;t<n;t++)for(let i=0;i<e;i++){const e=l[t][i+1],r=l[t][i],s=l[t+1][i],c=l[t+1][i+1];(0!==t||o>0)&&p.push(e,r,c),(t!==n-1||a<Math.PI)&&p.push(r,s,c)}this.setIndex(p),this.setAttribute("position",new Rr(d,3)),this.setAttribute("normal",new Rr(f,3)),this.setAttribute("uv",new Rr(m,2))}function Lp(t,e,n,i,r,o){uo.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new Rp(t,e,n,i,r,o)),this.mergeVertices()}function Rp(t,e,n,i,r,o){Gr.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},t=t||.5,e=e||1,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8;const s=[],a=[],c=[],l=[];let h=t;const u=(e-t)/(i=void 0!==i?Math.max(1,i):1),p=new Yn,d=new Bn;for(let t=0;t<=i;t++){for(let t=0;t<=n;t++){const i=r+t/n*o;p.x=h*Math.cos(i),p.y=h*Math.sin(i),a.push(p.x,p.y,p.z),c.push(0,0,1),d.x=(p.x/e+1)/2,d.y=(p.y/e+1)/2,l.push(d.x,d.y)}h+=u}for(let t=0;t<i;t++){const e=t*(n+1);for(let t=0;t<n;t++){const i=t+e,r=i,o=i+n+1,a=i+n+2,c=i+1;s.push(r,o,c),s.push(o,a,c)}}this.setIndex(s),this.setAttribute("position",new Rr(a,3)),this.setAttribute("normal",new Rr(c,3)),this.setAttribute("uv",new Rr(l,2))}function Pp(t,e,n,i){uo.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},this.fromBufferGeometry(new Cp(t,e,n,i)),this.mergeVertices()}function Cp(t,e,n,i){Gr.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},e=Math.floor(e)||12,n=n||0,i=i||2*Math.PI,i=Nn.clamp(i,0,2*Math.PI);const r=[],o=[],s=[],a=1/e,c=new Yn,l=new Bn;for(let r=0;r<=e;r++){const h=n+r*a*i,u=Math.sin(h),p=Math.cos(h);for(let n=0;n<=t.length-1;n++)c.x=t[n].x*u,c.y=t[n].y,c.z=t[n].x*p,o.push(c.x,c.y,c.z),l.x=r/e,l.y=n/(t.length-1),s.push(l.x,l.y)}for(let n=0;n<e;n++)for(let e=0;e<t.length-1;e++){const i=e+n*t.length,o=i,s=i+t.length,a=i+t.length+1,c=i+1;r.push(o,s,c),r.push(s,a,c)}if(this.setIndex(r),this.setAttribute("position",new Rr(o,3)),this.setAttribute("uv",new Rr(s,2)),this.computeVertexNormals(),i===2*Math.PI){const n=this.attributes.normal.array,i=new Yn,r=new Yn,o=new Yn,s=e*t.length*3;for(let e=0,a=0;e<t.length;e++,a+=3)i.x=n[a+0],i.y=n[a+1],i.z=n[a+2],r.x=n[s+a+0],r.y=n[s+a+1],r.z=n[s+a+2],o.addVectors(i,r).normalize(),n[a+0]=n[s+a+0]=o.x,n[a+1]=n[s+a+1]=o.y,n[a+2]=n[s+a+2]=o.z}}function Op(t,e){uo.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Dp(t,e)),this.mergeVertices()}function Dp(t,e){Gr.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;const n=[],i=[],r=[],o=[];let s=0,a=0;if(!1===Array.isArray(t))c(t);else for(let e=0;e<t.length;e++)c(t[e]),this.addGroup(s,a,e),s+=a,a=0;function c(t){const s=i.length/3,c=t.extractPoints(e);let l=c.shape;const h=c.holes;!1===vp.isClockWise(l)&&(l=l.reverse());for(let t=0,e=h.length;t<e;t++){const e=h[t];!0===vp.isClockWise(e)&&(h[t]=e.reverse())}const u=vp.triangulateShape(l,h);for(let t=0,e=h.length;t<e;t++){const e=h[t];l=l.concat(e)}for(let t=0,e=l.length;t<e;t++){const e=l[t];i.push(e.x,e.y,0),r.push(0,0,1),o.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],i=e[0]+s,r=e[1]+s,o=e[2]+s;n.push(i,r,o),a+=3}}this.setIndex(n),this.setAttribute("position",new Rr(i,3)),this.setAttribute("normal",new Rr(r,3)),this.setAttribute("uv",new Rr(o,2))}function Ip(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}function Np(t,e){Gr.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;const n=[],i=Math.cos(Nn.DEG2RAD*e),r=[0,0],o={};let s,a,c;const l=["a","b","c"];let h;t.isBufferGeometry?(h=new uo).fromBufferGeometry(t):h=t.clone(),h.mergeVertices(),h.computeFaceNormals();const u=h.vertices,p=h.faces;for(let t=0,e=p.length;t<e;t++){const e=p[t];for(let n=0;n<3;n++)s=e[l[n]],a=e[l[(n+1)%3]],r[0]=Math.min(s,a),r[1]=Math.max(s,a),void 0===o[c=r[0]+","+r[1]]?o[c]={index1:r[0],index2:r[1],face1:t,face2:void 0}:o[c].face2=t}for(c in o){const t=o[c];if(void 0===t.face2||p[t.face1].normal.dot(p[t.face2].normal)<=i){let e=u[t.index1];n.push(e.x,e.y,e.z),e=u[t.index2],n.push(e.x,e.y,e.z)}}this.setAttribute("position",new Rr(n,3))}function Bp(t,e,n,i,r,o,s,a){uo.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new zp(t,e,n,i,r,o,s,a)),this.mergeVertices()}function zp(t,e,n,i,r,o,s,a){Gr.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a};const c=this;t=void 0!==t?t:1,e=void 0!==e?e:1,n=n||1,i=Math.floor(i)||8,r=Math.floor(r)||1,o=void 0!==o&&o,s=void 0!==s?s:0,a=void 0!==a?a:2*Math.PI;const l=[],h=[],u=[],p=[];let d=0;const f=[],m=n/2;let g=0;function v(n){let r,o;const f=new Bn,v=new Yn;let y=0;const x=!0===n?t:e,b=!0===n?1:-1;r=d;for(let t=1;t<=i;t++)h.push(0,m*b,0),u.push(0,b,0),p.push(.5,.5),d++;o=d;for(let t=0;t<=i;t++){const e=t/i*a+s,n=Math.cos(e),r=Math.sin(e);v.x=x*r,v.y=m*b,v.z=x*n,h.push(v.x,v.y,v.z),u.push(0,b,0),f.x=.5*n+.5,f.y=.5*r*b+.5,p.push(f.x,f.y),d++}for(let t=0;t<i;t++){const e=r+t,i=o+t;!0===n?l.push(i,i+1,e):l.push(i+1,i,e),y+=3}c.addGroup(g,y,!0===n?1:2),g+=y}!function(){const o=new Yn,v=new Yn;let y=0;const x=(e-t)/n;for(let c=0;c<=r;c++){const l=[],g=c/r,y=g*(e-t)+t;for(let t=0;t<=i;t++){const e=t/i,r=e*a+s,c=Math.sin(r),f=Math.cos(r);v.x=y*c,v.y=-g*n+m,v.z=y*f,h.push(v.x,v.y,v.z),o.set(c,x,f).normalize(),u.push(o.x,o.y,o.z),p.push(e,1-g),l.push(d++)}f.push(l)}for(let t=0;t<i;t++)for(let e=0;e<r;e++){const n=f[e][t],i=f[e+1][t],r=f[e+1][t+1],o=f[e][t+1];l.push(n,i,o),l.push(i,r,o),y+=6}c.addGroup(g,y,0),g+=y}(),!1===o&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(l),this.setAttribute("position",new Rr(h,3)),this.setAttribute("normal",new Rr(u,3)),this.setAttribute("uv",new Rr(p,2))}function Up(t,e,n,i,r,o,s){Bp.call(this,0,t,e,n,i,r,o,s),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:s}}function Fp(t,e,n,i,r,o,s){zp.call(this,0,t,e,n,i,r,o,s),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:s}}function Gp(t,e,n,i){uo.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},this.fromBufferGeometry(new Hp(t,e,n,i)),this.mergeVertices()}function Hp(t,e,n,i){Gr.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},t=t||1,e=void 0!==e?Math.max(3,e):8,n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;const r=[],o=[],s=[],a=[],c=new Yn,l=new Bn;o.push(0,0,0),s.push(0,0,1),a.push(.5,.5);for(let r=0,h=3;r<=e;r++,h+=3){const u=n+r/e*i;c.x=t*Math.cos(u),c.y=t*Math.sin(u),o.push(c.x,c.y,c.z),s.push(0,0,1),l.x=(o[h]/t+1)/2,l.y=(o[h+1]/t+1)/2,a.push(l.x,l.y)}for(let t=1;t<=e;t++)r.push(t,t+1,0);this.setIndex(r),this.setAttribute("position",new Rr(o,3)),this.setAttribute("normal",new Rr(s,3)),this.setAttribute("uv",new Rr(a,2))}Sp.prototype=Object.create(uo.prototype),Sp.prototype.constructor=Sp,Tp.prototype=Object.create(_p.prototype),Tp.prototype.constructor=Tp,Ep.prototype=Object.create(uo.prototype),Ep.prototype.constructor=Ep,Ap.prototype=Object.create(Gr.prototype),Ap.prototype.constructor=Ap,Lp.prototype=Object.create(uo.prototype),Lp.prototype.constructor=Lp,Rp.prototype=Object.create(Gr.prototype),Rp.prototype.constructor=Rp,Pp.prototype=Object.create(uo.prototype),Pp.prototype.constructor=Pp,Cp.prototype=Object.create(Gr.prototype),Cp.prototype.constructor=Cp,Op.prototype=Object.create(uo.prototype),Op.prototype.constructor=Op,Op.prototype.toJSON=function(){const t=uo.prototype.toJSON.call(this);return Ip(this.parameters.shapes,t)},Dp.prototype=Object.create(Gr.prototype),Dp.prototype.constructor=Dp,Dp.prototype.toJSON=function(){const t=Gr.prototype.toJSON.call(this);return Ip(this.parameters.shapes,t)},Np.prototype=Object.create(Gr.prototype),Np.prototype.constructor=Np,Bp.prototype=Object.create(uo.prototype),Bp.prototype.constructor=Bp,zp.prototype=Object.create(Gr.prototype),zp.prototype.constructor=zp,Up.prototype=Object.create(Bp.prototype),Up.prototype.constructor=Up,Fp.prototype=Object.create(zp.prototype),Fp.prototype.constructor=Fp,Gp.prototype=Object.create(uo.prototype),Gp.prototype.constructor=Gp,Hp.prototype=Object.create(Gr.prototype),Hp.prototype.constructor=Hp;var kp=Object.freeze({__proto__:null,WireframeGeometry:bu,ParametricGeometry:_u,ParametricBufferGeometry:wu,TetrahedronGeometry:Tu,TetrahedronBufferGeometry:Eu,OctahedronGeometry:Au,OctahedronBufferGeometry:Lu,IcosahedronGeometry:Ru,IcosahedronBufferGeometry:Pu,DodecahedronGeometry:Cu,DodecahedronBufferGeometry:Ou,PolyhedronGeometry:Mu,PolyhedronBufferGeometry:Su,TubeGeometry:Du,TubeBufferGeometry:Iu,TorusKnotGeometry:Nu,TorusKnotBufferGeometry:Bu,TorusGeometry:zu,TorusBufferGeometry:Uu,TextGeometry:Sp,TextBufferGeometry:Tp,SphereGeometry:Ep,SphereBufferGeometry:Ap,RingGeometry:Lp,RingBufferGeometry:Rp,PlaneGeometry:Io,PlaneBufferGeometry:No,LatheGeometry:Pp,LatheBufferGeometry:Cp,ShapeGeometry:Op,ShapeBufferGeometry:Dp,ExtrudeGeometry:bp,ExtrudeBufferGeometry:_p,EdgesGeometry:Np,ConeGeometry:Up,ConeBufferGeometry:Fp,CylinderGeometry:Bp,CylinderBufferGeometry:zp,CircleGeometry:Gp,CircleBufferGeometry:Hp,BoxGeometry:po,BoxBufferGeometry:fo});function Vp(t){vr.call(this),this.type="ShadowMaterial",this.color=new ur(0),this.transparent=!0,this.setValues(t)}function jp(t){bo.call(this,t),this.type="RawShaderMaterial"}function Wp(t){vr.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ur(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ur(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function qp(t){Wp.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Bn(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transparency=0,this.setValues(t)}function Xp(t){vr.call(this),this.type="MeshPhongMaterial",this.color=new ur(16777215),this.specular=new ur(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ur(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Yp(t){vr.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ur(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ur(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Zp(t){vr.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Jp(t){vr.call(this),this.type="MeshLambertMaterial",this.color=new ur(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ur(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Qp(t){vr.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ur(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Kp(t){Kh.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}Vp.prototype=Object.create(vr.prototype),Vp.prototype.constructor=Vp,Vp.prototype.isShadowMaterial=!0,Vp.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.color.copy(t.color),this},jp.prototype=Object.create(bo.prototype),jp.prototype.constructor=jp,jp.prototype.isRawShaderMaterial=!0,Wp.prototype=Object.create(vr.prototype),Wp.prototype.constructor=Wp,Wp.prototype.isMeshStandardMaterial=!0,Wp.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},qp.prototype=Object.create(Wp.prototype),qp.prototype.constructor=qp,qp.prototype.isMeshPhysicalMaterial=!0,qp.prototype.copy=function(t){return Wp.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new ur).copy(t.sheen):this.sheen=null,this.transparency=t.transparency,this},Xp.prototype=Object.create(vr.prototype),Xp.prototype.constructor=Xp,Xp.prototype.isMeshPhongMaterial=!0,Xp.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Yp.prototype=Object.create(vr.prototype),Yp.prototype.constructor=Yp,Yp.prototype.isMeshToonMaterial=!0,Yp.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Zp.prototype=Object.create(vr.prototype),Zp.prototype.constructor=Zp,Zp.prototype.isMeshNormalMaterial=!0,Zp.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Jp.prototype=Object.create(vr.prototype),Jp.prototype.constructor=Jp,Jp.prototype.isMeshLambertMaterial=!0,Jp.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Qp.prototype=Object.create(vr.prototype),Qp.prototype.constructor=Qp,Qp.prototype.isMeshMatcapMaterial=!0,Qp.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Kp.prototype=Object.create(Kh.prototype),Kp.prototype.constructor=Kp,Kp.prototype.isLineDashedMaterial=!0,Kp.prototype.copy=function(t){return Kh.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var $p=Object.freeze({__proto__:null,ShadowMaterial:Vp,SpriteMaterial:Mh,RawShaderMaterial:jp,ShaderMaterial:bo,PointsMaterial:lu,MeshPhysicalMaterial:qp,MeshStandardMaterial:Wp,MeshPhongMaterial:Xp,MeshToonMaterial:Yp,MeshNormalMaterial:Zp,MeshLambertMaterial:Jp,MeshDepthMaterial:ih,MeshDistanceMaterial:rh,MeshBasicMaterial:yr,MeshMatcapMaterial:Qp,LineDashedMaterial:Kp,LineBasicMaterial:Kh,Material:vr});const td={arraySlice:function(t,e,n){return td.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort(function(e,n){return t[e]-t[n]}),n},sortedArray:function(t,e,n){const i=t.length,r=new t.constructor(i);for(let o=0,s=0;s!==i;++o){const i=n[o]*e;for(let n=0;n!==e;++n)r[s++]=t[i+n]}return r},flattenJSON:function(t,e,n,i){let r=1,o=t[0];for(;void 0!==o&&void 0===o[i];)o=t[r++];if(void 0===o)return;let s=o[i];if(void 0!==s)if(Array.isArray(s))do{void 0!==(s=o[i])&&(e.push(o.time),n.push.apply(n,s)),o=t[r++]}while(void 0!==o);else if(void 0!==s.toArray)do{void 0!==(s=o[i])&&(e.push(o.time),s.toArray(n,n.length)),o=t[r++]}while(void 0!==o);else do{void 0!==(s=o[i])&&(e.push(o.time),n.push(s)),o=t[r++]}while(void 0!==o)},subclip:function(t,e,n,i,r){r=r||30;const o=t.clone();o.name=e;const s=[];for(let t=0;t<o.tracks.length;++t){const e=o.tracks[t],a=e.getValueSize(),c=[],l=[];for(let t=0;t<e.times.length;++t){const o=e.times[t]*r;if(!(o<n||o>=i)){c.push(e.times[t]);for(let n=0;n<a;++n)l.push(e.values[t*a+n])}}0!==c.length&&(e.times=td.convertArray(c,e.times.constructor),e.values=td.convertArray(l,e.values.constructor),s.push(e))}o.tracks=s;let a=1/0;for(let t=0;t<o.tracks.length;++t)a>o.tracks[t].times[0]&&(a=o.tracks[t].times[0]);for(let t=0;t<o.tracks.length;++t)o.tracks[t].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(t,e,n,i){void 0===e&&(e=0),void 0===n&&(n=t),(void 0===i||i<=0)&&(i=30);const r=t.tracks.length,o=e/i;for(let e=0;e<r;++e){const i=n.tracks[e],r=i.ValueTypeName;if("bool"===r||"string"===r)continue;const s=t.tracks.find(function(t){return t.name===i.name&&t.ValueTypeName===r});if(void 0===s)continue;const a=i.getValueSize(),c=i.times.length-1;let l;if(o<=i.times[0])l=td.arraySlice(i.values,0,i.valueSize);else if(o>=i.times[c]){const t=c*a;l=td.arraySlice(i.values,t)}else{const t=i.createInterpolant();t.evaluate(o),l=t.resultBuffer}if("quaternion"===r){new Wn(l[0],l[1],l[2],l[3]).normalize().conjugate().toArray(l)}const h=s.times.length;for(let t=0;t<h;++t){const e=t*a;if("quaternion"===r)Wn.multiplyQuaternionsFlat(s.values,e,l,0,s.values,e);else for(let t=0;t<a;++t)s.values[e+t]-=l[t]}}return t.blendMode=2501,t}};function ed(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function nd(t,e,n,i){ed.call(this,t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function id(t,e,n,i){ed.call(this,t,e,n,i)}function rd(t,e,n,i){ed.call(this,t,e,n,i)}function od(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=td.convertArray(e,this.TimeBufferType),this.values=td.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function sd(t,e,n){od.call(this,t,e,n)}function ad(t,e,n,i){od.call(this,t,e,n,i)}function cd(t,e,n,i){od.call(this,t,e,n,i)}function ld(t,e,n,i){ed.call(this,t,e,n,i)}function hd(t,e,n,i){od.call(this,t,e,n,i)}function ud(t,e,n,i){od.call(this,t,e,n,i)}function pd(t,e,n,i){od.call(this,t,e,n,i)}function dd(t,e,n,i){this.name=t,this.tracks=n,this.duration=void 0!==e?e:-1,this.blendMode=void 0!==i?i:je,this.uuid=Nn.generateUUID(),this.duration<0&&this.resetDuration()}function fd(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return cd;case"vector":case"vector2":case"vector3":case"vector4":return pd;case"color":return ad;case"quaternion":return hd;case"bool":case"boolean":return sd;case"string":return ud}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function md(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=fd(t.type);if(void 0===t.times){const e=[],n=[];td.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(ed.prototype,{evaluate:function(t){let e=this.parameterPositions,n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let o;n:{i:if(!(t<i)){for(let o=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,r)}if(n===o)break;if(r=i,t<(i=e[++n]))break e}o=e.length;break n}if(t>=r)break t;{const s=e[1];t<s&&(n=2,r=s);for(let o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(n===o)break;if(i=r,t>=(r=e[--n-1]))break e}o=n,n=0}}for(;n<o;){const i=n+o>>>1;t<e[i]?o=i:n=i+1}if(i=e[n],void 0===(r=e[n-1]))return this._cachedIndex=0,this.beforeStart_(0,t,i);if(void 0===i)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,r,t)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let t=0;t!==i;++t)e[t]=n[r+t];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(ed.prototype,{beforeStart_:ed.prototype.copySampleValue_,afterEnd_:ed.prototype.copySampleValue_}),nd.prototype=Object.assign(Object.create(ed.prototype),{constructor:nd,DefaultSettings_:{endingStart:He,endingEnd:He},intervalChanged_:function(t,e,n){let i=this.parameterPositions,r=t-2,o=t+1,s=i[r],a=i[o];if(void 0===s)switch(this.getSettings_().endingStart){case 2401:r=t,s=2*e-n;break;case 2402:s=e+i[r=i.length-2]-i[r+1];break;default:r=t,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:o=t,a=2*n-e;break;case 2402:o=1,a=n+i[1]-i[0];break;default:o=t-1,a=e}const c=.5*(n-e),l=this.valueSize;this._weightPrev=c/(e-s),this._weightNext=c/(a-n),this._offsetPrev=r*l,this._offsetNext=o*l},interpolate_:function(t,e,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,c=a-s,l=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,p=this._weightNext,d=(n-e)/(i-e),f=d*d,m=f*d,g=-u*m+2*u*f-u*d,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,x=p*m-p*f;for(let t=0;t!==s;++t)r[t]=g*o[l+t]+v*o[c+t]+y*o[a+t]+x*o[h+t];return r}}),id.prototype=Object.assign(Object.create(ed.prototype),{constructor:id,interpolate_:function(t,e,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,c=a-s,l=(n-e)/(i-e),h=1-l;for(let t=0;t!==s;++t)r[t]=o[c+t]*h+o[a+t]*l;return r}}),rd.prototype=Object.assign(Object.create(ed.prototype),{constructor:rd,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(od,{toJSON:function(t){const e=t.constructor;let n;if(void 0!==e.toJSON)n=e.toJSON(t);else{n={name:t.name,times:td.convertArray(t.times,Array),values:td.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}}),Object.assign(od.prototype,{constructor:od,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new rd(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new id(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new nd(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){let e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this},scale:function(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this},trim:function(t,e){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<t;)++r;for(;-1!==o&&n[o]>e;)--o;if(++o,0!==r||o!==i){r>=o&&(r=(o=Math.max(o,1))-1);const t=this.getValueSize();this.times=td.arraySlice(n,r,o),this.values=td.arraySlice(this.values,r*t,o*t)}return this},validate:function(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let e=0;e!==r;e++){const i=n[e];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,i),t=!1;break}if(null!==o&&o>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,i,o),t=!1;break}o=i}if(void 0!==i&&td.isTypedArray(i))for(let e=0,n=i.length;e!==n;++e){const n=i[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t},optimize:function(){const t=td.arraySlice(this.times),e=td.arraySlice(this.values),n=this.getValueSize(),i=2302===this.getInterpolation(),r=t.length-1;let o=1;for(let s=1;s<r;++s){let r=!1;const a=t[s];if(a!==t[s+1]&&(1!==s||a!==a[0]))if(i)r=!0;else{const t=s*n,i=t-n,o=t+n;for(let s=0;s!==n;++s){const n=e[t+s];if(n!==e[i+s]||n!==e[o+s]){r=!0;break}}}if(r){if(s!==o){t[o]=t[s];const i=s*n,r=o*n;for(let t=0;t!==n;++t)e[r+t]=e[i+t]}++o}}if(r>0){t[o]=t[r];for(let t=r*n,i=o*n,s=0;s!==n;++s)e[i+s]=e[t+s];++o}return o!==t.length?(this.times=td.arraySlice(t,0,o),this.values=td.arraySlice(e,0,o*n)):(this.times=t,this.values=e),this},clone:function(){const t=td.arraySlice(this.times,0),e=td.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}),sd.prototype=Object.assign(Object.create(od.prototype),{constructor:sd,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ad.prototype=Object.assign(Object.create(od.prototype),{constructor:ad,ValueTypeName:"color"}),cd.prototype=Object.assign(Object.create(od.prototype),{constructor:cd,ValueTypeName:"number"}),ld.prototype=Object.assign(Object.create(ed.prototype),{constructor:ld,interpolate_:function(t,e,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-e)/(i-e);let c=t*s;for(let t=c+s;c!==t;c+=4)Wn.slerpFlat(r,0,o,c-s,o,c,a);return r}}),hd.prototype=Object.assign(Object.create(od.prototype),{constructor:hd,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new ld(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),ud.prototype=Object.assign(Object.create(od.prototype),{constructor:ud,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),pd.prototype=Object.assign(Object.create(od.prototype),{constructor:pd,ValueTypeName:"vector"}),Object.assign(dd,{parse:function(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let t=0,r=n.length;t!==r;++t)e.push(md(n[t]).scale(i));return new dd(t.name,t.duration,e,t.blendMode)},toJSON:function(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,i=n.length;t!==i;++t)e.push(od.toJSON(n[t]));return i},CreateFromMorphTargetSequence:function(t,e,n,i){const r=e.length,o=[];for(let t=0;t<r;t++){let s=[],a=[];s.push((t+r-1)%r,t,(t+1)%r),a.push(0,1,0);const c=td.getKeyframeOrder(s);s=td.sortedArray(s,1,c),a=td.sortedArray(a,1,c),i||0!==s[0]||(s.push(r),a.push(a[0])),o.push(new cd(".morphTargetInfluences["+e[t].name+"]",s,a).scale(1/n))}return new dd(t,-1,o)},findByName:function(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],o=n.name.match(r);if(o&&o.length>1){const t=o[1];let e=i[t];e||(i[t]=e=[]),e.push(n)}}const o=[];for(const t in i)o.push(dd.CreateFromMorphTargetSequence(t,i[t],e,n));return o},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,i,r){if(0!==n.length){const o=[],s=[];td.flattenJSON(n,o,s,i),0!==o.length&&r.push(new t(e,o,s))}},i=[],r=t.name||"default",o=t.fps||30,s=t.blendMode;let a=t.length||-1;const c=t.hierarchy||[];for(let t=0;t<c.length;t++){const r=c[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let n=0;n<r[e].morphTargets.length;n++)t[r[e].morphTargets[n]]=-1;for(const n in t){const t=[],o=[];for(let i=0;i!==r[e].morphTargets.length;++i){const i=r[e];t.push(i.time),o.push(i.morphTarget===n?1:0)}i.push(new cd(".morphTargetInfluence["+n+"]",t,o))}a=t.length*(o||1)}else{const o=".bones["+e[t].name+"]";n(pd,o+".position",r,"pos",i),n(hd,o+".quaternion",r,"rot",i),n(pd,o+".scale",r,"scl",i)}}return 0===i.length?null:new dd(r,a,i,s)}}),Object.assign(dd.prototype,{resetDuration:function(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this},trim:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new dd(this.name,this.duration,t,this.blendMode)}});const gd={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function vd(t,e,n){const i=this;let r=!1,o=0,s=0,a=void 0;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){s++,!1===r&&void 0!==i.onStart&&i.onStart(t,o,s),r=!0},this.itemEnd=function(t){o++,void 0!==i.onProgress&&i.onProgress(t,o,s),o===s&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return a?a(t):t},this.setURLModifier=function(t){return a=t,this},this.addHandler=function(t,e){return c.push(t,e),this},this.removeHandler=function(t){const e=c.indexOf(t);return-1!==e&&c.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=c.length;e<n;e+=2){const n=c[e],i=c[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}const yd=new vd;function xd(t){this.manager=void 0!==t?t:yd,this.crossOrigin="anonymous",this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(xd.prototype,{load:function(){},loadAsync:function(t,e){const n=this;return new Promise(function(i,r){n.load(t,i,e,r)})},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});const bd={};function _d(t){xd.call(this,t)}function wd(t){xd.call(this,t)}function Md(t){xd.call(this,t)}function Sd(t){xd.call(this,t)}function Td(t){xd.call(this,t)}function Ed(t){xd.call(this,t)}function Ad(t){xd.call(this,t)}function Ld(){this.type="Curve",this.arcLengthDivisions=200}function Rd(t,e,n,i,r,o,s,a){Ld.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=i||1,this.aStartAngle=r||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}function Pd(t,e,n,i,r,o){Rd.call(this,t,e,n,n,i,r,o),this.type="ArcCurve"}function Cd(){let t=0,e=0,n=0,i=0;function r(r,o,s,a){t=r,e=s,n=-3*r+3*o-2*s-a,i=2*r-2*o+s+a}return{initCatmullRom:function(t,e,n,i,o){r(e,n,o*(n-t),o*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,o,s,a){let c=(e-t)/o-(n-t)/(o+s)+(n-e)/s,l=(n-e)/s-(i-e)/(s+a)+(i-n)/a;r(e,n,c*=s,l*=s)},calc:function(r){const o=r*r;return t+e*r+n*o+i*(o*r)}}}_d.prototype=Object.assign(Object.create(xd.prototype),{constructor:_d,load:function(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=gd.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;if(void 0!==bd[t])return void bd[t].push({onLoad:e,onProgress:n,onError:i});const s=t.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(s){const n=s[1],o=!!s[2];let a=s[3];a=decodeURIComponent(a),o&&(a=atob(a));try{let o;const s=(this.responseType||"").toLowerCase();switch(s){case"arraybuffer":case"blob":const t=new Uint8Array(a.length);for(let e=0;e<a.length;e++)t[e]=a.charCodeAt(e);o="blob"===s?new Blob([t.buffer],{type:n}):t.buffer;break;case"document":const e=new DOMParser;o=e.parseFromString(a,n);break;case"json":o=JSON.parse(a);break;default:o=a}setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0)}catch(e){setTimeout(function(){i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)},0)}}else{bd[t]=[],bd[t].push({onLoad:e,onProgress:n,onError:i}),(a=new XMLHttpRequest).open("GET",t,!0),a.addEventListener("load",function(e){const n=this.response,i=bd[t];if(delete bd[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),gd.add(t,n);for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onLoad&&e.onLoad(n)}r.manager.itemEnd(t)}else{for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}},!1),a.addEventListener("progress",function(e){const n=bd[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onProgress&&i.onProgress(e)}},!1),a.addEventListener("error",function(e){const n=bd[t];delete bd[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)},!1),a.addEventListener("abort",function(e){const n=bd[t];delete bd[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)},!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)a.setRequestHeader(t,this.requestHeader[t]);a.send(null)}return r.manager.itemStart(t),a},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this}}),wd.prototype=Object.assign(Object.create(xd.prototype),{constructor:wd,load:function(t,e,n,i){const r=this,o=new _d(r.manager);o.setPath(r.path),o.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}},n,i)},parse:function(t){const e=[];for(let n=0;n<t.length;n++){const i=dd.parse(t[n]);e.push(i)}return e}}),Md.prototype=Object.assign(Object.create(xd.prototype),{constructor:Md,load:function(t,e,n,i){const r=this,o=[],s=new vu;s.image=o;const a=new _d(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer");let c=0;function l(l){a.load(t[l],function(t){const n=r.parse(t,!0);o[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(c+=1)&&(1===n.mipmapCount&&(s.minFilter=yt),s.format=n.format,s.needsUpdate=!0,e&&e(s))},n,i)}if(Array.isArray(t))for(let e=0,n=t.length;e<n;++e)l(e);else a.load(t,function(t){const n=r.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){o[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)o[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),o[e].format=n.format,o[e].width=n.width,o[e].height=n.height}}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=yt),s.format=n.format,s.needsUpdate=!0,e&&e(s)},n,i);return s}}),Sd.prototype=Object.assign(Object.create(xd.prototype),{constructor:Sd,load:function(t,e,n,i){const r=this,o=new Ao,s=new _d(this.manager);return s.setResponseType("arraybuffer"),s.setPath(this.path),s.load(t,function(t){const n=r.parse(t);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:ut,o.wrapT=void 0!==n.wrapT?n.wrapT:ut,o.magFilter=void 0!==n.magFilter?n.magFilter:yt,o.minFilter=void 0!==n.minFilter?n.minFilter:yt,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=_t),1===n.mipmapCount&&(o.minFilter=yt),o.needsUpdate=!0,e&&e(o,n))},n,i),o}}),Td.prototype=Object.assign(Object.create(xd.prototype),{constructor:Td,load:function(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=gd.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;const s=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){s.removeEventListener("load",a,!1),s.removeEventListener("error",c,!1),gd.add(t,this),e&&e(this),r.manager.itemEnd(t)}function c(e){s.removeEventListener("load",a,!1),s.removeEventListener("error",c,!1),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}return s.addEventListener("load",a,!1),s.addEventListener("error",c,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(t),s.src=t,s}}),Ed.prototype=Object.assign(Object.create(xd.prototype),{constructor:Ed,load:function(t,e,n,i){const r=new gc,o=new Td(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(n){o.load(t[n],function(t){r.images[n]=t,6===++s&&(r.needsUpdate=!0,e&&e(r))},void 0,i)}for(let e=0;e<t.length;++e)a(e);return r}}),Ad.prototype=Object.assign(Object.create(xd.prototype),{constructor:Ad,load:function(t,e,n,i){const r=new Hn,o=new Td(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(n){r.image=n;const i=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);r.format=i?Bt:zt,r.needsUpdate=!0,void 0!==e&&e(r)},n,i),r}}),Object.assign(Ld.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)},getPoints:function(t){void 0===t&&(t=5);const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){const t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),r=0;e.push(0);for(let o=1;o<=t;o++)r+=(n=this.getPoint(o/t)).distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){const n=this.getLengths();let i,r=0,o=n.length;i=e||t*n[o-1];let s,a=0,c=o-1;for(;a<=c;)if((s=n[r=Math.floor(a+(c-a)/2)]-i)<0)a=r+1;else{if(!(s>0)){c=r;break}c=r-1}if(n[r=c]===i)return r/(o-1);const l=n[r];return(r+(i-l)/(n[r+1]-l))/(o-1)},getTangent:function(t,e){let n=t-1e-4,i=t+1e-4;n<0&&(n=0),i>1&&(i=1);const r=this.getPoint(n),o=this.getPoint(i),s=e||(r.isVector2?new Bn:new Yn);return s.copy(o).sub(r).normalize(),s},getTangentAt:function(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)},computeFrenetFrames:function(t,e){const n=new Yn,i=[],r=[],o=[],s=new Yn,a=new ni;for(let e=0;e<=t;e++){const n=e/t;i[e]=this.getTangentAt(n,new Yn),i[e].normalize()}r[0]=new Yn,o[0]=new Yn;let c=Number.MAX_VALUE;const l=Math.abs(i[0].x),h=Math.abs(i[0].y),u=Math.abs(i[0].z);l<=c&&(c=l,n.set(1,0,0)),h<=c&&(c=h,n.set(0,1,0)),u<=c&&n.set(0,0,1),s.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],s),o[0].crossVectors(i[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),o[e]=o[e-1].clone(),s.crossVectors(i[e-1],i[e]),s.length()>Number.EPSILON){s.normalize();const t=Math.acos(Nn.clamp(i[e-1].dot(i[e]),-1,1));r[e].applyMatrix4(a.makeRotationAxis(s,t))}o[e].crossVectors(i[e],r[e])}if(!0===e){let e=Math.acos(Nn.clamp(r[0].dot(r[t]),-1,1));e/=t,i[0].dot(s.crossVectors(r[0],r[t]))>0&&(e=-e);for(let n=1;n<=t;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],e*n)),o[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),Rd.prototype=Object.create(Ld.prototype),Rd.prototype.constructor=Rd,Rd.prototype.isEllipseCurve=!0,Rd.prototype.getPoint=function(t,e){const n=e||new Bn,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=o?0:i),!0!==this.aClockwise||o||(r===i?r=-i:r-=i);const s=this.aStartAngle+t*r;let a=this.aX+this.xRadius*Math.cos(s),c=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,i=c-this.aY;a=n*t-i*e+this.aX,c=n*e+i*t+this.aY}return n.set(a,c)},Rd.prototype.copy=function(t){return Ld.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Rd.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},Rd.prototype.fromJSON=function(t){return Ld.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Pd.prototype=Object.create(Rd.prototype),Pd.prototype.constructor=Pd,Pd.prototype.isArcCurve=!0;const Od=new Yn,Dd=new Cd,Id=new Cd,Nd=new Cd;function Bd(t,e,n,i){Ld.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=n||"centripetal",this.tension=i||.5}function zd(t,e,n,i,r){const o=.5*(i-e),s=.5*(r-n),a=t*t;return(2*n-2*i+o+s)*(t*a)+(-3*n+3*i-2*o-s)*a+o*t+n}function Ud(t,e){const n=1-t;return n*n*e}function Fd(t,e){return 2*(1-t)*t*e}function Gd(t,e){return t*t*e}function Hd(t,e,n,i){return Ud(t,e)+Fd(t,n)+Gd(t,i)}function kd(t,e){const n=1-t;return n*n*n*e}function Vd(t,e){const n=1-t;return 3*n*n*t*e}function jd(t,e){return 3*(1-t)*t*t*e}function Wd(t,e){return t*t*t*e}function qd(t,e,n,i,r){return kd(t,e)+Vd(t,n)+jd(t,i)+Wd(t,r)}function Xd(t,e,n,i){Ld.call(this),this.type="CubicBezierCurve",this.v0=t||new Bn,this.v1=e||new Bn,this.v2=n||new Bn,this.v3=i||new Bn}function Yd(t,e,n,i){Ld.call(this),this.type="CubicBezierCurve3",this.v0=t||new Yn,this.v1=e||new Yn,this.v2=n||new Yn,this.v3=i||new Yn}function Zd(t,e){Ld.call(this),this.type="LineCurve",this.v1=t||new Bn,this.v2=e||new Bn}function Jd(t,e){Ld.call(this),this.type="LineCurve3",this.v1=t||new Yn,this.v2=e||new Yn}function Qd(t,e,n){Ld.call(this),this.type="QuadraticBezierCurve",this.v0=t||new Bn,this.v1=e||new Bn,this.v2=n||new Bn}function Kd(t,e,n){Ld.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Yn,this.v1=e||new Yn,this.v2=n||new Yn}function $d(t){Ld.call(this),this.type="SplineCurve",this.points=t||[]}Bd.prototype=Object.create(Ld.prototype),Bd.prototype.constructor=Bd,Bd.prototype.isCatmullRomCurve3=!0,Bd.prototype.getPoint=function(t,e){const n=e||new Yn,i=this.points,r=i.length,o=(r-(this.closed?0:1))*t;let s,a,c,l,h=Math.floor(o),u=o-h;if(this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/r)+1)*r:0===u&&h===r-1&&(h=r-2,u=1),this.closed||h>0?s=i[(h-1)%r]:(Od.subVectors(i[0],i[1]).add(i[0]),s=Od),a=i[h%r],c=i[(h+1)%r],this.closed||h+2<r?l=i[(h+2)%r]:(Od.subVectors(i[r-1],i[r-2]).add(i[r-1]),l=Od),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(s.distanceToSquared(a),t),n=Math.pow(a.distanceToSquared(c),t),i=Math.pow(c.distanceToSquared(l),t);n<1e-4&&(n=1),e<1e-4&&(e=n),i<1e-4&&(i=n),Dd.initNonuniformCatmullRom(s.x,a.x,c.x,l.x,e,n,i),Id.initNonuniformCatmullRom(s.y,a.y,c.y,l.y,e,n,i),Nd.initNonuniformCatmullRom(s.z,a.z,c.z,l.z,e,n,i)}else"catmullrom"===this.curveType&&(Dd.initCatmullRom(s.x,a.x,c.x,l.x,this.tension),Id.initCatmullRom(s.y,a.y,c.y,l.y,this.tension),Nd.initCatmullRom(s.z,a.z,c.z,l.z,this.tension));return n.set(Dd.calc(u),Id.calc(u),Nd.calc(u)),n},Bd.prototype.copy=function(t){Ld.prototype.copy.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Bd.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Bd.prototype.fromJSON=function(t){Ld.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Yn).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Xd.prototype=Object.create(Ld.prototype),Xd.prototype.constructor=Xd,Xd.prototype.isCubicBezierCurve=!0,Xd.prototype.getPoint=function(t,e){const n=e||new Bn,i=this.v0,r=this.v1,o=this.v2,s=this.v3;return n.set(qd(t,i.x,r.x,o.x,s.x),qd(t,i.y,r.y,o.y,s.y)),n},Xd.prototype.copy=function(t){return Ld.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Xd.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Xd.prototype.fromJSON=function(t){return Ld.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Yd.prototype=Object.create(Ld.prototype),Yd.prototype.constructor=Yd,Yd.prototype.isCubicBezierCurve3=!0,Yd.prototype.getPoint=function(t,e){const n=e||new Yn,i=this.v0,r=this.v1,o=this.v2,s=this.v3;return n.set(qd(t,i.x,r.x,o.x,s.x),qd(t,i.y,r.y,o.y,s.y),qd(t,i.z,r.z,o.z,s.z)),n},Yd.prototype.copy=function(t){return Ld.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Yd.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Yd.prototype.fromJSON=function(t){return Ld.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Zd.prototype=Object.create(Ld.prototype),Zd.prototype.constructor=Zd,Zd.prototype.isLineCurve=!0,Zd.prototype.getPoint=function(t,e){const n=e||new Bn;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},Zd.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Zd.prototype.getTangent=function(t,e){const n=e||new Bn;return n.copy(this.v2).sub(this.v1).normalize(),n},Zd.prototype.copy=function(t){return Ld.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Zd.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Zd.prototype.fromJSON=function(t){return Ld.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Jd.prototype=Object.create(Ld.prototype),Jd.prototype.constructor=Jd,Jd.prototype.isLineCurve3=!0,Jd.prototype.getPoint=function(t,e){const n=e||new Yn;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},Jd.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Jd.prototype.copy=function(t){return Ld.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Jd.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Jd.prototype.fromJSON=function(t){return Ld.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Qd.prototype=Object.create(Ld.prototype),Qd.prototype.constructor=Qd,Qd.prototype.isQuadraticBezierCurve=!0,Qd.prototype.getPoint=function(t,e){const n=e||new Bn,i=this.v0,r=this.v1,o=this.v2;return n.set(Hd(t,i.x,r.x,o.x),Hd(t,i.y,r.y,o.y)),n},Qd.prototype.copy=function(t){return Ld.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Qd.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Qd.prototype.fromJSON=function(t){return Ld.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Kd.prototype=Object.create(Ld.prototype),Kd.prototype.constructor=Kd,Kd.prototype.isQuadraticBezierCurve3=!0,Kd.prototype.getPoint=function(t,e){const n=e||new Yn,i=this.v0,r=this.v1,o=this.v2;return n.set(Hd(t,i.x,r.x,o.x),Hd(t,i.y,r.y,o.y),Hd(t,i.z,r.z,o.z)),n},Kd.prototype.copy=function(t){return Ld.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Kd.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Kd.prototype.fromJSON=function(t){return Ld.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},$d.prototype=Object.create(Ld.prototype),$d.prototype.constructor=$d,$d.prototype.isSplineCurve=!0,$d.prototype.getPoint=function(t,e){const n=e||new Bn,i=this.points,r=(i.length-1)*t,o=Math.floor(r),s=r-o,a=i[0===o?o:o-1],c=i[o],l=i[o>i.length-2?i.length-1:o+1],h=i[o>i.length-3?i.length-1:o+2];return n.set(zd(s,a.x,c.x,l.x,h.x),zd(s,a.y,c.y,l.y,h.y)),n},$d.prototype.copy=function(t){Ld.prototype.copy.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this},$d.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t},$d.prototype.fromJSON=function(t){Ld.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Bn).fromArray(n))}return this};var tf=Object.freeze({__proto__:null,ArcCurve:Pd,CatmullRomCurve3:Bd,CubicBezierCurve:Xd,CubicBezierCurve3:Yd,EllipseCurve:Rd,LineCurve:Zd,LineCurve3:Jd,QuadraticBezierCurve:Qd,QuadraticBezierCurve3:Kd,SplineCurve:$d});function ef(){Ld.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function nf(t){ef.call(this),this.type="Path",this.currentPoint=new Bn,t&&this.setFromPoints(t)}function rf(t){nf.call(this,t),this.uuid=Nn.generateUUID(),this.type="Shape",this.holes=[]}function of(t,e){bi.call(this),this.type="Light",this.color=new ur(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function sf(t,e,n){of.call(this,t,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(bi.DefaultUp),this.updateMatrix(),this.groundColor=new ur(e)}function af(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Bn(512,512),this.map=null,this.mapPass=null,this.matrix=new ni,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Po,this._frameExtents=new Bn(1,1),this._viewportCount=1,this._viewports=[new kn(0,0,1,1)]}function cf(){af.call(this,new wo(50,1,.5,500))}function lf(t,e,n,i,r,o){of.call(this,t,e),this.type="SpotLight",this.position.copy(bi.DefaultUp),this.updateMatrix(),this.target=new bi,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new cf}function hf(){af.call(this,new wo(90,1,.5,500)),this._frameExtents=new Bn(4,2),this._viewportCount=6,this._viewports=[new kn(2,1,1,1),new kn(0,1,1,1),new kn(3,1,1,1),new kn(1,1,1,1),new kn(3,0,1,1),new kn(1,0,1,1)],this._cubeDirections=[new Yn(1,0,0),new Yn(-1,0,0),new Yn(0,0,1),new Yn(0,0,-1),new Yn(0,1,0),new Yn(0,-1,0)],this._cubeUps=[new Yn(0,1,0),new Yn(0,1,0),new Yn(0,1,0),new Yn(0,1,0),new Yn(0,0,1),new Yn(0,0,-1)]}function uf(t,e,n,i){of.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==i?i:1,this.shadow=new hf}function pf(t,e,n,i,r,o){_o.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==n?n:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function df(){af.call(this,new pf(-5,5,5,-5,.5,500))}function ff(t,e){of.call(this,t,e),this.type="DirectionalLight",this.position.copy(bi.DefaultUp),this.updateMatrix(),this.target=new bi,this.shadow=new df}function mf(t,e){of.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function gf(t,e,n,i){of.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==i?i:10}function vf(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Yn)}function yf(t,e){of.call(this,void 0,e),this.type="LightProbe",this.sh=void 0!==t?t:new vf}function xf(t){xd.call(this,t),this.textures={}}ef.prototype=Object.assign(Object.create(Ld.prototype),{constructor:ef,add:function(t){this.curves.push(t)},closePath:function(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Zd(e,t))},getPoint:function(t){const e=t*this.getLength(),n=this.getCurveLengths();let i=0;for(;i<n.length;){if(n[i]>=e){const t=n[i]-e,r=this.curves[i],o=r.getLength(),s=0===o?0:1-t/o;return r.getPointAt(s)}i++}return null},getLength:function(){const t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],s=o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t,a=o.getPoints(s);for(let t=0;t<a.length;t++){const i=a[t];n&&n.equals(i)||(e.push(i),n=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(t){Ld.prototype.copy.call(this,t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){const t=Ld.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t},fromJSON:function(t){Ld.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new tf[n.type]).fromJSON(n))}return this}}),nf.prototype=Object.assign(Object.create(ef.prototype),{constructor:nf,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){const n=new Zd(this.currentPoint.clone(),new Bn(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,n,i){const r=new Qd(this.currentPoint.clone(),new Bn(t,e),new Bn(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this},bezierCurveTo:function(t,e,n,i,r,o){const s=new Xd(this.currentPoint.clone(),new Bn(t,e),new Bn(n,i),new Bn(r,o));return this.curves.push(s),this.currentPoint.set(r,o),this},splineThru:function(t){const e=new $d([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,n,i,r,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+s,e+a,n,i,r,o),this},absarc:function(t,e,n,i,r,o){return this.absellipse(t,e,n,n,i,r,o),this},ellipse:function(t,e,n,i,r,o,s,a){const c=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+c,e+l,n,i,r,o,s,a),this},absellipse:function(t,e,n,i,r,o,s,a){const c=new Rd(t,e,n,i,r,o,s,a);if(this.curves.length>0){const t=c.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(c);const l=c.getPoint(1);return this.currentPoint.copy(l),this},copy:function(t){return ef.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){const t=ef.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return ef.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),rf.prototype=Object.assign(Object.create(nf.prototype),{constructor:rf,getPointsHoles:function(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){nf.prototype.copy.call(this,t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this},toJSON:function(){const t=nf.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t},fromJSON:function(t){nf.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new nf).fromJSON(n))}return this}}),of.prototype=Object.assign(Object.create(bi.prototype),{constructor:of,isLight:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){const e=bi.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),sf.prototype=Object.assign(Object.create(of.prototype),{constructor:sf,isHemisphereLight:!0,copy:function(t){return of.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(af.prototype,{_projScreenMatrix:new ni,_lightPositionWorld:new Yn,_lookTarget:new Yn,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){const e=this.camera,n=this.matrix,i=this._projScreenMatrix,r=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(t.matrixWorld),e.position.copy(o),r.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(r),e.updateMatrixWorld(),i.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(i),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),cf.prototype=Object.assign(Object.create(af.prototype),{constructor:cf,isSpotLightShadow:!0,updateMatrices:function(t){const e=this.camera,n=2*Nn.RAD2DEG*t.angle,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),af.prototype.updateMatrices.call(this,t)}}),lf.prototype=Object.assign(Object.create(of.prototype),{constructor:lf,isSpotLight:!0,copy:function(t){return of.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),hf.prototype=Object.assign(Object.create(af.prototype),{constructor:hf,isPointLightShadow:!0,updateMatrices:function(t,e){void 0===e&&(e=0);const n=this.camera,i=this.matrix,r=this._lightPositionWorld,o=this._lookTarget,s=this._projScreenMatrix;r.setFromMatrixPosition(t.matrixWorld),n.position.copy(r),o.copy(n.position),o.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(o),n.updateMatrixWorld(),i.makeTranslation(-r.x,-r.y,-r.z),s.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(s)}}),uf.prototype=Object.assign(Object.create(of.prototype),{constructor:uf,isPointLight:!0,copy:function(t){return of.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),pf.prototype=Object.assign(Object.create(_o.prototype),{constructor:pf,isOrthographicCamera:!0,copy:function(t,e){return _o.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,o=n+t,s=i+e,a=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o=(r+=t*this.view.offsetX)+t*this.view.width,a=(s-=e*this.view.offsetY)-e*this.view.height}this.projectionMatrix.makeOrthographic(r,o,s,a,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){const e=bi.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),df.prototype=Object.assign(Object.create(af.prototype),{constructor:df,isDirectionalLightShadow:!0,updateMatrices:function(t){af.prototype.updateMatrices.call(this,t)}}),ff.prototype=Object.assign(Object.create(of.prototype),{constructor:ff,isDirectionalLight:!0,copy:function(t){return of.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),mf.prototype=Object.assign(Object.create(of.prototype),{constructor:mf,isAmbientLight:!0}),gf.prototype=Object.assign(Object.create(of.prototype),{constructor:gf,isRectAreaLight:!0,copy:function(t){return of.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){const e=of.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),Object.assign(vf.prototype,{isSphericalHarmonics3:!0,set:function(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},zero:function(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,e){const n=t.x,i=t.y,r=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*i),e.addScaledVector(o[2],.488603*r),e.addScaledVector(o[3],.488603*n),e.addScaledVector(o[4],n*i*1.092548),e.addScaledVector(o[5],i*r*1.092548),e.addScaledVector(o[6],.315392*(3*r*r-1)),e.addScaledVector(o[7],n*r*1.092548),e.addScaledVector(o[8],.546274*(n*n-i*i)),e},getIrradianceAt:function(t,e){const n=t.x,i=t.y,r=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],1.023328*i),e.addScaledVector(o[2],1.023328*r),e.addScaledVector(o[3],1.023328*n),e.addScaledVector(o[4],.858086*n*i),e.addScaledVector(o[5],.858086*i*r),e.addScaledVector(o[6],.743125*r*r-.247708),e.addScaledVector(o[7],.858086*n*r),e.addScaledVector(o[8],.429043*(n*n-i*i)),e},add:function(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},addScaledSH:function(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this},scale:function(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},lerp:function(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this},equals:function(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(t,e){void 0===e&&(e=0);const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(t,e+3*i);return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(t,e+3*i);return t}}),Object.assign(vf,{getBasisAt:function(t,e){const n=t.x,i=t.y,r=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-i*i)}}),yf.prototype=Object.assign(Object.create(of.prototype),{constructor:yf,isLightProbe:!0,copy:function(t){return of.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){const e=of.prototype.toJSON.call(this,t);return e.object.sh=this.sh.toArray(),e}}),xf.prototype=Object.assign(Object.create(xd.prototype),{constructor:xf,load:function(t,e,n,i){const r=this,o=new _d(r.manager);o.setPath(r.path),o.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}},n,i)},parse:function(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const i=new $p[t.type];if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=(new ur).setHex(t.sheen)),void 0!==t.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&i.specular.setHex(t.specular),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(i.skinning=t.skinning),void 0!==t.morphTargets&&(i.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(i.morphNormals=t.morphNormals),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.vertexTangents&&(i.vertexTangents=t.vertexTangents),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const r=t.uniforms[e];switch(i.uniforms[e]={},r.type){case"t":i.uniforms[e].value=n(r.value);break;case"c":i.uniforms[e].value=(new ur).setHex(r.value);break;case"v2":i.uniforms[e].value=(new Bn).fromArray(r.value);break;case"v3":i.uniforms[e].value=(new Yn).fromArray(r.value);break;case"v4":i.uniforms[e].value=(new kn).fromArray(r.value);break;case"m3":i.uniforms[e].value=(new zn).fromArray(r.value);case"m4":i.uniforms[e].value=(new ni).fromArray(r.value);break;default:i.uniforms[e].value=r.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)i.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(i.flatShading=1===t.shading),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=n(t.map)),void 0!==t.matcap&&(i.matcap=n(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),i.normalScale=(new Bn).fromArray(e)}return void 0!==t.displacementMap&&(i.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=n(t.specularMap)),void 0!==t.envMap&&(i.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Bn).fromArray(t.clearcoatNormalScale)),i},setTextures:function(t){return this.textures=t,this}});const bf={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,i=t.length;n<i;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}},extractUrlBase:function(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};function _f(){Gr.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function wf(t,e,n,i){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),_r.call(this,t,e,n),this.meshPerAttribute=i||1}function Mf(t){xd.call(this,t)}_f.prototype=Object.assign(Object.create(Gr.prototype),{constructor:_f,isInstancedBufferGeometry:!0,copy:function(t){return Gr.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t=Gr.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),wf.prototype=Object.assign(Object.create(_r.prototype),{constructor:wf,isInstancedBufferAttribute:!0,copy:function(t){return _r.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){const t=_r.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),Mf.prototype=Object.assign(Object.create(xd.prototype),{constructor:Mf,load:function(t,e,n,i){const r=this,o=new _d(r.manager);o.setPath(r.path),o.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}},n,i)},parse:function(t){const e={},n={};function i(t,i){if(void 0!==e[i])return e[i];const r=t.interleavedBuffers[i],o=function(t,e){if(void 0!==n[e])return n[e];const i=t.arrayBuffers[e],r=new Uint32Array(i).buffer;return n[e]=r,r}(t,r.buffer),s=new bh(new Sf[r.type](o),r.stride);return s.uuid=r.uuid,e[i]=s,s}const r=t.isInstancedBufferGeometry?new _f:new Gr,o=t.data.index;if(void 0!==o){const t=new Sf[o.type](o.array);r.setIndex(new _r(t,1))}const s=t.data.attributes;for(const e in s){const n=s[e];let o;if(n.isInterleavedBufferAttribute){o=new wh(i(t.data,n.data),n.itemSize,n.offset,n.normalized)}else{const t=new Sf[n.type](n.array);o=new(n.isInstancedBufferAttribute?wf:_r)(t,n.itemSize,n.normalized)}void 0!==n.name&&(o.name=n.name),r.setAttribute(e,o)}const a=t.data.morphAttributes;if(a)for(const e in a){const n=a[e],o=[];for(let e=0,r=n.length;e<r;e++){const r=n[e];let s;if(r.isInterleavedBufferAttribute){s=new wh(i(t.data,r.data),r.itemSize,r.offset,r.normalized)}else{s=new _r(new Sf[r.type](r.array),r.itemSize,r.normalized)}void 0!==r.name&&(s.name=r.name),o.push(s)}r.morphAttributes[e]=o}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const c=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==c)for(let t=0,e=c.length;t!==e;++t){const e=c[t];r.addGroup(e.start,e.count,e.materialIndex)}const l=t.data.boundingSphere;if(void 0!==l){const t=new Yn;void 0!==l.center&&t.fromArray(l.center),r.boundingSphere=new Ui(t,l.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}});const Sf={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Tf(t){xd.call(this,t)}Tf.prototype=Object.assign(Object.create(xd.prototype),{constructor:Tf,load:function(t,e,n,i){const r=this,o=""===this.path?bf.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||o;const s=new _d(r.manager);s.setPath(this.path),s.load(t,function(n){let o=null;try{o=JSON.parse(n)}catch(e){return void 0!==i&&i(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const s=o.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?r.parse(o,e):console.error("THREE.ObjectLoader: Can't load "+t)},n,i)},parse:function(t,e){const n=this.parseShape(t.shapes),i=this.parseGeometries(t.geometries,n),r=this.parseImages(t.images,function(){void 0!==e&&e(a)}),o=this.parseTextures(t.textures,r),s=this.parseMaterials(t.materials,o),a=this.parseObject(t.object,i,s);return t.animations&&(a.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(a),a},parseShape:function(t){const e={};if(void 0!==t)for(let n=0,i=t.length;n<i;n++){const i=(new rf).fromJSON(t[n]);e[i.uuid]=i}return e},parseGeometries:function(t,e){const n={};let i;if(void 0!==t){const r=new Mf;for(let o=0,s=t.length;o<s;o++){let s;const a=t[o];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new kp[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new kp[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new kp[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new kp[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new kp[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new kp[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new kp[a.type](a.radius,a.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new kp[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new kp[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new kp[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case"TubeGeometry":case"TubeBufferGeometry":s=new kp[a.type]((new tf[a.path.type]).fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed);break;case"LatheGeometry":case"LatheBufferGeometry":s=new kp[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new kp[a.type](a.vertices,a.indices,a.radius,a.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":i=[];for(let t=0,n=a.shapes.length;t<n;t++){const n=e[a.shapes[t]];i.push(n)}s=new kp[a.type](i,a.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":i=[];for(let t=0,n=a.shapes.length;t<n;t++){const n=e[a.shapes[t]];i.push(n)}const t=a.options.extrudePath;void 0!==t&&(a.options.extrudePath=(new tf[t.type]).fromJSON(t)),s=new kp[a.type](i,a.options);break;case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(a);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+a.type+'"');continue}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),!0===s.isBufferGeometry&&void 0!==a.userData&&(s.userData=a.userData),n[a.uuid]=s}}return n},parseMaterials:function(t,e){const n={},i={};if(void 0!==t){const r=new xf;r.setTextures(e);for(let e=0,o=t.length;e<o;e++){const o=t[e];if("MultiMaterial"===o.type){const t=[];for(let e=0;e<o.materials.length;e++){const i=o.materials[e];void 0===n[i.uuid]&&(n[i.uuid]=r.parse(i)),t.push(n[i.uuid])}i[o.uuid]=t}else void 0===n[o.uuid]&&(n[o.uuid]=r.parse(o)),i[o.uuid]=n[o.uuid]}}return i},parseAnimations:function(t){const e=[];for(let n=0;n<t.length;n++){const i=t[n],r=dd.parse(i);void 0!==i.uuid&&(r.uuid=i.uuid),e.push(r)}return e},parseImages:function(t,e){const n=this,i={};let r;function o(t){return n.manager.itemStart(t),r.load(t,function(){n.manager.itemEnd(t)},void 0,function(){n.manager.itemError(t),n.manager.itemEnd(t)})}if(void 0!==t&&t.length>0){const s=new vd(e);(r=new Td(s)).setCrossOrigin(this.crossOrigin);for(let e=0,r=t.length;e<r;e++){const r=t[e],s=r.url;if(Array.isArray(s)){i[r.uuid]=[];for(let t=0,e=s.length;t<e;t++){const e=s[t],a=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e;i[r.uuid].push(o(a))}}else{const t=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r.url)?r.url:n.resourcePath+r.url;i[r.uuid]=o(t)}}}return i},parseTextures:function(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const i={};if(void 0!==t)for(let r=0,o=t.length;r<o;r++){const o=t[r];let s;void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===e[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image),(s=Array.isArray(e[o.image])?new gc(e[o.image]):new Hn(e[o.image])).needsUpdate=!0,s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.mapping&&(s.mapping=n(o.mapping,Ef)),void 0!==o.offset&&s.offset.fromArray(o.offset),void 0!==o.repeat&&s.repeat.fromArray(o.repeat),void 0!==o.center&&s.center.fromArray(o.center),void 0!==o.rotation&&(s.rotation=o.rotation),void 0!==o.wrap&&(s.wrapS=n(o.wrap[0],Af),s.wrapT=n(o.wrap[1],Af)),void 0!==o.format&&(s.format=o.format),void 0!==o.type&&(s.type=o.type),void 0!==o.encoding&&(s.encoding=o.encoding),void 0!==o.minFilter&&(s.minFilter=n(o.minFilter,Lf)),void 0!==o.magFilter&&(s.magFilter=n(o.magFilter,Lf)),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),void 0!==o.flipY&&(s.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(s.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(s.unpackAlignment=o.unpackAlignment),i[o.uuid]=s}return i},parseObject:function(t,e,n){let i,r,o;function s(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function a(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(n[r])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}switch(t.type){case"Scene":i=new _i,void 0!==t.background&&Number.isInteger(t.background)&&(i.background=new ur(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?i.fog=new xh(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(i.fog=new yh(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":i=new wo(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(i.focus=t.focus),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.filmGauge&&(i.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(i.filmOffset=t.filmOffset),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"OrthographicCamera":i=new pf(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"AmbientLight":i=new mf(t.color,t.intensity);break;case"DirectionalLight":i=new ff(t.color,t.intensity);break;case"PointLight":i=new uf(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":i=new gf(t.color,t.intensity,t.width,t.height);break;case"SpotLight":i=new lf(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":i=new sf(t.color,t.groundColor,t.intensity);break;case"LightProbe":i=(new yf).fromJSON(t);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":i=new ro(r=s(t.geometry),o=a(t.material));break;case"InstancedMesh":r=s(t.geometry),o=a(t.material);const e=t.count,n=t.instanceMatrix;(i=new Qh(r,o,e)).instanceMatrix=new _r(new Float32Array(n.array),16);break;case"LOD":i=new Hh;break;case"Line":i=new ru(s(t.geometry),a(t.material),t.mode);break;case"LineLoop":i=new cu(s(t.geometry),a(t.material));break;case"LineSegments":i=new au(s(t.geometry),a(t.material));break;case"PointCloud":case"Points":i=new fu(s(t.geometry),a(t.material));break;case"Sprite":i=new zh(a(t.material));break;case"Group":i=new ph;break;default:i=new bi}if(i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(i.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(i.matrixAutoUpdate=t.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.rotation&&i.rotation.fromArray(t.rotation),void 0!==t.quaternion&&i.quaternion.fromArray(t.quaternion),void 0!==t.scale&&i.scale.fromArray(t.scale)),void 0!==t.castShadow&&(i.castShadow=t.castShadow),void 0!==t.receiveShadow&&(i.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(i.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(i.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(i.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&i.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(i.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.frustumCulled&&(i.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(i.renderOrder=t.renderOrder),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.layers&&(i.layers.mask=t.layers),void 0!==t.children){const r=t.children;for(let t=0;t<r.length;t++)i.add(this.parseObject(r[t],e,n))}if("LOD"===t.type){void 0!==t.autoUpdate&&(i.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],r=i.getObjectByProperty("uuid",n.object);void 0!==r&&i.addLevel(r,n.distance)}}return i}});const Ef={UVMapping:300,CubeReflectionMapping:rt,CubeRefractionMapping:ot,EquirectangularReflectionMapping:st,EquirectangularRefractionMapping:at,CubeUVReflectionMapping:ct,CubeUVRefractionMapping:lt},Af={RepeatWrapping:ht,ClampToEdgeWrapping:ut,MirroredRepeatWrapping:pt},Lf={NearestFilter:dt,NearestMipmapNearestFilter:ft,NearestMipmapLinearFilter:gt,LinearFilter:yt,LinearMipmapNearestFilter:xt,LinearMipmapLinearFilter:_t};function Rf(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),xd.call(this,t),this.options={premultiplyAlpha:"none"}}function Pf(){this.type="ShapePath",this.color=new ur,this.subPaths=[],this.currentPath=null}function Cf(t){this.type="Font",this.data=t}function Of(t,e,n){const i=Array.from?Array.from(t):String(t).split(""),r=e/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,s=[];let a=0,c=0;for(let t=0;t<i.length;t++){const e=i[t];if("\n"===e)a=0,c-=o;else{const t=Df(e,r,a,c,n);a+=t.offsetX,s.push(t.path)}}return s}function Df(t,e,n,i,r){const o=r.glyphs[t]||r.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+r.familyName+".");const s=new Pf;let a,c,l,h,u,p,d,f;if(o.o){const t=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let r=0,o=t.length;r<o;){switch(t[r++]){case"m":a=t[r++]*e+n,c=t[r++]*e+i,s.moveTo(a,c);break;case"l":a=t[r++]*e+n,c=t[r++]*e+i,s.lineTo(a,c);break;case"q":l=t[r++]*e+n,h=t[r++]*e+i,u=t[r++]*e+n,p=t[r++]*e+i,s.quadraticCurveTo(u,p,l,h);break;case"b":l=t[r++]*e+n,h=t[r++]*e+i,u=t[r++]*e+n,p=t[r++]*e+i,d=t[r++]*e+n,f=t[r++]*e+i,s.bezierCurveTo(u,p,d,f,l,h)}}}return{offsetX:o.ha*e,path:s}}function If(t){xd.call(this,t)}let Nf;Rf.prototype=Object.assign(Object.create(xd.prototype),{constructor:Rf,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=gd.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;fetch(t).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,r.options)}).then(function(n){gd.add(t,n),e&&e(n),r.manager.itemEnd(t)}).catch(function(e){i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}),r.manager.itemStart(t)}}),Object.assign(Pf.prototype,{moveTo:function(t,e){return this.currentPath=new nf,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this},bezierCurveTo:function(t,e,n,i,r,o){return this.currentPath.bezierCurveTo(t,e,n,i,r,o),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function n(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n],r=new rf;r.curves=i.curves,e.push(r)}return e}function i(t,e){const n=e.length;let i=!1;for(let r=n-1,o=0;o<n;r=o++){let n=e[r],s=e[o],a=s.x-n.x,c=s.y-n.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(n=e[o],a=-a,s=e[r],c=-c),t.y<n.y||t.y>s.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=c*(t.x-n.x)-a*(t.y-n.y);if(0===e)return!0;if(e<0)continue;i=!i}}else{if(t.y!==n.y)continue;if(s.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=s.x)return!0}}return i}const r=vp.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return n(o);let s,a,c,l=[];if(1===o.length)return a=o[0],(c=new rf).curves=a.curves,l.push(c),l;let h=!r(o[0].getPoints());h=t?!h:h;const u=[],p=[];let d,f,m=[],g=0;p[g]=void 0,m[g]=[];for(let e=0,n=o.length;e<n;e++)s=r(d=(a=o[e]).getPoints()),(s=t?!s:s)?(!h&&p[g]&&g++,p[g]={s:new rf,p:d},p[g].s.curves=a.curves,h&&g++,m[g]=[]):m[g].push({h:a,p:d[0]});if(!p[0])return n(o);if(p.length>1){let t=!1;const e=[];for(let t=0,e=p.length;t<e;t++)u[t]=[];for(let n=0,r=p.length;n<r;n++){const r=m[n];for(let o=0;o<r.length;o++){const s=r[o];let a=!0;for(let r=0;r<p.length;r++)i(s.p,p[r].p)&&(n!==r&&e.push({froms:n,tos:r,hole:o}),a?(a=!1,u[r].push(s)):t=!0);a&&u[n].push(s)}}e.length>0&&(t||(m=u))}for(let t=0,e=p.length;t<e;t++){c=p[t].s,l.push(c);for(let e=0,n=(f=m[t]).length;e<n;e++)c.holes.push(f[e].h)}return l}}),Object.assign(Cf.prototype,{isFont:!0,generateShapes:function(t,e){void 0===e&&(e=100);const n=[],i=Of(t,e,this.data);for(let t=0,e=i.length;t<e;t++)Array.prototype.push.apply(n,i[t].toShapes());return n}}),If.prototype=Object.assign(Object.create(xd.prototype),{constructor:If,load:function(t,e,n,i){const r=this,o=new _d(this.manager);o.setPath(this.path),o.load(t,function(t){let n;try{n=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}const i=r.parse(n);e&&e(i)},n,i)},parse:function(t){return new Cf(t)}});const Bf={getContext:function(){return void 0===Nf&&(Nf=new(window.AudioContext||window.webkitAudioContext)),Nf},setContext:function(t){Nf=t}};function zf(t){xd.call(this,t)}function Uf(t,e,n){yf.call(this,void 0,n);const i=(new ur).set(t),r=(new ur).set(e),o=new Yn(i.r,i.g,i.b),s=new Yn(r.r,r.g,r.b),a=Math.sqrt(Math.PI),c=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(s).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(s).multiplyScalar(c)}function Ff(t,e){yf.call(this,void 0,e);const n=(new ur).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}zf.prototype=Object.assign(Object.create(xd.prototype),{constructor:zf,load:function(t,e,n,i){const r=this,o=new _d(r.manager);o.setResponseType("arraybuffer"),o.setPath(r.path),o.load(t,function(n){try{const o=n.slice(0);Bf.getContext().decodeAudioData(o,function(t){e(t)})}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}},n,i)}}),Uf.prototype=Object.assign(Object.create(yf.prototype),{constructor:Uf,isHemisphereLightProbe:!0,copy:function(t){return yf.prototype.copy.call(this,t),this},toJSON:function(t){return yf.prototype.toJSON.call(this,t)}}),Ff.prototype=Object.assign(Object.create(yf.prototype),{constructor:Ff,isAmbientLightProbe:!0,copy:function(t){return yf.prototype.copy.call(this,t),this},toJSON:function(t){return yf.prototype.toJSON.call(this,t)}});const Gf=new ni,Hf=new ni;function kf(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new wo,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new wo,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Vf(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(kf.prototype,{update:function(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const n=t.projectionMatrix.clone(),i=e.eyeSep/2,r=i*e.near/e.focus,o=e.near*Math.tan(Nn.DEG2RAD*e.fov*.5)/e.zoom;let s,a;Hf.elements[12]=-i,Gf.elements[12]=i,s=-o*e.aspect+r,a=o*e.aspect+r,n.elements[0]=2*e.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(n),s=-o*e.aspect-r,a=o*e.aspect-r,n.elements[0]=2*e.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Hf),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Gf)}}),Object.assign(Vf.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}});const jf=new Yn,Wf=new Wn,qf=new Yn,Xf=new Yn;function Yf(){bi.call(this),this.type="AudioListener",this.context=Bf.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Vf}function Zf(t){bi.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._progress=0,this.filters=[]}Yf.prototype=Object.assign(Object.create(bi.prototype),{constructor:Yf,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(t){bi.prototype.updateMatrixWorld.call(this,t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(jf,Wf,qf),Xf.set(0,0,-1).applyQuaternion(Wf),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(jf.x,t),e.positionY.linearRampToValueAtTime(jf.y,t),e.positionZ.linearRampToValueAtTime(jf.z,t),e.forwardX.linearRampToValueAtTime(Xf.x,t),e.forwardY.linearRampToValueAtTime(Xf.y,t),e.forwardZ.linearRampToValueAtTime(Xf.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition(jf.x,jf.y,jf.z),e.setOrientation(Xf.x,Xf.y,Xf.z,n.x,n.y,n.z)}}),Zf.prototype=Object.assign(Object.create(bi.prototype),{constructor:Zf,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setMediaStreamSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(t){if(void 0===t&&(t=0),!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}});const Jf=new Yn,Qf=new Wn,Kf=new Yn,$f=new Yn;function tm(t){Zf.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function em(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function nm(t,e,n){let i,r,o;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}tm.prototype=Object.assign(Object.create(Zf.prototype),{constructor:tm,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(t){if(bi.prototype.updateMatrixWorld.call(this,t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Jf,Qf,Kf),$f.set(0,0,1).applyQuaternion(Qf);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Jf.x,t),e.positionY.linearRampToValueAtTime(Jf.y,t),e.positionZ.linearRampToValueAtTime(Jf.z,t),e.orientationX.linearRampToValueAtTime($f.x,t),e.orientationY.linearRampToValueAtTime($f.y,t),e.orientationZ.linearRampToValueAtTime($f.z,t)}else e.setPosition(Jf.x,Jf.y,Jf.z),e.setOrientation($f.x,$f.y,$f.z)}}),Object.assign(em.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}),Object.assign(nm.prototype,{accumulate:function(t,e){const n=this.buffer,i=this.valueSize,r=t*i+i;let o=this.cumulativeWeight;if(0===o){for(let t=0;t!==i;++t)n[r+t]=n[t];o=e}else{const t=e/(o+=e);this._mixBufferRegion(n,r,0,t,i)}this.cumulativeWeight=o},accumulateAdditive:function(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t},apply:function(t){const e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(n,i,t,1-r,e)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(n[t]!==n[t+e]){s.setValue(n,i);break}},saveOriginalState:function(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let t=n,r=i;t!==r;++t)e[t]=e[i+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[4*this._addIndex+3]=1},_setAdditiveIdentityOther:function(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]},_select:function(t,e,n,i,r){if(i>=.5)for(let i=0;i!==r;++i)t[e+i]=t[n+i]},_slerp:function(t,e,n,i){Wn.slerpFlat(t,e,t,e,t,n,i)},_slerpAdditive:function(t,e,n,i,r){const o=this._workIndex*r;Wn.multiplyQuaternionsFlat(t,o,t,e,t,n),Wn.slerpFlat(t,e,t,e,t,o,i)},_lerp:function(t,e,n,i,r){const o=1-i;for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]*o+t[n+s]*i}},_lerpAdditive:function(t,e,n,i,r){for(let o=0;o!==r;++o){const r=e+o;t[r]=t[r]+t[n+o]*i}}});const im="\\[\\]\\.:\\/",rm=new RegExp("[\\[\\]\\.:\\/]","g"),om="[^\\[\\]\\.:\\/]",sm="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",am=/((?:WC+[\/:])*)/.source.replace("WC",om),cm=/(WCOD+)?/.source.replace("WCOD",sm),lm=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",om),hm=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",om),um=new RegExp("^"+am+cm+lm+hm+"$"),pm=["material","materials","bones"];function dm(t,e,n){const i=n||fm.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}function fm(t,e,n){this.path=e,this.parsedPath=n||fm.parseTrackName(e),this.node=fm.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function mm(){this.uuid=Nn.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}function gm(t,e,n,i){this._mixer=t,this._clip=e,this._localRoot=n||null,this.blendMode=i||e.blendMode;const r=e.tracks,o=r.length,s=new Array(o),a={endingStart:He,endingEnd:He};for(let t=0;t!==o;++t){const e=r[t].createInterpolant(null);s[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Be,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function vm(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function ym(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function xm(t,e,n){bh.call(this,t,e),this.meshPerAttribute=n||1}function bm(t,e,n,i){this.ray=new qi(t,e),this.near=n||0,this.far=i||1/0,this.camera=null,this.layers=new si,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function _m(t,e){return t.distance-e.distance}function wm(t,e,n,i){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===i){const i=t.children;for(let t=0,r=i.length;t<r;t++)wm(i[t],e,n,!0)}}function Mm(t,e,n){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==n?n:0,this}function Sm(t,e,n){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==n?n:0,this}Object.assign(dm.prototype,{getValue:function(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)},setValue:function(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)},bind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}),Object.assign(fm,{Composite:dm,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new fm.Composite(t,e,n):new fm(t,e,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(rm,"")},parseTrackName:function(t){const e=um.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==pm.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const o=n(r.children);if(o)return o}return null},i=n(t.children);if(i)return i}return null}}),Object.assign(fm.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]},function(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){let t=this.node,e=this.parsedPath,n=e.objectName,i=e.propertyName,r=e.propertyIndex;if(t||(t=fm.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const o=t[i];if(void 0===o){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",t)}let s=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(fm.prototype,{_getValue_unbound:fm.prototype.getValue,_setValue_unbound:fm.prototype.setValue}),Object.assign(mm.prototype,{isAnimationObjectGroup:!0,add:function(){const t=this._objects,e=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,o=r.length;let s=void 0,a=t.length,c=this.nCachedObjects_;for(let l=0,h=arguments.length;l!==h;++l){const h=arguments[l],u=h.uuid;let p=e[u];if(void 0===p){p=a++,e[u]=p,t.push(h);for(let t=0,e=o;t!==e;++t)r[t].push(new fm(h,n[t],i[t]))}else if(p<c){s=t[p];const a=--c,l=t[a];e[l.uuid]=p,t[p]=l,e[u]=a,t[a]=h;for(let t=0,e=o;t!==e;++t){const e=r[t],o=e[a];let s=e[p];e[p]=o,void 0===s&&(s=new fm(h,n[t],i[t])),e[a]=s}}else t[p]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c},remove:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o],a=s.uuid,c=e[a];if(void 0!==c&&c>=r){const o=r++,l=t[o];e[l.uuid]=c,t[c]=l,e[a]=o,t[o]=s;for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[o],r=e[c];e[c]=i,e[o]=r}}}this.nCachedObjects_=r},uncache:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,o=t.length;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s].uuid,c=e[a];if(void 0!==c)if(delete e[a],c<r){const s=--r,a=t[s],l=--o,h=t[l];e[a.uuid]=c,t[c]=a,e[h.uuid]=s,t[s]=h,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[s],r=e[l];e[c]=i,e[s]=r,e.pop()}}else{const r=--o,s=t[r];e[s.uuid]=c,t[c]=s,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t];e[c]=e[r],e.pop()}}}this.nCachedObjects_=r},subscribe_:function(t,e){let n=this._bindingsIndicesByPath,i=n[t],r=this._bindings;if(void 0!==i)return r[i];const o=this._paths,s=this._parsedPaths,a=this._objects,c=a.length,l=this.nCachedObjects_,h=new Array(c);i=r.length,n[t]=i,o.push(t),s.push(e),r.push(h);for(let n=l,i=a.length;n!==i;++n){const i=a[n];h[n]=new fm(i,t,e)}return h},unsubscribe_:function(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const i=this._paths,r=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];e[t[s]]=n,o[n]=a,o.pop(),r[n]=r[s],r.pop(),i[n]=i[s],i.pop()}}}),Object.assign(gm.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,i=t._clip.duration,r=i/n,o=n/i;t.warp(1,r,e),this.warp(o,1,e)}return this},crossFadeTo:function(t,e,n){return t.crossFadeFrom(this,e,n)},stopFading:function(){let t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,n){const i=this._mixer,r=i.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=i._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,c=s.sampleValues;return a[0]=r,a[1]=r+n,c[0]=t/o,c[1]=e/o,this},stopWarping:function(){let t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,n,i){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const i=(t-r)*n;if(i<0||0===n)return;this._startTime=null,e=n*i}e*=this._updateTimeScale(t);const o=this._updateTime(e),s=this._updateWeight(t);if(s>0){const t=this._interpolants,e=this._propertyBindings;switch(this.blendMode){case 2501:for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(o),e[n].accumulateAdditive(s);break;case je:default:for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(o),e[n].accumulate(i,s)}}},_updateWeight:function(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e},_updateTime:function(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,r=this._loopCount;const o=2202===n;if(0===t)return-1===r?i:o&&1==(1&r)?e-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i>=e||i<0){const n=Math.floor(i/e);i-=e*n,r+=Math.abs(n);const s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){const e=t<0;this._setEndings(e,!e,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(o&&1==(1&r))return e-i}return i},_setEndings:function(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=2401,i.endingEnd=2401):(i.endingStart=t?this.zeroSlopeAtStart?2401:He:2402,i.endingEnd=e?this.zeroSlopeAtEnd?2401:He:2402)},_scheduleFading:function(t,e,n){const i=this._mixer,r=i.time;let o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=r,a[0]=e,s[1]=r+t,a[1]=n,this}}),vm.prototype=Object.assign(Object.create(Dn.prototype),{constructor:vm,_bindAction:function(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,o=t._propertyBindings,s=t._interpolants,a=n.uuid,c=this._bindingsByRootAndName;let l=c[a];void 0===l&&(l={},c[a]=l);for(let t=0;t!==r;++t){const r=i[t],c=r.name;let h=l[c];if(void 0!==h)o[t]=h;else{if(void 0!==(h=o[t])){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,c));continue}const i=e&&e._propertyBindings[t].binding.parsedPath;++(h=new nm(fm.create(n,c,i),r.ValueTypeName,r.getValueSize())).referenceCount,this._addInactiveBinding(h,a,c),o[t]=h}s[t].resultBuffer=h.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,n){const i=this._actions,r=this._actionsByClip;let o=r[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=o;else{const e=o.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),o.actionByRoot[n]=t},_removeInactiveAction:function(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,o=this._actionsByClip,s=o[r],a=s.knownActions,c=a[a.length-1],l=t._byClipCacheIndex;c._byClipCacheIndex=l,a[l]=c,a.pop(),t._byClipCacheIndex=null,delete s.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete o[r],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_takeBackAction:function(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_addInactiveBinding:function(t,e,n){const i=this._bindingsByRootAndName,r=this._bindings;let o=i[e];void 0===o&&(o={},i[e]=o),o[n]=t,t._cacheIndex=r.length,r.push(t)},_removeInactiveBinding:function(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,s=o[i],a=e[e.length-1],c=t._cacheIndex;a._cacheIndex=c,e[c]=a,e.pop(),delete s[r],0===Object.keys(s).length&&delete o[i]},_lendBinding:function(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_takeBackBinding:function(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_lendControlInterpolant:function(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&((n=new id(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,n){const i=e||this._root,r=i.uuid;let o="string"==typeof t?dd.findByName(i,t):t;const s=null!==o?o.uuid:t;let a=this._actionsByClip[s],c=null;if(void 0===n&&(n=null!==o?o.blendMode:je),void 0!==a){const t=a.actionByRoot[r];if(void 0!==t&&t.blendMode===n)return t;c=a.knownActions[0],null===o&&(o=c._clip)}if(null===o)return null;const l=new gm(this,o,e,n);return this._bindAction(l,c),this._addInactiveAction(l,s,r),l},existingAction:function(t,e){const n=e||this._root,i=n.uuid,r="string"==typeof t?dd.findByName(n,t):t,o=r?r.uuid:t,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[i]||null},stopAllAction:function(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this},update:function(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),o=this._accuIndex^=1;for(let s=0;s!==n;++s){e[s]._update(i,t,r,o)}const s=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)s[t].apply(o);return this},setTime:function(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const t=r.knownActions;for(let n=0,i=t.length;n!==i;++n){const i=t[n];this._deactivateAction(i);const r=i._cacheIndex,o=e[e.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,o._cacheIndex=r,e[r]=o,e.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}},uncacheRoot:function(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const i=n[t].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[e];if(void 0!==i)for(const t in i){const e=i[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}},uncacheAction:function(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),ym.prototype.clone=function(){return new ym(void 0===this.value.clone?this.value:this.value.clone())},xm.prototype=Object.assign(Object.create(bh.prototype),{constructor:xm,isInstancedInterleavedBuffer:!0,copy:function(t){return bh.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},clone:function(t){const e=bh.prototype.clone.call(this,t);return e.meshPerAttribute=this.meshPerAttribute,e},toJSON:function(t){const e=bh.prototype.toJSON.call(this,t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}),Object.assign(bm.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,n){const i=n||[];return wm(t,this,i,e),i.sort(_m),i},intersectObjects:function(t,e,n){const i=n||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(let n=0,r=t.length;n<r;n++)wm(t[n],this,i,e);return i.sort(_m),i}}),Object.assign(Mm.prototype,{set:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Nn.clamp(e/this.radius,-1,1))),this}}),Object.assign(Sm.prototype,{set:function(t,e,n){return this.radius=t,this.theta=e,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}});const Tm=new Bn;function Em(t,e){this.min=void 0!==t?t:new Bn(1/0,1/0),this.max=void 0!==e?e:new Bn(-1/0,-1/0)}Object.assign(Em.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){const n=Tm.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Bn),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Bn),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Bn),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Bn),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return Tm.copy(t).clamp(this.min,this.max).sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});const Am=new Yn,Lm=new Yn;function Rm(t,e){this.start=void 0!==t?t:new Yn,this.end=void 0!==e?e:new Yn}function Pm(t){bi.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}Object.assign(Rm.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Yn),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Yn),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Yn),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,e){Am.subVectors(t,this.start),Lm.subVectors(this.end,this.start);const n=Lm.dot(Lm);let i=Lm.dot(Am)/n;return e&&(i=Nn.clamp(i,0,1)),i},closestPointToPoint:function(t,e,n){const i=this.closestPointToPointParameter(t,e);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Yn),this.delta(n).multiplyScalar(i).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),Pm.prototype=Object.create(bi.prototype),Pm.prototype.constructor=Pm,Pm.prototype.isImmediateRenderObject=!0;const Cm=new Yn;function Om(t,e){bi.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const n=new Gr,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,n=32;t<n;t++,e++){const r=t/n*Math.PI*2,o=e/n*Math.PI*2;i.push(Math.cos(r),Math.sin(r),1,Math.cos(o),Math.sin(o),1)}n.setAttribute("position",new Rr(i,3));const r=new Kh({fog:!1,toneMapped:!1});this.cone=new au(n,r),this.add(this.cone),this.update()}Om.prototype=Object.create(bi.prototype),Om.prototype.constructor=Om,Om.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Om.prototype.update=function(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Cm.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Cm),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};const Dm=new Yn,Im=new ni,Nm=new ni;function Bm(t){const e=[];t&&t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,Bm(t.children[n]));return e}function zm(t){const e=Bm(t),n=new Gr,i=[],r=[],o=new ur(0,0,1),s=new ur(0,1,0);for(let t=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(o.r,o.g,o.b),r.push(s.r,s.g,s.b))}n.setAttribute("position",new Rr(i,3)),n.setAttribute("color",new Rr(r,3));const a=new Kh({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});au.call(this,n,a),this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function Um(t,e,n){this.light=t,this.light.updateMatrixWorld(),this.color=n;const i=new Ap(e,4,2),r=new yr({wireframe:!0,fog:!1,toneMapped:!1});ro.call(this,i,r),this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}zm.prototype=Object.create(au.prototype),zm.prototype.constructor=zm,zm.prototype.isSkeletonHelper=!0,zm.prototype.updateMatrixWorld=function(t){const e=this.bones,n=this.geometry,i=n.getAttribute("position");Nm.getInverse(this.root.matrixWorld);for(let t=0,n=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(Im.multiplyMatrices(Nm,r.matrixWorld),Dm.setFromMatrixPosition(Im),i.setXYZ(n,Dm.x,Dm.y,Dm.z),Im.multiplyMatrices(Nm,r.parent.matrixWorld),Dm.setFromMatrixPosition(Im),i.setXYZ(n+1,Dm.x,Dm.y,Dm.z),n+=2)}n.getAttribute("position").needsUpdate=!0,bi.prototype.updateMatrixWorld.call(this,t)},Um.prototype=Object.create(ro.prototype),Um.prototype.constructor=Um,Um.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Um.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};const Fm=new Yn,Gm=new ur,Hm=new ur;function km(t,e,n){bi.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new Lu(e);i.rotateY(.5*Math.PI),this.material=new yr({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),o=new Float32Array(3*r.count);i.setAttribute("color",new _r(o,3)),this.add(new ro(i,this.material)),this.update()}function Vm(t,e,n,i){t=t||10,e=e||10,n=new ur(void 0!==n?n:4473924),i=new ur(void 0!==i?i:8947848);const r=e/2,o=t/e,s=t/2,a=[],c=[];for(let t=0,l=0,h=-s;t<=e;t++,h+=o){a.push(-s,0,h,s,0,h),a.push(h,0,-s,h,0,s);const e=t===r?n:i;e.toArray(c,l),l+=3,e.toArray(c,l),l+=3,e.toArray(c,l),l+=3,e.toArray(c,l),l+=3}const l=new Gr;l.setAttribute("position",new Rr(a,3)),l.setAttribute("color",new Rr(c,3));const h=new Kh({vertexColors:!0,toneMapped:!1});au.call(this,l,h),this.type="GridHelper"}function jm(t,e,n,i,r,o){t=t||10,e=e||16,n=n||8,i=i||64,r=new ur(void 0!==r?r:4473924),o=new ur(void 0!==o?o:8947848);const s=[],a=[];for(let n=0;n<=e;n++){const i=n/e*(2*Math.PI),c=Math.sin(i)*t,l=Math.cos(i)*t;s.push(0,0,0),s.push(c,0,l);const h=1&n?r:o;a.push(h.r,h.g,h.b),a.push(h.r,h.g,h.b)}for(let e=0;e<=n;e++){const c=1&e?r:o,l=t-t/n*e;for(let t=0;t<i;t++){let e=t/i*(2*Math.PI),n=Math.sin(e)*l,r=Math.cos(e)*l;s.push(n,0,r),a.push(c.r,c.g,c.b),e=(t+1)/i*(2*Math.PI),n=Math.sin(e)*l,r=Math.cos(e)*l,s.push(n,0,r),a.push(c.r,c.g,c.b)}}const c=new Gr;c.setAttribute("position",new Rr(s,3)),c.setAttribute("color",new Rr(a,3));const l=new Kh({vertexColors:!0,toneMapped:!1});au.call(this,c,l),this.type="PolarGridHelper"}km.prototype=Object.create(bi.prototype),km.prototype.constructor=km,km.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},km.prototype.update=function(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");Gm.copy(this.light.color),Hm.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const i=t<n/2?Gm:Hm;e.setXYZ(t,i.r,i.g,i.b)}e.needsUpdate=!0}t.lookAt(Fm.setFromMatrixPosition(this.light.matrixWorld).negate())},Vm.prototype=Object.assign(Object.create(au.prototype),{constructor:Vm,copy:function(t){return au.prototype.copy.call(this,t),this.geometry.copy(t.geometry),this.material.copy(t.material),this},clone:function(){return(new this.constructor).copy(this)}}),jm.prototype=Object.create(au.prototype),jm.prototype.constructor=jm;const Wm=new Yn,qm=new Yn,Xm=new Yn;function Ym(t,e,n){bi.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);let i=new Gr;i.setAttribute("position",new Rr([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new Kh({fog:!1,toneMapped:!1});this.lightPlane=new ru(i,r),this.add(this.lightPlane),(i=new Gr).setAttribute("position",new Rr([0,0,0,0,0,1],3)),this.targetLine=new ru(i,r),this.add(this.targetLine),this.update()}Ym.prototype=Object.create(bi.prototype),Ym.prototype.constructor=Ym,Ym.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Ym.prototype.update=function(){Wm.setFromMatrixPosition(this.light.matrixWorld),qm.setFromMatrixPosition(this.light.target.matrixWorld),Xm.subVectors(qm,Wm),this.lightPlane.lookAt(qm),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(qm),this.targetLine.scale.z=Xm.length()};const Zm=new Yn,Jm=new _o;function Qm(t){const e=new Gr,n=new Kh({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],o={},s=new ur(16755200),a=new ur(16711680),c=new ur(43775),l=new ur(16777215),h=new ur(3355443);function u(t,e,n){p(t,n),p(e,n)}function p(t,e){i.push(0,0,0),r.push(e.r,e.g,e.b),void 0===o[t]&&(o[t]=[]),o[t].push(i.length/3-1)}u("n1","n2",s),u("n2","n4",s),u("n4","n3",s),u("n3","n1",s),u("f1","f2",s),u("f2","f4",s),u("f4","f3",s),u("f3","f1",s),u("n1","f1",s),u("n2","f2",s),u("n3","f3",s),u("n4","f4",s),u("p","n1",a),u("p","n2",a),u("p","n3",a),u("p","n4",a),u("u1","u2",c),u("u2","u3",c),u("u3","u1",c),u("c","t",l),u("p","c",h),u("cn1","cn2",h),u("cn3","cn4",h),u("cf1","cf2",h),u("cf3","cf4",h),e.setAttribute("position",new Rr(i,3)),e.setAttribute("color",new Rr(r,3)),au.call(this,e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function Km(t,e,n,i,r,o,s){Zm.set(r,o,s).unproject(i);const a=e[t];if(void 0!==a){const t=n.getAttribute("position");for(let e=0,n=a.length;e<n;e++)t.setXYZ(a[e],Zm.x,Zm.y,Zm.z)}}Qm.prototype=Object.create(au.prototype),Qm.prototype.constructor=Qm,Qm.prototype.update=function(){const t=this.geometry,e=this.pointMap;Jm.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Km("c",e,t,Jm,0,0,-1),Km("t",e,t,Jm,0,0,1),Km("n1",e,t,Jm,-1,-1,-1),Km("n2",e,t,Jm,1,-1,-1),Km("n3",e,t,Jm,-1,1,-1),Km("n4",e,t,Jm,1,1,-1),Km("f1",e,t,Jm,-1,-1,1),Km("f2",e,t,Jm,1,-1,1),Km("f3",e,t,Jm,-1,1,1),Km("f4",e,t,Jm,1,1,1),Km("u1",e,t,Jm,.7,1.1,-1),Km("u2",e,t,Jm,-.7,1.1,-1),Km("u3",e,t,Jm,0,2,-1),Km("cf1",e,t,Jm,-1,0,1),Km("cf2",e,t,Jm,1,0,1),Km("cf3",e,t,Jm,0,-1,1),Km("cf4",e,t,Jm,0,1,1),Km("cn1",e,t,Jm,-1,0,-1),Km("cn2",e,t,Jm,1,0,-1),Km("cn3",e,t,Jm,0,-1,-1),Km("cn4",e,t,Jm,0,1,-1),t.getAttribute("position").needsUpdate=!0};const $m=new Ni;function tg(t,e){this.object=t,void 0===e&&(e=16776960);const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new Gr;r.setIndex(new _r(n,1)),r.setAttribute("position",new _r(i,3)),au.call(this,r,new Kh({color:e,toneMapped:!1})),this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}function eg(t,e){this.type="Box3Helper",this.box=t,e=e||16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Gr;i.setIndex(new _r(n,1)),i.setAttribute("position",new Rr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),au.call(this,i,new Kh({color:e,toneMapped:!1})),this.type="Box3Helper",this.geometry.computeBoundingSphere()}function ng(t,e,n){this.plane=t,this.size=void 0===e?1:e;const i=void 0!==n?n:16776960,r=new Gr;r.setAttribute("position",new Rr([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),ru.call(this,r,new Kh({color:i,toneMapped:!1})),this.type="PlaneHelper";const o=new Gr;o.setAttribute("position",new Rr([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new ro(o,new yr({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}tg.prototype=Object.create(au.prototype),tg.prototype.constructor=tg,tg.prototype.update=function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&$m.setFromObject(this.object),$m.isEmpty())return;const e=$m.min,n=$m.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=e.x,r[4]=n.y,r[5]=n.z,r[6]=e.x,r[7]=e.y,r[8]=n.z,r[9]=n.x,r[10]=e.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=e.z,r[15]=e.x,r[16]=n.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=n.x,r[22]=e.y,r[23]=e.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()},tg.prototype.setFromObject=function(t){return this.object=t,this.update(),this},tg.prototype.copy=function(t){return au.prototype.copy.call(this,t),this.object=t.object,this},tg.prototype.clone=function(){return(new this.constructor).copy(this)},eg.prototype=Object.create(au.prototype),eg.prototype.constructor=eg,eg.prototype.updateMatrixWorld=function(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),bi.prototype.updateMatrixWorld.call(this,t))},ng.prototype=Object.create(ru.prototype),ng.prototype.constructor=ng,ng.prototype.updateMatrixWorld=function(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?f:d,this.lookAt(this.plane.normal),bi.prototype.updateMatrixWorld.call(this,t)};const ig=new Yn;let rg,og;function sg(t,e,n,i,r,o){bi.call(this),this.type="ArrowHelper",void 0===t&&(t=new Yn(0,0,1)),void 0===e&&(e=new Yn(0,0,0)),void 0===n&&(n=1),void 0===i&&(i=16776960),void 0===r&&(r=.2*n),void 0===o&&(o=.2*r),void 0===rg&&((rg=new Gr).setAttribute("position",new Rr([0,0,0,0,1,0],3)),(og=new zp(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new ru(rg,new Kh({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ro(og,new yr({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,r,o)}function ag(t){const e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new Gr;n.setAttribute("position",new Rr(e,3)),n.setAttribute("color",new Rr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));const i=new Kh({vertexColors:!0,toneMapped:!1});au.call(this,n,i),this.type="AxesHelper"}sg.prototype=Object.create(bi.prototype),sg.prototype.constructor=sg,sg.prototype.setDirection=function(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{ig.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(ig,e)}},sg.prototype.setLength=function(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()},sg.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},sg.prototype.copy=function(t){return bi.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},sg.prototype.clone=function(){return(new this.constructor).copy(this)},ag.prototype=Object.create(au.prototype),ag.prototype.constructor=ag;const cg=4,lg=8,hg=Math.pow(2,lg),ug=[.125,.215,.35,.446,.526,.582],pg=lg-cg+1+ug.length,dg=20,fg={[Ze]:0,[Je]:1,[Ke]:2,[tn]:3,[en]:4,[nn]:5,[Qe]:6},mg=new pf,{_lodPlanes:gg,_sizeLods:vg,_sigmas:yg}=Tg();let xg=null;const bg=(1+Math.sqrt(5))/2,_g=1/bg,wg=[new Yn(1,1,1),new Yn(-1,1,1),new Yn(1,1,-1),new Yn(-1,1,-1),new Yn(0,bg,_g),new Yn(0,bg,-_g),new Yn(_g,0,bg),new Yn(-_g,0,bg),new Yn(bg,_g,0),new Yn(-bg,_g,0)];function Mg(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=Lg(dg),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}function Sg(t){return void 0!==t&&t.type===Mt&&(t.encoding===Ze||t.encoding===Je||t.encoding===Qe)}function Tg(){const t=[],e=[],n=[];let i=lg;for(let r=0;r<pg;r++){const o=Math.pow(2,i);e.push(o);let s=1/o;r>lg-cg?s=ug[r-lg+cg-1]:0==r&&(s=0),n.push(s);const a=1/(o-1),c=-a/2,l=1+a/2,h=[c,c,l,c,l,l,c,c,l,l,c,l],u=6,p=6,d=3,f=2,m=1,g=new Float32Array(d*p*u),v=new Float32Array(f*p*u),y=new Float32Array(m*p*u);for(let t=0;t<u;t++){const e=t%3*2/3-1,n=t>2?0:-1,i=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];g.set(i,d*p*t),v.set(h,f*p*t);const r=[t,t,t,t,t,t];y.set(r,m*p*t)}const x=new Gr;x.setAttribute("position",new _r(g,d)),x.setAttribute("uv",new _r(v,f)),x.setAttribute("faceIndex",new _r(y,m)),t.push(x),i>cg&&i--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}function Eg(t){const e=new Vn(3*hg,3*hg,t);return e.texture.mapping=ct,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Ag(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function Lg(t){return new jp({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(t)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new Yn(0,1,0)},inputEncoding:{value:fg[Ze]},outputEncoding:{value:fg[Ze]}},vertexShader:Cg(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n${Og()}\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvec3 getSample(float theta, vec3 axis) {\n\tfloat cosTheta = cos(theta);\n\t// Rodrigues' axis-angle rotation\n\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\treturn bilinearCubeUV(envMap, sampleDirection, mipInt);\n}\n\nvoid main() {\n\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\tif (all(equal(axis, vec3(0.0))))\n\t\taxis = vec3(vOutputDirection.z, 0.0, - vOutputDirection.x);\n\taxis = normalize(axis);\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb += weights[0] * getSample(0.0, axis);\n\tfor (int i = 1; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfloat theta = dTheta * float(i);\n\t\tgl_FragColor.rgb += weights[i] * getSample(-1.0 * theta, axis);\n\t\tgl_FragColor.rgb += weights[i] * getSample(theta, axis);\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:y,depthTest:!1,depthWrite:!1})}function Rg(){return new jp({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new Bn(1,1)},inputEncoding:{value:fg[Ze]},outputEncoding:{value:fg[Ze]}},vertexShader:Cg(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n${Og()}\n\n#include <common>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv = equirectUv( outputDirection );\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:y,depthTest:!1,depthWrite:!1})}function Pg(){return new jp({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:fg[Ze]},outputEncoding:{value:fg[Ze]}},vertexShader:Cg(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n${Og()}\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:y,depthTest:!1,depthWrite:!1})}function Cg(){return"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\n\n// RH coordinate system; PMREM face-indexing convention\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\t} else if (face == 2.0) {\n\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\t} else if (face == 5.0) {\n\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\t}\n\treturn direction;\n}\n\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t"}function Og(){return"\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t"}function Dg(t,e,n,i,r,o,s){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new mr(t,e,n,r,o,s)}Mg.prototype={constructor:Mg,fromScene:function(t,e=0,n=.1,i=100){xg=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r},fromEquirectangular:function(t){return this._fromTexture(t)},fromCubemap:function(t){return this._fromTexture(t)},compileCubemapShader:function(){null===this._cubemapShader&&(this._cubemapShader=Pg(),this._compileMaterial(this._cubemapShader))},compileEquirectangularShader:function(){null===this._equirectShader&&(this._equirectShader=Rg(),this._compileMaterial(this._equirectShader))},dispose:function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<gg.length;t++)gg[t].dispose()},_cleanup:function(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(xg),t.scissorTest=!1,Ag(t,0,0,t.width,t.height)},_fromTexture:function(t){xg=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e},_allocateTargets:function(t){const e={magFilter:dt,minFilter:dt,generateMipmaps:!1,type:Mt,format:Gt,encoding:Sg(t)?t.encoding:Ke,depthBuffer:!1,stencilBuffer:!1},n=Eg(e);return n.depthBuffer=!t,this._pingPongRenderTarget=Eg(e),n},_compileMaterial:function(t){const e=new ro(gg[0],t);this._renderer.compile(e,mg)},_sceneToCubeUV:function(t,e,n,i){const r=new wo(90,1,e,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],a=this._renderer,c=a.outputEncoding,l=a.toneMapping,h=a.getClearColor(),u=a.getClearAlpha();a.toneMapping=Q,a.outputEncoding=Ze;let p=t.background;if(p&&p.isColor){p.convertSRGBToLinear();const e=Math.max(p.r,p.g,p.b),n=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);p=p.multiplyScalar(Math.pow(2,-n));const i=(n+128)/255;a.setClearColor(p,i),t.background=null}for(let e=0;e<6;e++){const n=e%3;0==n?(r.up.set(0,o[e],0),r.lookAt(s[e],0,0)):1==n?(r.up.set(0,0,o[e]),r.lookAt(0,s[e],0)):(r.up.set(0,o[e],0),r.lookAt(0,0,s[e])),Ag(i,n*hg,e>2?hg:0,hg,hg),a.setRenderTarget(i),a.render(t,r)}a.toneMapping=l,a.outputEncoding=c,a.setClearColor(h,u)},_textureToCubeUV:function(t,e){const n=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=Pg()):null==this._equirectShader&&(this._equirectShader=Rg());const i=t.isCubeTexture?this._cubemapShader:this._equirectShader,r=new ro(gg[0],i),o=i.uniforms;o.envMap.value=t,t.isCubeTexture||o.texelSize.value.set(1/t.image.width,1/t.image.height),o.inputEncoding.value=fg[t.encoding],o.outputEncoding.value=fg[e.texture.encoding],Ag(e,0,0,3*hg,2*hg),n.setRenderTarget(e),n.render(r,mg)},_applyPMREM:function(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let e=1;e<pg;e++){const n=Math.sqrt(yg[e]*yg[e]-yg[e-1]*yg[e-1]),i=wg[(e-1)%wg.length];this._blur(t,e-1,e,n,i)}e.autoClear=n},_blur:function(t,e,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,i,"latitudinal",r),this._halfBlur(o,t,n,n,i,"longitudinal",r)},_halfBlur:function(t,e,n,i,r,o,s){const a=this._renderer,c=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const l=new ro(gg[i],c),h=c.uniforms,u=vg[n]-1,p=isFinite(r)?Math.PI/(2*u):2*Math.PI/(2*dg-1),d=r/p,f=isFinite(r)?1+Math.floor(3*d):dg;f>dg&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to ${dg}`);const m=[];let g=0;for(let t=0;t<dg;++t){const e=t/d,n=Math.exp(-e*e/2);m.push(n),0==t?g+=n:t<f&&(g+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;h.envMap.value=t.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===o,s&&(h.poleAxis.value=s),h.dTheta.value=p,h.mipInt.value=lg-n,h.inputEncoding.value=fg[t.texture.encoding],h.outputEncoding.value=fg[t.texture.encoding];const v=vg[i];Ag(e,3*Math.max(0,hg-2*v),(0===i?0:2*hg)+2*v*(i>lg-cg?i-lg+cg:0),3*v,2*v),a.setRenderTarget(e),a.render(l,mg)}};const Ig=0,Ng=1,Bg=0,zg=1,Ug=2;function Fg(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function Gg(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function Hg(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new fu(t,e)}function kg(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new zh(t)}function Vg(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new fu(t,e)}function jg(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new lu(t)}function Wg(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new lu(t)}function qg(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new lu(t)}function Xg(t,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Yn(t,e,n)}function Yg(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new _r(t,e).setUsage(Tn)}function Zg(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new wr(t,e)}function Jg(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Mr(t,e)}function Qg(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Sr(t,e)}function Kg(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Tr(t,e)}function $g(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Er(t,e)}function tv(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Ar(t,e)}function ev(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Lr(t,e)}function nv(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Rr(t,e)}function iv(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Pr(t,e)}function rv(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Bd.call(this,t),this.type="catmullrom",this.closed=!0}function ov(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Bd.call(this,t),this.type="catmullrom"}function sv(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Bd.call(this,t),this.type="catmullrom"}function av(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new ag(t)}function cv(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new tg(t,e)}function lv(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new au(new Np(t.geometry),new Kh({color:void 0!==e?e:16777215}))}function hv(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new au(new bu(t.geometry),new Kh({color:void 0!==e?e:16777215}))}function uv(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new _d(t)}function pv(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Sd(t)}function dv(t,e,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Eo(t,n)}Ld.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Ld.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(ef.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=new uo;for(let n=0,i=t.length;n<i;n++){const i=t[n];e.vertices.push(new Yn(i.x,i.y,i.z||0))}return e}}),Object.assign(nf.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),rv.prototype=Object.create(Bd.prototype),ov.prototype=Object.create(Bd.prototype),sv.prototype=Object.create(Bd.prototype),Object.assign(sv.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Vm.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},zm.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(xd.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),bf.extractUrlBase(t)}}),xd.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Tf.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}),Object.assign(Em.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Ni.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Ui.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Po.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Rm.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(Nn,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Nn.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Nn.ceilPowerOfTwo(t)}}),Object.assign(zn.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(ni.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Yn).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,n,i,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,i,n,r,o)}}),Ji.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Wn.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(qi.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(ar.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(ar,{barycoordFromPoint:function(t,e,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),ar.getBarycoord(t,e,n,i,r)},normal:function(t,e,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),ar.getNormal(t,e,n,i)}}),Object.assign(rf.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new bp(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Op(this,t)}}),Object.assign(Bn.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Yn.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(kn.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(uo.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(bi.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(bi.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(ro.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(ro.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Hh.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Wh.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),kh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Ld.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),wo.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(of.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(_r.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Tn},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Tn)}}}),Object.assign(_r.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Tn:Sn),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Gr.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new _r(e,arguments[2])))},addDrawCall:function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(Gr.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(_f.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(bm.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(bh.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Tn},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(bh.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Tn:Sn),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(_p.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(ym.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(vr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ur}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(Xp.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(bo.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(gh.prototype,{clearTarget:function(t,e,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,i)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(gh.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?Je:Ze}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(ah.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Vn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(Zf.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new zf).load(t,function(t){e.setBuffer(t)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),em.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},To.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};const fv={merge:function(t,e,n){let i;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),i=e.matrix,e=e.geometry),t.merge(e,i,n)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};function mv(){console.error("THREE.CanvasRenderer has been removed")}function gv(){console.error("THREE.JSONLoader has been removed.")}Fn.crossOrigin=void 0,Fn.loadTexture=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new Ad;r.setCrossOrigin(this.crossOrigin);const o=r.load(t,n,void 0,i);return e&&(o.mapping=e),o},Fn.loadTextureCube=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new Ed;r.setCrossOrigin(this.crossOrigin);const o=r.load(t,n,void 0,i);return e&&(o.mapping=e),o},Fn.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Fn.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const vv={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function yv(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"118"}})),exports.ACESFilmicToneMapping=et,exports.AddEquation=S,exports.AddOperation=J,exports.AdditiveAnimationBlendMode=2501,exports.AdditiveBlending=b,exports.AlphaFormat=Nt,exports.AlwaysDepth=H,exports.AlwaysStencilFunc=Mn,exports.AmbientLight=mf,exports.AmbientLightProbe=Ff,exports.AnimationClip=dd,exports.AnimationLoader=wd,exports.AnimationMixer=vm,exports.AnimationObjectGroup=mm,exports.AnimationUtils=td,exports.ArcCurve=Pd,exports.ArrayCamera=uh,exports.ArrowHelper=sg,exports.Audio=Zf,exports.AudioAnalyser=em,exports.AudioContext=Bf,exports.AudioListener=Yf,exports.AudioLoader=zf,exports.AxesHelper=ag,exports.AxisHelper=av,exports.BackSide=f,exports.BasicDepthPacking=rn,exports.BasicShadowMap=0,exports.BinaryTextureLoader=pv,exports.Bone=qh,exports.BooleanKeyframeTrack=sd,exports.BoundingBoxHelper=cv,exports.Box2=Em,exports.Box3=Ni,exports.Box3Helper=eg,exports.BoxBufferGeometry=fo,exports.BoxGeometry=po,exports.BoxHelper=tg,exports.BufferAttribute=_r,exports.BufferGeometry=Gr,exports.BufferGeometryLoader=Mf,exports.ByteType=St,exports.Cache=gd,exports.Camera=_o,exports.CameraHelper=Qm,exports.CanvasRenderer=mv,exports.CanvasTexture=yu,exports.CatmullRomCurve3=Bd,exports.CineonToneMapping=tt,exports.CircleBufferGeometry=Hp,exports.CircleGeometry=Gp,exports.ClampToEdgeWrapping=ut,exports.Clock=Vf,exports.ClosedSplineCurve3=rv,exports.Color=ur,exports.ColorKeyframeTrack=ad,exports.CompressedTexture=vu,exports.CompressedTextureLoader=Md,exports.ConeBufferGeometry=Fp,exports.ConeGeometry=Up,exports.CubeCamera=To,exports.CubeGeometry=po,exports.CubeReflectionMapping=rt,exports.CubeRefractionMapping=ot,exports.CubeTexture=gc,exports.CubeTextureLoader=Ed,exports.CubeUVReflectionMapping=ct,exports.CubeUVRefractionMapping=lt,exports.CubicBezierCurve=Xd,exports.CubicBezierCurve3=Yd,exports.CubicInterpolant=nd,exports.CullFaceBack=r,exports.CullFaceFront=o,exports.CullFaceFrontBack=3,exports.CullFaceNone=i,exports.Curve=Ld,exports.CurvePath=ef,exports.CustomBlending=M,exports.CustomToneMapping=nt,exports.CylinderBufferGeometry=zp,exports.CylinderGeometry=Bp,exports.Cylindrical=Sm,exports.DataTexture=Ao,exports.DataTexture2DArray=vc,exports.DataTexture3D=yc,exports.DataTextureLoader=Sd,exports.DecrementStencilOp=7683,exports.DecrementWrapStencilOp=34056,exports.DefaultLoadingManager=yd,exports.DepthFormat=Ht,exports.DepthStencilFormat=kt,exports.DepthTexture=xu,exports.DirectionalLight=ff,exports.DirectionalLightHelper=Ym,exports.DirectionalLightShadow=df,exports.DiscreteInterpolant=rd,exports.DodecahedronBufferGeometry=Ou,exports.DodecahedronGeometry=Cu,exports.DoubleSide=m,exports.DstAlphaFactor=N,exports.DstColorFactor=z,exports.DynamicBufferAttribute=Yg,exports.DynamicCopyUsage=35050,exports.DynamicDrawUsage=Tn,exports.DynamicReadUsage=35049,exports.EdgesGeometry=Np,exports.EdgesHelper=lv,exports.EllipseCurve=Rd,exports.EqualDepth=j,exports.EqualStencilFunc=514,exports.EquirectangularReflectionMapping=st,exports.EquirectangularRefractionMapping=at,exports.Euler=oi,exports.EventDispatcher=Dn,exports.ExtrudeBufferGeometry=_p,exports.ExtrudeGeometry=bp,exports.Face3=mr,exports.Face4=Dg,exports.FaceColors=1,exports.FileLoader=_d,exports.FlatShading=1,exports.Float32Attribute=nv,exports.Float32BufferAttribute=Rr,exports.Float64Attribute=iv,exports.Float64BufferAttribute=Pr,exports.FloatType=Rt,exports.Fog=xh,exports.FogExp2=yh,exports.Font=Cf,exports.FontLoader=If,exports.FrontFaceDirectionCCW=1,exports.FrontFaceDirectionCW=0,exports.FrontSide=d,exports.Frustum=Po,exports.GammaEncoding=Qe,exports.Geometry=uo,exports.GeometryUtils=fv,exports.GreaterDepth=q,exports.GreaterEqualDepth=W,exports.GreaterEqualStencilFunc=518,exports.GreaterStencilFunc=516,exports.GridHelper=Vm,exports.Group=ph,exports.HalfFloatType=Pt,exports.HemisphereLight=sf,exports.HemisphereLightHelper=km,exports.HemisphereLightProbe=Uf,exports.IcosahedronBufferGeometry=Pu,exports.IcosahedronGeometry=Ru,exports.ImageBitmapLoader=Rf,exports.ImageLoader=Td,exports.ImageUtils=Fn,exports.ImmediateRenderObject=Pm,exports.IncrementStencilOp=7682,exports.IncrementWrapStencilOp=34055,exports.InstancedBufferAttribute=wf,exports.InstancedBufferGeometry=_f,exports.InstancedInterleavedBuffer=xm,exports.InstancedMesh=Qh,exports.Int16Attribute=Kg,exports.Int16BufferAttribute=Tr,exports.Int32Attribute=tv,exports.Int32BufferAttribute=Ar,exports.Int8Attribute=Zg,exports.Int8BufferAttribute=wr,exports.IntType=At,exports.InterleavedBuffer=bh,exports.InterleavedBufferAttribute=wh,exports.Interpolant=ed,exports.InterpolateDiscrete=2300,exports.InterpolateLinear=2301,exports.InterpolateSmooth=2302,exports.InvertStencilOp=5386,exports.JSONLoader=gv,exports.KeepStencilOp=ln,exports.KeyframeTrack=od,exports.LOD=Hh,exports.LatheBufferGeometry=Cp,exports.LatheGeometry=Pp,exports.Layers=si,exports.LensFlare=yv,exports.LessDepth=k,exports.LessEqualDepth=V,exports.LessEqualStencilFunc=515,exports.LessStencilFunc=513,exports.Light=of,exports.LightProbe=yf,exports.LightShadow=af,exports.Line=ru,exports.Line3=Rm,exports.LineBasicMaterial=Kh,exports.LineCurve=Zd,exports.LineCurve3=Jd,exports.LineDashedMaterial=Kp,exports.LineLoop=cu,exports.LinePieces=1,exports.LineSegments=au,exports.LineStrip=0,exports.LinearEncoding=Ze,exports.LinearFilter=yt,exports.LinearInterpolant=id,exports.LinearMipMapLinearFilter=1008,exports.LinearMipMapNearestFilter=1007,exports.LinearMipmapLinearFilter=_t,exports.LinearMipmapNearestFilter=xt,exports.LinearToneMapping=K,exports.Loader=xd,exports.LoaderUtils=bf,exports.LoadingManager=vd,exports.LogLuvEncoding=$e,exports.LoopOnce=2200,exports.LoopPingPong=2202,exports.LoopRepeat=Be,exports.LuminanceAlphaFormat=Ft,exports.LuminanceFormat=Ut,exports.MOUSE=e,exports.Material=vr,exports.MaterialLoader=xf,exports.Math=Nn,exports.MathUtils=Nn,exports.Matrix3=zn,exports.Matrix4=ni,exports.MaxEquation=L,exports.Mesh=ro,exports.MeshBasicMaterial=yr,exports.MeshDepthMaterial=ih,exports.MeshDistanceMaterial=rh,exports.MeshFaceMaterial=Fg,exports.MeshLambertMaterial=Jp,exports.MeshMatcapMaterial=Qp,exports.MeshNormalMaterial=Zp,exports.MeshPhongMaterial=Xp,exports.MeshPhysicalMaterial=qp,exports.MeshStandardMaterial=Wp,exports.MeshToonMaterial=Yp,exports.MinEquation=A,exports.MirroredRepeatWrapping=pt,exports.MixOperation=Z,exports.MultiMaterial=Gg,exports.MultiplyBlending=w,exports.MultiplyOperation=Y,exports.NearestFilter=dt,exports.NearestMipMapLinearFilter=1005,exports.NearestMipMapNearestFilter=1004,exports.NearestMipmapLinearFilter=gt,exports.NearestMipmapNearestFilter=ft,exports.NeverDepth=G,exports.NeverStencilFunc=512,exports.NoBlending=y,exports.NoColors=0,exports.NoToneMapping=Q,exports.NormalAnimationBlendMode=je,exports.NormalBlending=x,exports.NotEqualDepth=X,exports.NotEqualStencilFunc=517,exports.NumberKeyframeTrack=cd,exports.Object3D=bi,exports.ObjectLoader=Tf,exports.ObjectSpaceNormalMap=an,exports.OctahedronBufferGeometry=Lu,exports.OctahedronGeometry=Au,exports.OneFactor=P,exports.OneMinusDstAlphaFactor=B,exports.OneMinusDstColorFactor=U,exports.OneMinusSrcAlphaFactor=I,exports.OneMinusSrcColorFactor=O,exports.OrthographicCamera=pf,exports.PCFShadowMap=h,exports.PCFSoftShadowMap=u,exports.PMREMGenerator=Mg,exports.ParametricBufferGeometry=wu,exports.ParametricGeometry=_u,exports.Particle=kg,exports.ParticleBasicMaterial=Wg,exports.ParticleSystem=Vg,exports.ParticleSystemMaterial=qg,exports.Path=nf,exports.PerspectiveCamera=wo,exports.Plane=Ji,exports.PlaneBufferGeometry=No,exports.PlaneGeometry=Io,exports.PlaneHelper=ng,exports.PointCloud=Hg,exports.PointCloudMaterial=jg,exports.PointLight=uf,exports.PointLightHelper=Um,exports.Points=fu,exports.PointsMaterial=lu,exports.PolarGridHelper=jm,exports.PolyhedronBufferGeometry=Su,exports.PolyhedronGeometry=Mu,exports.PositionalAudio=tm,exports.PropertyBinding=fm,exports.PropertyMixer=nm,exports.QuadraticBezierCurve=Qd,exports.QuadraticBezierCurve3=Kd,exports.Quaternion=Wn,exports.QuaternionKeyframeTrack=hd,exports.QuaternionLinearInterpolant=ld,exports.REVISION="118",exports.RGBADepthPacking=on,exports.RGBAFormat=zt,exports.RGBAIntegerFormat=Yt,exports.RGBA_ASTC_10x10_Format=ve,exports.RGBA_ASTC_10x5_Format=fe,exports.RGBA_ASTC_10x6_Format=me,exports.RGBA_ASTC_10x8_Format=ge,exports.RGBA_ASTC_12x10_Format=ye,exports.RGBA_ASTC_12x12_Format=xe,exports.RGBA_ASTC_4x4_Format=se,exports.RGBA_ASTC_5x4_Format=ae,exports.RGBA_ASTC_5x5_Format=ce,exports.RGBA_ASTC_6x5_Format=le,exports.RGBA_ASTC_6x6_Format=he,exports.RGBA_ASTC_8x5_Format=ue,exports.RGBA_ASTC_8x6_Format=pe,exports.RGBA_ASTC_8x8_Format=de,exports.RGBA_BPTC_Format=be,exports.RGBA_ETC2_EAC_Format=oe,exports.RGBA_PVRTC_2BPPV1_Format=ne,exports.RGBA_PVRTC_4BPPV1_Format=ee,exports.RGBA_S3TC_DXT1_Format=Jt,exports.RGBA_S3TC_DXT3_Format=Qt,exports.RGBA_S3TC_DXT5_Format=Kt,exports.RGBDEncoding=nn,exports.RGBEEncoding=Ke,exports.RGBEFormat=Gt,exports.RGBFormat=Bt,exports.RGBIntegerFormat=Xt,exports.RGBM16Encoding=en,exports.RGBM7Encoding=tn,exports.RGB_ETC1_Format=ie,exports.RGB_ETC2_Format=re,exports.RGB_PVRTC_2BPPV1_Format=te,exports.RGB_PVRTC_4BPPV1_Format=$t,exports.RGB_S3TC_DXT1_Format=Zt,exports.RGFormat=Wt,exports.RGIntegerFormat=qt,exports.RawShaderMaterial=jp,exports.Ray=qi,exports.Raycaster=bm,exports.RectAreaLight=gf,exports.RedFormat=Vt,exports.RedIntegerFormat=jt,exports.ReinhardToneMapping=$,exports.RepeatWrapping=ht,exports.ReplaceStencilOp=7681,exports.ReverseSubtractEquation=E,exports.RingBufferGeometry=Rp,exports.RingGeometry=Lp,exports.SRGB8_ALPHA8_ASTC_10x10_Format=Oe,exports.SRGB8_ALPHA8_ASTC_10x5_Format=Re,exports.SRGB8_ALPHA8_ASTC_10x6_Format=Pe,exports.SRGB8_ALPHA8_ASTC_10x8_Format=Ce,exports.SRGB8_ALPHA8_ASTC_12x10_Format=De,exports.SRGB8_ALPHA8_ASTC_12x12_Format=Ie,exports.SRGB8_ALPHA8_ASTC_4x4_Format=_e,exports.SRGB8_ALPHA8_ASTC_5x4_Format=we,exports.SRGB8_ALPHA8_ASTC_5x5_Format=Me,exports.SRGB8_ALPHA8_ASTC_6x5_Format=Se,exports.SRGB8_ALPHA8_ASTC_6x6_Format=Te,exports.SRGB8_ALPHA8_ASTC_8x5_Format=Ee,exports.SRGB8_ALPHA8_ASTC_8x6_Format=Ae,exports.SRGB8_ALPHA8_ASTC_8x8_Format=Le,exports.Scene=_i,exports.SceneUtils=vv,exports.ShaderChunk=ec,exports.ShaderLib=nc,exports.ShaderMaterial=bo,exports.ShadowMaterial=Vp,exports.Shape=rf,exports.ShapeBufferGeometry=Dp,exports.ShapeGeometry=Op,exports.ShapePath=Pf,exports.ShapeUtils=vp,exports.ShortType=Tt,exports.Skeleton=Wh,exports.SkeletonHelper=zm,exports.SkinnedMesh=kh,exports.SmoothShading=2,exports.Sphere=Ui,exports.SphereBufferGeometry=Ap,exports.SphereGeometry=Ep,exports.Spherical=Mm,exports.SphericalHarmonics3=vf,exports.Spline=sv,exports.SplineCurve=$d,exports.SplineCurve3=ov,exports.SpotLight=lf,exports.SpotLightHelper=Om,exports.SpotLightShadow=cf,exports.Sprite=zh,exports.SpriteMaterial=Mh,exports.SrcAlphaFactor=D,exports.SrcAlphaSaturateFactor=F,exports.SrcColorFactor=C,exports.StaticCopyUsage=35046,exports.StaticDrawUsage=Sn,exports.StaticReadUsage=35045,exports.StereoCamera=kf,exports.StreamCopyUsage=35042,exports.StreamDrawUsage=35040,exports.StreamReadUsage=35041,exports.StringKeyframeTrack=ud,exports.SubtractEquation=T,exports.SubtractiveBlending=_,exports.TOUCH=n,exports.TangentSpaceNormalMap=sn,exports.TetrahedronBufferGeometry=Eu,exports.TetrahedronGeometry=Tu,exports.TextBufferGeometry=Tp,exports.TextGeometry=Sp,exports.Texture=Hn,exports.TextureLoader=Ad,exports.TorusBufferGeometry=Uu,exports.TorusGeometry=zu,exports.TorusKnotBufferGeometry=Bu,exports.TorusKnotGeometry=Nu,exports.Triangle=ar,exports.TriangleFanDrawMode=2,exports.TriangleStripDrawMode=1,exports.TrianglesDrawMode=0,exports.TubeBufferGeometry=Iu,exports.TubeGeometry=Du,exports.UVMapping=300,exports.Uint16Attribute=$g,exports.Uint16BufferAttribute=Er,exports.Uint32Attribute=ev,exports.Uint32BufferAttribute=Lr,exports.Uint8Attribute=Jg,exports.Uint8BufferAttribute=Mr,exports.Uint8ClampedAttribute=Qg,exports.Uint8ClampedBufferAttribute=Sr,exports.Uniform=ym,exports.UniformsLib=Co,exports.UniformsUtils=vo,exports.UnsignedByteType=Mt,exports.UnsignedInt248Type=It,exports.UnsignedIntType=Lt,exports.UnsignedShort4444Type=Ct,exports.UnsignedShort5551Type=Ot,exports.UnsignedShort565Type=Dt,exports.UnsignedShortType=Et,exports.VSMShadowMap=p,exports.Vector2=Bn,exports.Vector3=Yn,exports.Vector4=kn,exports.VectorKeyframeTrack=pd,exports.Vertex=Xg,exports.VertexColors=2,exports.VideoTexture=gu,exports.WebGL1Renderer=vh,exports.WebGLCubeRenderTarget=Eo,exports.WebGLMultisampleRenderTarget=jn,exports.WebGLRenderTarget=Vn,exports.WebGLRenderTargetCube=dv,exports.WebGLRenderer=gh,exports.WebGLUtils=hh,exports.WireframeGeometry=bu,exports.WireframeHelper=hv,exports.WrapAroundEnding=2402,exports.XHRLoader=uv,exports.ZeroCurvatureEnding=He,exports.ZeroFactor=R,exports.ZeroSlopeEnding=2401,exports.ZeroStencilOp=0,exports.sRGBEncoding=Je;
},{}],62:[function(require,module,exports) {
"use strict";var t=require("three");t.Object3D.prototype.copy=function(t,e){void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder;for(let t in this.userData)this.userData[t]=null;for(let e in t.userData)this.userData[e]=t.userData[e];if(!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this};
},{"three":74}],27:[function(require,module,exports) {
"use strict";require("array-flat-polyfill"),require("./util/patch-threejs-copy");
},{"array-flat-polyfill":64,"./util/patch-threejs-copy":62}],139:[function(require,module,exports) {
"use strict";function e(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function t(e,t=0){const n=new Array(e);for(let r=0;r<e;r++)n[r]=t;return n}function n(t,n){const r=t.indexOf(n);r>=0&&e(t,r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.spliceOne=e,exports.newArray=t,exports.spliceObject=n;
},{}],236:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=t=>t,e=()=>void 0,o=!1,s=!1,i=s?new Set:null;class a{constructor(o={}){const{renew:a=t,create:l=e,release:h=t,dispose:n=t,initialCapacity:c,name:p,maxCapacity:r=1/0}=o;this.name=p,s&&i.add(this),this._renew=a.bind(this),this._create=l.bind(this),this._release=h.bind(this),this._dispose=n.bind(this),this.pool=[],this.capacity=0,this.maxCapacity=r,void 0!==c&&this.expand(c)}next(){if(this.pool.length<=0&&this.expand(Math.round(.2*this.capacity)+1),0===this.pool.length)return;const t=this.pool.pop();return this._renew(t),t}release(t){this._release(t),this.pool.push(t)}expand(t=0){t=Math.max(0,Math.min(t,this.maxCapacity-this.capacity));for(let e=0;e<t;e++){const t=this._create();this.pool.push(t)}this.capacity+=t}dispose(){for(let t=0;t<this.pool.length;t++)this._dispose(this.pool[t]);this.pool.length=0,this.capacity=0}log(){const t=this.name?`${this.name} - `:"";console.log(`${t}Capacity: %d, Free: %d, Used: %d`,this.totalCapacity(),this.totalFree(),this.totalUsed())}totalCapacity(){return this.capacity}totalFree(){return this.pool.length}totalUsed(){return this.capacity-this.pool.length}}exports.default=a,Object.defineProperty(a,"isObjectPool",{enumerable:!0,writable:!0,value:!0}),s&&(window.logPools=(t=>{i.forEach(e=>{(!t||e.name&&e.name.toLowerCase().includes(t.toLowerCase()))&&(console.log(`Pool ${e.name||"(Untitled)"}:`),console.log("  Total Capacity:",e.totalCapacity()),console.log("  Total Free:",e.totalFree()),console.log("  Total Used:",e.totalUsed()))})}));
},{}],760:[function(require,module,exports) {
"use strict";function e(e,t){if(!e)return e;if(!t)return e.slice();t.length=e.length;for(let r=0;r<e.length;r++)t[r]=e[r];return t}function t(e,t){if(!e)return e;if(t)for(let e in t)t.hasOwnProperty(e)&&delete t[e];else t={};for(let r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function r(e){return e}function n(e,t){return e?t?t.copy(e):e.clone():e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.copyArray=e,exports.copyObject=t,exports.copyRef=r,exports.copyInstance=n;const o=exports.cloneInstance=(e=>e&&e.clone()),s=exports.cloneRef=(e=>e),i=exports.cloneArray=(e=>e&&e.slice()),c=exports.cloneObject=(e=>Object.assign({},e)),l=exports.Types={Object:(e={})=>({initial:e,clone:c,copy:t}),Array:(t=[])=>({initial:t,clone:i,copy:e}),Ref:e=>({initial:e,clone:s,copy:r})};class a{}exports.Tag=a,Object.defineProperty(a,"isTag",{enumerable:!0,writable:!0,value:!0});class u extends a{constructor(){super(),f(this.constructor,"value");const e=this.constructor.value;this.value=e.clone(e.initial)}reset(){const e=this.constructor.value;this.value=e.copy(e.initial,this.value)}}exports.Value=u,Object.defineProperty(u,"value",{enumerable:!0,writable:!0,value:l.Ref(null)}),Object.defineProperty(u,"isValue",{enumerable:!0,writable:!0,value:!0});class p extends a{constructor(){super();const e=this.constructor.data;for(let t in e)if(e.hasOwnProperty(t)){f(e,t);const r=e[t];this[t]=r.clone(r.initial)}}reset(){const e=this.constructor.data;for(let t in e)if(e.hasOwnProperty(t)){const r=e[t];this[t]=r.copy(r.initial,this[t])}}}function f(e,t){const r=e[t];if(Array.isArray(r))e[t]=l.Array(e[t]);else if("object"==typeof r&&r){if("function"!=typeof r.copy||"function"!=typeof r.clone)throw new Error("The static schema must be a Types value, or a primitive (number, boolean, string, shallow array, null/undefined)")}else e[t]=l.Ref(e[t])}exports.Data=p,Object.defineProperty(p,"data",{enumerable:!0,writable:!0,value:{}}),Object.defineProperty(p,"isData",{enumerable:!0,writable:!0,value:!0});
},{}],872:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=!1;class e{constructor(t){this.entity=t}get alive(){return!!this.entity&&this.entity.alive}kill(){this.entity&&this.entity.kill()}}class s{constructor(t){this._alive=!1,this._enabled=!0,this._entityManager=t,this.system=null,this.name=null,this.Tags=new Map,this._queuedEvents=0,this._refs=null,this._removeTagInstance=((t,e)=>{(e.isData||e.isValue)&&this._entityManager.releaseTag(e,t)})}ref(){const t=new e(this);return this._refs||(this._refs=[]),this._refs.push(t),t}reset(){this.removeAll(),this.system=null,this._alive=!1,this._enabled=!0,this.name=void 0,this._queuedEvents=0}add(e,s){if(!e)throw new Error("Must specify a Tag");if("function"!=typeof e)throw new Error("Tags must be functions or classes");let i;if(this.has(e)&&this._directRemoveTag(e),e.isData){i=this._entityManager.createTag(e);for(let a in s)if(s.hasOwnProperty(a))if(e.data.hasOwnProperty(a)){const t=e.data[a];i[a]=t.copy(s[a],i[a])}else t&&console.warn(`No property "${a}" found on the Data tag ${e.name}`)}else if(e.isValue){if(i=this._entityManager.createTag(e),void 0!==s){const t=e.value;i.value=t.copy(s,i.value)}}else i=e;return this.Tags.set(e,i),this._tagAdded(e),this}set(e,s){if(this.has(e)){if(e.isData){const i=this.getTag(e);for(let a in s)if(s.hasOwnProperty(a))if(e.data.hasOwnProperty(a)){const t=e.data[a];i[a]=t.copy(s[a],i[a])}else t&&console.warn(`No property "${a}" found on the Data tag ${e.name}`)}else if(e.isValue&&void 0!==s){const t=this.getTag(e),i=e.value;t.value=i.copy(s,t.value)}}else this.add(e,s);return this}_directRemoveTag(t){if(t.isData||t.isValue){const e=this.Tags.get(t);this._entityManager.releaseTag(t,e)}this.Tags.delete(t)}remove(t){return this.has(t)&&(this._directRemoveTag(t),this._tagRemoved(t)),this}removeAll(t){return this.Tags.size>0&&(this.Tags.forEach(this._removeTagInstance),this.Tags.clear(),this._update()),this}get(t){const e=this.getTag(t);return t.isValue?e.value:e}getTag(t){if(!this.has(t))throw new Error(`The Tag ${t.name} is not part of this Entity`);return this.Tags.get(t)}getTagEntries(){return Array.from(this.Tags.entries())}has(t){return this.Tags.has(t)}hasAll(t){for(let e=0;e<t.length;e++){const s=t[e];if(!this.has(s))return!1}return!0}hasAny(t){for(let e=0;e<t.length;e++){const s=t[e];if(this.has(s))return!0}return!1}get alive(){return this._alive}get enabled(){return this._enabled}get processed(){return 0===this._queuedEvents}tagOn(t,e){return this.has(t)||this.add(t,e),this}tagOff(t){return this.remove(t),this}enable(){return this._enabled||(this._enabled=!0,this._update()),this}disable(){return this._enabled&&(this._enabled=!1,this._update()),this}unmanage(){this.system&&(this.system._unmanage(this),this.system=null)}kill(){if(this.system&&this.unmanage(),this._alive&&(this._alive=!1,this._entityManager._markEntityForRemoval(this)),this._refs){for(let t=0;t<this._refs.length;t++)this._refs[t].entity=null;this._refs=null}return this}_tagAdded(t){this._update()}_tagRemoved(t){this._update()}_update(){this._entityManager._onEntityUpdated(this)}}exports.default=s;
},{}],873:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../util/array");const e=(()=>{const t=new WeakMap;let e=0;return function(s){return t.has(s)||t.set(s,e++),t.get(s)}})();class s{constructor(t,e){this.Tags=t,this.id=e,this._entities=[],this._listeners=null}equals(t){return this.id===t.id}get entities(){return this._entities}get names(){return this.Tags.map(t=>t.name)}_addEntity(t){this._entities.push(t),this._listeners&&this._listeners.forEach(e=>e(t,!0))}_removeEntity(e){const s=this._entities.indexOf(e);s>=0&&((0,t.spliceOne)(this._entities,s),this._listeners&&this._listeners.forEach(t=>t(e,!1)))}_addListener(t){this._listeners||(this._listeners=[]),this._listeners.push(t)}_removeListener(e){this._listeners&&(0,t.spliceObject)(this._listeners,e)}}s.prototype.isQuery=!0;class i{constructor(t){this._entityManager=t,this.queries={}}_buildQueryKey(t){if(Array.isArray(t)){const s=[];for(let i=0;i<t.length;i++)s.push(e(t[i]));return s.sort(),s.join(":")}return String(e(t))}_onEntityUpdated(t){for(let e in this.queries){const s=this.queries[e];this._updateQueryEntity(s,t)}}query(t){if(!t)throw new Error("You must pass a Tag, multiple Tags, or Query object to query()");if(t.isQuery)return t;const e=this._buildQueryKey(t);let i=this.queries[e];if(i)return i;const r=(Array.isArray(t)?t:[t]).filter(Boolean);if(0===r.length)throw new Error("Must specify at least one Tag for query()");const n=new s(r,e);return this._populateQuery(n),this.queries[e]=n,n}_populateQuery(t){for(let e=0;e<this._entityManager.entities.length;e++){const s=this._entityManager.entities[e];this._updateQueryEntity(t,s)}}_shouldEntityExistInQuery(t,e){return e.alive&&e.enabled&&e.hasAll(t.Tags)}_updateQueryEntity(t,e){const s=t.entities.indexOf(e)>=0;let i=this._shouldEntityExistInQuery(t,e);s!==i&&(i?t._addEntity(e):t._removeEntity(e))}}exports.default=i;
},{"../util/array":139}],848:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},t=require("../util/ObjectPool"),s=l(t),i=require("./Entity"),r=l(i),n=require("./QueryManager"),a=l(n),o=require("../util/array");function l(e){return e&&e.__esModule?e:{default:e}}class u extends s.default{constructor(t,s={}){super(e({},s,{initialCapacity:50,name:`TagPool-${t.name}`,create:()=>new t,release(e){"function"==typeof e.reset&&e.reset()}}))}}class c extends s.default{constructor(t,s={}){super(e({},s,{name:"Entities",create:()=>new r.default(t),release(e){e.reset()}}))}}class h{constructor({initialCapacity:e=0}={}){this._entities=[],this._entitiesToRemove=[],this._tagPools=new Map,this._entityPool=new c(this,{initialCapacity:e}),this._queryManager=new a.default(this)}query(e){return this._queryManager.query(e)}get entities(){return this._entities}entity(e,t){const s=this._entityPool.next();return s.reset(),s._alive=!0,s.name=e,s.system=t||null,this._entities.push(s),s}flush(){const e=this._entitiesToRemove;for(let t=e.length-1;t>=0;t--){const s=e[t];s.processed&&((0,o.spliceObject)(this._entities,s),s.removeAll(),this._entityPool.release(s),(0,o.spliceOne)(e,t))}}createTag(e){return this.getTagPool(e).next()}getTagPool(e){let t=this._tagPools.get(e);return t||(t=new u(e),this._tagPools.set(e,t)),t}releaseTag(e,t){const s=this._tagPools.get(e);s&&s.release(t)}_onEntityUpdated(e){this._queryManager._onEntityUpdated(e)}_markEntityForRemoval(e){this._entitiesToRemove.push(e),this._onEntityUpdated(e)}}exports.default=h;
},{"../util/ObjectPool":236,"./Entity":872,"./QueryManager":873,"../util/array":139}],849:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},t=require("../util/ObjectPool"),s=r(t),i=require("../util/array");function r(e){return e&&e.__esModule?e:{default:e}}class n{constructor(){this.entity=null,this.active=!0,this.added=!1}reset(e,t){this.entity=e,this.added=t,this.active=!0}prepare(){this.entity._queuedEvents++}process(){this.active&&(this.active=!1,this.entity._queuedEvents--)}}class h extends s.default{constructor(t={}){super(e({},t,{name:"QueryEvent",create:()=>new n}))}}class u{constructor(e){this.added=[],this.removing=[],this.changed=!1,this.query=e}dispose(){}}class a{constructor(e){this._eventPool=new h,this._unprocessed_queue=[],this.state=new u(e),this._attach()}_nextQueuedMatching(e){for(let t=0;t<this._unprocessed_queue.length;t++){const s=this._unprocessed_queue[t];if(s.active&&s.entity===e)return s}return null}_attach(){if(!this._handler){this._handler=((e,t)=>{const s=this._eventPool.next();s.reset(e,t),s.prepare(),this._unprocessed_queue.push(s)}),this.state.query._addListener(this._handler);for(let e=0;e<this.state.query.entities.length;e++){const t=this.state.query.entities[e];this._handler(t,!0)}}}detach(){this.poll(),this.flush(),this._handler&&(this.state.query._removeListener(this._handler),this._handler=null)}flush(){return this.state.added.length=0,this.state.removing.length=0,this.state.changed=!1,this}poll(){for(let e=0;e<this._unprocessed_queue.length;e++){const t=this._unprocessed_queue[e];t.active&&(t.process(),t.added?this.state.added.push(t.entity):this.state.removing.push(t.entity),this._eventPool.release(t),this.state.changed=!0)}return this._unprocessed_queue.length=0,this}}exports.default=a;
},{"../util/ObjectPool":236,"../util/array":139}],759:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Config=void 0,exports.default=y;var t=require("../util/array"),e=require("../util/ObjectPool"),s=l(e),i=require("./tag"),n=require("./EntityManager"),r=l(n),o=require("./QueryListener"),h=l(o);function l(t){return t&&t.__esModule?t:{default:t}}const a=!1,u=!1;function c(t){t()}function f(t){t.forEach(c)}function g(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then}function y(t={}){return new M(t)}function m(t){return`[${t.names.join(",")}]`}function _(t,e){if(0===e.length)throw new Error(`No singleton by the query ${m(t)}`);if(e.length>1)throw new Error(`Expected singleton, but found multiple entities by the query "${m(t)}`)}function d(t){const e=t.entities;return 1!==e.length&&_(t,e),e[0]}class p extends i.Data{}exports.Config=p,Object.defineProperty(p,"data",{enumerable:!0,writable:!0,value:{props:i.Types.Ref(),component:i.Types.Ref(),system:i.Types.Ref(),instance:i.Types.Ref()}});class w{constructor(t){this.query=t,this.view=t.entities.slice()}}function S(t,e){for(let s=0;s<t.length;s++)e[s]=t[s];e.length=t.length}class b{constructor(t,e){this.world=t,this.loading=!0,this.loaded=!1,this.promise=void 0,this.enabled=!0,this._info={name:void 0},this.System=e,this.instance=null,this._children=null,this._listeners=null,this._views=null}get name(){return this.info().name||this.System.name||"UntitledSystem"}info(){return 0===arguments.length?this._info:(Object.assign(this._info,arguments[0]),this)}_manage(t){this._children||(this._children=[]),this._children.push(t)}_unmanage(e){this._children&&(0,t.spliceObject)(this._children,e)}_dispose(){const t=this._listeners;if(t){for(let e=0;e<t.length;e++)t[e].detach();t.length=0}if(this._children)for(let t=this._children.length-1;t>=0;t--){const e=this._children[t];e.system=null,e.kill()}this._listeners=null,this._views=null,this._children=null}_poll(){if(this._views)for(let t=0;t<this._views.length;t++){const e=this._views[t];S(e.query.entities,e.view)}if(this._listeners)for(let t=0;t<this._listeners.length;t++)this._listeners[t].poll()}_flush(){if(this._listeners)for(let t=0;t<this._listeners.length;t++)this._listeners[t].flush()}}class v{constructor(t,e){this.root=t,this._system=e}subscribe(e){const s=this.root._subscribers;let i=()=>e(this._getSystemList());return s.push(i),i(),function(){i&&(0,t.spliceObject)(s,i),i=null}}get system(){return this._system}_fragment(t){return new v(this.root,t)}_getSystemList(){return this.root._systemList}_getSystemMap(){return this.root._systemMap}_getEntityManager(){return this.root._entityManager}_getConfigurations(){return this.root._configurations}view(t){if(!this.system)throw new Error("Must call world.view() from a world fragment passed into a System");const e=this.root.query(t),s=new w(e),i=this.system;return i._views||(i._views=[]),i._views.push(s),s.view}listen(e){if(!this.system)throw new Error("Must call world.view() from a world fragment passed into a System");if(!e)throw new Error("Must specify Tag, Tags, or Query object to world.listen()");let s=this.root.query(e),i=new h.default(s);const n=this.system;n._listeners||(n._listeners=[]);const r=n._listeners;r.push(i);const o=i.state;return o.dispose=(()=>{i.detach(),r&&(0,t.spliceObject)(r,i),s=i=null}),o}tag(t,e){const s=this.system;if(!s)throw new Error("Must call world.tag() from a world fragment passed into a System");let i=null;return this.entity(i,!0).add(t,e).get(t)}entity(t,e){if(this.system&&!1!==e){const e=this._getEntityManager().entity(t,this.system);return this.system._manage(e),e}return this._getEntityManager().entity(t)}query(t){return this._getEntityManager().query(t)}matching(t){return this.query(t).entities.slice()}findEntity(t){const e=this.query(t);return e.entities.length>0?e.entities[0]:null}findTag(t){const e=this.query(t);if(1!==e.Tags.length)throw new Error("find() only accepts a query with one Tag, use findEntity() to match against multiple Tags");return e.entities.length>0?e.entities[0].get(e.Tags[0]):null}get entities(){return this._getEntityManager().entities}hasSystem(t){return this._getSystemMap().has(t)}getSystem(t){return this._getSystemMap().get(t)}getAllSystems(){return this._getSystemList()}removeAllSystems(){const t=this._getSystemList();for(let e=t.length-1;e>=0;e--){const s=t[e].System;this.removeSystem(s)}}setConfig(t,e={}){this._getConfigurations().set(t,e)}hasConfig(t){return this._getConfigurations().has(t)}getConfig(t){return this._getConfigurations().get(t)}removeConfig(t){this.hasConfig(t)&&this._getConfigurations().delete(t)}addSystem(t,e={}){if("function"!=typeof t)throw new Error("The first parameter of addSystem() must be a function");if(this.hasSystem(t))throw new Error(`The World already registered the System "${t.name}"`);const s=this._getSystemList(),i=this._getSystemMap();u&&s.some(e=>e.System.name===t.name)&&console.warn(` You already have a different System registered by the name "${t.name}", maybe you forgot to rename it?`);const n=new b(this,t);s.push(n),i.set(t,n);const r=this._fragment(n);let o=t(r,e);return g(o)?(o=o.then(t=>(n.instance=t,n.loading=!1,n.loaded=!0,n)),n.promise=o):(n.instance=o,n.promise=Promise.resolve(n),n.loading=!1,n.loaded=!0),f(this.root._subscribers),n.promise}removeSystem(e){if("function"!=typeof e)throw new Error("The first parameter of removeSystem() must be a function");if(!this.hasSystem(e))return void console.warn(`Trying to unregister the System "${e.name}" that is no longer in this World`);const s=this._getSystemList(),i=this._getSystemMap(),n=i.get(e);i.delete(e),(0,t.spliceObject)(s,n),n.instance&&"function"==typeof n.instance.dispose&&n.instance.dispose(),n._dispose(),f(this.root._subscribers)}process(t){const e=this._getSystemList();for(let s=0;s<e.length;s++){const i=e[s],n=i.instance;i.loaded&&(i._poll(),n&&i.enabled&&("function"==typeof n?n(t):"function"==typeof n.process&&n.process(t)),i._flush())}this._getEntityManager().flush()}}class M extends v{constructor({initialCapacity:t=0}={}){super(),this.root=this,this._configurations=new Map,this._entityManager=new r.default({initialCapacity:t}),this._systemMap=new Map,this._systemList=[],this._subscribers=[]}}
},{"../util/array":139,"../util/ObjectPool":236,"./tag":760,"./EntityManager":848,"./QueryListener":849}],535:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.cloneObject=exports.cloneRef=exports.cloneInstance=exports.cloneArray=exports.copyObject=exports.copyRef=exports.copyInstance=exports.copyArray=exports.Types=exports.Value=exports.Data=exports.Tag=exports.createWorld=void 0;var e=require("./World"),o=t(e),r=require("./tag");function t(e){return e&&e.__esModule?e:{default:e}}exports.createWorld=o.default,exports.Tag=r.Tag,exports.Data=r.Data,exports.Value=r.Value,exports.Types=r.Types,exports.copyArray=r.copyArray,exports.copyInstance=r.copyInstance,exports.copyRef=r.copyRef,exports.copyObject=r.copyObject,exports.cloneArray=r.cloneArray,exports.cloneInstance=r.cloneInstance,exports.cloneRef=r.cloneRef,exports.cloneObject=r.cloneObject;
},{"./World":759,"./tag":760}],226:[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];function e(){}Object.defineProperty(exports,"__esModule",{value:!0});const n=t=>t;function o(t,e){for(const n in e)t[n]=e[n];return t}function r(t){return t&&"object"==typeof t&&"function"==typeof t.then}function s(t,e,n,o,r){t.__svelte_meta={loc:{file:e,line:n,column:o,char:r}}}function i(t){return t()}function c(){return Object.create(null)}function u(t){t.forEach(i)}function l(t){return"function"==typeof t}function a(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function p(t,e){return t!=t?e==e:t!==e}function f(t){return 0===Object.keys(t).length}function d(t,e){if(null!=t&&"function"!=typeof t.subscribe)throw new Error(`'${e}' is not a store with a 'subscribe' method`)}function _(t,...n){if(null==t)return e;const o=t.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function h(t){let e;return _(t,t=>e=t)(),e}function x(t,e,n){t.$$.on_destroy.push(_(e,n))}function m(t,e,n,o){if(t){const r=b(t,e,n,o);return t[0](r)}}function b(t,e,n,r){return t[1]&&r?o(n.ctx.slice(),t[1](r(e))):n.ctx}function g(t,e,n,o){if(t[2]&&o){const r=t[2](o(n));if(void 0===e.dirty)return r;if("object"==typeof r){const t=[],n=Math.max(e.dirty.length,r.length);for(let o=0;o<n;o+=1)t[o]=e.dirty[o]|r[o];return t}return e.dirty|r}return e.dirty}function y(t,e,n,o,r,s,i){const c=g(e,o,r,s);if(c){const r=b(e,n,o,i);t.p(r,c)}}function $(t,e,n,o,r,s,i,c){const u=i(r)|g(e,o,r,s);if(u){const r=b(e,n,o,c);t.p(r,u)}}function F(t){const e={};for(const n in t)"$"!==n[0]&&(e[n]=t[n]);return e}function v(t,e){const n={};e=new Set(e);for(const o in t)e.has(o)||"$"===o[0]||(n[o]=t[o]);return n}function w(t){const e={};for(const n in t)e[n]=!0;return e}function k(t){let e=!1;return function(...n){e||(e=!0,t.call(this,...n))}}function E(t){return null==t?"":t}function S(t,e,n=e){return t.set(n),e}const O=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);function C(t){return t&&l(t.destroy)?t.destroy:e}const D="undefined"!=typeof window;let j=D?()=>window.performance.now():()=>Date.now(),A=D?t=>requestAnimationFrame(t):e;function M(t){exports.now=j=t}function q(t){exports.raf=A=t}const T=new Set;function R(t){T.forEach(e=>{e.c(t)||(T.delete(e),e.f())}),0!==T.size&&A(R)}function N(){T.clear()}function P(t){let e;return 0===T.size&&A(R),{promise:new Promise(n=>{T.add(e={c:t,f:n})}),abort(){T.delete(e)}}}function L(t,e){t.appendChild(e)}function z(t,e,n){t.insertBefore(e,n||null)}function B(t){t.parentNode.removeChild(t)}function I(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function H(t){return document.createElement(t)}function W(t,e){return document.createElement(t,{is:e})}function U(t,e){const n={};for(const o in t)O(t,o)&&-1===e.indexOf(o)&&(n[o]=t[o]);return n}function Y(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function J(t){return document.createTextNode(t)}function G(){return J(" ")}function K(){return J("")}function Q(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function V(t){return function(e){return e.preventDefault(),t.call(this,e)}}function X(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function Z(t){return function(e){e.target===this&&t.call(this,e)}}function tt(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function et(t,e){const n=Object.getOwnPropertyDescriptors(t.__proto__);for(const o in e)null==e[o]?t.removeAttribute(o):"style"===o?t.style.cssText=e[o]:"__value"===o?t.value=t[o]=e[o]:n[o]&&n[o].set?t[o]=e[o]:tt(t,o,e[o])}function nt(t,e){for(const n in e)tt(t,n,e[n])}function ot(t,e,n){e in t?t[e]=n:tt(t,e,n)}function rt(t,e,n){t.setAttributeNS("http://www.w3.org/1999/xlink",e,n)}function st(t,e,n){const o=new Set;for(let e=0;e<t.length;e+=1)t[e].checked&&o.add(t[e].__value);return n||o.delete(e),Array.from(o)}function it(t){return""===t?null:+t}function ct(t){const e=[];for(let n=0;n<t.length;n+=1)e.push({start:t.start(n),end:t.end(n)});return e}function ut(t){return Array.from(t.childNodes)}function lt(t,e,n,o){for(let o=0;o<t.length;o+=1){const r=t[o];if(r.nodeName===e){let e=0;const s=[];for(;e<r.attributes.length;){const t=r.attributes[e++];n[t.name]||s.push(t.name)}for(let t=0;t<s.length;t++)r.removeAttribute(s[t]);return t.splice(o,1)[0]}}return o?Y(e):H(e)}function at(t,e){for(let n=0;n<t.length;n+=1){const o=t[n];if(3===o.nodeType)return o.data=""+e,t.splice(n,1)[0]}return J(e)}function pt(t){return at(t," ")}function ft(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function dt(t,e){t.value=null==e?"":e}function _t(t,e){try{t.type=e}catch(t){}}function ht(t,e,n,o){t.style.setProperty(e,n,o?"important":"")}function xt(t,e){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];if(o.__value===e)return void(o.selected=!0)}}function mt(t,e){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];o.selected=~e.indexOf(o.__value)}}function bt(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function gt(t){return[].map.call(t.querySelectorAll(":checked"),t=>t.__value)}let yt;function $t(){if(void 0===yt){yt=!1;try{"undefined"!=typeof window&&window.parent&&window.parent.document}catch(t){yt=!0}}return yt}function Ft(t,e){const n=getComputedStyle(t),o=(parseInt(n.zIndex)||0)-1;"static"===n.position&&(t.style.position="relative");const r=H("iframe");r.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; "+`overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: ${o};`),r.setAttribute("aria-hidden","true"),r.tabIndex=-1;const s=$t();let i;return s?(r.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",i=Q(window,"message",t=>{t.source===r.contentWindow&&e()})):(r.src="about:blank",r.onload=(()=>{i=Q(r.contentWindow,"resize",e)})),L(t,r),()=>{s?i():i&&r.contentWindow&&i(),B(r)}}function vt(t,e,n){t.classList[n?"add":"remove"](e)}function wt(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}function kt(t,e=document.body){return Array.from(e.querySelectorAll(t))}class Et{constructor(t=null){this.a=t,this.e=this.n=null}m(t,e,n=null){this.e||(this.e=H(e.nodeName),this.t=e,this.h(t)),this.i(n)}h(t){this.e.innerHTML=t,this.n=Array.from(this.e.childNodes)}i(t){for(let e=0;e<this.n.length;e+=1)z(this.t,this.n[e],t)}p(t){this.d(),this.h(t),this.i(this.a)}d(){this.n.forEach(B)}}function St(t){const e={};for(const n of t)e[n.name]=n.value;return e}function Ot(t){const e={};return t.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}const Ct=new Set;let Dt,jt=0;function At(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function Mt(t,e,n,o,r,s,i,c=0){const u=16.666/o;let l="{\n";for(let t=0;t<=1;t+=u){const o=e+(n-e)*s(t);l+=100*t+`%{${i(o,1-o)}}\n`}const a=l+`100% {${i(n,1-n)}}\n}`,p=`__svelte_${At(a)}_${c}`,f=t.ownerDocument;Ct.add(f);const d=f.__svelte_stylesheet||(f.__svelte_stylesheet=f.head.appendChild(H("style")).sheet),_=f.__svelte_rules||(f.__svelte_rules={});_[p]||(_[p]=!0,d.insertRule(`@keyframes ${p} ${a}`,d.cssRules.length));const h=t.style.animation||"";return t.style.animation=`${h?`${h}, `:""}${p} ${o}ms linear ${r}ms 1 both`,jt+=1,p}function qt(t,e){const n=(t.style.animation||"").split(", "),o=n.filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")),r=n.length-o.length;r&&(t.style.animation=o.join(", "),(jt-=r)||Tt())}function Tt(){A(()=>{jt||(Ct.forEach(t=>{const e=t.__svelte_stylesheet;let n=e.cssRules.length;for(;n--;)e.deleteRule(n);t.__svelte_rules={}}),Ct.clear())})}function Rt(t,o,r,s){if(!o)return e;const i=t.getBoundingClientRect();if(o.left===i.left&&o.right===i.right&&o.top===i.top&&o.bottom===i.bottom)return e;const{delay:c=0,duration:u=300,easing:l=n,start:a=j()+c,end:p=a+u,tick:f=e,css:d}=r(t,{from:o,to:i},s);let _,h=!0,x=!1;function m(){d&&qt(t,_),h=!1}return P(t=>{if(!x&&t>=a&&(x=!0),x&&t>=p&&(f(1,0),m()),!h)return!1;if(x){const e=0+1*l((t-a)/u);f(e,1-e)}return!0}),d&&(_=Mt(t,0,1,u,c,l,d)),c||(x=!0),f(0,1),m}function Nt(t){const e=getComputedStyle(t);if("absolute"!==e.position&&"fixed"!==e.position){const{width:n,height:o}=e,r=t.getBoundingClientRect();t.style.position="absolute",t.style.width=n,t.style.height=o,Pt(t,r)}}function Pt(t,e){const n=t.getBoundingClientRect();if(e.left!==n.left||e.top!==n.top){const o=getComputedStyle(t),r="none"===o.transform?"":o.transform;t.style.transform=`${r} translate(${e.left-n.left}px, ${e.top-n.top}px)`}}function Lt(t){exports.current_component=Dt=t}function zt(){if(!Dt)throw new Error("Function called outside component initialization");return Dt}function Bt(t){zt().$$.before_update.push(t)}function It(t){zt().$$.on_mount.push(t)}function Ht(t){zt().$$.after_update.push(t)}function Wt(t){zt().$$.on_destroy.push(t)}function Ut(){const t=zt();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const r=wt(e,n);o.slice().forEach(e=>{e.call(t,r)})}}}function Yt(t,e){zt().$$.context.set(t,e)}function Jt(t){return zt().$$.context.get(t)}function Gt(t){return zt().$$.context.has(t)}function Kt(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(t=>t(e))}const Qt=[],Vt={enabled:!1},Xt=[],Zt=[],te=[],ee=Promise.resolve();let ne=!1;function oe(){ne||(ne=!0,ee.then(le))}function re(){return oe(),ee}function se(t){Zt.push(t)}function ie(t){te.push(t)}let ce=!1;const ue=new Set;function le(){if(!ce){ce=!0;do{for(let t=0;t<Qt.length;t+=1){const e=Qt[t];Lt(e),ae(e.$$)}for(Lt(null),Qt.length=0;Xt.length;)Xt.pop()();for(let t=0;t<Zt.length;t+=1){const e=Zt[t];ue.has(e)||(ue.add(e),e())}Zt.length=0}while(Qt.length);for(;te.length;)te.pop()();ne=!1,ce=!1,ue.clear()}}function ae(t){if(null!==t.fragment){t.update(),u(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(se)}}let pe;function fe(){return pe||(pe=Promise.resolve()).then(()=>{pe=null}),pe}function de(t,e,n){t.dispatchEvent(wt(`${e?"intro":"outro"}${n}`))}const _e=new Set;let he;function xe(){he={r:0,c:[],p:he}}function me(){he.r||u(he.c),he=he.p}function be(t,e){t&&t.i&&(_e.delete(t),t.i(e))}function ge(t,e,n,o){if(t&&t.o){if(_e.has(t))return;_e.add(t),he.c.push(()=>{_e.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}}const ye={duration:0};function $e(t,o,r){let s,i,c=o(t,r),u=!1,a=0;function p(){s&&qt(t,s)}function f(){const{delay:o=0,duration:r=300,easing:l=n,tick:f=e,css:d}=c||ye;d&&(s=Mt(t,0,1,r,o,l,d,a++)),f(0,1);const _=j()+o,h=_+r;i&&i.abort(),u=!0,se(()=>de(t,!0,"start")),i=P(e=>{if(u){if(e>=h)return f(1,0),de(t,!0,"end"),p(),u=!1;if(e>=_){const t=l((e-_)/r);f(t,1-t)}}return u})}let d=!1;return{start(){d||(qt(t),l(c)?(c=c(),fe().then(f)):f())},invalidate(){d=!1},end(){u&&(p(),u=!1)}}}function Fe(t,o,r){let s,i=o(t,r),c=!0;const a=he;function p(){const{delay:o=0,duration:r=300,easing:l=n,tick:p=e,css:f}=i||ye;f&&(s=Mt(t,1,0,r,o,l,f));const d=j()+o,_=d+r;se(()=>de(t,!1,"start")),P(e=>{if(c){if(e>=_)return p(0,1),de(t,!1,"end"),--a.r||u(a.c),!1;if(e>=d){const t=l((e-d)/r);p(1-t,t)}}return c})}return a.r+=1,l(i)?fe().then(()=>{i=i(),p()}):p(),{end(e){e&&i.tick&&i.tick(1,0),c&&(s&&qt(t,s),c=!1)}}}function ve(t,o,r,s){let i=o(t,r),c=s?0:1,a=null,p=null,f=null;function d(){f&&qt(t,f)}function _(t,e){const n=t.b-c;return e*=Math.abs(n),{a:c,b:t.b,d:n,duration:e,start:t.start,end:t.start+e,group:t.group}}function h(o){const{delay:r=0,duration:s=300,easing:l=n,tick:h=e,css:x}=i||ye,m={start:j()+r,b:o};o||(m.group=he,he.r+=1),a||p?p=m:(x&&(d(),f=Mt(t,c,o,s,r,l,x)),o&&h(0,1),a=_(m,s),se(()=>de(t,o,"start")),P(e=>{if(p&&e>p.start&&(a=_(p,s),p=null,de(t,a.b,"start"),x&&(d(),f=Mt(t,c,a.b,a.duration,0,l,i.css))),a)if(e>=a.end)h(c=a.b,1-c),de(t,a.b,"end"),p||(a.b?d():--a.group.r||u(a.group.c)),a=null;else if(e>=a.start){const t=e-a.start;c=a.a+a.d*l(t/a.duration),h(c,1-c)}return!(!a&&!p)}))}return{run(t){l(i)?fe().then(()=>{i=i(),h(t)}):h(t)},end(){d(),a=p=null}}}function we(t,e){const n=e.token={};function o(t,o,r,s){if(e.token!==n)return;e.resolved=s;let i=e.ctx;void 0!==r&&((i=i.slice())[r]=s);const c=t&&(e.current=t)(i);let u=!1;e.block&&(e.blocks?e.blocks.forEach((t,n)=>{n!==o&&t&&(xe(),ge(t,1,1,()=>{e.blocks[n]=null}),me())}):e.block.d(1),c.c(),be(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[o]=c),u&&le()}if(r(t)){const n=zt();if(t.then(t=>{Lt(n),o(e.then,1,e.value,t),Lt(null)},t=>{if(Lt(n),o(e.catch,2,e.error,t),Lt(null),!e.hasCatch)throw t}),e.current!==e.pending)return o(e.pending,0),!0}else{if(e.current!==e.then)return o(e.then,1,e.value,t),!0;e.resolved=t}}const ke="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:t;function Ee(t,e){t.d(1),e.delete(t.key)}function Se(t,e){ge(t,1,1,()=>{e.delete(t.key)})}function Oe(t,e){t.f(),Ee(t,e)}function Ce(t,e){t.f(),Se(t,e)}function De(t,e,n,o,r,s,i,c,u,l,a,p){let f=t.length,d=s.length,_=f;const h={};for(;_--;)h[t[_].key]=_;const x=[],m=new Map,b=new Map;for(_=d;_--;){const t=p(r,s,_),c=n(t);let u=i.get(c);u?o&&u.p(t,e):(u=l(c,t)).c(),m.set(c,x[_]=u),c in h&&b.set(c,Math.abs(_-h[c]))}const g=new Set,y=new Set;function $(t){be(t,1),t.m(c,a),i.set(t.key,t),a=t.first,d--}for(;f&&d;){const e=x[d-1],n=t[f-1],o=e.key,r=n.key;e===n?(a=e.first,f--,d--):m.has(r)?!i.has(o)||g.has(o)?$(e):y.has(r)?f--:b.get(o)>b.get(r)?(y.add(o),$(e)):(g.add(r),f--):(u(n,i),f--)}for(;f--;){const e=t[f];m.has(e.key)||u(e,i)}for(;d;)$(x[d-1]);return x}function je(t,e,n,o){const r=new Set;for(let s=0;s<e.length;s++){const i=o(n(t,e,s));if(r.has(i))throw new Error("Cannot have duplicate keys in a keyed each");r.add(i)}}function Ae(t,e){const n={},o={},r={$$scope:1};let s=t.length;for(;s--;){const i=t[s],c=e[s];if(c){for(const t in i)t in c||(o[t]=1);for(const t in c)r[t]||(n[t]=c[t],r[t]=1);t[s]=c}else for(const t in i)r[t]=1}for(const t in o)t in n||(n[t]=void 0);return n}function Me(t){return"object"==typeof t&&null!==t?t:{}}const qe=new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),Te=/[\s'">\/=\u{FDD0}-\u{FDEF}\u{FFFE}\u{FFFF}\u{1FFFE}\u{1FFFF}\u{2FFFE}\u{2FFFF}\u{3FFFE}\u{3FFFF}\u{4FFFE}\u{4FFFF}\u{5FFFE}\u{5FFFF}\u{6FFFE}\u{6FFFF}\u{7FFFE}\u{7FFFF}\u{8FFFE}\u{8FFFF}\u{9FFFE}\u{9FFFF}\u{AFFFE}\u{AFFFF}\u{BFFFE}\u{BFFFF}\u{CFFFE}\u{CFFFF}\u{DFFFE}\u{DFFFF}\u{EFFFE}\u{EFFFF}\u{FFFFE}\u{FFFFF}\u{10FFFE}\u{10FFFF}]/u;function Re(t,e){const n=Object.assign({},...t);e&&(null==n.class?n.class=e:n.class+=" "+e);let o="";return Object.keys(n).forEach(t=>{if(Te.test(t))return;const e=n[t];!0===e?o+=" "+t:qe.has(t.toLowerCase())?e&&(o+=" "+t):null!=e&&(o+=` ${t}="${String(e).replace(/"/g,"&#34;").replace(/'/g,"&#39;")}"`)}),o}const Ne={'"':"&quot;","'":"&#39;","&":"&amp;","<":"&lt;",">":"&gt;"};function Pe(t){return String(t).replace(/["'&<>]/g,t=>Ne[t])}function Le(t,e){let n="";for(let o=0;o<t.length;o+=1)n+=e(t[o],o);return n}const ze={$$render:()=>""};function Be(t,e){if(!t||!t.$$render)throw"svelte:component"===e&&(e+=" this={...}"),new Error(`<${e}> is not a valid SSR component. You may need to review your build config to ensure that dependencies are compiled, rather than imported as pre-compiled modules`);return t}function Ie(t,e,n,o){return console.log(`{@debug} ${t?t+" ":""}(${e}:${n})`),console.log(o),""}let He,We;function Ue(t){function e(e,n,o,r){const s=Dt;Lt({$$:{on_destroy:He,context:new Map(s?s.$$.context:[]),on_mount:[],before_update:[],after_update:[],callbacks:c()}});const i=t(e,n,o,r);return Lt(s),i}return{render:(t={},n={})=>{He=[];const o={title:"",head:"",css:new Set},r=e(o,t,{},n);return u(He),{html:r,css:{code:Array.from(o.css).map(t=>t.code).join("\n"),map:null},head:o.title+o.head}},$$render:e}}function Ye(t,e,n){return null==e||n&&!e?"":` ${t}${!0===e?"":`=${"string"==typeof e?JSON.stringify(Pe(e)):`"${e}"`}`}`}function Je(t){return t?` class="${t}"`:""}function Ge(t,e,n){const o=t.$$.props[e];void 0!==o&&(t.$$.bound[o]=n,n(t.$$.ctx[o]))}function Ke(t){t&&t.c()}function Qe(t,e){t&&t.l(e)}function Ve(t,e,n){const{fragment:o,on_mount:r,on_destroy:s,after_update:c}=t.$$;o&&o.m(e,n),se(()=>{const e=r.map(i).filter(l);s?s.push(...e):u(e),t.$$.on_mount=[]}),c.forEach(se)}function Xe(t,e){const n=t.$$;null!==n.fragment&&(u(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Ze(t,e){-1===t.$$.dirty[0]&&(Qt.push(t),oe(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function tn(t,n,o,r,s,i,l=[-1]){const a=Dt;Lt(t);const p=n.props||{},f=t.$$={fragment:null,ctx:null,props:i,update:e,not_equal:s,bound:c(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(a?a.$$.context:[]),callbacks:c(),dirty:l,skip_bound:!1};let d=!1;if(f.ctx=o?o(t,p,(e,n,...o)=>{const r=o.length?o[0]:n;return f.ctx&&s(f.ctx[e],f.ctx[e]=r)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](r),d&&Ze(t,e)),n}):[],f.update(),d=!0,u(f.before_update),f.fragment=!!r&&r(f.ctx),n.target){if(n.hydrate){const t=ut(n.target);f.fragment&&f.fragment.l(t),t.forEach(B)}else f.fragment&&f.fragment.c();n.intro&&be(t.$$.fragment),Ve(t,n.target,n.anchor),le()}Lt(a)}"function"==typeof HTMLElement&&(exports.SvelteElement=We=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}$destroy(){Xe(this,1),this.$destroy=e}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!f(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});class en{$destroy(){Xe(this,1),this.$destroy=e}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!f(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function nn(t,e){document.dispatchEvent(wt(t,Object.assign({version:"3.31.0"},e)))}function on(t,e){nn("SvelteDOMInsert",{target:t,node:e}),L(t,e)}function rn(t,e,n){nn("SvelteDOMInsert",{target:t,node:e,anchor:n}),z(t,e,n)}function sn(t){nn("SvelteDOMRemove",{node:t}),B(t)}function cn(t,e){for(;t.nextSibling&&t.nextSibling!==e;)sn(t.nextSibling)}function un(t){for(;t.previousSibling;)sn(t.previousSibling)}function ln(t){for(;t.nextSibling;)sn(t.nextSibling)}function an(t,e,n,o,r,s){const i=!0===o?["capture"]:o?Array.from(Object.keys(o)):[];r&&i.push("preventDefault"),s&&i.push("stopPropagation"),nn("SvelteDOMAddEventListener",{node:t,event:e,handler:n,modifiers:i});const c=Q(t,e,n,o);return()=>{nn("SvelteDOMRemoveEventListener",{node:t,event:e,handler:n,modifiers:i}),c()}}function pn(t,e,n){tt(t,e,n),null==n?nn("SvelteDOMRemoveAttribute",{node:t,attribute:e}):nn("SvelteDOMSetAttribute",{node:t,attribute:e,value:n})}function fn(t,e,n){t[e]=n,nn("SvelteDOMSetProperty",{node:t,property:e,value:n})}function dn(t,e,n){t.dataset[e]=n,nn("SvelteDOMSetDataset",{node:t,property:e,value:n})}function _n(t,e){e=""+e,t.wholeText!==e&&(nn("SvelteDOMSetData",{node:t,data:e}),t.data=e)}function hn(t){if("string"!=typeof t&&!(t&&"object"==typeof t&&"length"in t)){let e="{#each} only iterates over array-like objects.";throw"function"==typeof Symbol&&t&&Symbol.iterator in t&&(e+=" You can use a spread to convert this iterable into an array."),new Error(e)}}function xn(t,e,n){for(const o of Object.keys(e))~n.indexOf(o)||console.warn(`<${t}> received an unexpected slot "${o}".`)}class mn extends en{constructor(t){if(!t||!t.target&&!t.$$inline)throw new Error("'target' is a required option");super()}$destroy(){super.$destroy(),this.$destroy=(()=>{console.warn("Component was already destroyed")})}$capture_state(){}$inject_state(){}}class bn extends mn{constructor(t){super(t)}}function gn(t){const e=Date.now();return()=>{if(Date.now()-e>t)throw new Error("Infinite loop detected")}}exports.HtmlTag=Et,exports.SvelteComponent=en,exports.SvelteComponentDev=mn,exports.SvelteComponentTyped=bn,exports.SvelteElement=We,exports.action_destroyer=C,exports.add_attribute=Ye,exports.add_classes=Je,exports.add_flush_callback=ie,exports.add_location=s,exports.add_render_callback=se,exports.add_resize_listener=Ft,exports.add_transform=Pt,exports.afterUpdate=Ht,exports.append=L,exports.append_dev=on,exports.assign=o,exports.attr=tt,exports.attr_dev=pn,exports.attribute_to_object=St,exports.beforeUpdate=Bt,exports.bind=Ge,exports.binding_callbacks=Xt,exports.blank_object=c,exports.bubble=Kt,exports.check_outros=me,exports.children=ut,exports.claim_component=Qe,exports.claim_element=lt,exports.claim_space=pt,exports.claim_text=at,exports.clear_loops=N,exports.component_subscribe=x,exports.compute_rest_props=v,exports.compute_slots=w,exports.createEventDispatcher=Ut,exports.create_animation=Rt,exports.create_bidirectional_transition=ve,exports.create_component=Ke,exports.create_in_transition=$e,exports.create_out_transition=Fe,exports.create_slot=m,exports.create_ssr_component=Ue,exports.current_component=Dt,exports.custom_event=wt,exports.dataset_dev=dn,exports.debug=Ie,exports.destroy_block=Ee,exports.destroy_component=Xe,exports.destroy_each=I,exports.detach=B,exports.detach_after_dev=ln,exports.detach_before_dev=un,exports.detach_between_dev=cn,exports.detach_dev=sn,exports.dirty_components=Qt,exports.dispatch_dev=nn,exports.each=Le,exports.element=H,exports.element_is=W,exports.empty=K,exports.escape=Pe,exports.escaped=Ne,exports.exclude_internal_props=F,exports.fix_and_destroy_block=Oe,exports.fix_and_outro_and_destroy_block=Ce,exports.fix_position=Nt,exports.flush=le,exports.getContext=Jt,exports.get_binding_group_value=st,exports.get_current_component=zt,exports.get_custom_elements_slots=Ot,exports.get_slot_changes=g,exports.get_slot_context=b,exports.get_spread_object=Me,exports.get_spread_update=Ae,exports.get_store_value=h,exports.globals=ke,exports.group_outros=xe,exports.handle_promise=we,exports.hasContext=Gt,exports.has_prop=O,exports.identity=n,exports.init=tn,exports.insert=z,exports.insert_dev=rn,exports.intros=Vt,exports.invalid_attribute_name_character=Te,exports.is_client=D,exports.is_crossorigin=$t,exports.is_empty=f,exports.is_function=l,exports.is_promise=r,exports.listen=Q,exports.listen_dev=an,exports.loop=P,exports.loop_guard=gn,exports.missing_component=ze,exports.mount_component=Ve,exports.noop=e,exports.not_equal=p,exports.now=j,exports.null_to_empty=E,exports.object_without_properties=U,exports.onDestroy=Wt,exports.onMount=It,exports.once=k,exports.outro_and_destroy_block=Se,exports.prevent_default=V,exports.prop_dev=fn,exports.query_selector_all=kt,exports.raf=A,exports.run=i,exports.run_all=u,exports.safe_not_equal=a,exports.schedule_update=oe,exports.select_multiple_value=gt,exports.select_option=xt,exports.select_options=mt,exports.select_value=bt,exports.self=Z,exports.setContext=Yt,exports.set_attributes=et,exports.set_current_component=Lt,exports.set_custom_element_data=ot,exports.set_data=ft,exports.set_data_dev=_n,exports.set_input_type=_t,exports.set_input_value=dt,exports.set_now=M,exports.set_raf=q,exports.set_store_value=S,exports.set_style=ht,exports.set_svg_attributes=nt,exports.space=G,exports.spread=Re,exports.stop_propagation=X,exports.subscribe=_,exports.svg_element=Y,exports.text=J,exports.tick=re,exports.time_ranges_to_array=ct,exports.to_number=it,exports.toggle_class=vt,exports.transition_in=be,exports.transition_out=ge,exports.update_keyed_each=De,exports.update_slot=y,exports.update_slot_spread=$,exports.validate_component=Be,exports.validate_each_argument=hn,exports.validate_each_keys=je,exports.validate_slots=xn,exports.validate_store=d,exports.xlink_attr=rt;
},{}],310:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.writable=exports.readable=exports.derived=exports.get=void 0;var e=require("../internal/index.mjs");Object.defineProperty(exports,"get",{enumerable:!0,get:function(){return e.get_store_value}});const t=[];function n(e,t){return{subscribe:r(e,t).subscribe}}function r(n,r=e.noop){let o;const s=[];function u(r){if((0,e.safe_not_equal)(n,r)&&(n=r,o)){const e=!t.length;for(let e=0;e<s.length;e+=1){const r=s[e];r[1](),t.push(r,n)}if(e){for(let e=0;e<t.length;e+=2)t[e][0](t[e+1]);t.length=0}}}return{set:u,update:function(e){u(e(n))},subscribe:function(t,i=e.noop){const c=[t,i];return s.push(c),1===s.length&&(o=r(u)||e.noop),t(n),()=>{const e=s.indexOf(c);-1!==e&&s.splice(e,1),0===s.length&&(o(),o=null)}}}}function o(t,r,o){const s=!Array.isArray(t),u=s?[t]:t,i=r.length<2;return n(o,t=>{let n=!1;const o=[];let c=0,l=e.noop;const p=()=>{if(c)return;l();const n=r(s?o[0]:o,t);i?t(n):l=(0,e.is_function)(n)?n:e.noop},a=u.map((t,r)=>(0,e.subscribe)(t,e=>{o[r]=e,c&=~(1<<r),n&&p()},()=>{c|=1<<r}));return n=!0,p(),function(){(0,e.run_all)(a),l()}})}exports.derived=o,exports.readable=n,exports.writable=r;
},{"../internal/index.mjs":226}],220:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./internal/index.mjs");Object.defineProperty(exports,"SvelteComponent",{enumerable:!0,get:function(){return e.SvelteComponentDev}}),Object.defineProperty(exports,"SvelteComponentTyped",{enumerable:!0,get:function(){return e.SvelteComponentTyped}}),Object.defineProperty(exports,"afterUpdate",{enumerable:!0,get:function(){return e.afterUpdate}}),Object.defineProperty(exports,"beforeUpdate",{enumerable:!0,get:function(){return e.beforeUpdate}}),Object.defineProperty(exports,"createEventDispatcher",{enumerable:!0,get:function(){return e.createEventDispatcher}}),Object.defineProperty(exports,"getContext",{enumerable:!0,get:function(){return e.getContext}}),Object.defineProperty(exports,"hasContext",{enumerable:!0,get:function(){return e.hasContext}}),Object.defineProperty(exports,"onDestroy",{enumerable:!0,get:function(){return e.onDestroy}}),Object.defineProperty(exports,"onMount",{enumerable:!0,get:function(){return e.onMount}}),Object.defineProperty(exports,"setContext",{enumerable:!0,get:function(){return e.setContext}}),Object.defineProperty(exports,"tick",{enumerable:!0,get:function(){return e.tick}});
},{"./internal/index.mjs":226}],223:[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3];module.exports=e.performance&&e.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date};
},{}],271:[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(t){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],225:[function(require,module,exports) {
var process = require("process");
var e=require("process");Object.defineProperty(exports,"__esModule",{value:!0}),exports.AutoReleasingTrigger=exports.TagPropUpdate=exports.MarkConfigChanged=exports.Config=exports.ViewLayerNeedsUpdate=exports.ViewLayer=exports.CONTEXT_KEY_NODE=void 0,exports.createRootWorld=x,exports.context=h;var t=require("../alec"),r=require("svelte/store"),s=require("svelte"),o=require("right-now"),n=a(o);function a(e){return e&&e.__esModule?e:{default:e}}const i=exports.CONTEXT_KEY_NODE={};class c extends t.Data{}exports.ViewLayer=c,Object.defineProperty(c,"data",{enumerable:!0,writable:!0,value:{id:t.Types.Ref(""),component:t.Types.Ref(),props:t.Types.Object()}});class d extends t.Tag{}exports.ViewLayerNeedsUpdate=d;class p extends t.Data{update(){this.changed=!0,this.sync=!0}}exports.Config=p,Object.defineProperty(p,"data",{enumerable:!0,writable:!0,value:{name:t.Types.Ref(""),component:t.Types.Ref(),props:t.Types.Object(),triggers:t.Types.Object(),changed:t.Types.Ref(!1),sync:t.Types.Ref(!1),instance:t.Types.Ref()}});class l extends t.Tag{}exports.MarkConfigChanged=l;class f extends t.Value{}exports.TagPropUpdate=f;class u extends t.Data{}function g(e,{store:t}){e.system.info({hidden:!0});const r=e.view(c),s=e.listen(c),o=e.view([c,d]);return()=>{let e=!1,n=!1;if(s.changed){const e=r.slice();t&&t.update(()=>e),n=!0}if(o.forEach(t=>{t.remove(d),e=!0}),!n&&e&&t){const e=r.slice();t.update(()=>e)}}}function y(e,{store:t}){e.system.info({hidden:!0});const r=e.view(p),s=e.listen(p),o=e.view(u),a=e.listen(u),i=e.view(f);let c=.1,d=0,g=(0,n.default)();return{process:function(e){if(s.changed){if(t){const e=r.slice();t.update(t=>e)}s.added.forEach(e=>{e.add(l)}),s.removing.forEach(e=>{e.has(l)&&e.remove(l)})}if(r.forEach(e=>{const t=e.get(p),r=e.has(l);t.changed=r,r&&e.remove(l),t.instance&&t.sync&&(t.instance.sync(),t.sync=!1)}),a.removing.forEach(e=>{const t=e.get(u);delete t.target.triggers[t.key]}),o.forEach(e=>{const t=e.get(u);t.target.triggers[t.key]=t.value,e.kill()}),(d+=e)>=c){d%=c;const e=(0,n.default)();i.forEach(e=>{const t=e.get(f);"function"==typeof t&&t()}),g=e}}}}function x(e={}){const{useEditorConfig:s=!1}=e,o=(0,t.createWorld)({initialCapacity:400}),n=(0,r.writable)([]);o.addSystem(g,{store:n});const a=s?(0,r.writable)([]):null;return o.addSystem(y,{store:a}),{configEntityStore:a,viewLayerStore:n,world:o}}function h(){const e=(0,s.getContext)(i);if(null==e)throw new Error("Must call context() from within a Svelte component");return e}exports.AutoReleasingTrigger=u,Object.defineProperty(u,"data",{enumerable:!0,writable:!0,value:{target:t.Types.Ref(),key:t.Types.Ref(),value:t.Types.Ref()}});
},{"../alec":535,"svelte/store":310,"svelte":220,"right-now":223,"process":271}],224:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TriggerTreeTransitionAudio=exports.OutroFinished=exports.MusicalOrb=exports.ParticleEmit=exports.AutoRemoveCapeMagicalEffect=exports.CapeMagicalEffect=exports.FlashSound=exports.AnimalSound=exports.ClearInputPress=exports.GIFRecord=exports.CollectTokenOrb=exports.TokenChildren=exports.TriggerTokenLine=exports.TokenIsCollecting=exports.ResetToCameraDrift=exports.Snowflake=exports.CompassVisible=exports.UserHasHit=exports.WaterFishPlaceholderTag=exports.FoxHm=exports.FoxPurring=exports.FoxSpriteTag=exports.GameFinished=exports.TutorialMessage=void 0,exports.FloatingEndLine=exports.TokenForCompass=exports.AnimateOutCharacter=exports.AnimateInCharacter=exports.Animal=exports.AnimalSpawn=exports.LastWalkedLake=exports.Raining=exports.RainDropSplatter=exports.RainDrop=exports.WindLine=exports.HintOrb=exports.ObjectiveText=exports.CanSetIntroTags=exports.BlockTokenCollection=exports.UserForceApplied=exports.TutorialBarrenGround=exports.TutorialTextHint=exports.TutorialState=exports.HideHUD=exports.HideCharacter=exports.BlockUserMove=exports.HaikuCardSaved=exports.HaikuCardShown=exports.KillTextHint=exports.TextHint=exports.ScreenFade=exports.LetterboxBars=exports.CameraZoomOut=exports.GameLandingCameraDrift=exports.OriginTreeIntroSequenceStarted=exports.OriginTreeIntroSequence=exports.MoveUserToOrigin=exports.HatTipWindLineSound=exports.HatTipWindLineTag=exports.HatTipPoint=exports.WaterFollowParticle=exports.UserCarryingTokenCollectionFeature=exports.GLTFSpawnItemsMap=exports.FloatingTokenShouldTargetTree=exports.FloatingTokenTargetUser=exports.FloatingToken=exports.GlowingHaikuCard=exports.CameraFocusOnTarget=exports.SpriteAnimationOriginTreeTag=exports.GameStarted=exports.ButtonClick=exports.ButtonHover=exports.PauseOpen=exports.JournalOpen=exports.SpriteAnimationLazyLoadSheet=exports.SpriteAnimation=exports.SpawnedFlora=exports.StanzaLineSpawningAsset=exports.WrittenStanzaLineActive=exports.WrittenStanzaLine=exports.TokensDiscoveredSet=exports.GroundAssetToken=exports.BoxHelper=exports.SafeToSwapBiomes=exports.TransitionToNextBiome=exports.EndGameState=exports.FinalBiomeResolutionLines=exports.FinalBiomeResolution=exports.ShowBiomeResolution=exports.WaitingForBiomeResolution=exports.DirectUserToOrigin=exports.GameUIStore=exports.TestLoadRef=exports.IsInFrustum=exports.GLTFRefAssetLoaded=exports.GLTFRefAsset=exports.AssetCache=exports.BloomObject=exports.ShadowCaster=exports.RenderLayers=exports.GrassEditableData=exports.GroundMeshEditableData=exports.Atmospherics=exports.PostProcessEnabled=exports.GroundAsset3DAsync=exports.GroundAssetInsideFrustum=exports.MainCameraFrustum=exports.GroundAssetData=exports.GroundAsset=exports.WillTriggerAudio=exports.UserHitAudioTrigger=exports.ShowUserTokenInventory=exports.ShowUserCollectHint=exports.ShowUserWriteHint=exports.WaitingForUserWrite=exports.BlockUserWrite=exports.GroundDataParticle=exports.DebugRenderTarget=exports.UserFirstVisitedWorldIndex=exports.GroundDataRenderTarget=exports.GroundFogRenderTarget=exports.AudioMeta=exports.SolvingDecayArea=exports.HasVisitedFinalPortal=void 0,exports.WaitingToVisitFinalPortal=exports.WorldDecayTweens=exports.WorldTweens=exports.ActiveWorldIndex=exports.WaitingForTokenPaper=exports.HaikuInInventory=exports.HaikuAddingToInventory=exports.FinishedPoem=exports.CollectedToken=exports.GroundToken=exports.UserLine=exports.KillWritingIgnore=exports.UserWritingState=exports.GroundSpawnDecayTag=exports.GroundSpawnTokenTag=exports.GroundSpawnPosition2D=exports.PoemLineVertex=exports.PoemFinishing=exports.PoemLineText=exports.PoemInProgress=exports.PoemWriting=exports.IntroLayer=exports.HasLoaded=exports.HasShownElementalOverlay=exports.NearestEnvironmentCell=exports.CanShowCompass=exports.PoemRemaining=exports.PoemTextFragment=exports.GroundPoemFragmentSprite=exports.PoemLineMesh=exports.TickerTimeline=exports.PoemLineWithinRange=exports.GroundMeshWithPoem=exports.PoemLineTrigger=exports.PoemLine=exports.SpriteBlobShadowView=exports.SpriteBlobShadow=exports.GroundAssetSpriteType=exports.GroundAssetCellSampleToHide=exports.GroundAssetCellSampleToGrow=exports.GroundAssetCellSampleWithFeature=exports.GroundAssetCellSampleInstance=exports.GroundAssetCellSample=exports.GroundPlaneLayer=exports.GrassPlaneView=exports.GroundPlaneView=exports.GroundSpawningDot=exports.GroundSpawningGrass=exports.GroundSpawningLeaf=exports.GroundPatchInstance=exports.EnvironmentCell=exports.ActiveEnvironmentState=exports.EnvironmentState=exports.GroundPhysicsBody=exports.EnvironmentUnderPlayerState=exports.TextSprite3D=exports.MoveUserTo=exports.CinematicCameraMoment=exports.UserCompletingPoem=exports.UserInPoemArea=exports.PoemLineActivated=exports.PoemLineTriggerActivated=exports.TriggerDelayedPoemOverlay=exports.TriggerPoemComplete=exports.TweenCopyTargetKeyToVectorScalar=exports.TargetKeyTween=exports.Sequence=exports.MovementBoost=exports.ShaderUniformUserCharacterPosition=exports.ShaderUniformUserTargetPosition=exports.ShaderUniformResolution=exports.ShaderUniformTime=exports.EnvironmentMap=exports.IsGameUIActive=exports.ModalStoppingUserMovement=exports.CameraStopUserMovement=exports.UserFollow=exports.UserZoom=exports.DebugState=exports.UserTarget=exports.UserCharacter=exports.AppState=exports.UserInitiatedGesture=exports.InputState=exports.TriggerMovementGesture=exports.InputGestureEmitter=exports.Renderer=exports.Canvas=exports.MainScene=exports.MainCamera=exports.Object3DKeepAlive=exports.Object3D=exports.Types=exports.Value=exports.Data=exports.Tag=exports.MarkConfigChanged=exports.Config=exports.ViewLayerNeedsUpdate=exports.ViewLayer=void 0;var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},t=require("three"),a=o(t),r=require("../alec-svelte"),s=require("../alec");function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}exports.ViewLayer=r.ViewLayer,exports.ViewLayerNeedsUpdate=r.ViewLayerNeedsUpdate,exports.Config=r.Config,exports.MarkConfigChanged=r.MarkConfigChanged,exports.Tag=s.Tag,exports.Data=s.Data,exports.Value=s.Value;const n=exports.Types=e({},s.Types,{Vector2:(e=0,t=0)=>({initial:new a.Vector2(e,t),copy:s.copyInstance,clone:s.cloneInstance}),Vector3:(e=0,t=0,r=0)=>({initial:new a.Vector3(e,t,r),copy:s.copyInstance,clone:s.cloneInstance}),Vector4:(e=0,t=0,r=0,o=0)=>({initial:new a.Vector4(e,t,r,o),copy:s.copyInstance,clone:s.cloneInstance}),Quaternion:(e=0,t=0,r=0,o=0)=>({initial:new a.Quaternion(e,t,r,o),copy:s.copyInstance,clone:s.cloneInstance}),Euler:(e=0,t=0,r=0,o="XYZ")=>({initial:new a.Euler(e,t,r,o),copy:s.copyInstance,clone:s.cloneInstance}),Color:(e=0,t=0,r=0)=>({initial:new a.Color(e,t,r),copy:s.copyInstance,clone:s.cloneInstance})});class l extends s.Value{}exports.Object3D=l,Object.defineProperty(l,"edit",{enumerable:!0,writable:!0,value:{visible:!1}});class i extends s.Tag{}exports.Object3DKeepAlive=i;class p extends s.Value{}exports.MainCamera=p;class d extends s.Value{}exports.MainScene=d;class x extends s.Value{}exports.Canvas=x;class c extends s.Value{}exports.Renderer=c;class u extends s.Value{}exports.InputGestureEmitter=u;class f extends s.Value{}exports.TriggerMovementGesture=f;class R extends s.Data{}exports.InputState=R,Object.defineProperty(R,"data",{enumerable:!0,writable:!0,value:{multitouch:n.Ref(null),position:n.Vector2(),positionNormalized:n.Vector2(),interacted:!1,pressed:!1,metaKey:!1,ctrlKey:!1,shiftKey:!1}});class m extends s.Tag{}exports.UserInitiatedGesture=m;class b extends s.Data{}exports.AppState=b,Object.defineProperty(b,"data",{enumerable:!0,writable:!0,value:{ready:n.Ref(!1),running:n.Ref(!0),rendering:n.Ref(!0),pixelRatio:n.Ref(1),width:n.Ref(1),height:n.Ref(1),canvasWidth:n.Ref(1),canvasHeight:n.Ref(1)}});class g extends s.Data{}exports.UserCharacter=g,Object.defineProperty(g,"data",{enumerable:!0,writable:!0,value:{direction:n.Vector3(),position:n.Vector3(),target:n.Vector3(),velocity:n.Vector3(),yOffset:n.Ref(0),magicalEffect:n.Ref(0),glowIntensity:n.Ref(1),glowIntensity2:n.Ref(1),capeSpeed:n.Ref(1)}});class T extends s.Data{}exports.UserTarget=T,Object.defineProperty(T,"data",{enumerable:!0,writable:!0,value:{direction:n.Vector3(),position:n.Vector3(),forceApplied:!1,speedAlpha:0,totalBoost:0,boostAlpha:0,totalSpeedAlpha:0,inputPositionOnPlane:n.Vector3(),inputHitPlane:!1}});class y extends s.Data{}exports.DebugState=y,Object.defineProperty(y,"data",{enumerable:!0,writable:!0,value:{mouseOnPlaneHitPoint:n.Vector3()}});class v extends s.Data{}exports.UserZoom=v,Object.defineProperty(v,"data",{enumerable:!0,writable:!0,value:{allowMouseZoom:!1,distance:15,defaultDistance:15,minDistance:2,maxDistance:50,currentWheelOffset:0,zoomPowFactor:1.25,zoomPowTarget:5,zoomPixelsToWorld:.001}});class w extends s.Data{}exports.UserFollow=w,Object.defineProperty(w,"data",{enumerable:!0,writable:!0,value:{currentTarget:n.Vector3(),currentPosition:n.Vector3(),currentDistance:12,distanceSpring:5,minSpeedZoomDistance:0,maxSpeedZoomDistance:1,speedZoomDistance:0,speedZoomSpringIn:.25,speedZoomSpringOut:4,shake:0,shakeSpeed:1,shakeTime:0}});class P extends s.Tag{}exports.CameraStopUserMovement=P;class S extends s.Tag{}exports.ModalStoppingUserMovement=S;class O extends s.Tag{}exports.IsGameUIActive=O;class D extends s.Data{}exports.EnvironmentMap=D,Object.defineProperty(D,"data",{enumerable:!0,writable:!0,value:{image:null}});class h extends s.Data{}exports.ShaderUniformTime=h,Object.defineProperty(h,"data",{enumerable:!0,writable:!0,value:{uniform:n.Ref(),elapsed:n.Ref(0)}}),Object.defineProperty(h,"edit",{enumerable:!0,writable:!0,value:{visible:!1}});class j extends s.Data{}exports.ShaderUniformResolution=j,Object.defineProperty(j,"data",{enumerable:!0,writable:!0,value:{uniform:n.Ref()}}),Object.defineProperty(j,"edit",{enumerable:!0,writable:!0,value:{visible:!1}});class C extends s.Data{}exports.ShaderUniformUserTargetPosition=C,Object.defineProperty(C,"data",{enumerable:!0,writable:!0,value:{uniform:n.Ref()}}),Object.defineProperty(C,"edit",{enumerable:!0,writable:!0,value:{visible:!1}});class A extends s.Data{}exports.ShaderUniformUserCharacterPosition=A,Object.defineProperty(A,"data",{enumerable:!0,writable:!0,value:{uniform:n.Ref()}}),Object.defineProperty(A,"edit",{enumerable:!0,writable:!0,value:{visible:!1}});class V extends s.Data{}exports.MovementBoost=V,Object.defineProperty(V,"data",{enumerable:!0,writable:!0,value:{frictionPower:n.Ref(1),value:n.Ref(2),duration:n.Ref(4),elapsed:n.Ref(0)}});class G{}exports.Sequence=G,Object.defineProperty(G,"data",{enumerable:!0,writable:!0,value:{curve:n.Ref(),stanza:n.Ref(0)}});class F extends s.Data{}exports.TargetKeyTween=F,Object.defineProperty(F,"data",{enumerable:!0,writable:!0,value:{pauseOnModal:n.Ref(!1),started:n.Ref(!1),duration:n.Ref(1),elapsed:n.Ref(0),ease:n.Ref("linear"),delay:n.Ref(0),from:n.Ref(0),to:n.Ref(1),active:n.Ref(!0),finished:n.Ref(!1),killEntityOnFinish:n.Ref(!1),assignFromOnStart:n.Ref(!1),target:n.Ref(null),key:n.Ref(""),callbackOnStart:n.Ref(null),callbackOnFinish:n.Ref(null)}});class k extends s.Value{}exports.TweenCopyTargetKeyToVectorScalar=k;class L extends s.Value{}exports.TriggerPoemComplete=L,Object.defineProperty(L,"value",{enumerable:!0,writable:!0,value:n.Ref(null)});class I extends s.Data{}exports.TriggerDelayedPoemOverlay=I,Object.defineProperty(I,"data",{enumerable:!0,writable:!0,value:{root:n.Ref(null),delay:n.Ref(1),elapsed:n.Ref(0),spawned:n.Ref(!1)}});class U extends s.Tag{}exports.PoemLineTriggerActivated=U;class M extends s.Data{}exports.PoemLineActivated=M,Object.defineProperty(M,"data",{enumerable:!0,writable:!0,value:{root:n.Ref(null),node:n.Ref(null)}});class W extends s.Tag{}exports.UserInPoemArea=W;class H extends s.Tag{}exports.UserCompletingPoem=H;class B extends s.Data{}exports.CinematicCameraMoment=B,Object.defineProperty(B,"data",{enumerable:!0,writable:!0,value:{copyStart:n.Ref(!1),target:n.Vector3()}});class E extends s.Data{}exports.MoveUserTo=E,Object.defineProperty(E,"data",{enumerable:!0,writable:!0,value:{target:n.Vector3()}});class z extends s.Data{}exports.TextSprite3D=z,Object.defineProperty(z,"data",{enumerable:!0,writable:!0,value:{text:n.Ref(""),color:n.Color(1,1,1),culling:n.Ref(!0),depth:n.Ref(!0),x:n.Ref(0),y:n.Ref(0),sprite:n.Ref(null),opacity:n.Ref(1),fontStyle:n.Ref("normal"),fontSize:n.Ref(14),parent:n.Ref(null)}});class K extends s.Data{}exports.EnvironmentUnderPlayerState=K,Object.defineProperty(K,"data",{enumerable:!0,writable:!0,value:{lake:n.Ref(null),water:n.Ref(!1)}});class q extends s.Data{}exports.GroundPhysicsBody=q,Object.defineProperty(q,"data",{enumerable:!0,writable:!0,value:{position:n.Vector3(0,0,0),velocity:n.Vector3(0,0,0),speed:n.Ref(1),scale:n.Ref(1),timeScale:n.Ref(1),currentRotation:n.Quaternion(0,0,0,0),spinRotation:n.Quaternion(0,0,0,0),targetRotation:n.Quaternion(0,0,0,0),flatRotation:n.Quaternion(0,0,0,0),rotationAxis:n.Vector3(0,0,0),rotationSpeed:n.Ref(1),rotationAngleOffset:n.Ref(0)}});class Z extends s.Data{}exports.EnvironmentState=Z,Object.defineProperty(Z,"data",{enumerable:!0,writable:!0,value:{name:n.Ref(""),grassInstanceCount:n.Ref(1),grassScale:n.Ref(1),grassTipFactor:n.Ref(1),haikusTotal:n.Ref(5),waterMeshes:n.Array([]),tokens:n.Array([]),solved:n.Ref(0),group:n.Ref(null),lakes:n.Ref(null),data:n.Ref(null),grid:n.Ref(null),samples:n.Ref(null),waterSamples:n.Ref(null),waterColors:n.Ref(null),seed:n.Ref(null),waterId:n.Ref(null),hasLakes:n.Ref(null),idleViewPoint:n.Vector3(),cells:n.Ref(null),colors:n.Ref(null),textures:n.Array([]),patches:n.Array([]),waterMap:n.Ref(null),overlayOpacity:n.Ref(1)}}),Object.defineProperty(Z,"edit",{enumerable:!0,writable:!0,value:{}});class N extends s.Tag{}exports.ActiveEnvironmentState=N;class Q extends s.Data{}exports.EnvironmentCell=Q,Object.defineProperty(Q,"data",{enumerable:!0,writable:!0,value:{environmentState:n.Ref(null),cell:n.Ref(null),random:n.Ref(null),children:n.Array([])}});class _ extends s.Value{}exports.GroundPatchInstance=_,Object.defineProperty(_,"value",{enumerable:!0,writable:!0,value:null});class Y extends s.Tag{}exports.GroundSpawningLeaf=Y;class J extends s.Tag{}exports.GroundSpawningGrass=J;class X extends s.Tag{}exports.GroundSpawningDot=X;class $ extends s.Data{}exports.GroundPlaneView=$,Object.defineProperty($,"data",{enumerable:!0,writable:!0,value:{camera:null,target:null,projectionMatrix:null,layer:5}});class ee extends s.Data{}exports.GrassPlaneView=ee,Object.defineProperty(ee,"data",{enumerable:!0,writable:!0,value:{layer:n.Ref(7)}});class te extends s.Value{}exports.GroundPlaneLayer=te,Object.defineProperty(te,"value",{enumerable:!0,writable:!0,value:null});class ae extends s.Data{}exports.GroundAssetCellSample=ae,Object.defineProperty(ae,"data",{enumerable:!0,writable:!0,value:{x:n.Ref(0),y:n.Ref(0),random:n.Ref(null),cell:n.Ref(null),type:n.Ref(null),children:n.Array([])}});class re extends s.Data{}exports.GroundAssetCellSampleInstance=re,Object.defineProperty(re,"data",{enumerable:!0,writable:!0,value:{worldIndex:n.Ref(0),feature:n.Ref(!1),data:n.Ref(null)}});class se extends s.Value{}exports.GroundAssetCellSampleWithFeature=se;class oe extends s.Tag{}exports.GroundAssetCellSampleToGrow=oe;class ne extends s.Tag{}exports.GroundAssetCellSampleToHide=ne;class le extends s.Value{}exports.GroundAssetSpriteType=le;class ie extends s.Data{}exports.SpriteBlobShadow=ie,Object.defineProperty(ie,"data",{enumerable:!0,writable:!0,value:{size:n.Ref(1),scale:n.Ref(1),offsetX:n.Ref(0),offsetY:n.Ref(0),mesh:n.Ref(null)}});class pe extends s.Data{}exports.SpriteBlobShadowView=pe,Object.defineProperty(pe,"data",{enumerable:!0,writable:!0,value:{target:n.Ref(null),layer:n.Ref(6)}});class de extends s.Data{}exports.PoemLine=de,Object.defineProperty(de,"data",{enumerable:!0,writable:!0,value:{node:n.Ref(null),root:n.Ref(null),nearby:n.Ref(!1),boundingCenter:n.Array([]),boundingRadius:n.Ref(1),curve:n.Ref(null),triggers:n.Array([]),activated:n.Ref(!1),yOffset:n.Ref(.5)}});class xe extends s.Data{}exports.PoemLineTrigger=xe,Object.defineProperty(xe,"data",{enumerable:!0,writable:!0,value:{root:n.Ref(null),ready:n.Ref(!1),activated:n.Ref(!1),progress:n.Ref(0),fragment:n.Ref(""),previous:n.Ref(null),next:n.Ref(null),parent:n.Ref(null),position:n.Vector3()}});class ce extends s.Data{}exports.GroundMeshWithPoem=ce,Object.defineProperty(ce,"data",{enumerable:!0,writable:!0,value:{mesh:n.Ref(null),id:n.Ref("")}});class ue extends s.Tag{}exports.PoemLineWithinRange=ue;class fe extends s.Value{}exports.TickerTimeline=fe;class Re extends s.Data{}exports.PoemLineMesh=Re,Object.defineProperty(Re,"data",{enumerable:!0,writable:!0,value:{mesh:n.Ref(null),timeline:n.Ref(null),parent:n.Ref(null)}});class me extends s.Tag{}exports.GroundPoemFragmentSprite=me;class be extends s.Data{}exports.PoemTextFragment=be,Object.defineProperty(be,"data",{enumerable:!0,writable:!0,value:{root:n.Ref(null),mesh:n.Ref(null)}});class ge extends s.Value{}exports.PoemRemaining=ge;class Te extends s.Tag{}exports.CanShowCompass=Te;class ye extends s.Value{}exports.NearestEnvironmentCell=ye;class ve extends s.Tag{}exports.HasShownElementalOverlay=ve;class we extends s.Tag{}exports.HasLoaded=we;class Pe extends s.Tag{}exports.IntroLayer=Pe;class Se extends s.Tag{}exports.PoemWriting=Se;class Oe extends s.Tag{}exports.PoemInProgress=Oe;class De extends s.Tag{}exports.PoemLineText=De;class he extends s.Data{}exports.PoemFinishing=he,Object.defineProperty(he,"data",{enumerable:!0,writable:!0,value:{elapsed:n.Ref(0),delay:n.Ref(3)}});class je extends s.Data{}exports.PoemLineVertex=je,Object.defineProperty(je,"data",{enumerable:!0,writable:!0,value:{position:n.Vector3()}});class Ce extends s.Value{}exports.GroundSpawnPosition2D=Ce,Object.defineProperty(Ce,"value",{enumerable:!0,writable:!0,value:n.Array([])});class Ae extends s.Tag{}exports.GroundSpawnTokenTag=Ae;class Ve extends s.Tag{}exports.GroundSpawnDecayTag=Ve;class Ge extends s.Data{}exports.UserWritingState=Ge,Object.defineProperty(Ge,"data",{enumerable:!0,writable:!0,value:{writing:n.Ref(!1),force:n.Ref(!1),ignore:n.Ref(!1)}});class Fe extends s.Data{}exports.KillWritingIgnore=Fe,Object.defineProperty(Fe,"data",{enumerable:!0,writable:!0,value:{elapsed:n.Ref(0),duration:n.Ref(.5)}});class ke extends s.Data{}exports.UserLine=ke,Object.defineProperty(ke,"data",{enumerable:!0,writable:!0,value:{distance:n.Ref(0),writing:n.Ref(!1),changed:n.Ref(!1),active:n.Ref(!1),line:n.Ref(null),elapsed:n.Ref(0),duration:n.Ref(1)}});class Le extends s.Data{}exports.GroundToken=Le,Object.defineProperty(Le,"data",{enumerable:!0,writable:!0,value:{type:n.Ref(""),position:n.Vector3(0,0,0),collected:n.Ref(!1)}});class Ie extends s.Data{}exports.CollectedToken=Ie,Object.defineProperty(Ie,"data",{enumerable:!0,writable:!0,value:{type:n.Ref(""),stanza:n.Ref(null),stanzaIndex:n.Ref(0),x:n.Ref(0),z:n.Ref(0)}});class Ue extends s.Data{}exports.FinishedPoem=Ue,Object.defineProperty(Ue,"data",{enumerable:!0,writable:!0,value:{tokens:n.Array([]),lines:n.Array([])}});class Me extends s.Data{}exports.HaikuAddingToInventory=Me,Object.defineProperty(Me,"data",{enumerable:!0,writable:!0,value:{time:n.Ref(0),delay:n.Ref(.25)}});class We extends s.Tag{}exports.HaikuInInventory=We;class He extends s.Tag{}exports.WaitingForTokenPaper=He;class Be extends s.Value{}exports.ActiveWorldIndex=Be,Object.defineProperty(Be,"value",{enumerable:!0,writable:!0,value:n.Ref(0)});class Ee extends s.Value{}exports.WorldTweens=Ee,Object.defineProperty(Ee,"value",{enumerable:!0,writable:!0,value:n.Array([])});class ze extends s.Value{}exports.WorldDecayTweens=ze,Object.defineProperty(ze,"value",{enumerable:!0,writable:!0,value:n.Array([])});class Ke extends s.Tag{}exports.WaitingToVisitFinalPortal=Ke;class qe extends s.Tag{}exports.HasVisitedFinalPortal=qe;class Ze extends s.Data{}exports.SolvingDecayArea=Ze,Object.defineProperty(Ze,"data",{enumerable:!0,writable:!0,value:{index:n.Ref(0),tween:n.Ref(0)}});class Ne extends s.Data{}exports.AudioMeta=Ne,Object.defineProperty(Ne,"data",{enumerable:!0,writable:!0,value:{names:n.Array([]),paths:n.Array([])}});class Qe extends s.Data{}exports.GroundFogRenderTarget=Qe,Object.defineProperty(Qe,"data",{enumerable:!0,writable:!0,value:{projection:n.Ref(null),target:n.Ref(null)}});class _e extends s.Data{}exports.GroundDataRenderTarget=_e,Object.defineProperty(_e,"data",{enumerable:!0,writable:!0,value:{projection:n.Ref(null),view:n.Ref(null),target:n.Ref(null)}});class Ye extends s.Value{}exports.UserFirstVisitedWorldIndex=Ye,Object.defineProperty(Ye,"value",{enumerable:!0,writable:!0,value:n.Ref(0)});class Je extends s.Data{}exports.DebugRenderTarget=Je,Object.defineProperty(Je,"data",{enumerable:!0,writable:!0,value:{visible:n.Ref(!0),target:n.Ref(null)}});class Xe extends s.Data{}exports.GroundDataParticle=Xe,Object.defineProperty(Xe,"value",{enumerable:!0,writable:!0,value:n.Ref(null)});class $e extends s.Tag{}exports.BlockUserWrite=$e;class et extends s.Tag{}exports.WaitingForUserWrite=et;class tt extends s.Tag{}exports.ShowUserWriteHint=tt;class at extends s.Tag{}exports.ShowUserCollectHint=at;class rt extends s.Tag{}exports.ShowUserTokenInventory=rt;class st extends s.Data{}exports.UserHitAudioTrigger=st,Object.defineProperty(st,"data",{enumerable:!0,writable:!0,value:{type:n.Ref("")}});class ot extends s.Tag{}exports.WillTriggerAudio=ot;class nt extends s.Data{}exports.GroundAsset=nt,Object.defineProperty(nt,"data",{enumerable:!0,writable:!0,value:{x:n.Ref(0),z:n.Ref(0),cellEntity:n.Ref(null)}});class lt extends s.Data{}exports.GroundAssetData=lt,Object.defineProperty(lt,"data",{enumerable:!0,writable:!0,value:{instance:n.Ref(null),key:n.Ref(""),audio:n.Ref(!1),type:n.Ref("sprite"),useMapDiscard:n.Ref(!1),ignoreFlip:n.Ref(!1),rotation:n.Ref(0),flip:n.Ref(!1),scale:n.Vector3(1,1,1),sizeFactor:n.Ref(1),variance:n.Ref(0)}});class it extends s.Value{}exports.MainCameraFrustum=it;class pt extends s.Data{}exports.GroundAssetInsideFrustum=pt;class dt extends s.Data{}exports.GroundAsset3DAsync=dt,Object.defineProperty(dt,"data",{enumerable:!0,writable:!0,value:{url:n.Ref("")}});class xt extends s.Value{}exports.PostProcessEnabled=xt,Object.defineProperty(xt,"value",{enumerable:!0,writable:!0,value:n.Ref(!0)});class ct extends s.Data{}exports.Atmospherics=ct,Object.defineProperty(ct,"data",{enumerable:!0,writable:!0,value:{camera:n.Ref(null),scene:n.Ref(null)}});class ut extends s.Data{}exports.GroundMeshEditableData=ut,Object.defineProperty(ut,"data",{enumerable:!0,writable:!0,value:{uvRepeatScale:n.Ref(1),overrideMap:n.Ref(null),overrideColor:n.Ref("#ffffff"),useOverrideMap:n.Ref(!1),useOverrideColor:n.Ref(!1),useOverrideWater:n.Ref(!1),overrideWater:n.Ref(null),useOverrideWaterColor:n.Ref(!1),overrideWaterColorA:n.Ref("#0000ff"),overrideWaterColorB:n.Ref("#0000ff"),useCustomLUT:n.Ref(!1),lutMap:n.Ref(null)}});class ft extends s.Data{}exports.GrassEditableData=ft,Object.defineProperty(ft,"data",{enumerable:!0,writable:!0,value:{useCustomGrass:n.Ref(!1),customGrassMap:n.Ref(null),grassScale:n.Ref(1)}});class Rt extends s.Data{}exports.RenderLayers=Rt,Object.defineProperty(Rt,"data",{enumerable:!0,writable:!0,value:{groundDepth:n.Ref(4),ground:n.Ref(5),water:n.Ref(6),grass:n.Ref(10),shadow:n.Ref(15),atmospherics:n.Ref(25)}});class mt extends s.Data{}exports.ShadowCaster=mt,Object.defineProperty(mt,"data",{enumerable:!0,writable:!0,value:{sprite:n.Ref(!1)}});class bt extends s.Data{}exports.BloomObject=bt,Object.defineProperty(bt,"data",{enumerable:!0,writable:!0,value:{color:n.Color(1,1,1)}});class gt extends s.Value{}exports.AssetCache=gt;class Tt extends s.Data{}exports.GLTFRefAsset=Tt,Object.defineProperty(Tt,"data",{enumerable:!0,writable:!0,value:{position:n.Array(),boundsMin:n.Vector3(),boundsMax:n.Vector3(),boundsSet:n.Ref(!1),name:n.Ref(""),biome:n.Ref(""),group:n.Ref(null),promise:n.Ref(null)}});class yt extends s.Data{}exports.GLTFRefAssetLoaded=yt,Object.defineProperty(yt,"data",{enumerable:!0,writable:!0,value:{mesh:n.Ref(null)}});class vt extends s.Tag{}exports.IsInFrustum=vt;class wt extends s.Data{}exports.TestLoadRef=wt,Object.defineProperty(wt,"data",{enumerable:!0,writable:!0,value:{position:n.Array(),name:n.Ref("")}});class Pt extends s.Value{}exports.GameUIStore=Pt;class St extends s.Tag{}exports.DirectUserToOrigin=St;class Ot extends s.Tag{}exports.WaitingForBiomeResolution=Ot;class Dt extends s.Tag{}exports.ShowBiomeResolution=Dt;class ht extends s.Tag{}exports.FinalBiomeResolution=ht;class jt extends s.Tag{}exports.FinalBiomeResolutionLines=jt;class Ct extends s.Tag{}exports.EndGameState=Ct;class At extends s.Tag{}exports.TransitionToNextBiome=At;class Vt extends s.Tag{}exports.SafeToSwapBiomes=Vt;class Gt extends s.Data{}exports.BoxHelper=Gt,Object.defineProperty(Gt,"data",{enumerable:!0,writable:!0,value:{entity:n.Ref(null),box:n.Ref(null)}});class Ft extends s.Data{}exports.GroundAssetToken=Ft,Object.defineProperty(Ft,"data",{enumerable:!0,writable:!0,value:{type:n.Ref("")}});class kt extends s.Value{}exports.TokensDiscoveredSet=kt;class Lt extends s.Data{}exports.WrittenStanzaLine=Lt,Object.defineProperty(Lt,"data",{enumerable:!0,writable:!0,value:{started:n.Ref(!1),elapsed:n.Ref(0),startDelay:n.Ref(.33),text:n.Ref(""),line:n.Array([]),type:n.Ref(""),inputs:n.Array([]),fragments:n.Array([]),originPosition2D:n.Vector2(),lastPosition2D:n.Vector2(),active:n.Ref(!1),initial:n.Ref(!0),distance:n.Ref(0),changed:n.Ref(!1),children:n.Array([])}});class It extends s.Tag{}exports.WrittenStanzaLineActive=It;class Ut extends s.Data{}exports.StanzaLineSpawningAsset=Ut,Object.defineProperty(Ut,"data",{enumerable:!0,writable:!0,value:{x:n.Ref(0),z:n.Ref(0),biome:n.Ref("")}});class Mt extends s.Data{}exports.SpawnedFlora=Mt,Object.defineProperty(Mt,"data",{enumerable:!0,writable:!0,value:{height:n.Ref(1),time:n.Ref(0),aspect:n.Ref(1),spawnTime:n.Ref(0),delay:n.Ref(0),duration:n.Ref(5),animateDuration:n.Ref(.75)}});class Wt extends s.Data{reset(){super.reset(),this.playing=!1,this.delay=0,this.elapsed=0,this.finished=!1,this.frame=0,this.dirty=!0,this.lastFrame=null,this.currentLoop=0,null!=this.loopStart&&this.looping&&(this.frame=this.loopStart)}start(){this.playing=!0,this.elapsed=0,this.frame=0,this.finished=!1,this.delay=0,this.dirty=!0,this.lastFrame=null,this.currentLoop=0,null!=this.loopStart&&this.looping&&(this.frame=this.loopStart)}}exports.SpriteAnimation=Wt,Object.defineProperty(Wt,"data",{enumerable:!0,writable:!0,value:{key:n.Ref(""),delay:n.Ref(0),playing:n.Ref(!1),finished:n.Ref(!1),currentLoop:n.Ref(0),looping:n.Ref(!1),elapsed:n.Ref(0),frame:n.Ref(0),sheet:n.Ref(null),lastFrame:n.Ref(null),dirty:n.Ref(!0),fixSpriteAspect:n.Ref(!0),speed:n.Ref(1),loopStart:n.Ref(null),loopEnd:n.Ref(null),onLoopEnd:n.Ref(null)}});class Ht extends s.Data{}exports.SpriteAnimationLazyLoadSheet=Ht,Object.defineProperty(Ht,"data",{enumerable:!0,writable:!0,value:{id:n.Ref(""),playOnLoad:n.Ref(!0),fixSpriteAspectOnLoad:n.Ref(!0)}});class Bt extends s.Tag{}exports.JournalOpen=Bt;class Et extends s.Tag{}exports.PauseOpen=Et;class zt extends s.Tag{}exports.ButtonHover=zt;class Kt extends s.Tag{}exports.ButtonClick=Kt;class qt extends s.Tag{}exports.GameStarted=qt;class Zt extends s.Tag{}exports.SpriteAnimationOriginTreeTag=Zt;class Nt extends s.Data{}exports.CameraFocusOnTarget=Nt,Object.defineProperty(Nt,"data",{enumerable:!0,writable:!0,value:{target:n.Vector3()}});class Qt extends s.Data{}exports.GlowingHaikuCard=Qt,Object.defineProperty(Qt,"data",{enumerable:!0,writable:!0,value:{angle:n.Ref(0),radius:n.Ref(1),y:n.Ref(0),speed:n.Ref(1),driftPhase:n.Ref(0),driftAmplitude:n.Ref(1),driftFrequency:n.Ref(1),time:n.Ref(0),opacity:n.Ref(1),rgbOpaque:n.Color(),rgbTransparent:n.Color()}});class _t extends s.Data{}exports.FloatingToken=_t,Object.defineProperty(_t,"data",{enumerable:!0,writable:!0,value:{type:n.Ref(""),map:n.Ref(null),velocity2D:n.Vector2(0,0),position2D:n.Vector2(0,0),offset3D:n.Vector3(0,0,0),offsetHeight:n.Ref(2),offsetY:n.Ref(0),animateToTreeTime:n.Ref(0),animateToTreeDelay:n.Ref(0),animateToTreeDuration:n.Ref(2),rotationSpeed:n.Ref(1),rotationAngleOffset:n.Ref(1),rotationAxis:n.Vector3(0,0,0),scale:n.Ref(1),time:n.Ref(0),started:n.Ref(!1),speed:n.Ref(1)}});class Yt extends s.Tag{}exports.FloatingTokenTargetUser=Yt;class Jt extends s.Tag{}exports.FloatingTokenShouldTargetTree=Jt;class Xt extends s.Value{}exports.GLTFSpawnItemsMap=Xt;class $t extends s.Tag{}exports.UserCarryingTokenCollectionFeature=$t;class ea extends s.Tag{}exports.WaterFollowParticle=ea;class ta extends s.Value{}exports.HatTipPoint=ta,Object.defineProperty(ta,"value",{enumerable:!0,writable:!0,value:n.Vector3(0,0,0)});class aa extends s.Tag{}exports.HatTipWindLineTag=aa;class ra extends s.Value{}exports.HatTipWindLineSound=ra,Object.defineProperty(ra,"value",{enumerable:!0,writable:!0,value:n.Ref("")});class sa extends s.Tag{}exports.MoveUserToOrigin=sa;class oa extends s.Tag{}exports.OriginTreeIntroSequence=oa;class na extends s.Tag{}exports.OriginTreeIntroSequenceStarted=na;class la extends s.Data{}exports.GameLandingCameraDrift=la,Object.defineProperty(la,"data",{enumerable:!0,writable:!0,value:{fixed:n.Ref(null)}});class ia extends s.Tag{}exports.CameraZoomOut=ia;class pa extends s.Tag{}exports.LetterboxBars=pa;class da extends s.Data{}exports.ScreenFade=da,Object.defineProperty(da,"data",{enumerable:!0,writable:!0,value:{from:n.Ref(0),to:n.Ref(1),duration:n.Ref(1),delay:n.Ref(0),ease:n.Ref("sineIn"),callbackOnStart:n.Ref(null),callbackOnFinish:n.Ref(null)}});class xa extends s.Data{}exports.TextHint=xa,Object.defineProperty(xa,"data",{enumerable:!0,writable:!0,value:{text:n.Ref(""),delay:n.Ref(0),position:n.Vector3(0,0,0),fontSize:n.Ref(32),time:n.Ref(0),duration:n.Ref(2),killing:n.Ref(!1)}});class ca extends s.Tag{}exports.KillTextHint=ca;class ua extends s.Tag{}exports.HaikuCardShown=ua;class fa extends s.Tag{}exports.HaikuCardSaved=fa;class Ra extends s.Tag{}exports.BlockUserMove=Ra;class ma extends s.Tag{}exports.HideCharacter=ma;class ba extends s.Tag{}exports.HideHUD=ba;class ga extends s.Tag{}exports.TutorialState=ga;class Ta extends s.Tag{}exports.TutorialTextHint=Ta;class ya extends s.Tag{}exports.TutorialBarrenGround=ya;class va extends s.Tag{}exports.UserForceApplied=va;class wa extends s.Tag{}exports.BlockTokenCollection=wa;class Pa extends s.Tag{}exports.CanSetIntroTags=Pa;class Sa extends s.Data{}exports.ObjectiveText=Sa,Object.defineProperty(Sa,"data",{enumerable:!0,writable:!0,value:{text:n.Ref(""),delay:n.Ref(0)}});class Oa extends s.Data{}exports.HintOrb=Oa,Object.defineProperty(Oa,"data",{enumerable:!0,writable:!0,value:{origin:n.Vector3(),scale:n.Ref(1),time:n.Ref(0),triggered:n.Ref(!1),trigger:n.Ref(null),scaleFactor:n.Ref(1),line:n.Ref(null)}});class Da extends s.Data{}exports.WindLine=Da,Object.defineProperty(Da,"data",{enumerable:!0,writable:!0,value:{time:n.Ref(0),animateDuration:n.Ref(.25),duration:n.Ref(4)}});class ha extends s.Data{}exports.RainDrop=ha,Object.defineProperty(ha,"data",{enumerable:!0,writable:!0,value:{splat:n.Ref(!1),time:n.Ref(0),speed:n.Ref(5),animateDuration:n.Ref(.25),splatterSpawnPosition:n.Vector3(0,0,0)}});class ja extends s.Data{}exports.RainDropSplatter=ja,Object.defineProperty(ja,"data",{enumerable:!0,writable:!0,value:{time:n.Ref(0),animateDuration:n.Ref(.25),duration:n.Ref(1)}});class Ca extends s.Tag{}exports.Raining=Ca;class Aa extends s.Tag{}exports.LastWalkedLake=Aa;class Va extends s.Data{}exports.AnimalSpawn=Va,Object.defineProperty(Va,"data",{enumerable:!0,writable:!0,value:{biome:n.Ref(""),animal:n.Ref(""),position:n.Vector3(0,0,0),lake:n.Ref(!1),time:n.Ref(0),duration:n.Ref(1)}});class Ga extends s.Tag{}exports.Animal=Ga;class Fa extends s.Tag{}exports.AnimateInCharacter=Fa;class ka extends s.Tag{}exports.AnimateOutCharacter=ka;class La extends s.Data{}exports.TokenForCompass=La,Object.defineProperty(La,"data",{enumerable:!0,writable:!0,value:{distanceSq:n.Ref(0)}});class Ia extends s.Data{}exports.FloatingEndLine=Ia,Object.defineProperty(Ia,"data",{enumerable:!0,writable:!0,value:{time:n.Ref(0),speed:n.Ref(.5),animateDuration:n.Ref(.25),duration:n.Ref(1),delay:n.Ref(0)}});class Ua extends s.Data{}exports.TutorialMessage=Ua,Object.defineProperty(Ua,"data",{enumerable:!0,writable:!0,value:{id:n.Ref(""),iconMode:n.Ref(!1),token:n.Ref(""),message:n.Ref(""),duration:n.Ref(4),time:n.Ref(0),delay:n.Ref(0)}});class Ma extends s.Tag{}exports.GameFinished=Ma;class Wa extends s.Tag{}exports.FoxSpriteTag=Wa;class Ha extends s.Tag{}exports.FoxPurring=Ha;class Ba extends s.Tag{}exports.FoxHm=Ba;class Ea extends s.Tag{}exports.WaterFishPlaceholderTag=Ea;class za extends s.Tag{}exports.UserHasHit=za;class Ka extends s.Data{}exports.CompassVisible=Ka,Object.defineProperty(Ka,"data",{enumerable:!0,writable:!0,value:{position:n.Vector3(0,0,0)}});class qa extends s.Data{}exports.Snowflake=qa,Object.defineProperty(qa,"data",{enumerable:!0,writable:!0,value:{position:n.Vector3(0,0,0),velocity:n.Vector3(0,0,0),size:n.Ref(.1),time:n.Ref(0),duration:n.Ref(5),animateDuration:n.Ref(.2),delay:n.Ref(0)}});class Za extends s.Tag{}exports.ResetToCameraDrift=Za;class Na extends s.Tag{}exports.TokenIsCollecting=Na;class Qa extends s.Tag{}exports.TriggerTokenLine=Qa;class _a extends s.Data{}exports.TokenChildren=_a,Object.defineProperty(_a,"data",{enumerable:!0,writable:!0,value:{complete:n.Ref(!1),line:n.Ref(null),radius:n.Ref(null),center:n.Ref(null),markers:n.Array([]),group:n.Ref(null),removing:n.Ref(!1),removeTime:n.Ref(0),removeDelay:n.Ref(1),killing:n.Ref(!1),stanza:n.Ref(null),type:n.Ref(""),shadow:n.Ref(null),x:n.Ref(0),z:n.Ref(0),stanzaIndex:n.Ref(0)}});class Ya extends s.Tag{}exports.CollectTokenOrb=Ya;class Ja extends s.Data{}exports.GIFRecord=Ja,Object.defineProperty(Ja,"data",{enumerable:!0,writable:!0,value:{encoder:n.Ref(null),frame:n.Ref(0),started:n.Ref(!1),duration:n.Ref(5),width:n.Ref(512),height:n.Ref(512),maxColors:n.Ref(256),format:n.Ref("rgb565")}});class Xa extends s.Tag{}exports.ClearInputPress=Xa;class $a extends s.Value{}exports.AnimalSound=$a,Object.defineProperty($a,"value",{enumerable:!0,writable:!0,value:n.Ref("")});class er extends s.Value{}exports.FlashSound=er,Object.defineProperty(er,"value",{enumerable:!0,writable:!0,value:n.Ref("")});class tr extends s.Tag{}exports.CapeMagicalEffect=tr;class ar extends s.Data{}exports.AutoRemoveCapeMagicalEffect=ar,Object.defineProperty(ar,"data",{enumerable:!0,writable:!0,value:{elapsed:n.Ref(0),delay:n.Ref(2)}});class rr extends s.Data{}exports.ParticleEmit=rr,Object.defineProperty(rr,"data",{enumerable:!0,writable:!0,value:{position:n.Vector3(0,0,0),elapsed:n.Ref(0),duration:n.Ref(1)}});class sr extends s.Data{}exports.MusicalOrb=sr,Object.defineProperty(sr,"data",{enumerable:!0,writable:!0,value:{elapsed:n.Ref(0),duration:n.Ref(4),killing:n.Ref(!1),hit:n.Ref(!1)}});class or extends s.Tag{}exports.OutroFinished=or;class nr extends s.Tag{}exports.TriggerTreeTransitionAudio=nr;
},{"three":74,"../alec-svelte":225,"../alec":535}],60:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./tags");Object.keys(e).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(exports,t,{enumerable:!0,get:function(){return e[t]}})});
},{"./tags":224}],531:[function(require,module,exports) {
"use strict";module.exports=(e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`));
},{}],532:[function(require,module,exports) {
"use strict";var e="%[a-f0-9]{2}",t=new RegExp(e,"gi"),r=new RegExp("("+e+")+","gi");function n(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var r=e.slice(0,t),o=e.slice(t);return Array.prototype.concat.call([],n(r),n(o))}function o(e){try{return decodeURIComponent(e)}catch(c){for(var r=e.match(t),o=1;o<r.length;o++)r=(e=n(r,o).join("")).match(t);return e}}function c(e){for(var t={"%FE%FF":"","%FF%FE":""},n=r.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var c=o(n[0]);c!==n[0]&&(t[n[0]]=c)}n=r.exec(e)}t["%C2"]="";for(var a=Object.keys(t),p=0;p<a.length;p++){var i=a[p];e=e.replace(new RegExp(i,"g"),t[i])}return e}module.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return c(e)}};
},{}],533:[function(require,module,exports) {
"use strict";module.exports=((e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const r=e.indexOf(t);return-1===r?[e]:[e.slice(0,r),e.slice(r+t.length)]});
},{}],534:[function(require,module,exports) {
"use strict";module.exports=function(r,e){for(var t={},n=Object.keys(r),s=Array.isArray(e),a=0;a<n.length;a++){var i=n[a],o=r[i];(s?-1!==e.indexOf(i):e(i,o,r))&&(t[i]=o)}return t};
},{}],222:[function(require,module,exports) {
"use strict";const r=require("strict-uri-encode"),e=require("decode-uri-component"),t=require("split-on-first"),n=require("filter-obj"),o=r=>null==r,a=Symbol("encodeFragmentIdentifier");function s(r){switch(r.arrayFormat){case"index":return e=>(t,n)=>{const o=t.length;return void 0===n||r.skipNull&&null===n||r.skipEmptyString&&""===n?t:null===n?[...t,[u(e,r),"[",o,"]"].join("")]:[...t,[u(e,r),"[",u(o,r),"]=",u(n,r)].join("")]};case"bracket":return e=>(t,n)=>void 0===n||r.skipNull&&null===n||r.skipEmptyString&&""===n?t:null===n?[...t,[u(e,r),"[]"].join("")]:[...t,[u(e,r),"[]=",u(n,r)].join("")];case"comma":case"separator":case"bracket-separator":{const e="bracket-separator"===r.arrayFormat?"[]=":"=";return t=>(n,o)=>void 0===o||r.skipNull&&null===o||r.skipEmptyString&&""===o?n:(o=null===o?"":o,0===n.length?[[u(t,r),e,u(o,r)].join("")]:[[n,u(o,r)].join(r.arrayFormatSeparator)])}default:return e=>(t,n)=>void 0===n||r.skipNull&&null===n||r.skipEmptyString&&""===n?t:null===n?[...t,u(e,r)]:[...t,[u(e,r),"=",u(n,r)].join("")]}}function i(r){let e;switch(r.arrayFormat){case"index":return(r,t,n)=>{e=/\[(\d*)\]$/.exec(r),r=r.replace(/\[\d*\]$/,""),e?(void 0===n[r]&&(n[r]={}),n[r][e[1]]=t):n[r]=t};case"bracket":return(r,t,n)=>{e=/(\[\])$/.exec(r),r=r.replace(/\[\]$/,""),e?void 0!==n[r]?n[r]=[].concat(n[r],t):n[r]=[t]:n[r]=t};case"comma":case"separator":return(e,t,n)=>{const o="string"==typeof t&&t.includes(r.arrayFormatSeparator),a="string"==typeof t&&!o&&l(t,r).includes(r.arrayFormatSeparator);t=a?l(t,r):t;const s=o||a?t.split(r.arrayFormatSeparator).map(e=>l(e,r)):null===t?t:l(t,r);n[e]=s};case"bracket-separator":return(e,t,n)=>{const o=/(\[\])$/.test(e);if(e=e.replace(/\[\]$/,""),!o)return void(n[e]=t?l(t,r):t);const a=null===t?[]:t.split(r.arrayFormatSeparator).map(e=>l(e,r));void 0!==n[e]?n[e]=[].concat(n[e],a):n[e]=a};default:return(r,e,t)=>{void 0!==t[r]?t[r]=[].concat(t[r],e):t[r]=e}}}function c(r){if("string"!=typeof r||1!==r.length)throw new TypeError("arrayFormatSeparator must be single character string")}function u(e,t){return t.encode?t.strict?r(e):encodeURIComponent(e):e}function l(r,t){return t.decode?e(r):r}function p(r){return Array.isArray(r)?r.sort():"object"==typeof r?p(Object.keys(r)).sort((r,e)=>Number(r)-Number(e)).map(e=>r[e]):r}function f(r){const e=r.indexOf("#");return-1!==e&&(r=r.slice(0,e)),r}function y(r){let e="";const t=r.indexOf("#");return-1!==t&&(e=r.slice(t)),e}function m(r){const e=(r=f(r)).indexOf("?");return-1===e?"":r.slice(e+1)}function d(r,e){return e.parseNumbers&&!Number.isNaN(Number(r))&&"string"==typeof r&&""!==r.trim()?r=Number(r):!e.parseBooleans||null===r||"true"!==r.toLowerCase()&&"false"!==r.toLowerCase()||(r="true"===r.toLowerCase()),r}function g(r,e){c((e=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},e)).arrayFormatSeparator);const n=i(e),o=Object.create(null);if("string"!=typeof r)return o;if(!(r=r.trim().replace(/^[?#&]/,"")))return o;for(const a of r.split("&")){if(""===a)continue;let[r,s]=t(e.decode?a.replace(/\+/g," "):a,"=");s=void 0===s?null:["comma","separator","bracket-separator"].includes(e.arrayFormat)?s:l(s,e),n(l(r,e),s,o)}for(const r of Object.keys(o)){const t=o[r];if("object"==typeof t&&null!==t)for(const r of Object.keys(t))t[r]=d(t[r],e);else o[r]=d(t,e)}return!1===e.sort?o:(!0===e.sort?Object.keys(o).sort():Object.keys(o).sort(e.sort)).reduce((r,e)=>{const t=o[e];return Boolean(t)&&"object"==typeof t&&!Array.isArray(t)?r[e]=p(t):r[e]=t,r},Object.create(null))}exports.extract=m,exports.parse=g,exports.stringify=((r,e)=>{if(!r)return"";c((e=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},e)).arrayFormatSeparator);const t=t=>e.skipNull&&o(r[t])||e.skipEmptyString&&""===r[t],n=s(e),a={};for(const e of Object.keys(r))t(e)||(a[e]=r[e]);const i=Object.keys(a);return!1!==e.sort&&i.sort(e.sort),i.map(t=>{const o=r[t];return void 0===o?"":null===o?u(t,e):Array.isArray(o)?0===o.length&&"bracket-separator"===e.arrayFormat?u(t,e)+"[]":o.reduce(n(t),[]).join("&"):u(t,e)+"="+u(o,e)}).filter(r=>r.length>0).join("&")}),exports.parseUrl=((r,e)=>{e=Object.assign({decode:!0},e);const[n,o]=t(r,"#");return Object.assign({url:n.split("?")[0]||"",query:g(m(r),e)},e&&e.parseFragmentIdentifier&&o?{fragmentIdentifier:l(o,e)}:{})}),exports.stringifyUrl=((r,e)=>{e=Object.assign({encode:!0,strict:!0,[a]:!0},e);const t=f(r.url).split("?")[0]||"",n=exports.extract(r.url),o=exports.parse(n,{sort:!1}),s=Object.assign(o,r.query);let i=exports.stringify(s,e);i&&(i=`?${i}`);let c=y(r.url);return r.fragmentIdentifier&&(c=`#${e[a]?u(r.fragmentIdentifier,e):r.fragmentIdentifier}`),`${t}${i}${c}`}),exports.pick=((r,e,t)=>{t=Object.assign({parseFragmentIdentifier:!0,[a]:!1},t);const{url:o,query:s,fragmentIdentifier:i}=exports.parseUrl(r,t);return exports.stringifyUrl({url:o,query:n(s,e),fragmentIdentifier:i},t)}),exports.exclude=((r,e,t)=>{const n=Array.isArray(e)?r=>!e.includes(r):(r,t)=>!e(r,t);return exports.pick(r,n,t)});
},{"strict-uri-encode":531,"decode-uri-component":532,"split-on-first":533,"filter-obj":534}],30:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseQuery=u;var e=require("query-string"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}function u(){if("undefined"==typeof window)return{};const e=t.default.parse(window.location.search);return Object.keys(e).forEach(t=>{null===e[t]&&(e[t]=!0),"false"===e[t]&&(e[t]=!1),"true"===e[t]&&(e[t]=!0),n(e[t])&&(e[t]=Number(e[t]))}),e}function n(e){return"number"==typeof e||(!!/^0x[0-9a-f]+$/i.test(e)||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(e))}exports.default=u();
},{"query-string":222}],28:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t,exports.hideLoader=n;const e=!0;function t(){const e=Symbol.for("wayfinder.config");let t;return e in window?t=window[e]:(window[e]={},t=window[e]),t.context||t.contextLoaded||(t.contextLoaded=!0,t.context=o(),t.context.canvas.style.display="none"),t.haikusPerBiome=2,t}function n(){const e=document.querySelector(".loader");e&&(e.style.display="none")}function o(){return function(e,t,n){const o=[];"webgl2"===t&&o.push("webgl2");let r;o.push("webgl","experimental-webgl");for(let t=0;t<o.length;t++)try{if(null!=(r=e.getContext(o[t],n)))return r}catch(e){}return null}(t().canvas||document.createElement("canvas"),e?"webgl2":"webgl",{alpha:!1,antialias:!1,stencil:!1,depth:!0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1})}
},{}],237:[function(require,module,exports) {
"use strict";function e(e,t){return void 0===e?t:e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],537:[function(require,module,exports) {
"use strict";function t(){const t=new Uint16Array(4);for(let e=0;e<t.length;e++)t[e]=65536*Math.random();return t}function e(e){const n=Math.pow(2,-32),r=32557;let o=new Uint16Array(4);return s(e),{seed:s,next(){const t=o[0],e=o[1],s=o[2],u=o[3],a=33103+r*t|0,c=63335+r*e+(19605*t+(a>>>16))|0,l=31614+r*s+19605*e+(62509*t+(c>>>16))|0,f=5125+r*u+(19605*s+62509*e)+(22609*t+(l>>>16));o[0]=a,o[1]=c,o[2]=l,o[3]=f;const i=(u<<21)+((u>>2^s)<<5)+((s>>2^e)>>11);return n*((i>>>(u>>11)|i<<(31&-(u>>11)))>>>0)}};function s(e){e||(e=t());for(let t=0;t<o.length;t++)o[t]=e[t]}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getRandomState=t,exports.default=e;
},{}],235:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=d;var e=require("../config"),t=f(e),r=require("./defined"),n=f(r),u=require("./prng-pcg"),o=f(u),a=require("./query-string"),i=f(a);function f(e){return e&&e.__esModule?e:{default:e}}const l=(0,t.default)().embed,h=!l&&!i.default.deterministic,s=new Uint16Array(l?[39783,27946,21768,27541]:[9697,37140,38490,15272]);console.log("Random Seed:",[...s]);const c=(0,o.default)(s);function d(){let e=null;null==e&&(e=d.nextSeed());const t=(0,o.default)(e);let r=null,u=!1;return{seed(e){t.seed(e),r=null,u=!1},value:a,valueNonZero:function(){var e=0;for(;0===e;)e=a();return e},sign:function(){return i()?1:-1},boolean:i,chance:function(e){if("number"!=typeof(e=(0,n.default)(e,.5)))throw new TypeError("expected n to be a number");return a()<e},range:f,rangeFloor:l,pick:function(e){return 0===e.length?void 0:e[l(0,e.length)]},shuffle:h,onCircle:s,insideCircle:function(e,t){e=(0,n.default)(e,1),s(1,t=t||[]);var r=e*Math.sqrt(a());return t[0]*=r,t[1]*=r,t},onSphere:function(e,t){e=(0,n.default)(e,1),t=t||[];var r=a()*Math.PI*2,u=2*a()-1,o=r,i=Math.acos(u);return t[0]=e*Math.sin(i)*Math.cos(o),t[1]=e*Math.sin(i)*Math.sin(o),t[2]=e*Math.cos(i),t},insideSphere:function(e,t){e=(0,n.default)(e,1),t=t||[];var r=a()*Math.PI*2,u=2*a()-1,o=a(),i=r,f=Math.acos(u),l=e*Math.cbrt(o);return t[0]=l*Math.sin(f)*Math.cos(i),t[1]=l*Math.sin(f)*Math.sin(i),t[2]=l*Math.cos(f),t},quaternion:function(e){e=e||[];var t=a(),r=a(),n=a(),u=Math.sqrt(1-t),o=Math.sqrt(t),i=2*Math.PI*r,f=2*Math.PI*n,l=Math.sin(i)*u,h=Math.cos(i)*u,s=Math.sin(f)*o,c=Math.cos(f)*o;return e[0]=l,e[1]=h,e[2]=s,e[3]=c,e},weighted:M,weightedSet:function(e){return 0===(e=e||[]).length?null:e[c(e)].value},weightedSetIndex:c,deck:function(e){e=h(e);let t=0;return{get array(){return e},get index(){return t},get current(){return e[t]},reset(){this.shuffle(),t=0},next(){let r=this.current;return++t>e.length-1&&(this.shuffle(),t=0),r},nextIndex(){let r=t;return++t>e.length-1&&(this.shuffle(),t=0),r},shuffle(){e=h(e)}}},gaussian:function(e,t){if(e=(0,n.default)(e,0),t=(0,n.default)(t,1),u){u=!1;var o=r;return r=null,e+t*o}var i=0,f=0,l=0;do{i=2*a()-1,f=2*a()-1,l=i*i+f*f}while(l>=1||0===l);var h=Math.sqrt(-2*Math.log(l)/l);return r=f*h,u=!0,e+t*(i*h)}};function a(){return t.next()}function i(){return a()>.5}function f(e,t){if(void 0===t&&(t=e,e=0),"number"!=typeof e||"number"!=typeof t)throw new TypeError("Expected all arguments to be numbers");return a()*(t-e)+e}function l(e,t){if(void 0===t&&(t=e,e=0),"number"!=typeof e||"number"!=typeof t)throw new TypeError("Expected all arguments to be numbers");return Math.floor(f(e,t))}function h(e){if(!Array.isArray(e))throw new TypeError("Expected Array, got "+typeof e);for(var t,r,n=e.length,u=e.slice();n;)t=Math.floor(a()*n--),r=u[n],u[n]=u[t],u[t]=r;return u}function s(e,t){e=(0,n.default)(e,1),t=t||[];var r=2*a()*Math.PI;return t[0]=e*Math.cos(r),t[1]=e*Math.sin(r),t}function c(e){return 0===(e=e||[]).length?-1:M(e.map(function(e){return e.weight}))}function M(e){if(0===(e=e||[]).length)return-1;var t,r=0;for(t=0;t<e.length;t++)r+=e[t];if(r<=0)throw new Error("Weights must sum to > 0");var n=a()*r;for(t=0;t<e.length;t++){if(n<e[t])return t;n-=e[t]}return 0}}d.nextSeed=function(e=new Uint16Array(4)){for(let t=0;t<4;t++)e[t]=h?65536*Math.random():65536*c.next();return e},d.getRandomState=u.getRandomState;
},{"../config":28,"./defined":237,"./prng-pcg":537,"./query-string":30}],742:[function(require,module,exports) {
module.exports=function(){for(var o=0;o<arguments.length;o++)if(void 0!==arguments[o])return arguments[o]};
},{}],741:[function(require,module,exports) {
function r(r,e,o){if("number"!=typeof e||"number"!=typeof o)throw new TypeError('Must specify "to" and "from" arguments as numbers');if(e>o){var t=e;e=o,o=t}var n=o-e;return 0===n?o:r-n*Math.floor((r-e)/n)}module.exports=r;
},{}],306:[function(require,module,exports) {
var r=require("defined"),n=require("./lib/wrap"),e=Number.EPSILON;function t(r,n,e){return n<e?r<n?n:r>e?e:r:r<e?e:r>n?n:r}function o(r){return t(r,0,1)}function u(r,n,e){return r*(1-e)+n*e}function a(r,n,t){return Math.abs(r-n)<e?0:(t-r)/(n-r)}function i(r,n,e){var o=t(a(r,n,e),0,1);return o*o*(3-2*o)}function f(n,e){return e=r(e,0),"number"==typeof n&&isFinite(n)?n:e}function p(n){if("number"!=typeof n)throw new TypeError("Expected dims argument");return function(e,t){var o;t=r(t,0),null==e?o=t:"number"==typeof e&&isFinite(e)&&(o=e);var u,a=[];if(null==o)for(u=0;u<n;u++)a[u]=f(e[u],t);else for(u=0;u<n;u++)a[u]=o;return a}}function c(r,n,e,t){if(t=t||[],r.length!==n.length)throw new TypeError("min and max array are expected to have the same length");for(var o=0;o<r.length;o++)t[o]=u(r[o],n[o],e);return t}function m(n,e){if("number"!=typeof(n=r(n,0)))throw new TypeError("Expected n argument to be a number");for(var t=[],o=0;o<n;o++)t.push(e);return t}function h(n,e){if("number"!=typeof(n=r(n,0)))throw new TypeError("Expected n argument to be a number");"boolean"==typeof(e=e||{})&&(e={endpoint:!0});var t=r(e.offset,0);return e.endpoint?m(n).map(function(r,e){return n<=1?0:(e+t)/(n-1)}):m(n).map(function(r,e){return(e+t)/n})}function l(r,n,e){n=t(n,0,1);var o=r.length-1,a=n*o,i=Math.floor(a),f=a-i,p=Math.min(i+1,o),m=r[i%r.length],h=r[p%r.length];if("number"==typeof m&&"number"==typeof h)return u(m,h,f);if(Array.isArray(m)&&Array.isArray(h))return c(m,h,f,e);throw new TypeError("Mismatch in value type of two array elements: "+i+" and "+p)}function y(r,n){return(r%n+n)%n}function d(r){return r*Math.PI/180}function s(r){return 180*r/Math.PI}function b(r){return r-Math.floor(r)}function g(r){return r>0?1:r<0?-1:0}function v(r,n){return r=y(r,2*n),n-Math.abs(r-n)}function w(r,n,e,t){return u(r,n,1-Math.exp(-e*t))}function x(r,n,e,t,o){o=o||[];for(var u=0;u<r.length;u++)o[u]=w(r[u],n[u],e,t);return o}function M(r,n,t,o,u,a){if(Math.abs(n-t)<e)return o;var i=(r-n)/(t-n)*(u-o)+o;return a&&(u<o?i<u?i=u:i>o&&(i=o):i>u?i=u:i<o&&(i=o)),i}module.exports={mod:y,fract:b,sign:g,degToRad:d,radToDeg:s,wrap:n,pingPong:v,linspace:h,lerp:u,lerpArray:c,inverseLerp:a,lerpFrames:l,clamp:t,clamp01:o,smoothstep:i,damp:w,dampArray:x,mapRange:M,expand2D:p(2),expand3D:p(3),expand4D:p(4)};
},{"defined":742,"./lib/wrap":741}],240:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("canvas-sketch-util/math");Object.keys(e).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(exports,t,{enumerable:!0,get:function(){return e[t]}})}),exports.dampVector=u,exports.sign=i,exports.moveTowardVector=l,exports.moveToward=p,exports.repeat=d,exports.deltaAngle=x,exports.wrapAngle=f,exports.lerpAngle=m,exports.dampAngle=h,exports.getDistSq2D=M,exports.quaternionFromNormal=v,exports.sphericalToCartesian=I,exports.getScreenSpaceCameraUp=y,exports.getScreenSpaceCameraRight=P,exports.addScreenSpaceUV=V,exports.map=g;var t=require("three"),r=n(t);function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}const o=new r.Vector3,a=new r.Vector3,s=new r.Vector3,c=new r.Vector3;function u(t,r,n,o,a=t){return a.x=(0,e.damp)(t.x,r.x,n,o),a.y=(0,e.damp)(t.y,r.y,n,o),a.z=(0,e.damp)(t.z,r.z,n,o),a}function i(e){return e>=0?1:-1}function l(e,t,r,n,o=e){c.copy(t).sub(e);const a=c.length();0!==a&&c.divideScalar(a);const s=r*n;return a<=s?o.copy(t):(o.addScaledVector(c,s),o)}function p(e,t,r,n){const o=r*n;return Math.abs(t-e)<=o?t:e+i(t-e)*o}function d(e,t){return e-Math.floor(e/t)*t}function x(e,t){let r=d(t-e,2*Math.PI);return r>Math.PI&&(r-=2*Math.PI),r}function f(e){let t=d(e,2*Math.PI);return t>Math.PI&&(t-=2*Math.PI),t}function m(t,r,n){let o=d(r-t,2*Math.PI);return o>Math.PI&&(o-=2*Math.PI),t+o*(0,e.clamp01)(n)}function h(e,t,r,n){return e+x(e,t)*(1-Math.exp(-r*n))}function M(e,t){const r=t.x-e.x,n=t.z-e.z;return r*r+n*n}function v(e,t){if(t=t||new r.Quaternion,e.y>.99999)t.set(0,0,0,1);else if(e.y<-.99999)t.set(1,0,0,0);else{s.set(e.z,0,-e.x).normalize();var n=Math.acos(e.y);t.setFromAxisAngle(s,n)}return t}function I(e,t,n=new r.Vector3){return e=Math.PI/2-e,n.set(Math.sin(e)*Math.sin(t),Math.cos(e),Math.sin(e)*Math.cos(t)),n}function y(e,t=new r.Vector3){const n=e.matrixWorldInverse.elements[4],o=e.matrixWorldInverse.elements[5],a=e.matrixWorldInverse.elements[6];return t.set(n,o,a),t}function P(e,t=new r.Vector3){const n=e.matrixWorldInverse.elements[0],o=e.matrixWorldInverse.elements[1],a=e.matrixWorldInverse.elements[2];return t.set(n,o,a),t}function V(e,t,r,n){const s=y(e,o),c=P(e,a);return t.addScaledVector(c,r),t.addScaledVector(s,n),t}function g(e,t,r,n,o){return n+(o-n)*(e-t)/(r-t)}
},{"canvas-sketch-util/math":306,"three":74}],709:[function(require,module,exports) {
function r(r){var e=2.5949095;return(r*=2)<1?r*r*((e+1)*r-e)*.5:.5*((r-=2)*r*((e+1)*r+e)+2)}module.exports=r;
},{}],710:[function(require,module,exports) {
function r(r){var e=1.70158;return r*r*((e+1)*r-e)}module.exports=r;
},{}],711:[function(require,module,exports) {
function r(r){var e=1.70158;return--r*r*((e+1)*r+e)+1}module.exports=r;
},{}],714:[function(require,module,exports) {
function r(r){var e=r*r;return r<4/11?7.5625*e:r<8/11?9.075*e-9.9*r+3.4:r<.9?4356/361*e-35442/1805*r+16061/1805:10.8*r*r-20.52*r+10.72}module.exports=r;
},{}],712:[function(require,module,exports) {
var e=require("./bounce-out");function r(r){return r<.5?.5*(1-e(1-2*r)):.5*e(2*r-1)+.5}module.exports=r;
},{"./bounce-out":714}],713:[function(require,module,exports) {
var e=require("./bounce-out");function r(r){return 1-e(1-r)}module.exports=r;
},{"./bounce-out":714}],715:[function(require,module,exports) {
function t(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}module.exports=t;
},{}],716:[function(require,module,exports) {
function t(t){return 1-Math.sqrt(1-t*t)}module.exports=t;
},{}],717:[function(require,module,exports) {
function t(t){return Math.sqrt(1- --t*t)}module.exports=t;
},{}],718:[function(require,module,exports) {
function o(o){return o<.5?4*o*o*o:.5*Math.pow(2*o-2,3)+1}module.exports=o;
},{}],719:[function(require,module,exports) {
function e(e){return e*e*e}module.exports=e;
},{}],720:[function(require,module,exports) {
function r(r){var e=r-1;return e*e*e+1}module.exports=r;
},{}],721:[function(require,module,exports) {
function t(t){return t<.5?.5*Math.sin(13*Math.PI/2*2*t)*Math.pow(2,10*(2*t-1)):.5*Math.sin(-13*Math.PI/2*(2*t-1+1))*Math.pow(2,-10*(2*t-1))+1}module.exports=t;
},{}],722:[function(require,module,exports) {
function t(t){return Math.sin(13*t*Math.PI/2)*Math.pow(2,10*(t-1))}module.exports=t;
},{}],723:[function(require,module,exports) {
function t(t){return Math.sin(-13*(t+1)*Math.PI/2)*Math.pow(2,-10*t)+1}module.exports=t;
},{}],724:[function(require,module,exports) {
function o(o){return 0===o||1===o?o:o<.5?.5*Math.pow(2,20*o-10):-.5*Math.pow(2,10-20*o)+1}module.exports=o;
},{}],725:[function(require,module,exports) {
function o(o){return 0===o?o:Math.pow(2,10*(o-1))}module.exports=o;
},{}],726:[function(require,module,exports) {
function o(o){return 1===o?o:1-Math.pow(2,-10*o)}module.exports=o;
},{}],727:[function(require,module,exports) {
function e(e){return e}module.exports=e;
},{}],728:[function(require,module,exports) {
function e(e){return(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1)}module.exports=e;
},{}],729:[function(require,module,exports) {
function e(e){return e*e}module.exports=e;
},{}],730:[function(require,module,exports) {
function e(e){return-e*(e-2)}module.exports=e;
},{}],731:[function(require,module,exports) {
function o(o){return o<.5?8*Math.pow(o,4):-8*Math.pow(o-1,4)+1}module.exports=o;
},{}],732:[function(require,module,exports) {
function o(o){return Math.pow(o,4)}module.exports=o;
},{}],733:[function(require,module,exports) {
function o(o){return Math.pow(o-1,3)*(1-o)+1}module.exports=o;
},{}],734:[function(require,module,exports) {
function e(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}module.exports=e;
},{}],735:[function(require,module,exports) {
function e(e){return e*e*e*e*e}module.exports=e;
},{}],736:[function(require,module,exports) {
function e(e){return--e*e*e*e*e+1}module.exports=e;
},{}],737:[function(require,module,exports) {
function t(t){return-.5*(Math.cos(Math.PI*t)-1)}module.exports=t;
},{}],302:[function(require,module,exports) {
function t(t){var a=Math.cos(t*Math.PI*.5);return Math.abs(a)<1e-14?1:1-a}module.exports=t;
},{}],303:[function(require,module,exports) {
function t(t){return Math.sin(t*Math.PI/2)}module.exports=t;
},{}],291:[function(require,module,exports) {
module.exports={backInOut:require("./back-in-out"),backIn:require("./back-in"),backOut:require("./back-out"),bounceInOut:require("./bounce-in-out"),bounceIn:require("./bounce-in"),bounceOut:require("./bounce-out"),circInOut:require("./circ-in-out"),circIn:require("./circ-in"),circOut:require("./circ-out"),cubicInOut:require("./cubic-in-out"),cubicIn:require("./cubic-in"),cubicOut:require("./cubic-out"),elasticInOut:require("./elastic-in-out"),elasticIn:require("./elastic-in"),elasticOut:require("./elastic-out"),expoInOut:require("./expo-in-out"),expoIn:require("./expo-in"),expoOut:require("./expo-out"),linear:require("./linear"),quadInOut:require("./quad-in-out"),quadIn:require("./quad-in"),quadOut:require("./quad-out"),quartInOut:require("./quart-in-out"),quartIn:require("./quart-in"),quartOut:require("./quart-out"),quintInOut:require("./quint-in-out"),quintIn:require("./quint-in"),quintOut:require("./quint-out"),sineInOut:require("./sine-in-out"),sineIn:require("./sine-in"),sineOut:require("./sine-out")};
},{"./back-in-out":709,"./back-in":710,"./back-out":711,"./bounce-in-out":712,"./bounce-in":713,"./bounce-out":714,"./circ-in-out":715,"./circ-in":716,"./circ-out":717,"./cubic-in-out":718,"./cubic-in":719,"./cubic-out":720,"./elastic-in-out":721,"./elastic-in":722,"./elastic-out":723,"./expo-in-out":724,"./expo-in":725,"./expo-out":726,"./linear":727,"./quad-in-out":728,"./quad-in":729,"./quad-out":730,"./quart-in-out":731,"./quart-in":732,"./quart-out":733,"./quint-in-out":734,"./quint-in":735,"./quint-out":736,"./sine-in-out":737,"./sine-in":302,"./sine-out":303}],108:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.tweenTo=c,exports.createTimerTween=u,exports.tweenFromTo=f,exports.setEntityTweenFromTo=y,exports.default=d;var e=require("../tags"),t=l(e),n=require("three"),a=l(n),r=require("../util/math"),i=l(r),o=require("eases"),s=l(o);function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function c(e,n,a,r,i,o,s){const l=e.entity();return y(l,n,a,n[a],r,i,o,s),l.get(t.TargetKeyTween).assignFromOnStart=!0,l}function u(e,t,n,a,r){const i=e.entity();return y(i,null,null,0,1,t,null,n),i}function f(e,t,n,a,r,i,o,s){const l=e.entity();return y(l,t,n,a,r,i,o,s),l}function y(e,n,a,r,i,o,s,l){e.add(t.TargetKeyTween);const c=e.get(t.TargetKeyTween);c.duration=null!=o?o:1,c.ease=s||"linear",c.target=n,c.key=a,c.from=r,c.to=i,c.delay=l||0,c.elapsed=0,c.finished=!1,c.active=!0,c.started=!1,c.killEntityOnFinish=!0,c.assignFromOnStart=!1}function d(e){const n=e.view(t.TargetKeyTween),a=e.view([t.TargetKeyTween,t.TweenCopyTargetKeyToVectorScalar]);return function(r){const o=Boolean(e.findTag(t.ModalStoppingUserMovement));n.forEach(e=>{const n=e.get(t.TargetKeyTween);if(n.active&&(!n.pauseOnModal||!o)){if(!n.finished){if(n.elapsed>=n.delay){let t=Math.min(1,Math.max(0,n.elapsed-n.delay)/n.duration);"string"==typeof n.ease&&n.ease&&n.ease in s?t=s[n.ease](t):"function"==typeof n.ease&&(t=n.ease(t)),n.started||(n.assignFromOnStart&&n.target&&(n.from=n.target[n.key]),n.started=!0,n.callbackOnStart&&"function"==typeof n.callbackOnStart&&n.callbackOnStart(e)),n.target&&(n.target[n.key]=i.lerp(n.from,n.to,t))}n.elapsed+=r,n.elapsed-n.delay>n.duration&&(n.finished=!0,n.target&&(n.target[n.key]=n.to),n.callbackOnFinish&&"function"==typeof n.callbackOnFinish&&n.callbackOnFinish(e))}n.finished&&n.killEntityOnFinish&&e.kill()}}),a.forEach(e=>{const n=e.get(t.TargetKeyTween);if(!n.active)return;const a=e.get(t.TweenCopyTargetKeyToVectorScalar);if(n.started&&n.target&&n.key){const e=n.target[n.key];a&&a.setScalar(e)}})}}
},{"../tags":60,"three":74,"../util/math":240,"eases":291}],83:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=d;var e=require("../tags"),t=c(e),n=require("three"),i=c(n),a=require("../util/Random"),o=u(a),r=require("../util/ObjectPool"),l=u(r),s=require("./AnimationSystem");function u(e){return e&&e.__esModule?e:{default:e}}function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function d(e){const n=new i.IcosahedronGeometry(1,0),a=new l.default({maxCapacity:50,initialCapacity:50,create(){const e=new i.Mesh(n,new i.MeshBasicMaterial({name:"snow"}));return e.userData._entity=null,e.frustumCulled=!1,e.visible=!1,e},release(e){}});let r=0;const u=(0,o.default)(),c=new i.Vector3,d=[0,0],f=e.findTag(t.UserTarget),v=e.view([t.Snowflake,t.Object3D]),y=e.view([t.EnvironmentState,t.ActiveEnvironmentState]);let m={value:1};const p=e.listen(t.FinalBiomeResolution);return function(n){"tundra"===(y.length?y[0].get(t.EnvironmentState).name:null)&&(p.changed&&p.added.length>0?(0,s.tweenTo)(e,m,"value",0,2,"sineOut"):p.changed&&p.removing.length>0&&(0,s.tweenTo)(e,m,"value",1,2,"sineOut"),(r+=n)>=.1&&(r%=.1,c.copy(f.position),u.insideCircle(20,d),c.x+=d[0],c.z+=d[1],c.y+=u.range(4,20),m.value>0&&function(n){const i=a.next();if(!i)return;i.userData._entity=e.entity().add(t.Snowflake).add(t.Object3D,i);const o=i.userData._entity.get(t.Snowflake);i.scale.setScalar(.05),o.size=.05,o.position.copy(n),o.velocity.set(0,-1,0),i.visible=!1}(c)),v.forEach(e=>{const i=e.get(t.Snowflake);i.velocity.x=.5*Math.sin(2*i.time),i.velocity.z=.25*Math.sin(1*i.time),i.position.addScaledVector(i.velocity,1*n);const o=e.get(t.Object3D);o.visible=!0,o.position.copy(i.position),i.time+=n;const r=function(e,t,n,i=linear){let a=0;if(e<=n)a=e/n;else if(e>=t-n){const i=Math.max(0,e-(t-n)),o=i/n;a=1-o}else a=1;return a}(i.time,i.duration,i.animateDuration,i.delay),l=i.size*r*m.value;o.scale.setScalar(l);o.material.color.setRGB(1.75,1.75,1.75),(i.time>=i.duration||i.position.y<0)&&(a.release(o),o.userData._entity=null,e.kill())}))}}
},{"../tags":60,"three":74,"../util/Random":235,"../util/ObjectPool":236,"./AnimationSystem":108}],266:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/silkamono-regularitalic-webfont.83c11163.woff2";
},{}],243:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.create=f,exports.push=p,exports.initialize=d;var e=require("three"),r=o(e),t=require("./ObjectPool"),n=a(t);function a(e){return e&&e.__esModule?e:{default:e}}function o(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}const l=[],s=new r.Mesh(new r.BoxGeometry(1,1,1),new r.MeshBasicMaterial);s.name="shader-manager-box";const u=new r.Scene,i=new r.OrthographicCamera(-1,1,-1,1,-10,10),c=[],h=new n.default({create(){const e=s.clone();return u.add(e),e},release(e){e.parent&&e.parent.remove(e)}});function f(e){const t=new r.ShaderMaterial(e);return l.push(t),e.name||console.error("Must specify name for ShaderMaterial"),t}function p(e){l.push(e)}function d(e,r=1/0){if(l.length<=0)return;const t=Math.min(r,l.length);c.length=t;for(let e=0;e<t;e++)c[e]=h.next(),c[e].material=l[e];e.render(u,i);for(let e=0;e<t;e++){const r=c[e];r.material=null,h.release(r)}c.length=0,l.length=l.length-t}
},{"three":74,"./ObjectPool":236}],238:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};exports.default=i;var r=require("three"),n=l(r),o=require("./ShaderManager"),a=l(o);function l(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r}let t;function i(r={}){const{map:o=new n.Texture,scale:l=1,opacity:t=1,color:i="white"}=r;let v=r.geometry;v||(v=new n.PlaneGeometry(1,1,1,1)).translate(0,.5,0);const c=r.blending===n.MultiplyBlending,d=r.rgba,u=null!=r.groundMap&&null!=r.groundProjectionMatrix,g=e({},r);delete g.geometry,delete g.groundMap,delete g.groundProjectionMatrix,delete g.color,delete g.rgba,delete g.opacity,delete g.map,delete g.scale;const s=a.create(e({name:"createPlaneSprite"},g,{defines:{IS_RGBA:d,IS_MULTIPLY:c,IS_GROUND_MAP:u},fragmentShader:"\n      varying vec2 vUv;\n      uniform sampler2D map;\n      uniform vec3 color;\n      uniform float opacity;\n      #ifdef IS_GROUND_MAP\n      uniform sampler2D groundMap;\n      varying vec3 vGroundColor;\n      varying vec2 vGroundUv;\n      varying float vGroundY;\n      #endif\n      void main () {\n        vec4 tcol = texture2D(map, vUv);\n        #if defined(IS_RGBA)\n        gl_FragColor.rgba = tcol;\n        gl_FragColor.rgb *= color;\n        gl_FragColor.a *= opacity;\n        #elif defined(IS_MULTIPLY)\n        gl_FragColor.rgb = mix(vec3(1.0), tcol.rgb * color, tcol.a * opacity);\n        gl_FragColor.a = 1.0;\n        #else\n        gl_FragColor.rgba = tcol;\n        gl_FragColor.rgb *= color;\n        gl_FragColor.a *= opacity;\n        #endif\n        #ifdef IS_GROUND_MAP\n        // vec3 vGroundColor = texture2D(groundMap, vGroundUv).rgb;\n        gl_FragColor.rgb = mix(vGroundColor, gl_FragColor.rgb, vGroundY);\n        gl_FragColor.a = tcol.a * opacity;\n        #endif\n\n      }\n    ",vertexShader:"\n      #include <common>\n      uniform float rotation;\n      uniform vec2 repeat;\n      uniform vec2 offset;\n      uniform float globalScale;\n      uniform float flip;\n      uniform vec2 translate;\n      varying vec3 vObjectCoord;\n      varying vec2 vScreenScale;\n      varying vec2 vUv;\n      #ifdef IS_GROUND_MAP\n      varying float vGroundY;\n      uniform mat4 groundProjectionMatrix;\n      uniform sampler2D groundMap;\n      varying vec3 vGroundColor;\n      varying vec2 vGroundUv;\n      uniform float groundYDistance;\n      #endif\n      void main () {\n        vUv = uv;\n        vUv *= repeat;\n        vUv += offset;\n        \n        vec3 centerWorldPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n        vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n        vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n        vec2 scale;\n        scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n        scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n        scale.x *= flip;\n        scale *= globalScale;\n        vScreenScale = scale.xy;\n\n        vec3 vertexWorldPos = centerWorldPos\n          + camRightWorld * position.x * scale.x\n          + camUpWorld * position.y * scale.y;\n\n        #ifdef IS_GROUND_MAP\n          vec3 vertexCenterWorldPos = centerWorldPos;\n          vec4 baseClipPos = groundProjectionMatrix * viewMatrix * vec4(vertexCenterWorldPos, 1.0);\n          vGroundUv = baseClipPos.xy / baseClipPos.w * 0.5 + 0.5;\n          vGroundColor = texture2D(groundMap, vGroundUv).rgb;\n          vGroundY = vertexWorldPos.y / groundYDistance;\n        #endif\n\n        vertexWorldPos += camRightWorld * translate.x * scale.x;\n        vertexWorldPos += camUpWorld * translate.y * scale.y;\n\n        gl_Position = projectionMatrix * viewMatrix * vec4(vertexWorldPos, 1.0);\n        vObjectCoord = vec3(position.xy, 0.0);\n      }\n    ",uniforms:{map:{value:o||new n.Texture},groundMap:{value:r.groundMap||new n.Texture},groundProjectionMatrix:{value:r.groundProjectionMatrix||new n.Matrix4},groundYDistance:{value:.5},flip:{value:1},globalScale:{value:l},color:{value:new n.Color(i)},translate:{value:new n.Vector2(0,0)},repeat:{value:new n.Vector2(1,1)},offset:{value:new n.Vector2(0,0)},opacity:{value:t}}}));return new n.Mesh(v,s)}
},{"three":74,"./ShaderManager":243}],80:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.detachObject=o,exports.addObject=n,exports.removeFromObject=l,exports.clearGroup=c,exports.copyTextureHandle=u,exports.pruneUserData=p,exports.disposeTree=f,exports.setPointsToBufferPosition=d,exports.shareAtlasTexture=m,exports.fastCopyCameraData=x,exports.cloneMaterial=y;var e=require("three"),t=s(e),r=require("./array");function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}const a={type:"added"},i={type:"removed"};function o(e){e.parent&&l(e.parent,e)}function n(e,t){o(t),t.parent=e,e.children.push(t),e.dispatchEvent(a)}function l(e,t){const s=e.children.indexOf(t);s>=0&&((0,r.spliceOne)(e.children,s),t.parent=null,t.dispatchEvent(i))}function c(e){for(let t=0;t<e.children.length;t++){const r=e.children[t];r.parent=null,r.dispatchEvent(i)}e.children.length=0}function u(e,t,r){if(r.image&&!t.__hasFixedTexture){const s=e.properties.get(r);s.__webglTexture||(console.warn("Re-uploading texture data"),e.initTexture(r));const a=e.properties.get(t);Object.assign(a,s),t.__hasFixedTexture=!0}}function p(e){const t=e.userData;Object.keys(t).forEach(r=>{r.startsWith("_")?delete t[r]:"name"===r&&t.name===e.name&&delete t[r]})}function f(e,{textures:t=!1}={}){e.traverse(e=>{if(!e.__hasDisposedAlready&&("function"==typeof e.dispose&&(e.dispose(),e.__hasDisposedAlready=!0),e.geometry&&"function"==typeof e.geometry.dispose&&!e.geometry.__hasDisposedAlready&&(e.geometry.dispose(),e.geometry.__hasDisposedAlready=!0),e.material&&"function"==typeof e.material.dispose&&!e.material.__hasDisposedAlready&&(e.material.dispose(),e.material.__hasDisposedAlready=!0),e.material&&t)){const t=e.material;Object.keys(t).forEach(e=>{t[e]&&t[e].isTexture&&t[e].dispose()}),t.uniforms&&Object.keys(t.uniforms).forEach(e=>{t[e]&&t[e].value&&t[e].value.isTexture&&t[e].value.dispose()})}}),c(e)}function d(e,r){const s=r.map(e=>Array.isArray(e)?e:e.toArray()).flat();e.setAttribute("position",new t.Float32BufferAttribute(s,3))}function m(e,t,r){if(t.image&&r.__hasFixedTexture!==t){r.__hasFixedTexture=t;const s=e.properties.get(t);s.__webglTexture||e.initTexture(t);const a=e.properties.get(r);Object.assign(a,s)}}function x(e,r){t.Camera.prototype.copy.call(r,e),r.fov=e.fov,r.zoom=e.zoom,r.near=e.near,r.far=e.far,r.focus=e.focus,r.aspect=e.aspect,r.filmGauge=e.filmGauge,r.filmOffset=e.filmOffset}function y(e){const t=e.material;e.material=t.clone(),e.material.uniforms=Object.assign({},t.uniforms);for(let r in t.uniforms){const s=t.uniforms[r].value;s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4?e.material.uniforms[r]=Object.assign({},e.material.uniforms[r],{value:s.clone()}):Array.isArray(s)?e.material.uniforms[r]=Object.assign({},e.material.uniforms[r],{value:s.slice()}):e.material.uniforms[r]=Object.assign({},e.material.uniforms[r],{value:s})}}
},{"three":74,"./array":139}],767:[function(require,module,exports) {
function r(r,e,n){var o=e[0],t=e[1],u=e[2],a=e[3];return r[0]=n[0]*o+n[4]*t+n[8]*u+n[12]*a,r[1]=n[1]*o+n[5]*t+n[9]*u+n[13]*a,r[2]=n[2]*o+n[6]*t+n[10]*u+n[14]*a,r[3]=n[3]*o+n[7]*t+n[11]*u+n[15]*a,r}module.exports=r;
},{}],768:[function(require,module,exports) {
function e(e,n,o,r,t){return e[0]=n,e[1]=o,e[2]=r,e[3]=t,e}module.exports=e;
},{}],543:[function(require,module,exports) {
var r=require("gl-vec4/transformMat4"),e=require("gl-vec4/set"),t=0,a=1,u=[0,0,0,0];function v(v,n,o,c){var i=o[0],l=o[1],s=o[2],f=o[3],g=t,m=a;e(u,n[0],n[1],n[2],1),r(u,u,c);var q=u[3];return 0!==q&&(u[0]=u[0]/q,u[1]=u[1]/q,u[2]=u[2]/q),v[0]=i+s/2*u[0]+(0+s/2),v[1]=l+f/2*u[1]+(0+f/2),v[2]=(m-g)/2*u[2]+(m+g)/2,v[3]=0===q?0:1/q,v}module.exports=v;
},{"gl-vec4/transformMat4":767,"gl-vec4/set":768}],140:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.addFrameTask=r,exports.nextFrameTask=o,exports.addPostRenderCallback=s,exports.addPreRenderCallback=a,exports.preRender=u,exports.postRender=c;const e=[],t=[],n=[];function r(t){e.push(t)}function o(){return e.length?e.shift():null}function s(e){t.push(e)}function a(e){n.push(e)}function u(){n.forEach(e=>e())}function c(){t.forEach(e=>e())}
},{}],239:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("svelte/internal"),e=require("three"),n=_(e),s=require("../tags"),i=_(s),l=require("svelte"),r=require("../util/ObjectPool"),a=m(r),o=require("camera-project"),h=m(o),c=require("../util/addFrameTasks"),u=require("../util/math"),d=_(u),p=require("eases"),f=m(p);function m(t){return t&&t.__esModule?t:{default:t}}function _(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function y(e){let n;return{c(){n=(0,t.element)("div"),(0,t.attr)(n,"class","container svelte-1bz0ho2")},m(s,i){(0,t.insert)(s,n,i),e[3](n)},p:t.noop,i:t.noop,o:t.noop,d(s){s&&(0,t.detach)(n),e[3](null)}}}function x(t,e){e.split("").forEach(e=>{const n=document.createElement("span");n.textContent=e,t.appendChild(n)})}function b(t){for(;t.lastElementChild;)t.removeChild(t.lastElementChild)}function S(e,s,l){let{world:r}=s,{state:o}=s;const u=[0,0,0,0],d=new n.Vector3(0,1,0),p=new n.Vector3,m=[0,0,0,0],_=[0,0,0];class y{constructor(){this.inner=document.createElement("div"),this.inner.className="text-sprite-3d",this.element=document.createElement("div"),this.element.appendChild(this.inner),this.element.className="text-sprite-3d-container",this.reset()}reset(){this._splitText=!1,this._visible=!1,this._text="",this._x=null,this._y=null,this._scale=null,this._opacity=null,this._fontSize=null,this._fontStyle=null,this.element.style.opacity="1",this.element.style.display="none",this.setTransform(0,0,1),this.setOpacity(1),this.setFont(16,"normal")}setFont(t,e){let n=this._fontSize,s=this._fontStyle;this._fontSize=t,this._fontStyle=e,s!==this._fontStyle&&(this.element.style.fontStyle=this._fontStyle),n!==this._fontSize&&(this.element.style.fontSize=`${this._fontSize}px`,this.element.style.top=`${-this._fontSize}px`)}appendTo(t){this.element&&t.appendChild(this.element)}detach(){this.element&&this.element.parentElement&&this.element.parentElement.removeChild(this.element)}dispose(){this.detach(),this.element=null,this.container=null}setOpacity(t){if((Math.abs(this._opacity-t)>=.01||t>=1||t<=0)&&(this._opacity=t,this.element&&(this.element.style.opacity=t),this.inner)){f.default.quadInOut(t)}}setVisible(t){this._visible!==t&&(this._visible=t,this.element&&(this.element.style.display=this._visible?"":"none"))}setTransform(t,e,n=1){(Math.abs(this._x-t)>=.001||Math.abs(this._y-e)>=.001||Math.abs(this._scale-n)>=.001)&&(this._x=t,this._y=e,this._scale=n,this.element&&(this.element.style.transform=`translate(${t}px, ${e}px)`),this.inner&&(this.inner.style.transform=`scale(${n}, ${n})`))}setText(t){this._text!==t&&(this._text=t,this.inner&&(this.inner.textContent=t))}}const x=new a.default({create:()=>new y,release(t){t.reset()}}),b=new n.Matrix4;let S,g=[],v=null,C=[];return(0,c.addPostRenderCallback)(()=>{if(!g)return;const t=r.findTag(i.MainCamera),e=r.findTag(i.AppState);u[2]=e.width,u[3]=e.height,b.copy(t.projectionMatrix).multiply(t.matrixWorldInverse),function(t,e){if(!t)return;if(C.length!==e.length){for(let n=0;n<e.length;n++)C[n]||(C[n]=x.next(),C[n].appendTo(t));if(C.length>e.length)for(let t=e.length;t<C.length;t++)if(C[t]){const e=C[t];e.detach(),x.release(e),C[t]=null}C.length=e.length}let n=!1;for(let t=0;t<C.length;t++){const s=C[t],l=e[t],r=l.get(i.TextSprite3D);let a=!1;if(r&&r.parent){a=!0,r.parent.getWorldPosition(p),p.toArray(_),(0,h.default)(m,_,u,b.elements);const t=m[0],e=u[3]-m[1],i=80,l=20,o=t>=-i&&e>=-l&&t<=u[2]+i&&e<=u[3]+l;if(o||!r.culling){const i=1;p.addScaledVector(d,i),p.toArray(_),(0,h.default)(m,_,u,b.elements);const l=u[3]-m[1],r=u[3]/534,a=23.31024;let o=Math.abs(l-e)/r/a;o=u[3]/500,s.setTransform(t,e,o),n=!0}else a=!1;a&&(s.setText(r.text),s.setOpacity(r.opacity),s.setFont(r.fontSize,r.fontStyle))}s.setVisible(a)}const s=v;v=n,s!==n&&(t.style.display=n?"":"none")}(S,g)}),o.subscribe(t=>{g=t}),e.$$set=(t=>{"world"in t&&l(1,r=t.world),"state"in t&&l(2,o=t.state)}),[S,r,o,function(e){t.binding_callbacks[e?"unshift":"push"](()=>{l(0,S=e)})}]}class g extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,S,y,t.safe_not_equal,{world:1,state:2})}}exports.default=g;
},{"svelte/internal":226,"three":74,"../tags":60,"svelte":220,"../util/ObjectPool":236,"camera-project":543,"../util/addFrameTasks":140,"../util/math":240,"eases":291}],84:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=O;var e=require("../assets/font/SilkaMono/silkamono-regularitalic-webfont.woff2"),t=x(e),i=require("../tags"),n=T(i),o=require("three"),r=T(o),s=require("../util/createPlaneSprite"),a=x(s),l=require("../util/three-util"),u=require("../overlays/Text3DOverlay.svelte"),c=x(u),p=require("svelte/store"),d=require("../util/ObjectPool"),y=x(d),f=require("./AnimationSystem");function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function x(e){return e&&e.__esModule?e:{default:e}}function O(e){e.system.info({hidden:!0});e.listen(n.TextSprite3D);const t=e.view(n.TextSprite3D),i=e.listen(n.TextHint),o=e.listen([n.KillTextHint,n.TextHint,n.Object3D]),s=e.view(n.TextHint),a=(0,p.writable)(t);e.entity().add(n.ViewLayer,{id:"text-3d-overlay",component:c.default,props:{world:e,state:a}});const u=new y.default({create:()=>new r.Group});return function(t){i.added.forEach(t=>{const i=u.next();t.add(n.Object3D,i);const o=t.get(n.TextHint),r=o.position.y-.5,s=o.position.y,a=o.position.z,l=o.position.z-1;i.position.copy(o.position),i.position.y=r,i.position.z=l,t.add(n.TextSprite3D);const c=t.get(n.TextSprite3D);c.text=o.text,c.depth=!1,c.fontStyle="italic",c.fontSize=14,c.parent=i,c.opacity=0,c.culling=!1;const p=o.delay;(0,f.tweenTo)(e,i.position,"y",s,1.5,"sineOut",p),(0,f.tweenTo)(e,i.position,"z",a,1.5,"sineOut",p),(0,f.tweenTo)(e,c,"opacity",1,2,"linear",p)}),o.added.forEach(t=>{const i=t.get(n.TextHint),o=t.get(n.TextSprite3D),r=i.position.y-.5,s=(i.position.y,t.get(n.Object3D));(0,f.tweenTo)(e,s.position,"y",r,1,"sineOut",0),(0,f.setEntityTweenFromTo)(t,o,"opacity",1,0,1,"quadOut",0);const a=t.get(n.TargetKeyTween);a.killEntityOnFinish=!0,a.assignFromOnStart=!0}),s.forEach(e=>{const i=e.get(n.TextHint);i.killing&&!e.has(n.KillTextHint)&&(i.time+=t,i.time-i.delay>=i.duration&&e.add(n.KillTextHint))}),i.removing.forEach(e=>{const t=e.get(n.Object3D);(0,l.detachObject)(t),e.remove(n.Object3D),u.release(t)})}}
},{"../assets/font/SilkaMono/silkamono-regularitalic-webfont.woff2":266,"../tags":60,"three":74,"../util/createPlaneSprite":238,"../util/three-util":80,"../overlays/Text3DOverlay.svelte":239,"svelte/store":310,"../util/ObjectPool":236,"./AnimationSystem":108}],509:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_resume.3e9ae76d.png";
},{}],474:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_restart.bf1400f6.png";
},{}],470:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_about.a83e1be3.png";
},{}],469:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_about_long.9416ab6d.png";
},{}],477:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_start.1afc765b.png";
},{}],689:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};exports.transition=o,exports.emptyTransition=i,exports.fadeOpacityTransition=s,exports.fadeInTransition=u,exports.fadeTransition=l,exports.fadeOutTransition=p;var t=require("eases"),r=a(t),n=require("../util/math");function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(t,r={}){return(n,a={})=>t(n,e({},a,r))}function i(e,t={}){return{delay:0,duration:0,css:e=>""}}function s(e,{index:t=0,opacity:a=0,stagger:o=200,delay:i=0,duration:s=350,reverse:u=!1}={}){const l=+getComputedStyle(e).opacity;return{delay:i+=o*t,duration:s,tick(t){let o=r.sineIn(t);u&&(o=1-o),e.style.opacity=(0,n.lerp)(a,l,o)}}}function u(e,{x:t=0,y:a=-10,endX:o=0,endY:i=0,endAngle:s=0,angle:u=0,opacity:l=0,index:p=0,stagger:c=200,delay:d=0,duration:y=1e3,reverse:f=!1}={}){const g=+getComputedStyle(e).opacity;return{delay:d+=c*p,duration:y,tick(p){let c=r.quartOut(p),d=r.sineIn(p);f&&(c=1-c,d=1-d);const y=(0,n.lerp)(t,o,c),x=(0,n.lerp)(a,i,c),v=(0,n.lerpAngle)(u,s,d);e.style.transformOrigin="50% 50%",e.style.transform=`translate(${y}px, ${x}px) rotateZ(${v}rad)`,e.style.opacity=(0,n.lerp)(l,g,d)}}}function l(e,t={}){return u(e,t)}function p(e,t={}){return u(e,t)}
},{"eases":291,"../util/math":240}],739:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),t=require("../assets/image/ui/btn_restart.png"),n=d(t),a=require("../assets/image/ui/btn_about.png"),l=d(a),r=require("../assets/image/ui/btn_about_long.png"),s=d(r),i=require("../assets/image/ui/btn_start.png"),o=d(i),u=require("svelte"),c=require("../animations/transitions");function d(e){return e&&e.__esModule?e:{default:e}}function m(t){let n,a;return{c(){n=(0,e.element)("img"),(0,e.attr)(n,"class","icon svelte-1j4vnox"),n.src!==(a=t[0])&&(0,e.attr)(n,"src",a),(0,e.attr)(n,"alt","")},m(t,a){(0,e.insert)(t,n,a)},p(t,l){1&l&&n.src!==(a=t[0])&&(0,e.attr)(n,"src",a)},d(t){t&&(0,e.detach)(n)}}}function f(t){let n,a;return{c(){n=(0,e.element)("div"),a=(0,e.text)(t[2]),(0,e.attr)(n,"class","text svelte-1j4vnox")},m(t,l){(0,e.insert)(t,n,l),(0,e.append)(n,a)},p(t,n){4&n&&(0,e.set_data)(a,t[2])},d(t){t&&(0,e.detach)(n)}}}function g(t){let n,a,l,r,s,i,o,u,c,d,g,p,v,_=t[0]&&m(t),b=t[2]&&f(t);return{c(){n=(0,e.element)("div"),a=(0,e.element)("div"),l=(0,e.element)("img"),i=(0,e.space)(),o=(0,e.element)("div"),_&&_.c(),u=(0,e.space)(),b&&b.c(),l.src!==(r=t[7])&&(0,e.attr)(l,"src",r),(0,e.attr)(l,"alt",s=t[3]||t[2]),(0,e.attr)(l,"class","svelte-1j4vnox"),(0,e.attr)(a,"class","image-container svelte-1j4vnox"),(0,e.attr)(o,"class","content-container svelte-1j4vnox"),(0,e.toggle_class)(o,"offset",t[8]),(0,e.attr)(n,"class","container svelte-1j4vnox"),(0,e.toggle_class)(n,"invert","dark"===t[1]||"dark_long"===t[1]),(0,e.toggle_class)(n,"smaller",t[9]),(0,e.toggle_class)(n,"longer",t[10])},m(r,s){(0,e.insert)(r,n,s),(0,e.append)(n,a),(0,e.append)(a,l),(0,e.append)(n,i),(0,e.append)(n,o),_&&_.m(o,null),(0,e.append)(o,u),b&&b.m(o,null),g=!0,p||(v=[(0,e.listen)(n,"introend",t[12]),(0,e.listen)(n,"introstart",t[13]),(0,e.listen)(n,"outroend",t[14]),(0,e.listen)(n,"outrostart",t[15]),(0,e.listen)(n,"click",t[16]),(0,e.listen)(n,"mouseenter",t[17]),(0,e.listen)(n,"mouseleave",t[18])],p=!0)},p(t,[a]){(!g||128&a&&l.src!==(r=t[7]))&&(0,e.attr)(l,"src",r),(!g||12&a&&s!==(s=t[3]||t[2]))&&(0,e.attr)(l,"alt",s),t[0]?_?_.p(t,a):((_=m(t)).c(),_.m(o,u)):_&&(_.d(1),_=null),t[2]?b?b.p(t,a):((b=f(t)).c(),b.m(o,null)):b&&(b.d(1),b=null),256&a&&(0,e.toggle_class)(o,"offset",t[8]),2&a&&(0,e.toggle_class)(n,"invert","dark"===t[1]||"dark_long"===t[1]),512&a&&(0,e.toggle_class)(n,"smaller",t[9]),1024&a&&(0,e.toggle_class)(n,"longer",t[10])},i(a){g||((0,e.add_render_callback)(()=>{d&&d.end(1),c||(c=(0,e.create_in_transition)(n,t[4],{})),c.start()}),g=!0)},o(a){c&&c.invalidate(),d=(0,e.create_out_transition)(n,t[5],{}),g=!1},d(t){t&&(0,e.detach)(n),_&&_.d(),b&&b.d(),t&&d&&d.end(),p=!1,(0,e.run_all)(v)}}}function p(t,a,r){(0,u.createEventDispatcher)();const i={normal:{idle:o.default,hover:o.default,offset:!0},normal_small:{idle:o.default,hover:o.default,offset:!0,smaller:!0},alert:{idle:n.default,hover:n.default,offset:!0},dark:{idle:l.default,hover:l.default,smaller:!0},dark_long:{idle:s.default,hover:s.default,smaller:!0,longer:!0}};let d,m,{icon:f=""}=a,{mode:g="normal"}=a,{text:p=""}=a,{alt:v=""}=a,{inTransition:_=c.emptyTransition}=a,{outTransition:b=c.emptyTransition}=a,x=!1,h=!1,T=!1,k=!1;return t.$$set=(e=>{"icon"in e&&r(0,f=e.icon),"mode"in e&&r(1,g=e.mode),"text"in e&&r(2,p=e.text),"alt"in e&&r(3,v=e.alt),"inTransition"in e&&r(4,_=e.inTransition),"outTransition"in e&&r(5,b=e.outTransition)}),t.$$.update=(()=>{2114&t.$$.dirty&&(r(11,d=i[g]),r(8,x=Boolean(d.offset)),r(9,T=Boolean(d.smaller)),r(10,k=Boolean(d.longer)),r(7,m=h?d.hover:d.idle))}),[f,g,p,v,_,b,h,m,x,T,k,d,function(n){(0,e.bubble)(t,n)},function(n){(0,e.bubble)(t,n)},function(n){(0,e.bubble)(t,n)},function(n){(0,e.bubble)(t,n)},function(n){(0,e.bubble)(t,n)},()=>{r(6,h=!0)},()=>{r(6,h=!1)}]}class v extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,p,g,e.safe_not_equal,{icon:0,mode:1,text:2,alt:3,inTransition:4,outTransition:5})}}exports.default=v;
},{"svelte/internal":226,"../assets/image/ui/btn_restart.png":474,"../assets/image/ui/btn_about.png":470,"../assets/image/ui/btn_about_long.png":469,"../assets/image/ui/btn_start.png":477,"svelte":220,"../animations/transitions":689}],348:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bluenoise-0.68d22abb.png";
},{}],349:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bluenoise-1.40a84f4d.png";
},{}],350:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bluenoise-2.56632c21.png";
},{}],351:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bluenoise-3.84e10f18.png";
},{}],352:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/cape-texture-landscape-1024.20c53201.png";
},{}],353:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass-arrow.b144cfb9.png";
},{}],354:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass-arrow2.e1908048.png";
},{}],355:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass-arrow3.f58f0e80.png";
},{}],356:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass-dot.19a1de30.png";
},{}],357:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass-ring.1e0a4a89.png";
},{}],358:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/floating-paper-lines.54df6340.png";
},{}],359:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/floating-paper.aa3eb19b.png";
},{}],360:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass-1.2bd225f2.png";
},{}],361:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass-temp.8c79f2ad.png";
},{}],362:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass-temp2.9df1644b.png";
},{}],363:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass-thin.b6d26c40.png";
},{}],364:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ground-spawn-forest.8ff14534.png";
},{}],365:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ground-spawn-grasslands.3e83bde3.png";
},{}],366:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ground-spawn-tundra.df0ef0cf.png";
},{}],367:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/hard-circle.6e7799b1.png";
},{}],368:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_about.a9236dae.png";
},{}],369:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/lightray.2c98da5e.png";
},{}],370:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/lut-forest.d9fbb6fe.png";
},{}],371:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/lut-grasslands.9db967f5.png";
},{}],372:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/lut-raw-no-post.dc327c83.png";
},{}],373:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/lut-tundra.bbe4691a.png";
},{}],374:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/lut-tundra5.73ac32cb.png";
},{}],375:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/lut-tundra6.9ee0942e.png";
},{}],376:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/soft-circle.f9c55ed0.png";
},{}],377:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/water-distort.c8abbf5f.png";
},{}],378:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/water-noise.c9e746ad.png";
},{}],379:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/floor-overlay.8c7be3ed.jpg";
},{}],380:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/floor-path.27f6b734.jpg";
},{}],381:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/floor-tundra.e68cee3d.jpg";
},{}],382:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/floor.61f2b391.jpg";
},{}],383:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ice.e547c752.jpg";
},{}],384:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/back.019c07a0.svg";
},{}],385:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/circle-24px.7d555d36.svg";
},{}],386:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/code-24px.661237d7.svg";
},{}],387:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass.8b004a6e.svg";
},{}],388:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/create-24px.11245f0b.svg";
},{}],389:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/down-arrow.4293f51a.svg";
},{}],390:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/exit.00d37ba3.svg";
},{}],391:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/eye-24px.6c5801de.svg";
},{}],392:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/eye-off-24px.f324ab0a.svg";
},{}],393:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_NFBONF.882390f9.svg";
},{}],394:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-audio.63b3e45a.svg";
},{}],395:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-biome-forest.92a73237.svg";
},{}],396:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-biome-grasslands.2002b63c.svg";
},{}],397:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-biome-group.4b80f4dc.svg";
},{}],398:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-biome-tundra.61fe6439.svg";
},{}],399:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-compass.5402388d.svg";
},{}],400:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-leaf-menu.087d7764.svg";
},{}],401:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-leaf.f3dab048.svg";
},{}],402:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-touch.91098701.svg";
},{}],403:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/journal.a84f934d.svg";
},{}],404:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/keyboard_arrow_down-24px.8855bcc4.svg";
},{}],405:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/keyboard_arrow_right-24px.15801871.svg";
},{}],406:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/loupe-24px.29a8becc.svg";
},{}],407:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-trail.bffc5bb5.svg";
},{}],408:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/MAP.ebf3b398.svg";
},{}],409:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/menu.ba1c662c.svg";
},{}],410:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nfblogo.7a5e7b1a.svg";
},{}],411:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/rotate-smartphone.b629a3bd.svg";
},{}],412:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/sound.15dd9d0e.svg";
},{}],413:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/title.65cd1aaf.svg";
},{}],414:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/animal.353213b2.png";
},{}],415:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/feather.3a34b95a.png";
},{}],416:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fish.190320a4.png";
},{}],417:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/flower.69d44968.png";
},{}],418:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass.72fd360b.png";
},{}],419:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/insect.2a888c70.png";
},{}],420:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaf.c72ae6c8.png";
},{}],421:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/mist.fca12b00.png";
},{}],422:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/moon.2dbebe6e.png";
},{}],423:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/rain.817e95b5.png";
},{}],424:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/snow.ce929208.png";
},{}],425:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/stars.f83d0c33.png";
},{}],426:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/storm.0d588293.png";
},{}],427:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/sun.090fca3d.png";
},{}],428:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree.84dceeba.png";
},{}],429:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/wind.4c3f93f7.png";
},{}],430:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_animal.70653ce4.png";
},{}],431:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_feather.2d057747.png";
},{}],432:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_fish.eb982646.png";
},{}],433:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_flower.9175a77e.png";
},{}],434:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_grass.062f32ba.png";
},{}],435:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_insect..a0999c0d.png";
},{}],436:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_leaf.f3550ff2.png";
},{}],437:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_mist.b9cd2e74.png";
},{}],438:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_moon.166283f2.png";
},{}],439:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_rain.31cb6ecc.png";
},{}],440:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_snow.a5fd79c4.png";
},{}],441:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_stars.46ef9091.png";
},{}],442:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_storm.d043e557.png";
},{}],443:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_sun.0c21a206.png";
},{}],444:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_tree.a13b9e4a.png";
},{}],445:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_wind.9f7496b0.png";
},{}],446:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_animal.42624ebf.png";
},{}],447:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_feather.a6894aa9.png";
},{}],448:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_fish.339025ad.png";
},{}],449:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_flower.f57b39ed.png";
},{}],450:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_grass.364530ce.png";
},{}],451:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_insect.1b35be18.png";
},{}],452:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_leaf.e7b3a2f3.png";
},{}],453:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_mist.4ad47359.png";
},{}],454:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_moon.f4fe2320.png";
},{}],455:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_rain..dbf04349.png";
},{}],456:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_snow.30b7d981.png";
},{}],457:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_stars.be143fa2.png";
},{}],458:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_storm.aa84b173.png";
},{}],459:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_sun.44377c87.png";
},{}],460:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_tree.34309e21.png";
},{}],461:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_wind.d44cd5be.png";
},{}],462:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/biomeforest-alt.fdec30d5.png";
},{}],463:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/biomeforest.88742a9f.png";
},{}],464:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/biomegrass-alt.673a4029.png";
},{}],465:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/biomegrass.e92c955a.png";
},{}],466:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/biometundra-alt.83ed9ee4.png";
},{}],467:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/biometundra.fabdab97.png";
},{}],468:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bird.f0e595d2.png";
},{}],471:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_pause.6a36eada.png";
},{}],472:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_restart_shadow.cd2060fa.png";
},{}],473:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_restart_top.ee985cfd.png";
},{}],475:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_start_shadow.21c003fc.png";
},{}],476:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_start_top.79ad0d2f.png";
},{}],478:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/close-button.2d00ccaf.png";
},{}],479:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass1.4bf64a0c.png";
},{}],480:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass2.419a0c77.png";
},{}],481:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass3.135c3bc0.png";
},{}],482:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass4.a98a3247.png";
},{}],483:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/empty_box.7ea3b116.png";
},{}],484:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/filled_box.7b9593a9.png";
},{}],485:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/finger-inv.eb49c398.png";
},{}],486:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/finger.8c630950.png";
},{}],487:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/hint-card-left.da7a39c5.png";
},{}],488:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/hint-card-middle.c8b92721.png";
},{}],489:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/hint-card-right.b31ac6b5.png";
},{}],490:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_about_orange.daa61353.png";
},{}],491:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_closeJournal.d6cfd71a.png";
},{}],492:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_completedHaiku.d3180247.png";
},{}],493:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_emptyHaiku.a1943571.png";
},{}],494:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_emptytoken.6ca39dc3.png";
},{}],495:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_expand.e4bf29b2.png";
},{}],496:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_haiku_leaf.e0aeb5c5.png";
},{}],497:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_haiku.2ae39da7.png";
},{}],498:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_journal.9a6262af.png";
},{}],499:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_languageSelect.ed40d288.png";
},{}],500:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_NFBONF.3595c642.png";
},{}],501:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_openjournal.d9a989cb.png";
},{}],502:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_paperJournal1-rotated.31f446f9.png";
},{}],503:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_paperJournal1.fb4c9f4f.png";
},{}],504:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_paperJournal2-rotated.442fc82f.png";
},{}],505:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_paperJournal2.27694e4e.png";
},{}],506:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_popupHaiku-straight.9b57f1ec.png";
},{}],507:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_popupHaiku.8d398a3a.png";
},{}],508:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_restart.d900493b.png";
},{}],510:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_scrollbar.fbf67d23.png";
},{}],511:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_toggle.00b5e1d7.png";
},{}],512:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_volume_bar.377da646.png";
},{}],513:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_volume_gauge.004fd8fb.png";
},{}],514:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_volume_toggle.ce956966.png";
},{}],515:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_volume.1a38391b.png";
},{}],516:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_XcloseJournal.e1913c0f.png";
},{}],517:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/title2_en_leaf.d45b203b.png";
},{}],518:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/title2_en.b9913b18.png";
},{}],519:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/title2_fr_leaf.e6f9a345.png";
},{}],520:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/title2_fr.8861e962.png";
},{}],521:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/touch-inv.fc21abe0.png";
},{}],522:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/touch.40ac11b4.png";
},{}],523:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-inv.81f3822e.png";
},{}],524:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree.6f2c634b.png";
},{}],525:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/vertical-rule.100c7083.png";
},{}],526:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/wayfinder_placeholder.f0b0a2cc.png";
},{}],107:[function(require,module,exports) {
module.exports={data:{"bluenoise-0":{png:require("./../data/bluenoise-0.png")},"bluenoise-1":{png:require("./../data/bluenoise-1.png")},"bluenoise-2":{png:require("./../data/bluenoise-2.png")},"bluenoise-3":{png:require("./../data/bluenoise-3.png")},"cape-texture-landscape-1024":{png:require("./../data/cape-texture-landscape-1024.png")},"compass-arrow":{png:require("./../data/compass-arrow.png")},"compass-arrow2":{png:require("./../data/compass-arrow2.png")},"compass-arrow3":{png:require("./../data/compass-arrow3.png")},"compass-dot":{png:require("./../data/compass-dot.png")},"compass-ring":{png:require("./../data/compass-ring.png")},"floating-paper-lines":{png:require("./../data/floating-paper-lines.png")},"floating-paper":{png:require("./../data/floating-paper.png")},"grass-1":{png:require("./../data/grass-1.png")},"grass-temp":{png:require("./../data/grass-temp.png")},"grass-temp2":{png:require("./../data/grass-temp2.png")},"grass-thin":{png:require("./../data/grass-thin.png")},"ground-spawn-forest":{png:require("./../data/ground-spawn-forest.png")},"ground-spawn-grasslands":{png:require("./../data/ground-spawn-grasslands.png")},"ground-spawn-tundra":{png:require("./../data/ground-spawn-tundra.png")},"hard-circle":{png:require("./../data/hard-circle.png")},ico_about:{png:require("./../data/ico_about.png")},lightray:{png:require("./../data/lightray.png")},"lut-forest":{png:require("./../data/lut-forest.png")},"lut-grasslands":{png:require("./../data/lut-grasslands.png")},"lut-raw-no-post":{png:require("./../data/lut-raw-no-post.png")},"lut-tundra":{png:require("./../data/lut-tundra.png")},"lut-tundra5":{png:require("./../data/lut-tundra5.png")},"lut-tundra6":{png:require("./../data/lut-tundra6.png")},"soft-circle":{png:require("./../data/soft-circle.png")},"water-distort":{png:require("./../data/water-distort.png")},"water-noise":{png:require("./../data/water-noise.png")}},opaque:{"floor-overlay":{jpg:require("./../opaque/floor-overlay.jpg")},"floor-path":{jpg:require("./../opaque/floor-path.jpg")},"floor-tundra":{jpg:require("./../opaque/floor-tundra.jpg")},floor:{jpg:require("./../opaque/floor.jpg")},ice:{jpg:require("./../opaque/ice.jpg")}},svg:{back:{svg:require("./../svg/back.svg")},"circle-24px":{svg:require("./../svg/circle-24px.svg")},"code-24px":{svg:require("./../svg/code-24px.svg")},compass:{svg:require("./../svg/compass.svg")},"create-24px":{svg:require("./../svg/create-24px.svg")},"down-arrow":{svg:require("./../svg/down-arrow.svg")},exit:{svg:require("./../svg/exit.svg")},"eye-24px":{svg:require("./../svg/eye-24px.svg")},"eye-off-24px":{svg:require("./../svg/eye-off-24px.svg")},ico_NFBONF:{svg:require("./../svg/ico_NFBONF.svg")},"icon-audio":{svg:require("./../svg/icon-audio.svg")},"icon-biome-forest":{svg:require("./../svg/icon-biome-forest.svg")},"icon-biome-grasslands":{svg:require("./../svg/icon-biome-grasslands.svg")},"icon-biome-group":{svg:require("./../svg/icon-biome-group.svg")},"icon-biome-tundra":{svg:require("./../svg/icon-biome-tundra.svg")},"icon-compass":{svg:require("./../svg/icon-compass.svg")},"icon-leaf-menu":{svg:require("./../svg/icon-leaf-menu.svg")},"icon-leaf":{svg:require("./../svg/icon-leaf.svg")},"icon-touch":{svg:require("./../svg/icon-touch.svg")},journal:{svg:require("./../svg/journal.svg")},"keyboard_arrow_down-24px":{svg:require("./../svg/keyboard_arrow_down-24px.svg")},"keyboard_arrow_right-24px":{svg:require("./../svg/keyboard_arrow_right-24px.svg")},"loupe-24px":{svg:require("./../svg/loupe-24px.svg")},"map-trail":{svg:require("./../svg/map-trail.svg")},MAP:{svg:require("./../svg/MAP.svg")},menu:{svg:require("./../svg/menu.svg")},nfblogo:{svg:require("./../svg/nfblogo.svg")},"rotate-smartphone":{svg:require("./../svg/rotate-smartphone.svg")},sound:{svg:require("./../svg/sound.svg")},title:{svg:require("./../svg/title.svg")}},"tokens-collected":{animal:{png:require("./../tokens-collected/animal.png")},feather:{png:require("./../tokens-collected/feather.png")},fish:{png:require("./../tokens-collected/fish.png")},flower:{png:require("./../tokens-collected/flower.png")},grass:{png:require("./../tokens-collected/grass.png")},insect:{png:require("./../tokens-collected/insect.png")},leaf:{png:require("./../tokens-collected/leaf.png")},mist:{png:require("./../tokens-collected/mist.png")},moon:{png:require("./../tokens-collected/moon.png")},rain:{png:require("./../tokens-collected/rain.png")},snow:{png:require("./../tokens-collected/snow.png")},stars:{png:require("./../tokens-collected/stars.png")},storm:{png:require("./../tokens-collected/storm.png")},sun:{png:require("./../tokens-collected/sun.png")},tree:{png:require("./../tokens-collected/tree.png")},wind:{png:require("./../tokens-collected/wind.png")}},"tokens-inverted":{ico_animal:{png:require("./../tokens-inverted/ico_animal.png")},ico_feather:{png:require("./../tokens-inverted/ico_feather.png")},ico_fish:{png:require("./../tokens-inverted/ico_fish.png")},ico_flower:{png:require("./../tokens-inverted/ico_flower.png")},ico_grass:{png:require("./../tokens-inverted/ico_grass.png")},"ico_insect.":{png:require("./../tokens-inverted/ico_insect..png")},ico_leaf:{png:require("./../tokens-inverted/ico_leaf.png")},ico_mist:{png:require("./../tokens-inverted/ico_mist.png")},ico_moon:{png:require("./../tokens-inverted/ico_moon.png")},ico_rain:{png:require("./../tokens-inverted/ico_rain.png")},ico_snow:{png:require("./../tokens-inverted/ico_snow.png")},ico_stars:{png:require("./../tokens-inverted/ico_stars.png")},ico_storm:{png:require("./../tokens-inverted/ico_storm.png")},ico_sun:{png:require("./../tokens-inverted/ico_sun.png")},ico_tree:{png:require("./../tokens-inverted/ico_tree.png")},ico_wind:{png:require("./../tokens-inverted/ico_wind.png")}},tokens:{ico_animal:{png:require("./../tokens/ico_animal.png")},ico_feather:{png:require("./../tokens/ico_feather.png")},ico_fish:{png:require("./../tokens/ico_fish.png")},ico_flower:{png:require("./../tokens/ico_flower.png")},ico_grass:{png:require("./../tokens/ico_grass.png")},ico_insect:{png:require("./../tokens/ico_insect.png")},ico_leaf:{png:require("./../tokens/ico_leaf.png")},ico_mist:{png:require("./../tokens/ico_mist.png")},ico_moon:{png:require("./../tokens/ico_moon.png")},"ico_rain.":{png:require("./../tokens/ico_rain..png")},ico_snow:{png:require("./../tokens/ico_snow.png")},ico_stars:{png:require("./../tokens/ico_stars.png")},ico_storm:{png:require("./../tokens/ico_storm.png")},ico_sun:{png:require("./../tokens/ico_sun.png")},ico_tree:{png:require("./../tokens/ico_tree.png")},ico_wind:{png:require("./../tokens/ico_wind.png")}},ui:{"biomeforest-alt":{png:require("./../ui/biomeforest-alt.png")},biomeforest:{png:require("./../ui/biomeforest.png")},"biomegrass-alt":{png:require("./../ui/biomegrass-alt.png")},biomegrass:{png:require("./../ui/biomegrass.png")},"biometundra-alt":{png:require("./../ui/biometundra-alt.png")},biometundra:{png:require("./../ui/biometundra.png")},bird:{png:require("./../ui/bird.png")},btn_about_long:{png:require("./../ui/btn_about_long.png")},btn_about:{png:require("./../ui/btn_about.png")},btn_pause:{png:require("./../ui/btn_pause.png")},btn_restart_shadow:{png:require("./../ui/btn_restart_shadow.png")},btn_restart_top:{png:require("./../ui/btn_restart_top.png")},btn_restart:{png:require("./../ui/btn_restart.png")},btn_start_shadow:{png:require("./../ui/btn_start_shadow.png")},btn_start_top:{png:require("./../ui/btn_start_top.png")},btn_start:{png:require("./../ui/btn_start.png")},"close-button":{png:require("./../ui/close-button.png")},compass1:{png:require("./../ui/compass1.png")},compass2:{png:require("./../ui/compass2.png")},compass3:{png:require("./../ui/compass3.png")},compass4:{png:require("./../ui/compass4.png")},empty_box:{png:require("./../ui/empty_box.png")},filled_box:{png:require("./../ui/filled_box.png")},"finger-inv":{png:require("./../ui/finger-inv.png")},finger:{png:require("./../ui/finger.png")},"hint-card-left":{png:require("./../ui/hint-card-left.png")},"hint-card-middle":{png:require("./../ui/hint-card-middle.png")},"hint-card-right":{png:require("./../ui/hint-card-right.png")},ico_about_orange:{png:require("./../ui/ico_about_orange.png")},ico_about:{png:require("./../ui/ico_about.png")},ico_closeJournal:{png:require("./../ui/ico_closeJournal.png")},ico_completedHaiku:{png:require("./../ui/ico_completedHaiku.png")},ico_emptyHaiku:{png:require("./../ui/ico_emptyHaiku.png")},ico_emptytoken:{png:require("./../ui/ico_emptytoken.png")},ico_expand:{png:require("./../ui/ico_expand.png")},ico_haiku_leaf:{png:require("./../ui/ico_haiku_leaf.png")},ico_haiku:{png:require("./../ui/ico_haiku.png")},ico_journal:{png:require("./../ui/ico_journal.png")},ico_languageSelect:{png:require("./../ui/ico_languageSelect.png")},ico_NFBONF:{png:require("./../ui/ico_NFBONF.png")},ico_openjournal:{png:require("./../ui/ico_openjournal.png")},"ico_paperJournal1-rotated":{png:require("./../ui/ico_paperJournal1-rotated.png")},ico_paperJournal1:{png:require("./../ui/ico_paperJournal1.png")},"ico_paperJournal2-rotated":{png:require("./../ui/ico_paperJournal2-rotated.png")},ico_paperJournal2:{png:require("./../ui/ico_paperJournal2.png")},"ico_popupHaiku-straight":{png:require("./../ui/ico_popupHaiku-straight.png")},ico_popupHaiku:{png:require("./../ui/ico_popupHaiku.png")},ico_restart:{png:require("./../ui/ico_restart.png")},ico_resume:{png:require("./../ui/ico_resume.png")},ico_scrollbar:{png:require("./../ui/ico_scrollbar.png")},ico_toggle:{png:require("./../ui/ico_toggle.png")},ico_volume_bar:{png:require("./../ui/ico_volume_bar.png")},ico_volume_gauge:{png:require("./../ui/ico_volume_gauge.png")},ico_volume_toggle:{png:require("./../ui/ico_volume_toggle.png")},ico_volume:{png:require("./../ui/ico_volume.png")},ico_XcloseJournal:{png:require("./../ui/ico_XcloseJournal.png")},title2_en_leaf:{png:require("./../ui/title2_en_leaf.png")},title2_en:{png:require("./../ui/title2_en.png")},title2_fr_leaf:{png:require("./../ui/title2_fr_leaf.png")},title2_fr:{png:require("./../ui/title2_fr.png")},"touch-inv":{png:require("./../ui/touch-inv.png")},touch:{png:require("./../ui/touch.png")},"tree-inv":{png:require("./../ui/tree-inv.png")},tree:{png:require("./../ui/tree.png")},"vertical-rule":{png:require("./../ui/vertical-rule.png")},wayfinder_placeholder:{png:require("./../ui/wayfinder_placeholder.png")}}};
},{"./../data/bluenoise-0.png":348,"./../data/bluenoise-1.png":349,"./../data/bluenoise-2.png":350,"./../data/bluenoise-3.png":351,"./../data/cape-texture-landscape-1024.png":352,"./../data/compass-arrow.png":353,"./../data/compass-arrow2.png":354,"./../data/compass-arrow3.png":355,"./../data/compass-dot.png":356,"./../data/compass-ring.png":357,"./../data/floating-paper-lines.png":358,"./../data/floating-paper.png":359,"./../data/grass-1.png":360,"./../data/grass-temp.png":361,"./../data/grass-temp2.png":362,"./../data/grass-thin.png":363,"./../data/ground-spawn-forest.png":364,"./../data/ground-spawn-grasslands.png":365,"./../data/ground-spawn-tundra.png":366,"./../data/hard-circle.png":367,"./../data/ico_about.png":368,"./../data/lightray.png":369,"./../data/lut-forest.png":370,"./../data/lut-grasslands.png":371,"./../data/lut-raw-no-post.png":372,"./../data/lut-tundra.png":373,"./../data/lut-tundra5.png":374,"./../data/lut-tundra6.png":375,"./../data/soft-circle.png":376,"./../data/water-distort.png":377,"./../data/water-noise.png":378,"./../opaque/floor-overlay.jpg":379,"./../opaque/floor-path.jpg":380,"./../opaque/floor-tundra.jpg":381,"./../opaque/floor.jpg":382,"./../opaque/ice.jpg":383,"./../svg/back.svg":384,"./../svg/circle-24px.svg":385,"./../svg/code-24px.svg":386,"./../svg/compass.svg":387,"./../svg/create-24px.svg":388,"./../svg/down-arrow.svg":389,"./../svg/exit.svg":390,"./../svg/eye-24px.svg":391,"./../svg/eye-off-24px.svg":392,"./../svg/ico_NFBONF.svg":393,"./../svg/icon-audio.svg":394,"./../svg/icon-biome-forest.svg":395,"./../svg/icon-biome-grasslands.svg":396,"./../svg/icon-biome-group.svg":397,"./../svg/icon-biome-tundra.svg":398,"./../svg/icon-compass.svg":399,"./../svg/icon-leaf-menu.svg":400,"./../svg/icon-leaf.svg":401,"./../svg/icon-touch.svg":402,"./../svg/journal.svg":403,"./../svg/keyboard_arrow_down-24px.svg":404,"./../svg/keyboard_arrow_right-24px.svg":405,"./../svg/loupe-24px.svg":406,"./../svg/map-trail.svg":407,"./../svg/MAP.svg":408,"./../svg/menu.svg":409,"./../svg/nfblogo.svg":410,"./../svg/rotate-smartphone.svg":411,"./../svg/sound.svg":412,"./../svg/title.svg":413,"./../tokens-collected/animal.png":414,"./../tokens-collected/feather.png":415,"./../tokens-collected/fish.png":416,"./../tokens-collected/flower.png":417,"./../tokens-collected/grass.png":418,"./../tokens-collected/insect.png":419,"./../tokens-collected/leaf.png":420,"./../tokens-collected/mist.png":421,"./../tokens-collected/moon.png":422,"./../tokens-collected/rain.png":423,"./../tokens-collected/snow.png":424,"./../tokens-collected/stars.png":425,"./../tokens-collected/storm.png":426,"./../tokens-collected/sun.png":427,"./../tokens-collected/tree.png":428,"./../tokens-collected/wind.png":429,"./../tokens-inverted/ico_animal.png":430,"./../tokens-inverted/ico_feather.png":431,"./../tokens-inverted/ico_fish.png":432,"./../tokens-inverted/ico_flower.png":433,"./../tokens-inverted/ico_grass.png":434,"./../tokens-inverted/ico_insect..png":435,"./../tokens-inverted/ico_leaf.png":436,"./../tokens-inverted/ico_mist.png":437,"./../tokens-inverted/ico_moon.png":438,"./../tokens-inverted/ico_rain.png":439,"./../tokens-inverted/ico_snow.png":440,"./../tokens-inverted/ico_stars.png":441,"./../tokens-inverted/ico_storm.png":442,"./../tokens-inverted/ico_sun.png":443,"./../tokens-inverted/ico_tree.png":444,"./../tokens-inverted/ico_wind.png":445,"./../tokens/ico_animal.png":446,"./../tokens/ico_feather.png":447,"./../tokens/ico_fish.png":448,"./../tokens/ico_flower.png":449,"./../tokens/ico_grass.png":450,"./../tokens/ico_insect.png":451,"./../tokens/ico_leaf.png":452,"./../tokens/ico_mist.png":453,"./../tokens/ico_moon.png":454,"./../tokens/ico_rain..png":455,"./../tokens/ico_snow.png":456,"./../tokens/ico_stars.png":457,"./../tokens/ico_storm.png":458,"./../tokens/ico_sun.png":459,"./../tokens/ico_tree.png":460,"./../tokens/ico_wind.png":461,"./../ui/biomeforest-alt.png":462,"./../ui/biomeforest.png":463,"./../ui/biomegrass-alt.png":464,"./../ui/biomegrass.png":465,"./../ui/biometundra-alt.png":466,"./../ui/biometundra.png":467,"./../ui/bird.png":468,"./../ui/btn_about_long.png":469,"./../ui/btn_about.png":470,"./../ui/btn_pause.png":471,"./../ui/btn_restart_shadow.png":472,"./../ui/btn_restart_top.png":473,"./../ui/btn_restart.png":474,"./../ui/btn_start_shadow.png":475,"./../ui/btn_start_top.png":476,"./../ui/btn_start.png":477,"./../ui/close-button.png":478,"./../ui/compass1.png":479,"./../ui/compass2.png":480,"./../ui/compass3.png":481,"./../ui/compass4.png":482,"./../ui/empty_box.png":483,"./../ui/filled_box.png":484,"./../ui/finger-inv.png":485,"./../ui/finger.png":486,"./../ui/hint-card-left.png":487,"./../ui/hint-card-middle.png":488,"./../ui/hint-card-right.png":489,"./../ui/ico_about_orange.png":490,"./../ui/ico_about.png":16,"./../ui/ico_closeJournal.png":491,"./../ui/ico_completedHaiku.png":492,"./../ui/ico_emptyHaiku.png":493,"./../ui/ico_emptytoken.png":494,"./../ui/ico_expand.png":495,"./../ui/ico_haiku_leaf.png":496,"./../ui/ico_haiku.png":497,"./../ui/ico_journal.png":498,"./../ui/ico_languageSelect.png":499,"./../ui/ico_NFBONF.png":500,"./../ui/ico_openjournal.png":501,"./../ui/ico_paperJournal1-rotated.png":502,"./../ui/ico_paperJournal1.png":503,"./../ui/ico_paperJournal2-rotated.png":504,"./../ui/ico_paperJournal2.png":505,"./../ui/ico_popupHaiku-straight.png":506,"./../ui/ico_popupHaiku.png":507,"./../ui/ico_restart.png":508,"./../ui/ico_resume.png":509,"./../ui/ico_scrollbar.png":510,"./../ui/ico_toggle.png":511,"./../ui/ico_volume_bar.png":512,"./../ui/ico_volume_gauge.png":513,"./../ui/ico_volume_toggle.png":514,"./../ui/ico_volume.png":515,"./../ui/ico_XcloseJournal.png":516,"./../ui/title2_en_leaf.png":517,"./../ui/title2_en.png":518,"./../ui/title2_fr_leaf.png":519,"./../ui/title2_fr.png":520,"./../ui/touch-inv.png":521,"./../ui/touch.png":522,"./../ui/tree-inv.png":523,"./../ui/tree.png":524,"./../ui/vertical-rule.png":525,"./../ui/wayfinder_placeholder.png":526}],253:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bird_fly.10e50eb0.png";
},{}],275:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bird_still.316c5432.png";
},{}],311:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/butterfly.590eae07.png";
},{}],312:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/butterfly.425f9561.sheet";
},{}],313:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fish.ecc462e3.png";
},{}],314:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fish.917b11d7.sheet";
},{}],315:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fox_sleep.75eb7f58.png";
},{}],316:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fox_sleep.3ac15393.sheet";
},{}],317:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fox_wakesup.ae599fe9.png";
},{}],318:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fox_wakesup.10c4f883.sheet";
},{}],319:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fox.ee47720b.png";
},{}],320:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fox.c96737e8.sheet";
},{}],321:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ground-flowers.190e3060.png";
},{}],322:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ground-flowers.dd270952.sheet";
},{}],323:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/jumpingrabbit.e171c2b6.png";
},{}],324:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/jumpingrabbit.f82f89a0.sheet";
},{}],325:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/owl_sleep.b30d416b.png";
},{}],326:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/owl_wakeup.6f4e8fd0.png";
},{}],327:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/owl.403d4caa.png";
},{}],328:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/rabbit.71ad4455.png";
},{}],329:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/seal.4c4c74a1.png";
},{}],330:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/temp_grass_sprites.e0acd927.png";
},{}],331:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/temp_grass_sprites.f7d64c20.sheet";
},{}],332:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/temp_sprites-0.871990a9.png";
},{}],333:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/temp_sprites-0.8d874248.sheet";
},{}],334:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/temp_sprites-1.d12fe91d.png";
},{}],335:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/temp_sprites-1.72097783.sheet";
},{}],336:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/temp_sprites-2.d8a97589.png";
},{}],337:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/temp_sprites-2.5cb62997.sheet";
},{}],338:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tokens.d78249c7.png";
},{}],339:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tokens.63c17663.sheet";
},{}],340:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-anim-a.d0cd4062.png";
},{}],341:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-anim-a.0889586e.sheet";
},{}],342:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-anim-b.1ef75684.png";
},{}],343:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-anim-b.f86aefae.sheet";
},{}],344:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-anim-c.2850e304.png";
},{}],345:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-anim-c.1a7a740e.sheet";
},{}],108:[function(require,module,exports) {
module.exports={bird_fly:{png:require("./bird_fly.png")},bird_still:{png:require("./bird_still.png")},butterfly:{png:require("./butterfly.png"),sheet:require("./butterfly.sheet")},fish:{png:require("./fish.png"),sheet:require("./fish.sheet")},fox_sleep:{png:require("./fox_sleep.png"),sheet:require("./fox_sleep.sheet")},fox_wakesup:{png:require("./fox_wakesup.png"),sheet:require("./fox_wakesup.sheet")},fox:{png:require("./fox.png"),sheet:require("./fox.sheet")},"ground-flowers":{png:require("./ground-flowers.png"),sheet:require("./ground-flowers.sheet")},jumpingrabbit:{png:require("./jumpingrabbit.png"),sheet:require("./jumpingrabbit.sheet")},owl_sleep:{png:require("./owl_sleep.png")},owl_wakeup:{png:require("./owl_wakeup.png")},owl:{png:require("./owl.png")},rabbit:{png:require("./rabbit.png")},seal:{png:require("./seal.png")},temp_grass_sprites:{png:require("./temp_grass_sprites.png"),sheet:require("./temp_grass_sprites.sheet")},"temp_sprites-0":{png:require("./temp_sprites-0.png"),sheet:require("./temp_sprites-0.sheet")},"temp_sprites-1":{png:require("./temp_sprites-1.png"),sheet:require("./temp_sprites-1.sheet")},"temp_sprites-2":{png:require("./temp_sprites-2.png"),sheet:require("./temp_sprites-2.sheet")},tokens:{png:require("./tokens.png"),sheet:require("./tokens.sheet")},"tree-anim-a":{png:require("./tree-anim-a.png"),sheet:require("./tree-anim-a.sheet")},"tree-anim-b":{png:require("./tree-anim-b.png"),sheet:require("./tree-anim-b.sheet")},"tree-anim-c":{png:require("./tree-anim-c.png"),sheet:require("./tree-anim-c.sheet")}};
},{"./bird_fly.png":253,"./bird_still.png":275,"./butterfly.png":311,"./butterfly.sheet":312,"./fish.png":313,"./fish.sheet":314,"./fox_sleep.png":315,"./fox_sleep.sheet":316,"./fox_wakesup.png":317,"./fox_wakesup.sheet":318,"./fox.png":319,"./fox.sheet":320,"./ground-flowers.png":321,"./ground-flowers.sheet":322,"./jumpingrabbit.png":323,"./jumpingrabbit.sheet":324,"./owl_sleep.png":325,"./owl_wakeup.png":326,"./owl.png":327,"./rabbit.png":328,"./seal.png":329,"./temp_grass_sprites.png":330,"./temp_grass_sprites.sheet":331,"./temp_sprites-0.png":332,"./temp_sprites-0.sheet":333,"./temp_sprites-1.png":334,"./temp_sprites-1.sheet":335,"./temp_sprites-2.png":336,"./temp_sprites-2.sheet":337,"./tokens.png":338,"./tokens.sheet":339,"./tree-anim-a.png":340,"./tree-anim-a.sheet":341,"./tree-anim-b.png":342,"./tree-anim-b.sheet":343,"./tree-anim-c.png":344,"./tree-anim-c.sheet":345}],346:[function(require,module,exports) {
module.exports=module.exports={animal:[["distant wolf howling","following wolf prints","horned owl hoots above","squirrels chasing by","soft squirrel chatter","otter softly sleeps","bears hunting for fish","following deer tracks","wolf calls from afar"],["a beaver's wake","a coyote howls","a deer hesitates","a squirrel climbs","a squirrel burrows","the wolf howl fades"],["above the bears den","from a moose's chin","across the wolf tracks"]],feather:[["wakened by birdsong","scuffle of feathered wings","drifting sparrow song","birds lost in flight","loons scatter away","birdsong from above","feather falls on grass","wing beats overhead","ducks paddling along","evening birdsong"],["the owl feather","a seagulls flight","the sparrows songs","sparrow-song skitters","a bird emerges","an eagles talon","birdsongs breaking","the sound of wings","goose honks echo","a swell of swallows","a faint birdsong"],["in the cidadas chirp","in a mockingbirds song","in the bird nest","between bird songs","on a blackbirds wing","by the loons call"]],fish:[["fly fishing again","fish scale shine","little fishes swim","frogs croaking at dawn","fish breaks the surface","fish swimming upstream","by the frog pond"],["a fish leaps","the frog's mouth","a frog syncopates","a fish rests","a water snake"],["as the trout rises"]],flower:[["three petals falling","spring feel in the air","yesterdays flowers","approaching spring bloom","half-blown dandelion","sunflowers in bloom","dandelion wishes","air full of pollen","picking spring flowers","lilacs in full bloom","when lavendar blooms","suddenly spring"],["a dandelion's dance","the flower falls","the first sunflower","the tomato flowers","a shower of petals","the daffodil stems","a field of dandelion fluffs","the petals fall","the wildflowers","every flower","a yellow dandelion","the scent of lilacs","sunflowers sway","the roses shift","flowers fading","a fresh bloom","iris in bloom","the silk flowers","a pear blossoms"],["amid plum blossoms","in the wildflowers","in the dandelions","through the blossoming cherries","between the sunflowers","in bloom","into the sunflowers","on the petals","between roses","into wildflowers","from the roses","between flowers","between the flowers","into blossoms","in full bloom"]],grass:[["whistling across fields","rhythmic blowing grass","swaying knee-high grass","dancing grass meadows","dancing blades of grass","wide open meadows","wide sunlit meadows","grass swaying rhythm"],["the grass trapped","the long grass","the overgrown field","grasses tiptoe","the vastness of fields","the smell of grass","a wheat field rippling"],["on a field","across the meadows","in the dry grass","in the grasses","above the sunlit meadow","over the autumn fields","above the fields","through the grass","in the field","over the field","on the meadow"]],insect:[["hornets buzzing by","bees floating above","spider's web catching","weaving spider threads","bee drifts to flower","dancing butterflies","mosquitos buzzing","on dragonfly wings","butterfly shadows","caterpillars inch","fluttering moth wind","chasing butterflies"],["a spider catches","a worm writhes","the blur of insects","a moth escapes","the flow of ants","a wasp struggles","a mosquito's buzz","a butterfly's quest","a grasshopper leaps","an ant moves","the moth's reflection","the spider shadow moves","a caterpillar reaches","the grasshopper visits","a wasp nest tumbles","a spider hangs","a bee floats","a moth stirs","a bee lands","a spiders thread","the spiders web","the firefly glow"],["inside the caterpillars tent","over butterflies","in a spider's web","on a spider's thread"]],leaf:[["leaf shadows stipple","leaves falling above","falling maple leaf","leaves drifting behind","leaves rustling away","falling leaf shadow","finding scattered leaves","leaves stirring softly","leaf-catching at dusk"],["a dry leaf","a leaf falls","a single leaf","leaf shadow weaves","the leaves fall","each leaf brimming","a leaf falling","autumn leaves","another leaf flutters","the leaf shadow spreads"],["in the leaf shadows","on every leaf","through the sunlit leaf","beyond the leaf edge"]],mist:[["through dense morning haze","lifting mist reveals","rolling skyline fog","haze over the hills","morning dew drop mist","shifting mist shadows","caught in flowing mist","autumn mist deepens","horizon fog shifts"],["one dew drop","shrouded in mist","fog climbing","patches of fog","the fog rises"],["in the mist","in the fog","through the fog","between the mist","in the autumn haze","in winter mist","through the morning fog","in the autumn mist","in river mist","into fog","through the dew","on the fog","from the fog","into mist","through the mist"]],moon:[["moonless autumn night","ambrosia moon night","fireflies light the way","moonless night again","another moon day","moonlight casts shadows","moon gazing again","dappled moon-lit floor","moonlit stillness falls"],["the moon dances","a path of moonlight","lost in the night","the moon swallows","the darkness lengthens","the silence of the moon","the moonlight lengthens","the moons reflection","moon shadows drift","the silver of the moon","moonlight reveals"],["in the clear night","against the night sky","under the moonlight","between the moon","under a waning moon","on a moonless night","across the moon","in the moonlight"]],rain:[["afternoon drizzle","caught in sudden rain","waiting for the rains","pitter-patter rain","chorus of rainfall","steady rain drumming","through sheets of rainfall","quiet rain drop sounds"],["the water falls","a tumult of rain","the river flowing","rain bubbles burst","a raindrop falls","the soft rain","the patter of raindrops","the first raindrops","another drop of rain","the sound of water","the weight of raindrops","the pelting rain"],["after the rain","through the rain","in every puddle","before the rain","under the rain","in the gentle rain","at the waters edge","under the endless rain","between raindrops","on the water's surface"]],snow:[["snow-covered mountains","footprints in the snow","cold mountain shadow","late winter morning","soundless snowflakes fall","quiet fall of snow","snowflakes whirl into","snow bent pine branches","snowflakes blend and blur"],["a fresh snow angel","the shadow of snow","a snowflake slides","snow gathers","a snowflake resting","another inch of snow","snowflakes melting","the winter sky darkens","snowflakes falling","the sound of snow","a snowflake caught","a snowflake melts","snowflakes blowing","snowflakes collecting","a hint of winter"],["after the first freeze","beneath the ice","along the ice cracks","in the winter haze","between ice floes","in the winter chill","against the snow"]],stars:[["star speckled night sky","watching shooting stars","star gazing again","distant stars sparkle","pale stars far above","twinkling starry sky","scattered star-light falls","below falling stars","between glowing stars"],["another star appears","blizzards of stars","a thread of light","the stars peering","a star falls from","a shooting star","a glimmer of light","quivers of light"],["against the light","after the stars","beyond the lights","under the stars","into the light","against the stars","between the stars"]],storm:[["sudden thunderclap!","watching summer clouds","whispering thunder","looming storm clouds drift","lightning flashes blind","approaching storm cloud","distant lightning crash","storm-washed horizon","mountain-top thunder","rolling thunder wave"],["clouds break","the space between clouds","the soft boom","a flash of lightning","a distant cloud rains","a cloud passes through","clap of thunder"],["after the storm","before the storm","above the clouds","after the hurricane","through the storm","in the clouds","in a flash","as thunder recedes","through the storm door","in the storms eye","behind a cloud"]],sun:[["lengthening shadows","warm summer morning","last rays of sunset","shadows in the sun","pale sun flickering","afternoon shadows","sun-dappled shadows","shimmering summer","sun-soaked horizon","shimmering sun lights"],["a ray of sunshine streams","the suns warmth","fleeting sun shadows","the sun mining","the suns reflections","the sun shines through","a glimmer of sun","sun shadows dance","the midday sun","the summer sky"],["into the sun","despite the days heat","in the summer heat","in the summer sunset","in the autumn sun","before the sun","into summer","toward the sun","in dappled sun shadows"]],tree:[["filtered through pine branch","between giant cedar trees ","shivering aspen","silhouette trees loom","forest silence finds","forest secrets hide","tree shadows occlude","between fallen trees"],["a solitary oak","glimpsed through trees","rises above the branches","a leafless tree","each pine needle","the leafless tree","a solitary tree","an acorn falls","the willow tree","every pine needle","a branch drips","a pine cone"],["from leafless trees","under the maple tree","between the trees","into the woods","above the pine forest","through the forest","beneath the pine","by the maple roots","from a leafless branch","on a withered branch","in the pine branch","behind the trees","under tall pines","upon a pine branch","from a tree silhouette"]],wind:[["windblown shadows reach","caterpillar breeze","blossoms in the wind","whistling wind catches","carried by the wind","gliding on the wind","hidden in the wind","gentle autumn wind"],["floating in the breeze","hanging in the air","the wind plays","carried on a breeze","the sound of the wind","caught by a breeze","a change in the wind","a soft breeze ripples","a faint breeze rises"],["before the wind","in the wind","against the winds chill","in an autumn wind","on the breeze","on the wind","into the wind","against the wind"]]};
},{}],347:[function(require,module,exports) {
module.exports=module.exports={animal:[["lointain hurlement d'un loup","sur les traces d'un loup"],["l'veil d'un castor","un coyote hurle"],["au-dessus de la tanire de l'ours","du menton d'un orignal"]],feather:[["chant d'un oiseau","doux battement d'ailes"],["la plume du hibou","l'envol d'un goland"],["dans le chant des cigales","dans la mlodie d'un oiseau moqueur"]],fish:[["jour de pche  la mouche","caille scintillante d'un poisson"],["un poisson s'lance","la bouche d'une grenouille"],["alors que la truite s'lve"]],flower:[["trois ptales tombent","printemps dans l'air"],["la danse d'un pissenlit","la fleur tombe"],["parmi les pruniers en fleurs","parmi les fleurs sauvages"]],grass:[["sifflement  travers les champs","l'herbe ondoie en rythme"],["un brin d'herbe coinc","les hautes herbes"],["dans un champ","au-del des prairies"]],insect:[["les frelons bourdonnent","les abeilles butinent"],["une araigne capture","un ver se tortille"],["dans la tente de la chenille","au-dessus des papillons"]],leaf:[[" l'ombre du feuillage","les feuilles tombent doucement"],["une feuille sche","une feuille tombe"],[" l'ombre du feuillage","sur chaque feuille"]],mist:[["dans l'paisse brume du matin","le brouillard se dissipe et rvle"],["une goutte de rose","envelopp de brume"],["dans la brume","dans le brouillard"]],moon:[["nuit d'automne sans lune","nuit de lune d'ambroisie"],["la lune danse","un faisceau de clair de lune"],["dans la nuit claire","dans le ciel nocturne"]],rain:[["bruine d'aprs-midi","onde soudaine"],["l'eau coule","un tumulte de pluie"],["aprs la pluie","sous la pluie"]],snow:[["montagnes enneiges","traces de pas sur la neige"],["un ange trac dans la neige","l'ombre de la neige"],["aprs la premire gele","sous la glace"]],stars:[["ciel constell d'toiles","regarder les toiles filantes"],["une autre toile apparat","blizzards d'toiles"],["dans la lumire","aprs les toiles"]],storm:[["soudain coup de tonnerre!","regarder les nuages d't"],["perce dans les nuages","l'espace entre les nuages"],["aprs la tempte","avant la tempte"]],sun:[["les ombres s'allongent","doux matin d't"],["un rayon de soleil jaillit","la chaleur du soleil"],["dans le soleil","malgr le temps chaud"]],tree:[[" travers les branches des pins","sous de gigantesques cdres"],["un chne solitaire","aperu dans les arbres"],["des arbres nus","sous l'rable"]],wind:[["ombres portes par le vent","brise de chenille"],["flottant dans la brise","suspendu dans l'air"],["avant le vent","dans le vent"]]};
},{}],109:[function(require,module,exports) {
module.exports={"haiku-phrases-en":{json:require("./haiku-phrases-en.json")},"haiku-phrases-fr":{json:require("./haiku-phrases-fr.json")}};
},{"./haiku-phrases-en.json":346,"./haiku-phrases-fr.json":347}],31:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},t=require("three"),s=g(t),n=require("../assets/image/**/*.{png,jpeg,jpg,svg}"),r=f(n),i=require("../assets/spritesheets/*.{sheet,png,jpeg,jpg}"),o=f(i),a=require("../assets/json/*.{json,txtjson}"),c=f(a),l=require("./array"),u=require("right-now"),d=f(u),h=require("./addFrameTasks");function f(e){return e&&e.__esModule?e:{default:e}}function g(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t}const p=null,y=!1,w=new Map;H(r.default,(e,t)=>{w.set(e,t)},["image"]),D(w,c.default,"json",{type:"json"}),D(w,o.default,"spritesheets",{type:"spritesheet-legacy"}),E(w);const m=["png","webp","jpg","jpeg"],j=[{type:"image",extensions:["svg","png","webp","jpg","jpeg"]},{type:"json",extensions:["json","sheet","txtjson"]},{type:"spritesheet-legacy"}],b=!1,x=()=>{},q=!1;let v,$;"function"==typeof window.requestIdleCallback?(v=window.requestIdleCallback.bind(window),$=window.cancelIdleCallback.bind(window)):(console.warn("[Assets] Using Request Animation Frame"),v=window.requestAnimationFrame.bind(window),$=window.cancelAnimationFrame.bind(window));const O=!1,_=["json","sheet"],k=["jpg","png"];k.unshift("svg");class T{constructor(){this._idleHandle=null,this._idleTimeout=1e3,this._loadQueuedBound=this.loadQueued.bind(this),this._ready=Promise.resolve(),this.urlMap=w,this.queue=new Set,this.cache=new Map,this.config=new Map,this.timing=new Map}urlToID(e){return this.urlMap.set(e,e),e}setConfig(e,t){this.config.set(e,t)}getConfig(e){return this.config.has(e)?this.config.get(e):{}}_processOnNextTick(){this._cancelIdle(),this._idleHandle=v(this._loadQueuedBound,{timeout:this._idleTimeout})}_cancelIdle(){null!=this._idleHandle&&($(this._idleHandle),this._idleHandle=null)}prepare(e){(e=Array.isArray(e)?e:[e]).forEach(e=>{w.has(e)||(console.warn(`No asset by ID ${e}`),/\.[^.]+$/.test(e)&&console.warn('[Hint] Don\'t include the extension like ".png" on the asset ID')),this.queue.has(e)||this.cache.has(e)||this.queue.add(e)}),this._processOnNextTick()}loadQueued(){if(this._cancelIdle(),!this.queue.size)return Promise.resolve();x(`Loading ${this.queue.size} assets`);const e=(0,d.default)(),t=Array.from(this.queue);return this.queue.clear(),Promise.all(t.map(e=>this.load(e))).then(t=>{const s=(0,d.default)()-e;return x(`Loaded queue in ${s} ms`),t})}release(e){this.queue.has(e)&&this.queue.delete(e),this.cache.has(e)&&this.cache.delete(e),this.config.has(e)&&this.config.delete(e)}async loadGPUTexture(t,s,n,r){const i=await this.load(n);s.image=i;const o=e({},this.getConfig(n),r),a=!1!==o.release,c=!1!==o.init;return o.repeat&&s.repeat.copy(o.repeat),o.offset&&s.offset.copy(o.offset),delete o.release,delete o.init,delete o.crossOrigin,delete o.repeat,delete o.offset,Object.assign(s,o),s.needsUpdate=!0,c&&(0,h.addFrameTask)(()=>{t.initTexture(s),a&&(s.image={width:i.width,height:i.height},this.release(n))}),s}async createGPUTexture(e,t,n){const r=new s.Texture;return this.loadGPUTexture(e,r,t,n)}createGPUTextureTask(e,t,n){const r=new s.Texture;return[r,this.loadGPUTexture(e,r,t,n)]}async load(e){if(this.queue.has(e)&&this.queue.delete(e),this.cache.has(e))return this.cache.get(e);const t=(0,d.default)();this.timing.set(e,t);const s=w.get(e);if(!s)return console.error(`Could not find URL for asset ID ${e}`),null;let n,r=Array.isArray(s)?"spritesheet-legacy":s.type;if(r)n=j.find(e=>e.type===r);else if("string"==typeof s){const t=A(s);if(!t)return void console.warn(`Could not extract loader type for ${e} with data: ${s}`);n=j.find(e=>e.extensions.some(e=>e===t))}else{const e=s?Object.keys(s):[];n=j.find(t=>t.extensions.some(t=>e.includes(t)))}if(!n)return void console.warn(`Could not find loader for ${e} and URL object ${s}`);const i=this.getConfig(e);let o;if("image"===n.type)o=M(e,s,i);else if("json"===n.type)o=P(e,s,i);else{if("spritesheet-legacy"!==n.type)throw new Error(`Loader type ${n.type} not yet implemented`);o=C(e,s,i)}return this.cache.set(e,o),o.then(t=>{const s=(0,d.default)(),n=this.timing.get(e),r="object"==typeof e?Object.values(e)[0]:e;return x(`Loaded ${r} in ${Math.round(s-n)} ms`),t}).catch(t=>{console.error(`Error loading Asset by ID ${e}`),console.error(t.message),this.release(e)})}}function I(e,t,s){if("string"==typeof t)return{ext:A(t),url:t};let n;if(!(n=s?s.find(e=>e in t):Object.keys(t)[0]))throw console.log("NO EXT",t,n,s),new Error(`Could not find a suitable extension for ${e} from: ${Object.keys(t)}`);return{ext:n,url:t[n]}}function A(e){const t=/\.([^.]+)$/.exec(e);return t&&t[1]?t[1].toLowerCase():""}function E(e){const t=Array.from(e.entries()).filter(([e,t])=>"spritesheet-legacy"===t.type),s=new Map;t.forEach(([e,t])=>{let n=e,r=0;const i=/(.*)\-([\d]+)$/.exec(n);i&&(n=i[1],r=parseInt(i[2],10)||0),s.has(n)?s.get(n).push({id:r,key:e}):s.set(n,[{id:r,key:e}])}),Array.from(s.entries()).forEach(([t,s])=>{s.sort((e,t)=>e.id-t.id);const n=s.map(t=>{const s=e.get(t.key);return e.delete(t.key),s});e.set(t,n)})}async function C(e,t,s){const n=t.map((t,n)=>{const r=e+"-"+n,i=M(r,t,s);return[P(r,t,s),i]}).flat(),r=await Promise.all(n),i=[];for(let e=0;e<r.length;e+=2){const t=r[e],s=r[e+1];i.push([t,s])}return i}async function P(e,t,s){const{ext:n,url:r}=I(e,t,_);return(await fetch(r)).json()}async function M(e,t,s){const{ext:n,url:r}=I(e,t,k);return y&&m.includes(n)?U(e,r,s):R(r,s)}async function L(e,t={}){const s=await fetch(e),n=await s.text(),r=document.createElement("canvas"),i=r.getContext("2d"),o="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(n),a=await loadImage(o,t);return r.width=a.width,r.height=a.height,i.drawImage(a,0,0),r}async function U(e,t,s={}){return new Promise((n,r)=>{p.postMessage({type:"image",id:e,url:t,config:s}),x(`Loading ${e} in worker...`),p.addEventListener("message",function t(s){if(s.data&&s.data.id===e)if(p.removeEventListener("message",t),s.data.error){let e=s.data?s.data.error:"No Data Received";console.error(`[AssetWorker] ${e}`),r(new Error(e))}else{const t=s.data.result;x(`Received ${e}`,t),n(t)}})})}function R(e,t={}){return new Promise((s,n)=>{const r=new window.Image;r.onerror=(()=>{n(new Error(`Error loading URL ${e}`))}),r.onload=(()=>{s(r)}),null!=t.crossOrigin&&(r.crossOrigin=t.crossOrigin),r.src=e})}function D(t,s,n,r={}){Object.entries(s).forEach(([s,i])=>{const o=[n,s].join("/");t.has(o)&&console.error(`WARN: Asset map already has entry by key ${o}`),i&&"object"==typeof i&&(i=e({},r,i)),t.set(o,i)})}function H(e,t,s=[]){Object.entries(e).forEach(([e,n])=>{let r;if(n&&"object"==typeof n){r=!Object.values(n).some(e=>e&&"object"==typeof e)}else r="string"==typeof n;"json"===e&&(r=!0);const i=[...s,e];if(r){const e=i.join("/");t(e,n)}else H(n,t,i)})}exports.default=new T;
},{"three":74,"../assets/image/**/*.{png,jpeg,jpg,svg}":107,"../assets/spritesheets/*.{sheet,png,jpeg,jpg}":108,"../assets/json/*.{json,txtjson}":109,"./array":139,"right-now":223,"./addFrameTasks":140}],138:[function(require,module,exports) {
module.exports={animal:require("./ico_animal.png"),feather:require("./ico_feather.png"),fish:require("./ico_fish.png"),flower:require("./ico_flower.png"),grass:require("./ico_grass.png"),insect:require("./ico_insect.png"),leaf:require("./ico_leaf.png"),mist:require("./ico_mist.png"),moon:require("./ico_moon.png"),"rain.":require("./ico_rain..png"),snow:require("./ico_snow.png"),stars:require("./ico_stars.png"),storm:require("./ico_storm.png"),sun:require("./ico_sun.png"),tree:require("./ico_tree.png"),wind:require("./ico_wind.png")};
},{"./ico_animal.png":446,"./ico_feather.png":447,"./ico_fish.png":448,"./ico_flower.png":449,"./ico_grass.png":450,"./ico_insect.png":451,"./ico_leaf.png":452,"./ico_mist.png":453,"./ico_moon.png":454,"./ico_rain..png":455,"./ico_snow.png":456,"./ico_stars.png":457,"./ico_storm.png":458,"./ico_sun.png":459,"./ico_tree.png":460,"./ico_wind.png":461}],139:[function(require,module,exports) {
module.exports={animal:require("./ico_animal.png"),feather:require("./ico_feather.png"),fish:require("./ico_fish.png"),flower:require("./ico_flower.png"),grass:require("./ico_grass.png"),"insect.":require("./ico_insect..png"),leaf:require("./ico_leaf.png"),mist:require("./ico_mist.png"),moon:require("./ico_moon.png"),rain:require("./ico_rain.png"),snow:require("./ico_snow.png"),stars:require("./ico_stars.png"),storm:require("./ico_storm.png"),sun:require("./ico_sun.png"),tree:require("./ico_tree.png"),wind:require("./ico_wind.png")};
},{"./ico_animal.png":430,"./ico_feather.png":431,"./ico_fish.png":432,"./ico_flower.png":433,"./ico_grass.png":434,"./ico_insect..png":435,"./ico_leaf.png":436,"./ico_mist.png":437,"./ico_moon.png":438,"./ico_rain.png":439,"./ico_snow.png":440,"./ico_stars.png":441,"./ico_storm.png":442,"./ico_sun.png":443,"./ico_tree.png":444,"./ico_wind.png":445}],140:[function(require,module,exports) {
module.exports={animal:require("./animal.png"),feather:require("./feather.png"),fish:require("./fish.png"),flower:require("./flower.png"),grass:require("./grass.png"),insect:require("./insect.png"),leaf:require("./leaf.png"),mist:require("./mist.png"),moon:require("./moon.png"),rain:require("./rain.png"),snow:require("./snow.png"),stars:require("./stars.png"),storm:require("./storm.png"),sun:require("./sun.png"),tree:require("./tree.png"),wind:require("./wind.png")};
},{"./animal.png":414,"./feather.png":415,"./fish.png":416,"./flower.png":417,"./grass.png":418,"./insect.png":419,"./leaf.png":420,"./mist.png":421,"./moon.png":422,"./rain.png":423,"./snow.png":424,"./stars.png":425,"./storm.png":426,"./sun.png":427,"./tree.png":428,"./wind.png":429}],247:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};exports.loadImage=o,exports.loadTexture=s;var t=require("three"),r=n(t);function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e,t={}){return new Promise(r=>{const n=new window.Image;n.onerror=(()=>{console.error(`Could not load Texture by URL ${e}`),r(n)}),n.onload=(()=>{r(n)}),null!=t.crossOrigin&&(n.crossOrigin=t.crossOrigin),n.src=e})}let a;function s(t,n={}){return(/\.svg$/i.test(t)?i(t,n):o(t,n)).then(t=>{const o=new r.Texture;o.image=t;const a=e({},n);return delete a.crossOrigin,Object.assign(o,a),o.needsUpdate=!0,o})}async function i(e,t={}){const r=await fetch(e),n=await r.text(),a=document.createElement("canvas"),s=a.getContext("2d"),i="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(n),c=await o(i,t);return a.width=c.width,a.height=c.height,s.drawImage(c,0,0),a}
},{"three":74}],248:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},t=require("three"),a=i(t),r=require("./Assets"),s=o(r),n=require("./load");function o(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}exports.default=async function(t,r,o={}){let i;if("string"==typeof t){const e=t;console.log("[sprites] Loading Sprite Sheet",e);const n=await s.default.load(e);t=n.map(([e])=>({data:e})),i=n.map(([e,t])=>{const s=new a.Texture;return s.image=t,s.needsUpdate=!0,r.initTexture(s),!1!==o.release&&(s.image={width:t.width,height:t.height}),s}),!1!==o.release&&s.default.release(e)}else t=await Promise.all(t.map(async t=>{if("string"==typeof t.data){const a=await fetch(t.data);let r=await a.json();t=e({},t,{data:r})}return t})),(i=await Promise.all(t.map(({url:e})=>(0,n.loadTexture)(e)))).forEach(e=>r.initTexture(e));const l={};t.forEach(({data:e},t)=>{e.frames.forEach((r,s)=>{const n=r.frame,o=r.filename,u=new a.Texture,f=e.meta.size,{w:c,h:d}=f;u.repeat.set(n.w/c,n.h/d),u.offset.x=n.x/c,u.offset.y=1-n.h/d-n.y/d;let p="";const h=o.toLowerCase().replace(/\.(png|jpg|jpeg)$/i,"");let m=h;const w=h.lastIndexOf("/");w>=0&&(p=h.substring(0,w).toLowerCase(),m=h.substring(w+1));const g=h.match(/(^|[^\d])(\d+)$/);let x=s;g&&(x=parseInt(g[2],10));const y={atlas:i[t],sheetIndex:t,name:h,basename:m,data:n,width:n.w,height:n.h,offset:u.offset.clone(),repeat:u.repeat.clone(),texture:u,type:p,idCount:x};r.trimmed,l[h]=y})});const u=Object.values(l),f=u.slice().sort((e,t)=>e.idCount-t.idCount);return{atlases:i,map:l,frames:f,values:u}};
},{"three":74,"./Assets":31,"./load":247}],138:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BiomeFeatures=exports.AllTokens=exports.TokenURLs=exports.CollectedTokenURLs=exports.InvertedTokenURLs=void 0,exports.getTokenSheet=w,exports.loadTokenSprites=x,exports.createTokenCanvas=T;var e=require("../assets/image/tokens/ico_*.png"),t=l(e),s=require("../assets/image/tokens-inverted/ico_*.png"),n=l(s),o=require("../assets/image/tokens-collected/*.png"),r=l(o),a=require("./SpriteManager"),i=l(a);function l(e){return e&&e.__esModule?e:{default:e}}const d=exports.InvertedTokenURLs=n.default,m=exports.CollectedTokenURLs=r.default,u=exports.TokenURLs=t.default,f=exports.AllTokens=["sun","moon","wind","mist","rain","storm","tree","leaf","fish","animal","feather","grass","flower","insect","snow","stars"],c=exports.BiomeFeatures={forest:{tokens:["sun","moon","mist","rain","storm","tree","leaf","fish","animal","feather","flower","insect","stars"]},grasslands:{tokens:["sun","moon","wind","mist","rain","storm","fish","animal","feather","grass","flower","insect","stars"]},tundra:{tokens:["moon","wind","mist","rain","storm","tree","fish","animal","feather","flower","insect","snow","stars"]}},p=new Map;let h,k=new Promise(e=>{h=e}),g={};function w(){return k}function x(e){(0,i.default)("spritesheets/tokens",e,{release:!1}).then(e=>{h(e)})}async function T(e){const t=await k,s=document.createElement("canvas");if(e in t.map){const n=t.map[e];s.width=n.width,s.height=n.height,s.getContext("2d").drawImage(t.atlases[0].image,n.data.x,n.data.y,n.data.w,n.data.h,0,0,n.width,n.height)}else console.error("Name %s not in token sheet",e);return s}
},{"../assets/image/tokens/ico_*.png":138,"../assets/image/tokens-inverted/ico_*.png":139,"../assets/image/tokens-collected/*.png":140,"./SpriteManager":248}],690:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("svelte/internal"),e=require("svelte"),i=require("../animations/transitions"),n=require("../util/Assets"),o=s(n),r=require("../util/tokens");function s(t){return t&&t.__esModule?t:{default:t}}function a(e){let i,n,o,r,s,a;return{c(){i=(0,t.element)("div"),(0,t.attr)(i,"class","image-container svelte-kj6g8f"),(0,t.set_style)(i,"width",e[0]),(0,t.set_style)(i,"height",e[1]),(0,t.toggle_class)(i,"ignorePointer",e[4])},m(n,o){(0,t.insert)(n,i,o),e[14](i),r=!0,s||(a=[(0,t.listen)(i,"introend",e[10]),(0,t.listen)(i,"introstart",e[11]),(0,t.listen)(i,"outroend",e[12]),(0,t.listen)(i,"outrostart",e[13])],s=!0)},p(e,[n]){(!r||1&n)&&(0,t.set_style)(i,"width",e[0]),(!r||2&n)&&(0,t.set_style)(i,"height",e[1]),16&n&&(0,t.toggle_class)(i,"ignorePointer",e[4])},i(s){r||((0,t.add_render_callback)(()=>{o&&o.end(1),n||(n=(0,t.create_in_transition)(i,e[2],{})),n.start()}),r=!0)},o(s){n&&n.invalidate(),o=(0,t.create_out_transition)(i,e[3],{}),r=!1},d(n){n&&(0,t.detach)(i),e[14](null),n&&o&&o.end(),s=!1,(0,t.run_all)(a)}}}function l(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function u(n,s,a){let u,{alt:d=""}=s,{width:c="initial"}=s,{height:h="initial"}=s,{id:g}=s,{image:f}=s,{token:_=!1}=s,{inTransition:b=i.emptyTransition}=s,{outTransition:m=i.emptyTransition}=s,{ignorePointer:p=!1}=s,v=Promise.resolve(),T=[],y=!1;return(0,e.onMount)(()=>(T.forEach(t=>t()),T.length=0,()=>{T.length=0,y=!0})),n.$$set=(t=>{"alt"in t&&a(6,d=t.alt),"width"in t&&a(0,c=t.width),"height"in t&&a(1,h=t.height),"id"in t&&a(7,g=t.id),"image"in t&&a(8,f=t.image),"token"in t&&a(9,_=t.token),"inTransition"in t&&a(2,b=t.inTransition),"outTransition"in t&&a(3,m=t.outTransition),"ignorePointer"in t&&a(4,p=t.ignorePointer)}),n.$$.update=(()=>{896&n.$$.dirty&&async function(t,e,i){T.length=0,await v,v=t?"function"==typeof t.then?t:Promise.resolve(t):e?(0,r.createTokenCanvas)(i):o.default.load(i);const n=await v;function s(){if(y)return;l(u);const i=t||e?n:n.cloneNode();i.setAttribute("draggable",!1),u.appendChild(i)}u?s():T.push(s)}(f,_,g)}),[c,h,b,m,p,u,d,g,f,_,function(e){(0,t.bubble)(n,e)},function(e){(0,t.bubble)(n,e)},function(e){(0,t.bubble)(n,e)},function(e){(0,t.bubble)(n,e)},function(e){t.binding_callbacks[e?"unshift":"push"](()=>{a(5,u=e)})}]}class d extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,u,a,t.safe_not_equal,{alt:6,width:0,height:1,id:7,image:8,token:9,inTransition:2,outTransition:3,ignorePointer:4})}}exports.default=d;
},{"svelte/internal":226,"svelte":220,"../animations/transitions":689,"../util/Assets":31,"../util/tokens":138}],229:[function(require,module,exports) {
function t(t,n){for(var e in n)t.setAttribute(e,n[e])}function n(t,n){t.onload=function(){this.onerror=this.onload=null,n(null,t)},t.onerror=function(){this.onerror=this.onload=null,n(new Error("Failed to load "+this.src),t)}}function e(t,n){t.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,n(null,t))}}module.exports=function(o,a,r){var c=document.head||document.getElementsByTagName("head")[0],i=document.createElement("script");"function"==typeof a&&(r=a,a={}),a=a||{},r=r||function(){},i.type=a.type||"text/javascript",i.charset=a.charset||"utf8",i.async=!("async"in a)||!!a.async,i.src=o,a.attrs&&t(i,a.attrs),a.text&&(i.text=""+a.text),("onload"in i?n:e)(i,r),i.onload||n(i,r),c.appendChild(i)};
},{}],536:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=/(Android|webOS|iPod|BlackBerry|Phone|playbook|silk|iOS|iPad|iPhone)/i.test(navigator.userAgent);
},{}],227:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.localize=exports.language=void 0;var e=require("svelte/store"),r=require("../config"),n=s(r),t=require("./query-string"),a=s(t),o=require("./isMobile"),i=s(o);function s(e){return e&&e.__esModule?e:{default:e}}const l={nfbInteractiveLink:{en:"https://www.nfb.ca/interactive/",fr:"https://www.onf.ca/interactif/"},introBlurbOne:{en:"an animated journey across",fr:"une excursion anime"},introBlurbTwo:{en:"the poetry of the land",fr:" travers la posie du paysage"},startButton:{en:"start",fr:"dmarrer"},resumeButton:{en:"resume",fr:"reprendre"},aboutButton:{en:"info",fr:" propos"},skipButton:{en:"skip",fr:"passer"},continueButton:{en:"continue",fr:"continuer"},journalTitle:{en:"poems",fr:"pomes"},newMemory:{en:"you've collected a new memory",fr:"tu as rcupr un nouveau souvenir"},introPlaceholder:{en:"nature is losing its memories...",fr:"TBD FR translation"},tapOrClickAndHold:{en:`${i.default?"Tap":"Click"} + Hold`,fr:`${i.default?"Appuyez":"Cliquez ou"} touchez`},tutorialTapHold:{en:`${i.default?"Tap":"Click"} and hold to explore`,fr:`${i.default?"Appuyez":"Cliquez ou "} et maintenez pour explorer`},tutorialResolve:{en:"Find the tree at the centre, to return the memories to the land",fr:"Trouvez larbre au centre du monde pour rendre  la terre ses souvenirs"},tutorialCollect:{en:"Collect tokens to recover natures lost memories",fr:"Rassemblez des lments pour reconstituer la mmoire de la nature"},introVideoLine0:{en:"Nature's balance is endangered",fr:"L'quilibre naturel est en danger"},introVideoLine1:{en:"Memories of the land are fracturing",fr:"Les souvenirs de la terre s'vanouissent"},introVideoLine2:{en:"Recover the lost fragments to restore balance",fr:"Retrouvez les fragments perdus pour rtablir l'quilibre"},nfbProduction:{en:"A game by Matt DesLauriers",fr:"Un jeu de Matt DesLauriers"},nfbSubcaption:{en:"Produced by the National Film Board of Canada",fr:"Produit par lOffice national du film du Canada"},playHeader:{en:"play",fr:"jeu"},aboutHeader:{en:"about",fr:" propos"},creditsHeader:{en:"credits",fr:"crdits"},moveCharacterText:{en:"to move the character across the landscape, in search of tokens that reveal lyrical fragments hidden in the wind.",fr:"l'cran pour que le personnage se dplace dans son environnement  la recherche d'lments qui rvleront des fragments lyriques cachs dans le vent."},collectText:{en:"COLLECT",fr:"AMASSEZ"},tokenStringText:{en:"tokens and string them together to form haiku-like poetry, recovering lost memories of nature.",fr:"des lments et assemblez-les pour former des pomes ressemblant  des hakus, retrouvant ainsi les souvenirs perdus de la nature."},orientText:{en:"ORIENT",fr:"ORIENTEZ-VOUS"},compassStringText:{en:"yourself with the Compass if you are lost or need a hint finding the closest tokens.",fr:" laide de la Boussole si vous tes perdu ou avez besoin dun indice pour dcouvrir les lments autour de vous."},returnText:{en:"RETURN",fr:"RENDEZ"},memoriesStringText:{en:"the memories once youve collected enough to the Origin Tree at the centre of the world, advancing you to the next stage of the experience and bringing you closer to fully restoring natures balance.",fr:" la terre ses souvenirs. Lorsque vous aurez assembl suffisamment de pomes, trouvez lArbre Originel au centre de lunivers. Vous passerez alors  la prochaine tape de lexprience, vous rapprochant de votre but ultime: restaurer entirement lquilibre de la nature."},wayfinderStrongText:{en:"WAYFINDER",fr:"TRAVERSES"},wayfinderTextParagraph:{en:"is an expression of our connectedness to the natural world. It's an opportunity to renew a damaged ecosystem through discovery and verse. The calming, contemplative gameplay is symbolic of the cause-and-effect relationship humans have with nature. It underscores our role in both affecting, but ultimately remedying, the effects of climate change through action and a greater appreciation of the environment.",fr:"est une expression de notre connexion avec le monde naturel. Cest une occasion de renouveler, par lentremise de la dcouverte et du vers, un cosystme endommag. Lexprience de jeu, apaisante et contemplative, symbolise la relation de cause  effet que les humains entretiennent avec la nature. Elle souligne notre responsabilit face aux effets des changements climatiques et notre capacit  les entraner, comme  y remdier,  travers nos actions et une plus grande apprciation de lenvironnement."},wayfinderFurtherTextParagraph:{en:"The art is generative. The visual assets and poetry are assembled procedurally and algorithmically through code, creating different combinations for each new visitor. The textured, hand-illustrated aesthetic is delivered in real-time, and the poetic verses are created with a mix of artificial intelligence/machine learning and generative processes, providing thousands of possible combinations. As such, Wayfinder is an ever-changing, emergent artwork with infinite possibilities. Each time it runs, it produces a new and individualized world.",fr:"Lart est gnratif. Les lments visuels et la posie sont assembls de manire procdurale et algorithmique  laide de code, crant diffrentes combinaisons pour chaque nouveau visiteur. Lesthtique texture et illustre  la main est livre en temps rel, et les vers potiques sont crs par un mlange dintelligence artificielle/apprentissage machine et de processus gnratifs, offrant ainsi des milliers de combinaisons possibles. Par consquent, Traverses est une uvre dart mergente en constante volution, renfermant dinfinies possibilits, qui produit un monde nouveau et individualis  chaque utilisation."},moreAt:{en:"More at ",fr:"Plus d'infos "},moreAtLink:{en:"https://www.nfb.ca/interactive/wayfinder/",fr:"https://www.onf.ca/interactif/traversees/"},moreAtLinkText:{en:"nfb.ca/interactive/wayfinder",fr:"onf.ca/interactif/traversees"},mattRole:{en:"Concept, Design and Code",fr:"Concept, design et code"},guillaumeRole:{en:"Animation and 3D Modelling",fr:"Animation et modlisation 3D"},cedrineRole:{en:"UI Design",fr:"Conception UI"},williamRole:{en:"Creative Developer",fr:"Dveloppeur cratif"},boombox:{en:"Music & Sound",fr:"Musique et son"},jelaniRole:{en:"Junior Developer",fr:"Dveloppeur junior"},nicholasRole:{en:"Producer",fr:"Producteur"},robRole:{en:"Executive Producer",fr:"Producteur excutif"},jasmineRole:{en:"Senior Production Coordinator",fr:"Coordonnatrice de production principale"},camilleJanineRole:{en:"Operation Managers",fr:"Gestionnaires des oprations"},victoriaRole:{en:"Studio Administrator",fr:"Administratrice du studio"},tammyRole:{en:"Marketing Managers",fr:"Responsable marketing"},jenniferRole:{en:"Publicist",fr:"Relationniste"},ericRole:{en:"Marketing Coordinator",fr:"Coordonnateur marketing"},sergiuRole:{en:"Information Technology",fr:"Technologie de l'information"},catherineRole:{en:"Digital Platforms",fr:"Plateformes numriques"},christianRole:{en:"Legal Services",fr:"Services juridiques"},socialRole:{en:"Social Media",fr:"Mdias sociaux"},gabrielleRole:{en:"French Translation by",fr:"Traduction franaise par"},introPresents:{en:"The National Film Board of Canada Presents",fr:"L'Office national du film du Canada prsente"},endState0:{en:"You've recovered all the lost poetic fragments.",fr:"Vous avez retrouv tous les fragments potiques perdus."},endState1:{en:"With your help, nature's memories have been restored.",fr:"Avec votre aide, les souvenirs de la nature ont t restaurs."},endState2:{en:'Thanks for playing. See more NFB projects at <a href="https://www.nfb.ca/interactive/">nfb.ca/interactive</a>',fr:"Merci d'avoir jou. Dcouvrez d'autres projets de l'ONF sur <a href=\"https://www.onf.ca/interactif/\">onf.ca/interactif</a>"},endState2A:{en:"Thanks for playing.",fr:"Merci d'avoir jou."},endState2B:{en:'See more NFB projects at <a href="https://www.nfb.ca/interactive/">nfb.ca/interactive</a>',fr:"Dcouvrez d'autres projets de l'ONF sur <a href=\"https://www.onf.ca/interactif/\">onf.ca/interactif</a>"},journalButton:{en:"poems",fr:"pomes"}},u=e=>Object.entries(l).reduce((r,n)=>(r[n[0]]=n[1][e],r),{}),c={en:u("en"),fr:u("fr")},d="fr"===(0,n.default)().lang||/^fr$/i.test(a.default.lang)?"fr":"en";let f=d,p=c[f];const m=exports.language=(0,e.writable)(d),h=exports.localize=(0,e.writable)(p);h.get=function(){return p},m.set=function(e){if("en"!==e&&"fr"!==e)throw new Error(`Invalid language ${e}`);return m.update(()=>e)},m.subscribe(e=>{p=c[f=e],h.update(()=>p)}),m.get=function(){return f};
},{"svelte/store":310,"../config":28,"./query-string":30,"./isMobile":536}],141:[function(require,module,exports) {
"use strict";function e(e){var i,d;if(void 0!==document.hidden?(i="hidden",d="visibilitychange"):void 0!==document.msHidden?(i="msHidden",d="msvisibilitychange"):void 0!==document.webkitHidden&&(i="webkitHidden",d="webkitvisibilitychange"),i){const t=()=>{document[i]?e(!1):e(!0)};document.addEventListener(d,t,!1),t()}else e(!0)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],228:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.audioState=void 0;var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},t=require("svelte/store"),r=require("./documentVisibility"),i=o(r);function o(e){return e&&e.__esModule?e:{default:e}}const u=exports.audioState=(0,t.writable)({visible:!0,muted:!1});(0,i.default)(t=>{u.update(r=>e({},r,{visible:t}))});
},{"svelte/store":310,"./documentVisibility":141}],75:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};exports.sendTrackingPixel=y,exports.revealHeader=h,exports.hideHeader=v,exports.sendAnalytics=m,exports.startButtonTracking=b;var t=require("load-script"),a=d(t),n=require("./config.js"),r=d(n),o=require("./util/locale.js"),i=require("./util/stores.js");function d(e){return e&&e.__esModule?e:{default:e}}const c=["UA-124182036-7"],l="wayfinder",s=!0;let u,f=null,g=!1;const w=new Promise(e=>{u=e});let p;const _=new Promise(e=>{p=e});function y(){if(!(0,r.default)().nfbHeader)return;let e=new Image;e.onload=(()=>{console.log("[analytics] Tracking Pixel"),e=null}),e.onerror=(()=>{e=null,console.warn("[analytics] Tracking Pixel Ignored")}),e.src="https://ad.doubleclick.net/ddm/activity/src=10976879;type=1;cat=start0;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;tfua=;npa=;gdpr=${GDPR};gdpr_consent=${GDPR_CONSENT_755};ord=1?"}async function h(){await Promise.all([w,_]),window.ifw_header.reveal()}async function v(){await Promise.all([w,_]),window.ifw_header.hide()}async function m(t={}){if(await w,"undefined"!=typeof google_analytics&&"function"==typeof google_analytics.gaTrack){console.log("[analytics] Sending",t);const a=o.language.get();try{c.forEach(n=>{google_analytics.gaTrack(e({},t,{language:a,name:l,ua_code:n}))})}catch(e){console.warn(e)}}}function b(){}window.revealHeader=h,(0,r.default)().nfbHeader?(document.addEventListener("ifw_muteSound",t=>{i.audioState.update(t=>e({},t,{muted:!0}))}),document.addEventListener("ifw_unmuteSound",t=>{i.audioState.update(t=>e({},t,{muted:!1}))}),document.addEventListener("ifw_headerAdded",()=>{window.ifw_header.hide(),p()}),document.addEventListener("ifw_headerLoaded",()=>{window.ifw_header.init({projectId:237,baseUrl:{en:"http://wayfinder.nfb.ca/",fr:"http://traversees.onf.ca/"},analytics_name:"wayfinder",analytics_code:c[0],buttons:{shareTwitter:!1,shareFB:!1,hideOnScroll:!1},forceLocale:o.language.get()}),console.log("NFB Header Loaded"),u(),m({pageview:"index"}),m({event:"auto_begin",eventLabel:"Wayfinder"})}),(0,a.default)("https://interactive-pip.nfb.ca/v2/app.js",{async:!0,type:"text/javascript"},(e,t)=>{e&&(console.error("Could not load NFB header"),console.error(e),u())})):setTimeout(u,0);
},{"load-script":229,"./config.js":28,"./util/locale.js":227,"./util/stores.js":228}],779:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../internal/index.mjs");function n(t){const n=2.5949095;return(t*=2)<1?t*t*((n+1)*t-n)*.5:.5*((t-=2)*t*((n+1)*t+n)+2)}function r(t){const n=1.70158;return t*t*((n+1)*t-n)}function u(t){const n=1.70158;return--t*t*((n+1)*t+n)+1}function e(t){const n=t*t;return t<4/11?7.5625*n:t<8/11?9.075*n-9.9*t+3.4:t<.9?4356/361*n-35442/1805*t+16061/1805:10.8*t*t-20.52*t+10.72}function o(t){return t<.5?.5*(1-e(1-2*t)):.5*e(2*t-1)+.5}function c(t){return 1-e(1-t)}function i(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}function s(t){return 1-Math.sqrt(1-t*t)}function a(t){return Math.sqrt(1- --t*t)}function p(t){return t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1}function x(t){return t*t*t}function f(t){const n=t-1;return n*n*n+1}function M(t){return t<.5?.5*Math.sin(13*Math.PI/2*2*t)*Math.pow(2,10*(2*t-1)):.5*Math.sin(-13*Math.PI/2*(2*t-1+1))*Math.pow(2,-10*(2*t-1))+1}function h(t){return Math.sin(13*t*Math.PI/2)*Math.pow(2,10*(t-1))}function I(t){return Math.sin(-13*(t+1)*Math.PI/2)*Math.pow(2,-10*t)+1}function O(t){return 0===t||1===t?t:t<.5?.5*Math.pow(2,20*t-10):-.5*Math.pow(2,10-20*t)+1}function q(t){return 0===t?t:Math.pow(2,10*(t-1))}function b(t){return 1===t?t:1-Math.pow(2,-10*t)}function w(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)}function P(t){return t*t}function d(t){return-t*(t-2)}function l(t){return t<.5?8*Math.pow(t,4):-8*Math.pow(t-1,4)+1}function j(t){return Math.pow(t,4)}function k(t){return Math.pow(t-1,3)*(1-t)+1}function y(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}function m(t){return t*t*t*t*t}function v(t){return--t*t*t*t*t+1}function _(t){return-.5*(Math.cos(Math.PI*t)-1)}function g(t){const n=Math.cos(t*Math.PI*.5);return Math.abs(n)<1e-14?1:1-n}function z(t){return Math.sin(t*Math.PI/2)}Object.defineProperty(exports,"linear",{enumerable:!0,get:function(){return t.identity}}),exports.backIn=r,exports.backInOut=n,exports.backOut=u,exports.bounceIn=c,exports.bounceInOut=o,exports.bounceOut=e,exports.circIn=s,exports.circInOut=i,exports.circOut=a,exports.cubicIn=x,exports.cubicInOut=p,exports.cubicOut=f,exports.elasticIn=h,exports.elasticInOut=M,exports.elasticOut=I,exports.expoIn=q,exports.expoInOut=O,exports.expoOut=b,exports.quadIn=P,exports.quadInOut=w,exports.quadOut=d,exports.quartIn=j,exports.quartInOut=l,exports.quartOut=k,exports.quintIn=m,exports.quintInOut=y,exports.quintOut=v,exports.sineIn=g,exports.sineInOut=_,exports.sineOut=z;
},{"../internal/index.mjs":226}],687:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.slide=exports.scale=exports.fly=exports.fade=exports.draw=exports.crossfade=exports.blur=void 0;var t=require("../easing/index.mjs"),e=require("../internal/index.mjs");function o(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o}function n(e,{delay:o=0,duration:n=400,easing:r=t.cubicInOut,amount:a=5,opacity:i=0}){const s=getComputedStyle(e),p=+s.opacity,d="none"===s.filter?"":s.filter,c=p*(1-i);return{delay:o,duration:n,easing:r,css:(t,e)=>`opacity: ${p-c*e}; filter: ${d} blur(${e*a}px);`}}function r(e,{delay:o=0,duration:n=400,easing:r=t.linear}){const a=+getComputedStyle(e).opacity;return{delay:o,duration:n,easing:r,css:t=>`opacity: ${t*a}`}}function a(e,{delay:o=0,duration:n=400,easing:r=t.cubicOut,x:a=0,y:i=0,opacity:s=0}){const p=getComputedStyle(e),d=+p.opacity,c="none"===p.transform?"":p.transform,l=d*(1-s);return{delay:o,duration:n,easing:r,css:(t,e)=>`\n\t\t\ttransform: ${c} translate(${(1-t)*a}px, ${(1-t)*i}px);\n\t\t\topacity: ${d-l*e}`}}function i(e,{delay:o=0,duration:n=400,easing:r=t.cubicOut}){const a=getComputedStyle(e),i=+a.opacity,s=parseFloat(a.height),p=parseFloat(a.paddingTop),d=parseFloat(a.paddingBottom),c=parseFloat(a.marginTop),l=parseFloat(a.marginBottom),u=parseFloat(a.borderTopWidth),y=parseFloat(a.borderBottomWidth);return{delay:o,duration:n,easing:r,css:t=>"overflow: hidden;"+`opacity: ${Math.min(20*t,1)*i};`+`height: ${t*s}px;`+`padding-top: ${t*p}px;`+`padding-bottom: ${t*d}px;`+`margin-top: ${t*c}px;`+`margin-bottom: ${t*l}px;`+`border-top-width: ${t*u}px;`+`border-bottom-width: ${t*y}px;`}}function s(e,{delay:o=0,duration:n=400,easing:r=t.cubicOut,start:a=0,opacity:i=0}){const s=getComputedStyle(e),p=+s.opacity,d="none"===s.transform?"":s.transform,c=1-a,l=p*(1-i);return{delay:o,duration:n,easing:r,css:(t,e)=>`\n\t\t\ttransform: ${d} scale(${1-c*e});\n\t\t\topacity: ${p-l*e}\n\t\t`}}function p(e,{delay:o=0,speed:n,duration:r,easing:a=t.cubicInOut}){const i=e.getTotalLength();return void 0===r?r=void 0===n?800:i/n:"function"==typeof r&&(r=r(i)),{delay:o,duration:r,easing:a,css:(t,e)=>`stroke-dasharray: ${t*i} ${e*i}`}}function d(n){var{fallback:r}=n,a=o(n,["fallback"]);const i=new Map,s=new Map;function p(o,n,i){return(s,p)=>(o.set(p.key,{rect:s.getBoundingClientRect()}),()=>{if(n.has(p.key)){const{rect:o}=n.get(p.key);return n.delete(p.key),function(o,n,r){const{delay:i=0,duration:s=(t=>30*Math.sqrt(t)),easing:p=t.cubicOut}=(0,e.assign)((0,e.assign)({},a),r),d=n.getBoundingClientRect(),c=o.left-d.left,l=o.top-d.top,u=o.width/d.width,y=o.height/d.height,f=Math.sqrt(c*c+l*l),g=getComputedStyle(n),m="none"===g.transform?"":g.transform,x=+g.opacity;return{delay:i,duration:(0,e.is_function)(s)?s(f):s,easing:p,css:(t,e)=>`\n\t\t\t\topacity: ${t*x};\n\t\t\t\ttransform-origin: top left;\n\t\t\t\ttransform: ${m} translate(${e*c}px,${e*l}px) scale(${t+(1-t)*u}, ${t+(1-t)*y});\n\t\t\t`}}(o,s,p)}return o.delete(p.key),r&&r(s,p,i)})}return[p(s,i,!1),p(i,s,!0)]}exports.blur=n,exports.crossfade=d,exports.draw=p,exports.fade=r,exports.fly=a,exports.scale=s,exports.slide=i;
},{"../easing/index.mjs":779,"../internal/index.mjs":226}],257:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/intro.8c499120.mp4";
},{}],131:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unmountVideo=u,exports.hasVideo=a,exports.pauseVideo=l,exports.getMetadata=d,exports.getVideo=p;var e=require("../assets/video/intro.mp4"),t=o(e),i=require("./stores");function o(e){return e&&e.__esModule?e:{default:e}}let n,r,s=new Promise(e=>{r=e});function u(){n&&(console.log("pausing video"),n.pause(),n.parentElement&&n.parentElement.removeChild(n),n=null)}function a(){return Boolean(n)}function l(){n&&n.pause()}function d(){return s}function p(){return n||((n=document.createElement("video")).className="global-intro-video",n.style.visibility="hidden",n.setAttribute("src",t.default),n.setAttribute("webkit-playsinline","webkit-playsinline"),n.setAttribute("playsinline","playsinline"),n.setAttribute("preload","auto"),n.volume=.4,n.removeAttribute("controls"),n.addEventListener("loadedmetadata",r),n.load()),n}i.audioState.subscribe(({muted:e,visible:t})=>{const i=e||!t;if(a()){p().muted=i}});
},{"../assets/video/intro.mp4":257,"./stores":228}],881:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("svelte/internal"),e=require("../util/locale.js"),a=require("../assets/image/ui/ico_haiku.png"),n=u(a),i=require("../assets/image/ui/ico_haiku_leaf.png"),s=u(i),r=require("../animations/transitions.js");function u(t){return t&&t.__esModule?t:{default:t}}function l(e){let a,i,r,u,l,o,c,p,g,d,_,m,T,b,f,v=e[4].journalTitle+"";return{c(){a=(0,t.element)("div"),i=(0,t.element)("img"),u=(0,t.space)(),l=(0,t.element)("div"),o=(0,t.element)("img"),p=(0,t.space)(),g=(0,t.element)("p"),d=(0,t.text)(v),i.src!==(r=n.default)&&(0,t.attr)(i,"src",r),(0,t.attr)(i,"alt","Haiku Tag"),(0,t.attr)(i,"class","haiku-tag svelte-n0azwu"),o.src!==(c=s.default)&&(0,t.attr)(o,"src",c),(0,t.attr)(o,"alt","Haiku Tag Leaf"),(0,t.attr)(o,"class","haiku-tag-leaf svelte-n0azwu"),(0,t.attr)(g,"class","haiku-tag-text svelte-n0azwu"),(0,t.attr)(l,"class","haiku-tag-text-container svelte-n0azwu"),(0,t.attr)(a,"class","haiku-tag-container svelte-n0azwu"),(0,t.toggle_class)(a,"button",e[0]),(0,t.toggle_class)(a,"useMargin",e[3])},m(n,s){(0,t.insert)(n,a,s),(0,t.append)(a,i),(0,t.append)(a,u),(0,t.append)(a,l),(0,t.append)(l,o),(0,t.append)(l,p),(0,t.append)(l,g),(0,t.append)(g,d),T=!0,b||(f=(0,t.listen)(a,"click",e[5]),b=!0)},p(e,[n]){(!T||16&n)&&v!==(v=e[4].journalTitle+"")&&(0,t.set_data)(d,v),1&n&&(0,t.toggle_class)(a,"button",e[0]),8&n&&(0,t.toggle_class)(a,"useMargin",e[3])},i(n){T||((0,t.add_render_callback)(()=>{m&&m.end(1),_||(_=(0,t.create_in_transition)(a,e[1],{})),_.start()}),T=!0)},o(n){_&&_.invalidate(),m=(0,t.create_out_transition)(a,e[2],{}),T=!1},d(e){e&&(0,t.detach)(a),e&&m&&m.end(),b=!1,f()}}}function o(a,n,i){let s;(0,t.component_subscribe)(a,e.localize,t=>i(4,s=t));let{button:u=!0}=n,{inTransition:l=r.emptyTransition}=n,{outTransition:o=r.emptyTransition}=n,{useMargin:c=!0}=n;return a.$$set=(t=>{"button"in t&&i(0,u=t.button),"inTransition"in t&&i(1,l=t.inTransition),"outTransition"in t&&i(2,o=t.outTransition),"useMargin"in t&&i(3,c=t.useMargin)}),[u,l,o,c,s,function(e){(0,t.bubble)(a,e)}]}class c extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,o,l,t.safe_not_equal,{button:0,inTransition:1,outTransition:2,useMargin:3})}}exports.default=c;
},{"svelte/internal":226,"../util/locale.js":227,"../assets/image/ui/ico_haiku.png":497,"../assets/image/ui/ico_haiku_leaf.png":496,"../animations/transitions.js":689}],265:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./array");class t{constructor(){this._events={}}dispose(){for(let e in this._events)this._events.hasOwnProperty(e)&&delete this._events;return this}on(e,t){return e in this._events?this._events[e].push(t):this._events[e]=[t],this}once(e,t){const s=(...n)=>(this.off(e,s),t(...n));return this.on(e,s)}off(t,s){return t in this._events&&(0,e.spliceObject)(this._events[t],s),this}emit(e,t){if(e in this._events){const s=this._events[e];for(let e=0;e<s.length;e++)s[e](t)}return this}}exports.default=t;
},{"./array":139}],879:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=i;var e=require("./tiny-event"),t=n(e);function n(e){return e&&e.__esModule?e:{default:e}}function i(e){null==e&&(e=window),c(e)&&(e={target:e});const{target:n=window,parent:i=window,tapDistanceThreshold:f=10,tapDelay:l=300,preventDefault:a=!1,filtered:v=!0,passive:h=!0}=e,m=h?{passive:!0}:void 0,w=new t.default;let p,g,E,L=!1,b=!1;return _(),w.enable=_,w.disable=function(){if(!b)return;b=!1,n.removeEventListener("touchstart",y),i.removeEventListener("touchend",D),i.removeEventListener("touchmove",T),n.removeEventListener("mousedown",y),i.removeEventListener("mouseup",D),i.removeEventListener("mousemove",T),a&&(window.removeEventListener("dragstart",x),document.removeEventListener("touchmove",x))},Object.defineProperties(w,{target:{get:()=>n},parent:{get:()=>i}}),w;function y(e){L=!0;const t=j(e,M(e),n);E=t.position.slice(),g=Date.now(),console.log("down"),w.emit("down",t)}function D(e){const t=L,i=M(e);let r=!0;if(!v||!e.changedTouches||i&&i.identifier===p||(r=!1),i&&r){const r=j(e,i,n);if(p=null,(t||r.inside)&&w.emit("up",r),null!=E){const e=Date.now()-g,t=o(r.position,E);e<=l&&t<f&&w.emit("tap",r),E=null}L=!1}}function T(e){const t=M(e);if(t){if(v&&e.changedTouches&&null!=t.identifier){r(t,s(n))&&(L=!0)}const i=j(e,t,n);(L||i.inside)&&w.emit("move",i)}}function _(){b||(b=!0,n.addEventListener("touchstart",y,m),i.addEventListener("touchend",D,m),i.addEventListener("touchmove",T,m),n.addEventListener("mousedown",y,m),i.addEventListener("mouseup",D,m),i.addEventListener("mousemove",T,m),a&&(window.addEventListener("dragstart",x,{passive:!1}),document.addEventListener("touchmove",x,{passive:!1})))}function x(e){return e.preventDefault(),!1}function M(e){if(e.changedTouches){const t=e.changedTouches;if(v){if(null==p){const e=function(e){for(let t=0;t<e.length;t++){const i=e[t];if(i.target===n)return i}return null}(t)||t[0];return p=e.identifier,e}return function(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.identifier===t)return i}return null}(t,p)}return t[0]}return e}function j(e,t,n){const i=s(n),o=d(t,n,i),c=u(o,i);return{dragging:L,touch:t,inside:r(t,i),position:o,uv:c,event:e,bounds:i}}}function o(e,t){const n=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(n*n+i*i)}function r(e,t){const{clientX:n,clientY:i}=e;return n>=t.left&&n<t.right&&i>=t.top&&i<t.bottom}function u(e,t){return[e[0]/t.width,e[1]/t.height]}function d(e,t,n){const{clientX:i,clientY:o}=e;return[i-n.left,o-n.top]}function s(e){return e===window||e===document||e===document.body?{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}:e.getBoundingClientRect()}function c(e){if(!e||null==e)return!1;return e===("undefined"!=typeof window?window:null)||"number"==typeof e.nodeType&&"string"==typeof e.nodeName}
},{"./tiny-event":265}],877:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("svelte/internal"),e=require("./Image.svelte"),n=i(e);function i(t){return t&&t.__esModule?t:{default:t}}function l(e){let n,i;return{c(){n=(0,t.element)("img"),(0,t.attr)(n,"class","icon svelte-fi0yj6"),n.src!==(i=e[0])&&(0,t.attr)(n,"src",i),(0,t.attr)(n,"alt",e[4])},m(e,i){(0,t.insert)(e,n,i)},p(e,l){1&l&&n.src!==(i=e[0])&&(0,t.attr)(n,"src",i),16&l&&(0,t.attr)(n,"alt",e[4])},i:t.noop,o:t.noop,d(e){e&&(0,t.detach)(n)}}}function a(e){let i,l;return i=new n.default({props:{id:e[1],alt:e[4],image:e[2],ignorePointer:!0}}),{c(){(0,t.create_component)(i.$$.fragment)},m(e,n){(0,t.mount_component)(i,e,n),l=!0},p(t,e){const n={};2&e&&(n.id=t[1]),16&e&&(n.alt=t[4]),4&e&&(n.image=t[2]),i.$set(n)},i(e){l||((0,t.transition_in)(i.$$.fragment,e),l=!0)},o(e){(0,t.transition_out)(i.$$.fragment,e),l=!1},d(e){(0,t.destroy_component)(i,e)}}}function o(e){let n,i,o,s,r,c;const u=[a,l],d=[];function g(t,e){return t[1]||t[2]?0:t[0]?1:-1}return~(i=g(e))&&(o=d[i]=u[i](e)),{c(){n=(0,t.element)("div"),o&&o.c(),(0,t.attr)(n,"class","button svelte-fi0yj6"),(0,t.toggle_class)(n,"small",e[5]),(0,t.toggle_class)(n,"medium",e[6]),(0,t.toggle_class)(n,"large",e[7]),(0,t.toggle_class)(n,"padded",e[3])},m(l,a){(0,t.insert)(l,n,a),~i&&d[i].m(n,null),s=!0,r||(c=(0,t.listen)(n,"click",e[9]),r=!0)},p(e,[l]){let a=i;(i=g(e))===a?~i&&d[i].p(e,l):(o&&((0,t.group_outros)(),(0,t.transition_out)(d[a],1,1,()=>{d[a]=null}),(0,t.check_outros)()),~i?((o=d[i])?o.p(e,l):(o=d[i]=u[i](e)).c(),(0,t.transition_in)(o,1),o.m(n,null)):o=null),32&l&&(0,t.toggle_class)(n,"small",e[5]),64&l&&(0,t.toggle_class)(n,"medium",e[6]),128&l&&(0,t.toggle_class)(n,"large",e[7]),8&l&&(0,t.toggle_class)(n,"padded",e[3])},i(e){s||((0,t.transition_in)(o),s=!0)},o(e){(0,t.transition_out)(o),s=!1},d(e){e&&(0,t.detach)(n),~i&&d[i].d(),r=!1,c()}}}function s(e,n,i){let l,a,o,{icon:s=null}=n,{id:r=null}=n,{image:c}=n,{padded:u=!0}=n,{size:d=null}=n,{alt:g=""}=n;return e.$$set=(t=>{"icon"in t&&i(0,s=t.icon),"id"in t&&i(1,r=t.id),"image"in t&&i(2,c=t.image),"padded"in t&&i(3,u=t.padded),"size"in t&&i(8,d=t.size),"alt"in t&&i(4,g=t.alt)}),e.$$.update=(()=>{256&e.$$.dirty&&(i(5,l=i(6,a=i(7,o=!1))),"small"===d?i(5,l=!0):"large"===d?i(7,o=!0):i(6,a=!0))}),[s,r,c,u,g,l,a,o,d,function(n){(0,t.bubble)(e,n)}]}class r extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,s,o,t.safe_not_equal,{icon:0,id:1,image:2,padded:3,size:8,alt:4})}}exports.default=r;
},{"svelte/internal":226,"./Image.svelte":690}],847:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),t=require("../util/tokens"),n=require("../assets/image/ui/ico_paperJournal1-rotated.png"),a=l(n),r=require("../util/locale"),i=require("svelte"),s=require("../animations/transitions");function l(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n){const a=e.slice();return a[5]=t[n],a[7]=n,a}function c(e,t,n){const a=e.slice();return a[8]=t[n],a[7]=n,a}function d(n){let a,r,i,s,l;return{c(){a=(0,e.element)("div"),r=(0,e.element)("img"),s=(0,e.space)(),r.src!==(i=t.InvertedTokenURLs[n[8]])&&(0,e.attr)(r,"src",i),(0,e.attr)(r,"alt",""),(0,e.attr)(r,"class","token-image svelte-wamszv"),(0,e.attr)(a,"class","token svelte-wamszv")},m(t,n){(0,e.insert)(t,a,n),(0,e.append)(a,r),(0,e.append)(a,s)},p(n,a){2&a&&r.src!==(i=t.InvertedTokenURLs[n[8]])&&(0,e.attr)(r,"src",i)},i(t){l||(0,e.add_render_callback)(()=>{(l=(0,e.create_in_transition)(a,n[2],{delay:175+175*n[7]+250,duration:1e3})).start()})},o:e.noop,d(t){t&&(0,e.detach)(a)}}}function u(t){let n,a,r,i,s=t[5][t[3]]+"";return{c(){n=(0,e.element)("p"),a=(0,e.text)(s),r=(0,e.space)(),(0,e.attr)(n,"class","svelte-wamszv")},m(t,i){(0,e.insert)(t,n,i),(0,e.append)(n,a),(0,e.append)(n,r)},p(t,n){9&n&&s!==(s=t[5][t[3]]+"")&&(0,e.set_data)(a,s)},i(a){i||(0,e.add_render_callback)(()=>{(i=(0,e.create_in_transition)(n,t[2],{delay:175+175*(4+t[7])+250,duration:1e3})).start()})},o:e.noop,d(t){t&&(0,e.detach)(n)}}}function p(t){let n,r,i,l,p,m,_,f=t[1],g=[];for(let e=0;e<f.length;e+=1)g[e]=d(c(t,f,e));let v=t[0],h=[];for(let e=0;e<v.length;e+=1)h[e]=u(o(t,v,e));return{c(){n=(0,e.element)("div"),r=(0,e.element)("div");for(let e=0;e<g.length;e+=1)g[e].c();i=(0,e.space)(),l=(0,e.element)("div");for(let e=0;e<h.length;e+=1)h[e].c();(0,e.attr)(r,"class","token-container svelte-wamszv"),(0,e.attr)(l,"class","lines-container svelte-wamszv"),(0,e.attr)(n,"class","container svelte-wamszv"),(0,e.set_style)(n,"background-image","url("+a.default+")")},m(t,a){(0,e.insert)(t,n,a),(0,e.append)(n,r);for(let e=0;e<g.length;e+=1)g[e].m(r,null);(0,e.append)(n,i),(0,e.append)(n,l);for(let e=0;e<h.length;e+=1)h[e].m(l,null);_=!0},p(t,[n]){if(2&n){let a;for(f=t[1],a=0;a<f.length;a+=1){const i=c(t,f,a);g[a]?(g[a].p(i,n),(0,e.transition_in)(g[a],1)):(g[a]=d(i),g[a].c(),(0,e.transition_in)(g[a],1),g[a].m(r,null))}for(;a<g.length;a+=1)g[a].d(1);g.length=f.length}if(9&n){let a;for(v=t[0],a=0;a<v.length;a+=1){const r=o(t,v,a);h[a]?(h[a].p(r,n),(0,e.transition_in)(h[a],1)):(h[a]=u(r),h[a].c(),(0,e.transition_in)(h[a],1),h[a].m(l,null))}for(;a<h.length;a+=1)h[a].d(1);h.length=v.length}},i(t){if(!_){for(let t=0;t<f.length;t+=1)(0,e.transition_in)(g[t]);for(let t=0;t<v.length;t+=1)(0,e.transition_in)(h[t]);(0,e.add_render_callback)(()=>{m&&m.end(1),p||(p=(0,e.create_in_transition)(n,s.fadeTransition,{delay:500,duration:500})),p.start()}),_=!0}},o(t){p&&p.invalidate(),m=(0,e.create_out_transition)(n,s.fadeTransition,{duration:250}),_=!1},d(t){t&&(0,e.detach)(n),(0,e.destroy_each)(g,t),(0,e.destroy_each)(h,t),t&&m&&m.end()}}}function m(e,t,n){let a,{lines:l}=t,{tokens:o}=t,{animatePoem:c=!1}=t,d=r.language.get();return(0,i.onMount)(()=>{const e=r.language.subscribe(e=>{n(3,d=e)});return()=>{e()}}),e.$$set=(e=>{"lines"in e&&n(0,l=e.lines),"tokens"in e&&n(1,o=e.tokens),"animatePoem"in e&&n(4,c=e.animatePoem)}),e.$$.update=(()=>{16&e.$$.dirty&&n(2,a=c?s.fadeInTransition:s.emptyTransition)}),[l,o,a,d,c]}class _ extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,m,p,e.safe_not_equal,{lines:0,tokens:1,animatePoem:4})}}exports.default=_;
},{"svelte/internal":226,"../util/tokens":138,"../assets/image/ui/ico_paperJournal1-rotated.png":502,"../util/locale":227,"svelte":220,"../animations/transitions":689}],707:[function(require,module,exports) {
!function(){var e={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},t={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},i="[aeiouy]",s="[^aeiou][^aeiouy]*",n=i+"[aeiou]*",a="^("+s+")?"+n+s,l="^("+s+")?"+n+s+"("+n+")?$",o="^("+s+")?"+n+s+n+s,c="^("+s+")?"+i;function r(n){var r,u,x,p,$,g,w;if(n.length<3)return n;if("y"==(x=n.substr(0,1))&&(n=x.toUpperCase()+n.substr(1)),$=/^(.+?)([^s])s$/,(p=/^(.+?)(ss|i)es$/).test(n)?n=n.replace(p,"$1$2"):$.test(n)&&(n=n.replace($,"$1$2")),$=/^(.+?)(ed|ing)$/,(p=/^(.+?)eed$/).test(n)){var f=p.exec(n);(p=new RegExp(a)).test(f[1])&&(p=/.$/,n=n.replace(p,""))}else if($.test(n)){r=(f=$.exec(n))[1],($=new RegExp(c)).test(r)&&(n=r,$=/(at|bl|iz)$/,g=new RegExp("([^aeiouylsz])\\1$"),w=new RegExp("^"+s+i+"[^aeiouwxy]$"),$.test(n)?n+="e":g.test(n)?(p=/.$/,n=n.replace(p,"")):w.test(n)&&(n+="e"))}(p=/^(.+?)y$/).test(n)&&(r=(f=p.exec(n))[1],(p=new RegExp(c)).test(r)&&(n=r+"i"));(p=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/).test(n)&&(r=(f=p.exec(n))[1],u=f[2],(p=new RegExp(a)).test(r)&&(n=r+e[u]));(p=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/).test(n)&&(r=(f=p.exec(n))[1],u=f[2],(p=new RegExp(a)).test(r)&&(n=r+t[u]));if($=/^(.+?)(s|t)(ion)$/,(p=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/).test(n))r=(f=p.exec(n))[1],(p=new RegExp(o)).test(r)&&(n=r);else if($.test(n)){r=(f=$.exec(n))[1]+f[2],($=new RegExp(o)).test(r)&&(n=r)}(p=/^(.+?)e$/).test(n)&&(r=(f=p.exec(n))[1],p=new RegExp(o),$=new RegExp(l),g=new RegExp("^"+s+i+"[^aeiouwxy]$"),(p.test(r)||$.test(r)&&!g.test(r))&&(n=r));return p=/ll$/,$=new RegExp(o),p.test(n)&&$.test(n)&&(p=/.$/,n=n.replace(p,"")),"y"==x&&(n=x.toLowerCase()+n.substr(1)),n}var u={};"undefined"!=typeof exports&&null!=exports&&(exports.stemmer=r,exports.memoizingStemmer=function(e){return u[e]||(u[e]=r(e)),u[e]})}();
},{}],276:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=f;var e=require("../util/Random"),t=i(e),n=require("../assets/json/haiku-phrases-en.json"),r=i(n),s=require("../assets/json/haiku-phrases-fr.json"),a=i(s),o=require("porter-stemmer");function i(e){return e&&e.__esModule?e:{default:e}}const l=e=>e.replace(/\'[a-z]+/g,"").replace(/\-/g," ").split(/\s+/g).filter(Boolean),u="of,the,on,for,and,in,a,from,at".split(",").map(e=>(0,o.stemmer)(e));function f(){const e=r.default,n=(0,t.default)(),s=Object.keys(e);return{generate({tokens:e,ignore:t=[]}={}){e=e||this.randomTokens();let n=[];return e.forEach((e,r)=>{const s=this.generateStanza({token:e,stanza:r,state:n,ignore:t});n.push(s)}),n},randomTokens:()=>n.shuffle(s).slice(0,3),generateStanza:({stanza:e,token:t,state:n=[],ignore:r=[]})=>({en:i({lang:"en",stanza:e,token:t,state:n.map(e=>e.en),ignore:r.map(e=>e.en)}),fr:i({lang:"fr",stanza:e,token:t})})};function i({lang:e="en",stanza:t,token:s,state:i=[],ignore:c=[]}){if(null==t||t<0&&t>2)throw new Error("Must specify stanza index 0, 1 or 2 ");if(!s)throw new Error("Must specify token");const p="en"===e?r.default:a.default;if(!(s in p))throw new Error(`No haiku data for token ${s}`);const d=p[s][t].map(e=>e.trim()),g=l(i.join(" ")).map(e=>(0,o.stemmer)(e)),h=g.filter(e=>!u.includes(e));let m=d.slice();g.length&&(m=f(m,e=>!h.some(t=>e.includes(t)),2));const k=c.flat();m.slice();return m=(m=f(m,e=>!k.includes(e),2)).length>=2?m:d,n.pick(m)}function f(e,t,n=1){const r=e.filter(t);return r.length>n?r:e}}
},{"../util/Random":235,"../assets/json/haiku-phrases-en.json":346,"../assets/json/haiku-phrases-fr.json":347,"porter-stemmer":707}],880:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),t=require("svelte"),n=require("../animations/transitions"),a=require("../components/Image.svelte"),i=r(a);function r(e){return e&&e.__esModule?e:{default:e}}function o(t){let a,r,o,s,l,u,d;return r=new i.default({props:{width:"100%",id:"image/ui/close-button"}}),{c(){a=(0,e.element)("div"),(0,e.create_component)(r.$$.fragment),(0,e.attr)(a,"class","close-button svelte-d162at")},m(n,i){(0,e.insert)(n,a,i),(0,e.mount_component)(r,a,null),l=!0,u||(d=(0,e.listen)(a,"click",t[1]),u=!0)},p(e,[n]){t=e},i(i){l||((0,e.transition_in)(r.$$.fragment,i),(0,e.add_render_callback)(()=>{s&&s.end(1),o||(o=(0,e.create_in_transition)(a,n.fadeInTransition,{delay:t[0],duration:100})),o.start()}),l=!0)},o(i){(0,e.transition_out)(r.$$.fragment,i),o&&o.invalidate(),s=(0,e.create_out_transition)(a,n.fadeInTransition,{delay:t[0],duration:100}),l=!1},d(t){t&&(0,e.detach)(a),(0,e.destroy_component)(r),t&&s&&s.end(),u=!1,d()}}}function s(t,n,a){let{delay:i=0}=n;return t.$$set=(e=>{"delay"in e&&a(0,i=e.delay)}),[i,function(n){(0,e.bubble)(t,n)}]}class l extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,s,o,e.safe_not_equal,{delay:0})}}exports.default=l;
},{"svelte/internal":226,"svelte":220,"../animations/transitions":689,"../components/Image.svelte":690}],772:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),t=require("../util/math"),n=H(t),o=require("../util/tiny-input"),r=z(o),l=require("../util/tokens"),i=require("svelte/transition"),s=require("svelte"),a=require("../util/locale.js"),c=require("../components/IconButton.svelte"),u=z(c),p=require("../assets/image/ui/ico_scrollbar.png"),d=z(p),g=require("../assets/image/ui/ico_toggle.png"),m=z(g),f=require("../assets/image/ui/ico_openjournal.png"),_=z(f),v=require("../components/HaikuCard.svelte"),h=z(v),$=require("../util/haikugen"),w=z($),b=require("../components/CloseButton.svelte"),q=z(b),k=require("../components/PoemTagButton.svelte"),y=z(k);function z(e){return e&&e.__esModule?e:{default:e}}function H(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function P(e,t,n){const o=e.slice();return o[15]=t[n],o[17]=n,o}function j(t){let n,o;return n=new h.default({props:{tokens:t[15].tokens,lines:t[15].lines}}),{c(){(0,e.create_component)(n.$$.fragment)},m(t,r){(0,e.mount_component)(n,t,r),o=!0},p(e,t){const o={};2&t&&(o.tokens=e[15].tokens),2&t&&(o.lines=e[15].lines),n.$set(o)},i(t){o||((0,e.transition_in)(n.$$.fragment,t),o=!0)},o(t){(0,e.transition_out)(n.$$.fragment,t),o=!1},d(t){(0,e.destroy_component)(n,t)}}}function x(t){let n,o,r,l,s,a,c,u,p,g,f,_,v,h,$,w,b,k;r=new y.default({props:{button:!1}});let z=t[1],H=[];for(let e=0;e<z.length;e+=1)H[e]=j(P(t,z,e));const x=t=>(0,e.transition_out)(H[t],1,1,()=>{H[t]=null});return(c=new q.default({})).$on("click",t[8]),{c(){n=(0,e.element)("div"),o=(0,e.element)("div"),(0,e.create_component)(r.$$.fragment),l=(0,e.space)(),s=(0,e.element)("div");for(let e=0;e<H.length;e+=1)H[e].c();a=(0,e.space)(),(0,e.create_component)(c.$$.fragment),u=(0,e.space)(),p=(0,e.element)("div"),g=(0,e.element)("div"),f=(0,e.element)("div"),_=(0,e.element)("img"),(0,e.attr)(s,"class","poem-collection-container svelte-1iw8zw5"),(0,e.attr)(o,"class","scroller svelte-1iw8zw5"),_.src!==(v=m.default)&&(0,e.attr)(_,"src",v),(0,e.attr)(_,"alt",""),(0,e.attr)(_,"draggable",h=!1),(0,e.attr)(_,"class","svelte-1iw8zw5"),(0,e.attr)(f,"class","scrollbar-trackbar-thumb svelte-1iw8zw5"),(0,e.set_style)(f,"top",t[4]),(0,e.attr)(g,"class","scrollbar-trackbar svelte-1iw8zw5"),(0,e.set_style)(g,"background-image","url("+d.default+")"),(0,e.attr)(p,"class","scrollbar-container svelte-1iw8zw5"),(0,e.toggle_class)(p,"hideScrollbar",t[2]),(0,e.attr)(n,"class","container svelte-1iw8zw5"),(0,e.toggle_class)(n,"modal",t[0]),(0,e.toggle_class)(n,"ignorePointer",t[3])},m(i,d){(0,e.insert)(i,n,d),(0,e.append)(n,o),(0,e.mount_component)(r,o,null),(0,e.append)(o,l),(0,e.append)(o,s);for(let e=0;e<H.length;e+=1)H[e].m(s,null);t[9](o),(0,e.append)(n,a),(0,e.mount_component)(c,n,null),(0,e.append)(n,u),(0,e.append)(n,p),(0,e.append)(p,g),(0,e.append)(g,f),(0,e.append)(f,_),t[10](g),w=!0,b||(k=(0,e.listen)(o,"scroll",t[7]),b=!0)},p(t,[o]){if(2&o){let n;for(z=t[1],n=0;n<z.length;n+=1){const r=P(t,z,n);H[n]?(H[n].p(r,o),(0,e.transition_in)(H[n],1)):(H[n]=j(r),H[n].c(),(0,e.transition_in)(H[n],1),H[n].m(s,null))}for((0,e.group_outros)(),n=z.length;n<H.length;n+=1)x(n);(0,e.check_outros)()}(!w||16&o)&&(0,e.set_style)(f,"top",t[4]),4&o&&(0,e.toggle_class)(p,"hideScrollbar",t[2]),1&o&&(0,e.toggle_class)(n,"modal",t[0]),8&o&&(0,e.toggle_class)(n,"ignorePointer",t[3])},i(t){if(!w){(0,e.transition_in)(r.$$.fragment,t);for(let t=0;t<z.length;t+=1)(0,e.transition_in)(H[t]);(0,e.transition_in)(c.$$.fragment,t),(0,e.add_render_callback)(()=>{$||($=(0,e.create_bidirectional_transition)(n,i.fade,{duration:500},!0)),$.run(1)}),w=!0}},o(t){(0,e.transition_out)(r.$$.fragment,t),H=H.filter(Boolean);for(let t=0;t<H.length;t+=1)(0,e.transition_out)(H[t]);(0,e.transition_out)(c.$$.fragment,t),$||($=(0,e.create_bidirectional_transition)(n,i.fade,{duration:500},!1)),$.run(0),w=!1},d(o){o&&(0,e.detach)(n),(0,e.destroy_component)(r),(0,e.destroy_each)(H,o),t[9](null),(0,e.destroy_component)(c),t[10](null),o&&$&&$.end(),b=!1,k()}}}let B=!1;function C(t,o,l){let{modal:i=!1}=o,{poems:a=[]}=o;const c=(0,s.createEventDispatcher)();let u,p,d=!1,g=!1,m="0%";function f(){_()}function _(){if(!u)return;const e=u.scrollTop/(u.scrollHeight-u.clientHeight);l(4,m=`${(100*e).toFixed(5)}%`),l(2,d=!(u.scrollHeight>u.clientHeight))}return(0,s.onMount)(()=>{l(3,g=!1),_(),window.addEventListener("resize",f,{passive:!0});const e=function(e){const t=(0,r.default)({target:e,parent:window});return t.on("down",o).on("up",o).on("move",o),()=>{t.disable()};function o(e){e.dragging&&u&&function(e){const t=(e=n.clamp01(e))*(u.scrollHeight-u.clientHeight);l(5,u.scrollTop=t,u)}(e.uv[1])}}(p);return()=>{e(),window.removeEventListener("resize",f)}}),t.$$set=(e=>{"modal"in e&&l(0,i=e.modal),"poems"in e&&l(1,a=e.poems)}),t.$$.update=(()=>{2&t.$$.dirty&&l(3,g=!1)}),[i,a,d,g,m,u,p,_,function(){l(3,g=!0),c("close"),console.log("Poems Collection closed")},function(t){e.binding_callbacks[t?"unshift":"push"](()=>{l(5,u=t)})},function(t){e.binding_callbacks[t?"unshift":"push"](()=>{l(6,p=t)})}]}class M extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,C,x,e.safe_not_equal,{modal:0,poems:1})}}exports.default=M;
},{"svelte/internal":226,"../util/math":240,"../util/tiny-input":879,"../util/tokens":138,"svelte/transition":687,"svelte":220,"../util/locale.js":227,"../components/IconButton.svelte":877,"../assets/image/ui/ico_scrollbar.png":510,"../assets/image/ui/ico_toggle.png":511,"../assets/image/ui/ico_openjournal.png":501,"../components/HaikuCard.svelte":847,"../util/haikugen":276,"../components/CloseButton.svelte":880,"../components/PoemTagButton.svelte":881}],769:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("svelte/internal"),e=require("../assets/image/ui/ico_resume.png"),n=x(e),a=require("../components/ImageButton.svelte"),o=x(a),i=require("../components/Image.svelte"),r=x(i),s=require("../nfb"),l=require("svelte/store"),c=require("../animations/transitions"),d=require("svelte"),u=require("svelte/transition"),p=require("../util/Assets"),m=x(p),_=require("../util/stores"),f=require("../util/locale.js"),g=require("../util/globalIntroVideo"),v=require("../alec-svelte"),$=require("../components/PoemTagButton.svelte"),y=x($),h=require("./PoemCollectionOverlay.svelte"),b=x(h);function x(t){return t&&t.__esModule?t:{default:t}}function T(e){let n,a,o,i,r,s,l,d=e[9].introBlurbOne+"",u=e[9].introBlurbTwo+"";return{c(){n=(0,t.element)("p"),a=(0,t.text)(d),i=(0,t.space)(),r=(0,t.element)("p"),s=(0,t.text)(u),(0,t.attr)(n,"class","svelte-h4m3ya"),(0,t.attr)(r,"class","svelte-h4m3ya")},m(e,o){(0,t.insert)(e,n,o),(0,t.append)(n,a),(0,t.insert)(e,i,o),(0,t.insert)(e,r,o),(0,t.append)(r,s)},p(n,o){e=n,512&o&&d!==(d=e[9].introBlurbOne+"")&&(0,t.set_data)(a,d),512&o&&u!==(u=e[9].introBlurbTwo+"")&&(0,t.set_data)(s,u)},i(a){o||(0,t.add_render_callback)(()=>{(o=(0,t.create_in_transition)(n,c.fadeInTransition,{delay:e[11]+e[10],index:1})).start()}),l||(0,t.add_render_callback)(()=>{(l=(0,t.create_in_transition)(r,c.fadeInTransition,{delay:e[11]+e[10],index:2})).start()})},o:t.noop,d(e){e&&(0,t.detach)(n),e&&(0,t.detach)(i),e&&(0,t.detach)(r)}}}function q(e){let n,a,o,i=e[4]&&k(e),r=e[5]&&I(e);return{c(){i&&i.c(),n=(0,t.space)(),r&&r.c(),a=(0,t.empty)()},m(e,s){i&&i.m(e,s),(0,t.insert)(e,n,s),r&&r.m(e,s),(0,t.insert)(e,a,s),o=!0},p(e,o){e[4]?i?(i.p(e,o),16&o&&(0,t.transition_in)(i,1)):((i=k(e)).c(),(0,t.transition_in)(i,1),i.m(n.parentNode,n)):i&&((0,t.group_outros)(),(0,t.transition_out)(i,1,1,()=>{i=null}),(0,t.check_outros)()),e[5]?r?(r.p(e,o),32&o&&(0,t.transition_in)(r,1)):((r=I(e)).c(),(0,t.transition_in)(r,1),r.m(a.parentNode,a)):r&&(r.d(1),r=null)},i(e){o||((0,t.transition_in)(i),(0,t.transition_in)(r),o=!0)},o(e){(0,t.transition_out)(i),o=!1},d(e){i&&i.d(e),e&&(0,t.detach)(n),r&&r.d(e),e&&(0,t.detach)(a)}}}function k(e){let n,a,o,i,r,s,l,d,u,p,m,_,f=e[9].endState0+"",g=e[9].endState1+"";return{c(){n=(0,t.element)("div"),a=(0,t.element)("p"),o=(0,t.element)("strong"),i=(0,t.text)(f),r=(0,t.space)(),s=(0,t.element)("p"),l=(0,t.text)(g),(0,t.attr)(a,"class","svelte-h4m3ya"),(0,t.attr)(s,"class","svelte-h4m3ya"),(0,t.attr)(n,"class","paper-text")},m(c,d){(0,t.insert)(c,n,d),(0,t.append)(n,a),(0,t.append)(a,o),(0,t.append)(o,i),(0,t.append)(n,r),(0,t.append)(n,s),(0,t.append)(s,l),p=!0,m||(_=[(0,t.listen)(n,"introend",e[15]),(0,t.listen)(n,"outroend",e[16])],m=!0)},p(n,a){e=n,(!p||512&a)&&f!==(f=e[9].endState0+"")&&(0,t.set_data)(i,f),(!p||512&a)&&g!==(g=e[9].endState1+"")&&(0,t.set_data)(l,g)},i(a){p||((0,t.add_render_callback)(()=>{u&&u.end(1),d||(d=(0,t.create_in_transition)(n,c.fadeInTransition,{delay:e[10],duration:500,index:1})),d.start()}),p=!0)},o(a){d&&d.invalidate(),u=(0,t.create_out_transition)(n,c.fadeInTransition,{delay:e[10]+5e3,duration:250}),p=!1},d(e){e&&(0,t.detach)(n),e&&u&&u.end(),m=!1,(0,t.run_all)(_)}}}function I(e){let n,a,o,i=e[9].endState2+"";return{c(){n=(0,t.element)("div"),a=(0,t.element)("p"),(0,t.attr)(a,"class","svelte-h4m3ya"),(0,t.attr)(n,"class","paper-text")},m(e,o){(0,t.insert)(e,n,o),(0,t.append)(n,a),a.innerHTML=i},p(t,n){e=t,512&n&&i!==(i=e[9].endState2+"")&&(a.innerHTML=i)},i(a){o||(0,t.add_render_callback)(()=>{(o=(0,t.create_in_transition)(n,c.fadeInTransition,{delay:e[10],duration:500,index:1})).start()})},o:t.noop,d(e){e&&(0,t.detach)(n)}}}function S(e){let a,i;return(a=new o.default({props:{inTransition:(0,c.transition)(c.fadeInTransition,{delay:e[11]+e[10],index:3}),icon:n.default,text:e[9].resumeButton,alt:"Resume experience"}})).$on("click",e[19]),{c(){(0,t.create_component)(a.$$.fragment)},m(e,n){(0,t.mount_component)(a,e,n),i=!0},p(t,e){const n={};512&e&&(n.text=t[9].resumeButton),a.$set(n)},i(e){i||((0,t.transition_in)(a.$$.fragment,e),i=!0)},o(e){(0,t.transition_out)(a.$$.fragment,e),i=!1},d(e){(0,t.destroy_component)(a,e)}}}function B(e){let a,i;return(a=new o.default({props:{inTransition:(0,c.transition)(c.fadeInTransition,{delay:e[11]+e[10],index:3}),icon:n.default,text:e[9].startButton,alt:"Start experience"}})).$on("click",e[18]),{c(){(0,t.create_component)(a.$$.fragment)},m(e,n){(0,t.mount_component)(a,e,n),i=!0},p(t,e){const n={};512&e&&(n.text=t[9].startButton),a.$set(n)},i(e){i||((0,t.transition_in)(a.$$.fragment,e),i=!0)},o(e){(0,t.transition_out)(a.$$.fragment,e),i=!1},d(e){(0,t.destroy_component)(a,e)}}}function P(e){let n,a;return(n=new y.default({props:{useMargin:!1,button:!0,inTransition:(0,c.transition)(c.fadeInTransition,{delay:e[11]+e[10],index:3}),alt:"Poems"}})).$on("click",e[17]),{c(){(0,t.create_component)(n.$$.fragment)},m(e,o){(0,t.mount_component)(n,e,o),a=!0},p:t.noop,i(e){a||((0,t.transition_in)(n.$$.fragment,e),a=!0)},o(e){(0,t.transition_out)(n.$$.fragment,e),a=!1},d(e){(0,t.destroy_component)(n,e)}}}function w(e){let n,a;return(n=new b.default({props:{poems:e[2],modal:!0}})).$on("close",e[23]),{c(){(0,t.create_component)(n.$$.fragment)},m(e,o){(0,t.mount_component)(n,e,o),a=!0},p(t,e){const a={};4&e&&(a.poems=t[2]),n.$set(a)},i(e){a||((0,t.transition_in)(n.$$.fragment,e),a=!0)},o(e){(0,t.transition_out)(n.$$.fragment,e),a=!1},d(e){(0,t.destroy_component)(n,e)}}}function M(e){let n,a,i,s,l,d,u,p,m,_,f,g,v,$,y,h,b,x,k,I,M,F,O,E,j,H,L;u=new r.default({props:{id:`image/ui/title2_${e[8]}`}});const A=[q,T],D=[];function N(t,e){return t[1]?0:1}f=N(e),g=D[f]=A[f](e);const C=[P,B,S],V=[];function z(t,e){return t[1]?0:t[0]?1:2}h=z(e),b=V[h]=C[h](e),(I=new o.default({props:{inTransition:(0,c.transition)(c.fadeInTransition,{delay:e[11]+e[10],index:4}),text:e[9].aboutButton,mode:"dark",alt:"About"}})).$on("click",e[20]);let R=e[6]&&w(e);return{c(){n=(0,t.element)("div"),(a=(0,t.element)("section")).innerHTML='<div class="top-buttons svelte-h4m3ya"><div class="top-left-container svelte-h4m3ya"></div> \n      <div class="top-center-container"></div> \n      <div class="top-right-container svelte-h4m3ya"></div></div>',i=(0,t.space)(),s=(0,t.element)("section"),l=(0,t.element)("div"),d=(0,t.element)("div"),(0,t.create_component)(u.$$.fragment),m=(0,t.space)(),_=(0,t.element)("div"),g.c(),v=(0,t.space)(),$=(0,t.element)("div"),y=(0,t.element)("div"),b.c(),x=(0,t.space)(),k=(0,t.element)("div"),(0,t.create_component)(I.$$.fragment),O=(0,t.space)(),R&&R.c(),E=(0,t.empty)(),(0,t.attr)(a,"class","top fake-nav svelte-h4m3ya"),(0,t.attr)(d,"class","wayfinder-placeholder svelte-h4m3ya"),(0,t.toggle_class)(d,"ignorePointer",e[7]),(0,t.attr)(_,"class","description-container svelte-h4m3ya"),(0,t.toggle_class)(_,"endState",e[1]),(0,t.attr)(y,"class","game-buttons svelte-h4m3ya"),(0,t.attr)(k,"class","about-container svelte-h4m3ya"),(0,t.attr)($,"class","button-container svelte-h4m3ya"),(0,t.attr)(l,"class","wayfinder-container svelte-h4m3ya"),(0,t.attr)(s,"class","main-content svelte-h4m3ya"),(0,t.attr)(n,"class","container svelte-h4m3ya"),(0,t.toggle_class)(n,"ignorePointer",e[7])},m(o,r){(0,t.insert)(o,n,r),(0,t.append)(n,a),(0,t.append)(n,i),(0,t.append)(n,s),(0,t.append)(s,l),(0,t.append)(l,d),(0,t.mount_component)(u,d,null),(0,t.append)(l,m),(0,t.append)(l,_),D[f].m(_,null),(0,t.append)(l,v),(0,t.append)(l,$),(0,t.append)($,y),V[h].m(y,null),(0,t.append)($,x),(0,t.append)($,k),(0,t.mount_component)(I,k,null),(0,t.insert)(o,O,r),R&&R.m(o,r),(0,t.insert)(o,E,r),j=!0,H||(L=[(0,t.listen)(n,"introstart",e[21]),(0,t.listen)(n,"outrostart",e[22])],H=!0)},p(a,[o]){e=a;const i={};256&o&&(i.id=`image/ui/title2_${e[8]}`),u.$set(i),128&o&&(0,t.toggle_class)(d,"ignorePointer",e[7]);let r=f;(f=N(e))===r?D[f].p(e,o):((0,t.group_outros)(),(0,t.transition_out)(D[r],1,1,()=>{D[r]=null}),(0,t.check_outros)(),(g=D[f])?g.p(e,o):(g=D[f]=A[f](e)).c(),(0,t.transition_in)(g,1),g.m(_,null)),2&o&&(0,t.toggle_class)(_,"endState",e[1]);let s=h;(h=z(e))===s?V[h].p(e,o):((0,t.group_outros)(),(0,t.transition_out)(V[s],1,1,()=>{V[s]=null}),(0,t.check_outros)(),(b=V[h])?b.p(e,o):(b=V[h]=C[h](e)).c(),(0,t.transition_in)(b,1),b.m(y,null));const l={};512&o&&(l.text=e[9].aboutButton),I.$set(l),128&o&&(0,t.toggle_class)(n,"ignorePointer",e[7]),e[6]?R?(R.p(e,o),64&o&&(0,t.transition_in)(R,1)):((R=w(e)).c(),(0,t.transition_in)(R,1),R.m(E.parentNode,E)):R&&((0,t.group_outros)(),(0,t.transition_out)(R,1,1,()=>{R=null}),(0,t.check_outros)())},i(a){j||((0,t.transition_in)(u.$$.fragment,a),p||(0,t.add_render_callback)(()=>{(p=(0,t.create_in_transition)(d,c.fadeInTransition,{duration:e[3]?2500:void 0,delay:e[11]})).start()}),(0,t.transition_in)(g),(0,t.transition_in)(b),(0,t.transition_in)(I.$$.fragment,a),(0,t.add_render_callback)(()=>{F&&F.end(1),M||(M=(0,t.create_in_transition)(n,c.fadeOpacityTransition,{})),M.start()}),(0,t.transition_in)(R),j=!0)},o(a){(0,t.transition_out)(u.$$.fragment,a),(0,t.transition_out)(g),(0,t.transition_out)(b),(0,t.transition_out)(I.$$.fragment,a),M&&M.invalidate(),F=(0,t.create_out_transition)(n,c.fadeOpacityTransition,{duration:e[0]?1e3:void 0,delay:0}),(0,t.transition_out)(R),j=!1},d(e){e&&(0,t.detach)(n),(0,t.destroy_component)(u),D[f].d(),V[h].d(),(0,t.destroy_component)(I),e&&F&&F.end(),e&&(0,t.detach)(O),R&&R.d(e),e&&(0,t.detach)(E),H=!1,(0,t.run_all)(L)}}}function F(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():"function"==typeof document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen(),console.log("Fullscreen requested")}function O(){console.log("restart requested")}function E(e,n,a){let o;(0,t.component_subscribe)(e,f.localize,t=>a(9,o=t));const i=(0,d.createEventDispatcher)();let r,{start:c=!0}=n,{endState:u=!1}=n,{poems:p=[]}=n,{introTitle:m=!1}=n,v=!0,$=!1,y=!1,h=!1;const b=f.language.subscribe(t=>{a(8,r=t)});(0,d.onMount)(()=>((0,s.revealHeader)(),a(7,h=!1),()=>{b()}));let x=m?1e3:0,T=u?2500:0;document.documentElement.requestFullscreen;function q(t){t&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()),i("play")}function k(t){t&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()),i("play");const e=(0,g.getVideo)(),n=(0,l.get)(_.audioState).muted;e.muted=n,e.play()}function I(){i("about")}return e.$$set=(t=>{"start"in t&&a(0,c=t.start),"endState"in t&&a(1,u=t.endState),"poems"in t&&a(2,p=t.poems),"introTitle"in t&&a(3,m=t.introTitle)}),e.$$.update=(()=>{1&e.$$.dirty&&a(7,h=!1)}),[c,u,p,m,v,$,y,h,r,o,x,T,q,k,I,()=>{a(4,v=!1)},()=>{a(5,$=!0)},t=>{(0,s.sendAnalytics)({event:"journal_open",eventLabel:"journal_open"}),a(6,y=!0)},t=>k(t),t=>q(t),()=>I(),()=>{a(7,h=!1)},()=>{a(7,h=!0)},()=>{a(6,y=!1)}]}class j extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,E,M,t.safe_not_equal,{start:0,endState:1,poems:2,introTitle:3})}}exports.default=j;
},{"svelte/internal":226,"../assets/image/ui/ico_resume.png":509,"../components/ImageButton.svelte":739,"../components/Image.svelte":690,"../nfb":75,"svelte/store":310,"../animations/transitions":689,"svelte":220,"svelte/transition":687,"../util/Assets":31,"../util/stores":228,"../util/locale.js":227,"../util/globalIntroVideo":131,"../alec-svelte":225,"../components/PoemTagButton.svelte":881,"./PoemCollectionOverlay.svelte":772}],771:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),t=require("svelte"),n=require("../alec-svelte"),a=require("../util/locale"),o=require("../animations/transitions"),r=require("../tags"),l=u(r),s=require("../components/Image.svelte"),p=c(s),i=require("../components/CloseButton.svelte"),d=c(i);function c(e){return e&&e.__esModule?e:{default:e}}function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function m(e,t,n){const a=e.slice();return a[8]=t[n],a}function f(e,t,n){const a=e.slice();return a[11]=t[n],a[13]=n,a}function _(t){let n,a=t[8],o=[];for(let e=0;e<a.length;e+=1)o[e]=y(f(t,a,e));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();n=(0,e.empty)()},m(t,a){for(let e=0;e<o.length;e+=1)o[e].m(t,a);(0,e.insert)(t,n,a)},p(e,t){if(8&t){let r;for(a=e[8],r=0;r<a.length;r+=1){const l=f(e,a,r);o[r]?o[r].p(l,t):(o[r]=y(l),o[r].c(),o[r].m(n.parentNode,n))}for(;r<o.length;r+=1)o[r].d(1);o.length=a.length}},i:e.noop,o:e.noop,d(t){(0,e.destroy_each)(o,t),t&&(0,e.detach)(n)}}}function g(t){let n,a=t[8].html+"";return{c(){n=(0,e.element)("p"),(0,e.attr)(n,"class","svelte-48fouy"),(0,e.toggle_class)(n,"isTitle",!0)},m(t,o){(0,e.insert)(t,n,o),n.innerHTML=a},p:e.noop,i:e.noop,o:e.noop,d(t){t&&(0,e.detach)(n)}}}function v(t){let n,a,o;return a=new p.default({props:{width:"100%",id:"image/ui/ico_about"}}),{c(){n=(0,e.element)("div"),(0,e.create_component)(a.$$.fragment),(0,e.attr)(n,"class","leaf credit-leaf svelte-48fouy")},m(t,r){(0,e.insert)(t,n,r),(0,e.mount_component)(a,n,null),o=!0},p:e.noop,i(t){o||((0,e.transition_in)(a.$$.fragment,t),o=!0)},o(t){(0,e.transition_out)(a.$$.fragment,t),o=!1},d(t){t&&(0,e.detach)(n),(0,e.destroy_component)(a)}}}function y(t){let n,a,o=t[11]+"";return{c(){n=(0,e.element)("p"),a=(0,e.text)(o),(0,e.attr)(n,"class","svelte-48fouy"),(0,e.toggle_class)(n,"isTitle",0===t[13])},m(t,o){(0,e.insert)(t,n,o),(0,e.append)(n,a)},p:e.noop,d(t){t&&(0,e.detach)(n)}}}function h(t){let n,a,o,r,l;const s=[v,g,_],p=[];return a=function(e,t){return"LEAF"===e[8]?0:e[8].html?1:2}(t),o=p[a]=s[a](t),{c(){n=(0,e.element)("div"),o.c(),r=(0,e.space)(),(0,e.attr)(n,"class","credit-block svelte-48fouy")},m(t,o){(0,e.insert)(t,n,o),p[a].m(n,null),(0,e.append)(n,r),l=!0},p(e,t){o.p(e,t)},i(t){l||((0,e.transition_in)(o),l=!0)},o(t){(0,e.transition_out)(o),l=!1},d(t){t&&(0,e.detach)(n),p[a].d()}}}function $(t){let n,a,r,l,s,i,c,u,f,_,g,v,y,$,b,w,T,R,S,k,A,P,L,C,H,q,M,B,F,O,I,j,J,N,D,E,G,z,K,Q,V,W,U,X,Y,Z,ee,te,ne,ae,oe,re,le,se,pe,ie,de,ce,ue,me,fe,_e,ge,ve,ye,he,$e,xe,be,we,Te,Re,Se,ke,Ae,Pe,Le,Ce,He,qe,Me,Be,Fe,Oe,Ie,je,Je,Ne,De,Ee,Ge,ze,Ke,Qe,Ve,We,Ue,Xe,Ye,Ze,et=t[0].nfbProduction+"",tt=t[0].nfbSubcaption+"",nt=t[0].playHeader+"",at=t[0].tapOrClickAndHold+"",ot=t[0].moveCharacterText+"",rt=t[0].collectText+"",lt=t[0].tokenStringText+"",st=t[0].orientText+"",pt=t[0].compassStringText+"",it=t[0].returnText+"",dt=t[0].memoriesStringText+"",ct=t[0].aboutHeader+"",ut=t[0].wayfinderStrongText+"",mt=t[0].wayfinderTextParagraph+"",ft=t[0].wayfinderFurtherTextParagraph+"",_t=t[0].moreAt+"",gt=t[0].moreAtLinkText+"",vt=t[0].creditsHeader+"";s=new p.default({props:{width:"100px",id:"image/svg/nfblogo"}}),R=new p.default({props:{width:"100%",id:"image/ui/ico_about_orange"}}),C=new p.default({props:{width:"42px",id:"image/ui/touch"}}),N=new p.default({props:{width:"42px",id:"image/tokens/ico_fish"}}),X=new p.default({props:{width:"46px",id:"image/ui/compass3"}}),se=new p.default({props:{width:"38px",id:"image/ui/tree"}}),ve=new p.default({props:{width:"100%",id:"image/ui/ico_about_orange"}}),je=new p.default({props:{width:"100%",id:"image/ui/ico_about_orange"}});let yt=t[3],ht=[];for(let e=0;e<yt.length;e+=1)ht[e]=h(m(t,yt,e));const $t=t=>(0,e.transition_out)(ht[t],1,1,()=>{ht[t]=null});return Ke=new p.default({props:{width:"100%",id:"image/ui/bird"}}),(Ue=new d.default({props:{delay:x}})).$on("click",t[6]),{c(){n=(0,e.element)("div"),a=(0,e.element)("div"),r=(0,e.element)("div"),l=(0,e.element)("a"),(0,e.create_component)(s.$$.fragment),c=(0,e.space)(),u=(0,e.element)("div"),f=(0,e.element)("p"),_=(0,e.text)(et),g=(0,e.space)(),v=(0,e.element)("p"),y=(0,e.text)(tt),$=(0,e.space)(),b=(0,e.element)("main"),w=(0,e.element)("h1"),T=(0,e.element)("div"),(0,e.create_component)(R.$$.fragment),S=(0,e.space)(),k=(0,e.text)(nt),A=(0,e.space)(),P=(0,e.element)("div"),L=(0,e.element)("div"),(0,e.create_component)(C.$$.fragment),H=(0,e.space)(),q=(0,e.element)("p"),M=(0,e.element)("strong"),B=(0,e.text)(at),F=(0,e.space)(),O=(0,e.text)(ot),I=(0,e.space)(),j=(0,e.element)("div"),J=(0,e.element)("div"),(0,e.create_component)(N.$$.fragment),D=(0,e.space)(),E=(0,e.element)("p"),G=(0,e.element)("strong"),z=(0,e.text)(rt),K=(0,e.space)(),Q=(0,e.text)(lt),V=(0,e.space)(),W=(0,e.element)("div"),U=(0,e.element)("div"),(0,e.create_component)(X.$$.fragment),Y=(0,e.space)(),Z=(0,e.element)("p"),ee=(0,e.element)("strong"),te=(0,e.text)(st),ne=(0,e.space)(),ae=(0,e.text)(pt),oe=(0,e.space)(),re=(0,e.element)("div"),le=(0,e.element)("div"),(0,e.create_component)(se.$$.fragment),pe=(0,e.space)(),ie=(0,e.element)("p"),de=(0,e.element)("strong"),ce=(0,e.text)(it),ue=(0,e.space)(),me=(0,e.text)(dt),fe=(0,e.space)(),_e=(0,e.element)("h1"),ge=(0,e.element)("div"),(0,e.create_component)(ve.$$.fragment),ye=(0,e.space)(),he=(0,e.text)(ct),$e=(0,e.space)(),xe=(0,e.element)("p"),be=(0,e.element)("strong"),we=(0,e.text)(ut),Te=(0,e.space)(),Re=(0,e.text)(mt),Se=(0,e.space)(),ke=(0,e.element)("p"),Ae=(0,e.text)(ft),Pe=(0,e.space)(),Le=(0,e.element)("p"),Ce=(0,e.text)(_t),He=(0,e.space)(),qe=(0,e.element)("a"),Me=(0,e.text)(gt),Fe=(0,e.space)(),Oe=(0,e.element)("h1"),Ie=(0,e.element)("div"),(0,e.create_component)(je.$$.fragment),Je=(0,e.space)(),Ne=(0,e.text)(vt),De=(0,e.space)(),Ee=(0,e.element)("div");for(let e=0;e<ht.length;e+=1)ht[e].c();Ge=(0,e.space)(),ze=(0,e.element)("div"),(0,e.create_component)(Ke.$$.fragment),We=(0,e.space)(),(0,e.create_component)(Ue.$$.fragment),(0,e.attr)(l,"href",i=t[0].nfbInteractiveLink),(0,e.attr)(l,"target","_blank"),(0,e.attr)(l,"alt","NFB-ONF"),(0,e.attr)(r,"class","nfb-logo"),(0,e.attr)(f,"class","nfb-production svelte-48fouy"),(0,e.attr)(v,"class","nfb-subcaption svelte-48fouy"),(0,e.attr)(u,"class","nfb-caption svelte-48fouy"),(0,e.attr)(T,"class","leaf svelte-48fouy"),(0,e.attr)(w,"class","svelte-48fouy"),(0,e.attr)(L,"class","about-icon svelte-48fouy"),(0,e.attr)(M,"class","upper svelte-48fouy"),(0,e.attr)(q,"class","left svelte-48fouy"),(0,e.attr)(P,"class","left about-row svelte-48fouy"),(0,e.attr)(J,"class","about-icon svelte-48fouy"),(0,e.attr)(G,"class","svelte-48fouy"),(0,e.attr)(E,"class","left svelte-48fouy"),(0,e.attr)(j,"class","left about-row svelte-48fouy"),(0,e.attr)(U,"class","about-icon svelte-48fouy"),(0,e.attr)(ee,"class","svelte-48fouy"),(0,e.attr)(Z,"class","left svelte-48fouy"),(0,e.attr)(W,"class","left about-row svelte-48fouy"),(0,e.attr)(le,"class","about-icon left-push svelte-48fouy"),(0,e.attr)(de,"class","svelte-48fouy"),(0,e.attr)(ie,"class","left svelte-48fouy"),(0,e.attr)(re,"class","left about-row svelte-48fouy"),(0,e.attr)(ge,"class","leaf svelte-48fouy"),(0,e.attr)(_e,"class","svelte-48fouy"),(0,e.attr)(be,"class","svelte-48fouy"),(0,e.attr)(xe,"class","left svelte-48fouy"),(0,e.attr)(ke,"class","left svelte-48fouy"),(0,e.attr)(qe,"target","_blank"),(0,e.attr)(qe,"href",Be=t[0].moreAtLink),(0,e.attr)(qe,"class","svelte-48fouy"),(0,e.attr)(Le,"class","svelte-48fouy"),(0,e.attr)(Ie,"class","leaf svelte-48fouy"),(0,e.attr)(Oe,"class","svelte-48fouy"),(0,e.attr)(Ee,"class","credits-list svelte-48fouy"),(0,e.attr)(ze,"class","bird svelte-48fouy"),(0,e.attr)(b,"class","copy svelte-48fouy"),(0,e.attr)(a,"class","about-content svelte-48fouy"),(0,e.attr)(n,"class","about-container svelte-48fouy")},m(o,p){(0,e.insert)(o,n,p),(0,e.append)(n,a),(0,e.append)(a,r),(0,e.append)(r,l),(0,e.mount_component)(s,l,null),(0,e.append)(a,c),(0,e.append)(a,u),(0,e.append)(u,f),(0,e.append)(f,_),(0,e.append)(u,g),(0,e.append)(u,v),(0,e.append)(v,y),(0,e.append)(a,$),(0,e.append)(a,b),(0,e.append)(b,w),(0,e.append)(w,T),(0,e.mount_component)(R,T,null),(0,e.append)(w,S),(0,e.append)(w,k),(0,e.append)(b,A),(0,e.append)(b,P),(0,e.append)(P,L),(0,e.mount_component)(C,L,null),(0,e.append)(P,H),(0,e.append)(P,q),(0,e.append)(q,M),(0,e.append)(M,B),(0,e.append)(q,F),(0,e.append)(q,O),(0,e.append)(b,I),(0,e.append)(b,j),(0,e.append)(j,J),(0,e.mount_component)(N,J,null),(0,e.append)(j,D),(0,e.append)(j,E),(0,e.append)(E,G),(0,e.append)(G,z),(0,e.append)(E,K),(0,e.append)(E,Q),(0,e.append)(b,V),(0,e.append)(b,W),(0,e.append)(W,U),(0,e.mount_component)(X,U,null),(0,e.append)(W,Y),(0,e.append)(W,Z),(0,e.append)(Z,ee),(0,e.append)(ee,te),(0,e.append)(Z,ne),(0,e.append)(Z,ae),(0,e.append)(b,oe),(0,e.append)(b,re),(0,e.append)(re,le),(0,e.mount_component)(se,le,null),(0,e.append)(re,pe),(0,e.append)(re,ie),(0,e.append)(ie,de),(0,e.append)(de,ce),(0,e.append)(ie,ue),(0,e.append)(ie,me),(0,e.append)(b,fe),(0,e.append)(b,_e),(0,e.append)(_e,ge),(0,e.mount_component)(ve,ge,null),(0,e.append)(_e,ye),(0,e.append)(_e,he),(0,e.append)(b,$e),(0,e.append)(b,xe),(0,e.append)(xe,be),(0,e.append)(be,we),(0,e.append)(xe,Te),(0,e.append)(xe,Re),(0,e.append)(b,Se),(0,e.append)(b,ke),(0,e.append)(ke,Ae),(0,e.append)(b,Pe),(0,e.append)(b,Le),(0,e.append)(Le,Ce),(0,e.append)(Le,He),(0,e.append)(Le,qe),(0,e.append)(qe,Me),(0,e.append)(b,Fe),(0,e.append)(b,Oe),(0,e.append)(Oe,Ie),(0,e.mount_component)(je,Ie,null),(0,e.append)(Oe,Je),(0,e.append)(Oe,Ne),(0,e.append)(b,De),(0,e.append)(b,Ee);for(let e=0;e<ht.length;e+=1)ht[e].m(Ee,null);(0,e.append)(b,Ge),(0,e.append)(b,ze),(0,e.mount_component)(Ke,ze,null),(0,e.insert)(o,We,p),(0,e.mount_component)(Ue,o,p),Xe=!0,Ye||(Ze=[(0,e.listen)(n,"introend",t[4]),(0,e.listen)(n,"outrostart",t[5])],Ye=!0)},p(n,[a]){if(t=n,(!Xe||1&a&&i!==(i=t[0].nfbInteractiveLink))&&(0,e.attr)(l,"href",i),(!Xe||1&a)&&et!==(et=t[0].nfbProduction+"")&&(0,e.set_data)(_,et),(!Xe||1&a)&&tt!==(tt=t[0].nfbSubcaption+"")&&(0,e.set_data)(y,tt),(!Xe||1&a)&&nt!==(nt=t[0].playHeader+"")&&(0,e.set_data)(k,nt),(!Xe||1&a)&&at!==(at=t[0].tapOrClickAndHold+"")&&(0,e.set_data)(B,at),(!Xe||1&a)&&ot!==(ot=t[0].moveCharacterText+"")&&(0,e.set_data)(O,ot),(!Xe||1&a)&&rt!==(rt=t[0].collectText+"")&&(0,e.set_data)(z,rt),(!Xe||1&a)&&lt!==(lt=t[0].tokenStringText+"")&&(0,e.set_data)(Q,lt),(!Xe||1&a)&&st!==(st=t[0].orientText+"")&&(0,e.set_data)(te,st),(!Xe||1&a)&&pt!==(pt=t[0].compassStringText+"")&&(0,e.set_data)(ae,pt),(!Xe||1&a)&&it!==(it=t[0].returnText+"")&&(0,e.set_data)(ce,it),(!Xe||1&a)&&dt!==(dt=t[0].memoriesStringText+"")&&(0,e.set_data)(me,dt),(!Xe||1&a)&&ct!==(ct=t[0].aboutHeader+"")&&(0,e.set_data)(he,ct),(!Xe||1&a)&&ut!==(ut=t[0].wayfinderStrongText+"")&&(0,e.set_data)(we,ut),(!Xe||1&a)&&mt!==(mt=t[0].wayfinderTextParagraph+"")&&(0,e.set_data)(Re,mt),(!Xe||1&a)&&ft!==(ft=t[0].wayfinderFurtherTextParagraph+"")&&(0,e.set_data)(Ae,ft),(!Xe||1&a)&&_t!==(_t=t[0].moreAt+"")&&(0,e.set_data)(Ce,_t),(!Xe||1&a)&&gt!==(gt=t[0].moreAtLinkText+"")&&(0,e.set_data)(Me,gt),(!Xe||1&a&&Be!==(Be=t[0].moreAtLink))&&(0,e.attr)(qe,"href",Be),(!Xe||1&a)&&vt!==(vt=t[0].creditsHeader+"")&&(0,e.set_data)(Ne,vt),8&a){let n;for(yt=t[3],n=0;n<yt.length;n+=1){const o=m(t,yt,n);ht[n]?(ht[n].p(o,a),(0,e.transition_in)(ht[n],1)):(ht[n]=h(o),ht[n].c(),(0,e.transition_in)(ht[n],1),ht[n].m(Ee,null))}for((0,e.group_outros)(),n=yt.length;n<ht.length;n+=1)$t(n);(0,e.check_outros)()}},i(t){if(!Xe){(0,e.transition_in)(s.$$.fragment,t),(0,e.transition_in)(R.$$.fragment,t),(0,e.transition_in)(C.$$.fragment,t),(0,e.transition_in)(N.$$.fragment,t),(0,e.transition_in)(X.$$.fragment,t),(0,e.transition_in)(se.$$.fragment,t),(0,e.transition_in)(ve.$$.fragment,t),(0,e.transition_in)(je.$$.fragment,t);for(let t=0;t<yt.length;t+=1)(0,e.transition_in)(ht[t]);(0,e.transition_in)(Ke.$$.fragment,t),(0,e.add_render_callback)(()=>{Ve&&Ve.end(1),Qe||(Qe=(0,e.create_in_transition)(n,o.fadeInTransition,{y:0,delay:10,duration:x})),Qe.start()}),(0,e.transition_in)(Ue.$$.fragment,t),Xe=!0}},o(t){(0,e.transition_out)(s.$$.fragment,t),(0,e.transition_out)(R.$$.fragment,t),(0,e.transition_out)(C.$$.fragment,t),(0,e.transition_out)(N.$$.fragment,t),(0,e.transition_out)(X.$$.fragment,t),(0,e.transition_out)(se.$$.fragment,t),(0,e.transition_out)(ve.$$.fragment,t),(0,e.transition_out)(je.$$.fragment,t),ht=ht.filter(Boolean);for(let t=0;t<ht.length;t+=1)(0,e.transition_out)(ht[t]);(0,e.transition_out)(Ke.$$.fragment,t),Qe&&Qe.invalidate(),Ve=(0,e.create_out_transition)(n,o.fadeInTransition,{y:0,delay:0,duration:x}),(0,e.transition_out)(Ue.$$.fragment,t),Xe=!1},d(t){t&&(0,e.detach)(n),(0,e.destroy_component)(s),(0,e.destroy_component)(R),(0,e.destroy_component)(C),(0,e.destroy_component)(N),(0,e.destroy_component)(X),(0,e.destroy_component)(se),(0,e.destroy_component)(ve),(0,e.destroy_component)(je),(0,e.destroy_each)(ht,t),(0,e.destroy_component)(Ke),t&&Ve&&Ve.end(),t&&(0,e.detach)(We),(0,e.destroy_component)(Ue,t),Ye=!1,(0,e.run_all)(Ze)}}}const x=250;function b(o,r,s){let p;(0,e.component_subscribe)(o,a.localize,e=>s(0,p=e));/(iOS|Android|iPhone|iPad)/i.test(navigator.userAgent);const i=(0,t.createEventDispatcher)(),{world:d}=(0,n.context)(),c=[[p.mattRole,"Matt DesLauriers"],[p.guillaumeRole,"Guillaume Le Roux"],["Illustration","Tiffany Beucher"],[p.cedrineRole,"Cdrine Pradier"],[p.williamRole,"William Mapan"],[p.boombox,"Drew Thomas & S. Quinn Hoodless  BoomBox Sound"],[p.jelaniRole,"Jelani Thompson"],"LEAF",[p.nicholasRole,"Nicholas Klassen"],[p.robRole,"Rob McLaughlin"],[p.jasmineRole,"Jasmine Pullukatt"],[p.camilleJanineRole,"Camille Fillion","Janine Steele"],[p.victoriaRole,"Victoria Angell"],[p.tammyRole,"Tammy Peddle"],[p.jenniferRole,"Jennifer Mair"],[p.ericRole,"ric Bondo"],[p.sergiuRole,"Sergiu Raul Suciu"],[p.catherineRole,"Catherine Perreault"],[p.christianRole,"Christian Pitchen"],[p.socialRole,"Hannah Martin"],[p.gabrielleRole,"Gabrielle Lisa Collard"]];return[p,i,d,c,()=>{d.findTag(l.AppState).running=!1},()=>{d.findTag(l.AppState).running=!0},()=>i("close")]}class w extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,b,$,e.safe_not_equal,{})}}exports.default=w;
},{"svelte/internal":226,"svelte":220,"../alec-svelte":225,"../util/locale":227,"../animations/transitions":689,"../tags":60,"../components/Image.svelte":690,"../components/CloseButton.svelte":880}],845:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),n=require("svelte/transition"),t=require("../animations/transitions");function a(n){let t,a,i,r,s;const l=n[6].default,o=(0,e.create_slot)(l,n,n[5],null);return{c(){t=(0,e.element)("div"),o&&o.c(),(0,e.attr)(t,"class","svelte-r34ayh"),(0,e.toggle_class)(t,"disableInteraction",n[2]),(0,e.toggle_class)(t,"darken",n[0]),(0,e.toggle_class)(t,"darkenTransition",n[1])},m(a,l){(0,e.insert)(a,t,l),o&&o.m(t,null),i=!0,r||(s=(0,e.listen)(t,"click",n[7]),r=!0)},p(n,[a]){o&&o.p&&32&a&&(0,e.update_slot)(o,l,n,n[5],a,null,null),4&a&&(0,e.toggle_class)(t,"disableInteraction",n[2]),1&a&&(0,e.toggle_class)(t,"darken",n[0]),2&a&&(0,e.toggle_class)(t,"darkenTransition",n[1])},i(r){i||((0,e.transition_in)(o,r),(0,e.add_render_callback)(()=>{a||(a=(0,e.create_bidirectional_transition)(t,n[3],{},!0)),a.run(1)}),i=!0)},o(r){(0,e.transition_out)(o,r),a||(a=(0,e.create_bidirectional_transition)(t,n[3],{},!1)),a.run(0),i=!1},d(n){n&&(0,e.detach)(t),o&&o.d(n),n&&a&&a.end(),r=!1,s()}}}function i(n,a,i){let{$$slots:r={},$$scope:s}=a,{darken:l=!1}=a,{darkenTransition:o=!1}=a,{disableInteraction:d=!1}=a,{fade:c=!0}=a,u=c?t.fadeOpacityTransition:()=>{};return n.$$set=(e=>{"darken"in e&&i(0,l=e.darken),"darkenTransition"in e&&i(1,o=e.darkenTransition),"disableInteraction"in e&&i(2,d=e.disableInteraction),"fade"in e&&i(4,c=e.fade),"$$scope"in e&&i(5,s=e.$$scope)}),[l,o,d,u,c,s,r,function(t){(0,e.bubble)(n,t)}]}class r extends e.SvelteComponent{constructor(n){super(),(0,e.init)(this,n,i,a,e.safe_not_equal,{darken:0,darkenTransition:1,disableInteraction:2,fade:4})}}exports.default=r;
},{"svelte/internal":226,"svelte/transition":687,"../animations/transitions":689}],875:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),t=require("../assets/image/ui/ico_emptyHaiku.png"),i=l(t),n=require("../assets/image/ui/ico_completedHaiku.png"),o=l(n),r=require("../util/Assets"),s=l(r),u=require("./Image.svelte"),a=l(u);function l(e){return e&&e.__esModule?e:{default:e}}function c(t){let i,n,o;return n=new a.default({props:{id:t[0]?m:d}}),{c(){i=(0,e.element)("div"),(0,e.create_component)(n.$$.fragment),(0,e.attr)(i,"class","haiku-slot svelte-ohjn7u")},m(t,r){(0,e.insert)(t,i,r),(0,e.mount_component)(n,i,null),o=!0},p(e,[t]){const i={};1&t&&(i.id=e[0]?m:d),n.$set(i)},i(t){o||((0,e.transition_in)(n.$$.fragment,t),o=!0)},o(t){(0,e.transition_out)(n.$$.fragment,t),o=!1},d(t){t&&(0,e.detach)(i),(0,e.destroy_component)(n)}}}const d="image/ui/ico_emptyHaiku",m="image/ui/ico_completedHaiku";function p(e,t,i){s.default.prepare(d);let{collected:n=!1}=t;return e.$$set=(e=>{"collected"in e&&i(0,n=e.collected)}),[n]}class _ extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,p,c,e.safe_not_equal,{collected:0})}}exports.default=_;
},{"svelte/internal":226,"../assets/image/ui/ico_emptyHaiku.png":493,"../assets/image/ui/ico_completedHaiku.png":492,"../util/Assets":31,"./Image.svelte":690}],834:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("svelte/internal"),e=require("./IconButton.svelte"),n=r(e),i=require("svelte/transition"),o=require("../animations/transitions"),a=require("eases"),s=r(a);function r(t){return t&&t.__esModule?t:{default:t}}function l(e){let n,i,o,a;return{c(){n=(0,t.element)("div"),(0,t.attr)(n,"class","notification svelte-bbjv")},m(e,i){(0,t.insert)(e,n,i),a=!0},p(t,e){t},i(e){a||((0,t.add_render_callback)(()=>{o&&o.end(1),i||(i=(0,t.create_in_transition)(n,u,{delay:500,easing:s.default.expoOut,duration:1e3})),i.start()}),a=!0)},o(e){i&&i.invalidate(),o=(0,t.create_out_transition)(n,u,{delay:0,easing:s.default.expoOut,duration:1e3}),a=!1},d(e){e&&(0,t.detach)(n),e&&o&&o.end()}}}function c(e){let i,a,s,r,c,u;(a=new n.default({props:{size:e[6],icon:e[3],image:e[4],id:e[5]}})).$on("click",e[10]),a.$on("touchstart",e[11]),a.$on("mousedown",e[12]);let d=e[8]&&l(e);return{c(){i=(0,t.element)("div"),(0,t.create_component)(a.$$.fragment),s=(0,t.space)(),d&&d.c(),(0,t.attr)(i,"class","menu-button svelte-bbjv"),(0,t.attr)(i,"style",e[7]),(0,t.toggle_class)(i,"topLeft",e[0]),(0,t.toggle_class)(i,"topRight",e[1]),(0,t.toggle_class)(i,"bottomRight",e[2])},m(e,n){(0,t.insert)(e,i,n),(0,t.mount_component)(a,i,null),(0,t.append)(i,s),d&&d.m(i,null),u=!0},p(e,[n]){const o={};64&n&&(o.size=e[6]),8&n&&(o.icon=e[3]),16&n&&(o.image=e[4]),32&n&&(o.id=e[5]),a.$set(o),e[8]?d?(d.p(e,n),256&n&&(0,t.transition_in)(d,1)):((d=l(e)).c(),(0,t.transition_in)(d,1),d.m(i,null)):d&&((0,t.group_outros)(),(0,t.transition_out)(d,1,1,()=>{d=null}),(0,t.check_outros)()),(!u||128&n)&&(0,t.attr)(i,"style",e[7]),1&n&&(0,t.toggle_class)(i,"topLeft",e[0]),2&n&&(0,t.toggle_class)(i,"topRight",e[1]),4&n&&(0,t.toggle_class)(i,"bottomRight",e[2])},i(e){u||((0,t.transition_in)(a.$$.fragment,e),(0,t.transition_in)(d),(0,t.add_render_callback)(()=>{c&&c.end(1),r||(r=(0,t.create_in_transition)(i,o.fadeOpacityTransition,{delay:250})),r.start()}),u=!0)},o(e){(0,t.transition_out)(a.$$.fragment,e),(0,t.transition_out)(d),r&&r.invalidate(),c=(0,t.create_out_transition)(i,o.fadeOpacityTransition,{}),u=!1},d(e){e&&(0,t.detach)(i),(0,t.destroy_component)(a),d&&d.d(),e&&c&&c.end()}}}function u(t,{delay:e=0,duration:n=500,easing:i=(t=>t),baseScale:o=0}){const a=getComputedStyle(t).transform.match(/scale\(([0-9.]+)\)/),s=a?a[1]:1,r=1-o;return{delay:e,duration:n,css:t=>{return`transform: scale(${i(t)*s*r+o})`}}}function d(e,n,i){let{topLeft:o=!1}=n,{topRight:a=!1}=n,{bottomRight:s=!1}=n,{icon:r}=n,{image:l}=n,{id:c}=n,{size:u=null}=n,{style:d=""}=n,g=!1,_=null;return e.$$set=(t=>{"topLeft"in t&&i(0,o=t.topLeft),"topRight"in t&&i(1,a=t.topRight),"bottomRight"in t&&i(2,s=t.bottomRight),"icon"in t&&i(3,r=t.icon),"image"in t&&i(4,l=t.image),"id"in t&&i(5,c=t.id),"size"in t&&i(6,u=t.size),"style"in t&&i(7,d=t.style)}),[o,a,s,r,l,c,u,d,g,function(){i(8,g=!0),clearTimeout(_),_=setTimeout(()=>{i(8,g=!1)},1500)},function(n){(0,t.bubble)(e,n)},function(n){(0,t.bubble)(e,n)},function(n){(0,t.bubble)(e,n)}]}class g extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,d,c,t.safe_not_equal,{topLeft:0,topRight:1,bottomRight:2,icon:3,image:4,id:5,size:6,style:7,notify:9})}get notify(){return this.$$.ctx[9]}}exports.default=g;
},{"svelte/internal":226,"./IconButton.svelte":877,"svelte/transition":687,"../animations/transitions":689,"eases":291}],832:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),t=require("svelte/transition"),n=require("svelte"),o=require("../animations/transitions"),r=require("./HaikuInventorySlot.svelte"),i=m(r),s=require("../assets/image/ui/ico_emptyHaiku.png"),a=m(s),l=require("../assets/image/ui/ico_completedHaiku.png"),u=m(l),c=require("../assets/image/ui/ico_journal.png"),_=m(c),d=require("./CornerMenuButton.svelte"),f=m(d);function m(e){return e&&e.__esModule?e:{default:e}}const{Boolean:p}=e.globals;function g(e,t,n){const o=e.slice();return o[13]=t[n],o}function h(t){let n,o;return n=new i.default({props:{collected:t[13]}}),{c(){(0,e.create_component)(n.$$.fragment)},m(t,r){(0,e.mount_component)(n,t,r),o=!0},p(e,t){const o={};1&t&&(o.collected=e[13]),n.$set(o)},i(t){o||((0,e.transition_in)(n.$$.fragment,t),o=!0)},o(t){(0,e.transition_out)(n.$$.fragment,t),o=!1},d(t){(0,e.destroy_component)(n,t)}}}function v(t){let n,r,i,s,a=t[0],l=[];for(let e=0;e<a.length;e+=1)l[e]=h(g(t,a,e));const u=t=>(0,e.transition_out)(l[t],1,1,()=>{l[t]=null});return{c(){n=(0,e.element)("div");for(let e=0;e<l.length;e+=1)l[e].c();(0,e.attr)(n,"class","haiku-container svelte-1wphodo")},m(t,o){(0,e.insert)(t,n,o);for(let e=0;e<l.length;e+=1)l[e].m(n,null);s=!0},p(t,[o]){if(1&o){let r;for(a=t[0],r=0;r<a.length;r+=1){const i=g(t,a,r);l[r]?(l[r].p(i,o),(0,e.transition_in)(l[r],1)):(l[r]=h(i),l[r].c(),(0,e.transition_in)(l[r],1),l[r].m(n,null))}for((0,e.group_outros)(),r=a.length;r<l.length;r+=1)u(r);(0,e.check_outros)()}},i(t){if(!s){for(let t=0;t<a.length;t+=1)(0,e.transition_in)(l[t]);(0,e.add_render_callback)(()=>{i&&i.end(1),r||(r=(0,e.create_in_transition)(n,o.fadeOpacityTransition,{delay:250})),r.start()}),s=!0}},o(t){l=l.filter(p);for(let t=0;t<l.length;t+=1)(0,e.transition_out)(l[t]);r&&r.invalidate(),i=(0,e.create_out_transition)(n,o.fadeOpacityTransition,{}),s=!1},d(t){t&&(0,e.detach)(n),(0,e.destroy_each)(l,t),t&&i&&i.end()}}}const y=4e3;function q(e,t,o){(0,n.createEventDispatcher)();let r,{store:i}=t,s=null,a=!1,l=[],u=0,c=!1,_=!1,d=!1;const f=i.subscribe(e=>{c=e.moving,r=e.state;const t=e.haikusTotal,n=e.haikusCollected||0;o(0,l=new Array(t).fill(!1).map((e,t)=>t<n)),u!==n&&(a=!0,clearTimeout(s),s=setTimeout(()=>{a=!1,m()},y)),u=n,m()});function m(){_=!r&&(a||!c||l.length>0&&l.every(Boolean))}return(0,n.onMount)(()=>{d=!0}),(0,n.onDestroy)(()=>{d=!1,a=!1,clearTimeout(s),f()}),e.$$set=(e=>{"store"in e&&o(1,i=e.store)}),[l,i]}class $ extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,q,v,e.safe_not_equal,{store:1})}}exports.default=$;
},{"svelte/internal":226,"svelte/transition":687,"svelte":220,"../animations/transitions":689,"./HaikuInventorySlot.svelte":875,"../assets/image/ui/ico_emptyHaiku.png":493,"../assets/image/ui/ico_completedHaiku.png":492,"../assets/image/ui/ico_journal.png":498,"./CornerMenuButton.svelte":834}],846:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),t=require("../animations/transitions"),n=require("../config"),r=s(n),a=require("../util/Random"),o=s(a),i=require("./Image.svelte"),l=s(i);function s(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n){const r=e.slice();return r[9]=t[n],r[0]=n,r}function d(e,t,n){const r=e.slice();return r[11]=t[n],r[13]=n,r}function u(n){let r,a,o,i;return a=new l.default({props:{width:"100%",height:"100%",id:"image/ui/empty_box"}}),{c(){r=(0,e.element)("div"),(0,e.create_component)(a.$$.fragment),(0,e.attr)(r,"class","haiku-card-icon svelte-rdjqne")},m(t,n){(0,e.insert)(t,r,n),(0,e.mount_component)(a,r,null),i=!0},p(e,t){n=e},i(l){i||((0,e.transition_in)(a.$$.fragment,l),o||(0,e.add_render_callback)(()=>{(o=(0,e.create_in_transition)(r,t.fadeTransition,{delay:p(4*n[0]+1+n[13])})).start()}),i=!0)},o(t){(0,e.transition_out)(a.$$.fragment,t),i=!1},d(t){t&&(0,e.detach)(r),(0,e.destroy_component)(a)}}}function _(n){let r,a,o,i;return a=new l.default({props:{width:"100%",height:"100%",id:"image/ui/filled_box"}}),{c(){r=(0,e.element)("div"),(0,e.create_component)(a.$$.fragment),(0,e.attr)(r,"class","haiku-card-icon svelte-rdjqne")},m(t,n){(0,e.insert)(t,r,n),(0,e.mount_component)(a,r,null),i=!0},p(e,t){n=e},i(l){i||((0,e.transition_in)(a.$$.fragment,l),o||(0,e.add_render_callback)(()=>{(o=(0,e.create_in_transition)(r,t.fadeTransition,{delay:p(4*n[0]+1+n[13])})).start()}),i=!0)},o(t){(0,e.transition_out)(a.$$.fragment,t),i=!1},d(t){t&&(0,e.detach)(r),(0,e.destroy_component)(a)}}}function m(t,n){let r,a,o,i,l,s;const c=[_,u],d=[];function m(e,t){return e[11].collected?0:1}return a=m(n),o=d[a]=c[a](n),{key:t,first:null,c(){r=(0,e.element)("div"),o.c(),i=(0,e.space)(),(0,e.attr)(r,"class","haiku-card svelte-rdjqne"),(0,e.attr)(r,"style",l=n[11].style),(0,e.toggle_class)(r,"locked",n[9].locked),(0,e.toggle_class)(r,"active",n[9].active),(0,e.toggle_class)(r,"collected",n[11].collected),this.first=r},m(t,n){(0,e.insert)(t,r,n),d[a].m(r,null),(0,e.append)(r,i),s=!0},p(t,n){let u=a;(a=m(t))!==u&&((0,e.group_outros)(),(0,e.transition_out)(d[u],1,1,()=>{d[u]=null}),(0,e.check_outros)(),(o=d[a])?o.p(t,n):(o=d[a]=c[a](t)).c(),(0,e.transition_in)(o,1),o.m(r,i)),(!s||2&n&&l!==(l=t[11].style))&&(0,e.attr)(r,"style",l),2&n&&(0,e.toggle_class)(r,"locked",t[9].locked),2&n&&(0,e.toggle_class)(r,"active",t[9].active),2&n&&(0,e.toggle_class)(r,"collected",t[11].collected)},i(t){s||((0,e.transition_in)(o),s=!0)},o(t){(0,e.transition_out)(o),s=!1},d(t){t&&(0,e.detach)(r),d[a].d()}}}function f(n,r){let a,o,i,s,c,u,_,f,g,h,$,v,k,b=[],y=new Map;o=new l.default({props:{width:"100%",height:"100%",id:"image/ui/vertical-rule"}});let q=r[9].cards;const w=e=>e[11];for(let e=0;e<q.length;e+=1){let t=d(r,q,e),n=w(t);y.set(n,b[e]=m(n,t))}return $=new l.default({props:{width:"100%",height:"100%",id:r[2](r[9].name,r[9].finished)}}),{key:n,first:null,c(){a=(0,e.element)("div"),(0,e.create_component)(o.$$.fragment),s=(0,e.space)(),c=(0,e.element)("div"),u=(0,e.element)("div"),_=(0,e.element)("div");for(let e=0;e<b.length;e+=1)b[e].c();f=(0,e.space)(),g=(0,e.element)("div"),h=(0,e.element)("div"),(0,e.create_component)($.$$.fragment),(0,e.attr)(a,"class","vertical-rule svelte-rdjqne"),(0,e.attr)(_,"class","haiku-card-container svelte-rdjqne"),(0,e.toggle_class)(_,"locked",r[9].locked),(0,e.toggle_class)(_,"acitve",r[9].active),(0,e.attr)(u,"class","top-row svelte-rdjqne"),(0,e.attr)(h,"class","biome-icon svelte-rdjqne"),(0,e.toggle_class)(h,"locked",r[9].locked),(0,e.attr)(g,"class","biome-icon-container svelte-rdjqne"),(0,e.attr)(c,"class","biome-container svelte-rdjqne"),this.first=a},m(t,n){(0,e.insert)(t,a,n),(0,e.mount_component)(o,a,null),(0,e.insert)(t,s,n),(0,e.insert)(t,c,n),(0,e.append)(c,u),(0,e.append)(u,_);for(let e=0;e<b.length;e+=1)b[e].m(_,null);(0,e.append)(c,f),(0,e.append)(c,g),(0,e.append)(g,h),(0,e.mount_component)($,h,null),k=!0},p(t,n){if(r=t,2&n){const t=r[9].cards;(0,e.group_outros)(),b=(0,e.update_keyed_each)(b,n,w,1,r,t,y,_,e.outro_and_destroy_block,m,null,d),(0,e.check_outros)()}2&n&&(0,e.toggle_class)(_,"locked",r[9].locked),2&n&&(0,e.toggle_class)(_,"acitve",r[9].active);const a={};2&n&&(a.id=r[2](r[9].name,r[9].finished)),$.$set(a),2&n&&(0,e.toggle_class)(h,"locked",r[9].locked)},i(n){if(!k){(0,e.transition_in)(o.$$.fragment,n),(0,e.add_render_callback)(()=>{i||(i=(0,e.create_bidirectional_transition)(a,t.fadeTransition,{delay:p(4*r[0])},!0)),i.run(1)});for(let t=0;t<q.length;t+=1)(0,e.transition_in)(b[t]);(0,e.transition_in)($.$$.fragment,n),v||(0,e.add_render_callback)(()=>{(v=(0,e.create_in_transition)(h,t.fadeTransition,{delay:p(4*r[0]+1)})).start()}),k=!0}},o(n){(0,e.transition_out)(o.$$.fragment,n),i||(i=(0,e.create_bidirectional_transition)(a,t.fadeTransition,{delay:p(4*r[0])},!1)),i.run(0);for(let t=0;t<b.length;t+=1)(0,e.transition_out)(b[t]);(0,e.transition_out)($.$$.fragment,n),k=!1},d(t){t&&(0,e.detach)(a),(0,e.destroy_component)(o),t&&i&&i.end(),t&&(0,e.detach)(s),t&&(0,e.detach)(c);for(let e=0;e<b.length;e+=1)b[e].d();(0,e.destroy_component)($)}}}function g(n){let r,a,o,i,s,d,u=[],_=new Map,m=n[1];const g=e=>e[9];for(let e=0;e<m.length;e+=1){let t=c(n,m,e),r=g(t);_.set(r,u[e]=f(r,t))}return i=new l.default({props:{width:"100%",height:"100%",id:"image/ui/vertical-rule"}}),{c(){r=(0,e.element)("div");for(let e=0;e<u.length;e+=1)u[e].c();a=(0,e.space)(),o=(0,e.element)("div"),(0,e.create_component)(i.$$.fragment),(0,e.attr)(o,"class","vertical-rule svelte-rdjqne"),(0,e.attr)(r,"class","progress-container svelte-rdjqne")},m(t,n){(0,e.insert)(t,r,n);for(let e=0;e<u.length;e+=1)u[e].m(r,null);(0,e.append)(r,a),(0,e.append)(r,o),(0,e.mount_component)(i,o,null),d=!0},p(t,[o]){if(n=t,6&o){const t=n[1];(0,e.group_outros)(),u=(0,e.update_keyed_each)(u,o,g,1,n,t,_,r,e.outro_and_destroy_block,f,a,c),(0,e.check_outros)()}},i(n){if(!d){for(let t=0;t<m.length;t+=1)(0,e.transition_in)(u[t]);(0,e.transition_in)(i.$$.fragment,n),s||(0,e.add_render_callback)(()=>{(s=(0,e.create_in_transition)(o,t.fadeTransition,{delay:p(12)})).start()}),d=!0}},o(t){for(let t=0;t<u.length;t+=1)(0,e.transition_out)(u[t]);(0,e.transition_out)(i.$$.fragment,t),d=!1},d(t){t&&(0,e.detach)(r);for(let e=0;e<u.length;e+=1)u[e].d();(0,e.destroy_component)(i)}}}function p(e){return 50+100*e}function h(e,t,n){const a=(0,o.default)();let{biome:i="forest"}=t,{biomeIndex:l=0}=t,{haikusCollected:s=0}=t;const c=(0,r.default)().haikusPerBiome,d=["forest","grasslands","tundra"],u={forest:"biomeforest",grasslands:"biomegrass",tundra:"biometundra"};let _;return e.$$set=(e=>{"biome"in e&&n(3,i=e.biome),"biomeIndex"in e&&n(0,l=e.biomeIndex),"haikusCollected"in e&&n(4,s=e.haikusCollected)}),e.$$.update=(()=>{17&e.$$.dirty&&n(1,_=d.map((e,t)=>{let n;return n=t<l?c:t>l?0:s,{name:e,finished:l>t,active:l===t,locked:t>l,cards:new Array(c).fill(null).map((e,t)=>{return{style:`transform: translate(0px, ${a.range(-.75,.75)}px) rotateZ(${a.range(-4,1.5)}deg);`,collected:t<n,mostRecent:!1}}),index:t}}))}),[l,_,function(e,t){return`image/ui/${u[e]}${t?"-alt":""}`},i,s]}class $ extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,h,g,e.safe_not_equal,{biome:3,biomeIndex:0,haikusCollected:4})}}exports.default=$;
},{"svelte/internal":226,"../animations/transitions":689,"../config":28,"../util/Random":235,"./Image.svelte":690}],770:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t=require("svelte/internal"),n=require("../util/tokens"),r=require("../components/ImageButton.svelte"),o=w(r),a=require("../components/AbsoluteOverlay.svelte"),s=w(a),i=require("../components/HaikuInventory.svelte"),l=w(i),u=require("../tags"),c=h(u),d=require("../assets/image/ui/ico_paperJournal1-rotated.png"),p=w(d),m=require("../components/GameProgress.svelte"),_=w(m),f=require("../util/locale"),g=require("svelte"),v=require("../animations/transitions"),$=require("../alec-svelte"),y=require("../components/HaikuCard.svelte"),b=w(y),q=require("../config"),k=w(q);function h(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function w(e){return e&&e.__esModule?e:{default:e}}function O(e){let n,r,a,s,i,l,u,c,d,p,m,f,g;const $=[e[5]()];let y={};for(let e=0;e<$.length;e+=1)y=(0,t.assign)(y,$[e]);return a=new _.default({props:y}),i=new b.default({props:{animatePoem:!0,lines:e[0],tokens:e[1]}}),(c=new o.default({props:{text:e[3].continueButton,mode:"normal_small"}})).$on("click",e[4]),{c(){n=(0,t.element)("div"),r=(0,t.element)("div"),(0,t.create_component)(a.$$.fragment),s=(0,t.space)(),(0,t.create_component)(i.$$.fragment),l=(0,t.space)(),u=(0,t.element)("div"),(0,t.create_component)(c.$$.fragment),(0,t.attr)(r,"class","progress-wrapper svelte-1wd0urs"),(0,t.attr)(u,"class","save-memory-container svelte-1wd0urs"),(0,t.attr)(n,"class","page-container svelte-1wd0urs"),(0,t.toggle_class)(n,"ignorePointer",e[2])},m(e,o){(0,t.insert)(e,n,o),(0,t.append)(n,r),(0,t.mount_component)(a,r,null),(0,t.append)(n,s),(0,t.mount_component)(i,n,null),(0,t.append)(n,l),(0,t.append)(n,u),(0,t.mount_component)(c,u,null),g=!0},p(e,[r]){const o=32&r?(0,t.get_spread_update)($,[(0,t.get_spread_object)(e[5]())]):{};a.$set(o);const s={};1&r&&(s.lines=e[0]),2&r&&(s.tokens=e[1]),i.$set(s);const l={};8&r&&(l.text=e[3].continueButton),c.$set(l),4&r&&(0,t.toggle_class)(n,"ignorePointer",e[2])},i(e){g||((0,t.transition_in)(a.$$.fragment,e),(0,t.transition_in)(i.$$.fragment,e),(0,t.transition_in)(c.$$.fragment,e),(0,t.add_render_callback)(()=>{p&&p.end(1),d||(d=(0,t.create_in_transition)(u,v.fadeTransition,{delay:750,duration:500})),d.start()}),(0,t.add_render_callback)(()=>{f&&f.end(1),m||(m=(0,t.create_in_transition)(n,v.fadeOpacityTransition,{delay:0,duration:500})),m.start()}),g=!0)},o(e){(0,t.transition_out)(a.$$.fragment,e),(0,t.transition_out)(i.$$.fragment,e),(0,t.transition_out)(c.$$.fragment,e),d&&d.invalidate(),p=(0,t.create_out_transition)(u,v.fadeTransition,{duration:250}),m&&m.invalidate(),f=(0,t.create_out_transition)(n,v.fadeOpacityTransition,{delay:50,duration:500}),g=!1},d(e){e&&(0,t.detach)(n),(0,t.destroy_component)(a),(0,t.destroy_component)(i),(0,t.destroy_component)(c),e&&p&&p.end(),e&&f&&f.end()}}}function x(n,r,o){let a;(0,t.component_subscribe)(n,f.localize,e=>o(3,a=e));const s=(0,g.createEventDispatcher)(),{world:i}=(0,$.context)(),l=(0,k.default)().haikusPerBiome;let u,{lines:d}=r,{tokens:p}=r,{store:m}=r,_=!1,v=f.language.get();const y=m.subscribe(e=>{u=e}),b=["forest","grasslands","tundra"];return(0,g.onMount)(()=>{m.update(t=>e({},t,{playing:!1})),o(2,_=!1);const t=f.language.subscribe(e=>{v=e});return()=>{y(),t()}}),n.$$set=(e=>{"lines"in e&&o(0,d=e.lines),"tokens"in e&&o(1,p=e.tokens),"store"in e&&o(6,m=e.store)}),n.$$.update=(()=>{3&n.$$.dirty&&o(2,_=!1)}),[d,p,_,a,function(){o(2,_=!0),s("close")},function(){const e=i.query(c.HaikuInInventory),t=i.findEntity(c.ActiveEnvironmentState),n=t?t.get(c.EnvironmentState).name:"forest";return{biome:n,biomeIndex:b.includes(n)?b.indexOf(n):0,haikusCollected:Math.min(l,Math.max(0,e.entities.length))}},m]}class P extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,x,O,t.safe_not_equal,{lines:0,tokens:1,store:6})}}exports.default=P;
},{"svelte/internal":226,"../util/tokens":138,"../components/ImageButton.svelte":739,"../components/AbsoluteOverlay.svelte":845,"../components/HaikuInventory.svelte":832,"../tags":60,"../assets/image/ui/ico_paperJournal1-rotated.png":502,"../components/GameProgress.svelte":846,"../util/locale":227,"svelte":220,"../animations/transitions":689,"../alec-svelte":225,"../components/HaikuCard.svelte":847,"../config":28}],773:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),t=require("svelte/transition"),n=require("svelte"),r=require("../assets/image/svg/icon-touch.svg"),a=i(r);function i(e){return e&&e.__esModule?e:{default:e}}function s(n){let r,i,s,l,o,d,u,c,p,v;return{c(){r=(0,e.element)("div"),i=(0,e.element)("div"),s=(0,e.element)("div"),l=(0,e.element)("img"),d=(0,e.space)(),(u=(0,e.element)("p")).textContent=`${n[0]?"tap + hold":"click + hold"} to explore`,l.src!==(o=a.default)&&(0,e.attr)(l,"src",o),(0,e.attr)(l,"alt",""),(0,e.attr)(s,"class","image-container svelte-1rmuk9w"),(0,e.attr)(u,"class","svelte-1rmuk9w"),(0,e.attr)(i,"class","info svelte-1rmuk9w"),(0,e.attr)(r,"class","container svelte-1rmuk9w")},m(t,n){(0,e.insert)(t,r,n),(0,e.append)(r,i),(0,e.append)(i,s),(0,e.append)(s,l),(0,e.append)(i,d),(0,e.append)(i,u),v=!0},p:e.noop,i(n){v||((0,e.add_render_callback)(()=>{p&&p.end(1),c||(c=(0,e.create_in_transition)(r,t.fade,{delay:1e3,duration:1500})),c.start()}),v=!0)},o(n){c&&c.invalidate(),p=(0,e.create_out_transition)(r,t.fade,{duration:800}),v=!1},d(t){t&&(0,e.detach)(r),t&&p&&p.end()}}}function l(e){return[/(Android|iOS|iPad|iPod|iPhone)/i.test(navigator.userAgent)]}class o extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,l,s,e.safe_not_equal,{})}}exports.default=o;
},{"svelte/internal":226,"svelte/transition":687,"svelte":220,"../assets/image/svg/icon-touch.svg":402}],876:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},e=require("svelte/internal"),n=require("../util/tokens"),r=require("svelte/easing"),i=require("./Image.svelte"),o=c(i),a=require("../util/Assets"),s=c(a);function c(t){return t&&t.__esModule?t:{default:t}}function l(t){let n,r,i,a;return r=new o.default({props:{id:_}}),{c(){n=(0,e.element)("div"),(0,e.create_component)(r.$$.fragment),(0,e.attr)(n,"class","img-container svelte-1xnqt9x")},m(t,i){(0,e.insert)(t,n,i),(0,e.mount_component)(r,n,null),a=!0},p:e.noop,i(o){a||((0,e.transition_in)(r.$$.fragment,o),(0,e.add_render_callback)(()=>{i||(i=(0,e.create_bidirectional_transition)(n,t[2],{},!0)),i.run(1)}),a=!0)},o(o){(0,e.transition_out)(r.$$.fragment,o),i||(i=(0,e.create_bidirectional_transition)(n,t[2],{},!1)),i.run(0),a=!1},d(t){t&&(0,e.detach)(n),(0,e.destroy_component)(r),t&&i&&i.end()}}}function u(t){let n,r,i,o,a;return{c(){n=(0,e.element)("div"),(r=(0,e.element)("img")).src!==(i=t[0])&&(0,e.attr)(r,"src",i),(0,e.attr)(r,"alt",""),(0,e.attr)(r,"class","svelte-1xnqt9x"),(0,e.attr)(n,"class","img-container svelte-1xnqt9x")},m(t,i){(0,e.insert)(t,n,i),(0,e.append)(n,r),a=!0},p(t,n){(!a||1&n&&r.src!==(i=t[0]))&&(0,e.attr)(r,"src",i)},i(r){a||((0,e.add_render_callback)(()=>{o||(o=(0,e.create_bidirectional_transition)(n,t[2],{},!0)),o.run(1)}),a=!0)},o(r){o||(o=(0,e.create_bidirectional_transition)(n,t[2],{},!1)),o.run(0),a=!1},d(t){t&&(0,e.detach)(n),t&&o&&o.end()}}}function d(t){let n,r,i,o,a,s=!t[1]&&l(t),c=t[1]&&u(t);return{c(){n=(0,e.element)("div"),r=(0,e.element)("div"),s&&s.c(),i=(0,e.space)(),o=(0,e.element)("div"),c&&c.c(),(0,e.attr)(r,"class","outline svelte-1xnqt9x"),(0,e.attr)(o,"class","content svelte-1xnqt9x"),(0,e.attr)(n,"class","container svelte-1xnqt9x")},m(t,l){(0,e.insert)(t,n,l),(0,e.append)(n,r),s&&s.m(r,null),(0,e.append)(n,i),(0,e.append)(n,o),c&&c.m(o,null),a=!0},p(t,[n]){t[1]?s&&((0,e.group_outros)(),(0,e.transition_out)(s,1,1,()=>{s=null}),(0,e.check_outros)()):s?(s.p(t,n),2&n&&(0,e.transition_in)(s,1)):((s=l(t)).c(),(0,e.transition_in)(s,1),s.m(r,null)),t[1]?c?(c.p(t,n),2&n&&(0,e.transition_in)(c,1)):((c=u(t)).c(),(0,e.transition_in)(c,1),c.m(o,null)):c&&((0,e.group_outros)(),(0,e.transition_out)(c,1,1,()=>{c=null}),(0,e.check_outros)())},i(t){a||((0,e.transition_in)(s),(0,e.transition_in)(c),a=!0)},o(t){(0,e.transition_out)(s),(0,e.transition_out)(c),a=!1},d(t){t&&(0,e.detach)(n),s&&s.d(),c&&c.d()}}}const _="image/ui/ico_emptytoken";function p(t,{delay:e=0,duration:n=200,easing:r=(t=>t),baseScale:i=0}){const o=+getComputedStyle(t).opacity,a=getComputedStyle(t).transform.match(/scale\(([0-9.]+)\)/),s=a?a[1]:1,c=1-i;return{delay:e,duration:n,css:t=>{const e=r(t);return`opacity: ${e*o}; transform: scale(${e*s*c+i})`}}}function m(e,i,o){s.default.prepare(_);let{src:a=null}=i,{collected:c=!1}=i;return e.$$set=(t=>{"src"in t&&o(0,a=t.src),"collected"in t&&o(1,c=t.collected)}),[a,c,(e,n)=>p(e,t({delay:0,duration:1e3,easing:r.cubicInOut,baseScale:.5},n)),function(t){o(0,a=t?n.CollectedTokenURLs[t]:null),o(1,c=Boolean(t&&a))}]}class f extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,m,d,e.safe_not_equal,{src:0,collected:1,setToken:3})}get setToken(){return this.$$.ctx[3]}}exports.default=f;
},{"svelte/internal":226,"../util/tokens":138,"svelte/easing":779,"./Image.svelte":690,"../util/Assets":31}],833:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("svelte/internal"),e=require("./TokenInventorySlot.svelte"),n=l(e),o=require("svelte"),r=require("../animations/transitions");function l(t){return t&&t.__esModule?t:{default:t}}function s(t,e,n){const o=t.slice();return o[3]=e[n],o[4]=e,o[5]=n,o}function i(e){let o,r,l=e[5];const s=()=>e[2](o,l),i=()=>e[2](null,l);return o=new n.default({props:{}}),s(),{c(){(0,t.create_component)(o.$$.fragment)},m(e,n){(0,t.mount_component)(o,e,n),r=!0},p(t,e){l!==t[5]&&(i(),l=t[5],s());o.$set({})},i(e){r||((0,t.transition_in)(o.$$.fragment,e),r=!0)},o(e){(0,t.transition_out)(o.$$.fragment,e),r=!1},d(e){i(),(0,t.destroy_component)(o,e)}}}function u(e){let n,o,r,l=e[0],u=[];for(let t=0;t<l.length;t+=1)u[t]=i(s(e,l,t));const a=e=>(0,t.transition_out)(u[e],1,1,()=>{u[e]=null});return{c(){n=(0,t.element)("div"),o=(0,t.element)("div");for(let t=0;t<u.length;t+=1)u[t].c();(0,t.attr)(o,"class","row svelte-l0oa72"),(0,t.attr)(n,"class","container svelte-l0oa72")},m(e,l){(0,t.insert)(e,n,l),(0,t.append)(n,o);for(let t=0;t<u.length;t+=1)u[t].m(o,null);r=!0},p(e,[n]){if(1&n){let r;for(l=e[0],r=0;r<l.length;r+=1){const a=s(e,l,r);u[r]?(u[r].p(a,n),(0,t.transition_in)(u[r],1)):(u[r]=i(a),u[r].c(),(0,t.transition_in)(u[r],1),u[r].m(o,null))}for((0,t.group_outros)(),r=l.length;r<u.length;r+=1)a(r);(0,t.check_outros)()}},i(e){if(!r){for(let e=0;e<l.length;e+=1)(0,t.transition_in)(u[e]);r=!0}},o(e){u=u.filter(Boolean);for(let e=0;e<u.length;e+=1)(0,t.transition_out)(u[e]);r=!1},d(e){e&&(0,t.detach)(n),(0,t.destroy_each)(u,e)}}}function a(e,n,r){let{store:l}=n,s=new Array(3).fill(null);return(0,o.onMount)(()=>{const t=l.subscribe(t=>{const e=t.tokensCollected||[];for(let t=0;t<s.length;t++)s[t].setToken(e[t])});return()=>{t()}}),e.$$set=(t=>{"store"in t&&r(1,l=t.store)}),[s,l,function(e,n){t.binding_callbacks[e?"unshift":"push"](()=>{s[n]=e,r(0,s)})}]}class c extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,a,u,t.safe_not_equal,{store:1})}}exports.default=c;
},{"svelte/internal":226,"./TokenInventorySlot.svelte":876,"svelte":220,"../animations/transitions":689}],774:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},n=require("svelte/internal"),e=require("../components/HaikuInventory.svelte"),o=g(e),i=require("../components/TokenInventory.svelte"),r=g(i),a=require("svelte"),s=require("../components/CornerMenuButton.svelte"),u=g(s),c=require("../util/Assets"),p=g(c),l=require("../alec-svelte"),m=require("../tags"),_=d(m),f=require("../nfb");function d(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n.default=t,n}function g(t){return t&&t.__esModule?t:{default:t}}function $(t){let e,o;return(e=new u.default({props:{style:"top: 8px; left: 6px",image:t[5]}})).$on("click",t[14]),{c(){(0,n.create_component)(e.$$.fragment)},m(t,i){(0,n.mount_component)(e,t,i),o=!0},p:n.noop,i(t){o||((0,n.transition_in)(e.$$.fragment,t),o=!0)},o(t){(0,n.transition_out)(e.$$.fragment,t),o=!1},d(t){(0,n.destroy_component)(e,t)}}}function v(t){let e,o,i,a;return e=new r.default({props:{store:t[0]}}),(i=new u.default({props:{size:"large",style:"top: 7px; right: 7px",image:t[7]}})).$on("click",t[15]),{c(){(0,n.create_component)(e.$$.fragment),o=(0,n.space)(),(0,n.create_component)(i.$$.fragment)},m(t,r){(0,n.mount_component)(e,t,r),(0,n.insert)(t,o,r),(0,n.mount_component)(i,t,r),a=!0},p(t,n){const o={};1&n&&(o.store=t[0]),e.$set(o)},i(t){a||((0,n.transition_in)(e.$$.fragment,t),(0,n.transition_in)(i.$$.fragment,t),a=!0)},o(t){(0,n.transition_out)(e.$$.fragment,t),(0,n.transition_out)(i.$$.fragment,t),a=!1},d(t){(0,n.destroy_component)(e,t),t&&(0,n.detach)(o),(0,n.destroy_component)(i,t)}}}function h(t){let e,o,i,r=t[1]&&k(t),a={image:t[6],style:"bottom: 12px; right: 10px",id:T};return o=new u.default({props:a}),t[17](o),o.$on("click",t[18]),{c(){r&&r.c(),e=(0,n.space)(),(0,n.create_component)(o.$$.fragment)},m(t,a){r&&r.m(t,a),(0,n.insert)(t,e,a),(0,n.mount_component)(o,t,a),i=!0},p(t,i){t[1]?r?(r.p(t,i),2&i&&(0,n.transition_in)(r,1)):((r=k(t)).c(),(0,n.transition_in)(r,1),r.m(e.parentNode,e)):r&&((0,n.group_outros)(),(0,n.transition_out)(r,1,1,()=>{r=null}),(0,n.check_outros)());o.$set({})},i(t){i||((0,n.transition_in)(r),(0,n.transition_in)(o.$$.fragment,t),i=!0)},o(t){(0,n.transition_out)(r),(0,n.transition_out)(o.$$.fragment,t),i=!1},d(i){r&&r.d(i),i&&(0,n.detach)(e),t[17](null),(0,n.destroy_component)(o,i)}}}function k(t){let e,i;return(e=new o.default({props:{store:t[0]}})).$on("journal",t[16]),{c(){(0,n.create_component)(e.$$.fragment)},m(t,o){(0,n.mount_component)(e,t,o),i=!0},p(t,n){const o={};1&n&&(o.store=t[0]),e.$set(o)},i(t){i||((0,n.transition_in)(e.$$.fragment,t),i=!0)},o(t){(0,n.transition_out)(e.$$.fragment,t),i=!1},d(t){(0,n.destroy_component)(e,t)}}}function y(t){let e,o,i,r,a=!t[2]&&$(t),s=t[1]&&v(t),u=t[3]>0&&!t[2]&&h(t);return{c(){a&&a.c(),e=(0,n.space)(),s&&s.c(),o=(0,n.space)(),u&&u.c(),i=(0,n.empty)()},m(t,c){a&&a.m(t,c),(0,n.insert)(t,e,c),s&&s.m(t,c),(0,n.insert)(t,o,c),u&&u.m(t,c),(0,n.insert)(t,i,c),r=!0},p(t,[r]){t[2]?a&&((0,n.group_outros)(),(0,n.transition_out)(a,1,1,()=>{a=null}),(0,n.check_outros)()):a?(a.p(t,r),4&r&&(0,n.transition_in)(a,1)):((a=$(t)).c(),(0,n.transition_in)(a,1),a.m(e.parentNode,e)),t[1]?s?(s.p(t,r),2&r&&(0,n.transition_in)(s,1)):((s=v(t)).c(),(0,n.transition_in)(s,1),s.m(o.parentNode,o)):s&&((0,n.group_outros)(),(0,n.transition_out)(s,1,1,()=>{s=null}),(0,n.check_outros)()),t[3]>0&&!t[2]?u?(u.p(t,r),12&r&&(0,n.transition_in)(u,1)):((u=h(t)).c(),(0,n.transition_in)(u,1),u.m(i.parentNode,i)):u&&((0,n.group_outros)(),(0,n.transition_out)(u,1,1,()=>{u=null}),(0,n.check_outros)())},i(t){r||((0,n.transition_in)(a),(0,n.transition_in)(s),(0,n.transition_in)(u),r=!0)},o(t){(0,n.transition_out)(a),(0,n.transition_out)(s),(0,n.transition_out)(u),r=!1},d(t){a&&a.d(t),t&&(0,n.detach)(e),s&&s.d(t),t&&(0,n.detach)(o),u&&u.d(t),t&&(0,n.detach)(i)}}}const b="image/ui/btn_pause",T="image/ui/ico_journal",x="image/ui/compass3";function H(e,o,i){p.default.prepare([b,T,x]);const r=p.default.load(b),s=p.default.load(T),u=p.default.load(x),c=(0,a.createEventDispatcher)(),{world:m}=(0,l.context)(),d=m.entity();let g,{store:$}=o,{moving:v=!1}=o,{canCollectTokens:h=!1}=o,{finishedHaikus:k=[]}=o,{currentHaiku:y=!1}=o,H=0;const q=()=>{g&&g.notify()};function w(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const n=m.findTag(_.UserTarget).position;d.tagOn(_.CompassVisible),d.get(_.CompassVisible).position.copy(n),(0,f.sendAnalytics)({event:"compass_open",eventLabel:"compass_open"})}$.update(n=>t({},n,{onNotifyHaiku:q})),(0,a.onMount)(()=>{const t=$.subscribe(t=>{i(3,H=t.finishedHaikus.length)});return()=>{t()}});return e.$$set=(t=>{"store"in t&&i(0,$=t.store),"moving"in t&&i(12,v=t.moving),"canCollectTokens"in t&&i(1,h=t.canCollectTokens),"finishedHaikus"in t&&i(13,k=t.finishedHaikus),"currentHaiku"in t&&i(2,y=t.currentHaiku)}),[$,h,y,H,g,r,s,u,c,m,d,w,v,k,t=>{m.findTag(_.ShowBiomeResolution)||m.findTag(_.TransitionToNextBiome)||(t.preventDefault(),t.stopImmediatePropagation(),d.tagOff(_.ButtonClick),d.tagOn(_.ButtonClick),c("pause"),(0,f.sendAnalytics)({event:"menu_open",eventLabel:"menu_open"}))},t=>{w(t)},function(t){(0,n.bubble)(e,t)},function(t){n.binding_callbacks[t?"unshift":"push"](()=>{i(4,g=t)})},t=>{m.findTag(_.ShowBiomeResolution)||m.findTag(_.TransitionToNextBiome)||(c("journal"),(0,f.sendAnalytics)({event:"journal_open",eventLabel:"journal_open"}))}]}class q extends n.SvelteComponent{constructor(t){super(),(0,n.init)(this,t,H,y,n.safe_not_equal,{store:0,moving:12,canCollectTokens:1,finishedHaikus:13,currentHaiku:2})}}exports.default=q;
},{"svelte/internal":226,"../components/HaikuInventory.svelte":832,"../components/TokenInventory.svelte":833,"svelte":220,"../components/CornerMenuButton.svelte":834,"../util/Assets":31,"../alec-svelte":225,"../tags":60,"../nfb":75}],878:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/transition.231b1c59.mp4";
},{}],740:[function(require,module,exports) {
"use strict";function e({parentWidth:e,parentHeight:t,childWidth:i,childHeight:n,fit:o="contain",scale:c=1,offsetX:s=.5,offsetY:l=.5}){const f=i/n,a=e/t;let r=i*c,d=n*c,h=0,u=0;if("scale-down"===o){const o=Math.min(e/i,t/n);r=i*c*o,d=n*c*o}else if("contain"===o||"cover"===o){r=e*c,d=t*c,("contain"===o?f>a:f<a)?d=r/f:r=d*f}else"fill"===o&&(r=e*c,d=t*c);return[h=(e-r)*s,u=(t-d)*l,r,d]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],835:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},t=require("svelte/internal"),n=require("svelte"),i=require("../assets/video/transition.mp4"),a=d(i),r=require("../animations/transitions"),o=require("../util/objectFit"),s=d(o);function d(e){return e&&e.__esModule?e:{default:e}}const{window:l}=t.globals;function u(n){let i,o,s,d,u,c,p,f;return{c(){i=(0,t.element)("div"),o=(0,t.element)("video"),(0,t.attr)(o,"class","leaf-video svelte-fpz107"),o.autoplay=!0,o.muted=!0,o.playsInline=!0,o.src!==(s=a.default)&&(0,t.attr)(o,"src",s),(0,t.attr)(i,"class","leaf-video-container svelte-fpz107")},m(e,a){(0,t.insert)(e,i,a),(0,t.append)(i,o),n[4](o),c=!0,p||(f=(0,t.listen)(l,"resize",n[3],{passive:!0}),p=!0)},p(e,[t]){n=e},i(i){c||((0,t.add_render_callback)(()=>{u&&u.end(1),d||(d=(0,t.create_in_transition)(o,r.fadeInTransition,e({delay:0,y:0},n[0]))),d.start()}),c=!0)},o(i){d&&d.invalidate(),u=(0,t.create_out_transition)(o,r.fadeInTransition,e({y:0},n[1])),c=!1},d(e){e&&(0,t.detach)(i),n[4](null),e&&u&&u.end(),p=!1,f()}}}function c(e,i,a){let r,o,{fadeInOptions:d={}}=i,{fadeOutOptions:l={}}=i,u=new Promise(e=>{o=e});function c(){r&&(r.readyState<=0?u.then(()=>p()):p())}function p(){if(r){const[e,t,n,i]=(0,s.default)({parentWidth:window.innerWidth,parentHeight:window.innerHeight,childWidth:r.videoWidth,childHeight:r.videoHeight,fit:window.innerWidth<window.innerHeight?"cover":"contain"});window.innerWidth,window.innerHeight;Object.assign(r.style,{left:`${e}px`,top:`${t}px`,width:`${n}px`,height:`${i}px`})}}return(0,n.onMount)(()=>{let e=()=>{};return r.readyState<=0?(r.addEventListener("loadedmetadata",o),e=(()=>r.removeEventListener("loadedmetadata",o))):o(),c(),a(2,r.muted=!0,r),r.play(),()=>{r&&r.pause(),e()}}),e.$$set=(e=>{"fadeInOptions"in e&&a(0,d=e.fadeInOptions),"fadeOutOptions"in e&&a(1,l=e.fadeOutOptions)}),[d,l,r,c,function(e){t.binding_callbacks[e?"unshift":"push"](()=>{a(2,r=e)})}]}class p extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,c,u,t.safe_not_equal,{fadeInOptions:0,fadeOutOptions:1})}}exports.default=p;
},{"svelte/internal":226,"svelte":220,"../assets/video/transition.mp4":878,"../animations/transitions":689,"../util/objectFit":740}],775:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("svelte/internal"),n=require("svelte"),e=require("../animations/transitions"),o=require("../util/locale"),i=require("../components/Image.svelte"),r=u(i),a=require("../components/LeafVideo.svelte"),s=u(a);function u(t){return t&&t.__esModule?t:{default:t}}function d(n){let e,o;return e=new s.default({props:{fadeInOptions:{delay:0,duration:2e3},fadeOutOptions:{delay:2e3,duration:500}}}),{c(){(0,t.create_component)(e.$$.fragment)},m(n,i){(0,t.mount_component)(e,n,i),o=!0},i(n){o||((0,t.transition_in)(e.$$.fragment,n),o=!0)},o(n){(0,t.transition_out)(e.$$.fragment,n),o=!1},d(n){(0,t.destroy_component)(e,n)}}}function l(n){let o,i,a,s,u,d,l,c,_,p=n[2].introPresents+"";return(o=new r.default({props:{inTransition:(0,e.transition)(e.fadeInTransition,{duration:1500}),outTransition:(0,e.transition)(e.fadeOutTransition,{delay:2e3}),width:"150px",id:"image/svg/nfblogo"}})).$on("introend",n[4]),o.$on("outroend",n[5]),o.$on("outrostart",n[6]),{c(){(0,t.create_component)(o.$$.fragment),i=(0,t.space)(),a=(0,t.element)("div"),s=(0,t.text)(p),(0,t.attr)(a,"class","presented svelte-1th3gw3")},m(e,r){(0,t.mount_component)(o,e,r),(0,t.insert)(e,i,r),(0,t.insert)(e,a,r),(0,t.append)(a,s),l=!0,c||(_=(0,t.listen)(a,"introend",n[7]),c=!0)},p(n,e){(!l||4&e)&&p!==(p=n[2].introPresents+"")&&(0,t.set_data)(s,p)},i(n){l||((0,t.transition_in)(o.$$.fragment,n),(0,t.add_render_callback)(()=>{d&&d.end(1),u||(u=(0,t.create_in_transition)(a,e.fadeInTransition,{delay:500,duration:1250})),u.start()}),l=!0)},o(n){(0,t.transition_out)(o.$$.fragment,n),u&&u.invalidate(),d=(0,t.create_out_transition)(a,e.fadeOutTransition,{delay:1750}),l=!1},d(n){(0,t.destroy_component)(o,n),n&&(0,t.detach)(i),n&&(0,t.detach)(a),n&&d&&d.end(),c=!1,_()}}}function c(n){let e,o,i,r=n[1]&&d(n),a=n[0]&&l(n);return{c(){e=(0,t.element)("main"),r&&r.c(),o=(0,t.space)(),a&&a.c(),(0,t.attr)(e,"class","svelte-1th3gw3")},m(n,s){(0,t.insert)(n,e,s),r&&r.m(e,null),(0,t.append)(e,o),a&&a.m(e,null),i=!0},p(n,[i]){n[1]?r?2&i&&(0,t.transition_in)(r,1):((r=d(n)).c(),(0,t.transition_in)(r,1),r.m(e,o)):r&&((0,t.group_outros)(),(0,t.transition_out)(r,1,1,()=>{r=null}),(0,t.check_outros)()),n[0]?a?(a.p(n,i),1&i&&(0,t.transition_in)(a,1)):((a=l(n)).c(),(0,t.transition_in)(a,1),a.m(e,null)):a&&((0,t.group_outros)(),(0,t.transition_out)(a,1,1,()=>{a=null}),(0,t.check_outros)())},i(n){i||((0,t.transition_in)(r),(0,t.transition_in)(a),i=!0)},o(n){(0,t.transition_out)(r),(0,t.transition_out)(a),i=!1},d(n){n&&(0,t.detach)(e),r&&r.d(),a&&a.d()}}}function _(e,i,r){let a;(0,t.component_subscribe)(e,o.localize,t=>r(2,a=t));const s=(0,n.createEventDispatcher)();let u=!0,d=!0;(0,n.onMount)(()=>()=>{});return[u,d,a,s,()=>{r(0,u=!1)},()=>{s("end")},()=>{r(1,d=!1)},()=>{s("inbetween")}]}class p extends t.SvelteComponent{constructor(n){super(),(0,t.init)(this,n,_,c,t.safe_not_equal,{})}}exports.default=p;
},{"svelte/internal":226,"svelte":220,"../animations/transitions":689,"../util/locale":227,"../components/Image.svelte":690,"../components/LeafVideo.svelte":835}],688:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},e=require("svelte/internal"),n=require("../util/math"),i=c(n),a=require("../util/Random"),r=s(a),l=require("../animations/transitions"),o=require("svelte");function s(t){return t&&t.__esModule?t:{default:t}}function c(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function u(t,e,n){const i=t.slice();return i[10]=e[n],i}function d(n){let i,a,r,o,s,c=n[10].value+"";return{c(){i=(0,e.element)("span"),a=(0,e.text)(c),(0,e.attr)(i,"style",r=`min-width: ${n[10].whitespace?v:0}px;`),(0,e.attr)(i,"class","text-node svelte-niwj3w"),(0,e.toggle_class)(i,"whitespace",n[10].whitespace)},m(t,n){(0,e.insert)(t,i,n),(0,e.append)(i,a),s=!0},p(t,l){n=t,(!s||8&l)&&c!==(c=n[10].value+"")&&(0,e.set_data)(a,c),(!s||8&l&&r!==(r=`min-width: ${n[10].whitespace?v:0}px;`))&&(0,e.attr)(i,"style",r),8&l&&(0,e.toggle_class)(i,"whitespace",n[10].whitespace)},i(a){s||((0,e.add_render_callback)(()=>{o||(o=(0,e.create_bidirectional_transition)(i,l.fadeTransition,t({},n[10],{delay:n[0]+n[10].delay}),!0)),o.run(1)}),s=!0)},o(a){o||(o=(0,e.create_bidirectional_transition)(i,l.fadeTransition,t({},n[10],{delay:n[0]+n[10].delay}),!1)),o.run(0),s=!1},d(t){t&&(0,e.detach)(i),t&&o&&o.end()}}}function f(t){let n,i,a,r=t[3],o=[];for(let e=0;e<r.length;e+=1)o[e]=d(u(t,r,e));const s=t=>(0,e.transition_out)(o[t],1,1,()=>{o[t]=null});return{c(){n=(0,e.element)("p");for(let t=0;t<o.length;t+=1)o[t].c();(0,e.set_style)(n,"letter-spacing",y+"px"),(0,e.set_style)(n,"font-size",_+"px"),(0,e.set_style)(n,"font-weight",g),(0,e.set_style)(n,"font-style",h),(0,e.attr)(n,"class","svelte-niwj3w")},m(t,i){(0,e.insert)(t,n,i);for(let t=0;t<o.length;t+=1)o[t].m(n,null);a=!0},p(i,[a]){if(t=i,9&a){let i;for(r=t[3],i=0;i<r.length;i+=1){const l=u(t,r,i);o[i]?(o[i].p(l,a),(0,e.transition_in)(o[i],1)):(o[i]=d(l),o[i].c(),(0,e.transition_in)(o[i],1),o[i].m(n,null))}for((0,e.group_outros)(),i=r.length;i<o.length;i+=1)s(i);(0,e.check_outros)()}},i(s){if(!a){for(let t=0;t<r.length;t+=1)(0,e.transition_in)(o[t]);(0,e.add_render_callback)(()=>{i||(i=(0,e.create_bidirectional_transition)(n,l.fadeTransition,{opacity:1,y:t[2],endX:t[1],endY:t[2]},!0)),i.run(1)}),a=!0}},o(r){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)(0,e.transition_out)(o[t]);i||(i=(0,e.create_bidirectional_transition)(n,l.fadeTransition,{opacity:1,y:t[2],endX:t[1],endY:t[2]},!1)),i.run(0),a=!1},d(t){t&&(0,e.detach)(n),(0,e.destroy_each)(o,t),t&&i&&i.end()}}}const p=(0,r.default)(),_=18,y=.5,h="italic",g=300,x='"Enreal", sans-serif',m=5;let v=5;function w(){const t=document.createElement("canvas").getContext("2d");t.font=`${h} ${g} ${_}px ${x}`;const e=t.measureText(" ").width;null!=e&&e>0&&isFinite(e)&&(v=e+y)}function $(t,e,n){const a=(0,o.createEventDispatcher)();let{text:r=""}=e,{delay:l=0}=e,{duration:s=null}=e,{x:c=0}=e,{y:u=0}=e;const d=[];let f,_=[];return null!=s&&(f=setTimeout(()=>{a("kill")},s)),(0,o.onMount)(()=>()=>{clearTimeout(f)}),t.$$set=(t=>{"text"in t&&n(4,r=t.text),"delay"in t&&n(0,l=t.delay),"duration"in t&&n(5,s=t.duration),"x"in t&&n(1,c=t.x),"y"in t&&n(2,u=t.y)}),t.$$.update=(()=>{16&t.$$.dirty&&n(3,_=function(t=""){const e=2e3/t.length;return i.degToRad(0),t.split("").map((t,n)=>{const a=/\s/.test(t),[r,l]=p.insideCircle(10,d);return{value:a?" ":t,whitespace:a,angle:p.gaussian(0,i.degToRad(2)),delay:n*e+p.gaussian(0,1),duration:p.range(1500,2e3),x:r,y:l}})}(r))}),[l,c,u,_,r,s]}document.fonts.ready.then(()=>{w()});class b extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,$,f,e.safe_not_equal,{text:4,delay:0,duration:5,x:1,y:2})}}exports.default=b;
},{"svelte/internal":226,"../util/math":240,"../util/Random":235,"../animations/transitions":689,"svelte":220}],776:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),t=require("svelte/transition"),n=require("svelte"),o=require("../alec-svelte"),r=require("../tags"),i=m(r),a=require("../config"),s=p(a),u=require("../components/AnimatedTextSpan.svelte"),l=p(u),d=require("../animations/transitions"),c=require("../components/LeafVideo.svelte"),f=p(c);function p(e){return e&&e.__esModule?e:{default:e}}function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _(t){let n,o,r,i,a;return o=new f.default({props:{fadeInOptions:{delay:0,duration:500},fadeOutOptions:{delay:0,duration:500}}}),{c(){n=(0,e.element)("div"),(0,e.create_component)(o.$$.fragment),(0,e.attr)(n,"class","container svelte-xjm3ff")},m(t,r){(0,e.insert)(t,n,r),(0,e.mount_component)(o,n,null),a=!0},p:e.noop,i(t){a||((0,e.transition_in)(o.$$.fragment,t),(0,e.add_render_callback)(()=>{i&&i.end(1),r||(r=(0,e.create_in_transition)(n,d.fadeInTransition,{y:0,delay:0,duration:1e3})),r.start()}),a=!0)},o(t){(0,e.transition_out)(o.$$.fragment,t),r&&r.invalidate(),i=(0,e.create_out_transition)(n,d.fadeInTransition,{y:0,delay:0,duration:1e3}),a=!1},d(t){t&&(0,e.detach)(n),(0,e.destroy_component)(o),t&&i&&i.end()}}}const v=0;function y(e){let t;return(0,n.onMount)(()=>()=>{}),(0,n.onMount)(()=>{console.log("mount transition!"),t=setTimeout(()=>{console.log("do world swap!");const e=world.findEntity(i.TransitionToNextBiome);e&&!(0,s.default)().demo&&e.add(i.SafeToSwapBiomes)},1250)}),[]}class q extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,y,_,e.safe_not_equal,{})}}exports.default=q;
},{"svelte/internal":226,"svelte/transition":687,"svelte":220,"../alec-svelte":225,"../tags":60,"../config":28,"../components/AnimatedTextSpan.svelte":688,"../animations/transitions":689,"../components/LeafVideo.svelte":835}],264:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},n=require("svelte/internal"),e=require("./GamePageLanding.svelte"),o=O(e),r=require("./About.svelte"),i=O(r),a=require("../config"),s=O(a),u=require("./HaikuPopup.svelte"),c=O(u),l=require("./PoemCollectionOverlay.svelte"),p=O(l),m=require("./SimpleHintOverlay.svelte"),d=O(m),_=require("./GameHUD.svelte"),f=O(_),$=require("./GameUIIntro.svelte"),g=O($),v=require("svelte"),y=require("./TransitionOverlay.svelte"),h=O(y),k=require("three"),b=require("../nfb"),q=require("../alec-svelte"),w=require("../tags"),H=T(w);function T(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n.default=t,n}function O(t){return t&&t.__esModule?t:{default:t}}function j(t){let e,o;return(e=new f.default({props:{moving:t[11],canCollectTokens:t[10],finishedHaikus:t[8],store:t[0],currentHaiku:t[2]}})).$on("journal",t[16]),e.$on("pause",t[17]),{c(){(0,n.create_component)(e.$$.fragment)},m(t,r){(0,n.mount_component)(e,t,r),o=!0},p(t,n){const o={};2048&n&&(o.moving=t[11]),1024&n&&(o.canCollectTokens=t[10]),256&n&&(o.finishedHaikus=t[8]),1&n&&(o.store=t[0]),4&n&&(o.currentHaiku=t[2]),e.$set(o)},i(t){o||((0,n.transition_in)(e.$$.fragment,t),o=!0)},o(t){(0,n.transition_out)(e.$$.fragment,t),o=!1},d(t){(0,n.destroy_component)(e,t)}}}function C(t){let e,o,r=t[2]&&G(t);return{c(){r&&r.c(),e=(0,n.empty)()},m(t,i){r&&r.m(t,i),(0,n.insert)(t,e,i),o=!0},p(t,o){t[2]?r?(r.p(t,o),4&o&&(0,n.transition_in)(r,1)):((r=G(t)).c(),(0,n.transition_in)(r,1),r.m(e.parentNode,e)):r&&((0,n.group_outros)(),(0,n.transition_out)(r,1,1,()=>{r=null}),(0,n.check_outros)())},i(t){o||((0,n.transition_in)(r),o=!0)},o(t){(0,n.transition_out)(r),o=!1},d(t){r&&r.d(t),t&&(0,n.detach)(e)}}}function P(t){let e,o;return(e=new p.default({props:{poems:t[8]}})).$on("close",t[22]),{c(){(0,n.create_component)(e.$$.fragment)},m(t,r){(0,n.mount_component)(e,t,r),o=!0},p(t,n){const o={};256&n&&(o.poems=t[8]),e.$set(o)},i(t){o||((0,n.transition_in)(e.$$.fragment,t),o=!0)},o(t){(0,n.transition_out)(e.$$.fragment,t),o=!1},d(t){(0,n.destroy_component)(e,t)}}}function N(t){let e,o,r,i;const a=[D,A],s=[];function u(t,n){return t[13]?0:1}return e=u(t),o=s[e]=a[e](t),{c(){o.c(),r=(0,n.empty)()},m(t,o){s[e].m(t,o),(0,n.insert)(t,r,o),i=!0},p(t,i){let c=e;(e=u(t))===c?s[e].p(t,i):((0,n.group_outros)(),(0,n.transition_out)(s[c],1,1,()=>{s[c]=null}),(0,n.check_outros)(),(o=s[e])?o.p(t,i):(o=s[e]=a[e](t)).c(),(0,n.transition_in)(o,1),o.m(r.parentNode,r))},i(t){i||((0,n.transition_in)(o),i=!0)},o(t){(0,n.transition_out)(o),i=!1},d(t){s[e].d(t),t&&(0,n.detach)(r)}}}function S(t){let e,o;return e=new h.default({}),{c(){(0,n.create_component)(e.$$.fragment)},m(t,r){(0,n.mount_component)(e,t,r),o=!0},p:n.noop,i(t){o||((0,n.transition_in)(e.$$.fragment,t),o=!0)},o(t){(0,n.transition_out)(e.$$.fragment,t),o=!1},d(t){(0,n.destroy_component)(e,t)}}}function x(t){let e;return{c(){e=(0,n.element)("div")},m(t,o){(0,n.insert)(t,e,o)},p:n.noop,i:n.noop,o:n.noop,d(t){t&&(0,n.detach)(e)}}}function G(t){let e,o;return(e=new c.default({props:{store:t[0],lines:t[2].lines,tokens:t[2].tokens}})).$on("close",t[14]),{c(){(0,n.create_component)(e.$$.fragment)},m(t,r){(0,n.mount_component)(e,t,r),o=!0},p(t,n){const o={};1&n&&(o.store=t[0]),4&n&&(o.lines=t[2].lines),4&n&&(o.tokens=t[2].tokens),e.$set(o)},i(t){o||((0,n.transition_in)(e.$$.fragment,t),o=!0)},o(t){(0,n.transition_out)(e.$$.fragment,t),o=!1},d(t){(0,n.destroy_component)(e,t)}}}function A(t){let e,r;return(e=new o.default({props:{start:!t[5],endState:t[6],introTitle:t[12],poems:t[8]}})).$on("play",t[20]),e.$on("journal",B),e.$on("about",t[21]),{c(){(0,n.create_component)(e.$$.fragment)},m(t,o){(0,n.mount_component)(e,t,o),r=!0},p(t,n){const o={};32&n&&(o.start=!t[5]),64&n&&(o.endState=t[6]),4096&n&&(o.introTitle=t[12]),256&n&&(o.poems=t[8]),e.$set(o)},i(t){r||((0,n.transition_in)(e.$$.fragment,t),r=!0)},o(t){(0,n.transition_out)(e.$$.fragment,t),r=!1},d(t){(0,n.destroy_component)(e,t)}}}function D(t){let e,o;return(e=new g.default({})).$on("inbetween",t[18]),e.$on("end",t[19]),{c(){(0,n.create_component)(e.$$.fragment)},m(t,r){(0,n.mount_component)(e,t,r),o=!0},p:n.noop,i(t){o||((0,n.transition_in)(e.$$.fragment,t),o=!0)},o(t){(0,n.transition_out)(e.$$.fragment,t),o=!1},d(t){(0,n.destroy_component)(e,t)}}}function M(t){let e,o;return(e=new i.default({})).$on("close",t[23]),{c(){(0,n.create_component)(e.$$.fragment)},m(t,r){(0,n.mount_component)(e,t,r),o=!0},p:n.noop,i(t){o||((0,n.transition_in)(e.$$.fragment,t),o=!0)},o(t){(0,n.transition_out)(e.$$.fragment,t),o=!1},d(t){(0,n.destroy_component)(e,t)}}}function U(t){let e,o,r,i,a,s,u=!t[1]&&!t[9]&&!t[3]&&!t[7]&&!t[4]&&j(t);const c=[x,S,N,P,C],l=[];function p(t,n){return t[1]?0:t[7]?1:"landing"===t[4]||"about"===t[4]?2:"journal"===t[4]?3:null==t[4]?4:-1}~(o=p(t))&&(r=l[o]=c[o](t));let m="about"===t[4]&&M(t);return{c(){u&&u.c(),e=(0,n.space)(),r&&r.c(),i=(0,n.space)(),m&&m.c(),a=(0,n.empty)()},m(t,r){u&&u.m(t,r),(0,n.insert)(t,e,r),~o&&l[o].m(t,r),(0,n.insert)(t,i,r),m&&m.m(t,r),(0,n.insert)(t,a,r),s=!0},p(t,[s]){t[1]||t[9]||t[3]||t[7]||t[4]?u&&((0,n.group_outros)(),(0,n.transition_out)(u,1,1,()=>{u=null}),(0,n.check_outros)()):u?(u.p(t,s),666&s&&(0,n.transition_in)(u,1)):((u=j(t)).c(),(0,n.transition_in)(u,1),u.m(e.parentNode,e));let d=o;(o=p(t))===d?~o&&l[o].p(t,s):(r&&((0,n.group_outros)(),(0,n.transition_out)(l[d],1,1,()=>{l[d]=null}),(0,n.check_outros)()),~o?((r=l[o])?r.p(t,s):(r=l[o]=c[o](t)).c(),(0,n.transition_in)(r,1),r.m(i.parentNode,i)):r=null),"about"===t[4]?m?(m.p(t,s),16&s&&(0,n.transition_in)(m,1)):((m=M(t)).c(),(0,n.transition_in)(m,1),m.m(a.parentNode,a)):m&&((0,n.group_outros)(),(0,n.transition_out)(m,1,1,()=>{m=null}),(0,n.check_outros)())},i(t){s||((0,n.transition_in)(u),(0,n.transition_in)(r),(0,n.transition_in)(m),s=!0)},o(t){(0,n.transition_out)(u),(0,n.transition_out)(r),(0,n.transition_out)(m),s=!1},d(t){u&&u.d(t),t&&(0,n.detach)(e),~o&&l[o].d(t),t&&(0,n.detach)(i),m&&m.d(t),t&&(0,n.detach)(a)}}}const I=1e4,L=3500,B=()=>{};function z(n,e,o){let{store:r}=e;const{entity:i}=(0,q.context)();let a,u,c,l,p,m,d,_,f,$,g,y,h,k,w=!1,H=!1;const T=r.subscribe(n=>{o(1,a=n.embed),o(13,H=n.intro),o(12,w=n.introTitle),o(4,p=n.state),o(5,m=n.pause),o(6,d=n.endState),g=n.isButtonHovered,o(3,l=n.resolving),o(8,f=n.finishedHaikus),o(10,h=n.canCollectTokens),o(9,y=n.hideHUD),o(11,k=n.moving);n.moving&&$&&r.update(n=>t({},n,{hint:null})),!p&&w&&r.update(n=>t({},n,{introTitle:!1})),$=n.hint;const e=_;o(7,_=n.transitionOverlay),e!==_&&_&&((0,s.default)().demo||(clearTimeout(c),c=setTimeout(()=>{r.update(n=>t({},n,{transitionOverlay:!1}))},L)));o(2,u=n.newlyCollectedHaiku),l&&o(2,u=null);const i=!p;i!==n.active&&r.update(n=>t({},n,{active:i}))});function O(n,e={}){r.update(o=>t({},o,e,{state:n}))}(0,v.onDestroy)(()=>{T(),clearTimeout(c)});return n.$$set=(t=>{"store"in t&&o(0,r=t.store)}),[r,a,u,l,p,m,d,_,f,y,h,k,w,H,function(){(0,b.sendAnalytics)({event:"poem_collect",eventLabel:"poem_collect"}),r.update(n=>t({},n,{playing:!0,newlyCollectedHaiku:null}))},O,()=>{O("journal")},()=>{O("landing",{pause:!0})},()=>{r.update(n=>t({},n,{initGame:!0}))},()=>{r.update(n=>t({},n,{introTitle:!0,intro:!1}))},()=>{(0,b.hideHeader)(),O(null),r.update(n=>t({},n,{playing:!0}))},()=>{(0,b.sendAnalytics)({pageview:"about"}),O("about")},()=>O(null),()=>{O("landing")}]}class E extends n.SvelteComponent{constructor(t){super(),(0,n.init)(this,t,z,U,n.safe_not_equal,{store:0})}}exports.default=E;
},{"svelte/internal":226,"./GamePageLanding.svelte":769,"./About.svelte":771,"../config":28,"./HaikuPopup.svelte":770,"./PoemCollectionOverlay.svelte":772,"./SimpleHintOverlay.svelte":773,"./GameHUD.svelte":774,"./GameUIIntro.svelte":775,"svelte":220,"./TransitionOverlay.svelte":776,"three":74,"../nfb":75,"../alec-svelte":225,"../tags":60}],85:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e};exports.default=f;var t=require("../overlays/GamePages.svelte"),n=g(t),a=require("../tags"),o=c(a),i=require("svelte/store"),l=require("../util/query-string"),r=g(l),s=require("../config"),d=g(s),u=require("../nfb");function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function g(e){return e&&e.__esModule?e:{default:e}}function f(t,a={}){const{readyToInitialize:l,readyToShowEngine:s}=a,c=!r.default.nolanding,g=!r.default.nocard,f=c?"landing":null,m=(0,d.default)().embed,p=m?null:r.default.initial?r.default.initial:f,v=!r.default.nointro,h=t.view(o.LetterboxBars),k=t.listen([o.EndGameState,o.ResetToCameraDrift]);let O=null;const y=(0,i.writable)({initGame:!(v&&!m),state:p,active:!0,embed:m,pause:!1,hint:null,notifyHaiku:!1,endState:!1,moving:!1,letterboxes:!1,isButtonHovered:!1,isButtonClicked:!1,canCollectTokens:O,tokensCollected:[],finishedHaikus:[],poem:[],playing:!1,haikusCollected:0,haikusTotal:3,newlyCollectedHaiku:null,transitionOverlay:null,transitionCurrentBiome:null,resolving:!1,hideHUD:!0,intro:v&&!m});t.tag(o.GameUIStore,y),window.setUIData=(t=>{y.update(n=>e({},n,t))}),window.toggleOpenJournal=function(){y.update(e=>("journal"!=e.state?e.state="journal":e.state=null,e))},window.setPoemText=function(e,t,n){y.update(a=>(a.poem=[e,t,n],a.tokensCollected=["sun","rain","snow"],a))};const C=t.entity().add(o.ViewLayer,{id:"game-pages",component:n.default,props:{store:y}}),T=t.entity();let B=!1,w=null,H=!1,S=null,b=!1,P=!1,U=!0,x=!1;const I=t.entity();y.subscribe(t=>{if(B=Boolean(t.active),t.state||H||(H=!0,T.has(o.GameStarted)||(T.add(o.GameStarted),T.add(o.ClearInputPress),(0,u.startButtonTracking)(),(0,u.sendAnalytics)({event:"main",eventLabel:"start"}),(0,u.sendTrackingPixel)()),y.update(t=>e({},t,{initGame:!0,intro:!1}))),B!==w&&(w=B,B?(C.tagOff(o.CameraStopUserMovement),C.tagOff(o.LetterboxBars),C.tagOff(o.CameraZoomOut),y.update(t=>e({},t,{playing:!0}))):(C.tagOn(o.CameraStopUserMovement),C.tagOn(o.LetterboxBars),C.tagOn(o.CameraZoomOut),y.update(t=>e({},t,{playing:!1})))),t.playing?C.tagOff(o.IsGameUIActive):C.tagOn(o.IsGameUIActive),"journal"===t.state!==T.has(o.JournalOpen)&&(T.has(o.JournalOpen)?T.remove(o.JournalOpen):T.add(o.JournalOpen)),Boolean(t.state)!==C.has(o.PauseOpen)&&(C.has(o.PauseOpen)?C.remove(o.PauseOpen):C.add(o.PauseOpen)),t.isButtonHovered?C.add(o.ButtonHover):C.remove(o.ButtonHover),t.initGame&&!b&&(b=!0,l&&l()),t.intro===S||t.intro||(S=t.intro,s&&s()),x!==t.newlyCollectedHaiku){let e=x;(x=t.newlyCollectedHaiku)?(I.tagOn(o.BlockUserMove),I.tagOn(o.LetterboxBars),I.tagOn(o.CameraZoomOut)):(I.tagOff(o.BlockUserMove),I.tagOff(o.LetterboxBars),I.tagOff(o.CameraZoomOut)),g&&(x&&!e?I.tagOn(o.HaikuCardShown):I.tagOff(o.HaikuCardShown),!x&&e?(t.onNotifyHaiku&&t.onNotifyHaiku(),I.tagOn(o.HaikuCardSaved)):I.tagOff(o.HaikuCardSaved))}P=t.letterboxes,U=t.hideHUD});const G=t.listen([o.EnvironmentState,o.ActiveEnvironmentState]),q=t.view([o.EnvironmentState,o.ActiveEnvironmentState]),E=(t.view(o.CollectedToken),t.listen(o.CollectedToken)),M=(t.view(o.FinishedPoem),t.listen([o.FinishedPoem,o.HaikuInInventory])),j=t.listen(o.FinishedPoem),A=t.view(o.FinishedPoem),D=t.view(o.HaikuInInventory);let F=null,L=!1,_=!1;return function(n){t.findTag(o.AppState).ready,k.added.length>0&&y.update(t=>e({},t,{pause:!0,endState:!0,state:"landing"}));const a=t.findTag(o.UserTarget),i=a&&a.forceApplied;i!==F&&(y.update(t=>e({},t,{moving:i})),F=i);const l=h.length>0;P!==l&&(y.update(t=>e({},t,{letterboxes:l})),P=l);const r=!T.has(o.GameStarted)||Boolean(t.findTag(o.HideHUD));if(U!==r&&(y.update(t=>e({},t,{hideHUD:r})),U=r),G.changed&&q.length>0){const t=q[0].get(o.EnvironmentState);y.update(n=>e({},n,{haikusTotal:t.haikusTotal}))}if(E.changed){const t=E.query.entities.map(e=>e.get(o.CollectedToken).type);y.update(n=>e({},n,{tokensCollected:t}))}const s=Boolean(t.findTag(o.DirectUserToOrigin)),d=Boolean(t.findTag(o.CameraStopUserMovement)),u=Boolean(t.findTag(o.BlockTokenCollection)),c=!d&&!s&&!u;c!==O&&(O=c,y.update(t=>e({},t,{canCollectTokens:O})));const f=Boolean(t.findTag(o.ShowBiomeResolution));f!==_&&(y.update(t=>e({},t,{resolving:f})),_=f);const m=Boolean(t.findTag(o.TransitionToNextBiome));if(m!==L){const t=q.length?q[0].get(o.EnvironmentState).name:null;m&&"tundra"!==t&&y.update(n=>e({},n,{transitionOverlay:!0,transitionCurrentBiome:t})),L=m}if(M.changed&&M.added.length>0){const t=M.added[0].get(o.FinishedPoem);M.query.entities.map(e=>{const t=e.get(o.FinishedPoem);return{tokens:t.tokens.slice(),lines:t.lines.slice()}});y.update(n=>e({},n,{newlyCollectedHaiku:!!g&&{tokens:t.tokens.slice(),lines:t.lines.slice()}}))}if(j.changed){const t=A.map(e=>{const t=e.get(o.FinishedPoem);return{tokens:t.tokens.slice(),lines:t.lines.slice()}});y.update(n=>e({},n,{finishedHaikus:t}))}M.changed&&y.update(t=>e({},t,{haikusCollected:D.length}))}}
},{"../overlays/GamePages.svelte":264,"../tags":60,"svelte/store":310,"../util/query-string":30,"../config":28,"../nfb":75}],77:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){var t=0,l=document.createElement("div");function n(e){return l.appendChild(e.dom),e}function i(e){for(var n=0;n<l.children.length;n++)l.children[n].style.display=n===e?"block":"none";t=e}l.style.cssText="position:absolute;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",l.addEventListener("click",function(e){e.preventDefault(),i(++t%l.children.length)},!1);var a=(performance||Date).now(),o=a,r=0,c=n(new e.Panel("FPS","#0ff","#002")),d=n(new e.Panel("MS","#0f0","#020"));return i(0),{REVISION:16,dom:l,addPanel:n,showPanel:i,begin:function(){a=(performance||Date).now()},end:function(){r++;var e=(performance||Date).now();return d.update(e-a,200),e>=o+1e3&&(c.update(1e3*r/(e-o),100),o=e,r=0),e},update:function(){a=this.end()},domElement:l,setMode:i}};e.Panel=function(e,t,l){var n=1/0,i=0,a=Math.round,o=a(window.devicePixelRatio||1),r=80*o,c=48*o,d=3*o,f=2*o,u=3*o,p=15*o,s=74*o,h=30*o,m=document.createElement("canvas");m.width=r,m.height=c,m.style.cssText="width:80px;height:48px";var v=m.getContext("2d");return v.font="bold "+9*o+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=l,v.fillRect(0,0,r,c),v.fillStyle=t,v.fillText(e,d,f),v.fillRect(u,p,s,h),v.fillStyle=l,v.globalAlpha=.9,v.fillRect(u,p,s,h),{dom:m,update:function(c,x){n=Math.min(n,c),i=Math.max(i,c),v.fillStyle=l,v.globalAlpha=1,v.fillRect(0,0,r,p),v.fillStyle=t,v.fillText(a(c)+" "+e+" ("+a(n)+"-"+a(i)+")",d,f),v.drawImage(m,u+o,p,s-o,h,u,p,s-o,h),v.fillRect(u+s-o,p,o,h),v.fillStyle=l,v.globalAlpha=.9,v.fillRect(u+s-o,p,o,a((1-c/x)*h))}}},exports.default=e;
},{}],142:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),n=require("svelte");function t(n){let t;return{c(){(t=(0,e.element)("div")).innerHTML='<div class="test"></div>',(0,e.attr)(t,"class","canvas-container svelte-146xou4")},m(i,o){(0,e.insert)(i,t,o),n[6](t)},p:e.noop,d(i){i&&(0,e.detach)(t),n[6](null)}}}function i(n){let i,o=!n[0]&&t(n);return{c(){o&&o.c(),i=(0,e.empty)()},m(n,t){o&&o.m(n,t),(0,e.insert)(n,i,t)},p(e,[n]){e[0]?o&&(o.d(1),o=null):o?o.p(e,n):((o=t(e)).c(),o.m(i.parentNode,i))},i:e.noop,o:e.noop,d(n){o&&o.d(n),n&&(0,e.detach)(i)}}}function o(t,i,o){let s,r,{canvas:a}=i,{resize:d}=i,{stats:c}=i,{parent:u}=i,{embed:l=!1}=i;u&&(s=u),void 0!==window.ResizeObserver&&(r=new window.ResizeObserver(e=>{h()}));const p=/(iOS|iPhone|iPad|iPod)/i.test(navigator.userAgent);function v(){p&&setTimeout(()=>{window.scrollTo(0,0),document.documentElement.style.height=`${window.innerHeight}px`,h(),setTimeout(()=>{document.documentElement.style.height="100%",h()},500)},500),h()}function m(){document.documentElement.style.height=`${window.innerHeight}px`,window.scrollTo(0,0),h()}function h(){if("function"==typeof d){const e=l?s.getBoundingClientRect():null,n=l?e.width:window.innerWidth,t=l?e.height:window.innerHeight;d(Math.round(n),Math.round(t))}}return p&&(document.onselectstart=function(){return!1},document.addEventListener("touchmove",function(e){1!==e.scale&&e.preventDefault()},{passive:!1})),(0,n.afterUpdate)(()=>{}),(0,n.onMount)(()=>(a&&(l&&a.parentElement||s.appendChild(a)),c&&s.appendChild(c),p&&(v(),setTimeout(()=>{v()},500)),h(),r&&r.observe(s),window.addEventListener("resize",m,{passive:!0}),window.addEventListener("orientationchange",v,{passive:!0}),()=>{a&&a.parentElement===s&&a.parentElement.removeChild(a),r&&r.unobserve(s),window.removeEventListener("resize",h),window.removeEventListener("orientationchange",v)})),t.$$set=(e=>{"canvas"in e&&o(2,a=e.canvas),"resize"in e&&o(3,d=e.resize),"stats"in e&&o(4,c=e.stats),"parent"in e&&o(0,u=e.parent),"embed"in e&&o(5,l=e.embed)}),[u,s,a,d,c,l,function(n){e.binding_callbacks[n?"unshift":"push"](()=>{o(1,s=n)})}]}class s extends e.SvelteComponent{constructor(n){super(),(0,e.init)(this,n,o,i,e.safe_not_equal,{canvas:2,resize:3,stats:4,parent:0,embed:5})}}exports.default=s;
},{"svelte/internal":226,"svelte":220}],143:[function(require,module,exports) {
"use strict";function e(e){const t=e.indexOf(",");if(-1===t)return new Blob;const r=e.slice(t+1),a=atob(r),n=e.slice(0,t),o=/data:([^;]+)/.exec(n),i=(o?o[1]:"")||void 0,c=new ArrayBuffer(a.length),l=new Uint8Array(c);for(var s=0;s<a.length;s++)l[s]=a.charCodeAt(s);return new Blob([c],{type:i})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=async function(){let t;try{t=await window.showDirectoryPicker()}catch(e){if(console.error(e),20===e.code||"AbortError"===e.name)return null;throw e}return async(r,a,n)=>{const o=r.toDataURL("image/png"),i=String(n).length,c=`${String(a).padStart(i,"0")}.png`,l=await t.getFileHandle(c,{create:!0}),s=await l.createWritable();let w=e(o);await s.write(w),await s.close()}};
},{}],34:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=x;var e=require("../tags"),t=C(e),n=require("three"),a=C(n),o=require("../util/Stats.js"),i=y(o),r=require("../util/documentVisibility"),l=y(r),s=require("../components/Canvas.svelte"),c=y(s),d=require("../config"),u=y(d),f=require("right-now"),m=y(f),g=require("../util/frame-sequence"),p=y(g),w=require("../util/addFrameTasks"),h=require("../util/query-string"),v=y(h);function y(e){return e&&e.__esModule?e:{default:e}}function C(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function M(e){a.Texture.prototype.clone=function(t){const n=(new this.constructor).copy(this),a=e.properties.get(this),o=e.properties.get(n);return Object.assign(o,a),n}}function x(e,{context:n}){e.system.info({hidden:!0}),n||console.error("Could not load context"),console.log("[renderer] Creating WebGL");const o=new a.WebGLRenderer({canvas:n?n.canvas:void 0,context:n}),i=(0,u.default)(),r=o.domElement;v.default.fps;o.setClearColor("#130904");const s=v.default.debug;let d;o.debug.checkShaderErrors=s,M(o);const f=new a.Scene;f.name="MainScene";const g=new a.PerspectiveCamera(30,1,.1,500);g.name="MainCamera",g.position.set(2,2,-2),g.lookAt(new a.Vector3);let h=!1;const y=e=>{const t=e.toDataURL("image/png"),n=document.createElement("a");n.download=Date.now()+".png",n.href=t,n.click()};if(v.default.promo){const n=async()=>{const e=Math.ceil(120);let t=await(0,p.default)();const n=Array(e).fill().map((e,t)=>t);for(let a of n)oe(1/24),console.log("Frame %d / %d",a+1,e),await t(r,a,e),await new Promise(e=>requestAnimationFrame(e));console.log("Done"),te()};window.drift=function(){const n=e.entity();n.tagOn(t.GameLandingCameraDrift),n.tagOn(t.BlockTokenCollection),n.tagOn(t.HideCharacter),n.tagOn(t.HideHUD),n.tagOn(t.BlockUserMove),n.tagOn(t.CameraStopUserMovement),n.tagOn(t.ModalStoppingUserMovement)},window.addEventListener("keydown",e=>{"s"===e.key.toLowerCase()&&(e.metaKey||e.ctrlKey)?(e.preventDefault(),h=!0):"k"===e.key.toLowerCase()&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),ne(),n())})}let C=(0,m.default)(),x=(0,m.default)(),q=0;const S=e.listen(t.IsGameUIActive),k=e.view(t.TransitionToNextBiome),b=e.view(t.ShowBiomeResolution),O=e.view(t.GameStarted),A=e.listen(t.TransitionToNextBiome),L=e.view(t.GameLandingCameraDrift),T=e.listen(t.GameLandingCameraDrift),D=e.listen(t.ActiveEnvironmentState),R=e.listen(t.GameStarted);let G=2.5;const F=v.default.lowbattery?1:2,P=Math.min(F,window.devicePixelRatio),B=[...new Set(P<=1?[P]:[P,.75*P,P*(2/3),P*(5/8),1].filter(e=>e>=1))];let U=0;f.add(g);const _=e.entity("CanvasComponent").add(t.ViewLayer,{id:"canvas",component:c.default,props:{embed:i.embed,parent:i.container,canvas:r,resize:ee,stats:d?d.dom:null}}).add(t.Canvas,r).add(t.Renderer,o).add(t.MainScene,f).add(t.MainCamera,g).add(t.AppState),j=_.get(t.AppState);let E,H,K,z,N,V,W=!0,I=!0,J=2,Q=!1,X=!1,Y=(Boolean(v.default.lowbattery),null),Z=!1;const $=(e=G)=>{Z=!0,null!=Y&&clearTimeout(Y),Y=setTimeout(()=>{Z=!1,q=0,x=(0,m.default)()},1e3*G)};return(0,l.default)(e=>{e?te():ne()}),{get running(){return X},set running(e){X=e},process(e){D.changed&&(U>0&&U>B.length/2&&(U--,ee(E,H)),$()),(S.changed||T.changed||A.changed)&&$(),R.changed&&(U=0,ee(E,H),$())},show:function(){r.style.display="",I=!1,j.ready=!0},step:oe,dispose(){ne(),_.kill()}};function ee(e,t){const n=e!==E||t!==H;if(n){const n=E*H,a=e*t;a<=.5*(J=Math.max(J,a))?U=0:a<n&&U>B.length/2&&U--,$()}const a=null!=v.default.pixelRatio?v.default.pixelRatio:B[U],o=a!==K;o&&!n&&$(.5),o&&console.log("[resize] New density",a),(n||o)&&(E=e,H=t,K=a,z=Math.floor(E*K),N=Math.floor(H*K),X&&!I?W=!0:ae())}function te(){Q||(Q=!0,C=(0,m.default)(),V=window.requestAnimationFrame(ie))}function ne(){null!=V&&(window.cancelAnimationFrame(V),V=null),Q&&(Q=!1)}function ae(){o.setPixelRatio(K),o.setSize(E,H),g.aspect=E/H,g.updateProjectionMatrix(),W=!1}function oe(t){let n=W;if(W&&ae(),j.width=E,j.height=H,j.pixelRatio=K,j.canvasWidth=z,j.canvasHeight=N,j.running||n){v.default.promo||(t=Math.min(t,.1));const n=(0,w.nextFrameTask)();n&&n(t),X&&(e.root.process(t),d&&d.update(),h&&(h=!1,y(r)))}}function ie(e){if(!Q)return;V=window.requestAnimationFrame(ie);let t=(e-C)/1e3;if(!Z&&(q++,(e-x)/1e3>=G)){const t=60*G-q,n=q/G;x=e,q=0;const a=O.length>0||L.length>0,o=k.length>0||b.length>0;if((n<=55||t>=10)&&a&&!o){const e=B[U];++U>B.length-1&&(U=B.length-1),e!==B[U]&&ee(E,H)}}C=e,oe(t)}}
},{"../tags":60,"three":74,"../util/Stats.js":77,"../util/documentVisibility":141,"../components/Canvas.svelte":142,"../config":28,"right-now":223,"../util/frame-sequence":143,"../util/addFrameTasks":140,"../util/query-string":30}],294:[function(require,module,exports) {
var define;
var r;!function(){"use strict";var t=.5*(Math.sqrt(3)-1),e=(3-Math.sqrt(3))/6,a=1/6,o=(Math.sqrt(5)-1)/4,i=(5-Math.sqrt(5))/20;function n(r){var t;t="function"==typeof r?r:r?function(){var r=0,t=0,e=0,a=1,o=(i=4022871197,function(r){r=r.toString();for(var t=0;t<r.length;t++){var e=.02519603282416938*(i+=r.charCodeAt(t));e-=i=e>>>0,i=(e*=i)>>>0,i+=4294967296*(e-=i)}return 2.3283064365386963e-10*(i>>>0)});var i;r=o(" "),t=o(" "),e=o(" ");for(var n=0;n<arguments.length;n++)(r-=o(arguments[n]))<0&&(r+=1),(t-=o(arguments[n]))<0&&(t+=1),(e-=o(arguments[n]))<0&&(e+=1);return o=null,function(){var o=2091639*r+2.3283064365386963e-10*a;return r=t,t=e,e=o-(a=0|o)}}(r):Math.random,this.p=f(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var e=0;e<512;e++)this.perm[e]=this.p[255&e],this.permMod12[e]=this.perm[e]%12}function f(r){var t,e=new Uint8Array(256);for(t=0;t<256;t++)e[t]=t;for(t=0;t<255;t++){var a=t+~~(r()*(256-t)),o=e[t];e[t]=e[a],e[a]=o}return e}n.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(r,a){var o,i,n=this.permMod12,f=this.perm,v=this.grad3,s=0,h=0,l=0,u=(r+a)*t,d=Math.floor(r+u),p=Math.floor(a+u),M=(d+p)*e,m=r-(d-M),c=a-(p-M);m>c?(o=1,i=0):(o=0,i=1);var y=m-o+e,w=c-i+e,g=m-1+2*e,A=c-1+2*e,x=255&d,q=255&p,D=.5-m*m-c*c;if(D>=0){var S=3*n[x+f[q]];s=(D*=D)*D*(v[S]*m+v[S+1]*c)}var U=.5-y*y-w*w;if(U>=0){var b=3*n[x+o+f[q+i]];h=(U*=U)*U*(v[b]*y+v[b+1]*w)}var F=.5-g*g-A*A;if(F>=0){var N=3*n[x+1+f[q+1]];l=(F*=F)*F*(v[N]*g+v[N+1]*A)}return 70*(s+h+l)},noise3D:function(r,t,e){var o,i,n,f,v,s,h,l,u,d,p=this.permMod12,M=this.perm,m=this.grad3,c=(r+t+e)*(1/3),y=Math.floor(r+c),w=Math.floor(t+c),g=Math.floor(e+c),A=(y+w+g)*a,x=r-(y-A),q=t-(w-A),D=e-(g-A);x>=q?q>=D?(v=1,s=0,h=0,l=1,u=1,d=0):x>=D?(v=1,s=0,h=0,l=1,u=0,d=1):(v=0,s=0,h=1,l=1,u=0,d=1):q<D?(v=0,s=0,h=1,l=0,u=1,d=1):x<D?(v=0,s=1,h=0,l=0,u=1,d=1):(v=0,s=1,h=0,l=1,u=1,d=0);var S=x-v+a,U=q-s+a,b=D-h+a,F=x-l+2*a,N=q-u+2*a,C=D-d+2*a,P=x-1+.5,T=q-1+.5,_=D-1+.5,j=255&y,k=255&w,z=255&g,B=.6-x*x-q*q-D*D;if(B<0)o=0;else{var E=3*p[j+M[k+M[z]]];o=(B*=B)*B*(m[E]*x+m[E+1]*q+m[E+2]*D)}var G=.6-S*S-U*U-b*b;if(G<0)i=0;else{var H=3*p[j+v+M[k+s+M[z+h]]];i=(G*=G)*G*(m[H]*S+m[H+1]*U+m[H+2]*b)}var I=.6-F*F-N*N-C*C;if(I<0)n=0;else{var J=3*p[j+l+M[k+u+M[z+d]]];n=(I*=I)*I*(m[J]*F+m[J+1]*N+m[J+2]*C)}var K=.6-P*P-T*T-_*_;if(K<0)f=0;else{var L=3*p[j+1+M[k+1+M[z+1]]];f=(K*=K)*K*(m[L]*P+m[L+1]*T+m[L+2]*_)}return 32*(o+i+n+f)},noise4D:function(r,t,e,a){var n,f,v,s,h,l,u,d,p,M,m,c,y,w,g,A,x,q=this.perm,D=this.grad4,S=(r+t+e+a)*o,U=Math.floor(r+S),b=Math.floor(t+S),F=Math.floor(e+S),N=Math.floor(a+S),C=(U+b+F+N)*i,P=r-(U-C),T=t-(b-C),_=e-(F-C),j=a-(N-C),k=0,z=0,B=0,E=0;P>T?k++:z++,P>_?k++:B++,P>j?k++:E++,T>_?z++:B++,T>j?z++:E++,_>j?B++:E++;var G=P-(l=k>=3?1:0)+i,H=T-(u=z>=3?1:0)+i,I=_-(d=B>=3?1:0)+i,J=j-(p=E>=3?1:0)+i,K=P-(M=k>=2?1:0)+2*i,L=T-(m=z>=2?1:0)+2*i,O=_-(c=B>=2?1:0)+2*i,Q=j-(y=E>=2?1:0)+2*i,R=P-(w=k>=1?1:0)+3*i,V=T-(g=z>=1?1:0)+3*i,W=_-(A=B>=1?1:0)+3*i,X=j-(x=E>=1?1:0)+3*i,Y=P-1+4*i,Z=T-1+4*i,$=_-1+4*i,rr=j-1+4*i,tr=255&U,er=255&b,ar=255&F,or=255&N,ir=.6-P*P-T*T-_*_-j*j;if(ir<0)n=0;else{var nr=q[tr+q[er+q[ar+q[or]]]]%32*4;n=(ir*=ir)*ir*(D[nr]*P+D[nr+1]*T+D[nr+2]*_+D[nr+3]*j)}var fr=.6-G*G-H*H-I*I-J*J;if(fr<0)f=0;else{var vr=q[tr+l+q[er+u+q[ar+d+q[or+p]]]]%32*4;f=(fr*=fr)*fr*(D[vr]*G+D[vr+1]*H+D[vr+2]*I+D[vr+3]*J)}var sr=.6-K*K-L*L-O*O-Q*Q;if(sr<0)v=0;else{var hr=q[tr+M+q[er+m+q[ar+c+q[or+y]]]]%32*4;v=(sr*=sr)*sr*(D[hr]*K+D[hr+1]*L+D[hr+2]*O+D[hr+3]*Q)}var lr=.6-R*R-V*V-W*W-X*X;if(lr<0)s=0;else{var ur=q[tr+w+q[er+g+q[ar+A+q[or+x]]]]%32*4;s=(lr*=lr)*lr*(D[ur]*R+D[ur+1]*V+D[ur+2]*W+D[ur+3]*X)}var dr=.6-Y*Y-Z*Z-$*$-rr*rr;if(dr<0)h=0;else{var pr=q[tr+1+q[er+1+q[ar+1+q[or+1]]]]%32*4;h=(dr*=dr)*dr*(D[pr]*Y+D[pr+1]*Z+D[pr+2]*$+D[pr+3]*rr)}return 27*(n+f+v+s+h)}},n._buildPermutationTable=f,void 0!==r&&r.amd&&r(function(){return n}),"undefined"!=typeof exports?exports.SimplexNoise=n:"undefined"!=typeof window&&(window.SimplexNoise=n),"undefined"!=typeof module&&(module.exports=n)}();
},{}],86:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=T;var e=require("../tags"),t=y(e),o=require("three"),n=y(o),a=require("../util/tokens"),i=require("../util/Assets"),r=v(i),l=require("../util/math"),s=y(l),c=require("../util/Random"),u=v(c),d=require("simplex-noise"),f=v(d),g=require("../util/ShaderManager"),p=y(g),m=require("./AnimationSystem");function v(e){return e&&e.__esModule?e:{default:e}}function y(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}function T(e){const o=e.listen(t.HaikuCardSaved),i=e.listen(t.HaikuInInventory),l=e.view(t.WaitingForTokenPaper),c=e.view([t.Object3D,t.FloatingToken]),d=e.findTag(t.Renderer),g=new n.PlaneGeometry(1,1,4,4),v=new n.Vector3,y=new n.Vector2,T=new n.Vector2,D=[0,0,0],h=(0,u.default)(),x=new f.default(h.value),S=r.default.createGPUTexture(d,"image/data/floating-paper"),k=r.default.createGPUTexture(d,"image/data/floating-paper-lines"),b=new n.Vector2(0,0),F=e.listen([t.EnvironmentState,t.ActiveEnvironmentState]);let M={value:1};const O=e.listen(t.FinalBiomeResolution),C=e.listen([t.EndGameState,t.ResetToCameraDrift]);return function(u){e.findTag(t.UserTarget);const d=e.findTag(t.UserCharacter).position;y.set(d.x,d.z),O.added.length>0&&(0,m.tweenTo)(e,M,"value",0,1,"sineOut",2),C.added.length>0&&c.forEach(e=>e.kill()),F.changed&&c.forEach(e=>{e.has(t.FloatingTokenShouldTargetTree)&&(e.tagOff(t.FloatingTokenShouldTargetTree),e.tagOff(t.FloatingTokenTargetUser))}),i.added.forEach(o=>{e.entity().add(t.WaitingForTokenPaper)}),o.added.forEach(()=>{Promise.all([S,k]).then(([e,o])=>{l.forEach(i=>{i.remove(t.WaitingForTokenPaper);const l=a.InvertedTokenURLs[""],s=(r.default.urlToID(l),i.add(t.FloatingToken)),c=s.get(t.FloatingToken);s.tagOn(t.FloatingTokenTargetUser),c.type="",c.map=o;const u=function(e,o,a){const i=p.create({name:"TokenPaper",uniforms:{color:{value:new n.Color(1.1,1.1,1.1)},map:{value:a.map},backgroundMap:{value:o},mapScale:{value:1.25},time:{value:0},opacity:{value:1},timeOffset:{value:1}},side:n.DoubleSide,blending:n.CustomBlending,blendEquation:n.AddEquation,blendSrc:n.OneFactor,blendDst:n.OneMinusSrcAlphaFactor,transparent:!0,vertexShader:"\n        varying vec2 vUv;\n        uniform float mapScale;\n        uniform float timeOffset;\n        uniform float time;\n\n        mat3 rotation3dY(float angle) {\n        \tfloat s = sin(angle);\n        \tfloat c = cos(angle);\n\n        \treturn mat3(\n        \t\tc, 0.0, -s,\n        \t\t0.0, 1.0, 0.0,\n        \t\ts, 0.0, c\n        \t);\n        }\n\n        void main () {\n          vec2 nuv = uv * 2.0 - 1.0;\n          nuv *= mapScale;\n          vUv = nuv * 0.5 + 0.5;\n          vec3 transformed = position.xyz;\n          float angle = sin(time + timeOffset + position.x);\n          transformed *= rotation3dY(angle);\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(transformed, 1.0);\n        }\n      ",fragmentShader:"\n        varying vec2 vUv;\n        uniform sampler2D map;\n        uniform sampler2D backgroundMap;\n        uniform float opacity;\n        uniform vec3 color;\n\n        vec4 blend(vec4 background, vec4 foreground) {\n            return (foreground.rgba * foreground.a) + background.rgba * (1.0 - foreground.a);\n        }\n\n        void main () {\n          vec3 curColor = vec3(color);\n\n          vec4 outColor = texture2D(backgroundMap, vUv) * vec4(color, 1.0);\n          // vec4 outColor = vec4(color, 1.0);\n          vec4 fgColor = texture2D(map, vUv);\n          \n          // outColor.rgb *= 1.0 - fgColor.a;\n          // outColor = blend(outColor, fgColor);\n          gl_FragColor = vec4(outColor);\n          gl_FragColor.a *= opacity;\n          // if (gl_FragColor.a <= 0.1) discard;\n        }\n      "}),r=new n.Mesh(g,i);return r.scale.setScalar(1),e.add(t.Object3D,r),r}(s,e,c);u.position.copy(d),c.position2D.set(u.position.x,u.position.z),c.offsetHeight=h.range(1,3),c.offset3D.fromArray(h.insideSphere(.1,D)),c.rotationAxis.fromArray(h.insideSphere(1,D)),c.rotationSpeed=1,c.scale=.45,c.speed=h.range(.5,1.5),c.rotationAngleOffset=h.range(-1,1)*Math.PI*2})})});var f=15*Math.PI*15/1e4;const q=e.findTag(t.WaitingForBiomeResolution)||e.findTag(t.ShowBiomeResolution);c.forEach(e=>{const o=e.get(t.FloatingToken);let n=e.has(t.FloatingTokenTargetUser)&&!e.has(t.FloatingTokenShouldTargetTree);const a=e.get(t.Object3D);if(o.time+=u,n&&o.started&&q&&!e.has(t.FloatingTokenShouldTargetTree)){y.lengthSq()<=400&&e.tagOn(t.FloatingTokenShouldTargetTree)}b.set(0,0);const i=n?y:b,r=o.position2D.distanceToSquared(i),l=x.noise4D(o.position2D.x,o.position2D.y,o.time,o.rotationAngleOffset);T.copy(i).sub(o.position2D);const d=Math.sqrt(T.dot(T)),g=Math.sqrt(r),p=s.clamp(g,1,2),m=0===d?p:(p-d)/d,D=.075+.01*l;o.velocity2D.addScaledVector(T,-D*m*(n?o.speed:1));const h=.1*o.time,S=.1*x.noise3D(.25*o.position2D.x,.25*o.position2D.y,.5*o.time);o.velocity2D.x+=Math.cos(h)*S,o.velocity2D.y+=Math.sin(h)*S,c.forEach(n=>{if(n===e)return;const a=n.get(t.FloatingToken),i=o.position2D.distanceToSquared(a.position2D);if(i<=4){const e=Math.sqrt(i),t=1-s.clamp01(e/2);T.copy(a.position2D).sub(o.position2D).normalize().multiplyScalar(t),o.velocity2D.addScaledVector(T,-.2)}});const k=n?7:14;o.velocity2D.x=s.clamp(o.velocity2D.x,-k,k),o.velocity2D.y=s.clamp(o.velocity2D.y,-k,k);var F=o.velocity2D.x,O=o.velocity2D.y,C=-.235*f*1.22*F*F*F/Math.abs(F),w=-.235*f*1.22*O*O*O/Math.abs(O),A=(C=isNaN(C)?0:C)/.1,P=(w=isNaN(w)?0:w)/.1;o.velocity2D.x+=A*u,o.velocity2D.y+=P*u;o.position2D.x+=o.velocity2D.x*u*.75,o.position2D.y+=o.velocity2D.y*u*.75;const U=1+s.clamp01(o.velocity2D.length()/(7/4));if(n)o.offsetY=0;else{o.animateToTreeTime+=u;const e=Math.max(0,o.animateToTreeTime-o.animateToTreeDelay),t=s.clamp01(e/o.animateToTreeDuration);o.offsetY=2*t}a.position.set(o.position2D.x,o.offsetHeight+o.offsetY,o.position2D.y),a.material.uniforms.time.value+=u*U,a.material.uniforms.timeOffset.value=o.rotationAngleOffset,a.position.addScaledVector(o.offset3D,1),T.copy(o.velocity2D).normalize(),T.set(-T.y,T.x),a.rotateOnWorldAxis(o.rotationAxis,U*o.rotationSpeed*u);const E=.1,_=(x.noise4D(a.position.x*E,a.position.y*E,a.position.z*E,1),1*x.noise4D(a.position.x*E,a.position.y*E,a.position.z*E,o.rotationAngleOffset));v.set(T.x,0,T.y);const V=Math.max(0,o.time-0);V>=0&&!o.started&&(o.started=!0,o.position2D.copy(y),o.velocity2D.set(0,0));const z=s.clamp01(V/2);a.scale.setScalar(Math.max(1e-5,o.scale*z*M.value)),a.visible=z>1e-5,a.position.y+=_})}}
},{"../tags":60,"three":74,"../util/tokens":138,"../util/Assets":31,"../util/math":240,"../util/Random":235,"simplex-noise":294,"../util/ShaderManager":243,"./AnimationSystem":108}],87:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=i;var e=require("../tags"),t=c(e),r=require("three"),n=c(r),a=require("../util/three-util");function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e){e.system.info({hidden:!0});const r=e.listen(t.Object3D),n=e.query(t.MainScene);return function(){const c=e.findTag(n);c&&r.changed&&(r.added.forEach(e=>{if(!e.has(t.Object3D))return;const r=e.get(t.Object3D);r&&!r.parent&&(c.add(r),r.updateMatrixWorld())}),r.removing.forEach(e=>{if(!e.has(t.Object3D))return;const r=e.get(t.Object3D);r&&!e.has(t.Object3DKeepAlive)&&(0,a.detachObject)(r)}))}}
},{"../tags":60,"three":74,"../util/three-util":80}],88:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=c;var e=require("../tags"),t=d(e),n=require("three"),i=d(n),r=require("../util/array"),o=require("../util/tiny-event"),s=u(o);function u(e){return e&&e.__esModule?e:{default:e}}function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function c(e,n={}){const i=e.findTag(t.Canvas);let r=null,o=!1;const u=new s.default,d=e.entity("InputEntity").add(t.InputState),c=e.findTag(t.AppState),a=d.get(t.InputState),l={x:window.innerWidth/2,y:window.innerHeight/2,multitouch:null,interacted:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,pressed:!1},h=e=>I(e,l),f=e=>I(e,l),v={passive:!0};window.addEventListener("keydown",h,v),window.addEventListener("keyup",f,v),window.addEventListener("mousemove",T,v),window.addEventListener("mouseup",function(e){if(0!==e.button)return;0;b(e,l),k(e,l),l.pressed=!1},v),i.addEventListener("mousedown",x,v),i.addEventListener("touchstart",E,{passive:!1}),window.addEventListener("touchend",L,v),window.addEventListener("touchmove",K),i.addEventListener("contextmenu",y),e.entity().add(t.InputGestureEmitter,u);const w=e=>u.emit("tap",e);window.addEventListener("touchend",w,v),window.addEventListener("click",w,v),i.addEventListener("mousedown",w,v);const m=e.entity(),p=e.view(t.ClearInputPress);return{process(n){a.position.x=l.x,a.position.y=l.y,a.positionNormalized.x=l.x/c.width,a.positionNormalized.y=l.y/c.height,a.pressed=l.pressed,a.metaKey=l.metaKey,a.ctrlKey=l.ctrlKey,a.shiftKey=l.shiftKey,a.interacted=l.interacted,a.multitouch=l.multitouch,!m.has(t.UserInitiatedGesture)&&a.pressed&&m.add(t.UserInitiatedGesture);const i=e.findTag(t.IsGameUIActive),r=p.length>0;(i||r)&&(a.pressed=!1,l.pressed=!1,a.interacted=!1,l.interacted=!1,p.forEach(e=>{e.tagOff(t.ClearInputPress)}))},dispose(){i.removeEventListener("contextmenu",y),window.removeEventListener("mousedown",x),window.removeEventListener("mousemove",T),i.removeEventListener("touchstart",E),window.removeEventListener("touchend",L),window.removeEventListener("touchmove",K),window.removeEventListener("keydown",h),window.removeEventListener("keyup",f),window.removeEventListener("touchend",w),window.removeEventListener("click",w),window.removeEventListener("mousedown",w)}};function y(e){return e.preventDefault(),!1}function g(e,t){if(null!=t)for(let n=0;n<e.touches.length;n++)if(e.touches[n].identifier===t)return e.touches[n];return null}function E(e){o=!0;let t;null==r&&(t=e.changedTouches[0],r=t.identifier,e.preventDefault(),l.pressed=!0,b(e,l),k(t,l)),l.multitouch=e.touches.length>1}function L(e){const t=r;if(r){g(r)||(r=null)}if(null!=r)for(let t=0;t<e.changedTouches.length;t++){const n=e.changedTouches[t];if(n.identifier===r){k(n,l),r=null;break}}if(!r)for(let n=0;n<e.touches.length;n++){const i=e.touches[n];if(i.identifier!==t){r=i.identifier,l.pressed=!0,k(i,l);break}}if(!r&&e.touches.length>=1){const t=e.touches[0];r=t.identifier,l.pressed=!0,k(t,l)}r||(l.pressed=!1),b(e,l),l.multitouch=e.touches.length>1}function K(e){null==r&&(r=e.changedTouches[0].identifier);for(let t=0;t<e.changedTouches.length;t++){const n=e.changedTouches[t];if(n.identifier===r){l.pressed=!0,k(n,l),b(e,l);break}}l.multitouch=e.touches.length>1}function x(e){0===e.button&&(b(e,l),k(e,l),l.pressed=!0,m.add(t.TriggerMovementGesture),m.remove(t.TriggerMovementGesture))}function T(e){0===e.button&&(b(e,l),k(e,l))}function I(e,t){null!=e.shiftKey&&(t.shiftKey=e.shiftKey),null!=e.metaKey&&(t.metaKey=e.metaKey),null!=e.ctrlKey&&(t.ctrlKey=e.ctrlKey)}function k(e,t){t.x=e.clientX,t.y=e.clientY,a.x=t.x,a.y=t.y}function b(e,t){t.interacted=!0,I(e,t)}}
},{"../tags":60,"three":74,"../util/array":139,"../util/tiny-event":265}],260:[function(require,module,exports) {
module.exports="#define GLSLIFY 1\nvarying vec2 originalUv;\nvarying vec2 vUv;\nvarying float vYGradient;\nvarying vec2 vGroundUv;\nuniform sampler2D map;\nuniform sampler2D noiseMap;\nuniform float time;\nuniform bool useMapDiscard;\nvarying vec3 vObjectCoord;\nvarying vec2 vScreenScale;\nuniform vec3 color;\nuniform float aspect;\nuniform float spriteHeight;\nvarying vec3 vWorldPosition;\nvarying vec3 vGroundColor;\nvarying float vDataScale;\nvarying vec3 vBaseWorldPosition;\nvarying vec3 vCenterWorldPos;\nuniform sampler2D groundMap;\nuniform bool silhouette;\nuniform vec3 tintColor;\nuniform vec3 shadowColor;\n// varying float vSpin;\n\n// void main () {\n//   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n//   gl_FragColor += texture2D(map, vUv);\n// }\n\nvoid main () {\n  gl_FragColor = texture2D(map, vUv);\n  gl_FragColor.rgb *= tintColor;\n  // gl_FragColor.a = 1.0;\n  float alphaMap = gl_FragColor.a;\n  if (alphaMap < 0.5) discard;\n  if (silhouette) {\n    // float vYGrad0 = 1.0 - pow(clamp(vYGradient / 1.0, 0.0, 1.0), 1.0);\n    // gl_FragColor.a *= 1.0 - clamp(distance(vCenterWorldPos, vWorldPosition) / 1.0, 0.0, 0.5);\n    \n    float falloff = 1.0 - clamp(pow(vWorldPosition.y / 1.0, 1.0), 0.0, 1.0);\n    // float falloff = 1.0 - clamp(pow(distance(vCenterWorldPos, vWorldPosition) / 2.75, 1.0), 0.0, 1.0);\n    float shadowOpacity = 0.25;\n    gl_FragColor.rgb = mix(vec3(1.0), shadowColor, alphaMap * falloff * shadowOpacity);\n    gl_FragColor.a = 1.0;\n    // gl_FragColor.rgb = vec3(shadowColor);\n    // gl_FragColor.a *= ;\n    // gl_FragColor.rgb *= gl_FragColor.a;\n    // gl_FragColor.a = 1.0;\n    // gl_FragColor.a *= vUv.y;\n  } \n\n  // else {\n    // vec3 fogColor = texture2D(groundMap, vGroundUv).rgb;\n    // vec3 fogColor = vGroundColor;\n    // gl_FragColor.rgb *= color;\n    // gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, 0.2);\n    // gl_FragColor.rgb = gl_FragColor.rgb + fogColor * 0.1;\n    // gl_FragColor.rgb = mix(gl_FragColor.rgb, gl_FragColor.rgb + fogColor, 0.2);\n\n    // float vFog0 = 1.0 - pow(clamp(vWorldPosition.y / 0.5, 0.0, 1.0), 0.25);\n    // float yoff = sin(time + fract(vCenterWorldPos.x * 100.0 + vCenterWorldPos.z * 100.0));\n    // float ypos = max(0.0, vWorldPosition.y + yoff * 0.0);\n    // float vFog1 = 1.0 - pow(clamp(ypos / 4.0, 0.0, 1.0), 0.5);\n    // gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, vFog0);\n    // float vStr = 0.33;\n    // gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor + 0.1, vFog1 * vStr);\n  // }\n\n  // TODO: Screen door\n  // Will have to be done with another render target perhaps? render character\n  // and other key features (tokens) to it as black/white mask, then texture fetch\n  // the mask in this shader to see if we need to do transparency or not\n  // screenDoor(0.65);\n\n}\n";
},{}],261:[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n#define PI 3.1415926538\n\nuniform float rotation;\nuniform vec2 repeat;\nuniform vec2 offset;\nuniform float flip;\nuniform float time;\n\nuniform sampler2D worldDataMap;\nuniform mat4 worldDataProjection;\nuniform mat4 worldDataView;\nuniform float spriteHeight;\nuniform bool silhouette;\n\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\n\nvoid main () {\n  vUv = uv;\n  vUv *= repeat;\n  vUv += offset;\n\n  vec3 centerWorldPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n  vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n  vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n  \n  vec2 scale;\n  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n  scale.x *= flip;\n\n  vec4 vDataUvPos4 = worldDataProjection * worldDataView * vec4(centerWorldPos.xz, 0.0, 1.0);\n  vec2 vDataScreen = vDataUvPos4.xy / vDataUvPos4.w;\n  vec2 vDataUv = vDataScreen.xy * 0.5 + 0.5;\n  vec3 dCol = texture2D(worldDataMap, vDataUv).rgb;\n\n  vec3 offsetPos = position.xyz;\n  vec3 vertexWorldPos = centerWorldPos\n    + camRightWorld * offsetPos.x * scale.x\n    + camUpWorld * offsetPos.y * scale.y;\n\n  vec3 realVertexWorldPos = vertexWorldPos;\n\n  vec3 vertexWorldBasePos = centerWorldPos;\n  vec2 curDirection2D = vec2(dCol.gb) * 2.0 - 1.0;\n  vec3 curDirection = vec3(curDirection2D.x, 0.0, curDirection2D.y);\n  float gradientY = clamp(vertexWorldPos.y / 0.25, 0.0, 1.0);\n  // vertexWorldPos += 0.05 * scale.y * camRightWorld * sin(time*7.0) * pow(dCol.r, 2.0) * gradientY;\n  vertexWorldPos += 0.05 * position.y * spriteHeight * camRightWorld * sin(time*7.0) * curDirection * pow(dCol.r, 2.0) * gradientY;\n\n  if (silhouette) {\n    float xSkew = -60.0 * (PI/180.0);\n    float ySkew = 0.0;\n\n    // Create a transform that will skew our texture coords\n    // mat3 trans = mat3(\n    //   1.0       , tan(xSkew), 0.0,\n    //   tan(ySkew), 1.0,        0.0,\n    //   0.0       , 0.0,        1.0\n    // );\n    vertexWorldPos.y *= 0.25;\n    vertexWorldPos.xyz -= camRightWorld * realVertexWorldPos.y * 0.5;\n    vertexWorldPos.z += -0.15;\n    // vertexWorldPos.x += -0.05;\n    // vertexWorldPos.xyz += vYGradient * camRightWorld * -0.5;\n    // vertexWorldPos.y *= 1.0;\n    // vertexWorldPos.xyz -= centerWorldPos;\n    // // vertexWorldPos.xyz *= rotation3dX(PI / -4.0);\n    // vertexWorldPos *= rotationMatrix(camRightWorld, PI / 2.0);\n    // vertexWorldPos.xyz += centerWorldPos;\n    // vertexWorldPos += vYGradient * camRightWorld * -0.5;\n    // vertexWorldPos *= offsetPos.y * camRightWorld * -2.0;\n    // vertexWorldPos.z *= 0.5;\n  }\n\n  vWorldPosition = vertexWorldPos;\n  gl_Position = projectionMatrix * viewMatrix * vec4(vertexWorldPos, 1.0);\n}\n";
},{}],262:[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n#ifdef HAS_INTENSITY\nvarying float vIntensity;\n#endif\n\n#ifdef HAS_VERTEX_COLORS\nvarying vec3 vVertexColor;\n#endif\n\nuniform bool ignoreGround;\nvarying vec2 vUv;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying vec2 vBillboardUV;\n\nuniform float alphaTest;\n\nuniform vec3 cameraDirection;\nuniform vec3 lightDirection;\nuniform vec3 lightPosition;\nuniform mat3 normalMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform sampler2D map;\nuniform sampler2D overlayMap;\nuniform vec3 color;\nuniform vec3 colorA;\nuniform vec3 colorB;\nuniform vec3 minBounds;\nuniform vec3 maxBounds;\nuniform vec3 overlayColor;\nuniform vec2 resolution;\nuniform float groundBounceStrength;\nuniform float groundBounceLow;\nuniform float groundBounceHigh;\nuniform bool groundBounce;\n\nvarying vec2 vGroundUv;\nuniform sampler2D groundTexture;\nuniform bool groundTextureEnabled;\n\n// uniform sampler2D noiseMap;\nuniform sampler2D normalMap;\n\nuniform bool flipNormalY;\nuniform bool debugNormals;\nuniform bool useNormalMap;\nuniform bool diffuseShading;\nuniform bool celShading;\nuniform bool darkShading;\nuniform bool vertexColors;\nuniform bool useOverlayMap;\nuniform bool useDiffuseMap;\n\nfloat range(float vmin, float vmax, float value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec2 range(vec2 vmin, vec2 vmax, vec2 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec3 range(vec3 vmin, vec3 vmax, vec3 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec4 range(vec4 vmin, vec4 vmax, vec4 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nfloat blendSoftLight(float base, float blend) {\n\treturn (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n}\n\nvec3 blendSoftLight(vec3 base, vec3 blend) {\n\treturn vec3(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b));\n}\n\nvec3 blendSoftLight(vec3 base, vec3 blend, float opacity) {\n\treturn (blendSoftLight(base, blend) * opacity + base * (1.0 - opacity));\n}\n\nfloat blendOverlay(float base, float blend) {\n\treturn base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n}\n\nvec3 blendOverlay(vec3 base, vec3 blend) {\n\treturn vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n}\n\nvec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n\treturn (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n}\n\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g_0 = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g_0;\n  vec3 i1 = min( g_0.xyz, l.zxy );\n  vec3 i2 = max( g_0.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289(i);\n  vec4 p = permute( permute( permute(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\nfloat luma(vec3 color) {\n  return dot(color, vec3(0.299, 0.587, 0.114));\n}\n\nfloat luma(vec4 color) {\n  return dot(color.rgb, vec3(0.299, 0.587, 0.114));\n}\n\nfloat dither4x4_0(vec2 position, float brightness) {\n  int x = int(mod(position.x, 4.0));\n  int y = int(mod(position.y, 4.0));\n  int index = x + y * 4;\n  float limit = 0.0;\n\n  if (x < 8) {\n    if (index == 0) limit = 0.0625;\n    if (index == 1) limit = 0.5625;\n    if (index == 2) limit = 0.1875;\n    if (index == 3) limit = 0.6875;\n    if (index == 4) limit = 0.8125;\n    if (index == 5) limit = 0.3125;\n    if (index == 6) limit = 0.9375;\n    if (index == 7) limit = 0.4375;\n    if (index == 8) limit = 0.25;\n    if (index == 9) limit = 0.75;\n    if (index == 10) limit = 0.125;\n    if (index == 11) limit = 0.625;\n    if (index == 12) limit = 1.0;\n    if (index == 13) limit = 0.5;\n    if (index == 14) limit = 0.875;\n    if (index == 15) limit = 0.375;\n  }\n\n  return brightness < limit ? 0.0 : 1.0;\n}\n\nvec3 dither4x4_0(vec2 position, vec3 color) {\n  return color * dither4x4_0(position, luma(color));\n}\n\nvec4 dither4x4_0(vec2 position, vec4 color) {\n  return vec4(color.rgb * dither4x4_0(position, luma(color)), 1.0);\n}\n\nvec3 faceNormals(vec3 pos) {\n  vec3 fdx = dFdx(pos);\n  vec3 fdy = dFdy(pos);\n  return normalize(cross(fdx, fdy));\n}\n\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\n  // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n  vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n  vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n  vec2 st0 = dFdx( vUv.st );\n  vec2 st1 = dFdy( vUv.st );\n\n  float scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n  vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n  vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n  vec3 N = normalize( surf_norm );\n\n  mat3 tsn = mat3( S, T, N );\n\n  mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n  return normalize( tsn * mapN );\n\n}\nfloat aastep(float threshold, float value) {\n  float change = fwidth(value) * 0.5;\n  float lo = threshold - change;\n  float hi = threshold + change;\n  return smoothstep(threshold - change, threshold + change, value);\n}\n\nfloat aastep1(float threshold, float value) {\n  float change = fwidth(value) * 0.5;\n  float lo = threshold - change;\n  float hi = threshold + change;\n  return clamp((value - lo) / (hi - lo), 0.0, 1.0);\n}\n// float aastep(float threshold, float value) {\n//   float change = fwidth(value) * 0.5;\n//   // float change = fwidth(value) * 0.5;\n//   // float change = fwidth(value) * 0.5;\n//   // float change = 0.1;\n//   float lo = threshold - change;\n//   float hi = threshold + change;\n//   return clamp((value - lo) / (hi - lo), 0.0, 1.0);\n// }\n\nvec4 blend(vec4 background, vec4 foreground) {\n    return (foreground.rgba * foreground.a) + background.rgba * (1.0 - foreground.a);\n}\n\nfloat roundf (float f) {\n  return floor(f + 0.5);\n}\n\n// float fastnoise3D(vec3 p)\n// {\n//   p.z = fract(p.z)*256.0;\n//   float iz = floor(p.z);\n//   float fz = fract(p.z);\n//   vec2 a_off = vec2(23.0, 29.0)*(iz)/256.0;\n//   vec2 b_off = vec2(23.0, 29.0)*(iz+1.0)/256.0;\n//   float a = texture2D(noiseMap, p.xy + a_off).r;\n//   float b = texture2D(noiseMap, p.xy + b_off).r;\n//   return mix(a, b, fz);\n// }\n\nfloat dither4x4(vec2 position, float brightness) {\n  int x = int(mod(position.x, 4.0));\n  int y = int(mod(position.y, 4.0));\n  int index = x + y * 4;\n  float limit = 0.0;\n\n  if (x < 8) {\n    if (index == 0) limit = 0.0625;\n    if (index == 1) limit = 0.5625;\n    if (index == 2) limit = 0.1875;\n    if (index == 3) limit = 0.6875;\n    if (index == 4) limit = 0.8125;\n    if (index == 5) limit = 0.3125;\n    if (index == 6) limit = 0.9375;\n    if (index == 7) limit = 0.4375;\n    if (index == 8) limit = 0.25;\n    if (index == 9) limit = 0.75;\n    if (index == 10) limit = 0.125;\n    if (index == 11) limit = 0.625;\n    if (index == 12) limit = 1.0;\n    if (index == 13) limit = 0.5;\n    if (index == 14) limit = 0.875;\n    if (index == 15) limit = 0.375;\n  }\n\n  return brightness < limit ? 0.0 : 1.0;\n}\n\nfloat fcos( float x )\n{\n  float w = fwidth(x);\n  // return cos(x) * smoothstep( 3.14*2.0, 0.0, w );\n  return cos(x) * smoothstep(3.14*2.0, 0.0, w);\n}\nfloat hash(vec3 p) {\n  // return fract(sin(p.x * 1e2 + p.y) * 1e5 + sin(p.y * 1e3) * 1e3 + sin(p.x * 735. + p.y * 11.1) * 1.5e2);\n  float a = 0.0;\n  a += 0.25 * cos(p.x * 10.0 + 20.0);\n  a += 0.5 * cos(p.y * 10.0 + 40.0);\n  // a += 0.33 * cos(p.z * 10.0 + 60.0);\n  return a;\n}\n\n// GLSL smootherstep [smthrstp] from http://graphicscodex.com for reference\nfloat smootherstep(float start, float end, float t) {\n   t = max(0.0, min(1.0, (t - start) / (end - start)));\n   return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\n\nfloat Value3D( vec3 P )\n{\n  //  https://github.com/BrianSharpe/Wombat/blob/master/Value3D.glsl\n  // establish our grid cell and unit position\n  vec3 Pi = floor(P);\n  vec3 Pf = P - Pi;\n  vec3 Pf_min1 = Pf - 1.0;\n\n  // clamp the domain\n  Pi.xyz = Pi.xyz - floor(Pi.xyz * ( 1.0 / 69.0 )) * 69.0;\n  vec3 Pi_inc1 = step( Pi, vec3( 69.0 - 1.5 ) ) * ( Pi + 1.0 );\n\n  // calculate the hash\n  vec4 Pt = vec4( Pi.xy, Pi_inc1.xy ) + vec2( 50.0, 161.0 ).xyxy;\n  Pt *= Pt;\n  Pt = Pt.xzxz * Pt.yyww;\n  vec2 hash_mod = vec2( 1.0 / ( 635.298681 + vec2( Pi.z, Pi_inc1.z ) * 48.500388 ) );\n  vec4 hash_lowz = fract( Pt * hash_mod.xxxx );\n  vec4 hash_highz = fract( Pt * hash_mod.yyyy );\n\n  // blend the results and return\n  vec3 blend = Pf * Pf * Pf * (Pf * (Pf * 6.0 - 15.0) + 10.0);\n  vec4 res0 = mix( hash_lowz, hash_highz, blend.z );\n  vec4 blend2 = vec4( blend.xy, vec2( 1.0 - blend.xy ) );\n  return dot( res0, blend2.zxzx * blend2.wwyy ) * 2.0 - 1.0;\n}\n// void main () {\n//   gl_FragColor = vec4(1.0);\n// }\n\nvoid main () {\n  #ifdef HAS_INTENSITY\n  float intensity = vIntensity;\n  #else\n  float intensity = 1.0;\n  #endif\n\n  vec3 vLightDir = -lightDirection;\n  vec3 L = normalize(vLightDir);\n  vec3 V = normalize(vViewPosition);\n  vec3 N = vNormal;\n  vec4 diffuseColorRGBA = texture2D(map, vUv).rgba;\n  vec3 diffuseColor = diffuseColorRGBA.rgb;\n  float H = hash(vWorldPosition.xyz);\n\n  vec3 mapN = texture2D(normalMap, vUv).xyz;\n  if (flipNormalY) mapN.y = 1.0 - mapN.y;\n  mapN = mapN * 2.0 - 1.0;\n\n  vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\t// N = normalize( cross( fdx, fdy ) );\n\n  if (useNormalMap) {\n    N = normalize(perturbNormal2Arb( -vViewPosition, N, mapN ));\n  }\n\n  // vec3 normalized = range(minBounds, maxBounds, vWorldPosition);\n\n  vec3 minGrounded = minBounds;\n  minGrounded.y = max(0.0, minGrounded.y);\n  vec3 maxGrounded = maxBounds;\n  maxGrounded.y = max(0.0, maxGrounded.y);\n  vec3 normalized = range(minGrounded, maxGrounded, vWorldPosition);\n\n  float diffuse = (0.5 * dot(N, L)) + 0.5;\n  \n  // vec3 randomNoise3 = vec3(texture2D(noiseMap, vBillboardUV)).xyz * 2.0 - 1.0;\n  vec3 randomNoise3 = vec3(0.0);\n  float randomNoise = randomNoise3.x * 0.01;\n\n  \n  float hNoise = Value3D(vWorldPosition.xyz * 30.0);\n\n  float diffuseStep = 0.0;\n  // diffuseStep *= aastep(0.25, diffuse);\n  // diffuseStep = mix(diffuseStep, 0.5, aastep(0.5, diffuse));\n  // diffuseStep = aastep(0.75, diffuse + diffuseColor.r * 0.02);\n  // diffuseStep += aastep(0.25, diffuse + diffuseColor.g * 0.02) * 0.5;\n  // diffuseStep = min(diffuseStep, 1.0);\n\n  // diffuseStep = aastep(0.25, diffuse);\n\n  // diffuseStep *= dither(vPosition.xz * 10.0, diffuse);\n\n  // if (diffuse <= 0.2) {\n  //   diffuseStep = 0.0;\n  // } else if (diffuse <= 0.25) {\n  //   diffuseStep = 1.0;\n  // }\n\n  // float highlightLow = 0.5;\n  // float highlightHigh = 0.75;\n  // float diffuseStepHigh = aastep(0.5, smoothstep(\n  //   0.5, 0.75, diffuse\n  // ));\n  // float diffuseStepLow = aastep(0.5, smoothstep(\n  //   0.0, 0.25, diffuse\n  // ));\n\n  vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n  vec3 VC = normalize(camUpWorld);\n  // vec3 VC = normalize(cross(camRightWorld, camUpWorld));\n  // vec3 VC = normalize(cameraDirection);\n  float vDotN = 1.0 - clamp(dot(V, N), 0.0, 1.0);\n  float rim = aastep(0.5, vDotN + hNoise * 0.05);\n\n  // float gradient = pow(clamp(vWorldPosition.y / 2.0, 0.0, 1.0), 1.0);\n\n  // float ramp = intensity;\n  // if (diffuseShading) {\n  //   ramp = diffuse;\n  // } else {\n  //   ramp = diffuseStep;\n  //   // if (celShading) ramp = mix(intensity * 0.75, 1.0, diffuseStep);\n  //   // if (darkShading) ramp = mix(0.0, ramp, rim);\n  // }\n\n  vec3 gtex = texture2D(groundTexture, vGroundUv).rgb;\n\n// gl_FragColor.rgb = mix(gl_FragColor.rgb, gl_FragColor.rgb * diffuse, 0.5);\n\n  float highCut = 0.75;\n  float lowCut = 0.15;\n  // float midRangeOpacity = 0.33;\n  // float lowRangeOpacity = 0.5;\n  // gl_FragColor.rgb = mix(gl_FragColor.rgb, gl_FragColor.rgb * (aastep(highCut, diffuse)), midRangeOpacity);\n  // gl_FragColor.rgb = mix(gl_FragColor.rgb, gl_FragColor.rgb * rim, lowRangeOpacity);\n  // gl_FragColor.rgb = mix(gl_FragColor.rgb, gl_FragColor.rgb * (aastep(lowCut, diffuse)), lowRangeOpacity);\n\n  gl_FragColor.rgb = vec3(1.0);\n  // gl_FragColor.rgb = diffuseShading ? vec3(diffuse) : vec3(1.0);\n  // gl_FragColor.rgb = diffuseShading ? vec3(diffuse) : vec3(1.0);\n  if (useDiffuseMap) gl_FragColor.rgb *= diffuseColor.rgb;\n  // float highCutStep = smoothstep(0.75, 1.0, diffuse);\n  float bounce = 0.75;\n  float bounceCut = smoothstep(0.5, 0.25, diffuse);\n\n  // float lowCutStep = 1.0 - rim;\n  float lowCutStep = 1.0 - smoothstep(groundBounceLow, groundBounceHigh, diffuse + hNoise * 0.01);\n  // float lowCutStep = 1.0 - aastep(0.1, diffuse + hNoise * 0.01);\n  // float highCutStep = aastep(0.75, diffuse + hNoise * 0.01);\n  // float bounceCut = 1.0-aastep(0.25, diffuse);\n\n  // if (groundBounce) gl_FragColor.rgb = mix(gl_FragColor.rgb, gl_FragColor.rgb * gtex.rgb, lowCutStep * groundBounceStrength);\n  // gl_FragColor.rgb = mix(gl_FragColor.rgb, gl_FragColor.rgb * gtex.rgb * 0.35, (1.0 - rim) * 1.0);\n\n  // float overlay = texture2D(overlayMap, vUv).r;\n  // if (useDiffuseMap) {\n  //   gl_FragColor.rgb *= diffuseColor;\n  // }\n\n  // if (diffuseShading) gl_FragColor.rgb *= diffuse;\n  // else gl_FragColor.rgb = blendOverlay(gl_FragColor.rgb, mix(colorA, colorB, diffuseStep));\n\n  // if (useOverlayMap) {\n  //   vec4 overlayColor4 = vec4(vec3(overlayColor), (1.0 - overlay) * rim);\n  //   gl_FragColor = blend(gl_FragColor, overlayColor4);\n  // }\n\n  if (groundTextureEnabled && !ignoreGround) {\n    // float ny = normalized.y;\n    float ny = vWorldPosition.y / 0.75 + hNoise * 0.1;\n    // float ny = normalized.y + (useDiffuseMap ? -0.01*(diffuseColor.r) : 0.0);\n    float pv = smootherstep(0.0, 0.35, ny);\n    // float pv = aastep(0.5, smootherstep(0.05, 0.5, ny));\n    // gl_FragColor.rgb = vec3(pv);\n    gl_FragColor.rgb = mix(gtex, gl_FragColor.rgb, pv);\n  }\n\n  // gl_FragColor.rgb = vec3(hNoise);\n  if (debugNormals) gl_FragColor.rgb = N * 0.5 + 0.5;\n  \n  gl_FragColor.a = 1.0;\n  if (diffuseColorRGBA.a < alphaTest) discard;\n  // gl_FragColor.rgb = vec3(randomNoise3.x * 0.5 + 0.5);\n\n}\n\n// void mai2n () {\n//   float noff = 0.0;//noise(vec3(vPosition * 12.0));\n//   // float noff = noise(vec3(vPosition * 12.0));\n//   vec3 col = texture2D(map, vUv).rgb;\n//   // vec3 col = texture2D(map, vUv + vec2(0.0, noff * 0.03)).rgb;\n\n//   float y0, y1;\n//   // if (vUv.y <= (550.0/1024.0)) {\n//   //   y0 = 576.0/1024.0;\n//   //   y1 = 1.0;\n//   // } else {\n//   //   y0 = 64.0/1024.0;\n//   //   y1 = 512.0/1024.0;\n//   // }\n//   float py = vUv.y * 1024.0;\n//   float intensity = range(\n//     576.0,\n//     1024.0,\n//     py\n//   );\n\n//   // float intensity = vUv.y >= 0.5 ? 1.0 : 0.0;\n//   // intensity = 1.0;\n  \n//   #ifdef HAS_INTENSITY\n//     intensity = vIntensity;\n//   #endif\n//   intensity = pow(intensity, 1.0 / 2.2);\n\n//   vec3 vLightDir = -lightDirection;\n//   // vec3 vLightDir = (viewMatrix * vec4(lightDirection, 1.0)).xyz;\n//   // vec3 vLightDir = (viewMatrix * vec4(normalize(vec3(-2.0, 1.0, 2.0)), 1.0)).xyz;\n//   vec3 L = normalize(vLightDir);\n//   vec3 V = normalize(vViewPosition);\n\n//   vec3 normalized = range(minBounds, maxBounds, vWorldPosition);\n//   float cylindricalHeight = normalized.y;\n//   float theta = atan(normalized.z, normalized.x);\n//   float angle01 = range(-3.14, 3.14, theta);\n  \n//   // float n = normalized.y;\n//   // float n = texture2D(noise1DMap, vec2(0.0, normalized.y * 0.005 + sin(vWorldPosition.x) * 0.5)).r;\n//   // n = smoothstep(0.4, 0.45, n);\n//   // n = texture2D(noise1DMap, vec2(0.5, col.r + 1.0 / 512.0 * n)).r;\n\n//   vec3 N = vNormal;\n//   // vec3 N = normalize(colnorm * 2.0 - 1.0);\n\n//   // float n0 = texture2D(noise1DMap, vec2(0.5, normalized.y + vWorldPosition.y)).r;\n//   // float n1 = texture2D(noise1DMap, vec2(0.5, normalized.y + vWorldPosition.y + vWorldPosition.x)).r;\n\n//   float diffuse = (0.5 * dot(N, L)) + 0.5;\n//   float ndotl = diffuse;\n//   float i = 1.0;\n//   // if (diffuse >= 0.5) {\n//   //   i = 0.75;\n//   // } else {\n//   //   i = 0.25;\n//   // }\n//   // float doff = (n0 * 2.0 - 1.0) * 0.05;\n  \n//   // i = mix(0.25, 0.75, clamp(step(0.65, diffuse + doff), 0.0, 1.0));\n//   // diffuse = i;\n\n//   float ux = 0.5;\n  \n//   float dstep = aastep(0.5, smoothstep(0.5, 0.75, diffuse + noff * 0.025));\n//   // float dstep = aastep(0.5, diffuse + noff * 0.1);\n//   diffuse = mix(0.0, 1.0, dstep);\n//   // if (diffuse >= 0.66) {\n//   //   diffuse = 0.85;\n//   // } else {\n//   //   diffuse = 0.2;\n//   // }\n//   // if (diffuse >= 0.75) {\n//   //   diffuse = 0.8;\n//   // } else if (diffuse >= 0.5) {\n//   //   diffuse = 0.5;\n//   // } else {\n//   //   diffuse = 0.2;\n//   // }\n\n//   // diffuse += (n0 * 2.0 - 1.0) * 0.025 / 4.0;\n//   // diffuse += (n1 * 2.0 - 1.0) * 0.025 / 4.0;\n//   // if (diffuse >= 0.5) {\n//   //   // i = 1.0;\n//   //   i = step(0.75, diffuse + (n0 * 2.0 - 1.0) * 0.1);\n//   // } else if (diffuse >= 0.25) {\n//   //   i = step(0.5, diffuse + (n1 * 2.0 - 1.0) * 0.1);\n//   // } else {\n//   //   i = 0.25;\n//   // }\n//   // diffuse = i;\n\n//   // intensity += (n * 2.0 - 1.0) * 0.025;\n//   // if (intensity >= 0.5) {\n//   //   i = 1.0;\n//   // } else if (intensity >= 0.25) {\n//   //   i = 0.5;\n//   // } else {\n//   //   i = 0.25;\n//   // }\n//   // intensity = i;\n\n  // vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n  // vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n  // vec3 VC = normalize(camUpWorld);\n//   // vec3 VC = normalize(cross(camRightWorld, camUpWorld));\n//   // vec3 VC = normalize(cameraDirection);\n  // float vDotN = 1.0 - clamp(dot(VC, vNormal), 0.0, 1.0);\n//   float rim = aastep(0.5, vDotN + noff * 0.025);\n\n//   // float ink01 = 0.0;\n//   // ink01 += 0.5 * clamp(step(0.5, vDotN + (n0 * 2.0 - 1.0) * 0.05), 0.0, 1.0);\n//   // ink01 += 0.5 * clamp(step(0.5, vDotN + (n1 * 2.0 - 1.0) * 0.05), 0.0, 1.0);\n//   // ink01 += 0.33 * clamp(step(0.5, vDotN), 0.0, 1.0);\n\n//   // VC = normalize(camUpWorld);\n//   // vDotN = 1.0 - clamp(dot(VC, N), 0.0, 1.0);\n//   // float ink02 = step(0.5, vDotN);\n\n//   // diffuse += 1.0-n;\n//   // vec3 styleColor = blendSoftLight(vec3(intensity), vec3(diffuse), 1.0);\n//   float intensityAmount = 0.75;\n//   // vec3 styleColor = vec3(mix(diffuse, intensity, intensityAmount));\n//   vec3 solidColor = vec3(intensity);\n//   // vec3 styleColor = vec3(mix(intensity, 0.5, 0.5) + diffuse * 0.5);\n\n//   float gradient = pow(clamp(vWorldPosition.y / 2.0, 0.0, 1.0), 1.0);\n\n//   float dsteprim = aastep(0.5, smoothstep(0.1, 0.25, ndotl + noff * 0.025));\n//   // float dstep = aastep(0.5, diffuse + noff * 0.1);\n//   float drim = mix(0.0, 1.0, dsteprim);\n   \n\n//   float ramp = mix(intensity * 0.75, 1.0, diffuse);\n//   ramp = mix(0.0, ramp, rim);\n//   gl_FragColor.rgb = vec3(ramp);\n\n//   vec2 nuv = vec2(0.0);\n  \n//   float py2 = (576.0 / 1024.0) * 1024.0;\n//   // float nv = clamp(range(\n//   //   576.0,\n//   //   1024.0,\n//   //   py2 + 448.0 * ramp\n//   // ), 0.0, 1.0);\n//   // nuv.x = vUv.x;\n//   // nuv.y = nv;\n//   y1 = ((579.0 + 439.0) / 1024.0);\n//   y0 = 579.0 / 1024.0;\n//   vec3 color0 = texture2D(map, vec2(vUv.x, y0)).rgb;\n//   vec3 color1 = texture2D(map, vec2(vUv.x, y1)).rgb;\n//   gl_FragColor.rgb = mix(color0, color1, ramp);\n//   // gl_FragColor.rgb = color1;\n\n//   // vec3 solidFlat = color * 1.0;\n//   // gl_FragColor.rgb = mix(color * solidColor, solidFlat, diffuse);\n//   // gl_FragColor.rgb = mix(color * 0.5, gl_FragColor.rgb, gradient);\n\n//   // gl_FragColor.rgb = mix(\n//   //   vec3(22.0,29.0,40.0)/255.0,\n//   //   vec3(132.0,165.0,164.0)/255.0,\n//   //   gl_FragColor.r\n//   // );\n\n//   // gl_FragColor.rgb = mix(vec3(0.0), gl_FragColor.rgb, drim);\n  \n//   gl_FragColor.a = 1.0;\n\n//   // vec3 lineColor = vec3(1.0) * (1.0 - n);\n  \n//   // gl_FragColor.rgb = blendSoftLight(gl_FragColor.rgb, lineColor, 0.2);\n//   // gl_FragColor.rgba = blend(gl_FragColor.rgba, vec4(vec3(1.0), n));\n//   gl_FragColor.a = 1.0;\n//   gl_FragColor.rgb = vec3(vIntensity);\n//   // gl_FragColor.rgb = vec3(intensity);\n\n// }\n";
},{}],263:[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n#ifdef HAS_INTENSITY\nattribute float intensity;\nvarying float vIntensity;\n#endif\n\n#ifdef HAS_VERTEX_COLORS\nattribute vec3 vertexColor;\nvarying vec3 vVertexColor;\n#endif\n\nvarying vec2 vGroundUv;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\n\nvarying vec2 vBillboardUV;\nuniform vec3 minBounds;\nuniform mat4 groundProjectionMatrix;\nuniform vec3 maxBounds;\nuniform vec2 resolution;\n\nfloat range(float vmin, float vmax, float value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec2 range(vec2 vmin, vec2 vmax, vec2 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec3 range(vec3 vmin, vec3 vmax, vec3 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nvec4 range(vec4 vmin, vec4 vmax, vec4 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\n// modified from http://graphics.cs.williams.edu/papers/HashedAlphaI3D17/\n// fixed4 tex2DConstScale(sampler2D tex, float texSize, float2 uv)\n// {\n//   // Find the discretized derivatives of our coordinates\n//   float maxDeriv = max( length(ddx(uv)), length(ddy(uv)) );\n//   float pixScale = 1.0 / (texSize * maxDeriv);\n//   // Find two nearest log-discretized noise scales\n//   float2 pixScales = float2(\n//       exp2(floor(log2(pixScale))),\n//       exp2( ceil(log2(pixScale)))\n//       );\n//   // Factor to interpolate lerp with\n//   float lerpFactor = frac( log2(pixScale) );\n\n//   return lerp(\n//       tex2D(tex, pixScales.x * uv),\n//       tex2D(tex, pixScales.y * uv),\n//       lerpFactor\n//       );\n// }\n\n// \n\nvec2 getScreenUV (vec2 clipPos, float uvScale) {\n  // vec3 boxCenter = (minBounds + maxBounds) * 0.5;\n  // vec4 SSobjectPosition = projectionMatrix * viewMatrix * vec4(boxCenter, 1.0);\n  vec4 SSobjectPosition = projectionMatrix * modelViewMatrix * vec4(vec3(0.0), 1.0);\n  vec2 screenUV = vec2(clipPos.xy);\n  float screenRatio = resolution.y/resolution.x;\n\n  screenUV.x -= SSobjectPosition.x/(SSobjectPosition.w);\n  screenUV.y -= SSobjectPosition.y/(SSobjectPosition.w);\n\n  screenUV.y *= screenRatio;\n\n  screenUV *= 1.0/uvScale;\n  screenUV *= SSobjectPosition.z; // or z\n  return screenUV; \n}\n\nvoid main () {\n  vUv = uv;\n  vec3 objectNormal = normal;\n  vec3 transformedNormal = objectNormal;\n  transformedNormal = normalMatrix * transformedNormal;\n  transformedNormal = normalize(transformedNormal);\n  vNormal = transformedNormal;\n  vec3 transformed = position.xyz;\n  // transformed += normal.xyz * 0.1;\n  vPosition = transformed.xyz;\n  vec4 worldPos = modelMatrix * vec4(transformed, 1.0);\n  vec4 mvPosition = viewMatrix * worldPos;\n  gl_Position = projectionMatrix * mvPosition;\n  \n  vViewPosition = -mvPosition.xyz;\n  vWorldPosition = worldPos.xyz;\n  #ifdef HAS_INTENSITY\n  vIntensity = intensity;\n  #endif\n  #ifdef HAS_VERTEX_COLORS\n  vVertexColor = vertexColor;\n  #endif\n\n  vec3 gPos = worldPos.xyz;\n  gPos.y *= 0.0;\n  vec4 baseClipPos = groundProjectionMatrix * viewMatrix * vec4(gPos, 1.0);\n  vGroundUv = baseClipPos.xy / baseClipPos.w * 0.5 + 0.5;\n\n  // vec3 bpoint = range()\n  // vec4 vpos = projectionMatrix * modelMatrix * vec4(transformed.xyz, 1.0);\n\n  // vec3 boxCenter = (minBounds + maxBounds) * 0.5;\n  // vec3 centerWorldPos = (modelMatrix * vec4(boxCenter, 1.0)).xyz;\n\n  // vec3 npos = transformed.xyz;\n  // vec4 clipCur = projectionMatrix * modelMatrix * vec4(npos, 1.0);\n  // vec4 clipCur = projectionMatrix * modelMatrix * vec4(position.xyz, 1.0);\n  // vec4 clipMin = projectionMatrix * modelViewMatrix * vec4(minBounds.xyz, 1.0);\n  // vec4 clipMax = projectionMatrix * modelViewMatrix * vec4(maxBounds.xyz, 1.0);\n  // vec4 clipCenter = (projectionMatrix * viewMatrix * vec4(centerWorldPos, 1.0));\n  // clipCur.xy -= clipCenter.xy / clipCenter.w;\n  // vec2 clipCur2D = clipCur.xy / clipCur.w * 0.5 + 0.5;\n  // clipCur2D.xy -= clipCenter.xy / clipCenter.w * 0.5 + 0.5;\n  // vec2 clipMin2D = clipMin.xy / clipMin.w;\n  // vec2 clipMax2D = clipMax.xy / clipMax.w;\n\n  // vBillboardUV = getScreenUV(gl_Position.xy / gl_Position.w, 40.0);\n  // vBillboardUV = mix(clipMin2D, clipMax2D, range(minBounds, maxBounds, position.xyz));\n\n  // vec3 bWorldPos = worldPos.xyz + boxCenter.xyz;\n  // vec4 bClipPos = projectionMatrix * viewMatrix * vec4(bWorldPos, 1.0);\n  // vBillboardUV = bClipPos.xy / bClipPos.w * 0.5 + 0.5;\n  \n  // vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n  // vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n  \n\n  // float billboardSize = 1.0 * globalSpriteScale * absScale;\n  // vec3 vertexWorldPos = boxCenter\n  //   + camRightWorld * position.x * billboardSize\n  //   + camUpWorld * position.y * billboardSize;\n\n}";
},{}],82:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getEmptyTexture=b,exports.getSpriteGeometry=D,exports.setSpriteToken=P,exports.createTokenMaterial=U,exports.createSpriteMaterial=C,exports.createMeshMaterial=B;var e=require("three"),r=h(e),t=require("../shaders/sprite.frag"),a=y(t),o=require("../shaders/sprite.vert"),n=y(o),i=require("../tags"),l=h(i),u=require("../shaders/toon.frag"),v=y(u),s=require("../shaders/toon.vert"),c=y(s),p=require("./ShaderManager"),d=h(p),f=require("../util/tokens"),x=require("./SpriteManager"),m=y(x),g=require("./Assets"),w=y(g),M=require("./three-util");function y(e){return e&&e.__esModule?e:{default:e}}function h(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}const S=new r.PlaneGeometry(1,1,4,4);let T;function b(){if(!T){const e=new Uint8Array(12);(T=new r.DataTexture(e,2,2,r.RGBFormat)).needsUpdate=!0}return T}function D(){return S}function P(e,r,t,a=null){(0,f.getTokenSheet)().then(o=>{const n=o.map[`tokens/${t}`];if(n&&((0,M.shareAtlasTexture)(e,n.atlas,n.texture),r.material.uniforms.map.value=n.texture,r.material.uniforms.repeat.value.copy(n.repeat),r.material.uniforms.offset.value.copy(n.offset),null!=a)){const e=n.width/n.height,t=a*e;r.scale.set(t,a,1)}})}function U(e=.666,t=!0){return d.create({transparent:!0,name:"token-material",uniforms:{repeat:{value:new r.Vector2(1,1)},offset:{value:new r.Vector2(0,0)},map:{value:b()},color:{value:new r.Color(1+e,1+e,1+e)},opacity:{value:1},time:{value:0}},depthTest:t,depthWrite:t,vertexShader:"\n    varying vec2 vUv;\n    uniform vec2 repeat;\n    uniform vec2 offset;\n    void main () {\n      vUv = uv;\n      vUv *= repeat;\n      vUv += offset;\n\n      vec3 centerWorldPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n      vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n      vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n      vec2 scale;\n      scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n      scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n      vec3 offsetPos = position.xyz;\n      vec3 vertexWorldPos = centerWorldPos\n        + camRightWorld * offsetPos.x * scale.x\n        + camUpWorld * offsetPos.y * scale.y;\n\n      // gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n      gl_Position = projectionMatrix * viewMatrix * vec4(vertexWorldPos, 1.0);\n    }\n    ",side:r.DoubleSide,fragmentShader:"\n    varying vec2 vUv;\n    uniform sampler2D map;\n    // uniform sampler2D noiseMap;\n    uniform vec3 color;\n    uniform float time;\n    uniform float opacity;\n    // uniform float effect;\n    void main () {\n      vec2 uv = vUv;\n\n      // vec4 noiseLow = texture2D(noiseMap, vUv * 0.075 + vec2(time * 0.075, 0.0)) * 2.0 - 1.0;\n      // vec4 noiseHigh = texture2D(noiseMap, (vUv * 0.25 + vec2(0.0, time * 0.075))) * 2.0 - 1.0;\n\n      vec4 tcol = texture2D(map, vUv);\n      // vec4 ecol = vec4(0.0);\n      // ecol += texture2D(map, vUv + noiseLow.rg * 0.2) * 0.2;\n      // ecol += texture2D(map, vUv + noiseLow.rg * 0.1) * 0.33;\n      // ecol += texture2D(map, vUv + noiseHigh.rg * 0.05) * 0.33;\n      // vec4 fcol = mix(tcol, ecol, effect);\n      vec4 outColor = vec4(color, opacity) * tcol;\n      gl_FragColor = vec4(outColor);\n    }\n    "})}function C(e){const t=e.findTag(l.GroundPlaneView),o=b(),i=e.findTag(l.GroundDataRenderTarget);return d.create({name:"WayfinderSpriteShader",extensions:{derivatives:!0},transparent:!0,side:r.DoubleSide,fragmentShader:a.default,vertexShader:n.default,uniforms:{shadowColor:{value:new r.Color("#280422")},groundMap:{value:t.target.texture},groundProjectionMatrix:{value:t.projectionMatrix},worldDataMap:{value:i?i.target.texture:new r.Texture},worldDataProjection:{value:i?i.projection:new r.Matrix4},worldDataView:{value:i?i.view:new r.Matrix4},map:{value:o},flip:{value:1},silhouette:{value:!1,type:"b"},useMapDiscard:{value:!1,type:"b"},color:{value:new r.Color("white")},time:{value:0},spin:{value:0},spriteHeight:{value:1},aspect:{value:1},repeat:{value:new r.Vector2(1,1)},offset:{value:new r.Vector2(0,0)},tintColor:{value:new r.Color("#ffffff")}}})}function B(e,t,{map:a,ignoreGround:o=!1}){const n=e.findTag(l.GroundPlaneView),i=n.target.texture,u=n.projectionMatrix;t.updateMatrix(),t.updateMatrixWorld();const s=(new r.Box3).setFromObject(t),p=t.material,f=p.alphaTest||0;return d.create({transparent:Boolean(p.transparent),name:"WayfinderMeshShader",defines:{HAS_INTENSITY:Boolean(!1),HAS_VERTEX_COLORS:Boolean(!1)},vertexShader:c.default,fragmentShader:v.default,side:r.FrontSide,extensions:{derivatives:!0},uniforms:{alphaTest:{value:f},ignoreGround:{value:Boolean(o),type:"i"},normalMap:{value:new r.Texture},groundTexture:{value:i||new r.Texture},groundTextureEnabled:{type:"b",value:Boolean(i)},groundBounce:{type:"b",value:!0},groundBounceLow:{value:.06},groundBounceHigh:{value:.25},groundBounceStrength:{value:.5},groundProjectionMatrix:{value:u||new r.Matrix4},useNormalMap:{type:"b",value:!1},flipNormalY:{type:"b",value:!1},diffuseShading:{type:"b",value:!1},debugNormals:{type:"b",value:!1},resolution:{value:new r.Vector2},celShading:{type:"b",value:!1},darkShading:{type:"b",value:!1},vertexColors:{type:"b",value:!1},useOverlayMap:{type:"b",value:!1},useNoiseMap:{type:"b",value:!1},useDiffuseMap:{type:"b",value:!0},overlayColor:{value:new r.Color},colorA:{value:new r.Color},colorB:{value:new r.Color},cameraDirection:{value:new r.Vector3},minBounds:{value:s.min},maxBounds:{value:s.max},lightDirection:{value:new r.Vector3},map:{value:a||new r.Texture},noiseMap:{value:new r.Texture},overlayMap:{value:new r.Texture}}})}S.translate(0,.5,0);
},{"three":74,"../shaders/sprite.frag":260,"../shaders/sprite.vert":261,"../tags":60,"../shaders/toon.frag":262,"../shaders/toon.vert":263,"./ShaderManager":243,"../util/tokens":138,"./SpriteManager":248,"./Assets":31,"./three-util":80}],89:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=T;var e=require("../tags"),t=m(e),n=require("three"),a=m(n),o=require("../util/math"),i=m(o),r=require("eases"),s=m(r),l=require("../util/locale"),u=require("./AnimationSystem"),c=require("../util/materials"),d=require("../util/Assets"),p=f(d),g=require("../util/ShaderManager"),v=m(g);function f(e){return e&&e.__esModule?e:{default:e}}function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function T(e){const n=new a.Group;n.name="compass",e.entity().add(t.Object3D,n);const o=e.findTag(t.Renderer),r=new a.Color(1,1,1),d=new a.Color("#280422").lerp(r,.9),g=r,f=new a.TorusGeometry(1.25,.025,6,24);f.rotateX(-Math.PI/2),f.translate(0,.0125,0);const[m]=p.default.createGPUTextureTask(o,"image/data/compass-ring"),T=new a.PlaneBufferGeometry(1,1,1,1);T.rotateX(-Math.PI/2);const y=v.create({name:"CompassRingShader",vertexShader:"\n      varying vec2 vUv;\n      void main () {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n        vUv = uv;\n      }\n    ",fragmentShader:"\n      varying vec2 vUv;\n      uniform sampler2D map;\n      uniform vec3 color;\n      uniform float opacity;\n\n      void main () {\n        vec4 tColor = texture2D(map, vUv);\n        if (tColor.a <= 0.5) discard;\n        gl_FragColor = vec4(color * tColor.rgb, tColor.a * opacity);\n        // gl_FragColor = vec3(vec3(0.5), tColor.a);\n      }\n    ",uniforms:{color:{value:new a.Color(1.5,1.5,1.5)},opacity:{value:1},map:{value:m}},transparent:!0}),h=y,D=new a.Mesh(T,h);n.add(D);const S=y.clone();S.uniforms.color.value=d.clone(),S.uniforms.map.value=m,S.blending=a.MultiplyBlending,S.needsUpdate=!0;const k=new a.Mesh(T,S),M=e.findTag(t.RenderLayers);n.add(k),k.layers.set(M.shadow);const w=new a.MeshBasicMaterial({transparent:!0,color:new a.Color(1.5,1.5,1.5)}),A=new a.Group;n.add(A);const b=new Array(3).fill(null).map(()=>{const e=new a.Mesh((0,c.getSpriteGeometry)(),(0,c.createTokenMaterial)());return e.renderOrder=10,e.name="dot",e.userData.currentAngle=null,e.userData.currentSize=0,e.userData.lastToken=null,e.userData.lastTokenType=null,A.add(e),e}),C=new Array(4).fill().map((e,t)=>{const o=new a.Mesh(T,w);return n.add(o),o.renderOrder=1,o.scale.setScalar(t<=2?.5:1),o.userData.currentAngle=null,o.visible=!1,o});let q=!1,O=!1;const x=()=>{O=!0,p.default.createGPUTexture(o,"image/data/compass-arrow3").then(e=>{q=!0,w.map=e,w.needsUpdate=!0,C.forEach(e=>{})})},P=(e.view([t.GroundAsset,t.GroundAssetToken]),e.view(t.EnvironmentCell),e.findTag(t.TokensDiscoveredSet)),U=e.view([t.EnvironmentState,t.ActiveEnvironmentState]),z=b.map(()=>({distanceSq:1/0,token:null,consumed:!1})),E=e.entity(),G={value:0},V=e.findTag(t.UserTarget),_=e.findTag(t.UserCharacter),B=e.view([t.WrittenStanzaLine,t.WrittenStanzaLineActive]);let I=!1;const F=e.view(t.CompassVisible),j=new a.Vector3,R=e.view(t.TutorialMessage),L=e.listen(t.CompassVisible);return a=>{if(!U.length)return;const r=U[0];let p=!1;if(V&&V.forceApplied&&F.forEach(e=>{e.get(t.CompassVisible).position.distanceToSquared(V.position)>=100&&e.tagOff(t.CompassVisible)}),F.length>0){const e=F[0];e.has(t.CompassVisible)&&(p=!0,j.copy(e.get(t.CompassVisible).position))}const v=e.findTag(t.OriginTreeIntroSequence),f=!e.findTag(t.HideCharacter),m=Boolean(e.findTag(t.DirectUserToOrigin)),T=e.findTag(t.TutorialState),y=e.findTag(t.HaikuCardShown),h=e.findTag(t.ShowBiomeResolution),S=(_.position.lengthSq(),F.length>0),M=f&&(m&&!h||S&&0===B.length&&!y&&!T&&!v&&!h);if(n.visible=G.value>=1e-5,L.changed&&!m&&(R.forEach(e=>{e.get(t.TutorialMessage);e.kill()}),L.added.length)){const n=e.entity().add(t.TutorialMessage).get(t.TutorialMessage);n.id="comapss",n.message=l.localize.get().tutorialCollect,n.iconMode="token-random",n.delay=0,n.duration=6}if(I!==M){E.tagOff(t.TargetKeyTween),(0,u.setEntityTweenFromTo)(E,G,"value",G.value,M?1:0,M?2:.5,"sineOut",0);const e=E.get(t.TargetKeyTween);e.killEntityOnFinish=!1,e.assignFromOnStart=!0,I=M}n.position.distanceToSquared(_.position)>=100?n.position.copy(_.position):i.dampVector(n.position,_.position,10,a,n.position),k.material.uniforms.color.value.copy(g).lerp(d,G.value),D.material.uniforms.opacity.value=G.value;const A=2.8125*i.lerp(1.15,1,s.sineInOut(G.value));D.scale.x=A,D.scale.z=A,w.opacity=G.value,b.forEach(e=>e.material.uniforms.opacity.value=G.value),D.position.y=.3,k.position.y=.01,k.scale.copy(D.scale),D.rotation.y+=.5*a,k.rotation.y=D.rotation.y;const K=_.position.x,W=_.position.z,X=r.get(t.EnvironmentState).tokens,J=Boolean(e.findTag(t.DirectUserToOrigin)),N=Boolean(e.findTag(t.BlockTokenCollection)),Q=!v&&!J&&!N;if(p){for(let e=0;e<z.length;e++)z[e].distanceSq=1/0,z[e].token=null,z[e].consumed=!1;p=!1;for(let e=0;e<X.length;e++){const t=X[e],n=!P.has(t.type);if(!(Q&&n))continue;const a=t.position[0],o=t.position[1],i=a-j.x,r=o-j.z,s=i*i+r*r;s<=z[0].distanceSq?(z[0].distanceSq=s,z[0].token=t):s<=z[1].distanceSq?(z[1].distanceSq=s,z[1].token=t):s<=z[2].distanceSq&&(z[2].distanceSq=s,z[2].token=t)}}const Y=C[C.length-1];let Z=Y.userData.currentAngle;if(m){const e=0-K,t=0-W;Z=Math.atan2(t,e),O||x(),Y.material.opacity=G.value}if(Y.visible=q&&m,D.visible=G.value>=1e-5,k.visible=D.visible,null!=Z){null==Y.userData.currentAngle&&(Y.userData.currentAngle=Z),Y.userData.currentAngle=i.dampAngle(Y.userData.currentAngle,Z,10,a);const e=Y.userData.currentAngle,t=2.25+.1*.5,n=Math.cos(e)*t,o=Math.sin(e)*t;Y.position.set(n,D.position.y,o),Y.rotation.y=Math.PI+Math.PI/2+-e}for(let e=0;e<b.length;e++){const t=b[e],n=C[e];t.visible=!1,n.visible=!1;let r=0,s=t.userData.currentAngle;const l=H(t);if(l){l.consumed=!0;const e=l.token;t.userData.lastToken=e;const n=e.position[0]-K,a=e.position[1]-W;Math.sqrt(n*n+a*a);s=Math.atan2(a,n),r=1,null==t.userData.currentAngle&&(t.userData.currentAngle=s)}else t.userData.lastToken=null;t.userData.currentAngle=i.dampAngle(t.userData.currentAngle,s,10,a),t.userData.currentSize=i.dampAngle(t.userData.currentSize,r,5,a);const u=t.userData.currentAngle;if(null!=u){const e=t.userData.currentSize,a=Math.cos(u),i=Math.sin(u),r=.7,s=2+.1*r,l=a*s,d=i*s;t.position.set(l,D.position.y-.25,d),t.scale.setScalar(r),t.visible=e>=1e-5&&!m,t.visible&&t.userData.lastToken&&t.userData.lastTokenType!==t.userData.lastToken.type&&(t.userData.lastTokenType=t.userData.lastToken.type,(0,c.setSpriteToken)(o,t,t.userData.lastTokenType));const p=s+.75;h||m?n.visible=!1:(n.visible=!0,n.position.set(a*p,D.position.y,i*p),n.rotation.y=Math.PI+Math.PI/2+-u,O||x())}else t.visible=!1,n.visible=!1}};function H(e){const t=e.userData.lastToken;if(t){const e=z.find(e=>e.token===t);if(e&&!e.consumed&&e.token)return e}return z.find(e=>e.token&&!e.consumed)}}
},{"../tags":60,"three":74,"../util/math":240,"eases":291,"../util/locale":227,"./AnimationSystem":108,"../util/materials":82,"../util/Assets":31,"../util/ShaderManager":243}],90:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=require("../tags"),t=l(e),r=require("three"),n=l(r),o=require("../util/math"),i=l(o),a=require("./AnimationSystem"),s=require("../util/materials");function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function u(e){const r=new n.Group;r.name="compass",e.entity().add(t.Object3D,r);e.view([t.GroundAsset,t.GroundAssetToken]),e.view(t.EnvironmentCell);const o=e.findTag(t.TokensDiscoveredSet),i=e.view([t.EnvironmentState,t.ActiveEnvironmentState]),a=e.findTag(t.UserTarget);e.findTag(t.UserCharacter),new Array(3).fill(null).map(()=>{const e=new n.Mesh((0,s.getSpriteGeometry)(),(0,s.createTokenMaterial)());return e.renderOrder=10,e.name="dot",e.userData.currentAngle=null,e.userData.currentSize=0,e.userData.lastToken=null,e.userData.lastTokenType=null,r.add(e),e});return r=>{if(!i.length)return;const n=i[0].get(t.EnvironmentState).tokens,s=Boolean(e.findTag(t.DirectUserToOrigin)),l=Boolean(e.findTag(t.BlockTokenCollection)),u=!s&&!l,c=n.filter(e=>{const t=!o.has(e.type);return u&&t}).map(e=>{const t=e.position[0],r=e.position[1],n=t-a.position.x,o=r-a.position.z;return[n*n+o*o,e]});c.sort((e,t)=>e[0]-t[0]);c.slice(0,3).map(e=>e[1])}}
},{"../tags":60,"three":74,"../util/math":240,"./AnimationSystem":108,"../util/materials":82}],132:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.playerStart=exports.standingNextToOriginTree=void 0,exports.default=s,exports.setPlayerPos=a;var e=require("three"),t=r(e);function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}const o=exports.standingNextToOriginTree=new t.Vector3(7,0,3),n=exports.playerStart=new t.Vector3(7,0,3);function s(e){a(e,n),e.findTag(Tags.UserTarget).position.set(0,0,0)}function a(e,t){e.findTag(Tags.UserTarget).position.copy(t);const r=e.findTag(Tags.UserCharacter);r&&r.position.copy(t)}
},{"three":74}],91:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=p;var e=require("three"),t=c(e),a=require("../tags"),n=c(a),o=require("../util/math"),r=c(o),i=require("../util/Random"),l=d(i),s=require("../util/resetPlayerPos");function d(e){return e&&e.__esModule?e:{default:e}}function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function p(e){const a=new t.Vector2,o=new t.Raycaster,i=new t.Plane(new t.Vector3(-0,-1,-0),-0),s=new t.Vector3,d=new t.Vector3,c=(0,l.default)(),p=new t.Vector3,u=new t.Vector3;let f=0,m=0;let g,h,v=.5,T=r.degToRad(45*c.pick([1,3,5,7]));const y=e.entity("UserTargetEntity").add(n.UserTarget),M=e.query(n.InputState),w=e.query(n.MainCamera),B=e.query(n.UserTarget),x=e.view(n.MovementBoost),P=e.view(n.ClearInputPress);let U=null;return function(t){let l=Boolean(e.findTag(n.BlockUserMove)),c=Boolean(e.findTag(n.CameraStopUserMovement)),q=Boolean(e.findTag(n.TransitionToNextBiome))||Boolean(e.findTag(n.ShowBiomeResolution));const A=e.findTag(M),O=e.findTag(w),S=e.findEntity(B),z=S.get(n.UserTarget),V=z.position;a.set(2*A.positionNormalized.x-1,2*-A.positionNormalized.y+1),o.setFromCamera(a,O);const b=P.length>0,C=!b&&o.ray.intersectPlane(i,s);let _=1,I=q||A.interacted&&!l;if(C&&I){d.set(V.x,0,V.z);e.findTag(n.UserCharacter);p.copy(s).sub(d);const t=p.length();0!==t&&p.divideScalar(t),_*=r.clamp01(Math.pow(t/4,.04)),g=Math.atan2(p.z,p.x),null==h&&(h=g)}null!=h&&null!=g&&(h=r.dampAngle(h,g,7,t),u.set(Math.cos(h),0,Math.sin(h)));const N=Boolean(e.findTag(n.IsGameUIActive)),j=!b&&!c&&I&&!N&&!Boolean(e.findTag(n.OriginTreeIntroSequence))&&!Boolean(e.findTag(n.ModalStoppingUserMovement));let L=!1;(A.pressed||q)&&j?(L=!0,f=r.damp(f,3,5,t),m=r.damp(m,4.5,2,t)):(f=r.damp(f,0,2,t),m=r.damp(m,0,5,t)),L!==U&&(L?y.tagOn(n.UserForceApplied):y.tagOff(n.UserForceApplied),U=L);let R=(f*=_)+(m*=_),k=0;x.forEach(e=>{const a=e.get(n.MovementBoost);k+=a.value,a.value=r.damp(a.value,1e-4,a.frictionPower,t),a.elapsed+=t,a.elapsed>=a.duration&&e.kill()});let D=t*R*1+1*k*t;j&&V.addScaledVector(u,D);const E=e.findTag(n.GameLandingCameraDrift);let F=v;if(A.interacted&&I){const e=2*A.positionNormalized.x-1,t=2*A.positionNormalized.y-1,a=r.clamp01(Math.sqrt(e*e+t*t));F=r.lerp(.1,.75,Math.pow(a,.5))}E&&null!=E.fixed&&(F=E.fixed);const G=null!=h?h:T;if(T=r.dampAngle(T,G,3,t),v=r.dampAngle(v,F,5,t),E&&(d.set(Math.cos(T),0,Math.sin(T)),V.addScaledVector(d,t*v)),V.x=r.clamp(-243.2,243.2,V.x),V.z=r.clamp(-243.2,243.2,V.z),z.forceApplied=L,z.direction.copy(u),z.totalBoost=k,z.speedAlpha=r.inverseLerp(0,3,f),z.boostAlpha=r.inverseLerp(0,4.5,m),z.totalSpeedAlpha=r.inverseLerp(0,7.5,R),z.inputHitPlane=C,C&&z.inputPositionOnPlane.copy(s),S.has(n.Object3D)){S.get(n.Object3D).position.copy(V)}}}
},{"three":74,"../tags":60,"../util/math":240,"../util/Random":235,"../util/resetPlayerPos":132}],692:[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n// #define IS_CLOSED\nattribute float direction;\nattribute vec2 vertexDistance;\nattribute vec3 nextPosition;\nattribute vec3 previousPosition;\nattribute float vertexHasToken;\n\nuniform bool taper;\nuniform bool miter;\nuniform float time;\nuniform float totalDistance;\nuniform float miterLimit;\nuniform float thickness;\nuniform float draw;\nuniform bool drawing;\nuniform bool filling;\n\nuniform vec2 resolution;\n\nvarying float vToken;\nvarying vec2 vDist;\n\nvec4 screenSpaceLine (vec3 offset, float computedThickness) {\n  float aspect = resolution.x / resolution.y;\n  vec2 aspectVec = vec2(aspect, 1.0);\n  mat4 projViewModel = projectionMatrix * modelViewMatrix;\n  vec4 previousProjected = projViewModel * vec4(vec3(previousPosition.xyz) + offset, 1.0);\n  vec4 currentProjected = projViewModel * vec4(vec3(position.xyz) + offset, 1.0);\n  vec4 nextProjected = projViewModel * vec4(vec3(nextPosition.xyz) + offset, 1.0);\n\n  //get 2D screen space with W divide and aspect correction\n  vec2 currentScreen = currentProjected.xy / currentProjected.w * aspectVec;\n  vec2 previousScreen = previousProjected.xy / previousProjected.w * aspectVec;\n  vec2 nextScreen = nextProjected.xy / nextProjected.w * aspectVec;\n  \n  float len = computedThickness;\n  float orientation = direction;\n  vec2 dirA = normalize(currentScreen - previousScreen);\n\n  //starting point uses (next - current)\n  vec2 dir = vec2(0.0);\n  #ifndef IS_CLOSED\n  if (currentScreen == previousScreen) {\n    dir = normalize(nextScreen - currentScreen);\n  } \n  //ending point uses (current - previous)\n  else if (currentScreen == nextScreen) {\n    dir = normalize(currentScreen - previousScreen);\n  }\n  //somewhere in middle, needs a join\n  else {\n  #endif\n    //get directions from (C - B) and (B - A)\n    vec2 dirB = normalize(nextScreen - currentScreen);\n    if (miter) {\n      //now compute the miter join normal and length\n      vec2 tangent = normalize(dirA + dirB);\n      vec2 perp = vec2(-dirA.y, dirA.x);\n      vec2 miter = vec2(-tangent.y, tangent.x);\n      float miterDot = dot(miter, perp);\n      len = miterDot == 0.0 ? 0.0 : (computedThickness / miterDot);\n      len = clamp(len, 0.0, computedThickness * miterLimit);\n      dir = tangent;\n    } else {\n      dir = normalize(dirA + dirB);\n    }\n  #ifndef IS_CLOSED\n  }\n  #endif\n\n  vec2 normal = vec2(-dir.y, dir.x);\n\n  // convert pixel thickness to NDC space\n  vec2 normalLength = vec2(len / 2.0);\n  normalLength = normalLength * 2.0;\n\n  // scale normal to line thickness\n  normal *= normalLength;\n  normal.x /= aspect;\n\n  vec4 finalOffset = vec4(normal * orientation, 0.0, 0.0);\n  return currentProjected + finalOffset;\n}\n\nfloat cubicPulse( float c, float w, float x )\n{\n  x = abs(x - c);\n  if( x>w ) return 0.0;\n  x /= w;\n  return 1.0 - x*x*(3.0-2.0*x);\n}\n\nfloat parabola( float x, float k )\n{\n    return pow( 4.0*x*(1.0-x), k );\n}\n\nvoid main () {\n  float computedThickness = thickness;\n  // computedThickness *= mix(0.5, 1.0, vertexHasToken);\n  if (taper) computedThickness *= sin(3.14 * vertexDistance.x);\n\n  if (drawing) {\n    computedThickness *= smoothstep(1.0, 1.0-0.05, vertexDistance.x);\n    computedThickness *= smoothstep(0.0, 0.05, vertexDistance.x);\n    // computedThickness *= smoothstep(draw - smoothness, draw + smoothness, vertexDistance.x);\n\n    float e = 0.25;\n    float t = draw;\n\n    // computedThickness *= parabola(vertexDistance.x, 1.0);\n    float m = mix(-e, 1.0 + e, t);\n    float d = 1.0 - min(1.0, abs(vertexDistance.x - m) / e);\n    // computedThickness *= step(t, vertexDistance.x);\n\n    // float d = smoothstep(m + e, m - e, vertexDistance.x);\n    computedThickness *= cubicPulse(m, e, vertexDistance.x);\n    // computedThickness *= smoothstep(totalDistance, totalDistance / 2.0, vertexDistance.y);\n  } else if (filling) {\n    computedThickness *= step(vertexDistance.x, draw);\n  }\n  // computedThickness *= abs(vertexDistance.y / )\n  float yoff = sin(time + vertexDistance.x * 4.0) * 0.1;\n  vec3 offset = vec3(0.0, 0.0, 0.0);\n  // offset.y += 2.0 + sin(position.y * 4.0) * 2.0;\n  gl_Position = screenSpaceLine(offset, computedThickness);\n  vDist = vertexDistance;\n  vToken = vertexHasToken;\n}";
},{}],693:[function(require,module,exports) {
module.exports="#define GLSLIFY 1\nuniform vec3 color;\nuniform float opacity;\nuniform float time;\nuniform float totalDistance;\nuniform float dottedFill;\nuniform bool dotted;\n\nvarying vec2 vDist;\nvarying float vToken;\n\nfloat aastep(float threshold, float value) {\n  #ifdef GL_OES_standard_derivatives\n    float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;\n    return smoothstep(threshold-afwidth, threshold+afwidth, value);\n  #else\n    return step(threshold, value);\n  #endif  \n}\n\nvoid main() {\n  float d = vDist.y / totalDistance;\n\n  gl_FragColor = vec4(color, opacity);\n\n  if (dotted) {  \n    // float dotted = vToken > 0.5 ? 1.0 : step(0.5, fract(-time * 0.2 + vDist.y / 1.0));\n    float dotted = fract(-time * 0.2 + vDist.y / 0.5);\n    dotted = mix(dotted, 1.0, step(vDist.x, dottedFill));\n    gl_FragColor.a *= aastep(0.5, dotted);\n  }\n  // if (gl_FragColor.a < 0.5) discard;\n  // gl_FragColor = vec4(mix(vec3(1.0), vec3(1.0,0.0,0.0), vToken) * vec3(d), opacity);\n}\n";
},{}],280:[function(require,module,exports) {
module.exports="#define GLSLIFY 1\nuniform highp sampler2D map;\nuniform sampler2D noiseMap;\nuniform sampler2D lutMap;\nuniform sampler2D glowMap;\nuniform float fadeToBlack;\nuniform vec3 fadeToBlackColor;\nuniform vec2 resolution;\nuniform vec3 rampColor0;\nuniform vec3 rampColor1;\n\nuniform float time;\nuniform float rampStrength;\nuniform float lightColor;\n\nvarying vec2 vUv;\n\n// uniform vec3 colorGradientA;\n\n// vec3 texGlowMap(vec2 uv);\n\n// #pragma glslify: blur = require('glsl-hash-blur', sample=texGlowMap, iterations=20)\n\n// vec3 texGlowMap(vec2 uv) {\n//   return texture2D(glowMap, uv).rgb;\n// }\n\nfloat blendOverlay(float base, float blend) {\n\treturn base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n}\n\nvec3 blendOverlay(vec3 base, vec3 blend) {\n\treturn vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n}\n\nvec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n\treturn (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n}\n\nfloat blendSoftLight(float base, float blend) {\n\treturn (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n}\n\nvec3 blendSoftLight(vec3 base, vec3 blend) {\n\treturn vec3(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b));\n}\n\nvec3 blendSoftLight(vec3 base, vec3 blend, float opacity) {\n\treturn (blendSoftLight(base, blend) * opacity + base * (1.0 - opacity));\n}\n\n// #define LUT_FLIP_Y\n\nhighp vec3 colorLUT(in highp vec3 textureColor, in highp sampler2D lookupTable) {\n  textureColor = clamp(textureColor, 0.0, 1.0);\n  highp float blueColor = textureColor.b * 63.0;\n\n  highp vec2 quad1;\n  quad1.y = floor(floor(blueColor) / 8.0);\n  quad1.x = floor(blueColor) - (quad1.y * 8.0);\n\n  highp vec2 quad2;\n  quad2.y = floor(ceil(blueColor) / 8.0);\n  quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\n  highp vec2 texPos1;\n  texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n  texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g);\n\n  // #ifdef LUT_FLIP_Y\n  texPos1.y = 1.0-texPos1.y;\n  // #endif\n\n  highp vec2 texPos2;\n  texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n  texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g);\n\n  // #ifdef LUT_FLIP_Y\n  texPos2.y = 1.0-texPos2.y;\n  // #endif\n\n  highp vec3 newColor1 = texture2D(lookupTable, texPos1).rgb;\n  highp vec3 newColor2 = texture2D(lookupTable, texPos2).rgb;\n\n  highp vec3 newColor = mix(newColor1, newColor2, fract(blueColor));\n  return newColor;\n}\n\n/**\nBasic FXAA implementation based on the code on geeks3d.com with the\nmodification that the texture2DLod stuff was removed since it's\nunsupported by WebGL.\n\n--\n\nFrom:\nhttps://github.com/mitsuhiko/webgl-meincraft\n\nCopyright (c) 2011 by Armin Ronacher.\n\nSome rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are\nmet:\n\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n\n    * The names of the contributors may not be used to endorse or\n      promote products derived from this software without specific\n      prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n\"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n#ifndef FXAA_REDUCE_MIN\n    #define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n    #define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n    #define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent \n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n            vec2 v_rgbNW, vec2 v_rgbNE, \n            vec2 v_rgbSW, vec2 v_rgbSE, \n            vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n              dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n        texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n        texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\n//To save 9 dependent texture reads, you can compute\n//these in the vertex shader and use the optimized\n//frag.glsl function in your frag shader. \n\n//This is best suited for mobile devices, like iOS.\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n\t\t\tout vec2 v_rgbNW, out vec2 v_rgbNE,\n\t\t\tout vec2 v_rgbSW, out vec2 v_rgbSE,\n\t\t\tout vec2 v_rgbM) {\n\tvec2 inverseVP = 1.0 / resolution.xy;\n\tv_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n\tv_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n\tv_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n\tv_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n\tv_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvec4 apply(sampler2D tex, vec2 fragCoord, vec2 resolution) {\n\tmediump vec2 v_rgbNW;\n\tmediump vec2 v_rgbNE;\n\tmediump vec2 v_rgbSW;\n\tmediump vec2 v_rgbSE;\n\tmediump vec2 v_rgbM;\n\n\t//compute the texture coords\n\ttexcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\t\n\t//compute FXAA\n\treturn fxaa(tex, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n\n#define gamma 2.2\n\nvec2 rotateAround (vec2 vec, vec2 center, float angle) {\n  float c = cos( angle );\n  float s = sin( angle );\n\n  float x = vec.x - center.x;\n  float y = vec.y - center.y;\n\n  vec2 outVec;\n  outVec.x = x * c - y * s + center.x;\n  outVec.y = x * s + y * c + center.y;\n  return outVec;\n}\n\nfloat linearGradient (vec2 uv, vec2 start, vec2 end) {\n  vec2 gradientDirection = end - start;\n  float gradientLenSq = dot(gradientDirection, gradientDirection);\n  vec2 relCoords = uv - start;\n  float t = dot(relCoords, gradientDirection);\n  if (gradientLenSq != 0.0) t /= gradientLenSq;\n  return t;\n}\n\nvec4 texLinear (sampler2D image, vec2 uv) {\n  return texture2D(image, uv);\n  // return GammaToLinear(texture2D(image, uv), gamma);\n}\n\nvec4 chromatic (sampler2D image, vec2 uv, vec2 direction) {\n  vec4 col = vec4( 0.0 );\n  vec2 off = vec2( 1.3333333333333333 ) * direction;\n  col.a = 1.0;\n  col.r = texture2D( image, uv ).r;\n  col.g = texture2D( image, uv - ( off / resolution ) ).g;\n  col.b = texture2D( image, uv - 2.0 * ( off / resolution ) ).b;\n  return col;\n}\n\nvec3 linearToneMapping(vec3 color)\n{\n  float exposure = 1.;\n  color = clamp(exposure * color, 0., 1.);\n  color = pow(color, vec3(1. / gamma));\n  return color;\n}\n\nvec3 simpleReinhardToneMapping(vec3 color)\n{\n  float exposure = 1.5;\n  color *= exposure/(1. + color / exposure);\n  color = pow(color, vec3(1. / gamma));\n  return color;\n}\n\nvec3 lumaBasedReinhardToneMapping(vec3 color)\n{\n\tfloat luma = dot(color, vec3(0.2126, 0.7152, 0.0722));\n\tfloat toneMappedLuma = luma / (1. + luma);\n\tcolor *= toneMappedLuma / luma;\n\tcolor = pow(color, vec3(1. / gamma));\n\treturn color;\n}\n\nvec3 whitePreservingLumaBasedReinhardToneMapping(vec3 color)\n{\n\tfloat white = 2.;\n\tfloat luma = dot(color, vec3(0.2126, 0.7152, 0.0722));\n\tfloat toneMappedLuma = luma * (1. + luma / (white*white)) / (1. + luma);\n\tcolor *= toneMappedLuma / luma;\n\tcolor = pow(color, vec3(1. / gamma));\n\treturn color;\n}\n\nvec3 RomBinDaHouseToneMapping(vec3 color)\n{\n    color = exp( -1.0 / ( 2.72*color + 0.15 ) );\n\tcolor = pow(color, vec3(1. / gamma));\n\treturn color;\n}\n\nvec3 filmicToneMapping(vec3 color)\n{\n\tcolor = max(vec3(0.), color - vec3(0.004));\n\tcolor = (color * (6.2 * color + .5)) / (color * (6.2 * color + 1.7) + 0.06);\n\treturn color;\n}\n\nvec4 sharpen(in sampler2D tex, in vec2 coords, in vec2 renderSize) {\n  float dx = 1.0 / renderSize.x;\n  float dy = 1.0 / renderSize.y;\n  vec4 sum = vec4(0.0);\n  sum += -1. * texture2D(tex, coords + vec2( -1.0 * dx , 0.0 * dy));\n  sum += -1. * texture2D(tex, coords + vec2( 0.0 * dx , -1.0 * dy));\n  sum += 5. * texture2D(tex, coords + vec2( 0.0 * dx , 0.0 * dy));\n  sum += -1. * texture2D(tex, coords + vec2( 0.0 * dx , 1.0 * dy));\n  sum += -1. * texture2D(tex, coords + vec2( 1.0 * dx , 0.0 * dy));\n  return sum;\n}\n\nvoid main2 () {\n  gl_FragColor = texture2D(map, vUv);\n}\n\nvoid main () {\n  vec2 nq = vUv / (20.0 / resolution.xy);\n  float aspect = resolution.x / resolution.y;\n  // if (aspect > 1.0) nq.x *= aspect;\n  // else nq.y /= aspect;\n  vec4 noise = texture2D(noiseMap, nq);\n\n  vec2 q = vUv - 0.5;\n  float d = length(q);\n\n  float caVig = smoothstep(0.3, 0.75, d);\n  vec2 direction = ( vUv - 0.5 ) * mix(0.5, 4.0, caVig) * noise.r * 1.0;\n  // vec2 direction = ( vUv - 0.5 ) * caVig * noise.r * 4.0;\n  // vec2 direction = ( vUv - 0.5 ) * 2.0 * noise.r;\n  // vec3 colorTex = mix(\n  //   chromatic(map, vUv, direction).rgb,\n  //   sharpen(map, vUv, resolution).rgb,\n  //   0.25\n  // );\n\n\tvec2 fragCoord = vUv * resolution;\n\t// vec3 colorTex = mix(\n  //   fxaa(map, fragCoord, resolution).rgb,\n  //   sharpen(map, vUv, resolution).rgb,\n  //   0.25\n  // );\n  // vec3 colorTex = fxaa(map, fragCoord, resolution).rgb;\n  vec3 colorTex = clamp(chromatic(map, vUv, direction).rgb, 0.0, 1.0);\n  // vec3 colorTex = texture2D(map, vUv).rgb;\n  // vec3 colorTex = mix(\n  //   chromatic(map, vUv, direction).rgb,\n  //   fxaa(map, fragCoord, resolution).rgb,\n  //   1.0-caVig\n  // );\n\n  // vec3 raw = colorTex;\n\n  vec2 corner = vec2(1.0, 1.0);\n  vec2 delta = vUv - corner;\n  if (aspect < 1.0) delta.x *= aspect;\n  else delta.y /= aspect;\n  float gradDist = clamp(1.0 - length(delta), 0.0, 1.0);\n\n  // colorTex.rgb += mix(rampColor0, rampColor1, vUv.y) * 0.1;\n  // colorTex.rgb = blendSoftLight(colorTex, colorTex + mix(rampColor0, rampColor1, vUv.y), 0.25);\n\n  // colorTex += gradDist * 0.1;\n  // colorTex = blendOverlay(colorTex, colorTex + gradDist , 0.05);\n  // colorTex += mix(rampColor0, rampColor1, vUv.y) * 0.05;\n  // colorTex.rgb = blendSoftLight(colorTex, mix(rampColor0, rampColor1, vUv.y), 0.1);\n\n  float vignetteStrength = 1.0;\n  float vignetteDarken = 0.2;\n\n  colorTex = blendSoftLight(colorTex, (noise.rgb*2.0-1.0), 0.05);\n\n  // colorTex.rgb = colorLUT(colorTex.rgb, lutMap);\n  colorTex = mix(colorTex, colorTex * smoothstep(1.0, 0.35, d), vignetteStrength * vignetteDarken);\n  colorTex = blendOverlay(colorTex, colorTex * 1.0, smoothstep(0.3, 1.0, d) * vignetteStrength);\n  colorTex = blendOverlay(colorTex, colorTex * 0.5, smoothstep(0.4, 0.9, d) * vignetteStrength);\n\n  gl_FragColor = vec4(vec3(colorTex), 1.0);\n\n  // color ramp\n  // vec3 colorRamp = mix(rampColor0, rampColor1, linearGradient(\n  //   vUv + noise.rg * 0.05,\n  //   vec2(1.0, 0.0),\n  //   vec2(0.0, 1.0)\n  // ));\n\n  // gl_FragColor.rgb = blendOverlay(gl_FragColor.rgb, colorRamp, rampStrength);\n  gl_FragColor.rgb = colorLUT(gl_FragColor.rgb, lutMap);\n  \n  // float lightRamp = linearGradient(\n  //   vUv + noise.ba * 0.05,\n  //   vec2(0.0, 0.0),\n  //   vec2(1.0, 1.0)\n  // );\n  // lightRamp = pow(lightRamp, 3.5);\n  // float sa = sin(vUv.x * 10.0 + vUv.y * -5.0 + 0.5);\n  // float sb = sin(vUv.x * 7.0 + vUv.y * -7.0 + time * 0.0);\n  // float str = 1.0;//. mix(0.0, 1.0, sin(time * 0.25 + vUv.x * 3.5)*0.5+0.5);\n  // float lightStr = lightRamp;\n  // float lightStr = step(0.5, ((sa * sb) * 0.5 + 0.5));\n  // lightRamp = smoothstep(0.5, 1.0, lightRamp);\n  // gl_FragColor.rgb = blendSoftLight(gl_FragColor.rgb, vec3(1.5), rampStrength * lightStr);\n  // gl_FragColor.rgb = blendSoftLight(gl_FragColor.rgb, vec3(1.0), rampStrength * lightStr * 0.1 * lightRamp);\n\n  #ifdef HAS_FLOAT\n  gl_FragColor.rgb += clamp(texture2D(glowMap, vUv).rgb, 0.0, 1.0);\n  #endif\n\n  // gl_FragColor.rgb += vec3(lightStr);\n\n  gl_FragColor.rgb = clamp(gl_FragColor.rgb, 0.0, 1.0);\n\n  gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(fadeToBlackColor), fadeToBlack);\n\n  // gl_FragColor.rgb = texture2D(glowMap, vUv).rgb;\n  // gl_FragColor.rgb += blur(vUv,10.0/resolution.x, 1.0);\n}\n\n//524b19\n// 47411A";
},{}],281:[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nuniform vec2 resolution;\nuniform sampler2D map;\nuniform vec2 direction;\nvarying vec2 vUv;\n\nvec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  color += texture2D(image, uv) * 0.1964825501511404;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n  color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n  color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n  return color;\n}\n\nvoid main() {\n  // gl_FragColor = texture2D(map, gl_FragCoord.xy /resolution.xy);\n  gl_FragColor = blur13(map, vUv, resolution.xy, direction);\n}";
},{}],107:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GLOW_LAYER=void 0,exports.default=x;var e=require("../tags"),a=T(e),t=require("three"),r=T(t),n=require("../shaders/post-process.frag"),i=v(n),l=require("../util/query-string"),s=v(l),o=require("../util/load"),u=require("../shaders/post-process-bloom-glow.frag"),d=v(u),m=require("./AnimationSystem"),g=require("../util/ShaderManager"),c=T(g),p=require("../util/Assets"),f=v(p),h=require("../util/addFrameTasks");function v(e){return e&&e.__esModule?e:{default:e}}function T(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t]);return a.default=e,a}const b="image/data/lut-forest",w="image/data/bluenoise-0",_=exports.GLOW_LAYER=12;function x(e,t={}){const{fade:n=0}=t,l=e.findTag(a.Renderer),o=l.capabilities.isWebGL2||Boolean(l.extensions.get("OES_texture_half_float")),u=l.capabilities.isWebGL2||Boolean(l.extensions.get("OES_texture_float"));let g,p,v,T;const b=512,_=512,x=!1!==s.default.ground,S=!1!==s.default.float,M=!1!==s.default.post,y=S&&(o||u);let F=null;const D=new r.Texture;D.minFilter=D.magFilter=r.LinearFilter,D.generateMipmaps=!1;const[L]=f.default.createGPUTextureTask(l,w,{wrapS:r.RepeatWrapping,wrapT:r.RepeatWrapping}),W=e.view([a.ShadowCaster,a.Object3D]),C=new r.Scene,O=new r.OrthographicCamera(-1,1,1,-1,0,1),A=new r.BufferGeometry;A.setAttribute("position",new r.Float32BufferAttribute([-1,-1,-1,4,4,-1],2));const R="\n    varying vec2 vUv;\n    void main () {\n      vUv = position.xy * 0.5 + 0.5;\n      gl_Position = vec4(position.xy, 0.0, 1.0);\n    }\n  ",B=(new r.ShaderMaterial({name:"GlowPass1Material",depthWrite:!0,depthTest:!1,uniforms:{map:{value:new r.Texture}},side:r.BackSide,vertexShader:R,fragmentShader:"\n      varying vec2 vUv;\n      uniform sampler2D map;\n      void main () {\n        gl_FragColor = texture2D(map, vUv);\n      }\n    "}),new r.ShaderMaterial({name:"GlowPass0Material",depthWrite:!1,depthTest:!1,uniforms:{resolution:{value:new r.Vector2(0,0)},map:{value:new r.Texture}},defines:{HAS_FLOAT:y},side:r.BackSide,vertexShader:R,fragmentShader:"\n      uniform highp sampler2D map;\n      varying vec2 vUv;\n      float luma(vec3 color) {\n        return dot(color, vec3(0.299, 0.587, 0.114));\n      }\n      void main () {\n        vec3 rgb = texture2D(map, vUv).rgb;\n        \n        #ifdef HAS_FLOAT\n          vec3 col;\n          col.r = rgb.r > 1.0 ? rgb.r : 0.0;\n          col.g = rgb.g > 1.0 ? rgb.g : 0.0;\n          col.b = rgb.b > 1.0 ? rgb.b : 0.0;\n          col -= 1.0;\n          col = max(col, 0.0);\n          gl_FragColor = vec4(col, 1.0);\n        #else\n          float L = luma(rgb);\n          gl_FragColor = vec4(vec3(smoothstep(0.75, 1.0, L)), 1.0);\n        #endif\n      }\n    "})),G=new r.ShaderMaterial({name:"GlowPass1Material",depthWrite:!1,depthTest:!1,uniforms:{direction:{value:new r.Vector2(1,0)},resolution:{value:new r.Vector2(0,0)},map:{value:new r.Texture}},side:r.BackSide,vertexShader:R,fragmentShader:d.default}),P=new r.ShaderMaterial({name:"PostMaterial",depthWrite:!1,depthTest:!1,defines:{HAS_FLOAT:y},uniforms:{resolution:{value:new r.Vector2(0,0)},noiseMap:{value:L},glowMap:{value:new r.Texture},lutMap:{value:D},rampColor0:{value:new r.Color("#57738f")},rampColor1:{value:new r.Color("#172a46")},rampStrength:{value:1},time:{value:0},map:{value:new r.Texture},fadeToBlackColor:{value:new r.Color("#130904")},fadeToBlack:{value:n}},side:r.BackSide,vertexShader:R,fragmentShader:i.default}),k=new r.Mesh(A,P);k.name="post-process-quad",k.frustumCulled=!1,C.add(k);const E=e.findTag(a.RenderLayers),q=e.entity().add(a.PostProcessEnabled,M),U=e.listen(a.ScreenFade),j=(e.view(a.ScreenFade),e.findTag(a.AppState)),z=e.view(a.ActiveEnvironmentState),H=e.findTag(a.GroundMeshEditableData);let V=!1;const Y={forest:"forest",tundra:"tundra6",grasslands:"grasslands"};return window.printStats=function(){let t=0;e.findTag(a.MainScene).traverse(e=>{e.isMesh&&t++}),console.log("Total Meshes",t),console.log("Geometries",l.info.memory.geometries),console.log("Textures",l.info.memory.textures),console.log("Calls",l.info.render.calls),console.log("Triangles",l.info.render.triangles),console.log("Points",l.info.render.points),console.log("Programs",l.info.programs.map(e=>e.name))},function(t){if(z.length>0){const e=z[0].get(a.EnvironmentState);let t=Y[e.name];F!==t&&(F=t,f.default.loadGPUTexture(l,D,`image/data/lut-${F}`))}j.rendering&&(P.uniforms.time.value+=t,function(t=0){const n=q.get(a.PostProcessEnabled),i=e.findTag(a.MainScene),s=e.findTag(a.MainCamera),u=(l.domElement,j.canvasWidth),d=j.canvasHeight;if(!u||!d)return;const f=u/d;e.findTag(a.Atmospherics);g||((g=new r.WebGLRenderTarget(u,d)).texture.generateMipmaps=!1,g.texture.minFilter=r.LinearFilter,g.texture.magFilter=r.LinearFilter,y&&(g.texture.type=o?r.HalfFloatType:r.FloatType),P.uniforms.map.value=g.texture,P.uniforms.resolution.value.set(u,d));u===g.width&&d===g.height||(g.setSize(u,d),P.uniforms.resolution.value.set(u,d));const w=Math.min(b,u),S=Math.round(w/f);p&&p.width===w&&p.height===S||(p?p.setSize(w,S):((p=new r.WebGLRenderTarget(w,S)).depthBuffer=!1,p.texture.generateMipmaps=!1,p.texture.minFilter=r.LinearFilter,p.texture.magFilter=r.LinearFilter));const M=Math.min(u,_),F=Math.round(M/f);v&&v.width===M&&v.height===F||(v?(v.setSize(M,F),T.setSize(M,F)):((v=new r.WebGLRenderTarget(M,F)).depthBuffer=!1,v.texture.generateMipmaps=!1,v.texture.minFilter=r.LinearFilter,v.texture.magFilter=r.LinearFilter,T=v.clone()),G.uniforms.resolution.value.set(M,F));U.changed&&U.added.forEach(e=>{const t=e.get(a.ScreenFade);(0,m.setEntityTweenFromTo)(e,P.uniforms.fadeToBlack,"value",t.from,t.to,t.duration,t.ease,t.delay);const r=e.get(a.TargetKeyTween);r.assignFromOnStart=!0,r.callbackOnStart=t.callbackOnStart,r.callbackOnFinish=t.callbackOnFinish});const L=l.autoClear;l.autoClear=!1,l.info.autoReset=!1,i.autoUpdate=!1,i.matrixAutoUpdate=!1,i.updateMatrix(),i.updateMatrixWorld(),l.info.reset(),c.initialize(l,15),V||(V=!0,console.log("Compiling scene"),l.compile(i,s));(0,h.preRender)(),n?l.setRenderTarget(g):l.setRenderTarget(null);l.clear(),s.layers.disableAll(),x&&(s.layers.enable(E.grass),s.layers.enable(E.ground));s.layers.enable(E.groundDepth),s.layers.enable(E.water),s.layers.enable(E.shadow),function(e,t){for(let e=0;e<W.length;e++){const t=W[e],n=t.get(a.Object3D);n.visible&&n.isMesh&&n.userData.__shadowMaterial&&n.userData.__shadowEnabled&&(n.userData.__material=n.material,n.userData.__materialDepthTest=n.material.depthTest,n.userData.__materialDepthWrite=n.material.depthWrite,n.userData.__materialBlending=n.material.blending,n.userData.__materialTransparent=n.material.transparent,n.material=n.userData.__shadowMaterial,n.material.depthTest=!0,n.material.depthWrite=!1,n.material.transparent=!0,n.material.blending=r.MultiplyBlending,n.material.uniforms&&n.material.uniforms.silhouette&&(n.material.uniforms.silhouette.value=!0))}l.render(e,t);for(let e=0;e<W.length;e++){const t=W[e],r=t.get(a.Object3D);r.visible&&r.isMesh&&r.userData.__material&&(r.material=r.userData.__material,r.material.depthWrite=r.userData.__materialDepthTest,r.material.depthTest=r.userData.__materialDepthWrite,r.material.transparent=r.userData.__materialTransparent,r.material.blending=r.userData.__materialBlending,r.material.uniforms&&r.material.uniforms.silhouette&&(r.material.uniforms.silhouette.value=!1))}}(i,s),s.layers.enableAll(),s.layers.disable(E.water),s.layers.disable(E.shadow),s.layers.disable(E.ground),s.layers.disable(E.groundDepth),s.layers.disable(E.atmospherics),s.layers.disable(E.grass),l.render(i,s),n&&(y&&(l.setRenderTarget(p),k.material=B,B.uniforms.map.value=g.texture,B.uniforms.resolution.value.set(w,S),l.render(C,O),l.setRenderTarget(v),k.material=G,G.uniforms.map.value=p.texture,G.uniforms.resolution.value.set(w,S),G.uniforms.direction.value.set(1,0),l.render(C,O),l.setRenderTarget(T),k.material=G,G.uniforms.map.value=v.texture,G.uniforms.resolution.value.set(M,F),G.uniforms.direction.value.set(0,1),l.render(C,O)),l.setRenderTarget(null),k.material=P,y&&(P.uniforms.glowMap.value=T.texture),P.uniforms.lutMap.value=H.useCustomLUT?H.lutMap:D,l.render(C,O));l.autoClear=L,(0,h.postRender)()}(t))}}
},{"../tags":60,"three":74,"../shaders/post-process.frag":280,"../util/query-string":30,"../util/load":247,"../shaders/post-process-bloom-glow.frag":281,"./AnimationSystem":108,"../util/ShaderManager":243,"../util/Assets":31,"../util/addFrameTasks":140}],267:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../tags"),t=p(e),i=require("three"),n=p(i),r=require("../../util/math"),s=p(r),o=require("../../shaders/line-3d.vert"),u=m(o),a=require("../../shaders/line-3d.frag"),l=m(a),h=require("../SubmitFrameSystem"),d=require("../../util/ShaderManager"),f=p(d);function m(e){return e&&e.__esModule?e:{default:e}}function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}const c=new n.Vector3,b=new n.Vector3,g=[0,0,0];function y(e,t,i){return e=t?e.position:e,i?(g[0]=e.x,g[1]=e.y,g[2]=e.z,g):e}class v extends n.BufferGeometry{updatePath(e,t,i){const r=e.length,s=[],o=[],u=[],a=[],l=[],h=[];let d=0;for(let n=0;n<r;n++){let f=y(e[n],t,i);const m=1,p=f[0],g=f[1],v=f[2];s.push(p,g,v,p,g,v);const B=y(n<1?e[n]:e[n-1],t,i),x=B[0],w=B[1],A=B[2];o.push(x,w,A,x,w,A);let S=0;n>0&&(c.set(p,g,v),S=d+=c.distanceTo(b)),b.set(p,g,v);const F=y(n<e.length-1?e[n+1]:e[e.length-1],t,i),P=F[0],q=F[1],k=F[2];u.push(P,q,k,P,q,k),l.push(m,m),a.push(-1,1);const D=r<=1?.5:n/(r-1);h.push(D,S,D,S)}this.setAttribute("position",new n.Float32BufferAttribute(s,3)),this.setAttribute("nextPosition",new n.Float32BufferAttribute(u,3)),this.setAttribute("previousPosition",new n.Float32BufferAttribute(o,3)),this.setAttribute("direction",new n.Float32BufferAttribute(a,1)),this.setAttribute("vertexHasToken",new n.Float32BufferAttribute(l,1)),this.setAttribute("vertexDistance",new n.Float32BufferAttribute(h,2));const f=r>=2?x(r-1):new Uint16Array(0);return this.setIndex(new n.BufferAttribute(f,1)),this.updateBounds(),d}updateBounds(){const e=this.attributes.position;this.boundingBox||(this.boundingBox=new n.Box3),this.boundingSphere||(this.boundingSphere=new n.Sphere),this.boundingBox.makeEmpty();for(let t=0;t<e.count;t+=2){const i=e.getX(t),n=e.getY(t),r=e.getZ(t);c.set(i,n,r),this.boundingBox.expandByPoint(c)}const t=Math.max(this.boundingBox.min.y,this.boundingBox.max.y);this.boundingBox.min.y=0,this.boundingBox.max.y=t,this.boundingBox.getBoundingSphere(this.boundingSphere)}}class B extends n.Group{constructor(e,i={}){super();const{blending:r=n.NormalBlending,thickness:s=.5,opacity:o=1,bloom:a=1.5,draw:h=1,geometry:d,depthWrite:m=!0,depthTest:p=!0}=i,c=new n.Color(i.color||"white");c.r+=a,c.g+=a,c.b+=a,this.thickness=s,this.geometry=d||new v,this.material=f.create({name:"Line3D",side:n.DoubleSide,transparent:!0,blending:r,depthTest:p,depthWrite:m,vertexShader:u.default,fragmentShader:l.default,extensions:{derivatives:!0},uniforms:{dottedFill:{value:i.dottedFill||0},dotted:{value:Boolean(i.dotted),type:"b"},opacity:{value:o},time:{value:0},color:{value:c},resolution:{value:new n.Vector2},thickness:{value:this.thickness},miterLimit:{value:8},totalDistance:{value:0},taper:{value:!1!==i.taper,type:"b"},draw:{value:h},drawing:{value:Boolean(i.false),type:"b"},filling:{value:Boolean(i.filling),type:"b"},miter:{value:!0,type:"b"}}});const b=e.entity();b.add(t.ShaderUniformResolution,{uniform:this.material.uniforms.resolution}),b.add(t.ShaderUniformTime,{uniform:this.material.uniforms.time}),this.mesh=new n.Mesh(this.geometry,this.material),this.mesh.frustumCulled=!0,this.mesh.renderOrder=10,this.add(this.mesh),this.userData={entity:b}}setAlpha(e){this.material.uniforms.opacity.value=e}step(e=0){}updatePath(e,t,i){const n=this.geometry.updatePath(e,t,i);this.mesh.material.uniforms.totalDistance.value=n}}function x(e){let t=new Uint16Array(6*e),i=0,n=0;for(let r=0;r<e;r++){let e=n;t[i++]=e+0,t[i++]=e+1,t[i++]=e+2,t[i++]=e+2,t[i++]=e+1,t[i++]=e+3,n+=2}return t}exports.default=B;
},{"../../tags":60,"three":74,"../../util/math":240,"../../shaders/line-3d.vert":692,"../../shaders/line-3d.frag":693,"../SubmitFrameSystem":107,"../../util/ShaderManager":243}],539:[function(require,module,exports) {
module.exports=a;var r={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},t=/([astvzqmhlc])([^astvzqmhlc]*)/gi;function a(a){var e=[];return a.replace(t,function(t,a,c){var h=a.toLowerCase();for(c=n(c),"m"==h&&c.length>2&&(e.push([a].concat(c.splice(0,2))),h="l",a="m"==a?"l":"L");;){if(c.length==r[h])return c.unshift(a),e.push(c);if(c.length<r[h])throw new Error("malformed path data");e.push([a].concat(c.splice(0,r[h])))}}),e}var e=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;function n(r){var t=r.match(e);return t?t.map(Number):[]}
},{}],825:[function(require,module,exports) {
function r(r){return[r[0],r[1]]}function a(r,a){return[r,a]}module.exports=function(n){var t="number"==typeof(n=n||{}).recursion?n.recursion:8,i="number"==typeof n.epsilon?n.epsilon:1.1920929e-7,u="number"==typeof n.pathEpsilon?n.pathEpsilon:1,e="number"==typeof n.angleEpsilon?n.angleEpsilon:.01,s=n.angleTolerance||0,o=n.cuspLimit||0;return function(n,f,h,p,v,l){l||(l=[]);var M=u/(v="number"==typeof v?v:1);return function(n,u,f,h,p,v){p.push(r(n));var l=n[0],M=n[1],d=u[0],b=u[1],c=f[0],m=f[1],y=h[0],E=h[1];(function r(n,u,f,h,p,v,l,M,d,b,c){if(c>t)return;var m=Math.PI;var y=(n+f)/2;var E=(u+h)/2;var g=(f+p)/2;var x=(h+v)/2;var I=(p+l)/2;var L=(v+M)/2;var P=(y+g)/2;var T=(E+x)/2;var j=(g+I)/2;var k=(x+L)/2;var q=(P+j)/2;var w=(T+k)/2;if(c>0){var z,A,B=l-n,C=M-u,D=Math.abs((f-l)*C-(h-M)*B),F=Math.abs((p-l)*C-(v-M)*B);if(D>i&&F>i){if((D+F)*(D+F)<=b*(B*B+C*C)){if(s<e)return void d.push(a(q,w));var G=Math.atan2(v-h,p-f);if(z=Math.abs(G-Math.atan2(h-u,f-n)),A=Math.abs(Math.atan2(M-v,l-p)-G),z>=m&&(z=2*m-z),A>=m&&(A=2*m-A),z+A<s)return void d.push(a(q,w));if(0!==o){if(z>o)return void d.push(a(f,h));if(A>o)return void d.push(a(p,v))}}}else if(D>i){if(D*D<=b*(B*B+C*C)){if(s<e)return void d.push(a(q,w));if((z=Math.abs(Math.atan2(v-h,p-f)-Math.atan2(h-u,f-n)))>=m&&(z=2*m-z),z<s)return d.push(a(f,h)),void d.push(a(p,v));if(0!==o&&z>o)return void d.push(a(f,h))}}else if(F>i){if(F*F<=b*(B*B+C*C)){if(s<e)return void d.push(a(q,w));if((z=Math.abs(Math.atan2(M-v,l-p)-Math.atan2(v-h,p-f)))>=m&&(z=2*m-z),z<s)return d.push(a(f,h)),void d.push(a(p,v));if(0!==o&&z>o)return void d.push(a(p,v))}}else if((B=q-(n+l)/2)*B+(C=w-(u+M)/2)*C<=b)return void d.push(a(q,w))}r(n,u,y,E,P,T,q,w,d,b,c+1);r(q,w,j,k,I,L,l,M,d,b,c+1)})(l,M,d,b,c,m,y,E,p,v,0),p.push(r(h))}(n,f,h,p,l,M*=M),l}};
},{}],761:[function(require,module,exports) {
module.exports=require("./function")();
},{"./function":825}],541:[function(require,module,exports) {
function e(e){var a=0,r=0,t=0,c=0;return e.map(function(e){var s=(e=e.slice())[0],n=s.toUpperCase();if(s!=n)switch(e[0]=n,s){case"a":e[6]+=t,e[7]+=c;break;case"v":e[1]+=c;break;case"h":e[1]+=t;break;default:for(var b=1;b<e.length;)e[b++]+=t,e[b++]+=c}switch(n){case"Z":t=a,c=r;break;case"H":t=e[1];break;case"V":c=e[1];break;case"M":t=a=e[1],c=r=e[2];break;default:t=e[e.length-2],c=e[e.length-1]}return e})}module.exports=e;
},{}],762:[function(require,module,exports) {
var a=Math.PI,t=c(120);function n(a){for(var t,n=[],h=0,i=0,u=0,M=0,o=null,l=null,f=0,v=0,b=0,g=a.length;b<g;b++){var k=a[b],x=k[0];switch(x){case"M":u=k[1],M=k[2];break;case"A":(k=s(f,v,k[1],k[2],c(k[3]),k[4],k[5],k[6],k[7])).unshift("C"),k.length>7&&(n.push(k.splice(0,7)),k.unshift("C"));break;case"S":var C=f,p=v;"C"!=t&&"S"!=t||(C+=C-h,p+=p-i),k=["C",C,p,k[1],k[2],k[3],k[4]];break;case"T":"Q"==t||"T"==t?(o=2*f-o,l=2*v-l):(o=f,l=v),k=e(f,v,o,l,k[1],k[2]);break;case"Q":o=k[1],l=k[2],k=e(f,v,k[1],k[2],k[3],k[4]);break;case"L":k=r(f,v,k[1],k[2]);break;case"H":k=r(f,v,k[1],v);break;case"V":k=r(f,v,f,k[1]);break;case"Z":k=r(f,v,u,M)}t=x,f=k[k.length-2],v=k[k.length-1],k.length>4?(h=k[k.length-4],i=k[k.length-3]):(h=f,i=v),n.push(k)}return n}function r(a,t,n,r){return["C",a,t,n,r,n,r]}function e(a,t,n,r,e,s){return["C",a/3+2/3*n,t/3+2/3*r,e/3+2/3*n,s/3+2/3*r,e,s]}function s(n,r,e,c,i,u,M,o,l,f){if(f)q=f[0],F=f[1],y=f[2],d=f[3];else{var v=h(n,r,-i);n=v.x,r=v.y;var b=(n-(o=(v=h(o,l,-i)).x))/2,g=(r-(l=v.y))/2,k=b*b/(e*e)+g*g/(c*c);k>1&&(e*=k=Math.sqrt(k),c*=k);var x=e*e,C=c*c,p=(u==M?-1:1)*Math.sqrt(Math.abs((x*C-x*g*g-C*b*b)/(x*g*g+C*b*b)));p==1/0&&(p=1);var y=p*e*g/c+(n+o)/2,d=p*-c*b/e+(r+l)/2,q=Math.asin(((r-d)/c).toFixed(9)),F=Math.asin(((l-d)/c).toFixed(9));(q=n<y?a-q:q)<0&&(q=2*a+q),(F=o<y?a-F:F)<0&&(F=2*a+F),M&&q>F&&(q-=2*a),!M&&F>q&&(F-=2*a)}if(Math.abs(F-q)>t){var Q=F,S=o,T=l;F=q+t*(M&&F>q?1:-1);var m=s(o=y+e*Math.cos(F),l=d+c*Math.sin(F),e,c,i,0,M,S,T,[F,Q,y,d])}var w=Math.tan((F-q)/4),A=4/3*e*w,H=4/3*c*w,I=[2*n-(n+A*Math.sin(q)),2*r-(r-H*Math.cos(q)),o+A*Math.sin(F),l-H*Math.cos(F),o,l];if(f)return I;m&&(I=I.concat(m));for(var L=0;L<I.length;){var P=h(I[L],I[L+1],i);I[L++]=P.x,I[L++]=P.y}return I}function h(a,t,n){return{x:a*Math.cos(n)-t*Math.sin(n),y:a*Math.sin(n)+t*Math.cos(n)}}function c(t){return t*(a/180)}module.exports=n;
},{}],763:[function(require,module,exports) {
module.exports=function(e,n){return e[0]=n[0],e[1]=n[1],e};
},{}],538:[function(require,module,exports) {
var e=require("adaptive-bezier-curve"),r=require("abs-svg-path"),i=require("normalize-svg-path"),n=require("vec2-copy");function t(e,r,i){return e[0]=r,e[1]=i,e}var u=[0,0],a=[0,0],o=[0,0];function c(r,i,n,c){e(n,t(u,c[1],c[2]),t(a,c[3],c[4]),t(o,c[5],c[6]),i,r)}module.exports=function(e,u){var a=[],o=[],l=[0,0];return i(r(e)).forEach(function(e,r,i){if("M"===e[0])n(l,e.slice(1)),o.length>0&&(a.push(o),o=[]);else{if("C"!==e[0])throw new Error("illegal type in SVG: "+e[0]);c(o,u,l,e),t(l,e[5],e[6])}}),o.length>0&&a.push(o),a};
},{"adaptive-bezier-curve":761,"abs-svg-path":541,"normalize-svg-path":762,"vec2-copy":763}],552:[function(require,module,exports) {
function r(r,n){var e=r[0]-n[0],t=r[1]-n[1];return e*e+t*t}module.exports=function(n,e){if(n.length<=1)return n;for(var t,u=(e="number"==typeof e?e:1)*e,o=n[0],f=[o],h=1,p=n.length;h<p;h++)r(t=n[h],o)>u&&(f.push(t),o=t);return o!==t&&f.push(t),f};
},{}],555:[function(require,module,exports) {
function r(r,n,t){var u=n[0],e=n[1],f=t[0]-u,o=t[1]-e;if(0!==f||0!==o){var a=((r[0]-u)*f+(r[1]-e)*o)/(f*f+o*o);a>1?(u=t[0],e=t[1]):a>0&&(u+=f*a,e+=o*a)}return(f=r[0]-u)*f+(o=r[1]-e)*o}function n(t,u,e,f,o){for(var a,i=f,v=u+1;v<e;v++){var h=r(t[v],t[u],t[e]);h>i&&(a=v,i=h)}i>f&&(a-u>1&&n(t,u,a,f,o),o.push(t[a]),e-a>1&&n(t,a,e,f,o))}module.exports=function(r,t){if(r.length<=1)return r;var u=(t="number"==typeof t?t:1)*t,e=r.length-1,f=[r[0]];return n(r,0,e,u,f),f.push(r[e]),f};
},{}],297:[function(require,module,exports) {
var e=require("./radial-distance"),r=require("./douglas-peucker");module.exports=function(u,a){return u=e(u,a),u=r(u,a)},module.exports.radialDistance=e,module.exports.douglasPeucker=r;
},{"./radial-distance":552,"./douglas-peucker":555}],300:[function(require,module,exports) {
"use strict";function r(r){var t=r.length;if(0===t)return[[],[]];for(var e=r[0].length,a=r[0].slice(),n=r[0].slice(),i=1;i<t;++i)for(var l=r[i],o=0;o<e;++o){var s=l[o];a[o]=Math.min(a[o],s),n[o]=Math.max(n[o],s)}return[a,n]}module.exports=r;
},{}],758:[function(require,module,exports) {
module.exports=function(e,n,o){return(o-e)/(n-e)};
},{}],540:[function(require,module,exports) {
var r=require("bound-points"),e=require("unlerp");function i(i,n){if(!Array.isArray(i))throw new TypeError("must specify positions as first argument");Array.isArray(n)||(n=r(i));var t=n[0],a=n[1],o=a[0]-t[0],s=a[1]-t[1],u=o>s?1:s/o,f=o>s?o/s:1;if(a[0]-t[0]==0||a[1]-t[1]==0)return i;for(var p=0;p<i.length;p++){var y=i[p];y[0]=(2*e(t[0],a[0],y[0])-1)/u,y[1]=(2*e(t[1],a[1],y[1])-1)/f}return i}module.exports=i;
},{"bound-points":300,"unlerp":758}],241:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=p;var e=require("parse-svg-path"),t=n(e),r=require("svg-path-contours"),u=n(r),a=require("abs-svg-path"),s=n(a),l=require("simplify-path"),i=n(l),o=require("normalize-path-scale"),f=n(o);function n(e){return e&&e.__esModule?e:{default:e}}function p(e){const r=(0,u.default)((0,t.default)(e),1);let a=(0,f.default)(r[0]);return a=(0,i.default)(a,.01)}
},{"parse-svg-path":539,"svg-path-contours":538,"abs-svg-path":541,"simplify-path":297,"normalize-path-scale":540}],92:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=D;var e=require("../tags"),t=h(e),n=require("three"),a=h(n),i=require("../util/math"),r=h(i),u=require("../util/ObjectPool"),o=g(u),l=require("../util/Random"),s=g(l),c=require("./writing/Line3D"),m=g(c),d=require("../util/getPathFromSVG"),f=g(d);function g(e){return e&&e.__esModule?e:{default:e}}function h(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function D(e){const n=e.view(t.ActiveEnvironmentState),i=(0,s.default)(),r=C().map(e=>{const t=(0,f.default)(e).map(e=>new a.Vector3(e[0],0,e[1]));return new a.CatmullRomCurve3(t,!1,"catmullrom",.5).getSpacedPoints(100).map(e=>e.toArray())}).map(t=>{const n=new m.default(e,{thickness:.2,bloom:0,taper:!1});return n.updatePath(t),n.userData._entity=null,n.userData._lineThickness=1,n});let u=0;const o=()=>i.range(1,2);let l=o();const c=[0,0],d=e.view(t.WindLine);return function(s){const m=n.length?n[0].get(t.EnvironmentState).name:null;if(m&&"grasslands"===m){if((u+=s)>=l){u%=l,l=o(),function(n){const u=function(){const e=i.rangeFloor(0,r.length);for(let t=0;t<r.length;t++){const n=(t+e)%r.length;if(!r[n].userData._entity)return r[n]}return null}();if(!u)return;i.onCircle(i.range(5,10),c);const o=n.x+c[0],l=n.z+c[1];u.userData._entity=e.entity().add(t.Object3D,u),u.position.set(o,i.range(2,4),l),u.scale.setScalar(i.range(1,6)),u.rotation.y=a.MathUtils.degToRad(45),u.material.uniforms.drawing.value=!0,u.material.uniforms.opacity.value=.5,u.userData._lineThickness=i.range(.2,.2),u.userData._entity.add(t.WindLine),u.userData._entity.get(t.WindLine).duration=i.range(3,3)}(e.findTag(t.UserTarget).position)}d.forEach(e=>{const n=e.get(t.WindLine);n.time+=s;let a=0;if(n.time<=n.animateDuration)a=n.time/n.animateDuration;else if(n.time>=n.duration-n.animateDuration){a=1-Math.max(0,n.time-(n.duration-n.animateDuration))/n.animateDuration}else a=1;const i=e.get(t.Object3D);i.material.uniforms.thickness.value=i.userData._lineThickness*a,i.material.uniforms.time.value+=s,i.material.uniforms.draw.value=n.time/n.duration;const r=n.duration;n.time>=r&&(e.kill(),i.userData._entity=null)})}else d.length>0&&d.forEach(e=>{e.get(t.Object3D).userData._entity=null,e.kill()})}}function C(){return["M1 73C48 80 154.8 89.8 206 73C270 52 259 19 238 7C217 -5 173 -1.90735e-06 176 26C179 52 191 76 277 80C363 84 421 67 444 65C467 63 530 73 561 73","M1 13C50 16.3333 101 23 178 18C255 13 268 -0.999999 338 1C408 3 444 18 508 18","M1 18C40.3333 12 129 0.199994 169 0.999994C219 1.99999 346 18 399 18C452 18 512 0.999994 526 0.999994","M1 5.99999C69.3333 2.33332 217.8 -2.80001 265 5.99999C324 17 421 -2.00003 462 5.99999"]}
},{"../tags":60,"three":74,"../util/math":240,"../util/ObjectPool":236,"../util/Random":235,"./writing/Line3D":267,"../util/getPathFromSVG":241}],242:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("three"),e=r(t);function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function a(t,r,a,o,s,h,i,n,u){e.BufferGeometry.call(this),this.type="CapsuleBufferGeometry",this.parameters={radiusTop:t,radiusBottom:r,height:a,radialSegments:o,heightSegments:s,thetaStart:n,thetaLength:u};t=void 0!==t?t:1,r=void 0!==r?r:1,a=void 0!==a?a:2,o=Math.floor(o)||8,s=Math.floor(s)||1,h=Math.floor(h)||2,i=Math.floor(i)||2,n=void 0!==n?n:0,u=void 0!==u?u:2*Math.PI;var f=Math.acos((r-t)/a),y=(o+1)*(s+1+i+h),M=o*(s+i+h)*2*3,c=new e.BufferAttribute(new(M>65535?Uint32Array:Uint16Array)(M),1),l=new e.BufferAttribute(new Float32Array(3*y),3),p=new e.BufferAttribute(new Float32Array(3*y),3),v=new e.BufferAttribute(new Float32Array(2*y),2),X=0,d=0,w=[],x=a/2;!function(){var y,M,A=new e.Vector3,b=new e.Vector3,z=Math.cos(f),m=Math.sin(f),Y=new e.Vector2(t*m,x+t*z).sub(new e.Vector2(r*m,r*z-x)).length(),B=t*f+Y+r*(Math.PI/2-f),P=0;for(M=0;M<=h;M++){var g=[],I=Math.PI/2-f*(M/h);P+=t*f/h;var Z=Math.cos(I),O=Math.sin(I),V=Z*t;for(y=0;y<=o;y++){var _=y/o,j=_*u+n,F=Math.sin(j),G=Math.cos(j);b.x=V*F,b.y=x+O*t,b.z=V*G,l.setXYZ(X,b.x,b.y,b.z),A.set(Z*F,O,Z*G),p.setXYZ(X,A.x,A.y,A.z),v.setXY(X,_,1-P/B),g.push(X),X++}w.push(g)}var S=a+z*t-z*r,U=m*(r-t)/S;for(M=1;M<=s;M++){var g=[];P+=Y/s;var V=m*(M*(r-t)/s+t);for(y=0;y<=o;y++){var _=y/o,j=_*u+n,F=Math.sin(j),G=Math.cos(j);b.x=V*F,b.y=x+z*t-M*S/s,b.z=V*G,l.setXYZ(X,b.x,b.y,b.z),A.set(F,U,G).normalize(),p.setXYZ(X,A.x,A.y,A.z),v.setXY(X,_,1-P/B),g.push(X),X++}w.push(g)}for(M=1;M<=i;M++){var g=[],I=Math.PI/2-f-(Math.PI-f)*(M/i);P+=r*f/i;var Z=Math.cos(I),O=Math.sin(I),V=Z*r;for(y=0;y<=o;y++){var _=y/o,j=_*u+n,F=Math.sin(j),G=Math.cos(j);b.x=V*F,b.y=O*r-x,b.z=V*G,l.setXYZ(X,b.x,b.y,b.z),A.set(Z*F,O,Z*G),p.setXYZ(X,A.x,A.y,A.z),v.setXY(X,_,1-P/B),g.push(X),X++}w.push(g)}for(y=0;y<o;y++)for(M=0;M<h+s+i;M++){var q=w[M][y],C=w[M+1][y],L=w[M+1][y+1],T=w[M][y+1];c.setX(d,q),d++,c.setX(d,C),d++,c.setX(d,T),d++,c.setX(d,C),d++,c.setX(d,L),d++,c.setX(d,T),d++}}(),this.setIndex(c),this.setAttribute("position",l),this.setAttribute("normal",p),this.setAttribute("uv",v)}a.prototype=Object.create(e.BufferGeometry.prototype),a.prototype.constructor=a,exports.default=a;
},{"three":74}],93:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=v;var e=require("../tags"),t=b(e),a=require("three"),n=b(a),r=require("../util/math"),i=b(r),o=require("eases"),l=b(o),s=require("../util/ObjectPool"),u=h(s),c=require("../util/Random"),p=h(c),d=require("./writing/Line3D"),m=h(d),y=require("../util/getPathFromSVG"),g=h(y),f=require("../util/CapsuleBufferGeometry"),D=h(f),w=require("../util/three-util");function h(e){return e&&e.__esModule?e:{default:e}}function b(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function v(e){const a=(0,p.default)(),r=new n.Group;r.name="rainparticles";const o=new n.Group,s=new n.Group;r.add(o),r.add(s),e.entity().add(t.Object3D,r);const c=.25,d=new n.BufferGeometry,m=[c,2*c].map(e=>{const t=new D.default(.02,.02,e,5,1,2,2);return t.userData.length=e,t.translate(0,-e/2,0),t}),y=(new n.Color(1,1,1),i.linspace(10).map(e=>{return new n.Color("#7dcdf2").offsetHSL(a.range(-1,1)*(5/360),.1*a.range(-1,1),.1*a.range(-1,1))})),g=new u.default({maxCapacity:50,initialCapacity:50,create(){const e=new n.Mesh(d,new n.MeshBasicMaterial({name:"rain"}));return e.matrixAutoUpdate=!1,e.userData._entity=null,e.frustumCulled=!1,e.visible=!1,e},release(e){}}),f=new n.RingGeometry(.12,.21,12,1);f.rotateX(-Math.PI/2);const h=new u.default({maxCapacity:50,initialCapacity:50,create(){const e=new n.Mesh(f,new n.MeshBasicMaterial({name:"splatter",transparent:!0,opacity:.5}));return e.renderOrder=5,e.matrixAutoUpdate=!1,e.userData._entity=null,e.frustumCulled=!1,e.visible=!1,e}}),b=new n.Vector3(.5,-1,0).normalize(),v=[0,0],x=new n.Vector3,M=new n.Plane(new n.Vector3(-0,-1,-0),-0),O=new n.Ray,R=new n.Vector3;O.direction.copy(b);const _=e.view([t.RainDrop,t.Object3D]),S=e.view([t.RainDropSplatter,t.Object3D]),j=()=>a.range(.075,.2);let q=0,C=j();const P=e.findTag(t.UserTarget),G=e.view(t.ActiveEnvironmentState),k=e.findTag(t.EnvironmentUnderPlayerState),V=e.entity();let B=null,U=0;const z=()=>a.range(5,10);let A=z(),E=!1;return function(e){const n=G.length?G[0].get(t.EnvironmentState).name:null;let r=n&&"grasslands"===n;if(r&&k.water&&k.lake&&(V.has(t.Raining)||(null==B?B=k.lake:k.lake!==B&&(V.tagOn(t.Raining),A=z(),E=!0,U=0,B=null))),!k.water&&E&&(E=!1,B=null),r&&V.has(t.Raining)&&(U+=e)>=A&&V.tagOff(t.Raining),r&&V.has(t.Raining)&&(q+=e)>=C){q%=C,C=j();const e=a.rangeFloor(1,6);for(let t=0;t<e&&T(P.position);t++);}for(let a=0;a<_.length;a++){const n=_[a],r=n.get(t.RainDrop),i=n.get(t.Object3D);i.position.addScaledVector(b,e*r.speed),i.visible=!0,r.time+=e;let o=0;o=r.time<=r.animateDuration?r.time/r.animateDuration:1,i.scale.setScalar(1*o),i.updateMatrix(),x.set(0,0,0),x.applyMatrix4(i.matrixWorld),x.y<=0&&!r.splat&&(r.splat=!0,F(r.splatterSpawnPosition,i.material.color)),x.y<=-1*i.geometry.userData.length&&(g.release(i),i.userData._entity=null,i.visible=!1,(0,w.detachObject)(i),n.remove(t.RainDrop))}for(let a=0;a<S.length;a++){const n=S[a],r=n.get(t.RainDropSplatter),i=n.get(t.Object3D);i.visible=!0,r.time+=e;let o=0;if(r.time<=r.animateDuration)o=r.time/r.animateDuration;else if(r.time>=r.duration-r.animateDuration){o=1-Math.max(0,r.time-(r.duration-r.animateDuration))/r.animateDuration}else o=1;o=l.sineInOut(o),i.scale.setScalar(1*o),r.time>=r.duration?(h.release(i),i.userData._entity=null,i.visible=!1,(0,w.detachObject)(i),n.kill()):i.updateMatrix()}};function F(a,n){const r=h.next();if(!r)return!1;s.add(r),r.material.color.copy(n),r.position.copy(a),r.position.y=.1,r.visible=!1,r.userData._entity=e.entity().add(t.Object3D,r),r.userData._entity.add(t.RainDropSplatter);r.userData._entity.get(t.RainDropSplatter)}function T(n){const r=g.next();if(!r)return!1;a.onCircle(a.range(0,20),v);const l=n.x+v[0]-10*b.x,s=n.z+v[1]-0*b.z;o.add(r),r.geometry=a.pick(m),r.position.set(l,a.range(7.5,15),s),r.material.color.copy(a.pick(y)),r.visible=!1,r.userData._entity=e.entity().add(t.Object3D,r),r.userData._entity.add(t.RainDrop),i.quaternionFromNormal(b,r.quaternion);const u=r.userData._entity.get(t.RainDrop);return u.speed=a.range(10,10),r.updateMatrix(),r.updateMatrixWorld(),x.set(0,c,0),x.applyMatrix4(r.matrixWorld),O.origin.copy(x),O.intersectPlane(M,R)?u.splatterSpawnPosition.copy(R):u.splat=!0,!0}}
},{"../tags":60,"three":74,"../util/math":240,"eases":291,"../util/ObjectPool":236,"../util/Random":235,"./writing/Line3D":267,"../util/getPathFromSVG":241,"../util/CapsuleBufferGeometry":242,"../util/three-util":80}],288:[function(require,module,exports) {
var e=require("three"),r=new e.Vector3;function t(t,n){if(n=n||new e.Quaternion,t.y>.99999)n.set(0,0,0,1);else if(t.y<-.99999)n.set(1,0,0,0);else{r.set(t.z,0,-t.x).normalize();var s=Math.acos(t.y);n.setFromAxisAngle(r,s)}return n}module.exports=t;
},{"three":74}],830:[function(require,module,exports) {
"function"==typeof Object.create?module.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:module.exports=function(t,e){if(e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t}};
},{}],859:[function(require,module,exports) {
function e(e,n,o){return e*(1-o)+n*o}module.exports=e;
},{}],855:[function(require,module,exports) {
var r=require("lerp");module.exports=function(e,n,t,u){if("number"==typeof e&&"number"==typeof n)return r(e,n,t);var o=Math.min(e.length,n.length);u=u||new Array(o);for(var a=0;a<o;a++)u[a]=r(e[a],n[a],t);return u};
},{"lerp":859}],824:[function(require,module,exports) {
function e(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function t(e){return"function"==typeof e}function s(e){return"number"==typeof e}function n(e){return"object"==typeof e&&null!==e}function i(e){return void 0===e}module.exports=e,e.EventEmitter=e,e.prototype._events=void 0,e.prototype._maxListeners=void 0,e.defaultMaxListeners=10,e.prototype.setMaxListeners=function(e){if(!s(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},e.prototype.emit=function(e){var s,r,o,h,v,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((s=arguments[1])instanceof Error)throw s;var u=new Error('Uncaught, unspecified "error" event. ('+s+")");throw u.context=s,u}if(i(r=this._events[e]))return!1;if(t(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:h=Array.prototype.slice.call(arguments,1),r.apply(this,h)}else if(n(r))for(h=Array.prototype.slice.call(arguments,1),o=(l=r.slice()).length,v=0;v<o;v++)l[v].apply(this,h);return!0},e.prototype.addListener=function(s,r){var o;if(!t(r))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",s,t(r.listener)?r.listener:r),this._events[s]?n(this._events[s])?this._events[s].push(r):this._events[s]=[this._events[s],r]:this._events[s]=r,n(this._events[s])&&!this._events[s].warned&&(o=i(this._maxListeners)?e.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[s].length>o&&(this._events[s].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[s].length),"function"==typeof console.trace&&console.trace()),this},e.prototype.on=e.prototype.addListener,e.prototype.once=function(e,s){if(!t(s))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,s.apply(this,arguments))}return i.listener=s,this.on(e,i),this},e.prototype.removeListener=function(e,s){var i,r,o,h;if(!t(s))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(i=this._events[e]).length,r=-1,i===s||t(i.listener)&&i.listener===s)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,s);else if(n(i)){for(h=o;h-- >0;)if(i[h]===s||i[h].listener&&i[h].listener===s){r=h;break}if(r<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,s)}return this},e.prototype.removeAllListeners=function(e){var s,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(s in this._events)"removeListener"!==s&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events={},this}if(t(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},e.prototype.listeners=function(e){return this._events&&this._events[e]?t(this._events[e])?[this._events[e]]:this._events[e].slice():[]},e.prototype.listenerCount=function(e){if(this._events){var s=this._events[e];if(t(s))return 1;if(s)return s.length}return 0},e.listenerCount=function(e,t){return e.listenerCount(t)};
},{}],766:[function(require,module,exports) {
var t=function(){},i=require("eases/linear"),e=require("events").EventEmitter,s=require("inherits");function h(t){e.call(this),this.duration=t&&t.duration||0,this.delay=t&&t.delay||0,this.time=0,this.ease=t&&t.ease,this.active=!0,this.enabled=!0,this.cancelling=!1,this._started=!1}function a(t,e){return"function"==typeof t.ease?t.ease(e):i(e)}s(h,e),h.prototype.lerp=t,h.prototype.ready=t,h.prototype.cancel=function(){return this.cancelling=!0,this},h.prototype.tick=function(t,i){if(i="function"==typeof i?i:a,this.cancelling&&this.active&&(this.active=!1,this.emit("cancelling",this),this.emit("complete",this)),this.active&&this.enabled){this.time;this.time+=t;var e=(this.time-this.delay)/this.duration;this.time-this.delay>0&&(this._started||(this._started=!0,this.ready(),this.emit("start",this)),e<0?e=0:e>1&&(e=1),e=i(this,e),this.lerp(e),this.emit("update",this)),this.time>=this.duration+this.delay&&(this.active=!1,this.emit("complete",this))}},module.exports=h;
},{"eases/linear":727,"events":824,"inherits":830}],816:[function(require,module,exports) {
var r=Object.prototype.toString;function t(t){return t.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===r.call(t.buffer)||Array.isArray(t)}module.exports=t;
},{}],860:[function(require,module,exports) {
var e=Object.prototype.propertyIsEnumerable;function t(t){var r=Object.getOwnPropertyNames(t);return Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t))),r.filter(function(r){return e.call(t,r)})}module.exports=t;
},{}],854:[function(require,module,exports) {
var e=require("tween-base"),r=require("an-array"),n=require("own-enumerable-keys"),a=n(new e);module.exports=function(e,i){var u=[],t=n(i);for(var s in i)if(t.indexOf(s)>=0&&s in e&&-1===a.indexOf(s)){var f=e[s],o=i[s];"number"==typeof f&&"number"==typeof o?u.push({key:s,start:f,end:o}):r(f)&&r(o)&&u.push({key:s,start:f.slice(),end:o.slice()})}return u};
},{"tween-base":766,"an-array":816,"own-enumerable-keys":860}],836:[function(require,module,exports) {
var t=require("inherits"),e=require("lerp-array"),i=require("tween-base"),r=require("./end-target");function n(t,e){i.call(this,e),this.target=t,this.endings=void 0,this._options=e}t(n,i),n.prototype.ready=function(){this.endings=r(this.target,this._options)},n.prototype.lerp=function(t){for(var i=0;i<this.endings.length;i++){var r=this.endings[i],n=r.key;this.target[n]=e(r.start,r.end,t,this.target[n])}},module.exports=n;
},{"inherits":830,"lerp-array":855,"tween-base":766,"./end-target":854}],837:[function(require,module,exports) {
var t=require("inherits"),e=require("lerp-array"),r=require("tween-base"),i=require("./end-target");function n(t,e){r.call(this,e),this.target=t,this.end=[],this._options=e}t(n,r),n.prototype.ready=function(){this.end=this.target.map(function(t){return i(t,this._options)},this)},n.prototype.lerp=function(t){for(var r=0;r<this.end.length;r++)for(var i=this.end[r],n=this.target[r],s=0;s<i.length;s++){var o=i[s],a=o.key;n[a]=e(o.start,o.end,t,n[a])}},module.exports=n;
},{"inherits":830,"lerp-array":855,"tween-base":766,"./end-target":854}],765:[function(require,module,exports) {
var r=require("./lib/object"),e=require("./lib/group");module.exports=function(i,u){return Array.isArray(i)?new e(i,u):new r(i,u)};
},{"./lib/object":836,"./lib/group":837}],542:[function(require,module,exports) {
var t=require("eases/linear"),e=require("tween-objects"),s=require("tween-base");function n(e){if(!(this instanceof n))return new n(e);e=e||{},this.stack=[],this.defaultEase=e.defaultEase||t,this.eases=e.eases||{},this._applyEase=this.ease.bind(this)}function i(t){return"function"==typeof t.tick&&"function"==typeof t.cancel}function o(t){for(var e=0;e<t.length;e++){var s=t[e];"function"==typeof s.sync&&s.sync()}}n.prototype.cancel=function(){for(var t=0;t<this.stack.length;t++){var e=this.stack[t];e.cancel(),e.tick(0)}return this.stack.length=0,this},n.prototype.clear=n.prototype.cancel,n.prototype.to=function(t,n){var o=t;if(n&&"object"==typeof n)o=e(t,n);else if(t||n){if(!i(o))throw new Error("must provide options or a tween object")}else o=new s;return this.push(o)},n.prototype.push=function(t){return this.stack.push(t),t},n.prototype.tick=function(t,e){e="function"==typeof e?e:this._applyEase,t="number"==typeof t?t:1/60;for(var s=0;s<this.stack.length;s++)this.stack[s].tick(t,e);for(o(this.stack),s=this.stack.length-1;s>=0;s--)this.stack[s].active||this.stack.splice(s,1)},n.prototype.ease=function(e,s){var n=e.ease||this.defaultEase;return"string"==typeof n&&(n=this.eases[n]),"function"!=typeof n&&(n=t),n(s)},module.exports=n;
},{"eases/linear":727,"tween-objects":765,"tween-base":766}],244:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e};exports.default=s;var r=require("eases"),t=a(r),n=require("tween-ticker"),u=a(n);function a(e){return e&&e.__esModule?e:{default:e}}const o={eases:t.default};function s(r={}){return(0,u.default)(e({},o,r))}
},{"eases":291,"tween-ticker":542}],777:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FetchFileLoader=void 0;var e=require("three"),t=r(e);function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}const o=t.Loader,n={};function i(e){o.call(this,e)}i.prototype=Object.assign(Object.create(o.prototype),{constructor:i,load:function(e,t,r,o){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);window.fetch(e).then(e=>e.arrayBuffer()).then(e=>{t(e)},e=>{o(e)})},setResponseType:function(e){return this},setWithCredentials:function(e){return this},setMimeType:function(e){return this}}),exports.FetchFileLoader=i;
},{"three":74}],279:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GLTFLoader=void 0;var e=require("./FetchFileLoader"),t=require("three"),r=require("./addFrameTasks"),a=function(){function e(e){t.Loader.call(this,e),this.dracoLoader=null,this.ddsLoader=null,this.pluginCallbacks=[],this.register(function(e){return new l(e)})}function a(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(t.Loader.prototype),{constructor:e,load:function(e,a,s,n){var i,o=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:t.LoaderUtils.extractUrlBase(e),o.manager.itemStart(e);var l=function(t){n?n(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)};const c=o.manager.resolveURL(this.path+e);new Promise(e=>{(0,r.addFrameTask)(e)}).then(()=>window.fetch(c)).then(e=>e.arrayBuffer()).then(t=>{try{o.parse(t,i,function(t){a(t),o.manager.itemEnd(e)},l,!1)}catch(e){l(e)}},l)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,r,a,l,u){var p,f={},T={};if("string"==typeof e||u)p=e;else if(!u){if(t.LoaderUtils.decodeText(new Uint8Array(e,0,4))===c){try{f[s.KHR_BINARY_GLTF]=new h(e)}catch(e){return void(l&&l(e))}p=f[s.KHR_BINARY_GLTF].content}else p=t.LoaderUtils.decodeText(new Uint8Array(e))}var M=u?p:JSON.parse(p);if(void 0===M.asset||M.asset.version[0]<2)l&&l(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var y=new j(M,{path:r||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});y.fileLoader.setRequestHeader(this.requestHeader);for(var S=0;S<this.pluginCallbacks.length;S++){var x=this.pluginCallbacks[S](y);T[x.name]=x,f[x.name]=!0}if(M.extensionsUsed)for(S=0;S<M.extensionsUsed.length;++S){var R=M.extensionsUsed[S],L=M.extensionsRequired||[];switch(R){case s.KHR_LIGHTS_PUNCTUAL:f[R]=new i(M);break;case s.KHR_MATERIALS_UNLIT:f[R]=new o;break;case s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:f[R]=new g;break;case s.KHR_DRACO_MESH_COMPRESSION:f[R]=new d(M,this.dracoLoader);break;case s.MSFT_TEXTURE_DDS:f[R]=new n(this.ddsLoader);break;case s.KHR_TEXTURE_TRANSFORM:f[R]=new m;break;case s.KHR_MESH_QUANTIZATION:f[R]=new v;break;default:L.indexOf(R)>=0&&void 0===T[R]&&console.warn('THREE.GLTFLoader: Unknown extension "'+R+'".')}}y.setExtensions(f),y.setPlugins(T),y.parse(a,l)}}});var s={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function n(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=s.MSFT_TEXTURE_DDS,this.ddsLoader=e}function i(e){this.name=s.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[s.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function o(){this.name=s.KHR_MATERIALS_UNLIT}function l(e){this.parser=e,this.name=s.KHR_MATERIALS_CLEARCOAT}i.prototype.loadLight=function(e){var r,a=this.lightDefs[e],s=new t.Color(16777215);void 0!==a.color&&s.fromArray(a.color);var n=void 0!==a.range?a.range:0;switch(a.type){case"directional":(r=new t.DirectionalLight(s)).target.position.set(0,0,-1),r.add(r.target);break;case"point":(r=new t.PointLight(s)).distance=n;break;case"spot":(r=new t.SpotLight(s)).distance=n,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,r.angle=a.spot.outerConeAngle,r.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,r.target.position.set(0,0,-1),r.add(r.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+a.type+'".')}return r.position.set(0,0,0),r.decay=2,void 0!==a.intensity&&(r.intensity=a.intensity),r.name=a.name||"light_"+e,Promise.resolve(r)},o.prototype.getMaterialType=function(){return t.MeshBasicMaterial},o.prototype.extendParams=function(e,r,a){var s=[];e.color=new t.Color(1,1,1),e.opacity=1;var n=r.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var i=n.baseColorFactor;e.color.fromArray(i),e.opacity=i[3]}void 0!==n.baseColorTexture&&s.push(a.assignTexture(e,"map",n.baseColorTexture))}return Promise.all(s)},l.prototype.getMaterialType=function(){return t.MeshPhysicalMaterial},l.prototype.extendMaterialParams=function(e,r){var a=this.parser,s=a.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();var n=[],i=s.extensions[this.name];if(void 0!==i.clearcoatFactor&&(r.clearcoat=i.clearcoatFactor),void 0!==i.clearcoatTexture&&n.push(a.assignTexture(r,"clearcoatMap",i.clearcoatTexture)),void 0!==i.clearcoatRoughnessFactor&&(r.clearcoatRoughness=i.clearcoatRoughnessFactor),void 0!==i.clearcoatRoughnessTexture&&n.push(a.assignTexture(r,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),void 0!==i.clearcoatNormalTexture&&(n.push(a.assignTexture(r,"clearcoatNormalMap",i.clearcoatNormalTexture)),void 0!==i.clearcoatNormalTexture.scale)){var o=i.clearcoatNormalTexture.scale;r.clearcoatNormalScale=new t.Vector2(o,o)}return Promise.all(n)};var c="glTF",u=12,p={JSON:1313821514,BIN:5130562};function h(e){this.name=s.KHR_BINARY_GLTF,this.content=null,this.body=null;var r=new DataView(e,0,u);if(this.header={magic:t.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==c)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var a=new DataView(e,u),n=0;n<a.byteLength;){var i=a.getUint32(n,!0);n+=4;var o=a.getUint32(n,!0);if(n+=4,o===p.JSON){var l=new Uint8Array(e,u+n,i);this.content=t.LoaderUtils.decodeText(l)}else if(o===p.BIN){var h=u+n;this.body=e.slice(h,h+i)}n+=i}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function d(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=s.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function m(){this.name=s.KHR_TEXTURE_TRANSFORM}function f(e){t.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var r=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),a=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),s=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),n=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),i=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),o={specular:{value:(new t.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(var t in o)e.uniforms[t]=o[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),e.fragmentShader=e.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_pars_fragment>",r),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_pars_fragment>",a),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_fragment>",s),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_fragment>",n),e.fragmentShader=e.fragmentShader.replace("#include <lights_physical_fragment>",i)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function g(){return{name:s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return f},extendParams:function(e,r,a){var s=r.extensions[this.name];e.color=new t.Color(1,1,1),e.opacity=1;var n=[];if(Array.isArray(s.diffuseFactor)){var i=s.diffuseFactor;e.color.fromArray(i),e.opacity=i[3]}if(void 0!==s.diffuseTexture&&n.push(a.assignTexture(e,"map",s.diffuseTexture)),e.emissive=new t.Color(0,0,0),e.glossiness=void 0!==s.glossinessFactor?s.glossinessFactor:1,e.specular=new t.Color(1,1,1),Array.isArray(s.specularFactor)&&e.specular.fromArray(s.specularFactor),void 0!==s.specularGlossinessTexture){var o=s.specularGlossinessTexture;n.push(a.assignTexture(e,"glossinessMap",o)),n.push(a.assignTexture(e,"specularMap",o))}return Promise.all(n)},createMaterial:function(e){var r=new f(e);return r.fog=!0,r.color=e.color,r.map=void 0===e.map?null:e.map,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=void 0===e.aoMap?null:e.aoMap,r.aoMapIntensity=1,r.emissive=e.emissive,r.emissiveIntensity=1,r.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,r.bumpMap=void 0===e.bumpMap?null:e.bumpMap,r.bumpScale=1,r.normalMap=void 0===e.normalMap?null:e.normalMap,r.normalMapType=t.TangentSpaceNormalMap,e.normalScale&&(r.normalScale=e.normalScale),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=void 0===e.specularMap?null:e.specularMap,r.specular=e.specular,r.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,r.glossiness=e.glossiness,r.alphaMap=null,r.envMap=void 0===e.envMap?null:e.envMap,r.envMapIntensity=1,r.refractionRatio=.98,r}}}function v(){this.name=s.KHR_MESH_QUANTIZATION}function T(e,r,a,s){t.Interpolant.call(this,e,r,a,s)}d.prototype.decodePrimitive=function(e,t){var r=this.json,a=this.dracoLoader,s=e.extensions[this.name].bufferView,n=e.extensions[this.name].attributes,i={},o={},l={};for(var c in n){var u=I[c]||c.toLowerCase();i[u]=n[c]}for(c in e.attributes){u=I[c]||c.toLowerCase();if(void 0!==n[c]){var p=r.accessors[e.attributes[c]],h=w[p.componentType];l[u]=h,o[u]=!0===p.normalized}}return t.getDependency("bufferView",s).then(function(e){return new Promise(function(t){a.decodeDracoFile(e,function(e){for(var r in e.attributes){var a=e.attributes[r],s=o[r];void 0!==s&&(a.normalized=s)}t(e)},i,l)})})},m.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},f.prototype=Object.create(t.MeshStandardMaterial.prototype),f.prototype.constructor=f,f.prototype.copy=function(e){return t.MeshStandardMaterial.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},T.prototype=Object.create(t.Interpolant.prototype),T.prototype.constructor=T,T.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,a=this.valueSize,s=e*a*3+a,n=0;n!==a;n++)t[n]=r[s+n];return t},T.prototype.beforeStart_=T.prototype.copySampleValue_,T.prototype.afterEnd_=T.prototype.copySampleValue_,T.prototype.interpolate_=function(e,t,r,a){for(var s=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=2*i,l=3*i,c=a-t,u=(r-t)/c,p=u*u,h=p*u,d=e*l,m=d-l,f=-2*h+3*p,g=h-p,v=1-f,T=g-p+u,M=0;M!==i;M++){var y=n[m+M+i],S=n[m+M+o]*c,x=n[d+M+i],R=n[d+M]*c;s[M]=v*y+T*S+f*x+g*R}return s};var M=0,y=1,S=2,x=3,R=4,L=5,_=6,w={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},A={9728:t.NearestFilter,9729:t.LinearFilter,9984:t.NearestMipmapNearestFilter,9985:t.LinearMipmapNearestFilter,9986:t.NearestMipmapLinearFilter,9987:t.LinearMipmapLinearFilter},E={33071:t.ClampToEdgeWrapping,33648:t.MirroredRepeatWrapping,10497:t.RepeatWrapping},b={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},I={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},P={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},O={CUBICSPLINE:void 0,LINEAR:t.InterpolateLinear,STEP:t.InterpolateDiscrete},C="OPAQUE",F="MASK",U="BLEND",N={"image/png":t.RGBAFormat,"image/jpeg":t.RGBFormat};function H(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e)}function D(e,t,r){for(var a in r.extensions)void 0===e[a]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[a]=r.extensions[a])}function G(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function k(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,a=t.weights.length;r<a;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(r=0,a=s.length;r<a;r++)e.morphTargetDictionary[s[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function B(e){for(var t="",r=Object.keys(e).sort(),a=0,s=r.length;a<s;a++)t+=r[a]+":"+e[r[a]]+";";return t}function j(e,r){this.json=e||{},this.extensions={},this.plugins={},this.options=r||{},this.cache=new a,this.associations=new Map,this.primitiveCache={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new t.ImageBitmapLoader(this.options.manager):this.textureLoader=new t.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new t.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function K(e,r,a){var s=r.attributes,n=[];function i(t,r){return a.getDependency("accessor",t).then(function(t){e.setAttribute(r,t)})}for(var o in s){var l=I[o]||o.toLowerCase();l in e.attributes||n.push(i(s[o],l))}if(void 0!==r.indices&&!e.index){var c=a.getDependency("accessor",r.indices).then(function(t){e.setIndex(t)});n.push(c)}return G(e,r),function(e,r,a){var s=r.attributes,n=new t.Box3;if(void 0!==s.POSITION){var i=(d=a.json.accessors[s.POSITION]).min,o=d.max;if(void 0!==i&&void 0!==o){n.set(new t.Vector3(i[0],i[1],i[2]),new t.Vector3(o[0],o[1],o[2]));var l=r.targets;if(void 0!==l){for(var c=new t.Vector3,u=new t.Vector3,p=0,h=l.length;p<h;p++){var d,m=l[p];if(void 0!==m.POSITION)i=(d=a.json.accessors[m.POSITION]).min,o=d.max,void 0!==i&&void 0!==o?(u.setX(Math.max(Math.abs(i[0]),Math.abs(o[0]))),u.setY(Math.max(Math.abs(i[1]),Math.abs(o[1]))),u.setZ(Math.max(Math.abs(i[2]),Math.abs(o[2]))),c.max(u)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}n.expandByVector(c)}e.boundingBox=n;var f=new t.Sphere;n.getCenter(f.center),f.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=f}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,r,a),Promise.all(n).then(function(){return void 0!==r.targets?function(e,t,r){for(var a=!1,s=!1,n=0,i=t.length;n<i&&(void 0!==(c=t[n]).POSITION&&(a=!0),void 0!==c.NORMAL&&(s=!0),!a||!s);n++);if(!a&&!s)return Promise.resolve(e);var o=[],l=[];for(n=0,i=t.length;n<i;n++){var c=t[n];if(a){var u=void 0!==c.POSITION?r.getDependency("accessor",c.POSITION):e.attributes.position;o.push(u)}s&&(u=void 0!==c.NORMAL?r.getDependency("accessor",c.NORMAL):e.attributes.normal,l.push(u))}return Promise.all([Promise.all(o),Promise.all(l)]).then(function(t){var r=t[0],n=t[1];return a&&(e.morphAttributes.position=r),s&&(e.morphAttributes.normal=n),e.morphTargetsRelative=!0,e})}(e,r.targets,a):e})}function V(e,r){var a=e.getIndex();if(null===a){var s=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var i=0;i<n.count;i++)s.push(i);e.setIndex(s),a=e.getIndex()}var o=a.count-2,l=[];if(r===t.TriangleFanDrawMode)for(i=1;i<=o;i++)l.push(a.getX(0)),l.push(a.getX(i)),l.push(a.getX(i+1));else for(i=0;i<o;i++)i%2==0?(l.push(a.getX(i)),l.push(a.getX(i+1)),l.push(a.getX(i+2))):(l.push(a.getX(i+2)),l.push(a.getX(i+1)),l.push(a.getX(i)));l.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var c=e.clone();return c.setIndex(l),c}return j.prototype.setExtensions=function(e){this.extensions=e},j.prototype.setPlugins=function(e){this.plugins=e},j.prototype.parse=function(e,t){var r=this,a=this.json,s=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(t){var n={scene:t[0][a.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:a.asset,parser:r,userData:{}};D(s,n,a),G(n,a),e(n)}).catch(t)},j.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],a={},s={},n=0,i=t.length;n<i;n++)for(var o=t[n].joints,l=0,c=o.length;l<c;l++)e[o[l]].isBone=!0;for(var u=0,p=e.length;u<p;u++){var h=e[u];void 0!==h.mesh&&(void 0===a[h.mesh]&&(a[h.mesh]=s[h.mesh]=0),a[h.mesh]++,void 0!==h.skin&&(r[h.mesh].isSkinnedMesh=!0))}this.json.meshReferences=a,this.json.meshUses=s},j.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var r=0;r<t.length;r++){var a=e(t[r]);if(a)return a}},j.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var r=[],a=0;a<t.length;a++)r.push(e(t[a]));return Promise.all(r)},j.prototype.getDependency=function(e,t){var r=e+":"+t,a=this.cache.get(r);if(!a){switch(e){case"scene":a=this.loadScene(t);break;case"node":a=this.loadNode(t);break;case"mesh":a=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":a=this.loadAccessor(t);break;case"bufferView":a=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":a=this.loadBuffer(t);break;case"material":a=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":a=this.loadTexture(t);break;case"skin":a=this.loadSkin(t);break;case"animation":a=this.loadAnimation(t);break;case"camera":a=this.loadCamera(t);break;case"light":a=this.extensions[s.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,a)}return a},j.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,a=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(a.map(function(t,a){return r.getDependency(e,a)})),this.cache.add(e,t)}return t},j.prototype.loadBuffer=function(e){var t=this.json.buffers[e];if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[s.KHR_BINARY_GLTF].body);var a=this.options;return new Promise(e=>{(0,r.addFrameTask)(e)}).then(()=>window.fetch(H(t.uri,a.path))).then(e=>e.arrayBuffer())},j.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0,a=t.byteOffset||0;return e.slice(a,a+r)})},j.prototype.loadAccessor=function(e){var r=this,a=this.json,s=this.json.accessors[e];if(void 0===s.bufferView&&void 0===s.sparse)return Promise.resolve(null);var n=[];return void 0!==s.bufferView?n.push(this.getDependency("bufferView",s.bufferView)):n.push(null),void 0!==s.sparse&&(n.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(n).then(function(e){var n,i,o=e[0],l=b[s.type],c=w[s.componentType],u=c.BYTES_PER_ELEMENT,p=u*l,h=s.byteOffset||0,d=void 0!==s.bufferView?a.bufferViews[s.bufferView].byteStride:void 0,m=!0===s.normalized;if(d&&d!==p){var f=Math.floor(h/d),g="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+f+":"+s.count,v=r.cache.get(g);v||(n=new c(o,f*d,s.count*d/u),v=new t.InterleavedBuffer(n,d/u),r.cache.add(g,v)),i=new t.InterleavedBufferAttribute(v,l,h%d/u,m)}else n=null===o?new c(s.count*l):new c(o,h,s.count*l),i=new t.BufferAttribute(n,l,m);if(void 0!==s.sparse){var T=b.SCALAR,M=w[s.sparse.indices.componentType],y=s.sparse.indices.byteOffset||0,S=s.sparse.values.byteOffset||0,x=new M(e[1],y,s.sparse.count*T),R=new c(e[2],S,s.sparse.count*l);null!==o&&(i=new t.BufferAttribute(i.array.slice(),i.itemSize,i.normalized));for(var L=0,_=x.length;L<_;L++){var A=x[L];if(i.setX(A,R[L*l]),l>=2&&i.setY(A,R[L*l+1]),l>=3&&i.setZ(A,R[L*l+2]),l>=4&&i.setW(A,R[L*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i})},j.prototype.loadTexture=function(e){var r,a=this,n=this.json,i=this.options,o=this.textureLoader,l=self.URL||self.webkitURL,c=n.textures[e],u=c.extensions||{},p=(r=u[s.MSFT_TEXTURE_DDS]?n.images[u[s.MSFT_TEXTURE_DDS].source]:n.images[c.source]).uri,h=!1;return void 0!==r.bufferView&&(p=a.getDependency("bufferView",r.bufferView).then(function(e){h=!0;var t=new Blob([e],{type:r.mimeType});return p=l.createObjectURL(t)})),Promise.resolve(p).then(function(e){var r=i.manager.getHandler(e);return r||(r=u[s.MSFT_TEXTURE_DDS]?a.extensions[s.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise(function(a,s){var n=a;!0===r.isImageBitmapLoader&&(n=function(e){a(new t.CanvasTexture(e))}),r.load(H(e,i.path),n,void 0,s)})}).then(function(s){!0===h&&l.revokeObjectURL(p),s.flipY=!1,c.name&&(s.name=c.name),r.mimeType in N&&(s.format=N[r.mimeType]);var i=(n.samplers||{})[c.sampler]||{};return s.magFilter=A[i.magFilter]||t.LinearFilter,s.minFilter=A[i.minFilter]||t.LinearMipmapLinearFilter,s.wrapS=E[i.wrapS]||t.RepeatWrapping,s.wrapT=E[i.wrapT]||t.RepeatWrapping,a.associations.set(s,{type:"textures",index:e}),s})},j.prototype.assignTexture=function(e,r,a){var n=this;return this.getDependency("texture",a.index).then(function(i){if(!i.isCompressedTexture)switch(r){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":i.format=t.RGBFormat}if(void 0===a.texCoord||0==a.texCoord||"aoMap"===r&&1==a.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+a.texCoord+" for texture "+r+" not yet supported."),n.extensions[s.KHR_TEXTURE_TRANSFORM]){var o=void 0!==a.extensions?a.extensions[s.KHR_TEXTURE_TRANSFORM]:void 0;if(o){var l=n.associations.get(i);i=n.extensions[s.KHR_TEXTURE_TRANSFORM].extendTexture(i,o),n.associations.set(i,l)}}e[r]=i})},j.prototype.assignFinalMaterial=function(e){var r=e.geometry,a=e.material,s=void 0!==r.attributes.tangent,n=void 0!==r.attributes.color,i=void 0===r.attributes.normal,o=!0===e.isSkinnedMesh,l=Object.keys(r.morphAttributes).length>0,c=l&&void 0!==r.morphAttributes.normal;if(e.isPoints){var u="PointsMaterial:"+a.uuid,p=this.cache.get(u);p||(p=new t.PointsMaterial,t.Material.prototype.copy.call(p,a),p.color.copy(a.color),p.map=a.map,p.sizeAttenuation=!1,this.cache.add(u,p)),a=p}else if(e.isLine){u="LineBasicMaterial:"+a.uuid;var h=this.cache.get(u);h||(h=new t.LineBasicMaterial,t.Material.prototype.copy.call(h,a),h.color.copy(a.color),this.cache.add(u,h)),a=h}if(s||n||i||o||l){u="ClonedMaterial:"+a.uuid+":";a.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),o&&(u+="skinning:"),s&&(u+="vertex-tangents:"),n&&(u+="vertex-colors:"),i&&(u+="flat-shading:"),l&&(u+="morph-targets:"),c&&(u+="morph-normals:");var d=this.cache.get(u);d||(d=a.clone(),o&&(d.skinning=!0),s&&(d.vertexTangents=!0),n&&(d.vertexColors=!0),i&&(d.flatShading=!0),l&&(d.morphTargets=!0),c&&(d.morphNormals=!0),this.cache.add(u,d),this.associations.set(d,this.associations.get(a))),a=d}a.aoMap&&void 0===r.attributes.uv2&&void 0!==r.attributes.uv&&r.setAttribute("uv2",r.attributes.uv),a.normalScale&&!s&&(a.normalScale.y=-a.normalScale.y),a.clearcoatNormalScale&&!s&&(a.clearcoatNormalScale.y=-a.clearcoatNormalScale.y),e.material=a},j.prototype.getMaterialType=function(){return t.MeshStandardMaterial},j.prototype.loadMaterial=function(e){var r,a=this,n=this.json,i=this.extensions,o=n.materials[e],l={},c=o.extensions||{},u=[];if(c[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var p=i[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=p.getMaterialType(),u.push(p.extendParams(l,o,a))}else if(c[s.KHR_MATERIALS_UNLIT]){var h=i[s.KHR_MATERIALS_UNLIT];r=h.getMaterialType(),u.push(h.extendParams(l,o,a))}else{var d=o.pbrMetallicRoughness||{};if(l.color=new t.Color(1,1,1),l.opacity=1,Array.isArray(d.baseColorFactor)){var m=d.baseColorFactor;l.color.fromArray(m),l.opacity=m[3]}void 0!==d.baseColorTexture&&u.push(a.assignTexture(l,"map",d.baseColorTexture)),l.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,l.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(u.push(a.assignTexture(l,"metalnessMap",d.metallicRoughnessTexture)),u.push(a.assignTexture(l,"roughnessMap",d.metallicRoughnessTexture))),r=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),u.push(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)}))}!0===o.doubleSided&&(l.side=t.DoubleSide);var g=o.alphaMode||C;return g===U?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,g===F&&(l.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&r!==t.MeshBasicMaterial&&(u.push(a.assignTexture(l,"normalMap",o.normalTexture)),l.normalScale=new t.Vector2(1,1),void 0!==o.normalTexture.scale&&l.normalScale.set(o.normalTexture.scale,o.normalTexture.scale)),void 0!==o.occlusionTexture&&r!==t.MeshBasicMaterial&&(u.push(a.assignTexture(l,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(l.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&r!==t.MeshBasicMaterial&&(l.emissive=(new t.Color).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&r!==t.MeshBasicMaterial&&u.push(a.assignTexture(l,"emissiveMap",o.emissiveTexture)),Promise.all(u).then(function(){var n;return n=r===f?i[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new r(l),o.name&&(n.name=o.name),n.map&&(n.map.encoding=t.sRGBEncoding),n.emissiveMap&&(n.emissiveMap.encoding=t.sRGBEncoding),G(n,o),a.associations.set(n,{type:"materials",index:e}),o.extensions&&D(i,n,o),n})},j.prototype.loadGeometries=function(e){var r=this,a=this.extensions,n=this.primitiveCache;function i(e){return a[s.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,r).then(function(t){return K(t,e,r)})}for(var o,l,c=[],u=0,p=e.length;u<p;u++){var h,d=e[u],m=(void 0,(l=(o=d).extensions&&o.extensions[s.KHR_DRACO_MESH_COMPRESSION])?"draco:"+l.bufferView+":"+l.indices+":"+B(l.attributes):o.indices+":"+B(o.attributes)+":"+o.mode),f=n[m];if(f)c.push(f.promise);else h=d.extensions&&d.extensions[s.KHR_DRACO_MESH_COMPRESSION]?i(d):K(new t.BufferGeometry,d,r),n[m]={primitive:d,promise:h},c.push(h)}return Promise.all(c)},j.prototype.loadMesh=function(e){for(var r,a=this,s=this.json.meshes[e],n=s.primitives,i=[],o=0,l=n.length;o<l;o++){var c=void 0===n[o].material?(void 0===(r=this.cache).DefaultMaterial&&(r.DefaultMaterial=new t.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:t.FrontSide})),r.DefaultMaterial):this.getDependency("material",n[o].material);i.push(c)}return i.push(a.loadGeometries(n)),Promise.all(i).then(function(r){for(var i=r.slice(0,r.length-1),o=r[r.length-1],l=[],c=0,u=o.length;c<u;c++){var p,h=o[c],d=n[c],m=i[c];if(d.mode===R||d.mode===L||d.mode===_||void 0===d.mode)!0!==(p=!0===s.isSkinnedMesh?new t.SkinnedMesh(h,m):new t.Mesh(h,m)).isSkinnedMesh||p.geometry.attributes.skinWeight.normalized||p.normalizeSkinWeights(),d.mode===L?p.geometry=V(p.geometry,t.TriangleStripDrawMode):d.mode===_&&(p.geometry=V(p.geometry,t.TriangleFanDrawMode));else if(d.mode===y)p=new t.LineSegments(h,m);else if(d.mode===x)p=new t.Line(h,m);else if(d.mode===S)p=new t.LineLoop(h,m);else{if(d.mode!==M)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);p=new t.Points(h,m)}Object.keys(p.geometry.morphAttributes).length>0&&k(p,s),p.name=s.name||"mesh_"+e,o.length>1&&(p.name+="_"+c),G(p,s),a.assignFinalMaterial(p),l.push(p)}if(1===l.length)return l[0];var f=new t.Group;for(c=0,u=l.length;c<u;c++)f.add(l[c]);return f})},j.prototype.loadCamera=function(e){var r,a=this.json.cameras[e],s=a[a.type];if(s)return"perspective"===a.type?r=new t.PerspectiveCamera(t.MathUtils.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):"orthographic"===a.type&&(r=new t.OrthographicCamera(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),a.name&&(r.name=a.name),G(r,a),Promise.resolve(r);console.warn("THREE.GLTFLoader: Missing camera parameters.")},j.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},j.prototype.loadAnimation=function(e){for(var r=this.json.animations[e],a=[],s=[],n=[],i=[],o=[],l=0,c=r.channels.length;l<c;l++){var u=r.channels[l],p=r.samplers[u.sampler],h=u.target,d=void 0!==h.node?h.node:h.id,m=void 0!==r.parameters?r.parameters[p.input]:p.input,f=void 0!==r.parameters?r.parameters[p.output]:p.output;a.push(this.getDependency("node",d)),s.push(this.getDependency("accessor",m)),n.push(this.getDependency("accessor",f)),i.push(p),o.push(h)}return Promise.all([Promise.all(a),Promise.all(s),Promise.all(n),Promise.all(i),Promise.all(o)]).then(function(a){for(var s=a[0],n=a[1],i=a[2],o=a[3],l=a[4],c=[],u=0,p=s.length;u<p;u++){var h=s[u],d=n[u],m=i[u],f=o[u],g=l[u];if(void 0!==h){var v;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,P[g.path]){case P.weights:v=t.NumberKeyframeTrack;break;case P.rotation:v=t.QuaternionKeyframeTrack;break;case P.position:case P.scale:default:v=t.VectorKeyframeTrack}var M=h.name?h.name:h.uuid,y=void 0!==f.interpolation?O[f.interpolation]:t.InterpolateLinear,S=[];P[g.path]===P.weights?h.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&S.push(e.name?e.name:e.uuid)}):S.push(M);var x=m.array;if(m.normalized){var R;if(x.constructor===Int8Array)R=1/127;else if(x.constructor===Uint8Array)R=1/255;else if(x.constructor==Int16Array)R=1/32767;else{if(x.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");R=1/65535}for(var L=new Float32Array(x.length),_=0,w=x.length;_<w;_++)L[_]=x[_]*R;x=L}for(_=0,w=S.length;_<w;_++){var A=new v(S[_]+"."+P[g.path],d.array,x,y);"CUBICSPLINE"===f.interpolation&&(A.createInterpolant=function(e){return new T(this.times,this.values,this.getValueSize()/3,e)},A.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(A)}}}var E=r.name?r.name:"animation_"+e;return new t.AnimationClip(E,void 0,c)})},j.prototype.loadNode=function(e){var r,a=this.json,n=this.extensions,i=this,o=a.meshReferences,l=a.meshUses,c=a.nodes[e];return(r=[],void 0!==c.mesh&&r.push(i.getDependency("mesh",c.mesh).then(function(e){var t;if(o[c.mesh]>1){var r=l[c.mesh]++;(t=e.clone()).name+="_instance_"+r}else t=e;return void 0!==c.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,r=c.weights.length;t<r;t++)e.morphTargetInfluences[t]=c.weights[t]}),t})),void 0!==c.camera&&r.push(i.getDependency("camera",c.camera)),c.extensions&&c.extensions[s.KHR_LIGHTS_PUNCTUAL]&&void 0!==c.extensions[s.KHR_LIGHTS_PUNCTUAL].light&&r.push(i.getDependency("light",c.extensions[s.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(r)).then(function(r){var a;if((a=!0===c.isBone?new t.Bone:r.length>1?new t.Group:1===r.length?r[0]:new t.Object3D)!==r[0])for(var s=0,o=r.length;s<o;s++)a.add(r[s]);if(c.name&&(a.userData.name=c.name,a.name=t.PropertyBinding.sanitizeNodeName(c.name)),G(a,c),c.extensions&&D(n,a,c),void 0!==c.matrix){var l=new t.Matrix4;l.fromArray(c.matrix),a.applyMatrix4(l)}else void 0!==c.translation&&a.position.fromArray(c.translation),void 0!==c.rotation&&a.quaternion.fromArray(c.rotation),void 0!==c.scale&&a.scale.fromArray(c.scale);return i.associations.set(a,{type:"nodes",index:e}),a})},j.prototype.loadScene=function(){function e(r,a,s,n){var i=s.nodes[r];return n.getDependency("node",r).then(function(e){return void 0===i.skin?e:n.getDependency("skin",i.skin).then(function(e){for(var t=[],a=0,s=(r=e).joints.length;a<s;a++)t.push(n.getDependency("node",r.joints[a]));return Promise.all(t)}).then(function(a){return e.traverse(function(e){if(e.isMesh){for(var s=[],n=[],i=0,o=a.length;i<o;i++){var l=a[i];if(l){s.push(l);var c=new t.Matrix4;void 0!==r.inverseBindMatrices&&c.fromArray(r.inverseBindMatrices.array,16*i),n.push(c)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[i])}e.bind(new t.Skeleton(s,n),e.matrixWorld)}}),e});var r}).then(function(t){a.add(t);var r=[];if(i.children)for(var o=i.children,l=0,c=o.length;l<c;l++){var u=o[l];r.push(e(u,t,s,n))}return Promise.all(r)})}return function(r){var a=this.json,s=this.extensions,n=this.json.scenes[r],i=new t.Group;n.name&&(i.name=n.name),G(i,n),n.extensions&&D(s,i,n);for(var o=n.nodes||[],l=[],c=0,u=o.length;c<u;c++)l.push(e(o[c],i,a,this));return Promise.all(l).then(function(){return i})}}(),e}();function s(e){}exports.GLTFLoader=a;
},{"./FetchFileLoader":777,"three":74,"./addFrameTasks":140}],755:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=w;var e=require("three"),o=p(e),t=require("../../tags"),n=p(t),r=require("../../util/CapsuleBufferGeometry"),a=d(r),i=require("../../util/math"),c=p(i),l=require("../../util/ShaderManager"),s=p(l),v=require("../../util/GLTFLoader"),u=require("canvas-sketch-util/math");function d(e){return e&&e.__esModule?e:{default:e}}function p(e){if(e&&e.__esModule)return e;var o={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(o[t]=e[t]);return o.default=e,o}const m=()=>{},y=new e.TextureLoader;function M(e){return new Promise((o,t)=>{y.load(e,e=>{o(e)},m,e=>{t(e)})})}function w(){const e=new o.Group,t=(new o.Geometry).fromBufferGeometry(new a.default(.5,.5,1,5,5,5,5));t.mergeVertices(),t.rotateX(Math.PI/2),t.rotateY(Math.PI/2),t.scale(.1/.24,.1/.24,.1/.24),t.translate(.875,0,-.5);const n=new o.MeshBasicMaterial({color:"black"}),r=new o.CircleGeometry(1,16);r.merge(t,new o.Matrix4,1);const i=s.create({vertexShader:"\n      varying vec2 vUv;\n      void main () {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n      }\n    ",name:"character-face",fragmentShader:"\n      varying vec2 vUv;\n      void main () {\n        vec2 q = vec2(vUv - 0.5);\n        float d = length(q);\n        float circ = 1.0 - step(0.25, d);\n        vec2 q2 = q - vec2(0.25, 0.0);\n        float d2 = length(q2);\n        circ *= step(0.25, d2);\n        gl_FragColor = vec4(vec3(circ), 1.0);\n      }\n    "}),l=new o.MeshBasicMaterial({color:"black"}),v=new o.Mesh(r,[i,l]),u=new o.Mesh(r,new o.MeshBasicMaterial({color:"white",transparent:!0})),d=new o.Mesh(r,new o.MeshBasicMaterial({color:"black",transparent:!0}));v.scale.setScalar(.24),u.scale.setScalar(.132),d.scale.setScalar(.132),e.add(v),e.position.y=1.44;const p=new o.Vector3,m=(new o.Mesh(t,n),new o.Group,new o.CylinderBufferGeometry(.025,.24*1.15,.75,16,1));m.translate(0,.375,0);const y=new o.Group,M=s.create({name:"character-hat",uniforms:{color:{value:new o.Color("#de4d26")},tMap:{value:new o.Texture}},vertexShader:"\n    varying vec2 vUv;\n    varying vec3 vNormal;\n    varying vec3 vViewPoisition;\n    void main () {\n      vUv = uv;\n      vNormal = normalMatrix * normal;\n      vec4 worldPos = modelMatrix * vec4(position.xyz, 1.0);\n      vec4 vpos = viewMatrix * vec4(worldPos.xyz, 1.0);\n      vViewPoisition = -vpos.xyz;\n      gl_Position = projectionMatrix * vpos;\n    }\n  ",fragmentShader:"\n    varying vec2 vUv;\n    varying vec3 vViewPoisition;\n    varying vec3 vNormal;\n    uniform vec3 color;\n    uniform sampler2D tMap;\n    void main () {\n      float rim = clamp(dot(normalize(vViewPoisition), vNormal), 0.0, 1.0);\n      // rim = step(0.5, rim);\n\n      vec3 cMap = texture2D(tMap, vUv).rgb;\n\n      vec3 outColor = color;\n      // outColor = mix(color * 0.85, color, rim);\n      gl_FragColor = vec4(outColor, 1.0);\n    }\n  "}),w=new o.Mesh(m,M);e.add(y),y.add(w);const f=new o.Matrix4,h=new o.Matrix4;return{group:e,getScarfAnchor:o=>(e.localToWorld(o.set(0,-.24,0)),o),getHatTipPoint:e=>w?(w.localToWorld(e.set(0,.75,0)),e):y.position,update(e,o,t,n,r,a,i){p.set(Math.cos(t),0,Math.sin(t)),v.position.set(0,0,0).addScaledVector(p,.1*n),u.position.copy(v.position),u.position.addScaledVector(i,-.066),d.position.copy(u.position),d.position.addScaledVector(i,-.132);const l=p.dot(a)<0?-1:1;d.position.addScaledVector(a,.132*l),v.quaternion.copy(o.quaternion),v.scale.x=.24*l,u.quaternion.copy(v.quaternion),d.quaternion.copy(v.quaternion);const s=c.lerp(5,70,n),m=f.identity();m.multiply(h.makeTranslation(v.position.x,v.position.y+0,v.position.z)),m.multiply(h.makeRotationY(t)),m.multiply(h.makeRotationZ(c.degToRad(s))),m.multiply(h.makeTranslation(0,.075,0)),y.matrixAutoUpdate=!1,y.matrix.identity(),y.applyMatrix4(m),y.matrixAutoUpdate=!0}}}
},{"three":74,"../../tags":60,"../../util/CapsuleBufferGeometry":242,"../../util/math":240,"../../util/ShaderManager":243,"../../util/GLTFLoader":279,"canvas-sketch-util/math":306}],831:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CylinderBufferGeometry=exports.CylinderGeometry=void 0;var t=require("three");function e({radiusTop:e,radiusBottom:r,height:s,radialSegments:h,heightSegments:i,openBottom:n,openTop:p,thetaStart:u,thetaLength:a}){t.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:r,height:s,radialSegments:h,heightSegments:i,openTop:p,openBottom:n,thetaStart:u,thetaLength:a},this.fromBufferGeometry(new o({radiusTop:e,radiusBottom:r,height:s,radialSegments:h,heightSegments:i,openTop:p,openBottom:n,thetaStart:u,thetaLength:a})),this.mergeVertices()}function o({radiusTop:e,radiusBottom:o,height:r,radialSegments:s,heightSegments:h,openTop:i,openBottom:n,thetaStart:p,thetaLength:u}){t.BufferGeometry.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:o,height:r,radialSegments:s,heightSegments:h,openBottom:n,openTop:i,thetaStart:p,thetaLength:u};const a=this;e=void 0!==e?e:1,o=void 0!==o?o:1,r=r||1,s=Math.floor(s)||8,h=Math.floor(h)||1,i=void 0!==i&&i,n=void 0!==n&&n,p=void 0!==p?p:0,u=void 0!==u?u:2*Math.PI;const l=[],f=[],m=[],c=[],d=[],y=[];let g=0;const B=[],S=r/2;let x=0;function b(r){let h,i;const n=new t.Vector2,B=new t.Vector3;let b=0;const G=!0===r?e:o,v=!0===r?1:-1;h=g;for(let t=1;t<=s;t++)m.push(0,S*v,0),c.push(0,v,0),d.push(.5,.5),y.push(v),f.push(t/(s+1)*u+p),g++;i=g;for(let t=0;t<=s;t++){const e=t/s*u+p,o=Math.cos(e),r=Math.sin(e);B.x=G*r,B.y=S*v,B.z=G*o,m.push(B.x,B.y,B.z),c.push(0,v,0),n.x=.5*o+.5,n.y=.5*r*v+.5,d.push(n.x,n.y),y.push(v),f.push(t/(s+1)*u+p),g++}for(let t=0;t<s;t++){const e=h+t,o=i+t;!0===r?l.push(o,o+1,e):l.push(o+1,o,e),b+=3}a.addGroup(x,b,!0===r?1:2),x+=b}!function(){const i=new t.Vector3,n=new t.Vector3;let b=0;const G=(o-e)/r;for(let t=0;t<=h;t++){const a=[],l=t/h,x=l*(o-e)+e;for(let t=0;t<=s;t++){const e=t/s,o=e*u+p,h=Math.sin(o),B=Math.cos(o);n.x=x*h,n.y=-l*r+S,n.z=x*B,m.push(n.x,n.y,n.z),f.push(t/(s+1)*u+p),i.set(h,G,B).normalize(),c.push(i.x,i.y,i.z),d.push(e,1-l),y.push(0),a.push(g++)}B.push(a)}for(let t=0;t<s;t++)for(let e=0;e<h;e++){const o=B[e][t],r=B[e+1][t],s=B[e+1][t+1],h=B[e][t+1];l.push(o,r,h),l.push(r,s,h),b+=6}a.addGroup(x,b,0),x+=b}(),!1===i&&e>0&&b(!0),!1===n&&o>0&&b(!1),this.setIndex(l),this.setAttribute("position",new t.Float32BufferAttribute(m,3)),this.setAttribute("normal",new t.Float32BufferAttribute(c,3)),this.setAttribute("uv",new t.Float32BufferAttribute(d,2)),this.setAttribute("capState",new t.Float32BufferAttribute(y,1)),this.setAttribute("vertexAngle",new t.Float32BufferAttribute(f,1))}e.prototype=Object.create(t.Geometry.prototype),e.prototype.constructor=e,o.prototype=Object.create(t.BufferGeometry.prototype),o.prototype.constructor=o,exports.CylinderGeometry=e,exports.CylinderBufferGeometry=o;
},{"three":74}],756:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=p;var e=require("three"),n=f(e),o=require("../../util/math"),t=f(o),a=require("../../util/ShaderManager"),r=f(a),l=require("../AnimationSystem"),i=require("../../util/tween-ticker"),v=s(i),c=require("../../util/ModCylinderGeometry");function s(e){return e&&e.__esModule?e:{default:e}}function f(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n.default=e,n}function p(e,{map:o}){const a=e.findTag(Tags.UserCharacter),l=new c.CylinderBufferGeometry({radiusTop:.15,radiusBottom:.8,height:1,radialSegments:32,heightSegments:8,openTop:!1,openBottom:!1});l.translate(0,.5,0);const i=r.create({uniforms:{cap:{value:!0,type:"b"},color:{value:new n.Color("#de4d26")},overlayColor:{value:new n.Color("#f7eaaf")},opacity:{value:1},ripple:{value:0},rotationAngle:{value:0},map:{value:o},mapScale:{value:(new n.Vector2).setScalar(.75)},mapOffset:{value:new n.Vector2(.45,.5)},coneHeight:{value:1},tilt:{value:0},magicalEffect:{value:0},stroke:{value:!1,type:"b"},elapsed:{value:0},glowIntensity:{value:1},glowIntensity2:{value:1}},name:"cape-mesh",extensions:{derivatives:!0},side:n.DoubleSide,fragmentShader:"\n      #include <common>\n      uniform vec3 color;\n      uniform vec3 overlayColor;\n      uniform float opacity;\n      uniform sampler2D map;\n      uniform float magicalEffect;\n      uniform float glowIntensity;\n      uniform float glowIntensity2;\n      varying float vConeY;\n      varying vec2 vUv;\n      varying vec3 vNormal;\n      varying float vAngle;\n      varying float vCap;\n      varying vec2 vScreenUv;\n      uniform bool stroke;\n      varying vec3 vViewPoisition;\n\n      vec4 tex2DConstScale(sampler2D tex, float texSize, vec2 uv)\n      {\n        // uv.x *= aspect;\n        // uv.xy *= spriteHeight;\n        vec2 offset = vec2(0.0, 0.0);\n        // Find the discretized derivatives of our coordinates\n        float maxDeriv = max(length(dFdx(uv)), length(dFdy(uv)));\n        float pixScale = 1.0 / (texSize * maxDeriv);\n        // Find two nearest log-discretized noise scales\n        vec2 pixScales = vec2(\n          exp2(floor(log2(pixScale))),\n          exp2(ceil(log2(pixScale)))\n        );\n        // Factor to interpolate lerp with\n        float lerpFactor = fract(log2(pixScale));\n\n        float scale = 0.1;\n        return mix(\n          texture2D(tex, pixScales.x * scale * uv + offset),\n          texture2D(tex, pixScales.y * scale * uv + offset),\n          lerpFactor\n        );\n      }\n\n      void main () {\n        float L = texture2D(map, vUv).r * glowIntensity;\n\n        float rim = clamp(dot(normalize(vViewPoisition), vNormal), 0.0, 1.0);\n        rim = step(0.5, rim);\n        vec3 curOverlay = overlayColor + 0.75;\n        \n        // float L = tex2DConstScale(map, 256.0, vUv).r;\n        if (vCap > 0.5) {\n          gl_FragColor = vec4(color, opacity);\n        } else {\n          float edges = step(0.045, vConeY);\n          // float edges = clamp(step(0.05, vConeY) * step(vConeY, 1.0 - 0.05), 0.0, 1.0);\n\n          vec3 outColor = mix(color, overlayColor, L) * glowIntensity2;\n          outColor = mix(vec3(magicalEffect), outColor, edges);\n          // outColor.rgb = mix(outColor * 0.85, outColor, vec3(rim));\n\n          // outColor = mix(outColor, outColor * 0.75, pow(1.0 - vConeY, 1.5));\n\n\n          // gl_FragColor = vec4(vec3(edges), 1.0);\n          gl_FragColor = vec4(outColor, opacity);\n        }\n        if (stroke) {\n          gl_FragColor.rgb = vec3(0.0);\n        }\n        // gl_FragColor.rgb += vCap;\n        // gl_FragColor.a = 1.0;\n      }\n    ",vertexShader:"\n      #include <common>\n      attribute float capState;\n      attribute float vertexAngle;\n      uniform float tilt;\n      uniform float ripple;\n      uniform bool stroke;\n      uniform float elapsed;\n      uniform float coneHeight;\n      varying float vAngle;\n      uniform vec2 mapScale;\n      uniform vec2 mapOffset;\n      uniform float rotationAngle;\n      varying vec2 vScreenUv;\n      varying vec2 vUv;\n      varying vec3 vNormal;\n      varying float vCap;\n      varying float vConeY;\n      varying vec3 vViewPoisition;\n\n      void main () {\n        vUv = mapOffset + uv * mapScale;\n        vCap = capState;\n        vec3 transformed = position.xyz;\n\n        \n        float rippleTime = 0.0;\n\n        vec3 centerWorldPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n        vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n        vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n        vec2 scale;\n        scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n        scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n        vec3 vertexWorldPos = centerWorldPos;\n\n        float coneYAlpha = position.y / coneHeight;\n        vec2 norm = normalize(transformed.xz);\n        float coneAngle = atan(norm.y, norm.x);\n        float tAngle = (coneAngle + PI) / (PI * 2.0);\n        vAngle = coneAngle;\n        float coneYStrength = smoothstep(0.5, 0.0, coneYAlpha);\n\n        vConeY = coneYAlpha;\n\n        if (capState < 0.5) {\n          vec3 targetPoint = vec3(0.0, coneHeight, 0.0);\n          vec3 targetDir = normalize(position.xyz - targetPoint);\n\n          float time = ripple * PI * 2.0;\n          float rippleFreq = PI * 2.0 * 0.5;\n          float rippleAmp = 0.1;\n          transformed.xz += norm * cos(coneAngle * 5.0 + elapsed) * 0.1 * pow(1.0 - coneYAlpha, 5.0);\n          transformed.xyz += targetDir * (sin(coneAngle * rippleFreq + time)) * rippleAmp * coneYStrength;\n        }\n        transformed.xyz += tilt * vec3(-1.0, 0.0, 0.0) * (1.0 - pow(coneYAlpha, 0.85));\n\n\n        if (stroke) {\n          // transformed.xyz *= 1.1;\n          // transformed.xyz += normal.xyz * 0.2;\n          // transformed.y -= 0.1;\n        }\n        \n        // if (capState < -0.5) {\n        //   transformed.y -= 0.1;\n        // }\n        vNormal = normalMatrix * normal;\n        vec3 worldPos = (modelMatrix * vec4(transformed.xyz, 1.0)).xyz;\n        // vec3 moveDir = vec3(cos(rotationAngle), 0.0, sin(rotationAngle));\n        // worldPos -= moveDir * tilt * 4.0;\n        vec4 vpos = viewMatrix * vec4(worldPos, 1.0);\n        vViewPoisition = -vpos.xyz;\n\n        gl_Position = projectionMatrix * vpos;\n        vec4 spritePos = projectionMatrix * viewMatrix * vec4(vertexWorldPos, 1.0);\n        vScreenUv = (gl_Position.xy / gl_Position.w * 0.5 + 0.5);\n        vScreenUv.x -= spritePos.x / spritePos.w * 0.5 + 0.5;\n        vScreenUv.y -= spritePos.y / spritePos.w * 0.5 + 0.5;\n        vScreenUv = vScreenUv * 12.0;\n        // vScreenUv.x -= rotationAngle;\n      }\n    "}),s=new n.Mesh(l,i),f=new n.Group;f.add(s);const p=e.view(Tags.CapeMagicalEffect),m=e.view(Tags.AutoRemoveCapeMagicalEffect),u=(0,v.default)();let g={enabled:!1,value:0};const d=e.view(Tags.FinalBiomeResolution);return{group:f,update(n,o,r,l){u.tick(n),m.forEach(e=>{const o=e.get(Tags.AutoRemoveCapeMagicalEffect);o.elapsed+=n,o.elapsed>=o.delay&&(e.tagOff(Tags.CapeMagicalEffect),e.tagOff(Tags.AutoRemoveCapeMagicalEffect))}),s.rotation.y=r,i.uniforms.tilt.value=1.15*l,i.uniforms.rotationAngle.value=r,i.uniforms.elapsed.value+=n,i.uniforms.glowIntensity.value=a.glowIntensity,i.uniforms.glowIntensity2.value=a.glowIntensity2,a.capeSpeed>0?i.uniforms.ripple.value+=n*a.capeSpeed:i.uniforms.ripple.value+=n*t.lerp(.2,2,l);const v=d.length>0||p.length>0||e.findTag(Tags.DirectUserToOrigin);g.enabled!==v&&(u.cancel().to(g,{value:v?4:0,duration:v?1:2,ease:"sineOut"}),g.enabled=v),i.uniforms.magicalEffect.value=g.value}}}
},{"three":74,"../../util/math":240,"../../util/ShaderManager":243,"../AnimationSystem":108,"../../util/tween-ticker":244,"../../util/ModCylinderGeometry":831}],757:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var n=require("three"),e=s(n),t=require("../../util/math"),o=s(t),a=require("../../util/ShaderManager"),i=s(a),r=require("../../util/ModCylinderGeometry"),l=require("canvas-sketch-util/math");function s(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e.default=n,e}function u(){const n=new r.CylinderBufferGeometry({radiusTop:.15*.75,radiusBottom:.0225,height:1,radialSegments:4,heightSegments:16,openTop:!1,openBottom:!1});n.translate(0,.5,0);const t=i.create({name:"legsShader",uniforms:{uTime:{value:0},uTiltAngle:{value:0},noiseScale:{value:0},uBendScale:{value:0}},vertexShader:"\n      uniform float uTime;\n      uniform float uBendScale;\n      uniform float uTiltAngle;\n      uniform float noiseScale;\n      varying vec2 vUv;\n      mat3 rotation3dX(float angle) {\n      \tfloat s = sin(angle);\n      \tfloat c = cos(angle);\n\n      \treturn mat3(\n      \t\t1.0, 0.0, 0.0,\n      \t\t0.0, c, s,\n      \t\t0.0, -s, c\n      \t);\n      }\n      mat3 rotation3dZ(float angle) {\n      \tfloat s = sin(angle);\n      \tfloat c = cos(angle);\n\n      \treturn mat3(\n      \t\tc, s, 0.0,\n      \t\t-s, c, 0.0,\n      \t\t0.0, 0.0, 1.0\n      \t);\n      }\n\n      void main() {\n\n        vec4 worldPos = modelViewMatrix * vec4(position, 1.0);\n\n        float p = sin( uTime * 0.5 + worldPos.x * 1. ) * noiseScale;\n        float bendScale = sin(uTime) * 0.5 + 0.5;\n        float bendTgt = .3 + p;\n        float bendInfluence = 1. - pow(1.0 - position.y, 4.);\n        float bending = bendTgt * bendInfluence * uBendScale;\n\n\n        vec3 bendPos = position.xyz;\n        bendPos.y -= 1.0;\n        bendPos.x -= bending;\n        bendPos = rotation3dZ(uTiltAngle) * bendPos;\n        bendPos.y += 1.0;\n\n        // vec3 bendPos = vec3(position.x - bending, position.y, position.z);\n\n\n\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(bendPos, 1.0);\n\n        vUv = uv;\n      }\n    ",fragmentShader:"\n      varying vec2 vUv;\n      void main() {\n        gl_FragColor = vec4(0., 0.,0.,1.);\n      }\n    "}),o=new e.Mesh(n,t);o.rotateY(Math.PI),o.rotateZ(0),o.position.z-=.2;const a=new e.Mesh(n,t);a.rotateY(Math.PI),a.rotateZ(0),a.position.z+=.2;const s=new e.Group,u=new e.Group;u.add(o),u.add(a),s.add(u),s.scale.setScalar(1);const d=new e.Vector3(0,1,0),c=(new e.Vector3(1,0,0),[o,a]);return{group:s,update(n,e,o,a){c.forEach((e,o)=>{t.uniforms.uTime.value+=n,t.uniforms.noiseScale.value=(0,l.mapRange)(a,0,.7,0,.2),t.uniforms.uTiltAngle.value=(0,l.mapRange)(a,0,.7,0,30*Math.PI/180),e.position.x=(0,l.mapRange)(a,0,.7,-.2,-.5),t.uniforms.uBendScale.value=(0,l.mapRange)(a,0,.7,.1,.5)}),s.setRotationFromAxisAngle(d,o)}}}
},{"three":74,"../../util/math":240,"../../util/ShaderManager":243,"../../util/ModCylinderGeometry":831,"canvas-sketch-util/math":306}],268:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=w;var e=require("three"),t=m(e),r=require("../../tags"),o=m(r),a=require("../../util/CapsuleBufferGeometry"),n=h(a),i=require("../../util/math"),s=m(i),l=require("../../util/ShaderManager"),p=m(l),u=require("./CharacterHead"),c=h(u),d=require("./CapeMesh"),g=h(d),f=require("./CharacterLegs"),y=h(f);function h(e){return e&&e.__esModule?e:{default:e}}function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function w(e,{capeMap:r,blobShadowMap:a}){const n=e.findTag(o.RenderLayers),i=(e.findTag(o.UserCharacter),new t.Group),l=new t.Group;i.add(l);new t.Vector3;const p=new t.ArrowHelper(new t.Vector3,new t.Vector3),u=new t.Vector3(0,0,1),d=(0,g.default)(e,{map:r}),f=(0,c.default)(),h=(0,y.default)(),m=new t.Sprite(new t.SpriteMaterial({map:a,depthTest:!1,depthWrite:!1,color:"hsl(0, 0%, 0%)",opacity:.15,transparent:!0}));m.scale.set(2,1,1).multiplyScalar(1),m.layers.disableAll(),m.layers.enable(n.shadow);const w=new t.Group;w.add(m),i.add(w),l.add(d.group),l.add(f.group),l.add(h.group),p.setDirection(u);d.group.position.y+=.8,f.group.position.y+=.8,h.group.position.y=.155;const M=d.group.position.y,S=f.group.position.y,v=h.group.position.y;l.scale.multiplyScalar(.8);const q=new t.Vector3,x=new t.Vector3,V=new t.Vector3,W=e.findTag(o.MainCamera);let T=.5,b=1,C=0,I=0,O=null,_=null;return{scale:1,getHatTipPoint:e=>f.getHatTipPoint(e),getScarfAnchor:e=>f.getScarfAnchor(e),group:i,update(e,t,r,o,a){C+=e;const n=t.position,c=t.velocity,g=t.direction,y=c.length(),m=s.clamp01(y/.2);let A=Math.atan2(g.z,g.x);null==O&&(_=A,O=A);if(a&&n.lengthSq()<=225){const e=-n.x,t=-n.z;A=Math.atan2(t,e)}const G=n.distanceToSquared(o.target);let H=_;G>=.25&&(H=A,_=A),O=s.dampAngle(O,H,a?10:50,e),u.set(Math.cos(O),0,Math.sin(O)),w.position.set(0,0,0).addScaledVector(u,-1*m);const P=W.matrixWorldInverse.elements[4],D=W.matrixWorldInverse.elements[5],j=W.matrixWorldInverse.elements[6],z=W.matrixWorldInverse.elements[0],L=W.matrixWorldInverse.elements[1],B=W.matrixWorldInverse.elements[2];q.set(P,D,j),x.set(z,L,B),W.getWorldDirection(V),d.update(e,W,-O,m,q,x,V),f.update(e,W,-O,m,q,x,V),h.update(e,W,-O,m,q,x,V),i.position.copy(n),p.setDirection(u),b=s.lerp(.1,.75,m),T=s.damp(T,b,3,e),I=.05*Math.sin(2*C);const R=T+I;l.position.y=R;const U=.9*s.lerp(1,1.1,m);w.scale.setScalar(U),i.scale.setScalar(1.25*this.scale),d.group.position.y=M+t.yOffset,f.group.position.y=S+t.yOffset,h.group.position.y=v+t.yOffset}}}
},{"three":74,"../../tags":60,"../../util/CapsuleBufferGeometry":242,"../../util/math":240,"../../util/ShaderManager":243,"./CharacterHead":755,"./CapeMesh":756,"./CharacterLegs":757}],269:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=c;var e=require("three"),t=o(e),r=require("../../util/math"),a=o(r);function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function c(){var e=20*Math.PI*20/1e4;const r=new t.Vector3,o=new t.Vector3,c=(new t.Vector3,new t.Vector3),n=new t.Vector3,i=new t.Vector3;let s=!1;return{maxVelocity:15,lerpToTarget:!1,get moveToTarget(){return s},set moveToTarget(e){s=e},target:n,position:i,velocity:o,direction:c,update(t){const l=n.distanceToSquared(i),u=Math.sqrt(l);if(s&&u>=1){r.copy(n).sub(i);const e=u,t=a.clamp01(Math.pow(e/2.5,.2)),c=.1;o.addScaledVector(r,t*c)}o.x=a.clamp(o.x,-15,15),o.y=a.clamp(o.y,-15,15),o.z=a.clamp(o.z,-15,15);var p=o.x,d=o.y,y=o.z,h=-.235*e*1.22*p*p*p/Math.abs(p),m=-.235*e*1.22*d*d*d/Math.abs(d),f=-.235*e*1.22*y*y*y/Math.abs(y),v=(h=isNaN(h)?0:h)/.05,x=(m=isNaN(m)?0:m)/.05,T=(f=isNaN(f)?0:f)/.05;o.x+=v*t,o.y+=x*t,o.z+=T*t,this.lerpToTarget?a.dampVector(i,n,.75,t,i):(i.x+=o.x*t*1,i.y+=o.y*t*1,i.z+=o.z*t*1),c.copy(o).normalize()}}}
},{"three":74,"../../util/math":240}],270:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=q;var e=require("three"),t=v(e),i=require("../../tags"),n=v(i),o=require("../../util/CapsuleBufferGeometry"),s=h(o),r=require("../../util/math"),a=v(r),u=require("../../util/ShaderManager"),l=v(u),c=require("../../systems/writing/Line3D"),p=h(c),d=require("../../util/Random"),f=h(d),y=require("simplex-noise"),m=h(y);function h(e){return e&&e.__esModule?e:{default:e}}function v(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}const x=new t.Vector3;function g(e={}){const{gravity:t=.1*-9.81,mass:i=.05}=e;return{update(e,t){for(let i=0;i<t.length;i++)n(e,t[i])},updatePoint:n};function n(e,t){const n=t.velocity,o=t.position,s=t.maxVelocity,r=t.speed,u=t.radius,l=Math.PI*u*u/1e4;if(n.x=a.clamp(n.x,-s,s),n.y=a.clamp(n.y,-s,s),n.z=a.clamp(n.z,-s,s),!t.pinned){var c=n.x,p=n.y,d=n.z,f=-.235*l*1.22*c*c*c/Math.abs(c),y=-.235*l*1.22*p*p*p/Math.abs(p),m=-.235*l*1.22*d*d*d/Math.abs(d);f=isNaN(f)?0:f,y=isNaN(y)?0:y,m=isNaN(m)?0:m;var h=f/i,v=y/i,x=m/i;n.x+=h*e,n.y+=v*e,n.z+=x*e,o.x+=n.x*e*r,o.y+=n.y*e*r,o.z+=n.z*e*r}}}function w(e,t,i={}){const{restingDistance:n=1,stiffness:o=1,strengths:s=[1,1]}=i;return{solve(i=1){x.copy(e.position).sub(t.position);const r=x.length();var u=0===r?n:(n-r)/r;let l,c,p=s[0],d=s[1];if(0==p&&0==d)l=0,c=0;else if(0==p&&d>0)l=0,c=o;else if(p>0&&0==d)l=o,c=0;else{var f=1/p;c=o-(l=f/(f+1/d)*o)}a.dampVector(t.position,e.position,1+15*(1-a.clamp01(r/u)),i,t.position)}}}function V(e,i={}){const{radius:n=20,maxVelocity:o=15,speed:s=1}=i,r=new t.Vector3(0,0,0);let a=Boolean(i.pinned);return{get pinned(){return a},set pinned(e){a=e},radius:n,maxVelocity:o,speed:s,position:e,velocity:r}}function q(){const e=new t.Group,i=new t.Vector3(0,1.35,0),n=g({mass:.05}),o=a.linspace(6).map((e,n)=>{const o=e;return V(new t.Vector3(o,0,0).add(i),{radius:50,maxVelocity:40,pinned:0===n})}),s=[];for(let e=0;e<o.length-1;e++){const t=o[e],i=o[e+1],n=(o.length,t.position.distanceTo(i.position));s.push(w(t,i,{stiffness:.5,restingDistance:n}))}const r=(0,f.default)(),u=new m.default(r.value),l=new p.default(world,{taper:!1,thickness:.75});l.material.uniforms.color.value.set("#f6eaae"),e.add(l);let c=0,d=0;return{group:e,update(e,t){if(d+=e,o[0].position.copy(t),(c+=e)>=1/30){c%=1/30;for(let e=0;e<1;e++)s.forEach(e=>e.solve(1/30))}o.forEach(e=>{const t=1*u.noise3D(1*e.position.x,d,1*e.position.z);e.velocity.y+=t}),n.update(e,o),l.updatePath(o,!0,!0)}}}
},{"three":74,"../../tags":60,"../../util/CapsuleBufferGeometry":242,"../../util/math":240,"../../util/ShaderManager":243,"../../systems/writing/Line3D":267,"../../util/Random":235,"simplex-noise":294}],94:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=w;var e=require("three"),t=U(e),r=require("../tags"),a=U(r),i=require("../util/CapsuleBufferGeometry"),o=C(i),n=require("../util/math"),c=U(n),l=require("../util/ShaderManager"),s=U(l),u=require("three-quaternion-from-normal"),p=C(u),d=require("../util/tween-ticker"),g=C(d),T=require("../util/Assets"),f=C(T),m=require("../util/materials"),y=require("../util/resetPlayerPos"),h=require("./character/CharacterModel"),v=C(h),q=require("./character/PhysicsSpring"),M=C(q),S=require("./character/ScarfMesh"),P=C(S),O=require("./AnimationSystem");function C(e){return e&&e.__esModule?e:{default:e}}function U(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function w(e){const r=e.findTag(a.Renderer),i=e.entity("CharacterEntity").add(a.UserCharacter),[o]=f.default.createGPUTextureTask(r,"image/data/soft-circle"),[n]=f.default.createGPUTextureTask(r,"image/data/cape-texture-landscape-1024",{generateMipmaps:!1,minFilter:t.NearestFilter,wrapS:t.RepeatWrapping,wrapT:t.RepeatWrapping}),l=new t.Group,s=(0,v.default)(e,{capeMap:n,blobShadowMap:o});s.group.name="character-model",l.name="character-container",l.add(s.group),i.add(a.Object3D,l);const u=(0,M.default)(),p=new t.Vector3;let d=!1;const g=e.tag(a.HatTipPoint),T=new t.Vector3,m=e.listen(a.AnimateInCharacter),h=e.listen(a.AnimateOutCharacter),q={value:1};return function(t){const r=e.findTag(a.HideCharacter),o=e.findTag(a.OriginTreeIntroSequence),n=e.findTag(a.UserTarget),f=e.findTag(a.InputState),v=i.get(a.UserCharacter),M=Boolean(e.findTag(a.CameraStopUserMovement)),S=!Boolean(e.findTag(a.BlockUserMove)),P=!o&&!M&&!Boolean(e.findTag(a.ModalStoppingUserMovement));let C=Boolean(e.findTag(a.MoveUserToOrigin));const U=n.position.distanceToSquared(v.position);let w=r;if(m.added.forEach(t=>{C=!0,w=!0,q.value=0,u.target.copy(y.standingNextToOriginTree),u.position.copy(u.target),v.position.copy(u.target),t.remove(a.AnimateInCharacter),(0,O.tweenTo)(e,q,"value",1,1,"quadOut",0).add(a.BlockUserMove)}),h.added.forEach(t=>{t.remove(a.AnimateOutCharacter),(0,O.tweenTo)(e,q,"value",0,.01,"quadIn",11).add(a.BlockUserMove)}),U>=576&&!C&&(v.position.copy(n.position),u.target.copy(n.position),u.position.copy(n.position),w=!0),w&&(v.velocity.set(0,0),u.velocity.set(0,0,0),u.direction.set(1,0,0)),u.lerpToTarget=!1,C)u.target.copy(y.standingNextToOriginTree),u.moveToTarget=!0,u.lerpToTarget=!0;else if(f.interacted&&n.inputHitPlane&&P&&S){if(u.moveToTarget=!0,d){p.distanceToSquared(n.inputPositionOnPlane)>=625&&(d=!1)}d?c.dampVector(p,n.inputPositionOnPlane,50,t,p):(d=!0,p.copy(n.inputPositionOnPlane)),u.target.copy(p).sub(n.position);const e=u.target.lengthSq();if(e>=144){const t=Math.sqrt(e);0!==t&&u.target.divideScalar(t),u.target.multiplyScalar(12).add(n.position)}else u.target.copy(p)}else u.moveToTarget=!1;u.update(t);v.velocity.copy(u.velocity).multiplyScalar(.2/u.maxVelocity),v.position.copy(u.position),v.direction.copy(u.direction),s.scale=q.value,s.update(t,v,n,u,C),s.getScarfAnchor(T),s.getHatTipPoint(g),l.visible=!o&&!r}}
},{"three":74,"../tags":60,"../util/CapsuleBufferGeometry":242,"../util/math":240,"../util/ShaderManager":243,"three-quaternion-from-normal":288,"../util/tween-ticker":244,"../util/Assets":31,"../util/materials":82,"../util/resetPlayerPos":132,"./character/CharacterModel":268,"./character/PhysicsSpring":269,"./character/ScarfMesh":270,"./AnimationSystem":108}],95:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=D;var t=require("../tags"),e=d(t),a=require("three"),i=d(a),n=require("../util/math"),s=d(n),r=require("./writing/Line3D"),o=p(r),l=require("../util/ObjectPool"),u=p(l),c=require("../util/Random"),h=p(c);function p(t){return t&&t.__esModule?t:{default:t}}function d(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e.default=t,e}class y{constructor(){this.position=[0,0,0],this.velocity=[0,0,0],this.index=0}reset(){this.index=0,this.position[0]=0,this.position[1]=0,this.position[2]=0,this.velocity[0]=0,this.velocity[1]=0,this.velocity[2]=0}}function D(t){const a=new u.default({name:"HatWindLineSamples",initialCapacity:120,create:()=>new y,renew:t=>(t.reset(),t)}),n=new u.default({name:"HatWindLines",initialCapacity:3,create(){const e=new o.default(t,{taper:!0,thickness:.1,bloom:0});return e.userData.path=[],e.userData.lastPosition=new i.Vector3,e.userData.velocity=new i.Vector3,e.userData.hasLastPosition=!1,e.userData.entity=null,e.userData.time=0,e.userData.delay=.25,e.userData.duration=1,e.name="hat-tip-line",e},renew(a){const i=t.entity();return i.add(e.Object3D,a).add(e.HatTipWindLineTag),a.userData.entity=i,a.userData.time=0,a.userData.delay=.25,a.userData.duration=1,a.userData.velocity.set(0,0,0),a.position.set(0,0,0),a},release(t){t.userData.entity&&(t.userData.entity.kill(),t.userData.entity=null),t.userData.hasLastPosition=!1,t.userData.path.length=0}}),r=t.view(e.HatTipPoint),l=t.view(e.HatTipWindLineTag),c=t.view(e.WrittenStanzaLineActive);let p=null,d=!1,D=null,f=0;const g=(0,h.default)(),v=()=>g.range(.5,1);let m=v(),w=((()=>g.range(.1,.1))(),0);let P=0;const T=t.view(e.ActiveEnvironmentState);return function(i){f+=i;const o=t.findTag(e.UserCharacter),u=t.findTag(e.UserTarget),h=Math.atan2(o.direction.z,o.direction.x);o.velocity.length();if(null!=D){const t=Math.abs(s.deltaAngle(h,D)),e=s.radToDeg(t),a=5;P-=P/a,P+=e/a,d&&P<1?w>=m/2&&(d=!1,m=v(),p=null,w=0):!d&&P>4&&u.forceApplied&&0===c.length&&(w=0,d=!0)}if(D=h,d&&(w+=i)>=m&&(w%=m,p=!1,d=!1,m=v(),P=0),r.length>0&&d){const t=r[0].get(e.HatTipPoint);if(!p){p=n.next();const t=T.length>0?T[0].get(e.EnvironmentState).name:null;p.userData.entity.add(e.HatTipWindLineSound,t)}const i=.1,s=i*i,l=p.userData;if(!l.hasLastPosition||l.lastPosition.distanceToSquared(t)>=s){l.hasLastPosition=!0,l.path.length<=0&&l.velocity.copy(o.velocity);const e=a.next();if(t.toArray(e.position),o.velocity.toArray(e.velocity),l.path.length>0&&(e.index=l.path[l.path.length-1].index+1),l.path.length>50){const t=l.path.shift();a.release(t)}l.path.push(e),l.path.length>4&&p.updatePath(l.path,!0),l.lastPosition.copy(t)}p.visible=l.path.length>4}l.forEach(t=>{const s=t.get(e.Object3D);p!==s&&(s.userData.time+=i);const r=Math.max(0,s.userData.time-s.userData.delay),o=1-r/s.userData.duration;if(s.material.uniforms.opacity.value=.5*o,r>=s.userData.duration)s.userData.path.forEach(t=>a.release(t)),n.release(s);else{const t=10;s.userData.path.forEach((e,a,n)=>{const s=n.length<=1?0:a/(n.length-1);e.position[0]+=e.velocity[0]*i*t*s,e.position[2]+=e.velocity[2]*i*t*s,e.position[1]+=-.5*i}),s.updatePath(s.userData.path,!0)}})}}
},{"../tags":60,"three":74,"../util/math":240,"./writing/Line3D":267,"../util/ObjectPool":236,"../util/Random":235}],96:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=require("../tags"),t=s(e),r=require("three"),a=s(r),i=require("../util/Assets"),n=p(i);function p(e){return e&&e.__esModule?e:{default:e}}function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function u(e){const r=new a.Scene,i=new a.OrthographicCamera(-1,1,1,-1,-10,10),p=(e.tag(t.Atmospherics,{scene:r,camera:i}),e.findTag(t.Renderer)),[s]=n.default.createGPUTextureTask(p,"image/data/lightray",{wrapS:a.RepeatWrapping,wrapT:a.RepeatWrapping}),u=new a.Sprite(new a.SpriteMaterial({map:s,depthTest:!1,depthWrite:!1,transparent:!0,opacity:.5,blending:a.AdditiveBlending,side:a.DoubleSide}));return u.scale.setScalar(2),u.position.set(.5,.5,0),r.add(u),e=>{}}
},{"../tags":60,"three":74,"../util/Assets":31}],694:[function(require,module,exports) {
"use strict";function r(r){var t,e=r.length,n=1,a=new Array(e);for(t=e;t>0;t--)a[t-1]=n,n*=r[t-1];return{stride:a,data:new Uint32Array(n)}}module.exports=r;
},{}],289:[function(require,module,exports) {
"use strict";var t=require("./tiny-ndarray"),i=2e-14,s=Math.PI/3,e=[[0,0],[0,-1],[-1,0],[1,0],[0,1],[-1,-1],[1,-1],[-1,1],[1,1],[0,-2],[-2,0],[2,0],[0,2],[-1,-2],[1,-2],[-2,-1],[2,-1],[-2,1],[2,1],[-1,2],[1,2]],r=e.length;function n(e,r){this.width=e.shape[0],this.height=e.shape[1],this.radius=e.radius||e.minDistance,this.maxTries=Math.max(3,Math.ceil(e.tries||30)),this.rng=r||Math.random,this.squaredRadius=this.radius*this.radius,this.radiusPlusEpsilon=this.radius+i,this.cellSize=this.radius*Math.SQRT1_2,this.angleIncrement=2*Math.PI/this.maxTries,this.angleIncrementOnSuccess=s+i,this.triesIncrementOnSuccess=Math.ceil(this.angleIncrementOnSuccess/this.angleIncrement),this.processList=[],this.samplePoints=[],this.gridShape=[Math.ceil(this.width/this.cellSize),Math.ceil(this.height/this.cellSize)],this.grid=t(this.gridShape)}n.prototype.width=null,n.prototype.height=null,n.prototype.radius=null,n.prototype.radiusPlusEpsilon=null,n.prototype.squaredRadius=null,n.prototype.cellSize=null,n.prototype.angleIncrement=null,n.prototype.angleIncrementOnSuccess=null,n.prototype.triesIncrementOnSuccess=null,n.prototype.maxTries=null,n.prototype.rng=null,n.prototype.processList=null,n.prototype.samplePoints=null,n.prototype.gridShape=null,n.prototype.grid=null,n.prototype.addRandomPoint=function(){return this.directAddPoint([this.rng()*this.width,this.rng()*this.height,this.rng()*Math.PI*2,0])},n.prototype.addPoint=function(t){return 2===t.length&&t[0]>=0&&t[0]<this.width&&t[1]>=0&&t[1]<this.height?this.directAddPoint([t[0],t[1],this.rng()*Math.PI*2,0]):null},n.prototype.directAddPoint=function(t){var i=[t[0],t[1]];this.processList.push(t),this.samplePoints.push(i);var s=(t[0]/this.cellSize|0)*this.grid.stride[0]+(t[1]/this.cellSize|0);return this.grid.data[s]=this.samplePoints.length,i},n.prototype.inNeighbourhood=function(t){var i,s,n,h,o,l=this.grid.stride;for(i=0;i<r;i++){for(s=0,n=0;n<2;n++){if((h=(t[n]/this.cellSize|0)+e[i][n])<0||h>=this.gridShape[n]){s=-1;break}s+=h*l[n]}if(-1!==s&&0!==this.grid.data[s]&&(o=this.samplePoints[this.grid.data[s]-1],Math.pow(t[0]-o[0],2)+Math.pow(t[1]-o[1],2)<this.squaredRadius))return!0}return!1},n.prototype.next=function(){for(var t,i,e,r;this.processList.length>0;){var n=this.processList.length*this.rng()|0;for(e=(i=this.processList[n])[2],0===(t=i[3])&&(e+=(this.rng()-.5)*s*4);t<this.maxTries;t++){if((r=[i[0]+Math.cos(e)*this.radiusPlusEpsilon,i[1]+Math.sin(e)*this.radiusPlusEpsilon,e,0])[0]>=0&&r[0]<this.width&&r[1]>=0&&r[1]<this.height&&!this.inNeighbourhood(r))return i[2]=e+this.angleIncrementOnSuccess+this.rng()*this.angleIncrement,i[3]=t+this.triesIncrementOnSuccess,this.directAddPoint(r);e+=this.angleIncrement}if(t>=this.maxTries){const t=this.processList.pop();n<this.processList.length&&(this.processList[n]=t)}}return null},n.prototype.fill=function(){for(0===this.samplePoints.length&&this.addRandomPoint();this.next(););return this.samplePoints},n.prototype.getAllPoints=function(){return this.samplePoints},n.prototype.reset=function(){var t,i=this.grid.data;for(t=0;t<i.length;t++)i[t]=0;this.samplePoints=[],this.processList.length=0},module.exports=n;
},{"./tiny-ndarray":694}],97:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../tags"),t=d(e),r=require("three"),o=d(r),n=require("fast-2d-poisson-disk-sampling"),a=v(n),i=require("../util/Random"),s=v(i),l=require("../util/ShaderManager"),u=d(l),c=require("../util/Assets"),f=v(c);function v(e){return e&&e.__esModule?e:{default:e}}function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function x(){const e=new o.PlaneBufferGeometry(1,1,1,3),t=e.attributes,r=t.position.count,n=[],a=[];for(let e=0;e<r;e++){const r=t.position.getX(e),o=t.position.getY(e)+.5;n.push(r,o);const i=t.uv.getX(e),s=t.uv.getY(e);a.push(i,s)}const i=new o.BufferAttribute(new Float32Array(n),2),s=new o.BufferAttribute(new Float32Array(a),2),l=new o.BufferAttribute(e.getIndex().array,1);return e.dispose(),{position:i,uv:s,index:l}}exports.default=async function(e){const r=await f.default.createGPUTexture(e.findTag(t.Renderer),"image/data/grass-1"),n=(0,s.default)(),{position:i,uv:l,index:c}=x(),v=(new o.BufferGeometry,new o.InstancedBufferGeometry);v.setAttribute("position",i),v.setAttribute("uv",l),v.setIndex(c);const d=new a.default({shape:[40,40],radius:1,tries:10},n.value).fill().map(e=>[e[0]-20,e[1]-20]),m=[];for(let e=0;e<d.length;e++){const t=d[e],r=.75;m.push(t[0],t[1],n.gaussian(r,r/2))}console.log("Instances",d.length),v.instanceCount=d.length;const p=new o.InstancedBufferAttribute(new Float32Array(m),3);v.setAttribute("offset",p);const g=u.create({uniforms:{color:{value:new o.Color("#d8ab38")},colorGround:{value:new o.Color("#B88211")},map:{value:r},aspect:{value:r.image.width/r.image.height}},fragmentShader:"\n      uniform sampler2D map;\n      uniform vec3 color;\n      uniform vec3 colorGround;\n      varying vec2 vUv;\n      void main () {\n        vec4 cData = texture2D(map, vUv);\n        vec4 outColor = vec4(mix(colorGround, color, vUv.y), 1.0);\n        // outColor.rgb += 0.1 * (cData.g * 2.0 - 1.0);\n        float mask = 1.0 - cData.r;\n        gl_FragColor = outColor;\n        if (mask < 0.5) discard;\n      }\n    ",vertexShader:"\n      attribute vec3 offset;\n      uniform float aspect;\n      varying vec2 vUv;\n      void main () {\n        vUv = uv;\n        float curScale = offset.z;\n        vec3 centerWorldPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n        vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n        vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n        vec2 scale;\n        scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n        scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n        scale *= curScale;\n\n        vec2 offsetPos = position.xy;\n        vec3 vertexWorldPos = centerWorldPos\n          + camRightWorld * offsetPos.x * scale.x * aspect \n          + camUpWorld * offsetPos.y * scale.y;\n\n        vertexWorldPos.xz += offset.xy;\n\n        // gl_Position = projectionMatrix * modelViewMatrix * vec4(transformed.xyz, 1.0);\n        gl_Position = projectionMatrix * viewMatrix * vec4(vertexWorldPos, 1.0);\n      }\n    ",side:o.DoubleSide});for(let r=0;r<9;r++){const n=Math.floor(r%3),a=Math.floor(r/3),i=new o.Mesh(v,g);e.entity().add(t.Object3D,i),i.frustumCulled=!1,i.position.x=40*(n-1.5),i.position.z=40*(a-1.5)}return e=>{}};
},{"../tags":60,"three":74,"fast-2d-poisson-disk-sampling":289,"../util/Random":235,"../util/ShaderManager":243,"../util/Assets":31}],259:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t;const e=e=>e;function t(t=0,s=1,i=0,n=.25,o=e){const r=Math.max(0,t-i);let a=0;if(r<=n)a=r/n;else if(isFinite(s)&&r>=s-n){a=1-Math.max(0,r-(s-n))/n}else a=1;return a=o(a)}
},{}],81:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WayfinderSpriteMaterial=void 0;var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};exports.setSpriteFlip=v,exports.setMeshToSprite=x,exports.createSprite=h,exports.traverseAndFixSprites=y,exports.changeToWayfinderSprite=g;var t=require("three"),r=u(t),a=require("../tags"),i=u(a),n=require("./materials"),o=require("./defined"),s=l(o);function l(e){return e&&e.__esModule?e:{default:e}}function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}const m=new r.PlaneGeometry(1,1,1,1);m.translate(0,.5,0);class c extends r.MeshBasicMaterial{constructor(t={}){super(e({},t,{map:t.map||new r.Texture})),this.name=this.name||"UntitledWayfinderSprite",this.userData.type="WayfinderSpriteMaterial"}onBeforeCompile(e){e.uniforms=e.uniforms||{};const t=Boolean(this.userData.flipX);e.uniforms.flipX={value:t,type:"b"},e.uniforms.silhouette={value:!1,type:"b"},e.vertexShader="\n    #include <common>\n    varying vec2 vUv;\n    uniform bool flipX;\n    uniform bool silhouette;\n    void main () {\n      vUv = uv;\n      if (flipX) vUv.x = 1.0 - vUv.x;\n\n      vec3 centerWorldPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n      vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n      vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n      vec2 scale;\n      scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n      scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n      vec3 offsetPos = position.xyz;\n      vec3 vertexWorldPos = centerWorldPos\n        + camRightWorld * offsetPos.x * scale.x\n        + camUpWorld * offsetPos.y * scale.y;\n\n      if (silhouette) {\n        float xSkew = -60.0 * (PI/180.0);\n        float ySkew = 0.0;\n\n        // Create a transform that will skew our texture coords\n        mat3 trans = mat3(\n          1.0       , tan(xSkew), 0.0,\n          tan(ySkew), 1.0,        0.0,\n          0.0       , 0.0,        1.0\n        );\n        float yPos = vertexWorldPos.y;\n        vertexWorldPos.y *= 0.25;\n        vertexWorldPos.xyz -= camRightWorld * yPos * 0.5;\n        vertexWorldPos.z += -0.15;\n      }\n      gl_Position = projectionMatrix * viewMatrix * vec4(vertexWorldPos, 1.0);\n    }",e.fragmentShader="\n    uniform sampler2D map;\n    uniform bool silhouette;\n    // uniform vec3 color;\n    varying vec2 vUv;\n    void main () {\n      gl_FragColor = texture2D(map, vUv);\n      if (gl_FragColor.a < 0.5) discard;\n    }\n    ",this._currentShader=e,this.userData.flipX=t}getFlipX(){return Boolean(this.userData.flipX)}setFlipX(e){e=Boolean(e),this._currentShader&&(this._currentShader.uniforms.flipX.value=e),this.userData.flipX=e}}exports.WayfinderSpriteMaterial=c;class f extends r.Mesh{constructor(){super(m,M()),this.userData.type="WayfinderSprite",this.onBeforeRender=p.bind(this),this.__onImageUpdate=this.onBeforeRender}}function p(){let e=this.scale.x;const t=this.scale.y;let r=1;if(this.material&&this.material.map&&this.material.map.image){const{width:e,height:a}=this.material.map.image;r=e/a,this.scale.x=t*r}e!==this.scale.x&&this.updateMatrix()}function d(e,t,a,i=1/0,o=!1){const s=a&&a.image?a.image.width/a.image.height:1;t.geometry=m,t.material=(0,n.createSpriteMaterial)(e),t.material.uniforms.map.value=a,t.material.uniforms.repeat.value.copy(a.repeat),t.material.uniforms.offset.value.copy(a.offset),t.material.uniforms.flip.value=o?-1:1,t.material.side=o?r.BackSide:r.FrontSide,t.material.uniforms.useMapDiscard.value=!1,t.material.uniforms.aspect.value=s,t.material.uniforms.spriteHeight.value=t.scale.y}function v(e,t){e.material.uniforms.flip.value=t?-1:1,e.material.side=t?r.BackSide:r.FrontSide}function x(e,t,r=1/0){d(e,t,t.material.uniforms&&t.material.uniforms.map?t.material.uniforms.map.value:t.material.map,r,(0,s.default)(t.material.userData.flipX,t.userData.flipX))}function h(e,t,a=1,i=1/0,n=!1){const o=new r.Mesh;return o.scale.y=a,d(e,o,t,i,n),o}function y(e,t){t.traverse(t=>{t&&t.userData&&"WayfinderSprite"===t.userData.type&&x(e,t)})}function g(t){t.geometry=m;const a=new r.Texture;t.material.map&&(a.image=t.material.map.image,a.needsUpdate=!0);const i=e({},t.material.userData);t.material=M(a),Object.assign(t.material.userData,i),t.onBeforeRender=p.bind(t),t.__onImageUpdate=t.onBeforeRender}function M(e){return new c({map:e||new r.Texture})}exports.default=f;
},{"three":74,"../tags":60,"./materials":82,"./defined":237}],307:[function(require,module,exports) {
module.exports=function(o,r){var t,e=0;for(t=0;t<o.length;t++)e+=Math.pow(o[t]-r[t],2);return e};
},{}],251:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.boundsToEdges=u,exports.boundsIntersect=c,exports.boundsInsideOther=i,exports.getBoundingCircle=d,exports.circlesIntersect=l,exports.point2DInsideBounds=f,exports.circleInsideBounds=p,exports.vertsToEdges=a,exports.boundsToVerts=x,exports.intersectLineSegmentLineSegment=g;var t=require("./math"),e=require("bound-points"),n=s(e),r=require("euclidean-distance/squared"),o=s(r);function s(t){return t&&t.__esModule?t:{default:t}}function u(t){const[e,n]=t,r=[[e[0],e[1]],[n[0],e[1]],[n[0],n[1]],[e[0],n[1]]],o=[];for(let t=0;t<r.length;t++){const e=r[t],n=r[(t+1)%r.length];o.push([e,n])}return o}function c(t,e){const[n,r]=t,[o,s]=e,[u,c]=n,[i,d]=r,[l,f]=o,[p,a]=s;return!(u>p||l>i||c>a||f>d)}function i(t,e){const[n,r]=t,[o,s]=e,u=r[0]-n[0],c=r[1]-n[1],i=n[0],d=n[1],l=s[0]-o[0],f=s[1]-o[1],p=o[0],a=o[1];return u>0&&c>0&&l>0&&f>0&&p>=i&&p+l<=i+u&&a>=d&&a+f<=d+c}function d(e,r=null){r||(r=(0,n.default)(e));const s=(0,t.lerpArray)(r[0],r[1],.5);let u=0;for(let t=0;t<e.length;t++)u=Math.max(u,(0,o.default)(e[t],s));return{center:s,radius:Math.sqrt(u)}}function l(t,e,n,r){const o=t[0]-n[0],s=t[1]-n[1],u=e+r;return o*o+s*s<=u*u}function f(t,e){const[n,r]=t,[o,s]=e;return n>=o[0]&&n<s[0]&&r>=o[1]&&r<s[1]}function p(t,e,n){const[r,o]=t,[s,u]=n;return r-e>=s[0]&&r+e<u[0]&&o-e>=s[1]&&o+e<u[1]}function a(t){const e=[];for(let n=0;n<4;n++){const r=t[n],o=t[(n+1)%t.length];e.push([r,o])}return e}function x(t){const[e,n]=t,[r,o]=e,s=n[0]-e[0],u=n[1]-e[1];return[[r,o],[r+s,o],[r+s,o+u],[r,o+u]]}function g(t,e,n,r){const o=e[0]-t[0],s=e[1]-t[1],u=r[0]-n[0],c=r[1]-n[1],i=o*c-s*u;if(0===i)return-1;const d=((t[1]-n[1])*o-(t[0]-n[0])*s)/i;if(d<0||d>1)return-1;const l=((t[1]-n[1])*u-(t[0]-n[0])*c)/i;return l<0||l>1?-1:l}
},{"./math":240,"bound-points":300,"euclidean-distance/squared":307}],553:[function(require,module,exports) {
module.exports=function(r,o,v,e){var n=r[0],t=r[1],a=!1;void 0===v&&(v=0),void 0===e&&(e=o.length);for(var d=(e-v)/2,i=0,u=d-1;i<d;u=i++){var f=o[v+2*i+0],l=o[v+2*i+1],c=o[v+2*u+0],g=o[v+2*u+1];l>t!=g>t&&n<(c-f)*(t-l)/(g-l)+f&&(a=!a)}return a};
},{}],554:[function(require,module,exports) {
module.exports=function(r,o,v,e){var n=r[0],t=r[1],a=!1;void 0===v&&(v=0),void 0===e&&(e=o.length);for(var d=e-v,i=0,u=d-1;i<d;u=i++){var f=o[i+v][0],l=o[i+v][1],c=o[u+v][0],g=o[u+v][1];l>t!=g>t&&n<(c-f)*(t-l)/(g-l)+f&&(a=!a)}return a};
},{}],298:[function(require,module,exports) {
var e=require("./flat.js"),r=require("./nested.js");module.exports=function(t,s,o,u){return s.length>0&&Array.isArray(s[0])?r(t,s,o,u):e(t,s,o,u)},module.exports.nested=r,module.exports.flat=e;
},{"./flat.js":553,"./nested.js":554}],249:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.insideWaterPolys=o,exports.getLakeObject=s;var e=require("./geometry"),n=require("point-in-polygon"),t=r(n);function r(e){return e&&e.__esModule?e:{default:e}}function o(n,r){if(!n.hasLakes)return!1;for(let o=0;o<n.lakes.length;o++){const s=n.lakes[o];if((0,e.point2DInsideBounds)(r,s.bounds)&&(0,t.default)(r,s.polygon))return!0}return!1}function s(n,r){if(!n.hasLakes)return null;for(let o=0;o<n.lakes.length;o++){const s=n.lakes[o];if((0,e.point2DInsideBounds)(r,s.bounds)&&(0,t.default)(r,s.polygon))return s}return null}
},{"./geometry":251,"point-in-polygon":298}],98:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=k;var e=require("../tags"),t=T(e),a=require("three"),i=T(a),r=require("../util/ObjectPool"),n=F(r),s=require("../util/three-util"),l=require("fast-2d-poisson-disk-sampling"),o=F(l),u=require("../util/ease-animate"),d=F(u),f=require("../util/materials"),g=require("../util/EditorWayfinderSprite"),c=require("../util/load"),m=require("./AnimationSystem"),p=require("../util/Random"),h=F(p),y=require("../util/Assets"),w=F(y),q=require("right-now"),v=F(q),x=require("eases"),D=require("../util/water-util"),M=require("../util/query-string"),S=F(M),b=require("../util/SpriteManager"),_=F(b);function F(e){return e&&e.__esModule?e:{default:e}}function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function k(e){const a=e.view(t.HaikuInInventory),r=e.findTag(t.Renderer),l=(0,h.default)(),o={sprite:!0},u=new i.Group;let c,m;u.name="haiku-flora",e.entity().add(t.Object3D,u),(0,_.default)("spritesheets/ground-flowers",r).then(e=>{c=e,m={forest:["flower-05","flower-04","flower-01"].map(e=>c.frames.find(t=>t.name===e)),grasslands:["grasslands1","grasslands2","grasslands3"].map(e=>c.frames.find(t=>t.name===e)),tundra:["tundra1","tundra3","tundra2"].map(e=>c.frames.find(t=>t.name===e)),grasslandsWater:c.frames.filter(e=>/lily/i.test(e.name))}});const p=new i.Vector3,y=[0,0],w=(e.findTag(t.UserCharacter),e.view(t.SpawnedFlora));let q=new i.Vector3,M=!1;const S=new n.default({maxCapacity:100,create(){const t=new i.Mesh((0,f.getSpriteGeometry)(),(0,f.createSpriteMaterial)(e));return t.material.userData.flipX=l.boolean(),(0,g.setMeshToSprite)(e,t,1),t.userData._entity=null,t}});let b=0;const F=()=>l.range(.1,.2);let T=F(),k=!1,O=!1;const j=e.view(t.ActiveEnvironmentState),P=e.view([t.FloatingToken,t.FloatingTokenTargetUser]),A=e.listen(t.FinalBiomeResolution),z=e.view(t.FinalBiomeResolution),C=new i.Vector2;let I=!0;return i=>{const r=e.findTag(t.WrittenStanzaLineActive),n=j.length?j[0].get(t.EnvironmentState):null;if(!n)return;const o=z.length>0;let u;if(P.length&&!o&&(u=l.pick(P).get(t.FloatingToken)),A.added.length>0&&I){I=!1,S.maxCapacity=1/0;for(let e=0;e<150;e++){const e=-60*Math.PI/180+l.range(0,300*Math.PI/180)+l.gaussian(0,1*Math.PI/180),t=Math.cos(e),a=Math.sin(e),i=6+Math.abs(l.gaussian(0,3)),r=t*i,n=a*i,s=3.5+Math.sqrt(r*r+n*n)/12.5*2+l.range(0,1);W(C.set(r,n),"grasslands",!1,!1,s,0)}}if(u&&a.length>0&&!r){if((b+=i)>=T&&(b%=T,T=F(),k=!0),M){let e=u.position2D.x-q.x,t=u.position2D.y-q.z;e*e+t*t>=1&&(O=!0)}if(k&&(O||!M)&&u.position2D.lengthSq()>100){u.position2D.toArray(y);const e=!!n&&(0,D.insideWaterPolys)(n,y);O=!1,k=!1;const t=P.length;for(let a=0;a<t;a++)W(u.position2D,n.name,e);q.x=u.position2D.x,q.y=0,q.z=u.position2D.y,M=!0}}for(let e=0;e<w.length;e++){const a=w[e],r=a.get(t.SpawnedFlora);r.time+=i;const n=Math.max(0,r.time-r.delay),l=(0,d.default)(r.time,r.duration,r.delay,r.animateDuration,x.sineOut),o=a.get(t.Object3D),u=r.height*l;o.scale.y=1*u,o.scale.x=u*r.aspect*1,o.visible=o.scale.x>=1e-5,isFinite(r.duration)&&n>=r.duration&&((0,s.detachObject)(o),a.kill(),o.userData._entity=null,S.release(o))}};function W(a,i,n,d=!0,f=0,g=1){if(!m)return;if(n&&"grasslands"!==i)return;let h=S.next();if(!h)return;h.userData._entity=e.entity();Math.abs(l.gaussian(0,1));p.set(a.x,0,a.y),l.onCircle(l.gaussian(2,.35)*g,y),h.position.x=y[0]+p.x,h.position.z=y[1]+p.z,h.position.y=n?.05:0,u.add(h),h.userData._entity.add(t.Object3D,h).add(t.SpawnedFlora).add(t.ShaderUniformTime,{uniform:h.material.uniforms.time}),n||h.userData._entity.add(t.ShadowCaster,o);const w=h.userData._entity.get(t.SpawnedFlora),q=n?.35:"grasslands"===i?1.1:1,x=Math.min(1.25,l.gaussian(.85,.5))*q;let D;if(h.visible=!1,w.height=x,"grasslands"===i&&n)D=l.pick(n?m.grasslandsWater:m[i]);else{const e=m[i];D=e[l.rangeFloor(Math.min(e.length,P.length))]}h.material.uniforms.map.value=D.texture,(0,s.shareAtlasTexture)(r,c.atlases[0],D.texture),h.material.uniforms.offset.value.copy(D.offset),h.material.uniforms.repeat.value.copy(D.repeat);const M=D.width/D.height;w.aspect=M,w.delay=f,w.duration=d?l.range(2,5):1/0,w.spawnTime=(0,v.default)()}}
},{"../tags":60,"three":74,"../util/ObjectPool":236,"../util/three-util":80,"fast-2d-poisson-disk-sampling":289,"../util/ease-animate":259,"../util/materials":82,"../util/EditorWayfinderSprite":81,"../util/load":247,"./AnimationSystem":108,"../util/Random":235,"../util/Assets":31,"right-now":223,"eases":291,"../util/water-util":249,"../util/query-string":30,"../util/SpriteManager":248}],778:[function(require,module,exports) {
module.exports=function(r,t){t||(t=[0,""]),r=String(r);var a=parseFloat(r,10);return t[0]=a,t[1]=r.match(/[\d.\-\+]*\s*(.*)/)[1]||"",t};
},{}],708:[function(require,module,exports) {
"use strict";var e=require("parse-unit");module.exports=i;var n=t("in",document.body);function r(n,r){var t=e(getComputedStyle(n).getPropertyValue(r));return t[0]*i(t[1],n)}function t(e,n){var t=document.createElement("div");t.style.height="128"+e,n.appendChild(t);var i=r(t,"height")/128;return n.removeChild(t),i}function i(u,a){if(!u)return null;switch(a=a||document.body,u=(u+""||"px").trim().toLowerCase(),a!==window&&a!==document||(a=document.body),u){case"%":return a.clientHeight/100;case"ch":case"ex":return t(u,a);case"em":return r(a,"font-size");case"rem":return r(document.body,"font-size");case"vw":return window.innerWidth/100;case"vh":return window.innerHeight/100;case"vmin":return Math.min(window.innerWidth,window.innerHeight)/100;case"vmax":return Math.max(window.innerWidth,window.innerHeight)/100;case"in":return n;case"cm":return n/2.54;case"mm":return n/25.4;case"pt":return n/72;case"pc":return n/6;case"px":return 1}var c=e(u);if(!isNaN(c[0])&&c[1]){var o=i(c[1],a);return"number"==typeof o?c[0]*o:null}return null}
},{"parse-unit":778}],290:[function(require,module,exports) {
"use strict";var e=require("to-px");function t(t,n,r){"function"==typeof t&&(r=!!n,n=t,t=window);var a=e("ex",t),i=function(e){r&&e.preventDefault();var t=e.deltaX||0,i=e.deltaY||0,d=e.deltaZ||0,o=1;switch(e.deltaMode){case 1:o=a;break;case 2:o=window.innerHeight}if(i*=o,d*=o,(t*=o)||i||d)return n(t,i,d,e)};return t.addEventListener("wheel",i),i}module.exports=t;
},{"to-px":708}],99:[function(require,module,exports) {
var process = require("process");
var e=require("process");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=m;var t=require("three"),r=d(t),o=require("../tags"),n=d(o),s=require("../util/math"),u=d(s),i=require("mouse-wheel"),a=f(i),l=require("../util/query-string"),c=f(l);function f(e){return e&&e.__esModule?e:{default:e}}function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function m(e,t){const r=e.entity("UserZoomEntity").add(n.UserZoom,t);let o,s=0;return c.default.zoom&&(o=(0,a.default)(e.findTag(n.Canvas),(e,t,r,o)=>{s+=t},!0)),{dispose(){o&&window.removeEventListener("wheel",o)},process:function(e){const t=r.get(n.UserZoom),{allowMouseZoom:o,distance:i,zoomPowFactor:a,zoomPixelsToWorld:l,zoomPowTarget:c,minDistance:f,maxDistance:d}=t;o&&(t.currentWheelOffset+=s);s=0;const m=Math.pow(i/c,a);t.distance+=t.currentWheelOffset*l*m,t.currentWheelOffset=0,t.distance=u.clamp(t.distance,f,d)}}}
},{"three":74,"../tags":60,"../util/math":240,"mouse-wheel":290,"../util/query-string":30,"process":271}],100:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=i;var e=require("../tags"),t=o(e),r=require("three"),a=o(r),n=require("../util/three-util");function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e){const r=e.findTag(t.Renderer),o=e.view(t.DebugRenderTarget),i=(e.listen(t.DebugRenderTarget),new a.OrthographicCamera),u=new a.Scene,s=new a.PlaneGeometry(1,1);return s.translate(.5,.5,0),e=>{const l=r.getSize(new a.Vector2);i.left=0,i.right=l.x,i.top=0,i.bottom=l.y,i.near=-10,i.far=10,i.updateProjectionMatrix(),(0,n.clearGroup)(u);let c=25;o.forEach((e,r)=>{const{target:n,visible:o}=e.get(t.DebugRenderTarget);if(!1===o)return;const i=150*(n.width/n.height),l=c;c+=175;const d=new a.Mesh(s,new a.MeshBasicMaterial({depthTest:!1,depthWrite:!1,map:n.texture,side:a.DoubleSide}));d.frustumCulled=!1,d.scale.set(i,-150,1),d.position.set(25,l+150,0),u.add(d)});const d=r.autoClear;r.autoClear=!1,r.render(u,i),r.autoClear=d}}
},{"../tags":60,"three":74,"../util/three-util":80}],292:[function(require,module,exports) {
var r=4,n=.001,t=1e-7,u=10,e=11,o=1/(e-1),f="function"==typeof Float32Array;function i(r,n){return 1-3*n+3*r}function a(r,n){return 3*n-6*r}function c(r){return 3*r}function v(r,n,t){return((i(n,t)*r+a(n,t))*r+c(n))*r}function l(r,n,t){return 3*i(n,t)*r*r+2*a(n,t)*r+c(n)}function w(r,n,e,o,f){var i,a,c=0;do{(i=v(a=n+(e-n)/2,o,f)-r)>0?e=a:n=a}while(Math.abs(i)>t&&++c<u);return a}function s(n,t,u,e){for(var o=0;o<r;++o){var f=l(t,u,e);if(0===f)return t;t-=(v(t,u,e)-n)/f}return t}function y(r){return r}module.exports=function(r,t,u,i){if(!(0<=r&&r<=1&&0<=u&&u<=1))throw new Error("bezier x values must be in [0, 1] range");if(r===t&&u===i)return y;for(var a=f?new Float32Array(e):new Array(e),c=0;c<e;++c)a[c]=v(c*o,r,u);return function(f){return 0===f?0:1===f?1:v(function(t){for(var f=0,i=1,c=e-1;i!==c&&a[i]<=t;++i)f+=o;var v=f+(t-a[--i])/(a[i+1]-a[i])*o,y=l(v,r,u);return y>=n?s(t,v,r,u):0===y?v:w(t,f,f+o,r,u)}(f),t,i)}};
},{}],101:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=w;var e=require("simplex-noise"),t=g(e),o=require("three"),n=f(o),i=require("../tags"),a=f(i),r=require("../util/math"),s=f(r),c=require("../util/tween-ticker"),d=g(c),p=require("bezier-easing"),l=g(p),u=require("../util/query-string"),m=g(u);function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}function g(e){return e&&e.__esModule?e:{default:e}}window.zoomLevel=1;const y=new t.default(0);function w(e){const t=e.entity("UserFollowEntity").add(a.UserFollow),o=((0,l.default)(.37,.08,0,1.01),(0,l.default)(.39,.21,.05,1.04),(0,d.default)()),i=new n.Vector3,r={animatingToTarget:!1,animatingToPlayer:!1,positionStart:new n.Vector3,positionEnd:new n.Vector3,value:0,zoom:0},c=(e.listen(a.CinematicCameraMoment),e.view(a.CameraFocusOnTarget)),p=e.listen(a.CameraFocusOnTarget);let u=!0;const f=s.degToRad(-45),g=new n.Vector3(1,1,1);g.applyAxisAngle(new n.Vector3(0,1,0),f);const w=new n.Vector3;let T=[{zoom:2.5,fov:15,near:30,far:150},{zoom:2,fov:20,near:30,far:100},{zoom:1.75,fov:25,near:20,far:100},{zoom:1.33,fov:30,near:1,far:1500}],v=T[0];m.default.zoom&&window.addEventListener("keydown",t=>{const o=t.key,n=parseInt(o,10)-1;if(n>=0&&n<T.length){const t=e.findTag(a.UserZoom);0===n&&(t.distance=t.defaultDistance),v=T[n]}});e.entity(),e.view(a.UserInPoemArea),e.view(a.UserCompletingPoem),e.entity();const x=new n.Frustum,D=new n.Matrix4;e.entity().add(a.MainCameraFrustum,x);let h=0;const z=e.findTag(a.AppState);return function(n){const d=t.get(a.UserFollow),l=e.findTag(a.UserZoom),m=l?l.distance:10,f=e.findTag(a.MainCamera),T=e.findEntity(a.UserTarget).get(a.UserTarget);if(d.shakeTime+=n*d.shakeSpeed,T.forceApplied?d.speedZoomDistance=s.damp(d.speedZoomDistance,d.maxSpeedZoomDistance,d.speedZoomSpringIn,n):d.speedZoomDistance=s.damp(d.speedZoomDistance,d.minSpeedZoomDistance,d.speedZoomSpringOut,n),u&&(d.currentDistance=m+d.speedZoomDistance,u=!1),p.added.forEach(e=>{const t=e.get(a.CameraFocusOnTarget);r.value=0,r.positionStart.copy(T.position),r.positionEnd.copy(t.target),r.animatingToTarget=!0,o.cancel(),o.to(r,{value:1,duration:2,ease:"sineInOut"}).on("complete",e=>{e.cancelling||(r.animatingToTarget=!1,r.animatingToPlayer=!1)})}),o.tick(n),c.length){c[0].get(a.CameraFocusOnTarget).target;i.copy(r.positionStart).lerp(r.positionEnd,r.value)}else i.copy(T.position);const M=Boolean(e.findTag(a.CameraZoomOut))?2:0;h=s.damp(h,M,2,n),d.currentDistance=s.damp(d.currentDistance,m+d.speedZoomDistance+h+.1*T.totalBoost,d.distanceSpring,n),f.position.copy(i),f.position.addScaledVector(g,v.zoom*d.currentDistance),d.currentTarget.copy(i),f.lookAt(i),f.position.add(w),f.fov=v.fov,f.near=v.near,f.far=v.far,f.matrixAutoUpdate=!1;const Z=d.shake,S=d.shakeTime;f.position.x+=y.noise3D(S,f.position.y,f.position.z)*Z,f.position.y+=y.noise3D(f.position.x,S,f.position.z)*Z,f.position.z+=y.noise3D(f.position.x,f.position.y,S)*Z;let C=1;const F=z.width/z.height/1.6;C=.9*s.clamp(.9*F,.85,1.5),f.zoom=C,f.updateMatrix(),f.updateMatrixWorld(),f.updateProjectionMatrix(),D.multiplyMatrices(f.projectionMatrix,f.matrixWorldInverse),x.setFromProjectionMatrix(D)}}
},{"simplex-noise":294,"three":74,"../tags":60,"../util/math":240,"../util/tween-ticker":244,"bezier-easing":292,"../util/query-string":30}],102:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t;var e=require("three"),r=n(e),o=require("../tags"),i=n(o);function n(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o]);return r.default=e,r}function t(e){e.system.info({hidden:!0});const o=e.view(i.ShaderUniformResolution),n=e.view(i.ShaderUniformTime),t=e.view(i.ShaderUniformUserTargetPosition),a=e.view(i.ShaderUniformUserCharacterPosition),f=new r.Vector2,s=(e.findTag(i.Renderer),e.findTag(i.AppState));return function(r){f.x=s.width,f.y=s.height,o.forEach(e=>{const r=e.get(i.ShaderUniformResolution);r.uniform&&r.uniform.value.set(f.x,f.y)}),n.forEach(e=>{const o=e.get(i.ShaderUniformTime);o.elapsed+=r,o.uniform&&(o.uniform.value=o.elapsed)});const u=e.findTag(i.UserTarget).position,c=e.findTag(i.UserCharacter).position;t.forEach(e=>{const r=e.get(i.ShaderUniformUserTargetPosition);r.uniform&&r.uniform.value.copy(u)}),a.forEach(e=>{const r=e.get(i.ShaderUniformUserCharacterPosition);r.uniform&&r.uniform.value.copy(c)})}}
},{"three":74,"../tags":60}],544:[function(require,module,exports) {
"use strict";function e(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,a=n.get(r);if(a)return a;if(Array.isArray(r)){var f=[];n.set(r,f);for(var o=0;o<r.length;o++)f[o]=e(r[o],t,n);return f}if(r instanceof Date)return new Date(r.valueOf());if(!(r instanceof Object))return r;var u={};n.set(r,u);for(var s=Object.keys(r),i=0;i<s.length;i++){u[t?t(s[i]):s[i]]=e(r[s[i]],t,n)}return u}function r(r){return function(t){return e(t,r)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e,exports.formatKeys=r,e.formatKeys=r;
},{}],221:[function(require,module,exports) {
module.exports=require("./lib").default;
},{"./lib":544}],35:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../tags"),t=l(e),r=require("three"),a=l(r),i=require("deep-clone"),s=o(i),n=require("../util/three-util"),u=require("../util/EditorWayfinderSprite"),d=require("../util/materials");function o(e){return e&&e.__esModule?e:{default:e}}function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}exports.default=async function(e){const r=new a.Group;return e.entity().add(t.Object3D,r),{process(e){},load:async function(i){i=(0,s.default)(i),r.traverse(e=>{e.userData._entity&&(e.userData._entity.kill(),delete e.userData._entity,(0,n.pruneUserData)(e))}),(0,n.disposeTree)(r,{textures:!0});const o=new a.ObjectLoader,l=await new Promise(e=>{o.parse(i,e)});l.traverse(r=>{if((0,n.pruneUserData)(r),r.isMesh){const a=r.isSprite||"WayfinderSprite"===r.userData.type;if(a)(0,u.setMeshToSprite)(e,r),r.userData._entity=e.entity().add(t.Object3D,r).add(t.ShaderUniformTime,{uniform:r.material.uniforms.time}).add(t.ShadowCaster,{sprite:!0});else if(r.material){const a=r.material.map,i=r.userData?r.userData.tag:null,s=!!i&&(i.includes("noshadow")||i.includes("noground"));s&&(r.material.alphaTest=.5,r.material.transparent=!0),r.material=(0,d.createMeshMaterial)(e,r,{map:a,ignoreGround:s}),r.userData._entity=e.entity().add(t.Object3D,r),s||r.userData._entity.add(t.ShadowCaster,{sprite:!1})}}}),r.add(l)}}};
},{"../tags":60,"three":74,"deep-clone":221,"../util/three-util":80,"../util/EditorWayfinderSprite":81,"../util/materials":82}],103:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=g;var e=require("../tags"),t=d(e),r=require("three"),n=d(r),i=require("../util/math"),a=d(i),s=require("../util/SpriteManager"),u=c(s),l=require("../util/load"),o=require("../util/three-util"),h=require("../util/Assets"),f=c(h);function c(e){return e&&e.__esModule?e:{default:e}}function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}const m={forest:"spritesheets/tree-anim-a",grasslands:"spritesheets/tree-anim-b",tundra:"spritesheets/tree-anim-c"};function g(e){const r=e.findTag(t.Renderer),n=e.view(t.ActiveEnvironmentState),i=e.view([t.Object3D,t.SpriteAnimation,t.SpriteAnimationOriginTreeTag]);let a,s,l=null;const o=e.view(t.EndGameState),h=e.view(t.OutroFinished);return function(e){let f;if(n.length&&(f=n[0].get(t.EnvironmentState).name)!==l&&(l=f,0===o.length&&0===h.length)){a=null;const e=m[f];(0,u.default)(e,r).then(e=>{a=e,"tundra"===f&&(s=e)})}i.forEach(e=>{const r=e.get(t.SpriteAnimation);let n=r.sheet;if(r.sheet=h.length>0?s:a,r.sheet,"tundra"===f&&(e.get(t.Object3D).position.y=-.25),r.sheet&&h.length>0){const e=r.sheet.frames.length-1,t=r.frame;r.frame=e,r.playing=!1,n===r.sheet&&t===r.frame||(r.dirty=!0)}})}}function p(e,t,r,n){if(!n&&e>=t*r)return r-1;const i=1/t*1e3,s=r;let u=t*(Math.round(1e3*e/i)*i/1e3)*1;u=a.wrap(u,0,s);let l=Math.floor(u);return l=Math.max(0,Math.min(l,r-1))}
},{"../tags":60,"three":74,"../util/math":240,"../util/SpriteManager":248,"../util/load":247,"../util/three-util":80,"../util/Assets":31}],104:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../assets/font/SilkaMono/silkamono-regularitalic-webfont.woff2"),t=c(e),r=require("../tags"),a=u(r),i=require("three"),n=u(i),l=require("../util/createPlaneSprite"),o=c(l),s=require("../util/three-util");function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function c(e){return e&&e.__esModule?e:{default:e}}async function d(){const e=new window.FontFace("SilkaMono",`url(${t.default})`,{family:"SilkaMono",style:"italic",weight:400});await e.load(),document.fonts.add(e);const r=new n.PlaneGeometry(1,1,1,1);return(e,t=32,a=0,i=0,l=!0,s=!0)=>{const u=document.createElement("canvas"),c=u.getContext("2d"),d=`italic ${t}px "SilkaMono", sans-serif`;c.font=d,c.textAlign="center",c.textBaseline="middle";const p=c.measureText(e).width,f=512/p,m=Math.round(p+5),h=Math.round(t+5);u.width=Math.round(m*f),u.height=Math.round(h*f),c.fillStyle="white",c.font=d,c.textAlign="center",c.textBaseline="middle",c.save(),c.scale(f,f),c.clearRect(0,0,m,h),c.fillStyle="white",c.fillText(e,m/2,h/2),c.restore();const y=new n.CanvasTexture(u);y.premultiplyAlpha=!1,y.needsUpdate=!0,y.generateMipmaps=!1,y.minFilter=n.LinearFilter;const x=(0,o.default)({geometry:r,map:y,rgba:!0,transparent:!0,opacity:1,depthTest:s,depthWrite:s,side:n.DoubleSide});x.renderOrder=20,x.material.uniforms.translate.value.x=a,x.material.uniforms.translate.value.y=i,x.frustumCulled=l;const w=m/h,g=.02*p;return x.scale.set(1,1/w,1).multiplyScalar(g),x}}exports.default=async function(e){e.system.info({hidden:!0});const t=e.listen(a.TextSprite3D),r=e.view(a.TextSprite3D),i=await d();return e=>{t.added.forEach(e=>{const t=e.get(a.TextSprite3D),r=i(t.text,t.fontSize,t.x,t.y,t.culling,t.depth);t.sprite=r,t.parent&&t.parent.add(t.sprite)}),t.removing.forEach(e=>{const t=e.get(a.TextSprite3D);t.sprite&&t.sprite.parent&&(0,s.detachObject)(t.sprite)}),r.forEach(e=>{const t=e.get(a.TextSprite3D);t.sprite&&(t.sprite.material.uniforms.opacity.value=t.opacity,t.sprite.material.uniforms.color.value.copy(t.color))})}};
},{"../assets/font/SilkaMono/silkamono-regularitalic-webfont.woff2":266,"../tags":60,"three":74,"../util/createPlaneSprite":238,"../util/three-util":80}],550:[function(require,module,exports) {
module.exports="#define GLSLIFY 1\nattribute vec2 offset;\nattribute float scale;\nattribute vec4 spriteCoords;\nattribute float spriteAspect;\n\nuniform bool useSpriteAtlas;\nuniform float spriteMapAspect;\n\nuniform sampler2D groundMap;\nuniform sampler2D worldDataMap;\nuniform sampler2D waterMap;\n// uniform sampler2D worldGrassMap;\n\nuniform bool worldDataMapEnabled;\nuniform float time;\nuniform float globalSpriteScale;\nuniform vec2 spriteTextureAtlasSize;\nuniform vec2 spriteTextureSize;\nuniform float spriteTextureAtlasColumns;\nuniform mat4 groundProjectionMatrix;\nuniform vec2 worldMapSize;\nuniform vec3 userTargetWorldPosition;\n\nuniform mat4 worldDataProjection;\nuniform mat4 worldDataView;\n\nvarying float vDataScale;\n\nvarying vec2 vDataUv;\nvarying vec3 vGroundColor;\n// varying float vSpriteIndex;\nvarying vec2 vUv;\nvarying vec2 vScreenUv;\nvarying vec2 vGroundUv;\nvarying vec2 vWorldUv;\nvarying vec2 vOriginalUv;\nvarying float vHighlight;\nvarying float gradientY;\nvarying vec3 vGrassColor;\n\n// #pragma glslify: noise = require('glsl-noise/simplex/3d')\n\n#define TRUE_FIXED_BLEND\n\n//returns -1.0 if x < 0, and 1.0 if x >= 0\nfloat sign01 (float x) {\n  return x < 0.0 ? -1.0 : 1.0;\n  // return step(0.0, x) * 2.0 - 1.0;\n}\n\nfloat hash(vec2 p)  // replace this by something better\n{\n  p  = 50.0*fract( p*0.3183099 + vec2(0.71,0.113));\n  return -1.0+2.0*fract( p.x*p.y*(p.x+p.y) );\n}\n\nfloat fastnoise( in vec2 p )\n{\n  vec2 i = floor( p );\n  vec2 f = fract( p );\n  vec2 u = f*f*(3.0-2.0*f);\n  return mix( mix( hash( i + vec2(0.0,0.0) ), \n                   hash( i + vec2(1.0,0.0) ), u.x),\n              mix( hash( i + vec2(0.0,1.0) ), \n                   hash( i + vec2(1.0,1.0) ), u.x), u.y);\n}\n\nfloat smoothCurve(float x)\n{\n\treturn x * x * (3.0 - 2.0 * x);\n}\n\nfloat triangleWave(float x)\n{\n\treturn abs(fract(x + 0.5) * 2.0 - 1.0);\n}\n\nfloat smoothTriangleWave(float x)\n{\n  // return sin(x);\n\treturn smoothCurve(triangleWave(x)) * 2.0 - 1.0;\n}\n\nvec2 range(vec2 vmin, vec2 vmax, vec2 value) {\n  return (value - vmin) / (vmax - vmin);\n}\n\nfloat manhattanDistance(vec2 p1, vec2 p2) {\n  float d1 = abs(p1.x - p2.x);\n  float d2 = abs(p1.y - p2.y);\n  return d1 + d2;\n}\n\nfloat insideBox(vec2 v, vec2 bottomLeft, vec2 topRight) {\n  vec2 s = step(bottomLeft, v) - step(topRight, v);\n  return s.x * s.y;\n}\n\nvec3 opCheapBend( vec3 p, float angle )\n{\n    float c = cos(angle*p.y);\n    float s = sin(angle*p.y);\n    mat2  m = mat2(c,-s,s,c);\n    return vec3(m*p.xy,p.z);\n}\n\nmat3 rotationMatrix(vec3 axis, float angle)\n{\n    axis = normalize(axis);\n    float s = sin(angle);\n    float c = cos(angle);\n    float oc = 1.0 - c;\n    \n    return mat3(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,\n                oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,\n                oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c);\n}\n\nmat3 rotation3dY(float angle) {\n  float s = sin(angle);\n  float c = cos(angle);\n\n  return mat3(\n    c, 0.0, -s,\n    0.0, 1.0, 0.0,\n    s, 0.0, c\n  );\n}\n\nmat3 rotation3dX(float angle) {\n\tfloat s = sin(angle);\n\tfloat c = cos(angle);\n\n\treturn mat3(\n\t\t1.0, 0.0, 0.0,\n\t\t0.0, c, s,\n\t\t0.0, -s, c\n\t);\n}\nmat3 rotation3dZ(float angle) {\n\tfloat s = sin(angle);\n\tfloat c = cos(angle);\n\n\treturn mat3(\n\t\tc, s, 0.0,\n\t\t-s, c, 0.0,\n\t\t0.0, 0.0, 1.0\n\t);\n}\n\nvoid main() {\n  float absScale = abs(scale);\n  vec3 offsetPos = vec3(offset.x, 0.0, offset.y);\n  vec2 spriteRepeat = useSpriteAtlas ? spriteCoords.xy : vec2(1.0);\n  vec2 spriteOffset = useSpriteAtlas ? spriteCoords.zw : vec2(0.0);\n  vec2 spriteCoord = uv;\n  if (scale < 0.0) spriteCoord.x = (1.0 - spriteCoord.x);\n  spriteCoord *= spriteRepeat;\n  spriteCoord += spriteOffset;\n  vOriginalUv = uv;\n  // if (scale < 0.0) spriteCoord.x = 1.0 - spriteCoord.x;\n  // spriteCoord.x += spriteIndex;\n  // spriteCoord.x *= 1.0 / spriteTextureAtlasColumns;\n  // if (spriteIndex < 1.5) gradientY += 0.15;\n\n  vec3 centerWorldPos = (modelMatrix * vec4(offsetPos, 1.0)).xyz;\n  vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n  vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n  vWorldUv = range(\n    -vec2(worldMapSize / 2.0),\n    vec2(worldMapSize / 2.0),\n    centerWorldPos.xz\n  );\n  vWorldUv.y = 1.0 - vWorldUv.y;\n\n  // float wdist = 0.1;\n  // float wd = distance(vWorldUv, vec2(0.5)) / wdist;\n  // float wt = 0.4;\n  // float wg = 0.1;\n  // wd = smoothstep(wt - wg, wt + wg, wd);\n  // float distFromCenter = clamp(wd, 0.0, 1.0);\n  // absScale *= distFromCenter;\n\n  float water = texture2D(waterMap, vWorldUv).r;\n  absScale *= 1.0 - water;\n\n  float wdist = 0.04;\n  float wd = distance(vWorldUv, vec2(0.5, 0.5)) / wdist;\n  float wt = 0.5;\n  float wg = 0.45;\n  wd = smoothstep(wt - wg, wt + wg, wd);\n  float distFromCenter = clamp(wd, 0.0, 1.0);\n  absScale *= distFromCenter;\n\n  // camRightWorld *= rotation3dZ(sin(time) * position.y);\n\n  \n  // vec2 centerWorldUv = range(\n  //   -vec2(worldMapSize / 2.0),\n  //   vec2(worldMapSize / 2.0),\n  //   centerWorldPos.xz\n  // );\n  // centerWorldUv.y = 1.0 - centerWorldUv.y;\n\n  // vec2 envPosInWorldPos = (centerWorldUv * 2.0 - 1.0) * worldMapSize / 2.0;\n  vec4 vDataUvPos4 = worldDataProjection * worldDataView * vec4(centerWorldPos.xz, 0.0, 1.0);\n  vec2 vDataScreen = vDataUvPos4.xy / vDataUvPos4.w;\n  vDataUv = vDataScreen.xy * 0.5 + 0.5;\n\n  // vec3 \n\n  // vec4 centerClipPos = projectionMatrix * viewMatrix * vec4(centerWorldPos, 1.0);\n  // vec2 center2D = centerClipPos.xy / centerClipPos.w;\n  // float distanceScale = manhattanDistance(center2D.xy, vec2(0.0));\n  // vec4 dataColor = texture2D(worldDataMap, centerWorldUv);\n  vec3 dCol = texture2D(worldDataMap, vDataUv).rgb;\n  // float dirAngle = (dCol.g * 2.0 - 1.0) * 3.14;\n  vec2 curDirection2D = vec2(dCol.gb) * 2.0 - 1.0;\n  vec3 curDirection = vec3(curDirection2D.x, 0.0, curDirection2D.y);\n  \n  float dScale = dCol.r;\n  // float dScale = 0.0;\n  float dataScale = 1.0 + dScale * 0.0;\n  vDataScale = dScale;\n  // float dataScale = 1.0; // green is leaf growth\n  float dataMove = 1.0;\n  \n  vec3 grassColor = vec3(1.0);\n  vGrassColor = grassColor;\n\n  // dataScale = smoothstep(1.75, 1.25, dataScale);\n  // float worldRadius = 30.0;\n  // float dataScale = 1.0 - clamp(distance(centerWorldPos, userTargetWorldPosition) / worldRadius, 0.0, 1.0);\n  // dataScale = smoothstep(0.0, 0.5, dataScale);\n  // vec3 modifiedCamUpWorld = normalize(camUpWorld + curDirection * 0.25);\n\n  // float aspect = 418.0/419.0;\n  // float aspect = spriteRepeat.x / spriteRepeat.y;\n  float aspect = useSpriteAtlas ? spriteAspect : spriteMapAspect;\n\n  float billboardSize01 = globalSpriteScale * absScale;\n  float billboardSize = dataScale * billboardSize01;\n  vec3 vertexStraightWorldPos = (centerWorldPos)\n    + camRightWorld * position.x * billboardSize * aspect\n    + camUpWorld * position.y * billboardSize;\n\n  float moveGradientY = clamp(vertexStraightWorldPos.y / 0.5, 0.0, 1.0);\n  gradientY = pow(clamp(vertexStraightWorldPos.y / 1.0, 0.0, 1.0), 1.25);\n\n  float scaleTime = time * 0.1;\n  // float noiseValue = (\n  //   smoothTriangleWave(scaleTime + centerWorldPos.x * 0.05 + centerWorldPos.z * -0.01) * 0.5 +\n  //   smoothTriangleWave(scaleTime + centerWorldPos.z * 0.05) * 0.25 + \n  //   sin(scaleTime + centerWorldPos.y * 0.1) * 0.25\n  // );\n\n  float noiseValue = 0.0;\n  noiseValue += cos(time * 2.0 + centerWorldPos.x * 0.5) * 0.33;\n  noiseValue += sin(time + centerWorldPos.z * 0.25) * 0.33;\n  noiseValue += sin(time + centerWorldPos.x * 0.25) * 0.33;\n  noiseValue = clamp(noiseValue, -1.0, 1.0);\n\n  float invDScale = 1.0;\n  camUpWorld *= rotation3dZ(noiseValue * 3.14 * 0.25 * moveGradientY * invDScale);\n\n  vec3 vertexWorldPos = (centerWorldPos)\n    + camRightWorld * position.x * billboardSize * aspect\n    + camUpWorld * position.y * billboardSize;\n  \n  // vec3 axisDirection = \n  \n  // noiseValue += sin(time * 0.75 + centerWorldPos.x * 0.2) * 0.25;\n  // noiseValue += sin(time * 0.75 + centerWorldPos.z * 0.2) * 0.25;\n  // noiseValue += sin(time * 0.85 + centerWorldPos.z * 0.2) * 0.25;\n  // noiseValue += cos(time * 0.25 + centerWorldPos.x * 0.1) * 0.25;\n  // noiseValue = smoothstep(0.2, 0.8, noiseValue * 0.5 + 0.5) * 2.0 - 1.0;\n\n  float skewValue = gradientY * noiseValue;\n  float skewScaled = skewValue * 0.25* invDScale;\n  \n  // vertexWorldPos *= rotationMatrix(vec3(0.0, 1.0, 0.0), sin(time) * 2.0);\n\n  vertexWorldPos += camRightWorld * skewScaled;\n  vertexWorldPos.xyz += curDirection * 0.1 * dScale;\n  vertexWorldPos.xyz += curDirection * gradientY * 0.66 * dScale;\n\n  // vertexWorldPos += dScale * moveGradientY * camRightWorld * curDirection.xyz * 1.0;\n  // vertexWorldPos += dScale * moveGradientY * camRightWorld * curDirection.xyz * 0.5;\n\n  vec3 vertexWorldBasePos = (centerWorldPos)\n    + camRightWorld * position.x * billboardSize * aspect\n    + camUpWorld * position.y * billboardSize;\n  \n  // vec3 vertexWorldBasePos = centerWorldPos;\n  \n\n  vec4 baseClipPos = groundProjectionMatrix * viewMatrix * vec4(vertexWorldBasePos, 1.0);\n  vec4 clipPos = projectionMatrix * viewMatrix * vec4(vertexWorldPos, 1.0);\n  vGroundUv = baseClipPos.xy / baseClipPos.w * 0.5 + 0.5;\n  // vGroundUv = clamp(vGroundUv, 0.0, 1.0);\n  vGroundColor = texture2D(groundMap, vGroundUv).rgb;\n  // vGroundUv = baseClipPos.xy / baseClipPos.w * 0.5 + 0.5;\n  // vGroundUv = floor(vGroundUv / 0.05) * 0.05;\n  \n  // if (absScale > 2.35) vGroundColor = vec3(1.0,0.0,0.0);\n  vUv = spriteCoord;\n  // if (scale < 0.0) vUv.x = 1.0 - vUv.x;\n\n  gl_Position = clipPos;\n  // vec4 mvPosition = modelViewMatrix * vec4(offsetPos, 1.0);\n  // vec2 mvScale;\n  // mvScale.x = length(modelMatrix[0].xyz);\n  // mvScale.y = length(modelMatrix[1].xyz);\n  // mvScale *= globalSpriteScale * absScale;\n  // vec2 mvOffset = mvScale * position.xy;\n\n  // vec3 worldPos = centerWorldPos;\n  // worldPos.xy += mvOffset;\n\n  // vec4 groundPoint = mvPosition;\n\n  // mvPosition.xy += mvOffset;\n  // mvPosition.x -= skewScaled * mvScale.x;\n\n  // #if defined(TRUE_BLEND)\n  // groundPoint.x += mvScale.x * position.x - skewScaled * mvScale.x;\n  // #elif defined(TRUE_FIXED_BLEND)\n  // groundPoint.x += mvScale.x * position.x;\n  // #endif\n\n  // vec4 screenPointSolid = groundProjectionMatrix * groundPoint;\n  // vGroundUv = screenPointSolid.xy / screenPointSolid.w * 0.5 + 0.5;\n  // gl_Position = projectionMatrix * mvPosition;\n\n  \n  // vec3 worldPos = \n  // const x = (u * environment.size) / 2;\n  // const z = (v * environment.size) / 2;\n  // vWorldUv = \n\n  // inverseLerp(-environment.size / 2, environment.size / 2, position.x) *\n  //         2 -\n  //       1;\n  \n  // vSpriteIndex = spriteIndex;\n  vHighlight = noiseValue * 0.5 + 0.5;\n  vScreenUv = gl_Position.xy / gl_Position.w * 0.5 + 0.5;\n}\n";
},{}],551:[function(require,module,exports) {
module.exports="#define GLSLIFY 1\nuniform sampler2D groundMap;\nuniform sampler2D worldMap;\nuniform sampler2D worldDataMap;\nuniform sampler2D spriteMap;\n\nuniform vec2 spriteTextureAtlasSize;\nuniform vec3 spriteColor;\nuniform vec3 highlightColor;\nuniform bool isSplitColor;\nuniform vec2 spriteTextureSize;\nuniform float highlightFactor;\nuniform vec2 resolution;\nuniform bool worldGrassMapEnabled;\n\nvarying vec2 vDataUv;\nvarying float vDataScale;\nvarying vec3 vGroundColor;\nvarying vec2 vUv;\nvarying vec2 vGroundUv;\nvarying vec2 vScreenUv;\nvarying vec2 vWorldUv;\nvarying vec3 vGrassColor;\nvarying float vHighlight;\nvarying vec2 vOriginalUv;\nvarying float gradientY;\n\nuniform float grassTipFactor;\n\nuniform sampler2D map;\n\nfloat luma(vec3 color) {\n  return dot(color, vec3(0.299, 0.587, 0.114));\n}\n\nfloat luma(vec4 color) {\n  return dot(color.rgb, vec3(0.299, 0.587, 0.114));\n}\n\nfloat dither8x8(vec2 position, float brightness) {\n  int x = int(mod(position.x, 8.0));\n  int y = int(mod(position.y, 8.0));\n  int index = x + y * 8;\n  float limit = 0.0;\n\n  if (x < 8) {\n    if (index == 0) limit = 0.015625;\n    if (index == 1) limit = 0.515625;\n    if (index == 2) limit = 0.140625;\n    if (index == 3) limit = 0.640625;\n    if (index == 4) limit = 0.046875;\n    if (index == 5) limit = 0.546875;\n    if (index == 6) limit = 0.171875;\n    if (index == 7) limit = 0.671875;\n    if (index == 8) limit = 0.765625;\n    if (index == 9) limit = 0.265625;\n    if (index == 10) limit = 0.890625;\n    if (index == 11) limit = 0.390625;\n    if (index == 12) limit = 0.796875;\n    if (index == 13) limit = 0.296875;\n    if (index == 14) limit = 0.921875;\n    if (index == 15) limit = 0.421875;\n    if (index == 16) limit = 0.203125;\n    if (index == 17) limit = 0.703125;\n    if (index == 18) limit = 0.078125;\n    if (index == 19) limit = 0.578125;\n    if (index == 20) limit = 0.234375;\n    if (index == 21) limit = 0.734375;\n    if (index == 22) limit = 0.109375;\n    if (index == 23) limit = 0.609375;\n    if (index == 24) limit = 0.953125;\n    if (index == 25) limit = 0.453125;\n    if (index == 26) limit = 0.828125;\n    if (index == 27) limit = 0.328125;\n    if (index == 28) limit = 0.984375;\n    if (index == 29) limit = 0.484375;\n    if (index == 30) limit = 0.859375;\n    if (index == 31) limit = 0.359375;\n    if (index == 32) limit = 0.0625;\n    if (index == 33) limit = 0.5625;\n    if (index == 34) limit = 0.1875;\n    if (index == 35) limit = 0.6875;\n    if (index == 36) limit = 0.03125;\n    if (index == 37) limit = 0.53125;\n    if (index == 38) limit = 0.15625;\n    if (index == 39) limit = 0.65625;\n    if (index == 40) limit = 0.8125;\n    if (index == 41) limit = 0.3125;\n    if (index == 42) limit = 0.9375;\n    if (index == 43) limit = 0.4375;\n    if (index == 44) limit = 0.78125;\n    if (index == 45) limit = 0.28125;\n    if (index == 46) limit = 0.90625;\n    if (index == 47) limit = 0.40625;\n    if (index == 48) limit = 0.25;\n    if (index == 49) limit = 0.75;\n    if (index == 50) limit = 0.125;\n    if (index == 51) limit = 0.625;\n    if (index == 52) limit = 0.21875;\n    if (index == 53) limit = 0.71875;\n    if (index == 54) limit = 0.09375;\n    if (index == 55) limit = 0.59375;\n    if (index == 56) limit = 1.0;\n    if (index == 57) limit = 0.5;\n    if (index == 58) limit = 0.875;\n    if (index == 59) limit = 0.375;\n    if (index == 60) limit = 0.96875;\n    if (index == 61) limit = 0.46875;\n    if (index == 62) limit = 0.84375;\n    if (index == 63) limit = 0.34375;\n  }\n\n  return brightness < limit ? 0.0 : 1.0;\n}\n\nvec3 dither8x8(vec2 position, vec3 color) {\n  return color * dither8x8(position, luma(color));\n}\n\nvec4 dither8x8(vec2 position, vec4 color) {\n  return vec4(color.rgb * dither8x8(position, luma(color)), 1.0);\n}\n\nconst mat4 thresholdMatrix = mat4(\n  vec4(1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0),\n  vec4(13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0),\n  vec4(4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0),\n  vec4(16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0)\n);\nconst mat4 _RowAccess = mat4(\n  vec4(1.0,0.0,0.0,0.0),\n  vec4(0.0,1.0,0.0,0.0),\n  vec4(0.0,0.0,1.0,0.0),\n  vec4(0.0,0.0,0.0,1.0)\n);\n\nfloat aastep(float threshold, float value) {\n  float change = fwidth(value) * 0.5;\n  float lo = threshold - change;\n  float hi = threshold + change;\n  return clamp((value - lo) / (hi - lo), 0.0, 1.0);\n}\n\n// void main () {\n//   float a = texture2D(map, vUv).r;\n//   if (a <= 0.5) discard;\n//   gl_FragColor.rgba = vec4(vec3(1.0), 1.0);\n// }\n\nvoid main () {\n  // gl_FragColor.rgba = vec4(vec3)\n  float a = texture2D(map, vUv).r;\n  if (a <= 0.5) discard;\n  // gl_FragColor.rgba = vec4(vec3(1.0), a);\n\n  float dScale = vDataScale;\n  vec3 groundColor = vGroundColor.rgb;\n  float K = pow(gradientY, 0.5);\n\n  float highlight = mix(vHighlight, 1.0, dScale);\n  gl_FragColor.rgb = mix(groundColor, groundColor * grassTipFactor, gradientY) + smoothstep(0.5, 1.0, highlight) * 0.5 * gradientY;\n  gl_FragColor.a = 1.0;\n  // gl_FragColor.rgba = clamp(gl_FragColor.rgba, 0.0, 1.0);\n  // gl_FragColor.a *= pow(gradientY, 0.1); // alpha\n}\n";
},{}],272:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GrassTileGeometry=void 0;var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};exports.default=M;var t=require("three"),r=B(t),n=require("../../tags"),i=B(n),a=require("fast-2d-poisson-disk-sampling"),s=A(a),o=require("../../util/Random"),u=A(o),l=require("../../shaders/ground-patch-instance.vert"),c=A(l),p=require("../../shaders/ground-patch-instance.frag"),d=A(p),f=require("bound-points"),h=A(f),g=require("../../util/math"),m=require("../../util/ObjectPool"),v=A(m),x=require("../../util/ShaderManager"),w=B(x),b=require("../../util/Assets"),y=A(b);function A(e){return e&&e.__esModule?e:{default:e}}function B(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}class S extends r.InstancedBufferGeometry{constructor(e={}){super();const{position:t,index:n,uv:i}=e;this._tmpVec3=new r.Vector3,this._featureCount=1/0,this.setAttribute("position",t),this.setAttribute("uv",i),this.setIndex(n)}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new r.Box3),this._computeBox3(this.boundingBox)}_computeBox3(e){const t=this.attributes.offset;if(null!=t){e.makeEmpty(),e.min.y=0,e.max.y=1;for(let r=0;r<t.count;r++){const n=t.getX(r),i=t.getY(r);n<e.min.x&&(e.min.x=n),n>e.max.x&&(e.max.x=n),i<e.min.z&&(e.min.z=i),i>e.max.z&&(e.max.z=i)}}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new r.Sphere);const e=this.attributes.offset;if(!e)return;this.computeBoundingBox();const t=this.boundingSphere.center;this.boundingBox.getCenter(t);let n=0;const i=this._tmpVec3;for(let r=0;r<e.count;r++){const a=e.getX(r),s=0,o=e.getY(r);i.set(a,s,o),n=Math.max(n,t.distanceToSquared(i))}this.boundingSphere.radius=Math.sqrt(n)}setCount(e){this.instanceCount=Math.min(this._featureCount,e)}setFeatures(e,t){this.instanceCount=e.length,this.prefix=t,this._featureCount=e.length;const n=new Float32Array(8*e.length);for(let t=0,r=0;t<e.length;t++){const i=e[t];n[r++]=i.position[0],n[r++]=i.position[1],n[r++]=(i.flip?-1:1)*i.scale,n[r++]=i.spriteCoords[0],n[r++]=i.spriteCoords[1],n[r++]=i.spriteCoords[2],n[r++]=i.spriteCoords[3],n[r++]=i.spriteAspect}const i=new r.InstancedInterleavedBuffer(n,8);this.setAttribute("offset",new r.InterleavedBufferAttribute(i,2,0)),this.setAttribute("scale",new r.InterleavedBufferAttribute(i,1,2)),this.setAttribute("spriteCoords",new r.InterleavedBufferAttribute(i,4,3)),this.setAttribute("spriteAspect",new r.InterleavedBufferAttribute(i,1,7))}}function M(t,n={}){const a=C(),o=(0,u.default)(),l=n.samples||{},p=n.sprites,f=n.groundMap,h=n.groundProjectionMatrix,m=t.findTag(i.GroundDataRenderTarget),x=t.findTag(i.RenderLayers),b=[],y=t.findEntity(i.ActiveEnvironmentState),A=y?y.get(i.EnvironmentState).name:"";for(let t=0;t<3;t++){const t=new S(e({},a)),r=q(l,A);t.setFeatures(r,A),b.push(t)}const B=o.deck(b),M=new v.default({name:"GroundPatch",initialCapacity:n.initialCapacity||0,create(){const e=B.next(),n=w.create({name:"GrassGroundPatch",transparent:!1,vertexShader:c.default,fragmentShader:d.default,extensions:{derivatives:!0},uniforms:{useSpriteAtlas:{value:!0},spriteMapAspect:{value:1},waterMap:{value:new r.Texture},map:{value:p.atlases[0]},worldMapSize:{value:new r.Vector2},worldDataMap:{value:m?m.target.texture:new r.Texture},worldDataProjection:{value:m?m.projection:new r.Matrix4},worldDataView:{value:m?m.view:new r.Matrix4},globalSpriteScale:{value:1},highlightColor:{value:new r.Color("#948059")},groundProjectionMatrix:{value:h||new r.Matrix4},grassTipFactor:{value:1.5},groundMap:{value:f||new r.Texture},time:{value:0}}}),a=new r.Mesh(e,n);return a.name="ground-patch-pool",a.userData={globalSpriteScale:1},a.layers.set(x.grass),a.userData.active=!1,a.userData.entity=t.entity().add(i.ShaderUniformTime,{uniform:n.uniforms.time}).add(i.GroundPatchInstance,a),a},renew(e){e.userData.active=!0},release(e){e.userData.active=!1},dispose(e){e.userData.entity&&(e.userData.entity.kill(),e.userData.entity=null),e.userData.active=!1}});return{setPrefix(e){b.forEach(t=>{if(t.prefix!==e){const r=q(l,e);t.setFeatures(r,e)}})},next:()=>M.next(),release:e=>M.release(e)};function q(e,t="",r){const{spriteTextureAtlasColumns:n=1}=e,i=t?p.values.filter(e=>e.type===t):p.values;return function({size:e=40,spacing:t=1,scale:r=1,tries:n=10,circular:i=!1,maxSamples:a=1e3,filter:u=!0}){return o.shuffle(new s.default({shape:[e,e],radius:t,tries:n},o.value).fill().map(t=>[t[0]-e/2,t[1]-e/2])).slice(0,a)}(e).map(e=>{const t=o.pick(i);t.width,t.height;return{flip:o.boolean(),spriteCoords:t.repeat.toArray().concat(t.offset.toArray()),spriteAspect:t.width/t.height,scale:(0,g.clamp)(o.gaussian(.66,.33),.5,1.25),position:e}}).filter(e=>e.scale>=1e-5)}}function C(){const e=new r.PlaneBufferGeometry(1,1,1,4),t=e.attributes,n=t.position.count,i=[],a=[];for(let e=0;e<n;e++){const r=t.position.getX(e),n=t.position.getY(e)+.5;i.push(r,n);const s=t.uv.getX(e),o=t.uv.getY(e);a.push(s,o)}const s=new r.BufferAttribute(new Float32Array(i),2),o=new r.BufferAttribute(new Float32Array(a),2),u=new r.BufferAttribute(e.getIndex().array,1);return e.dispose(),{position:s,uv:o,index:u}}exports.GrassTileGeometry=S;
},{"three":74,"../../tags":60,"fast-2d-poisson-disk-sampling":289,"../../util/Random":235,"../../shaders/ground-patch-instance.vert":550,"../../shaders/ground-patch-instance.frag":551,"bound-points":300,"../../util/math":240,"../../util/ObjectPool":236,"../../util/ShaderManager":243,"../../util/Assets":31}],245:[function(require,module,exports) {
"use strict";function e(e,t,n){const o=e.listen(t);let r=!1,s=!1;return a=>r||(o.added.forEach(o=>{if(r)return s||console.error("Warning: More than one EnvironmentState found on "+e.system.name),void(s=!0);const a=o.get(t);n(a),r=!0}),r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],246:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=c;var e=require("three"),t=u(e),r=require("./math"),n=require("./three-util"),i=require("./ObjectPool"),a=o(i),l=require("./array");function o(e){return e&&e.__esModule?e:{default:e}}function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}class s{constructor(){Object.defineProperty(this,"visible",{enumerable:!0,writable:!0,value:!1}),Object.defineProperty(this,"data",{enumerable:!0,writable:!0,value:null}),Object.defineProperty(this,"nearby",{enumerable:!0,writable:!0,value:null}),Object.defineProperty(this,"tile",{enumerable:!0,writable:!0,value:[0,0]})}}function c(e={}){const{size:i=30,maxCells:o=9,initialCapacity:u=9,tileHeight:c=2.5,populateTile:f=(()=>{}),releaseTile:d=((e,t)=>{(0,n.detachObject)(e)})}=e,p=new t.Group;p.name="tiling-grass-group";const b=i,x=b/2,h=Math.sqrt(9),w=(h-1)/2;let y=null;const m=new t.Box3,v=new t.Box3(new t.Vector3(-x,0,-x),new t.Vector3(x,c,x)),M=[],g=(new t.Matrix4,new t.Frustum),j=new t.Matrix4,O=new a.default({name:"TilingGridCellData",initialCapacity:u,create:()=>new s}),P=new a.default({name:"TilingGridGroup",initialCapacity:u,create:()=>new t.Group});function q(e,r,n=new t.Box3){n.copy(v);const i=C(e),a=C(r);return n.min.x+=i,n.max.x+=i,n.min.z+=a,n.max.z+=a,n}return{update:function(e,r){j.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),g.setFromProjectionMatrix(j);let n=G(r.x),i=G(r.z);null!=y&&y.x===n&&y.y===i||(y||(y=new t.Vector2),y.set(n,i));M.forEach(e=>{e.visible=!1});for(let e=0;e<h;e++)for(let t=0;t<h;t++){const r=n+(t-w),a=i+(e-w),l=M.some(e=>e.tile[0]===r&&e.tile[1]===a);q(r,a,m);const u=g.intersectsBox(m);if(!l&&u){if(M.length>=o&&_(),M.length>=o)break;const e=O.next();e.data=null,e.nearby=!0,e.visible=!0,e.tile[0]=r,e.tile[1]=a,M.push(e)}}for(let e=M.length-1;e>=0;e--){const t=M[e],[r,n]=t.tile;q(r,n,m);const i=!!t.visible||g.intersectsBox(m);if(t.nearby=Math.abs(r-y.x)<=w&&Math.abs(n-y.y)<=w,i){if(!t.data){const e=P.next();e.position.set(C(r),0,C(n)),p.add(e),t.data=e,f(e,t.tile)}}else(0,l.spliceOne)(M,e),B(t)}},group:p,cellBox:v};function B(e){e.data&&(P.release(e.data),d(e.data,e.tile),e.data=null),O.release(e)}function _(){for(let e=M.length-1;e>=0;e--){const t=M[e];if(!1===t.nearby)return M.splice(e,1),void B(t)}}function C(e){return e*b}function G(e){return Math.floor((0,r.inverseLerp)(-x,x,e))||0}}
},{"three":74,"./math":240,"./three-util":80,"./ObjectPool":236,"./array":139}],105:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../tags"),t=M(e),a=require("three"),r=M(a),i=require("./environment/createGroundPatchPool"),s=S(i),n=require("../util/waitForSingleton"),u=S(n),l=require("../util/createTilingGrid"),o=S(l),c=require("../util/three-util"),d=require("../util/load"),g=require("./AnimationSystem"),m=require("../util/SpriteManager"),p=S(m),f=require("../util/Assets"),h=S(f),v=require("../util/materials");function S(e){return e&&e.__esModule?e:{default:e}}function M(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}exports.default=async function(e){const a=e.findTag(t.Renderer),r=await(0,p.default)("spritesheets/temp_grass_sprites",a),i=e.entity().add(t.GrassEditableData),n=e.findTag(t.GroundPlaneView),u=e.view(t.GroundPatchInstance),l=e.view([t.EnvironmentState,t.ActiveEnvironmentState]);let d,g,m=null;(0,v.getEmptyTexture)();return g=(0,s.default)(e,{sprites:r,groundMap:n.target.texture,groundProjectionMatrix:n.projectionMatrix,samples:{size:40},initialCapacity:9}),d=(0,o.default)({size:40,maxCells:9,initialCapacity:9,tileHeight:2.5,populateTile:(e,t)=>{const a=g.next();e.add(a),e.userData.grass=a},releaseTile:(e,t)=>{e.userData.grass&&(g.release(e.userData.grass),e.userData.grass=null),(0,c.detachObject)(e)}}),e.entity().add(t.Object3D,d.group),function(a){const s=e.findTag(t.WorldTweens);let n,o=0;s&&(o=s[0]),l.length&&(n=l[0].get(t.EnvironmentState)),m!==n&&(m=n,g.setPrefix(n?n.name:""));const c=i.get(t.GrassEditableData),p=!c.useCustomGrass,f=c.grassScale,h=p?r.atlases[0]:c.customGrassMap;u.forEach(e=>{const a=e.get(t.GroundPatchInstance),r=1-o;let i=a.userData.globalSpriteScale;if(n&&(i*=n.grassScale,a.material.uniforms.grassTipFactor.value=n.grassTipFactor,a.material.uniforms.worldMapSize.value.set(n.data.width,n.data.height),a.material.uniforms.waterMap.value=n.waterMap,a.geometry.setCount(n.grassInstanceCount)),a.material.uniforms.globalSpriteScale.value=f*r*i,a.material.uniforms.useSpriteAtlas.value=p,a.material.uniforms.map.value=h,!p){const e=a.material.uniforms.map.value;e&&e.image&&0!==e.image.height&&(a.material.uniforms.spriteMapAspect.value=e.image.width/e.image.height)}});const v=e.findTag(t.MainCamera),S=e.findTag(t.UserTarget).position;d.update(v,S)}};
},{"../tags":60,"three":74,"./environment/createGroundPatchPool":272,"../util/waitForSingleton":245,"../util/createTilingGrid":246,"../util/three-util":80,"../util/load":247,"./AnimationSystem":108,"../util/SpriteManager":248,"../util/Assets":31,"../util/materials":82}],106:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=l;var e=require("three"),r=i(e),t=require("../tags"),a=i(t),n=require("../util/addFrameTasks");function i(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function l(e){const t=new r.WebGLRenderTarget(16,16),i=(new r.PerspectiveCamera,e.findTag(a.MainCamera)),l=e.findTag(a.MainScene),o=e.tag(a.GroundPlaneView,{camera:i,projectionMatrix:new r.Matrix4,target:t}),d=(e.findTag(a.GroundPlaneView),e.findTag(a.RenderLayers));e.entity().add(a.DebugRenderTarget,{visible:!1,target:t}),t.depthBuffer=!1,t.texture.generateMipmaps=!1,t.texture.minFilter=r.LinearFilter,t.texture.magFilter=r.LinearFilter,t.texture.wrapS=t.texture.wrapT=r.ClampToEdgeWrapping;e.view(a.GroundPlaneLayer);const u=new r.Color(0,0,0),s=new r.Color,g=e.findTag(a.Renderer);e.findTag(a.AppState);return(0,n.addPreRenderCallback)(function(){o.projectionMatrix.copy(i.projectionMatrix),i.layers.disableAll(),i.layers.enable(d.ground),i.layers.disable(d.groundDepth),s.copy(g.getClearColor()),g.setRenderTarget(t),g.setClearColor(u),g.clear(),g.render(l,i),g.setRenderTarget(null),g.setClearColor(s),i.layers.enableAll()}),function(e){const r=g.domElement,a=r.width,n=r.height;if(0===r.width||0===r.height)return;let i=a/n;t.width,t.height;const l=Math.round(128/i);128===t.width&&t.height===l||t.setSize(128,l)}}
},{"three":74,"../tags":60,"../util/addFrameTasks":140}],273:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/brush-stroke-sdf.286e9b35.png";
},{}],109:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../tags"),a=h(e),t=require("three"),n=h(t),r=require("../util/ObjectPool"),i=y(r),o=require("../util/Random"),s=y(o),l=require("../util/math"),u=h(l),g=require("../util/ShaderManager"),d=h(g),c=require("./AnimationSystem"),f=require("../assets/textures/brush-stroke-sdf.png"),p=y(f),v=require("../util/load"),D=require("../util/Assets"),m=y(D);function y(e){return e&&e.__esModule?e:{default:e}}function h(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t]);return a.default=e,a}exports.default=async function(e){const t=new n.Group;e.entity().add(a.Object3D,t);const r={forest:"image/data/ground-spawn-forest",grasslands:"image/data/ground-spawn-grasslands",tundra:"image/data/ground-spawn-tundra"},o=e.findTag(a.Renderer);let l;const g=new n.Texture,c=e.view([a.Object3D,a.GroundSpawningLeaf]),f=(e.listen(a.PoemLineTriggerActivated),new n.PlaneGeometry(1,1,5,5));f.vertices.forEach(e=>{const a=2*e.x*.5+.5;e.z=.2*Math.sin(a*Math.PI)});const p=new i.default({maxCapacity:50,initialCapacity:50,create(){const t=new n.Mesh(f,d.create({name:"SpawningLeaves",extensions:{derivatives:!0},fragmentShader:"\n            varying vec2 vUv;\n            uniform sampler2D map;\n            uniform vec3 color;\n            uniform float opacity;\n            float aastep(float threshold, float value) {\n              float change = fwidth(value) * 0.5;\n              float lo = threshold - change;\n              float hi = threshold + change;\n              return clamp((value - lo) / (hi - lo), 0.0, 1.0);\n            }\n\n            void main () {\n              float a = aastep(0.5, texture2D(map, vUv).a);\n              gl_FragColor.rgb = color;\n              if (!gl_FrontFacing) gl_FragColor.rgb *= 0.75;\n              gl_FragColor.a = 1.0;\n              // gl_FragColor.rgb *= opacity * a;\n              gl_FragColor.a = opacity * a;\n              // if (gl_FragColor.a < 0.1) discard;\n            }\n          ",vertexShader:"\n            varying vec2 vUv;\n            void main () {\n              vUv = uv;\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n            }\n          ",uniforms:{map:{value:g},opacity:{value:1},color:{value:new n.Color}},side:n.DoubleSide,transparent:!0})),r=e.entity();return r.add(a.GroundSpawningLeaf),r.add(a.TargetKeyTween,{active:!1,duration:1,ease:"expoOut",pauseOnModal:!0,target:t.userData,killEntityOnFinish:!1,assignFromOnStart:!0,key:"tween"}),t.userData.entity=r,t.userData.tween=0,t.userData.size=.1,t.userData.speed=0,t.userData.alpha=1,t.userData.velocity=new n.Vector3,t.userData.rotationAxis=new n.Vector3,t.userData.rotationSpeed=1,t.userData.rotationAngleOffset=0,t.name="spawning-leaves",t.frustumCulled=!1,t.matrixAutoUpdate=!1,t}});let v=new n.Vector3,D=!1;const y=[216],h=new n.Vector3,w=(new n.Vector3,[0,0]),S=[0,0,0],x=[0,0,0,0],b=(0,s.default)(),M=(e.findTag(a.EnvironmentState),new n.Color),T=e.findTag(a.UserCharacter),C=(e.findTag(a.UserTarget),e.view([a.ActiveEnvironmentState,a.EnvironmentState]));const O={tundra:new n.Color(206/255+.5,215/255+.5,219/255+.5)};let q=null,A=null;return function(i){const s=T.position,u=T.direction;if(!!Boolean(e.findTag(a.ModalStoppingUserMovement)))return;let d=null;if(C.length>0){d=C[0].get(a.EnvironmentState).name}let f="tundra"===d?.75:1;if(d!==q){let e=r[d];l!==e&&(l=e,m.default.loadGPUTexture(o,g,l)),A=O[d],q=d}const D=e.findTag(a.EnvironmentUnderPlayerState);if((!D||!D.water)&&C.length&&(!v||s.distanceToSquared(v)>=.25)){v||(v=new n.Vector3);const e=C[0].get(a.EnvironmentState),t=e.grid.getCellAt(s.x,s.z);t&&function(e,a,t,n,r){const i=r?b.rangeFloor(1,5):2;for(let o=0;o<i;o++)_(e,a,t,n,r)}(e,t,s,u),v.copy(s)}for(let e=0;e<c.length;e++){const n=c[e],r=n.get(a.TargetKeyTween),o=n.get(a.Object3D),s=o.userData.tween*o.userData.size*f;if(o.visible=o.userData.tween>1e-5,o.visible){o.scale.setScalar(s);const e=o.userData.tween*o.userData.alpha;o.material.uniforms.opacity.value=e,o.position.addScaledVector(o.userData.velocity,i*o.userData.speed),o.rotateOnWorldAxis(o.userData.rotationAxis,o.userData.rotationSpeed*i),o.updateMatrix()}r.finished&&o.userData.appearing&&(o.userData.appearing=!1,o.userData.killing=!0,F(o,0,o.userData.holdDelay)),r.finished&&o.userData.killing&&!o.userData.appearing&&(o.userData.killing=!1,o.userData.appearing=!1,t.remove(o),o.userData.entity.remove(a.Object3D),p.release(o))}};function _(e,n,r,i,o){let s;if(A)s=A;else if(D)s=M.setHSL(b.pick(y)/360,b.range(.45,.75),b.range(.45,.65));else{const a=e.colors[n.colorIndex%e.colors.length];s=a?a.color:null}if(!s)return;const l=p.next();if(l){l.visible=!1,t.add(l),l.userData.entity.add(a.Object3D,l),l.position.copy(r);let e=b.gaussian(1,6);b.gaussian(0,1)>0&&(e+=b.gaussian(0,4)),b.gaussian(0,1)>1&&(e+=b.gaussian(0,8)),b.insideCircle(b.range(1,1)+b.gaussian(0,2)+1*e*b.gaussian(0,2),w),l.position.x+=w[0],l.position.z+=w[1],n&&l.material.uniforms.color.value.set(s).offsetHSL(20*b.range(-1,1)/360,b.range(0,.25),b.range(0,.25)),l.quaternion.fromArray(b.quaternion(x)),l.userData.holdDelay=b.range(0,2),o||(l.position.y=Math.abs(b.gaussian(.25,1))),l.userData.appearing=!0,l.userData.killing=!1,l.userData.size=1.1*(.15+2*Math.abs(b.gaussian(0,.075))),l.userData.speed=u.clamp(Math.abs(b.gaussian(.5,.2)),.25,1),l.userData.tween=0,l.userData.velocity.set(0,1,0),l.quaternion.fromArray(b.quaternion(x)),l.userData.rotationAxis.fromArray(b.insideSphere(1,S)),l.userData.rotationSpeed=4,l.userData.rotationAngleOffset=b.range(-1,1)*Math.PI*2,l.userData.alpha=1,o?(b.insideCircle(1,w),h.x=w[0],h.y=b.range(0,0),h.z=w[1],h.addScaledVector(i,b.range(0,1)),h.normalize()):(h.copy(i),h.y+=b.range(0,.5),h.normalize()),l.userData.velocity.copy(h),F(l,1,o?0:b.range(0,0))}}function F(e,t,n){const r=e.userData.entity.get(a.TargetKeyTween);r.to=t,r.delay=n||0,r.elapsed=0,r.finished=!1,r.started=!1,r.active=!0}};
},{"../tags":60,"three":74,"../util/ObjectPool":236,"../util/Random":235,"../util/math":240,"../util/ShaderManager":243,"./AnimationSystem":108,"../assets/textures/brush-stroke-sdf.png":273,"../util/load":247,"../util/Assets":31}],110:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=y;var e=require("../tags"),a=v(e),t=require("three"),n=v(t),r=require("../util/ShaderManager"),i=v(r),o=require("../util/ObjectPool"),s=D(o),l=require("../util/Random"),u=D(l),c=require("../util/math"),g=v(c),d=require("./AnimationSystem"),p=require("../util/load"),f=require("../util/three-util");function D(e){return e&&e.__esModule?e:{default:e}}function v(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t]);return a.default=e,a}function y(e){const t=e.view([a.Object3D,a.GroundSpawningDot]),r=(e.listen(a.PoemLineTriggerActivated),(0,u.default)(175079320123)),o=new n.Group;e.entity().add(a.Object3D,o);const l=[new n.TetrahedronBufferGeometry(1,0),new n.TetrahedronBufferGeometry(1,1)],c=new n.Vector3,d=new Array(3).fill(0).map((e,a)=>{const t=new n.BufferGeometry,i=l[a%l.length],o=i.attributes.position,s=new n.Float32BufferAttribute(new Float32Array(o.array.length),3);for(let e=0;e<o.count;e++){const a=o.getX(e),t=o.getY(e),n=o.getZ(e);c.set(a,t,n);const i=c.clone().normalize(),l=c.clone().addScaledVector(i,r.gaussian(0,1/8));s.setX(e,l.x),s.setY(e,l.y),s.setZ(e,l.z)}return t.setAttribute("position",s),t.setIndex(i.getIndex()),t}),p=new s.default({maxCapacity:35,initialCapacity:35,create(){const t=i.create({name:"SpawningDots",extensions:{derivatives:!0},fragmentShader:"\n          varying vec2 vUv;\n          uniform sampler2D map;\n          uniform vec3 color;\n          uniform float opacity;\n          float aastep(float threshold, float value) {\n            float change = fwidth(value) * 0.5;\n            float lo = threshold - change;\n            float hi = threshold + change;\n            return clamp((value - lo) / (hi - lo), 0.0, 1.0);\n          }\n    \n          void main () {\n            // float a = aastep(0.5, texture2D(map, vUv).a);\n            \n            gl_FragColor.rgb = color;\n            // if (!gl_FrontFacing) gl_FragColor.rgb *= 0.75;\n            gl_FragColor.a = 1.0;\n            // gl_FragColor.rgb *= opacity * a;\n            // gl_FragColor.a = opacity * a;\n            // if (gl_FragColor.a < 0.1) discard;\n          }\n        ",vertexShader:"\n          varying vec2 vUv;\n          void main () {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n          }\n        ",uniforms:{opacity:{value:1},color:{value:new n.Color}},blending:n.AdditiveBlending}),o=new n.Mesh(r.pick(d),t),s=e.entity();return s.add(a.GroundSpawningDot),s.add(a.TargetKeyTween,{active:!1,duration:2,ease:"sineOut",pauseOnModal:!0,target:o.userData,killEntityOnFinish:!1,assignFromOnStart:!0,key:"tween"}),o.userData.entity=s,o.userData.tween=0,o.userData.size=.1,o.userData.speed=0,o.userData.alpha=1,o.userData.velocity=new n.Vector3,o.userData.rotationAxis=new n.Vector3,o.userData.rotationSpeed=1,o.userData.rotationAngleOffset=0,o.frustumCulled=!1,o.name="spawning-dots",o.matrixAutoUpdate=!1,o}}),D=new n.Vector3,v=(new n.Vector3,[0,0]),y=[0,0,0],m=[0,0,0,0],h=(new n.Color,e.findTag(a.UserTarget)),w=e.findTag(a.UserCharacter);let x=0,b=.1,S=.3,A=b;for(let e=0;e<5;e++)C(null,h.position,w.direction);const O=e.view([a.EnvironmentState,a.ActiveEnvironmentState]);return function(e){if("tundra"===(O.length?O[0].get(a.EnvironmentState).name:null))return;w.position;!function(e=0){if((x+=e)>=A){let e;x%=A,A=r.range(b,S),C(e,h.position,w.direction)}}(e);for(let n=0;n<t.length;n++){const r=t[n],i=r.get(a.TargetKeyTween),o=r.get(a.Object3D),s=o.userData.tween*o.userData.size;o.scale.setScalar(s);const l=o.userData.tween*o.userData.alpha,u=.75;o.material.uniforms.color.value.setRGB(l+u,l+u,l+u),o.material.uniforms.opacity.value=l,o.position.addScaledVector(o.userData.velocity,e*o.userData.speed),o.rotateOnWorldAxis(o.userData.rotationAxis,o.userData.rotationSpeed*e),o.visible=o.userData.tween>1e-5,o.visible&&o.updateMatrix(),i.finished&&o.userData.appearing&&(o.userData.appearing=!1,o.userData.killing=!0,q(o,0,o.userData.holdDelay)),i.finished&&o.userData.killing&&!o.userData.appearing&&(o.userData.killing=!1,o.userData.appearing=!1,o.userData.entity.remove(a.Object3D),(0,f.detachObject)(o),p.release(o))}};function C(e,a,t,n){const i=n?r.rangeFloor(1,5):1;for(let r=0;r<i;r++)_(e,a,t,n)}function _(e,t,n,i){const s=p.next();if(s){s.visible=!1,o.add(s),s.userData.entity.add(a.Object3D,s),s.position.copy(t);let e=r.gaussian(1,6);r.gaussian(0,1)>0&&(e+=r.gaussian(0,4)),r.gaussian(0,1)>1&&(e+=r.gaussian(0,8)),r.insideCircle(r.gaussian(4,2)+r.range(5,10)+r.gaussian(0,2)+1*e*r.gaussian(0,2),v),s.position.x+=v[0],s.position.z+=v[1],s.quaternion.fromArray(r.quaternion(m)),s.userData.holdDelay=r.range(0,1),s.position.y=r.range(.5,6),s.userData.appearing=!0,s.userData.killing=!1,s.userData.size=r.range(.05,.1),s.userData.speed=g.clamp(Math.abs(r.gaussian(.5,.2)),.25,1),s.userData.tween=0,s.userData.velocity.set(0,1,0),s.quaternion.fromArray(r.quaternion(m)),s.userData.rotationAxis.fromArray(r.insideSphere(1,y)),s.userData.rotationSpeed=4,s.userData.rotationAngleOffset=r.range(-1,1)*Math.PI*2,s.userData.alpha=r.range(.5,1),i?(r.insideCircle(1,v),D.x=v[0],D.y=r.range(0,0),D.z=v[1],D.addScaledVector(n,r.range(0,1)),D.normalize()):(D.copy(n),D.y+=r.range(0,.5),D.normalize()),s.userData.velocity.copy(D),q(s,1,i?0:r.range(0,1))}}function q(e,t,n){const r=e.userData.entity.get(a.TargetKeyTween);r.to=t,r.delay=n||0,r.elapsed=0,r.finished=!1,r.started=!1,r.active=!0}}
},{"../tags":60,"three":74,"../util/ShaderManager":243,"../util/ObjectPool":236,"../util/Random":235,"../util/math":240,"./AnimationSystem":108,"../util/load":247,"../util/three-util":80}],111:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=q;var e=require("three"),t=P(e),r=require("../tags"),i=P(r),a=require("../util/math"),n=P(a),o=require("../util/load"),l=require("../util/three-util"),c=require("../util/array"),d=require("eases/sine-out"),s=z(d),u=require("eases/sine-in"),p=z(u),v=require("../util/Random"),m=z(v),x=require("../util/ObjectPool"),f=z(x),g=require("../util/ShaderManager"),y=P(g),h=require("../util/Assets"),w=z(h),M=require("../util/addFrameTasks"),T=require("./AnimationSystem");function z(e){return e&&e.__esModule?e:{default:e}}function P(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}const S="image/data/soft-circle";function q(e){const r=e.findTag(i.Renderer),[a]=w.default.createGPUTextureTask(r,S),o=(0,m.default)(),d=new t.WebGLRenderTarget(256,256);d.texture.generateMipmaps=!1,d.depthBuffer=!1,d.texture.minFilter=t.LinearFilter,d.texture.magFilter=t.LinearFilter,d.texture.wrapS=d.texture.wrapT=t.ClampToEdgeWrapping,e.entity().add(i.DebugRenderTarget,{visible:!1,target:d});const u=new t.Matrix4,v=new t.Matrix4;e.entity().add(i.GroundDataRenderTarget,{target:d,projection:u,view:v});const x=new t.OrthographicCamera(-1,1,-1,1,-100,100),g=new t.Scene;new t.CylinderGeometry(.1,.1,4,8).translate(0,2,0);const h=new t.Vector3(0,0,0),z=new t.Vector3(0,0,0),P=[],q=[0,0];let C=new t.Vector3,R=!1;const W=y.create({name:"Shader-Data-Texture",uniforms:{color:{value:new t.Color},map:{value:a},opacity:{value:0}},transparent:!0,depthWrite:!1,depthTest:!1,side:t.DoubleSide,vertexShader:"\n    #include <common>\n    varying vec2 vUv;\n\n    void main () {\n      vUv = uv;\n\n      vec3 centerWorldPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n      vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n      vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n      vec2 scale;\n      scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n      scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n      vec3 offsetPos = position.xyz;\n      vec3 vertexWorldPos = centerWorldPos\n        + camRightWorld * offsetPos.x * scale.x\n        + camUpWorld * offsetPos.y * scale.y;\n\n      gl_Position = projectionMatrix * viewMatrix * vec4(vertexWorldPos, 1.0);\n    }",fragmentShader:"\n    uniform sampler2D map;\n    uniform float opacity;\n    uniform vec3 color;\n    varying vec2 vUv;\n    void main () {\n      gl_FragColor = texture2D(map, vUv) * vec4(color, opacity);\n    }\n    "}),O=new f.default({name:"ParticlePool",initialCapacity:100,create(){const e=W,r=new t.Sprite(e);return(0,l.cloneMaterial)(r),y.push(r.material),r.userData={time:0,directionX:0,directionY:0,velocity:new t.Vector3,userSpeed:0,strength:1,delay:o.range(0,.1),duration:o.range(0,2),durationIn:o.range(1.25,1.5),durationOut:1,minSize:2,size:o.range(5,7.5),alpha:0,opacity:1,active:!1},r}});let b=0,D={value:1,tweening:!1};const U=e.listen(i.FinalBiomeResolution);return(0,M.addPreRenderCallback)(function(){z.copy(r.getClearColor()),r.setRenderTarget(d),r.setClearColor(h),r.clear(),r.render(g,x),r.setRenderTarget(null),r.setClearColor(z)}),function(t){b+=t;const a=r.domElement;a.width,a.height;if(0===a.width||0===a.height)return;U.added.length>0&&(0,T.tweenTo)(e,D,"value",0,1,"sineOut");const d=e.findTag(i.UserCharacter),m=e.findTag(i.UserTarget),f=d.position,y=m.position;if(!R||C.distanceToSquared(f)>=.25){const e=O.next(),t=e.userData;t.active=!0,t.time=0,t.alpha=0,t.directionX=d.direction.x,t.directionY=d.direction.z,t.velocity.copy(d.velocity),t.userSpeed=m.totalSpeedAlpha;const r=o.insideCircle(.5,q);e.position.set(f.x,f.z,0),e.position.x+=r[0],e.position.y+=r[1],e.position.x+=1*d.direction.x,e.position.z+=1*d.direction.z,g.add(e),P.push(e),C.copy(f),R=!0}P.forEach(e=>{const r=e.userData;r.time+=t;n.mapRange(r.velocity.x,-.15,.15,0,1,!0),n.mapRange(r.velocity.z,-.15,.15,0,1,!0);const i=n.clamp(r.velocity.x,-.15,.15),a=n.clamp(r.velocity.z,-.15,.15);e.position.x+=.2*i,e.position.z+=.2*a;const o=Math.max(0,r.time-r.delay),l=r.duration+r.durationIn+r.durationOut;if(o<r.durationIn)r.alpha=(0,s.default)(n.clamp01(o/r.durationIn));else if(o>=r.durationIn+r.duration){const e=Math.max(0,o-(r.durationIn+r.duration));r.alpha=1-(0,p.default)(n.clamp01(e/r.durationOut))}else r.alpha=1;o>=l&&(r.active=!1);e.material.uniforms.color.value.setRGB(1,.5*r.directionX+.5,.5*r.directionY+.5),e.material.uniforms.opacity.value=r.alpha*r.opacity*1*D.value,e.scale.setScalar(n.lerp(r.minSize,r.size,Math.pow(r.alpha,1)))});for(let e=P.length-1;e>=0;e--)if(!P[e].userData.active){const t=P[e];O.release(t),(0,l.detachObject)(t),(0,c.spliceOne)(P,e)}x.left=-20,x.right=20,x.top=20,x.bottom=-20,x.position.set(y.x,y.z,0),x.zoom=1,x.updateProjectionMatrix(),x.updateMatrixWorld(),u.copy(x.projectionMatrix).multiply(x.matrixWorldInverse),v.identity()}}
},{"three":74,"../tags":60,"../util/math":240,"../util/load":247,"../util/three-util":80,"../util/array":139,"eases/sine-out":303,"eases/sine-in":302,"../util/Random":235,"../util/ObjectPool":236,"../util/ShaderManager":243,"../util/Assets":31,"../util/addFrameTasks":140,"./AnimationSystem":108}],559:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bird0.2b33c4ad.mp3";
},{}],560:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bird0.aebc983c.ogg";
},{}],561:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bird1.102df85d.mp3";
},{}],562:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bird1.2ea6eb0f.ogg";
},{}],563:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/birdflap.42c92436.mp3";
},{}],564:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/birdflap.bca9d582.ogg";
},{}],565:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote1.dae8577b.mp3";
},{}],566:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote1.ad320873.ogg";
},{}],567:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote2.bf137c13.mp3";
},{}],568:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote2.65216be4.ogg";
},{}],569:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote3.c4e49362.mp3";
},{}],570:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote3.99220231.ogg";
},{}],571:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote4.758e618f.mp3";
},{}],572:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote4.7f636c1b.ogg";
},{}],573:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote5.57b26648.mp3";
},{}],575:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote5.d55d6934.ogg";
},{}],574:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote6.46a01a4f.mp3";
},{}],576:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote6.62ce2a34.ogg";
},{}],577:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote7.2f2c2b89.mp3";
},{}],578:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote7.a9e37031.ogg";
},{}],579:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/butterfly.9c5a5217.mp3";
},{}],580:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/butterfly.5cd092ac.ogg";
},{}],581:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/button-click.58d8f2ae.mp3";
},{}],582:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/button-click.b3301695.ogg";
},{}],583:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/button-hover.0cbfd210.mp3";
},{}],584:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/button-hover.0327f8e8.ogg";
},{}],585:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/click.eb8924f6.mp3";
},{}],586:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/click.5523d7a5.ogg";
},{}],587:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/collect-poem.1e523306.mp3";
},{}],588:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/collect-poem.6065df3a.ogg";
},{}],589:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/collect1.48683109.mp3";
},{}],590:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/collect1.47c5e96b.ogg";
},{}],591:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fish.80ae3516.mp3";
},{}],592:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fish.57c55d28.ogg";
},{}],593:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/flash-build-up.bcf5a09f.mp3";
},{}],594:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/foxhm.9159cf29.mp3";
},{}],595:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/foxhm.86114a04.ogg";
},{}],596:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/foxpurring.d54077ff.mp3";
},{}],597:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/foxpurring.c79bc688.ogg";
},{}],598:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass-push1.92c4f455.mp3";
},{}],599:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass-push1.90e26015.ogg";
},{}],600:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass-push2.fbe31dd6.mp3";
},{}],601:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass-push2.a909c2b6.ogg";
},{}],602:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/haiku-card.6095e1d2.mp3";
},{}],603:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/haiku-card.b8e82712.ogg";
},{}],604:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ice-01.474f171a.mp3";
},{}],605:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ice-01.ab8f5cc6.ogg";
},{}],606:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ice-02.2105d29d.mp3";
},{}],607:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ice-02.0eb411a3.ogg";
},{}],608:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ice-03.d74fc6b4.mp3";
},{}],609:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ice-03.ab82571b.ogg";
},{}],610:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/journal-open.4b884b07.mp3";
},{}],611:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/journal-open.cb39f776.ogg";
},{}],612:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaves1.360be15e.mp3";
},{}],613:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaves1.8e778493.ogg";
},{}],614:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaves2.b73e976b.mp3";
},{}],615:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaves2.2a65c78c.ogg";
},{}],616:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaves3.ddf24ece.mp3";
},{}],617:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaves3.58f56eff.ogg";
},{}],618:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaves4.65c252a4.mp3";
},{}],619:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaves4.7ccf128d.ogg";
},{}],620:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/menu-open.0a7424fe.mp3";
},{}],621:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/menu-open.563310ce.ogg";
},{}],622:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/movement-forest.12ce8322.mp3";
},{}],623:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/movement-forest.34d36dbb.ogg";
},{}],624:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/music1.43b2b455.mp3";
},{}],625:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/music1.97947fef.ogg";
},{}],626:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/music2.3523742f.mp3";
},{}],627:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/music2.6fd751d0.ogg";
},{}],628:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/music3a.c186683a.mp3";
},{}],629:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/music3a.d32b82aa.ogg";
},{}],630:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/music3b.fbc73679.mp3";
},{}],631:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/music3b.85670f03.ogg";
},{}],632:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nature1.babe705c.mp3";
},{}],633:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nature1.5f7399b2.ogg";
},{}],634:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nature2-old.08a716db.mp3";
},{}],635:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nature2-old.8dddfd5c.ogg";
},{}],636:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nature2.9e444c0f.mp3";
},{}],637:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nature2.ee7ed5b3.ogg";
},{}],638:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nature3.f7e71c53.mp3";
},{}],639:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nature3.6e9b1df9.ogg";
},{}],640:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-a3.8ae5c3a7.mp3";
},{}],641:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-a3.34ec115c.ogg";
},{}],642:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-c3.504c2294.mp3";
},{}],643:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-c3.2c0f3d5a.ogg";
},{}],644:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-c4.05b9e833.mp3";
},{}],645:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-c4.6664199d.ogg";
},{}],646:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-d3.766f2294.mp3";
},{}],647:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-d3.59d31fde.ogg";
},{}],648:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-d4.90109417.mp3";
},{}],649:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-d4.1f44fd82.ogg";
},{}],650:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-e3.3c37556f.mp3";
},{}],651:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-e3.78bfa308.ogg";
},{}],652:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-g3.c4b6a9c8.mp3";
},{}],653:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-g3.f12698d9.ogg";
},{}],654:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-grasslands-a3.b2a97ede.mp3";
},{}],655:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-grasslands-a3.fc324d65.ogg";
},{}],656:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-grasslands-c3.008a9d44.mp3";
},{}],657:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-grasslands-c4.0c845624.mp3";
},{}],658:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-grasslands-d3.d6884dec.mp3";
},{}],659:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-grasslands-d4.d580540f.mp3";
},{}],660:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-grasslands-e3.840b0f5f.mp3";
},{}],661:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-grasslands-g3.5edfdddb.mp3";
},{}],662:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-tundra-a3.6003fc04.mp3";
},{}],663:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-tundra-c3.2a30be15.mp3";
},{}],664:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-tundra-c4.9f2b1c9b.mp3";
},{}],665:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-tundra-d3.a29cd60e.mp3";
},{}],666:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-tundra-d4.984e2747.mp3";
},{}],667:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-tundra-e3.3fdca88a.mp3";
},{}],668:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-tundra-g3.2b9b7bb0.mp3";
},{}],669:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/pickup.454c5988.mp3";
},{}],670:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/rain.420c385c.mp3";
},{}],671:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/reveal01.c93db7fb.mp3";
},{}],672:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/reveal02.a9726101.mp3";
},{}],673:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/score-haiku.0e232607.mp3";
},{}],675:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/score-outro.6f415f31.mp3";
},{}],674:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/score-restore.3f1d47f2.mp3";
},{}],676:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/score-start.4eaf860e.mp3";
},{}],677:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/score-transition.7b1dc589.mp3";
},{}],678:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-transition-0.a7b9c2a3.mp3";
},{}],679:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-transition-1.c08e7e28.mp3";
},{}],680:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/water-01.cbd09129.mp3";
},{}],681:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/water-02.b87ce837.mp3";
},{}],682:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/writing-01.90d3d531.mp3";
},{}],683:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/writing-02.8ce19fa0.mp3";
},{}],684:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/writing-03.9da7a0b8.mp3";
},{}],263:[function(require,module,exports) {
module.exports={bird0:{mp3:require("./bird0.mp3"),ogg:require("./bird0.ogg")},bird1:{mp3:require("./bird1.mp3"),ogg:require("./bird1.ogg")},birdflap:{mp3:require("./birdflap.mp3"),ogg:require("./birdflap.ogg")},bnote1:{mp3:require("./bnote1.mp3"),ogg:require("./bnote1.ogg")},bnote2:{mp3:require("./bnote2.mp3"),ogg:require("./bnote2.ogg")},bnote3:{mp3:require("./bnote3.mp3"),ogg:require("./bnote3.ogg")},bnote4:{mp3:require("./bnote4.mp3"),ogg:require("./bnote4.ogg")},bnote5:{mp3:require("./bnote5.mp3"),ogg:require("./bnote5.ogg")},bnote6:{mp3:require("./bnote6.mp3"),ogg:require("./bnote6.ogg")},bnote7:{mp3:require("./bnote7.mp3"),ogg:require("./bnote7.ogg")},butterfly:{mp3:require("./butterfly.mp3"),ogg:require("./butterfly.ogg")},"button-click":{mp3:require("./button-click.mp3"),ogg:require("./button-click.ogg")},"button-hover":{mp3:require("./button-hover.mp3"),ogg:require("./button-hover.ogg")},click:{mp3:require("./click.mp3"),ogg:require("./click.ogg")},"collect-poem":{mp3:require("./collect-poem.mp3"),ogg:require("./collect-poem.ogg")},collect1:{mp3:require("./collect1.mp3"),ogg:require("./collect1.ogg")},fish:{mp3:require("./fish.mp3"),ogg:require("./fish.ogg")},"flash-build-up":{mp3:require("./flash-build-up.mp3")},foxhm:{mp3:require("./foxhm.mp3"),ogg:require("./foxhm.ogg")},foxpurring:{mp3:require("./foxpurring.mp3"),ogg:require("./foxpurring.ogg")},"grass-push1":{mp3:require("./grass-push1.mp3"),ogg:require("./grass-push1.ogg")},"grass-push2":{mp3:require("./grass-push2.mp3"),ogg:require("./grass-push2.ogg")},"haiku-card":{mp3:require("./haiku-card.mp3"),ogg:require("./haiku-card.ogg")},"ice-01":{mp3:require("./ice-01.mp3"),ogg:require("./ice-01.ogg")},"ice-02":{mp3:require("./ice-02.mp3"),ogg:require("./ice-02.ogg")},"ice-03":{mp3:require("./ice-03.mp3"),ogg:require("./ice-03.ogg")},"journal-open":{mp3:require("./journal-open.mp3"),ogg:require("./journal-open.ogg")},leaves1:{mp3:require("./leaves1.mp3"),ogg:require("./leaves1.ogg")},leaves2:{mp3:require("./leaves2.mp3"),ogg:require("./leaves2.ogg")},leaves3:{mp3:require("./leaves3.mp3"),ogg:require("./leaves3.ogg")},leaves4:{mp3:require("./leaves4.mp3"),ogg:require("./leaves4.ogg")},"menu-open":{mp3:require("./menu-open.mp3"),ogg:require("./menu-open.ogg")},"movement-forest":{mp3:require("./movement-forest.mp3"),ogg:require("./movement-forest.ogg")},music1:{mp3:require("./music1.mp3"),ogg:require("./music1.ogg")},music2:{mp3:require("./music2.mp3"),ogg:require("./music2.ogg")},music3a:{mp3:require("./music3a.mp3"),ogg:require("./music3a.ogg")},music3b:{mp3:require("./music3b.mp3"),ogg:require("./music3b.ogg")},nature1:{mp3:require("./nature1.mp3"),ogg:require("./nature1.ogg")},"nature2-old":{mp3:require("./nature2-old.mp3"),ogg:require("./nature2-old.ogg")},nature2:{mp3:require("./nature2.mp3"),ogg:require("./nature2.ogg")},nature3:{mp3:require("./nature3.mp3"),ogg:require("./nature3.ogg")},"note-forest-a3":{mp3:require("./note-forest-a3.mp3"),ogg:require("./note-forest-a3.ogg")},"note-forest-c3":{mp3:require("./note-forest-c3.mp3"),ogg:require("./note-forest-c3.ogg")},"note-forest-c4":{mp3:require("./note-forest-c4.mp3"),ogg:require("./note-forest-c4.ogg")},"note-forest-d3":{mp3:require("./note-forest-d3.mp3"),ogg:require("./note-forest-d3.ogg")},"note-forest-d4":{mp3:require("./note-forest-d4.mp3"),ogg:require("./note-forest-d4.ogg")},"note-forest-e3":{mp3:require("./note-forest-e3.mp3"),ogg:require("./note-forest-e3.ogg")},"note-forest-g3":{mp3:require("./note-forest-g3.mp3"),ogg:require("./note-forest-g3.ogg")},"note-grasslands-a3":{mp3:require("./note-grasslands-a3.mp3"),ogg:require("./note-grasslands-a3.ogg")},"note-grasslands-c3":{mp3:require("./note-grasslands-c3.mp3")},"note-grasslands-c4":{mp3:require("./note-grasslands-c4.mp3")},"note-grasslands-d3":{mp3:require("./note-grasslands-d3.mp3")},"note-grasslands-d4":{mp3:require("./note-grasslands-d4.mp3")},"note-grasslands-e3":{mp3:require("./note-grasslands-e3.mp3")},"note-grasslands-g3":{mp3:require("./note-grasslands-g3.mp3")},"note-tundra-a3":{mp3:require("./note-tundra-a3.mp3")},"note-tundra-c3":{mp3:require("./note-tundra-c3.mp3")},"note-tundra-c4":{mp3:require("./note-tundra-c4.mp3")},"note-tundra-d3":{mp3:require("./note-tundra-d3.mp3")},"note-tundra-d4":{mp3:require("./note-tundra-d4.mp3")},"note-tundra-e3":{mp3:require("./note-tundra-e3.mp3")},"note-tundra-g3":{mp3:require("./note-tundra-g3.mp3")},pickup:{mp3:require("./pickup.mp3")},rain:{mp3:require("./rain.mp3")},reveal01:{mp3:require("./reveal01.mp3")},reveal02:{mp3:require("./reveal02.mp3")},"score-haiku":{mp3:require("./score-haiku.mp3")},"score-outro":{mp3:require("./score-outro.mp3")},"score-restore":{mp3:require("./score-restore.mp3")},"score-start":{mp3:require("./score-start.mp3")},"score-transition":{mp3:require("./score-transition.mp3")},"tree-transition-0":{mp3:require("./tree-transition-0.mp3")},"tree-transition-1":{mp3:require("./tree-transition-1.mp3")},"water-01":{mp3:require("./water-01.mp3")},"water-02":{mp3:require("./water-02.mp3")},"writing-01":{mp3:require("./writing-01.mp3")},"writing-02":{mp3:require("./writing-02.mp3")},"writing-03":{mp3:require("./writing-03.mp3")}};
},{"./bird0.mp3":559,"./bird0.ogg":560,"./bird1.mp3":561,"./bird1.ogg":562,"./birdflap.mp3":563,"./birdflap.ogg":564,"./bnote1.mp3":565,"./bnote1.ogg":566,"./bnote2.mp3":567,"./bnote2.ogg":568,"./bnote3.mp3":569,"./bnote3.ogg":570,"./bnote4.mp3":571,"./bnote4.ogg":572,"./bnote5.mp3":573,"./bnote5.ogg":575,"./bnote6.mp3":574,"./bnote6.ogg":576,"./bnote7.mp3":577,"./bnote7.ogg":578,"./butterfly.mp3":579,"./butterfly.ogg":580,"./button-click.mp3":581,"./button-click.ogg":582,"./button-hover.mp3":583,"./button-hover.ogg":584,"./click.mp3":585,"./click.ogg":586,"./collect-poem.mp3":587,"./collect-poem.ogg":588,"./collect1.mp3":589,"./collect1.ogg":590,"./fish.mp3":591,"./fish.ogg":592,"./flash-build-up.mp3":593,"./foxhm.mp3":594,"./foxhm.ogg":595,"./foxpurring.mp3":596,"./foxpurring.ogg":597,"./grass-push1.mp3":598,"./grass-push1.ogg":599,"./grass-push2.mp3":600,"./grass-push2.ogg":601,"./haiku-card.mp3":602,"./haiku-card.ogg":603,"./ice-01.mp3":604,"./ice-01.ogg":605,"./ice-02.mp3":606,"./ice-02.ogg":607,"./ice-03.mp3":608,"./ice-03.ogg":609,"./journal-open.mp3":610,"./journal-open.ogg":611,"./leaves1.mp3":612,"./leaves1.ogg":613,"./leaves2.mp3":614,"./leaves2.ogg":615,"./leaves3.mp3":616,"./leaves3.ogg":617,"./leaves4.mp3":618,"./leaves4.ogg":619,"./menu-open.mp3":620,"./menu-open.ogg":621,"./movement-forest.mp3":622,"./movement-forest.ogg":623,"./music1.mp3":624,"./music1.ogg":625,"./music2.mp3":626,"./music2.ogg":627,"./music3a.mp3":628,"./music3a.ogg":629,"./music3b.mp3":630,"./music3b.ogg":631,"./nature1.mp3":632,"./nature1.ogg":633,"./nature2-old.mp3":634,"./nature2-old.ogg":635,"./nature2.mp3":636,"./nature2.ogg":637,"./nature3.mp3":638,"./nature3.ogg":639,"./note-forest-a3.mp3":640,"./note-forest-a3.ogg":641,"./note-forest-c3.mp3":642,"./note-forest-c3.ogg":643,"./note-forest-c4.mp3":644,"./note-forest-c4.ogg":645,"./note-forest-d3.mp3":646,"./note-forest-d3.ogg":647,"./note-forest-d4.mp3":648,"./note-forest-d4.ogg":649,"./note-forest-e3.mp3":650,"./note-forest-e3.ogg":651,"./note-forest-g3.mp3":652,"./note-forest-g3.ogg":653,"./note-grasslands-a3.mp3":654,"./note-grasslands-a3.ogg":655,"./note-grasslands-c3.mp3":656,"./note-grasslands-c4.mp3":657,"./note-grasslands-d3.mp3":658,"./note-grasslands-d4.mp3":659,"./note-grasslands-e3.mp3":660,"./note-grasslands-g3.mp3":661,"./note-tundra-a3.mp3":662,"./note-tundra-c3.mp3":663,"./note-tundra-c4.mp3":664,"./note-tundra-d3.mp3":665,"./note-tundra-d4.mp3":666,"./note-tundra-e3.mp3":667,"./note-tundra-g3.mp3":668,"./pickup.mp3":669,"./rain.mp3":670,"./reveal01.mp3":671,"./reveal02.mp3":672,"./score-haiku.mp3":673,"./score-outro.mp3":675,"./score-restore.mp3":674,"./score-start.mp3":676,"./score-transition.mp3":677,"./tree-transition-0.mp3":678,"./tree-transition-1.mp3":679,"./water-01.mp3":680,"./water-02.mp3":681,"./writing-01.mp3":682,"./writing-02.mp3":683,"./writing-03.mp3":684}],305:[function(require,module,exports) {
var define;
var global = arguments[3];
var e,t=arguments[3];!function(){"use strict";var n=function(){this.init()};n.prototype={init:function(){var e=this||o;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||o;if(e=parseFloat(e),t.ctx||l(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,o.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var r=t._howls[n]._getSoundIds(),i=0;i<r.length;i++){var a=t._howls[n]._soundById(r[i]);a&&a._node&&(a._node.volume=a._volume*e)}return t}return t._volume},mute:function(e){var t=this||o;t.ctx||l(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,o.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var r=t._howls[n]._getSoundIds(),i=0;i<r.length;i++){var a=t._howls[n]._soundById(r[i]);a&&a._node&&(a._node.muted=!!e||a._muted)}return t},stop:function(){for(var e=this||o,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||o,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,l()),e},codecs:function(e){return(this||o)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||o;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||o,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var n=t.canPlayType("audio/mpeg;").replace(/^no$/,""),r=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),i=r&&parseInt(r[0].split("/")[1],10)<33;return e._codecs={mp3:!(i||!n&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||o;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(n){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var o=new Audio;o._unlocked=!0,e._releaseHtml5Audio(o)}catch(n){e.noAudio=!0;break}for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var i=e._howls[r]._getSoundIds(),a=0;a<i.length;a++){var s=e._howls[r]._soundById(i[a]);s&&s._node&&!s._node._unlocked&&(s._node._unlocked=!0,s._node.load())}e._autoResume();var u=e.ctx.createBufferSource();u.buffer=e._scratchBuffer,u.connect(e.ctx.destination),void 0===u.start?u.noteOn(0):u.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),u.onended=function(){u.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0);for(var n=0;n<e._howls.length;n++)e._howls[n]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),e}},_obtainHtml5Audio:function(){var e=this||o;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!=typeof Promise&&(t instanceof Promise||"function"==typeof t.then)&&t.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(e){var t=this||o;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&o.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var n=0;n<e._howls[t]._sounds.length;n++)if(!e._howls[t]._sounds[n]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}},3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&o.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then(function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var o=new n,r=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};r.prototype={init:function(e){var t=this;return o.ctx||l(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=o.usingWebAudio&&!t._html5,void 0!==o.ctx&&o.ctx&&o.autoUnlock&&o._unlockAudio(),o._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=null;if(o.noAudio)this._emit("loaderror",null,"No audio support.");else{"string"==typeof this._src&&(this._src=[this._src]);for(var t=0;t<this._src.length;t++){var n,r;if(this._format&&this._format[t])n=this._format[t];else{if("string"!=typeof(r=this._src[t])){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(n=/^data:audio\/([^;,]+);/i.exec(r))||(n=/\.([^.]+)$/.exec(r.split("?",1)[0])),n&&(n=n[1].toLowerCase())}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&o.codecs(n)){e=this._src[t];break}}if(e)return this._src=e,this._state="loading","https:"===window.location.protocol&&"http:"===e.slice(0,5)&&(this._html5=!0,this._webAudio=!1),new i(this),this._webAudio&&s(this),this;this._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var n=this,r=null;if("number"==typeof e)r=e,e=null;else{if("string"==typeof e&&"loaded"===n._state&&!n._sprite[e])return null;if(void 0===e&&(e="__default",!n._playLock)){for(var i=0,a=0;a<n._sounds.length;a++)n._sounds[a]._paused&&!n._sounds[a]._ended&&(i++,r=n._sounds[a]._id);1===i?e=null:r=null}}var s=r?n._soundById(r):n._inactiveSound();if(!s)return null;if(r&&!e&&(e=s._sprite||"__default"),"loaded"!==n._state){s._sprite=e,s._ended=!1;var u=s._id;return n._queue.push({event:"play",action:function(){n.play(u)}}),u}if(r&&!s._paused)return t||n._loadQueue("play"),s._id;n._webAudio&&o._autoResume();var d=Math.max(0,s._seek>0?s._seek:n._sprite[e][0]/1e3),_=Math.max(0,(n._sprite[e][0]+n._sprite[e][1])/1e3-d),l=1e3*_/Math.abs(s._rate),c=n._sprite[e][0]/1e3,p=(n._sprite[e][0]+n._sprite[e][1])/1e3;s._sprite=e,s._ended=!1;var f=function(){s._paused=!1,s._seek=d,s._start=c,s._stop=p,s._loop=!(!s._loop&&!n._sprite[e][2])};if(!(d>=p)){var h=s._node;if(n._webAudio){var m=function(){n._playLock=!1,f(),n._refreshBuffer(s);var e=s._muted||n._muted?0:s._volume;h.gain.setValueAtTime(e,o.ctx.currentTime),s._playStart=o.ctx.currentTime,void 0===h.bufferSource.start?s._loop?h.bufferSource.noteGrainOn(0,d,86400):h.bufferSource.noteGrainOn(0,d,_):s._loop?h.bufferSource.start(0,d,86400):h.bufferSource.start(0,d,_),l!==1/0&&(n._endTimers[s._id]=setTimeout(n._ended.bind(n,s),l)),t||setTimeout(function(){n._emit("play",s._id),n._loadQueue()},0)};"running"===o.state&&"interrupted"!==o.ctx.state?m():(n._playLock=!0,n.once("resume",m),n._clearTimer(s._id))}else{var v=function(){h.currentTime=d,h.muted=s._muted||n._muted||o._muted||h.muted,h.volume=s._volume*o.volume(),h.playbackRate=s._rate;try{var r=h.play();if(r&&"undefined"!=typeof Promise&&(r instanceof Promise||"function"==typeof r.then)?(n._playLock=!0,f(),r.then(function(){n._playLock=!1,h._unlocked=!0,t||(n._emit("play",s._id),n._loadQueue())}).catch(function(){n._playLock=!1,n._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),s._ended=!0,s._paused=!0})):t||(n._playLock=!1,f(),n._emit("play",s._id),n._loadQueue()),h.playbackRate=s._rate,h.paused)return void n._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||s._loop?n._endTimers[s._id]=setTimeout(n._ended.bind(n,s),l):(n._endTimers[s._id]=function(){n._ended(s),h.removeEventListener("ended",n._endTimers[s._id],!1)},h.addEventListener("ended",n._endTimers[s._id],!1))}catch(e){n._emit("playerror",s._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===h.src&&(h.src=n._src,h.load());var A=window&&window.ejecta||!h.readyState&&o._navigator.isCocoonJS;if(h.readyState>=3||A)v();else{n._playLock=!0;var y=function(){v(),h.removeEventListener(o._canPlayEvent,y,!1)};h.addEventListener(o._canPlayEvent,y,!1),n._clearTimer(s._id)}}return s._id}n._ended(s)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),o=0;o<n.length;o++){t._clearTimer(n[o]);var r=t._soundById(n[o]);if(r&&!r._paused&&(r._seek=t.seek(n[o]),r._rateSeek=0,r._paused=!0,t._stopFade(n[o]),r._node))if(t._webAudio){if(!r._node.bufferSource)continue;void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),t._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||t._emit("pause",r?r._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var o=n._getSoundIds(e),r=0;r<o.length;r++){n._clearTimer(o[r]);var i=n._soundById(o[r]);i&&(i._seek=i._start||0,i._rateSeek=0,i._paused=!0,i._ended=!0,n._stopFade(o[r]),i._node&&(n._webAudio?i._node.bufferSource&&(void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),n._cleanBuffer(i._node)):isNaN(i._node.duration)&&i._node.duration!==1/0||(i._node.currentTime=i._start||0,i._node.pause(),i._node.duration===1/0&&n._clearSound(i._node))),t||n._emit("stop",i._id))}return n},mute:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(e,t)}}),n;if(void 0===t){if("boolean"!=typeof e)return n._muted;n._muted=e}for(var r=n._getSoundIds(t),i=0;i<r.length;i++){var a=n._soundById(r[i]);a&&(a._muted=e,a._interval&&n._stopFade(a._id),n._webAudio&&a._node?a._node.gain.setValueAtTime(e?0:a._volume,o.ctx.currentTime):a._node&&(a._node.muted=!!o._muted||e),n._emit("mute",a._id))}return n},volume:function(){var e,t,n,r=this,i=arguments;if(0===i.length)return r._volume;if(1===i.length||2===i.length&&void 0===i[1]?r._getSoundIds().indexOf(i[0])>=0?t=parseInt(i[0],10):e=parseFloat(i[0]):i.length>=2&&(e=parseFloat(i[0]),t=parseInt(i[1],10)),!(void 0!==e&&e>=0&&e<=1))return(n=t?r._soundById(t):r._sounds[0])?n._volume:0;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,i)}}),r;void 0===t&&(r._volume=e),t=r._getSoundIds(t);for(var a=0;a<t.length;a++)(n=r._soundById(t[a]))&&(n._volume=e,i[2]||r._stopFade(t[a]),r._webAudio&&n._node&&!n._muted?n._node.gain.setValueAtTime(e,o.ctx.currentTime):n._node&&!n._muted&&(n._node.volume=e*o.volume()),r._emit("volume",n._id));return r},fade:function(e,t,n,r){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"fade",action:function(){i.fade(e,t,n,r)}}),i;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),n=parseFloat(n),i.volume(e,r);for(var a=i._getSoundIds(r),s=0;s<a.length;s++){var u=i._soundById(a[s]);if(u){if(r||i._stopFade(a[s]),i._webAudio&&!u._muted){var d=o.ctx.currentTime,_=d+n/1e3;u._volume=e,u._node.gain.setValueAtTime(e,d),u._node.gain.linearRampToValueAtTime(t,_)}i._startFadeInterval(u,e,t,n,a[s],void 0===r)}}return i},_startFadeInterval:function(e,t,n,o,r,i){var a=this,s=t,u=n-t,d=Math.abs(u/.01),_=Math.max(4,d>0?o/d:o),l=Date.now();e._fadeTo=n,e._interval=setInterval(function(){var r=(Date.now()-l)/o;l=Date.now(),s+=u*r,s=Math.round(100*s)/100,s=u<0?Math.max(n,s):Math.min(n,s),a._webAudio?e._volume=s:a.volume(s,e._id,!0),i&&(a._volume=s),(n<t&&s<=n||n>t&&s>=n)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,a.volume(n,e._id),a._emit("fade",e._id))},_)},_stopFade:function(e){var t=this._soundById(e);return t&&t._interval&&(this._webAudio&&t._node.gain.cancelScheduledValues(o.ctx.currentTime),clearInterval(t._interval),t._interval=null,this.volume(t._fadeTo,e),t._fadeTo=null,this._emit("fade",e)),this},loop:function(){var e,t,n,o=arguments;if(0===o.length)return this._loop;if(1===o.length){if("boolean"!=typeof o[0])return!!(n=this._soundById(parseInt(o[0],10)))&&n._loop;e=o[0],this._loop=e}else 2===o.length&&(e=o[0],t=parseInt(o[1],10));for(var r=this._getSoundIds(t),i=0;i<r.length;i++)(n=this._soundById(r[i]))&&(n._loop=e,this._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop)));return this},rate:function(){var e,t,n,r=this,i=arguments;if(0===i.length)t=r._sounds[0]._id;else if(1===i.length){r._getSoundIds().indexOf(i[0])>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if("number"!=typeof e)return(n=r._soundById(t))?n._rate:r._rate;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,i)}}),r;void 0===t&&(r._rate=e),t=r._getSoundIds(t);for(var a=0;a<t.length;a++)if(n=r._soundById(t[a])){r.playing(t[a])&&(n._rateSeek=r.seek(t[a]),n._playStart=r._webAudio?o.ctx.currentTime:n._playStart),n._rate=e,r._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(e,o.ctx.currentTime):n._node&&(n._node.playbackRate=e);var s=r.seek(t[a]),u=1e3*((r._sprite[n._sprite][0]+r._sprite[n._sprite][1])/1e3-s)/Math.abs(n._rate);!r._endTimers[t[a]]&&n._paused||(r._clearTimer(t[a]),r._endTimers[t[a]]=setTimeout(r._ended.bind(r,n),u)),r._emit("rate",n._id)}return r},seek:function(){var e,t,n=this,r=arguments;if(0===r.length)t=n._sounds[0]._id;else if(1===r.length){n._getSoundIds().indexOf(r[0])>=0?t=parseInt(r[0],10):n._sounds.length&&(t=n._sounds[0]._id,e=parseFloat(r[0]))}else 2===r.length&&(e=parseFloat(r[0]),t=parseInt(r[1],10));if(void 0===t)return n;if("number"==typeof e&&("loaded"!==n._state||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,r)}}),n;var i=n._soundById(t);if(i){if(!("number"==typeof e&&e>=0)){if(n._webAudio){var a=n.playing(t)?o.ctx.currentTime-i._playStart:0,s=i._rateSeek?i._rateSeek-i._seek:0;return i._seek+(s+a*Math.abs(i._rate))}return i._node.currentTime}var u=n.playing(t);u&&n.pause(t,!0),i._seek=e,i._ended=!1,n._clearTimer(t),n._webAudio||!i._node||isNaN(i._node.duration)||(i._node.currentTime=e);var d=function(){n._emit("seek",t),u&&n.play(t,!0)};if(u&&!n._webAudio){var _=function(){n._playLock?setTimeout(_,0):d()};setTimeout(_,0)}else d()}return n},playing:function(e){if("number"==typeof e){var t=this._soundById(e);return!!t&&!t._paused}for(var n=0;n<this._sounds.length;n++)if(!this._sounds[n]._paused)return!0;return!1},duration:function(e){var t=this._duration,n=this._soundById(e);return n&&(t=this._sprite[n._sprite][1]/1e3),t},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,n=0;n<t.length;n++)t[n]._paused||e.stop(t[n]._id),e._webAudio||(e._clearSound(t[n]._node),t[n]._node.removeEventListener("error",t[n]._errorFn,!1),t[n]._node.removeEventListener(o._canPlayEvent,t[n]._loadFn,!1),t[n]._node.removeEventListener("ended",t[n]._endFn,!1),o._releaseHtml5Audio(t[n]._node)),delete t[n]._node,e._clearTimer(t[n]._id);var r=o._howls.indexOf(e);r>=0&&o._howls.splice(r,1);var i=!0;for(n=0;n<o._howls.length;n++)if(o._howls[n]._src===e._src||e._src.indexOf(o._howls[n]._src)>=0){i=!1;break}return a&&i&&delete a[e._src],o.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,o){var r=this["_on"+e];return"function"==typeof t&&r.push(o?{id:n,fn:t,once:o}:{id:n,fn:t}),this},off:function(e,t,n){var o=this["_on"+e],r=0;if("number"==typeof t&&(n=t,t=null),t||n)for(r=0;r<o.length;r++){var i=n===o[r].id;if(t===o[r].fn&&i||!t&&i){o.splice(r,1);break}}else if(e)this["_on"+e]=[];else{var a=Object.keys(this);for(r=0;r<a.length;r++)0===a[r].indexOf("_on")&&Array.isArray(this[a[r]])&&(this[a[r]]=[])}return this},once:function(e,t,n){return this.on(e,t,n,1),this},_emit:function(e,t,n){for(var o=this["_on"+e],r=o.length-1;r>=0;r--)o[r].id&&o[r].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(this,o[r].fn),0),o[r].once&&this.off(e,o[r].fn,o[r].id));return this._loadQueue(e),this},_loadQueue:function(e){if(this._queue.length>0){var t=this._queue[0];t.event===e&&(this._queue.shift(),this._loadQueue()),e||t.action()}return this},_ended:function(e){var t=e._sprite;if(!this._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(this._ended.bind(this,e),100),this;var n=!(!e._loop&&!this._sprite[t][2]);if(this._emit("end",e._id),!this._webAudio&&n&&this.stop(e._id,!0).play(e._id),this._webAudio&&n){this._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=o.ctx.currentTime;var r=1e3*(e._stop-e._start)/Math.abs(e._rate);this._endTimers[e._id]=setTimeout(this._ended.bind(this,e),r)}return this._webAudio&&!n&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,this._clearTimer(e._id),this._cleanBuffer(e._node),o._autoSuspend()),this._webAudio||n||this.stop(e._id,!0),this},_clearTimer:function(e){if(this._endTimers[e]){if("function"!=typeof this._endTimers[e])clearTimeout(this._endTimers[e]);else{var t=this._soundById(e);t&&t._node&&t._node.removeEventListener("ended",this._endTimers[e],!1)}delete this._endTimers[e]}return this},_soundById:function(e){for(var t=0;t<this._sounds.length;t++)if(e===this._sounds[t]._id)return this._sounds[t];return null},_inactiveSound:function(){this._drain();for(var e=0;e<this._sounds.length;e++)if(this._sounds[e]._ended)return this._sounds[e].reset();return new i(this)},_drain:function(){var e=this._pool,t=0,n=0;if(!(this._sounds.length<e)){for(n=0;n<this._sounds.length;n++)this._sounds[n]._ended&&t++;for(n=this._sounds.length-1;n>=0;n--){if(t<=e)return;this._sounds[n]._ended&&(this._webAudio&&this._sounds[n]._node&&this._sounds[n]._node.disconnect(0),this._sounds.splice(n,1),t--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],n=0;n<this._sounds.length;n++)t.push(this._sounds[n]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=o.ctx.createBufferSource(),e._node.bufferSource.buffer=a[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,o.ctx.currentTime),this},_cleanBuffer:function(e){var t=o._navigator&&o._navigator.vendor.indexOf("Apple")>=0;if(o._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=o._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(o._navigator&&o._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var i=function(e){this._parent=e,this.init()};i.prototype={init:function(){var e=this._parent;return this._muted=e._muted,this._loop=e._loop,this._volume=e._volume,this._rate=e._rate,this._seek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++o._counter,e._sounds.push(this),this.create(),this},create:function(){var e=this._parent,t=o._muted||this._muted||this._parent._muted?0:this._volume;return e._webAudio?(this._node=void 0===o.ctx.createGain?o.ctx.createGainNode():o.ctx.createGain(),this._node.gain.setValueAtTime(t,o.ctx.currentTime),this._node.paused=!0,this._node.connect(o.masterGain)):o.noAudio||(this._node=o._obtainHtml5Audio(),this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(o._canPlayEvent,this._loadFn,!1),this._endFn=this._endListener.bind(this),this._node.addEventListener("ended",this._endFn,!1),this._node.src=e._src,this._node.preload=!0===e._preload?"auto":e._preload,this._node.volume=t*o.volume(),this._node.load()),this},reset:function(){var e=this._parent;return this._muted=e._muted,this._loop=e._loop,this._volume=e._volume,this._rate=e._rate,this._seek=0,this._rateSeek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++o._counter,this},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0),this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var e=this._parent;e._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),this._node.removeEventListener(o._canPlayEvent,this._loadFn,!1)},_endListener:function(){var e=this._parent;e._duration===1/0&&(e._duration=Math.ceil(10*this._node.duration)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=1e3*e._duration),e._ended(this)),this._node.removeEventListener("ended",this._endFn,!1)}};var a={},s=function(e){var t=e._src;if(a[t])return e._duration=a[t].duration,void _(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),o=new Uint8Array(n.length),r=0;r<n.length;++r)o[r]=n.charCodeAt(r);d(o.buffer,e)}else{var i=new XMLHttpRequest;i.open(e._xhr.method,t,!0),i.withCredentials=e._xhr.withCredentials,i.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach(function(t){i.setRequestHeader(t,e._xhr.headers[t])}),i.onload=function(){var t=(i.status+"")[0];"0"===t||"2"===t||"3"===t?d(i.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+i.status+".")},i.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete a[t],e.load())},u(i)}},u=function(e){try{e.send()}catch(t){e.onerror()}},d=function(e,t){var n=function(){t._emit("loaderror",null,"Decoding audio data failed.")},r=function(e){e&&t._sounds.length>0?(a[t._src]=e,_(t,e)):n()};"undefined"!=typeof Promise&&1===o.ctx.decodeAudioData.length?o.ctx.decodeAudioData(e).then(r).catch(n):o.ctx.decodeAudioData(e,r,n)},_=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},l=function(){if(o.usingWebAudio){try{"undefined"!=typeof AudioContext?o.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?o.ctx=new webkitAudioContext:o.usingWebAudio=!1}catch(e){o.usingWebAudio=!1}o.ctx||(o.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(o._navigator&&o._navigator.platform),t=o._navigator&&o._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=t?parseInt(t[1],10):null;if(e&&n&&n<9){var r=/safari/.test(o._navigator&&o._navigator.userAgent.toLowerCase());o._navigator&&!r&&(o.usingWebAudio=!1)}o.usingWebAudio&&(o.masterGain=void 0===o.ctx.createGain?o.ctx.createGainNode():o.ctx.createGain(),o.masterGain.gain.setValueAtTime(o._muted?0:o._volume,o.ctx.currentTime),o.masterGain.connect(o.ctx.destination)),o._setup()}};"function"==typeof e&&e.amd&&e([],function(){return{Howler:o,Howl:r}}),"undefined"!=typeof exports&&(exports.Howler=o,exports.Howl=r),void 0!==t?(t.HowlerGlobal=n,t.Howler=o,t.Howl=r,t.Sound=i):"undefined"!=typeof window&&(window.HowlerGlobal=n,window.Howler=o,window.Howl=r,window.Sound=i)}(),function(){"use strict";var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){if(!this.ctx||!this.ctx.listener)return this;for(var t=this._howls.length-1;t>=0;t--)this._howls[t].stereo(e);return this},HowlerGlobal.prototype.pos=function(e,t,n){return this.ctx&&this.ctx.listener?(t="number"!=typeof t?this._pos[1]:t,n="number"!=typeof n?this._pos[2]:n,"number"!=typeof e?this._pos:(this._pos=[e,t,n],void 0!==this.ctx.listener.positionX?(this.ctx.listener.positionX.setTargetAtTime(this._pos[0],Howler.ctx.currentTime,.1),this.ctx.listener.positionY.setTargetAtTime(this._pos[1],Howler.ctx.currentTime,.1),this.ctx.listener.positionZ.setTargetAtTime(this._pos[2],Howler.ctx.currentTime,.1)):this.ctx.listener.setPosition(this._pos[0],this._pos[1],this._pos[2]),this)):this},HowlerGlobal.prototype.orientation=function(e,t,n,o,r,i){if(!this.ctx||!this.ctx.listener)return this;var a=this._orientation;return t="number"!=typeof t?a[1]:t,n="number"!=typeof n?a[2]:n,o="number"!=typeof o?a[3]:o,r="number"!=typeof r?a[4]:r,i="number"!=typeof i?a[5]:i,"number"!=typeof e?a:(this._orientation=[e,t,n,o,r,i],void 0!==this.ctx.listener.forwardX?(this.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),this.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),this.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),this.ctx.listener.upX.setTargetAtTime(o,Howler.ctx.currentTime,.1),this.ctx.listener.upY.setTargetAtTime(r,Howler.ctx.currentTime,.1),this.ctx.listener.upZ.setTargetAtTime(i,Howler.ctx.currentTime,.1)):this.ctx.listener.setOrientation(e,t,n,o,r,i),this)},Howl.prototype.init=(e=Howl.prototype.init,function(t){return this._orientation=t.orientation||[1,0,0],this._stereo=t.stereo||null,this._pos=t.pos||null,this._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},this._onstereo=t.onstereo?[{fn:t.onstereo}]:[],this._onpos=t.onpos?[{fn:t.onpos}]:[],this._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,n){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"stereo",action:function(){o.stereo(e,n)}}),o;var r=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===n){if("number"!=typeof e)return o._stereo;o._stereo=e,o._pos=[e,0,0]}for(var i=o._getSoundIds(n),a=0;a<i.length;a++){var s=o._soundById(i[a]);if(s){if("number"!=typeof e)return s._stereo;s._stereo=e,s._pos=[e,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",s._panner&&s._panner.pan||t(s,r),"spatial"===r?void 0!==s._panner.positionX?(s._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),s._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),s._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):s._panner.setPosition(e,0,0):s._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),o._emit("stereo",s._id)}}return o},Howl.prototype.pos=function(e,n,o,r){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"pos",action:function(){i.pos(e,n,o,r)}}),i;if(n="number"!=typeof n?0:n,o="number"!=typeof o?-.5:o,void 0===r){if("number"!=typeof e)return i._pos;i._pos=[e,n,o]}for(var a=i._getSoundIds(r),s=0;s<a.length;s++){var u=i._soundById(a[s]);if(u){if("number"!=typeof e)return u._pos;u._pos=[e,n,o],u._node&&(u._panner&&!u._panner.pan||t(u,"spatial"),void 0!==u._panner.positionX?(u._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),u._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),u._panner.positionZ.setValueAtTime(o,Howler.ctx.currentTime)):u._panner.setPosition(e,n,o)),i._emit("pos",u._id)}}return i},Howl.prototype.orientation=function(e,n,o,r){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"orientation",action:function(){i.orientation(e,n,o,r)}}),i;if(n="number"!=typeof n?i._orientation[1]:n,o="number"!=typeof o?i._orientation[2]:o,void 0===r){if("number"!=typeof e)return i._orientation;i._orientation=[e,n,o]}for(var a=i._getSoundIds(r),s=0;s<a.length;s++){var u=i._soundById(a[s]);if(u){if("number"!=typeof e)return u._orientation;u._orientation=[e,n,o],u._node&&(u._panner||(u._pos||(u._pos=i._pos||[0,0,-.5]),t(u,"spatial")),void 0!==u._panner.orientationX?(u._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),u._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),u._panner.orientationZ.setValueAtTime(o,Howler.ctx.currentTime)):u._panner.setOrientation(e,n,o)),i._emit("orientation",u._id)}}return i},Howl.prototype.pannerAttr=function(){var e,n,o,r=arguments;if(!this._webAudio)return this;if(0===r.length)return this._pannerAttr;if(1===r.length){if("object"!=typeof r[0])return(o=this._soundById(parseInt(r[0],10)))?o._pannerAttr:this._pannerAttr;e=r[0],void 0===n&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),this._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:this._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:this._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:this._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:this._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:this._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:this._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:this._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:this._panningModel})}else 2===r.length&&(e=r[0],n=parseInt(r[1],10));for(var i=this._getSoundIds(n),a=0;a<i.length;a++)if(o=this._soundById(i[a])){var s=o._pannerAttr;s={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:s.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:s.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:s.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:s.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:s.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:s.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:s.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:s.panningModel};var u=o._panner;u?(u.coneInnerAngle=s.coneInnerAngle,u.coneOuterAngle=s.coneOuterAngle,u.coneOuterGain=s.coneOuterGain,u.distanceModel=s.distanceModel,u.maxDistance=s.maxDistance,u.refDistance=s.refDistance,u.rolloffFactor=s.rolloffFactor,u.panningModel=s.panningModel):(o._pos||(o._pos=this._pos||[0,0,-.5]),t(o,"spatial"))}return this},Sound.prototype.init=function(e){return function(){var t=this._parent;this._orientation=t._orientation,this._stereo=t._stereo,this._pos=t._pos,this._pannerAttr=t._pannerAttr,e.call(this),this._stereo?t.stereo(this._stereo):this._pos&&t.pos(this._pos[0],this._pos[1],this._pos[2],this._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this._parent;return this._orientation=t._orientation,this._stereo=t._stereo,this._pos=t._pos,this._pannerAttr=t._pannerAttr,this._stereo?t.stereo(this._stereo):this._pos?t.pos(this._pos[0],this._pos[1],this._pos[2],this._id):this._panner&&(this._panner.disconnect(0),this._panner=void 0,t._refreshBuffer(this)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}();
},{}],858:[function(require,module,exports) {
module.exports={"audio/midi":["mid","midi","kar","rmi"],"audio/mp4":["mp4a","m4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx"],"audio/webm":["weba"],"audio/x-matroska":["mka"],"audio/x-mpegurl":["m3u"],"audio/wav":["wav"],"video/3gpp":["3gp"],"video/3gpp2":["3g2"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"],"video/x-f4v":["f4v"],"video/x-fli":["fli"],"video/x-flv":["flv"],"video/x-m4v":["m4v"],"video/x-matroska":["mkv","mk3d","mks"]};
},{}],851:[function(require,module,exports) {
var e=require("./mime-types.json"),r={};Object.keys(e).forEach(function(n){e[n].forEach(function(e){r[e]=n})}),module.exports=function(e){if(!e)throw new TypeError("must specify extension string");return 0===e.indexOf(".")&&(e=e.substring(1)),r[e.toLowerCase()]};
},{"./mime-types.json":858}],820:[function(require,module,exports) {
var e,r=require("browser-media-mime-type");function t(t){if(!t)throw new TypeError("src cannot be empty");var n;if("function"==typeof t.getAttribute)n=t.getAttribute("type");else if("string"==typeof t){var i=o(t);i&&(n=r(i))}else n=t.type;if(!n)return!0;e||(e=new window.Audio);var a=e.canPlayType(n).replace(/no/,"");return Boolean(a)}function n(e){var r=new Error("This browser does not support any of the following sources:\n    "+e.join(", ")+"\nTry using an array of OGG, MP3 and WAV.");return r.type="AUDIO_FORMAT",r}function o(e){var r=e.lastIndexOf(".");if(!(r<=0||r===e.length-1))return e.substring(r+1)}module.exports=t,module.exports.createError=n;
},{"browser-media-mime-type":851}],821:[function(require,module,exports) {
function o(){return new(window.AudioContext||window.webkitAudioContext)}module.exports=o;
},{}],870:[function(require,module,exports) {
var global = arguments[3];
var e,d=arguments[3];e="undefined"!=typeof window?window:void 0!==d?d:"undefined"!=typeof self?self:{},module.exports=e;
},{}],868:[function(require,module,exports) {
module.exports=t;var o=Object.prototype.toString;function t(t){if(!t)return!1;var n=o.call(t);return"[object Function]"===n||"function"==typeof t&&"[object RegExp]"!==n||"undefined"!=typeof window&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)}
},{}],869:[function(require,module,exports) {
var r=function(r){return r.replace(/^\s+|\s+$/g,"")},e=function(r){return"[object Array]"===Object.prototype.toString.call(r)};module.exports=function(t){if(!t)return{};for(var n={},o=r(t).split("\n"),i=0;i<o.length;i++){var c=o[i],u=c.indexOf(":"),l=r(c.slice(0,u)).toLowerCase(),s=r(c.slice(u+1));void 0===n[l]?n[l]=s:e(n[l])?n[l].push(s):n[l]=[n[l],s]}return n};
},{}],871:[function(require,module,exports) {
module.exports=o;var r=Object.prototype.hasOwnProperty;function o(){for(var o={},t=0;t<arguments.length;t++){var e=arguments[t];for(var a in e)r.call(e,a)&&(o[a]=e[a])}return o}
},{}],863:[function(require,module,exports) {
"use strict";var e=require("global/window"),t=require("is-function"),r=require("parse-headers"),n=require("xtend");function o(e,t){for(var r=0;r<e.length;r++)t(e[r])}function s(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function u(e,r,o){var s=e;return t(r)?(o=r,"string"==typeof e&&(s={uri:e})):s=n(r,{uri:e}),s.callback=o,s}function a(e,t,r){return i(t=u(e,t,r))}function i(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,n=function(r,n,o){t||(t=!0,e.callback(r,n,o))};function o(e){return clearTimeout(l),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,n(e,R)}function u(){if(!p){var t;clearTimeout(l),t=e.useXDR&&void 0===c.status?200:1223===c.status?204:c.status;var o=R,s=null;return 0!==t?(o={body:function(){var e=void 0;if(e=c.response?c.response:c.responseText||d(c),q)try{e=JSON.parse(e)}catch(e){}return e}(),statusCode:t,method:h,headers:{},url:f,rawRequest:c},c.getAllResponseHeaders&&(o.headers=r(c.getAllResponseHeaders()))):s=new Error("Internal XMLHttpRequest Error"),n(s,o,o.body)}}var i,p,c=e.xhr||null;c||(c=e.cors||e.useXDR?new a.XDomainRequest:new a.XMLHttpRequest);var l,f=c.url=e.uri||e.url,h=c.method=e.method||"GET",m=e.body||e.data,y=c.headers=e.headers||{},w=!!e.sync,q=!1,R={body:void 0,headers:{},statusCode:0,method:h,url:f,rawRequest:c};if("json"in e&&!1!==e.json&&(q=!0,y.accept||y.Accept||(y.Accept="application/json"),"GET"!==h&&"HEAD"!==h&&(y["content-type"]||y["Content-Type"]||(y["Content-Type"]="application/json"),m=JSON.stringify(!0===e.json?m:e.json))),c.onreadystatechange=function(){4===c.readyState&&setTimeout(u,0)},c.onload=u,c.onerror=o,c.onprogress=function(){},c.onabort=function(){p=!0},c.ontimeout=o,c.open(h,f,!w,e.username,e.password),w||(c.withCredentials=!!e.withCredentials),!w&&e.timeout>0&&(l=setTimeout(function(){if(!p){p=!0,c.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",o(e)}},e.timeout)),c.setRequestHeader)for(i in y)y.hasOwnProperty(i)&&c.setRequestHeader(i,y[i]);else if(e.headers&&!s(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(c.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(c),c.send(m||null),c}function d(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}function p(){}module.exports=a,module.exports.default=a,a.XMLHttpRequest=e.XMLHttpRequest||p,a.XDomainRequest="withCredentials"in new a.XMLHttpRequest?a.XMLHttpRequest:e.XDomainRequest,o(["get","put","post","patch","head","delete"],function(e){a["delete"===e?"del":e]=function(t,r,n){return(r=u(t,r,n)).method=e.toUpperCase(),i(r)}});
},{"global/window":870,"is-function":868,"parse-headers":869,"xtend":871}],862:[function(require,module,exports) {
var e=require("events").EventEmitter;function t(t){var n=new e,a=!1;if(t.attachEvent)return t.attachEvent("onreadystatechange",o),n;function r(e){var t=e.lengthComputable?e.loaded/e.total:0;a||n.emit("data",t,e.total||null),a=1===t}function o(e){("load"===e.type||/^(ready|complete)$/g.test((e.currentTarget||e.srcElement).readyState))&&(a||(t.removeEventListener?(t.removeEventListener("load",o,!1),t.removeEventListener("progress",r,!1)):t.detatchEvent&&t.detatchEvent("onreadystatechange",o),n.emit("data",1,e.total||null),n.emit("done"),a=!0))}return t.addEventListener("load",o,!1),t.addEventListener("progress",r,!1),n}module.exports=t;
},{"events":824}],822:[function(require,module,exports) {
var r=require("xhr"),e=require("xhr-progress");function o(o,t,n,u,a){var i=r({uri:t,responseType:"arraybuffer"},function(r,e,u){if(/^2/.test(e.statusCode)||(r=new Error("status code "+e.statusCode+" requesting "+t)),r)return n(r);!function(r){a(),o.decodeAudioData(r,function(r){n(null,r)},function(){var r=new Error("Error decoding audio data");r.type="DECODE_AUDIO_DATA",n(r)})}(u)});e(i).on("data",function(r,e){u(r,e)})}module.exports=o;
},{"xhr":863,"xhr-progress":862}],823:[function(require,module,exports) {
module.exports=function(e){"suspended"===e.state&&"function"==typeof e.resume&&e.resume()};
},{}],685:[function(require,module,exports) {
var process = require("process");
var e=require("process"),n=require("./can-play-src"),r=require("./audio-context"),t=require("./xhr-audio"),o=require("events").EventEmitter,u=require("right-now"),i=require("./resume-context");function c(c,f){f=f||{};var a,l,s,p=new o,m=f.context||r(),d=m.createGain(),b=null,g=null,v=0,y=!1,x=f.loop;p.play=function(){if(!y){y=!0,!1!==f.autoResume&&i(p.context),S(),(a=m.createBufferSource()).connect(p.node),a.onended=A,l&&(a.buffer=l),x&&(a.loop=!0,"number"==typeof f.loopStart&&(a.loopStart=f.loopStart),"number"==typeof f.loopEnd&&(a.loopEnd=f.loopEnd)),s&&v>s&&(v%=s);var e=v;a.start(0,e),b=u()}},p.pause=function(){y&&(y=!1,a.onended=null,a.stop(0),g=u(),v+=(g-b)/1e3)},p.stop=function(){p.pause(),A()},p.dispose=function(){S(),l=null},p.node=d,p.context=m,Object.defineProperties(p,{duration:{enumerable:!0,configurable:!0,get:function(){return s}},playing:{enumerable:!0,configurable:!0,get:function(){return y}},buffer:{enumerable:!0,configurable:!0,get:function(){return l}},volume:{enumerable:!0,configurable:!0,get:function(){return d.gain.value},set:function(e){d.gain.value=e}}}),"number"==typeof f.volume&&(p.volume=f.volume);var q=Array.isArray(c)?c:[c];if((q=q.filter(Boolean)).some(n)){var E=q.filter(n)[0];"function"==typeof E.getAttribute?E=E.getAttribute("src"):"string"==typeof E.src&&(E=E.src),function(e){t(m,e,function(e,n){if(e)return p.emit("error",e);l=n,a&&(a.buffer=l),s=l.duration,d.buffer=l,p.emit("load")},function(e,n){p.emit("progress",e,n)},function(){p.emit("decoding")})}(E)}else e.nextTick(function(){p.emit("error",n.createError(q))});return p;function A(){p.emit("end"),y=!1,v=0}function S(){a&&a.disconnect()}}module.exports=c;
},{"./can-play-src":820,"./audio-context":821,"./xhr-audio":822,"events":824,"right-now":223,"./resume-context":823,"process":271}],857:[function(require,module,exports) {
"use strict";module.exports=function(t){return"object"==typeof t&&null!==t};
},{}],856:[function(require,module,exports) {
"use strict";module.exports=function(r){if(null==r)return!1;var t=Object(r);return t===t.window};
},{}],850:[function(require,module,exports) {
var e=require("is-object"),o=require("is-window");function n(n){return!(!e(n)||!o(window)||"function"!=typeof window.Node)&&("number"==typeof n.nodeType&&"string"==typeof n.nodeName)}module.exports=n;
},{"is-object":857,"is-window":856}],828:[function(require,module,exports) {
var t=require("is-dom"),e=require("browser-media-mime-type");function r(t,e,r){r=r||{},Array.isArray(e)||(e=[e]);var u=r.element||document.createElement(t);return r.loop&&u.setAttribute("loop","loop"),r.muted&&u.setAttribute("muted","muted"),r.autoplay&&u.setAttribute("autoplay","autoplay"),r.controls&&u.setAttribute("controls","controls"),r.crossOrigin&&u.setAttribute("crossorigin",r.crossOrigin),r.preload&&u.setAttribute("preload",r.preload),r.poster&&u.setAttribute("poster",r.poster),void 0!==r.volume&&u.setAttribute("volume",r.volume),(e=e.filter(Boolean)).forEach(function(t){u.appendChild(o(t))}),u}function o(r){if(t(r))return r;if("string"==typeof r&&(r={src:r}).src){var o=u(r.src);o&&(r.type=e(o))}var i=document.createElement("source");return r.src&&i.setAttribute("src",r.src),r.type&&i.setAttribute("type",r.type),i}function u(t){var e=t.lastIndexOf(".");return e<=0||e===t.length-1?null:t.substring(e+1)}module.exports.video=r.bind(null,"video"),module.exports.audio=r.bind(null,"audio");
},{"is-dom":850,"browser-media-mime-type":851}],829:[function(require,module,exports) {
"use strict";var r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,e=Object.prototype.propertyIsEnumerable;function n(r){if(null==r)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(r)}function o(){try{if(!Object.assign)return!1;var r=new String("abc");if(r[5]="de","5"===Object.getOwnPropertyNames(r)[0])return!1;for(var t={},e=0;e<10;e++)t["_"+String.fromCharCode(e)]=e;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(r){return t[r]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(r){n[r]=r}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(r){return!1}}module.exports=o()?Object.assign:function(o,c){for(var a,i,s=n(o),f=1;f<arguments.length;f++){for(var u in a=Object(arguments[f]))t.call(a,u)&&(s[u]=a[u]);if(r){i=r(a);for(var b=0;b<i.length;b++)e.call(a,i[b])&&(s[i[b]]=a[i[b]])}}return s};
},{}],827:[function(require,module,exports) {
function e(e,n,t){e.addEventListener(n,function o(i){e.removeEventListener(n,o,!1),t(i,e)},!1)}module.exports=e;
},{}],686:[function(require,module,exports) {
var process = require("process");
var e=require("process"),r=require("events").EventEmitter,n=require("simple-media-element").audio,t=require("object-assign"),o=require("./resume-context"),i=require("./audio-context"),u=require("./can-play-src"),a=require("./event-add-once");function c(c,l){l=t({},l);var m=new r;l.element||(l.element=new window.Audio);var d=l.volume;delete l.volume;var s=n(c,l),f=l.context||i(),p=f.createGain();f.createMediaElementSource(s).connect(p),s.addEventListener("ended",function(){m.emit("end")});var v=l.loopStart,g=l.loopEnd,y="number"==typeof v&&isFinite(v),b="number"==typeof g&&isFinite(g),E=!1;(y||b)&&window.requestAnimationFrame(function e(){if("number"==typeof s.duration){var r=s.currentTime,n=b?Math.min(s.duration,g):s.duration;r>(v||0)&&(E=!0),y&&E&&r<v&&(s.currentTime=v),r>=n&&b&&(s.currentTime=y?v:0),window.requestAnimationFrame(e)}}),m.element=s,m.context=f,m.node=p,m.pause=s.pause.bind(s),m.play=function(){return!1!==l.autoResume&&o(m.context),s.play()},m.dispose=function(){},m.stop=function(){var e=m.playing;s.pause(),s.currentTime=0,E=!1,e&&m.emit("end")},Object.defineProperties(m,{duration:{enumerable:!0,configurable:!0,get:function(){return s.duration}},currentTime:{enumerable:!0,configurable:!0,get:function(){return s.currentTime}},playing:{enumerable:!0,configurable:!0,get:function(){return!s.paused}},volume:{enumerable:!0,configurable:!0,get:function(){return p.gain.value},set:function(e){p.gain.value=e}}}),"number"==typeof d&&(m.volume=d);var w=Array.isArray(c)?c:[c];return(w=w.filter(Boolean)).some(u)?function(){var r=Array.prototype.slice.call(s.children),n=r.length,t=!1,o=function(e,i){t||(n--,console.warn("Error loading source: "+i.getAttribute("src")),n<=0&&(t=!0,r.forEach(function(e){e.removeEventListener("error",o,!1)}),m.emit("error",new Error("Could not play any of the supplied sources"))))},i=function(){m.emit("load")};s.readyState>=s.HAVE_ENOUGH_DATA?e.nextTick(i):(a(s,"canplay",i),a(s,"error",function(e){m.emit(new Error("Unknown error while loading <audio>"))}),r.forEach(function(e){a(e,"error",o)}));s.load()}():e.nextTick(function(){m.emit("error",u.createError(w))}),m}module.exports=c;
},{"events":824,"simple-media-element":828,"object-assign":829,"./resume-context":823,"./audio-context":821,"./can-play-src":820,"./event-add-once":827,"process":271}],304:[function(require,module,exports) {
var r=require("./lib/buffer-source"),e=require("./lib/media-source");function u(u,i){if(!u)throw new TypeError("must specify a src parameter");return(i=i||{}).buffer?r(u,i):e(u,i)}module.exports=u;
},{"./lib/buffer-source":685,"./lib/media-source":686}],112:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e};exports.default=j;var t=require("../tags"),o=S(t),r=require("three"),n=S(r),i=require("../util/math"),s=S(i),a=require("../assets/audio/*.{mp3,ogg}"),l=H(a),u=require("../util/documentVisibility"),d=H(u),c=require("howler"),p=require("web-audio-player"),g=H(p),m=require("../util/Random"),f=H(m),v=require("right-now"),y=H(v),h=require("../util/addFrameTasks"),w=require("../util/query-string"),q=H(w),T=require("../config"),A=H(T),b=require("../util/stores");function H(e){return e&&e.__esModule?e:{default:e}}function S(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}const k=Boolean((0,A.default)().native),E=!1,C=k,O=!0,x=!1,U={volume:.6};Object.keys(l.default).forEach(e=>{const{mp3:t,ogg:o}=l.default[e],r=[t].filter(Boolean);l.default[e]=r});const I=window.AudioContext||window.webkitAudioContext,B=e=>{if("suspended"===e.state&&"function"==typeof e.resume)return e.resume()};function j(t){if(!I)return void console.log("No audio context, audio system skipped");const r=t.view([o.WillTriggerAudio,o.Object3D]),i=t.findTag(o.InputGestureEmitter);/(iOS|iPad|iPod|iPhone)/i.test(navigator.userAgent);b.audioState.subscribe(({muted:e,visible:t})=>{const o=e||!t;c.Howler.mute(o)});const s=t.listen(o.OriginTreeIntroSequenceStarted),a=(0,f.default)();let u=!1;const d=t.listen(o.CollectTokenOrb),p=["a3","c3","c4","d3","d4","e3","g3"],g=a.deck(p),m={},v={forest:{biome:"forest",musicId:"music1",natureId:"nature1"},grasslands:{biome:"grasslands",musicId:"music2",natureId:"nature2"},tundra:{biome:"tundra",musicId:q.default.musicA?"music3a":"music3b",natureId:"nature3"}},y=function(r){const n=r.map(({query:o,envelope:r,assets:n,options:i,condition:s,deck:u=!1,removing:d=!1})=>{const p=t.listen(o),g=e({},U,i),m=!1!==g.preload,f=n.map(t=>{const o=l.default[t],r=new c.Howl(e({},g,{src:o,autoplay:!1,preload:m}));return r});let v=m;return{deck:u?a.deck(f):null,query:o,removing:d,condition:s,players:f,load(){v||(v=!0,f.forEach(e=>e.load()))},listener:p}});return{listeners:n,update(e=0){const r=!t.findTag(o.HideCharacter)&&!t.findTag(o.AnimateOutCharacter);n.forEach(e=>{const{listener:t,needsCharacter:o=!0,condition:n,players:s,removing:a=!1}=e,l=a?t.removing:t.added;if(t.changed&&l.length>0){if(o&&!r)return;n?l.forEach(t=>{n(t,e)&&i(e)}):i(e)}})}};function i(e){e.load();const t=e.deck?e.deck.next():a.pick(e.players);t.play()}}([{query:o.CollectedToken,assets:["writing-01","writing-02","writing-03"],options:{volume:.5}},{query:o.HaikuCardSaved,assets:["haiku-card"]},{query:o.HaikuCardShown,assets:["score-haiku"],options:{volume:1}},{query:o.UserHitAudioTrigger,condition:e=>{return"tree"===e.get(o.UserHitAudioTrigger).type},options:{volume:.5,allowMultiple:!0},assets:["leaves1","leaves2","leaves3","leaves4"]},{needsCharacter:!1,query:o.TriggerTreeTransitionAudio,options:{volume:.5,preload:!1},assets:["tree-transition-0"]},!x&&{query:o.UserHitAudioTrigger,condition:e=>{return"ice"===e.get(o.UserHitAudioTrigger).type},options:{volume:.5,allowMultiple:!1,preload:!1,playthrough:!0},assets:["ice-01","ice-02","ice-03"]},!x&&{query:o.UserHitAudioTrigger,condition:e=>{return"water"===e.get(o.UserHitAudioTrigger).type},envelope:{attack:.2,sustain:1,volume:[.4,.75],release:.5,delay:0},options:{volume:.5,preload:!1,allowMultiple:!0},assets:["water-01","water-02"]},!x&&{query:o.UserHitAudioTrigger,condition:e=>{return"leaf"===e.get(o.UserHitAudioTrigger).type},envelope:{attack:.2,sustain:.1,volume:[.4,.75],release:.5,delay:0},options:{volume:.11,preload:!1,allowMultiple:!0},assets:["grass-push1","grass-push2"]},{query:o.WaitingForBiomeResolution,assets:["collect-poem"],options:{preload:!1}},!x&&{query:o.HatTipWindLineSound,condition:e=>a.chance(.5),assets:["movement-forest"],options:{volume:.2,allowMultiple:!0}},{query:o.TutorialBarrenGround,removing:!0,assets:["score-start"],options:{volume:1}},{query:o.TokenIsCollecting,assets:["reveal01"],options:{volume:1}},{query:o.CompassVisible,assets:["reveal02"],options:{volume:.75}},{query:o.ButtonClick,assets:["click"],options:{volume:.75,preload:!0}},{query:o.JournalOpen,assets:["journal-open"],options:{volume:.5,preload:!1}},{query:o.AnimalSound,condition:e=>"fish"===e.get(o.AnimalSound),assets:["fish"],options:{volume:.45,preload:!1}},{query:o.AnimalSound,condition:e=>a.chance(.5)&&"birdChirp"===e.get(o.AnimalSound),assets:["bird0"],options:{volume:.4,preload:!1}},{query:o.AnimalSound,condition:e=>"birdFlap"===e.get(o.AnimalSound),assets:["birdflap"],options:{volume:.25,preload:!1}},{query:o.AnimalSound,condition:e=>"butterfly"===e.get(o.AnimalSound),assets:["butterfly"],options:{volume:1,preload:!1}},{needsCharacter:!1,query:o.ShowBiomeResolution,assets:["score-restore"],options:{volume:1,preload:!1}},{query:o.TransitionToNextBiome,condition:e=>!0,assets:["score-transition"],options:{volume:1,preload:!1}},{query:o.EndGameState,assets:["score-outro"],options:{volume:1,preload:!1}},,{query:o.FlashSound,assets:["flash-build-up"],options:{volume:.25,preload:!1}}].filter(Boolean)),w=new n.Vector2,T=new n.Vector3,A=new n.Vector2;let H,S,k=!1,E=0;const O=t.view(o.ActiveEnvironmentState),B=t.listen(o.TokenIsCollecting);C?(0,h.addFrameTask)(()=>$()):i.once("tap",()=>{$()});const j=t.listen(o.Raining);let M,P;const F=t.listen(o.FoxPurring);let L,_;const V=t.listen(o.FoxHm);let R;const W=e=>new c.Howl({volume:.55,src:l.default[e]});return function(e){if(!u)return;if(j.changed&&(j.added.length?(M||(M=new c.Howl({src:l.default.rain,loop:!0,volume:.25})),clearTimeout(P),M.stop(),M.play(),M.fade(0,.25,1e3)):j.removing.length&&M&&(M.fade(.25,0,1e3),P=setTimeout(()=>M.stop(),1e3))),F.changed&&(F.added.length?(L||(L=new c.Howl({src:l.default.foxpurring,loop:!0,volume:.18})),clearTimeout(_),L.stop(),L.play(),L.fade(0,.18,1e3)):F.removing.length&&L&&(L.fade(.18,0,1e3),_=setTimeout(()=>L.stop(),1e3))),V.changed&&(1==V.added.length?(R||(R=new c.Howl({src:l.default.foxhm,loop:!1,volume:.4})),R.stop(),R.play(),R.fade(0,.4,1)):F.removing.length&&R&&R.stop()),s.changed){const e=Boolean(t.findTag(o.OriginTreeIntroSequenceStarted));S&&S.players&&S.ids&&S.players.forEach(t=>{t.fade(e?1:0,e?0:1,500)})}const n=O.length?O[0].get(o.EnvironmentState):null,i=n&&n.name;if(O.length){if(i!==H){const e=v[i];S&&function(e){e&&e.players&&(e.players.forEach(e=>{e.stop()}),e.ids=null);S=null}(S),G(e),p.forEach(e=>{const t=`note-${i}-${e}`;t in m||(m[t]=W(t))})}H=i}if(k&&(E+=e)>=.1&&(k=!1,E=0),B.added.length>0&&g.reset(),d.added.length>0){const e=g.next(),t=`note-${i}-${e}`;t in m||(m[t]=W(t)),m[t].play()}y.update();const a=t.findTag(o.UserCharacter).position;w.set(a.x,a.z);for(let e=0;e<r.length;e++){const t=r[e],n=t.get(o.Object3D);if(n.visible){n.getWorldPosition(T),A.set(T.x,T.z);const e=2;if(w.distanceToSquared(A)<=e*e){if(!k&&!t.has(o.UserHitAudioTrigger)){k=!0,E=0,t.add(o.UserHitAudioTrigger),t.get(o.UserHitAudioTrigger).type="tree"}}else t.has(o.UserHitAudioTrigger)&&t.remove(o.UserHitAudioTrigger)}}};function $(){u=!0;let e="forest";if(O.length>0){e=O[0].get(o.EnvironmentState).name}H=e;const t=e in v?v[e]:null;t&&G(t)}function G(e){e&&(e.players||(e.players=[e.natureId,e.musicId].map(e=>new c.Howl({src:l.default[e],loop:!0,html5:!0}))),e.players.forEach(e=>e.stop()),e.ids=e.players.map(e=>e.play())),S=e}}function M(e){var t=function(o){document.removeEventListener("touchstart",t),document.removeEventListener("touchend",t),window.removeEventListener("mousedown",t),(async()=>{const t=B(e);t&&await t;var o=e.createBuffer(1,1,22050),r=e.createBufferSource();r.buffer=o,r.connect(e.destination),r.start?r.start(0):r.play?r.play(0):r.noteOn&&r.noteOn(0)})()};document.addEventListener("touchstart",t),document.addEventListener("touchend",t),window.addEventListener("mousedown",t)}
},{"../tags":60,"three":74,"../util/math":240,"../assets/audio/*.{mp3,ogg}":263,"../util/documentVisibility":141,"howler":305,"web-audio-player":304,"../util/Random":235,"right-now":223,"../util/addFrameTasks":140,"../util/query-string":30,"../config":28,"../util/stores":228}],815:[function(require,module,exports) {
"use strict";var t=Math.abs,e=Math.min;function r(r,a,n,s){var u=t(r-a);return u<=n||(u<=s*e(t(r),t(a))||r===a)}r.FLT_EPSILON=1.1920929e-7,r.DBL_EPSILON=2.220446049250313e-16,module.exports=r;
},{}],738:[function(require,module,exports) {
var e=require("an-array"),r=require("almost-equal");module.exports=function(t,n,u,a){return!!(t&&n&&e(t)&&e(n))&&(t.length===n.length&&("number"!=typeof u&&(u=r.FLT_EPSILON),"number"!=typeof a&&(a=u),Array.prototype.slice.call(t).every(function(e,t){var o=n[t];return e===o||r(e,o,u,a)})))};
},{"an-array":816,"almost-equal":815}],301:[function(require,module,exports) {
"use strict";function e(e,t,x){x=x||2;var i,u,v,y,o,p,a,l=t&&t.length,h=l?t[0]*x:e.length,s=n(e,0,h,x,!0),c=[];if(!s||s.next===s.prev)return c;if(l&&(s=f(e,t,s,x)),e.length>80*x){i=v=e[0],u=y=e[1];for(var Z=x;Z<h;Z+=x)(o=e[Z])<i&&(i=o),(p=e[Z+1])<u&&(u=p),o>v&&(v=o),p>y&&(y=p);a=0!==(a=Math.max(v-i,y-u))?1/a:0}return r(s,c,x,i,u,a),c}function n(e,n,t,r,x){var i,u;if(x===D(e,n,t,r)>0)for(i=n;i<t;i+=r)u=A(i,e[i],e[i+1],u);else for(i=t-r;i>=n;i-=r)u=A(i,e[i],e[i+1],u);return u&&w(u,u.next)&&(B(u),u=u.next),u}function t(e,n){if(!e)return e;n||(n=e);var t,r=e;do{if(t=!1,r.steiner||!w(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(B(r),(r=n=r.prev)===r.next)break;t=!0}}while(t||r!==n);return n}function r(e,n,f,y,o,p,a){if(e){!a&&p&&l(e,y,o,p);for(var h,s,c=e;e.prev!==e.next;)if(h=e.prev,s=e.next,p?i(e,y,o,p):x(e))n.push(h.i/f),n.push(e.i/f),n.push(s.i/f),B(e),e=s.next,c=s.next;else if((e=s)===c){a?1===a?r(e=u(t(e),n,f),n,f,y,o,p,2):2===a&&v(e,n,f,y,o,p):r(t(e),n,f,y,o,p,1);break}}}function x(e){var n=e.prev,t=e,r=e.next;if(g(n,t,r)>=0)return!1;for(var x=e.next.next;x!==e.prev;){if(Z(n.x,n.y,t.x,t.y,r.x,r.y,x.x,x.y)&&g(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function i(e,n,t,r){var x=e.prev,i=e,u=e.next;if(g(x,i,u)>=0)return!1;for(var v=x.x<i.x?x.x<u.x?x.x:u.x:i.x<u.x?i.x:u.x,f=x.y<i.y?x.y<u.y?x.y:u.y:i.y<u.y?i.y:u.y,y=x.x>i.x?x.x>u.x?x.x:u.x:i.x>u.x?i.x:u.x,o=x.y>i.y?x.y>u.y?x.y:u.y:i.y>u.y?i.y:u.y,p=s(v,f,n,t,r),a=s(y,o,n,t,r),l=e.prevZ,h=e.nextZ;l&&l.z>=p&&h&&h.z<=a;){if(l!==e.prev&&l!==e.next&&Z(x.x,x.y,i.x,i.y,u.x,u.y,l.x,l.y)&&g(l.prev,l,l.next)>=0)return!1;if(l=l.prevZ,h!==e.prev&&h!==e.next&&Z(x.x,x.y,i.x,i.y,u.x,u.y,h.x,h.y)&&g(h.prev,h,h.next)>=0)return!1;h=h.nextZ}for(;l&&l.z>=p;){if(l!==e.prev&&l!==e.next&&Z(x.x,x.y,i.x,i.y,u.x,u.y,l.x,l.y)&&g(l.prev,l,l.next)>=0)return!1;l=l.prevZ}for(;h&&h.z<=a;){if(h!==e.prev&&h!==e.next&&Z(x.x,x.y,i.x,i.y,u.x,u.y,h.x,h.y)&&g(h.prev,h,h.next)>=0)return!1;h=h.nextZ}return!0}function u(e,n,r){var x=e;do{var i=x.prev,u=x.next.next;!w(i,u)&&M(i,x,x.next,u)&&k(i,u)&&k(u,i)&&(n.push(i.i/r),n.push(x.i/r),n.push(u.i/r),B(x),B(x.next),x=e=u),x=x.next}while(x!==e);return t(x)}function v(e,n,x,i,u,v){var f=e;do{for(var y=f.next.next;y!==f.prev;){if(f.i!==y.i&&d(f,y)){var o=q(f,y);return f=t(f,f.next),o=t(o,o.next),r(f,n,x,i,u,v),void r(o,n,x,i,u,v)}y=y.next}f=f.next}while(f!==e)}function f(e,r,x,i){var u,v,f,p=[];for(u=0,v=r.length;u<v;u++)(f=n(e,r[u]*i,u<v-1?r[u+1]*i:e.length,i,!1))===f.next&&(f.steiner=!0),p.push(c(f));for(p.sort(y),u=0;u<p.length;u++)o(p[u],x),x=t(x,x.next);return x}function y(e,n){return e.x-n.x}function o(e,n){if(n=p(e,n)){var r=q(n,e);t(n,n.next),t(r,r.next)}}function p(e,n){var t,r=n,x=e.x,i=e.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var v=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(v<=x&&v>u){if(u=v,v===x){if(i===r.y)return r;if(i===r.next.y)return r.next}t=r.x<r.next.x?r:r.next}}r=r.next}while(r!==n);if(!t)return null;if(x===u)return t;var f,y=t,o=t.x,p=t.y,l=1/0;r=t;do{x>=r.x&&r.x>=o&&x!==r.x&&Z(i<p?x:u,i,o,p,i<p?u:x,i,r.x,r.y)&&(f=Math.abs(i-r.y)/(x-r.x),k(r,e)&&(f<l||f===l&&(r.x>t.x||r.x===t.x&&a(t,r)))&&(t=r,l=f)),r=r.next}while(r!==y);return t}function a(e,n){return g(e.prev,e,n.prev)<0&&g(n.next,e,e.next)<0}function l(e,n,t,r){var x=e;do{null===x.z&&(x.z=s(x.x,x.y,n,t,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,h(x)}function h(e){var n,t,r,x,i,u,v,f,y=1;do{for(t=e,e=null,i=null,u=0;t;){for(u++,r=t,v=0,n=0;n<y&&(v++,r=r.nextZ);n++);for(f=y;v>0||f>0&&r;)0!==v&&(0===f||!r||t.z<=r.z)?(x=t,t=t.nextZ,v--):(x=r,r=r.nextZ,f--),i?i.nextZ=x:e=x,x.prevZ=i,i=x;t=r}i.nextZ=null,y*=2}while(u>1);return e}function s(e,n,t,r,x){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-t)*x)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-r)*x)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function c(e){var n=e,t=e;do{(n.x<t.x||n.x===t.x&&n.y<t.y)&&(t=n),n=n.next}while(n!==e);return t}function Z(e,n,t,r,x,i,u,v){return(x-u)*(n-v)-(e-u)*(i-v)>=0&&(e-u)*(r-v)-(t-u)*(n-v)>=0&&(t-u)*(i-v)-(x-u)*(r-v)>=0}function d(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!b(e,n)&&(k(e,n)&&k(n,e)&&j(e,n)&&(g(e.prev,e,n.prev)||g(e,n.prev,n))||w(e,n)&&g(e.prev,e,e.next)>0&&g(n.prev,n,n.next)>0)}function g(e,n,t){return(n.y-e.y)*(t.x-n.x)-(n.x-e.x)*(t.y-n.y)}function w(e,n){return e.x===n.x&&e.y===n.y}function M(e,n,t,r){var x=m(g(e,n,t)),i=m(g(e,n,r)),u=m(g(t,r,e)),v=m(g(t,r,n));return x!==i&&u!==v||(!(0!==x||!z(e,t,n))||(!(0!==i||!z(e,r,n))||(!(0!==u||!z(t,e,r))||!(0!==v||!z(t,n,r)))))}function z(e,n,t){return n.x<=Math.max(e.x,t.x)&&n.x>=Math.min(e.x,t.x)&&n.y<=Math.max(e.y,t.y)&&n.y>=Math.min(e.y,t.y)}function m(e){return e>0?1:e<0?-1:0}function b(e,n){var t=e;do{if(t.i!==e.i&&t.next.i!==e.i&&t.i!==n.i&&t.next.i!==n.i&&M(t,t.next,e,n))return!0;t=t.next}while(t!==e);return!1}function k(e,n){return g(e.prev,e,e.next)<0?g(e,n,e.next)>=0&&g(e,e.prev,n)>=0:g(e,n,e.prev)<0||g(e,e.next,n)<0}function j(e,n){var t=e,r=!1,x=(e.x+n.x)/2,i=(e.y+n.y)/2;do{t.y>i!=t.next.y>i&&t.next.y!==t.y&&x<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next}while(t!==e);return r}function q(e,n){var t=new C(e.i,e.x,e.y),r=new C(n.i,n.x,n.y),x=e.next,i=n.prev;return e.next=n,n.prev=e,t.next=x,x.prev=t,r.next=t,t.prev=r,i.next=r,r.prev=i,r}function A(e,n,t,r){var x=new C(e,n,t);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function B(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function C(e,n,t){this.i=e,this.x=n,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function D(e,n,t,r){for(var x=0,i=n,u=t-r;i<t;i+=r)x+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return x}module.exports=e,module.exports.default=e,e.deviation=function(e,n,t,r){var x=n&&n.length,i=x?n[0]*t:e.length,u=Math.abs(D(e,0,i,t));if(x)for(var v=0,f=n.length;v<f;v++){var y=n[v]*t,o=v<f-1?n[v+1]*t:e.length;u-=Math.abs(D(e,y,o,t))}var p=0;for(v=0;v<r.length;v+=3){var a=r[v]*t,l=r[v+1]*t,h=r[v+2]*t;p+=Math.abs((e[a]-e[h])*(e[l+1]-e[a+1])-(e[a]-e[l])*(e[h+1]-e[a+1]))}return 0===u&&0===p?0:Math.abs((p-u)/u)},e.flatten=function(e){for(var n=e[0][0].length,t={vertices:[],holes:[],dimensions:n},r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)for(var u=0;u<n;u++)t.vertices.push(e[x][i][u]);x>0&&(r+=e[x-1].length,t.holes.push(r))}return t};
},{}],250:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};exports.multiLineSegments2D=x,exports.multiPoly2D=y,exports.filledPoly2D=M,exports.filledMultiPoly2D=P,exports.multiPoints2D=b,exports.circleHelper2D=B,exports.boundsHelper2D=L,exports.curveHelper=S,exports.spheresAlongCurve=A,exports.pointsToSpheres=D,exports.animatedWindLineCurve=G;var t=require("../tags"),n=w(t),o=require("three"),r=w(o),a=require("array-almost-equal"),i=m(a),s=require("./three-util"),l=require("bound-points"),c=m(l),u=require("canvas-sketch-util/math"),f=require("earcut"),p=m(f),d=require("./geometry"),h=w(d);function m(e){return e&&e.__esModule?e:{default:e}}function w(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}let v,g;function x(t,n={}){const o=new r.Geometry,a=new r.LineSegments(o,new r.LineBasicMaterial(e({color:"white"},n)));return a.updateData=i,t&&i(t),a;function i(e){o.vertices.length=0,e.forEach(e=>{e.forEach(e=>{o.vertices.push(new r.Vector3(e[0],0,e[1]))})}),o.verticesNeedUpdate=!0}}function y(t=[],n={}){const{closed:o=!0}=n,a=new r.Geometry,s=new r.LineSegments(a,new r.LineBasicMaterial(e({color:"white"},n)));return s.updateData=l,t&&l(t),s;function l(e){a.vertices.length=0,e.forEach(e=>{!(0,i.default)(e[0],e[e.length-1])&&o&&(e=e.slice()).push(e[0]);for(let t=0;t<e.length-1;t++){const n=e[t],o=e[t+1];a.vertices.push(new r.Vector3(n[0],0,n[1])),a.vertices.push(new r.Vector3(o[0],0,o[1]))}}),a.verticesNeedUpdate=!0}}function M(t=[],n={}){const{vertices:o,holes:a,dimensions:i}=p.default.flatten([t]),s=(0,p.default)(o,a,i),[l,f]=n.bounds||(0,c.default)(t),d=new r.BufferGeometry;d.setIndex(new r.Uint16BufferAttribute(s,1)),d.setAttribute("position",new r.Float32BufferAttribute(t.map(e=>[e[0],0,e[1]]).flat(1/0),3)),d.setAttribute("uv",new r.Float32BufferAttribute(t.map(e=>[(0,u.inverseLerp)(l[0],f[0],e[0]),(0,u.inverseLerp)(l[1],f[1],e[1])]).flat(1/0),2));const h=e({},n);return delete h.bounds,new r.Mesh(d,new r.MeshBasicMaterial(e({},h,{side:r.DoubleSide})))}function P(t=[],n={}){const{closed:o=!0,color:a="white"}=n,s=new r.Geometry,l=new r.Mesh(s,new r.MeshBasicMaterial(e({color:a,side:r.DoubleSide},n)));return l.updateData=c,t&&c(t),l;function c(e){s.vertices.length=0,polygons.forEach(e=>{!(0,i.default)(e[0],e[e.length-1])&&o&&(e=e.slice()).push(e[0]);for(let t=0;t<e.length-1;t++){const n=e[t],o=e[t+1];s.vertices.push(new r.Vector3(n[0],0,n[1])),s.vertices.push(new r.Vector3(o[0],0,o[1]))}}),s.verticesNeedUpdate=!0}}function b(t=[],n={}){const o=new r.BufferGeometry,a=new r.Points(o,new r.PointsMaterial(e({color:"white",size:1,sizeAttenuation:!0},n)));return a.updateData=i,t&&i(t),a;function i(e){(0,s.setPointsToBufferPosition)(o,e.map(e=>new r.Vector3(e[0],0,e[1])))}}function B(e,t,n="white",o=32){v||((v=new r.Geometry).vertices=(0,u.linspace)(o,!0).map(e=>{const t=e*Math.PI*2;return new r.Vector3(1*Math.cos(t),0,1*Math.sin(t))}));const a=new r.Line(v,new r.LineBasicMaterial({color:n}));return a.position.x=e[0],a.position.z=e[1],a.scale.setScalar(t),a}function L(t,n={}){const o=h.boundsToVerts(t),a=new r.Geometry;return a.vertices=o.map(e=>new r.Vector3(e[0],0,e[1])),new r.LineLoop(a,new r.LineBasicMaterial(e({},n)))}function S(t,n={}){const{divisions:o=50}=n,a=t.getPoints(o),i=new r.Geometry;return i.vertices=a,new r.Line(i,new r.LineBasicMaterial(e({},n)))}function A(t,n={}){let{count:o,spaced:a=!0,spacing:i}=n;null==o&&i&&(o=Math.max(2,Math.round(t.getLength()/i))),o=Math.max(2,o);const s=e({},n);delete s.count,delete s.spaced,delete s.spacing,delete s.scale;const l=a?t.getSpacedPoints(o-1):t.getPoints(o-1);g||(g=new r.SphereGeometry(1,32,32));const c=new r.Group;return l.map(e=>{const t=new r.Mesh(g,new r.MeshBasicMaterial(s)),o=null!=n.scale?n.scale:.5;t.scale.setScalar(o),t.position.copy(e),c.add(t)}),c}function D(t,n={}){g||(g=new r.SphereGeometry(1,32,32));const o=new r.Group,a=e({},n);return delete a.scale,t.map(e=>{const t=new r.Mesh(g,new r.MeshBasicMaterial(a)),i=null!=n.scale?n.scale:.5;t.scale.setScalar(i),t.position.copy(e),o.add(t)}),o}function G(e,t,o={}){const{divisions:a=25}=o,i=t.getPoints(a-1),s=new r.BufferGeometry;s.setAttribute("position",new r.Float32BufferAttribute(i.map(e=>e.toArray()).flat(1/0),3)),s.setAttribute("coord",new r.Float32BufferAttribute(i.map((e,t,n)=>{return n.length<=1?.5:t/(n.length-1)}).flat(1/0),1));const l=new r.Line(s,new r.ShaderMaterial({name:"helperWindLine",transparent:!0,fragmentShader:"\n        const float PI = 3.14159265359;\n        const float TWO_PI = 6.28318530718;\n\n        float repeat(float t, float length) {\n          return t - floor(t / length) * length;\n        }\n\n        float deltaAngle(float current, float target) {\n          float num = repeat(target - current, TWO_PI);\n          if (num > PI) num -= TWO_PI;\n          return num;\n        }\n\n        float wrapAngle(float angle) {\n          float n = repeat(angle, TWO_PI);\n          if (n > PI) n -= TWO_PI;\n          return n;\n        }\n\n        float ToroidalDistance (float x1, float x2)\n        {\n            float dx = abs(x2 - x1);\n            if (dx > 0.5) dx = 1.0 - dx;\n            return sqrt(dx*dx);\n        }\n        \n        uniform vec3 color;\n        uniform float opacity;\n        uniform float time;\n        varying float vCoord;\n        void main () {\n          float alpha = opacity;\n          float progress = mod(time, 1.0);\n          \n          // float smoothness = 0.1;\n          // float target = mix(-0.5, 1.5, progress);\n          // alpha *= smoothstep(target - smoothness, target + smoothness, vCoord);\n          alpha *= pow(sin(vCoord * 10.0 + time * -3.0) * 0.5 + 0.5, 2.0);\n          gl_FragColor = vec4(color, alpha);\n        }\n      ",vertexShader:"\n        attribute float coord;\n        varying float vCoord;\n        void main () {\n          vCoord = coord;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n        }\n      ",uniforms:{color:{value:new r.Color(o.color||"white")},opacity:{value:1},time:{value:0}}}));return e.tag(n.ShaderUniformTime,{uniform:l.material.uniforms.time}),l}
},{"../tags":60,"three":74,"array-almost-equal":738,"./three-util":80,"bound-points":300,"canvas-sketch-util/math":306,"earcut":301,"./geometry":251}],545:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(e){for(var t,r=-1,o=e.length,u=e[o-1],n=0;++r<o;)t=u,u=e[r],n+=t[1]*u[0]-t[0]*u[1];return n/2};
},{}],546:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(e){for(var t,r,o=-1,u=e.length,n=0,s=0,f=e[u-1],l=0;++o<u;)t=f,f=e[o],l+=r=t[0]*f[1]-f[0]*t[1],n+=(t[0]+f[0])*r,s+=(t[1]+f[1])*r;return[n/(l*=3),s/l]};
},{}],764:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(e,t,r){return(t[0]-e[0])*(r[1]-e[1])-(t[1]-e[1])*(r[0]-e[0])};
},{}],547:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(e){if((t=e.length)<3)return null;var r,t,o=new Array(t),l=new Array(t);for(r=0;r<t;++r)o[r]=[+e[r][0],+e[r][1],r];for(o.sort(n),r=0;r<t;++r)l[r]=[o[r][0],-o[r][1]];var f=u(o),s=u(l),a=s[0]===f[0],c=s[s.length-1]===f[f.length-1],i=[];for(r=f.length-1;r>=0;--r)i.push(e[o[f[r]][2]]);for(r=+a;r<s.length-c;++r)i.push(e[o[s[r]][2]]);return i};var e=require("./cross.js"),r=t(e);function t(e){return e&&e.__esModule?e:{default:e}}function n(e,r){return e[0]-r[0]||e[1]-r[1]}function u(e){const t=e.length,n=[0,1];let u,o=2;for(u=2;u<t;++u){for(;o>1&&(0,r.default)(e[n[o-2]],e[n[o-1]],e[u])<=0;)--o;n[o++]=u}return n.slice(0,o)}
},{"./cross.js":764}],548:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(e,t){for(var r,o,u=e.length,n=e[u-1],s=t[0],f=t[1],l=n[0],a=n[1],c=!1,d=0;d<u;++d)r=(n=e[d])[0],(o=n[1])>f!=a>f&&s<(l-r)*(f-o)/(a-o)+r&&(c=!c),l=r,a=o;return c};
},{}],549:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(e){for(var t,r,o=-1,u=e.length,n=e[u-1],s=n[0],a=n[1],f=0;++o<u;)t=s,r=a,t-=s=(n=e[o])[0],r-=a=n[1],f+=Math.hypot(t,r);return f};
},{}],295:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./area.js");Object.defineProperty(exports,"polygonArea",{enumerable:!0,get:function(){return u(e).default}});var r=require("./centroid.js");Object.defineProperty(exports,"polygonCentroid",{enumerable:!0,get:function(){return u(r).default}});var t=require("./hull.js");Object.defineProperty(exports,"polygonHull",{enumerable:!0,get:function(){return u(t).default}});var n=require("./contains.js");Object.defineProperty(exports,"polygonContains",{enumerable:!0,get:function(){return u(n).default}});var o=require("./length.js");function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"polygonLength",{enumerable:!0,get:function(){return u(o).default}});
},{"./area.js":545,"./centroid.js":546,"./hull.js":547,"./contains.js":548,"./length.js":549}],698:[function(require,module,exports) {
var r=require("./squared");module.exports=function(e,t){return Math.sqrt(r(e,t))};
},{"./squared":307}],282:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};exports.getMinimumSpanningTree=n;const t=require("euclidean-distance");function n(n,r,i={}){const{maxSteps:s=1/0}=i;if(n.length<=1)return[];r=r||t;let c=new Map;n.forEach((e,t)=>{c.set(e,t)});let a=new Set(n.slice(0,1)),l=new Set(n.slice(1)),f=new Map,u=0,p=[];for(;0!=l.size&&u++<s;){u>s-1&&console.warn("Infinite loop");const t=o(a,l,r);if(!t||!isFinite(t.distance))continue;const{from:n,to:i,distance:d}=t;let g=[c.get(n),c.get(i)];const h=g.slice();g.sort();const w=g.join(":");f.has(w)||(f.set(w,!0),p.push(e({},t,{indices:h,key:w})),a.add(i),l.delete(i))}return p}function o(e,t,n){let o,r,i=1/0;for(let s of e)for(let e of t){let t=n(s,e);t<i&&(i=t,o=s,r=e)}return{from:o,to:r,distance:i}}
},{"euclidean-distance":698}],882:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sum=o,exports.sum_three=n,exports.scale=s,exports.negate=u,exports.estimate=l,exports.vec=f;const e=exports.epsilon=1.1102230246251565e-16,t=exports.splitter=134217729,r=exports.resulterrbound=(3+8*e)*e;function o(e,t,r,o,n){let s,u,l,f,p=t[0],i=o[0],c=0,x=0;i>p==i>-p?(s=p,p=t[++c]):(s=i,i=o[++x]);let a=0;if(c<e&&x<r)for(i>p==i>-p?(l=s-((u=p+s)-p),p=t[++c]):(l=s-((u=i+s)-i),i=o[++x]),s=u,0!==l&&(n[a++]=l);c<e&&x<r;)i>p==i>-p?(l=s-((u=s+p)-(f=u-s))+(p-f),p=t[++c]):(l=s-((u=s+i)-(f=u-s))+(i-f),i=o[++x]),s=u,0!==l&&(n[a++]=l);for(;c<e;)l=s-((u=s+p)-(f=u-s))+(p-f),p=t[++c],s=u,0!==l&&(n[a++]=l);for(;x<r;)l=s-((u=s+i)-(f=u-s))+(i-f),i=o[++x],s=u,0!==l&&(n[a++]=l);return 0===s&&0!==a||(n[a++]=s),a}function n(e,t,r,n,s,u,l,f){return o(o(e,t,r,n,l),l,s,u,f)}function s(e,r,o,n){let s,u,l,f,p,i,c,x,a,d,m;m=o-(d=(c=t*o)-(c-o));let _=r[0],b=0;0!==(l=(a=_-(x=(c=t*_)-(c-_)))*m-((s=_*o)-x*d-a*d-x*m))&&(n[b++]=l);for(let v=1;v<e;v++)0!==(l=s-((u=s+(p=(a=(_=r[v])-(x=(c=t*_)-(c-_)))*m-((f=_*o)-x*d-a*d-x*m)))-(i=u-s))+(p-i))&&(n[b++]=l),0!==(l=u-((s=f+u)-f))&&(n[b++]=l);return 0===s&&0!==b||(n[b++]=s),b}function u(e,t){for(let r=0;r<e;r++)t[r]=-t[r];return e}function l(e,t){let r=t[0];for(let o=1;o<e;o++)r+=t[o];return r}function f(e){return new Float64Array(e)}
},{}],864:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.orient2d=c,exports.orient2dfast=a;var t=require("./util.js");const e=(3+16*t.epsilon)*t.epsilon,s=(2+12*t.epsilon)*t.epsilon,r=(9+64*t.epsilon)*t.epsilon*t.epsilon,i=(0,t.vec)(4),n=(0,t.vec)(8),l=(0,t.vec)(12),p=(0,t.vec)(16),o=(0,t.vec)(4);function u(e,u,c,a,f,v,b){let d,m,M,h,x,j,_,q,y,O,P,g,k,w,z,A,B,C;const D=e-f,E=c-f,F=u-v,G=a-v;w=D*G,A=F*E,x=(z=(q=D-(_=(j=t.splitter*D)-(j-D)))*(O=G-(y=(j=t.splitter*G)-(j-G)))-(w-_*y-q*y-_*O))-(P=z-(B=(q=F-(_=(j=t.splitter*F)-(j-F)))*(O=E-(y=(j=t.splitter*E)-(j-E)))-(A-_*y-q*y-_*O))),i[0]=z-(P+x)+(x-B),x=(k=w-((g=w+P)-(x=g-w))+(P-x))-(P=k-A),i[1]=k-(P+x)+(x-A),x=(C=g+P)-g,i[2]=g-(C-x)+(P-x),i[3]=C;let H=(0,t.estimate)(4,i),I=s*b;if(H>=I||-H>=I)return H;if(d=e-(D+(x=e-D))+(x-f),M=c-(E+(x=c-E))+(x-f),m=u-(F+(x=u-F))+(x-v),h=a-(G+(x=a-G))+(x-v),0===d&&0===m&&0===M&&0===h)return H;if(I=r*b+t.resulterrbound*Math.abs(H),(H+=D*h+G*d-(F*M+E*m))>=I||-H>=I)return H;w=d*G,A=m*E,x=(z=(q=d-(_=(j=t.splitter*d)-(j-d)))*(O=G-(y=(j=t.splitter*G)-(j-G)))-(w-_*y-q*y-_*O))-(P=z-(B=(q=m-(_=(j=t.splitter*m)-(j-m)))*(O=E-(y=(j=t.splitter*E)-(j-E)))-(A-_*y-q*y-_*O))),o[0]=z-(P+x)+(x-B),x=(k=w-((g=w+P)-(x=g-w))+(P-x))-(P=k-A),o[1]=k-(P+x)+(x-A),x=(C=g+P)-g,o[2]=g-(C-x)+(P-x),o[3]=C;const J=(0,t.sum)(4,i,4,o,n);w=D*h,A=F*M,x=(z=(q=D-(_=(j=t.splitter*D)-(j-D)))*(O=h-(y=(j=t.splitter*h)-(j-h)))-(w-_*y-q*y-_*O))-(P=z-(B=(q=F-(_=(j=t.splitter*F)-(j-F)))*(O=M-(y=(j=t.splitter*M)-(j-M)))-(A-_*y-q*y-_*O))),o[0]=z-(P+x)+(x-B),x=(k=w-((g=w+P)-(x=g-w))+(P-x))-(P=k-A),o[1]=k-(P+x)+(x-A),x=(C=g+P)-g,o[2]=g-(C-x)+(P-x),o[3]=C;const K=(0,t.sum)(J,n,4,o,l);w=d*h,A=m*M,x=(z=(q=d-(_=(j=t.splitter*d)-(j-d)))*(O=h-(y=(j=t.splitter*h)-(j-h)))-(w-_*y-q*y-_*O))-(P=z-(B=(q=m-(_=(j=t.splitter*m)-(j-m)))*(O=M-(y=(j=t.splitter*M)-(j-M)))-(A-_*y-q*y-_*O))),o[0]=z-(P+x)+(x-B),x=(k=w-((g=w+P)-(x=g-w))+(P-x))-(P=k-A),o[1]=k-(P+x)+(x-A),x=(C=g+P)-g,o[2]=g-(C-x)+(P-x),o[3]=C;const L=(0,t.sum)(K,l,4,o,p);return p[L-1]}function c(t,s,r,i,n,l){const p=(s-l)*(r-n),o=(t-n)*(i-l),c=p-o;if(0===p||0===o||p>0!=o>0)return c;const a=Math.abs(p+o);return Math.abs(c)>=e*a?c:-u(t,s,r,i,n,l,a)}function a(t,e,s,r,i,n){return(e-n)*(s-i)-(t-i)*(r-n)}
},{"./util.js":882}],865:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.orient3d=k,exports.orient3dfast=w;var t=require("./util.js");const e=(7+56*t.epsilon)*t.epsilon,s=(3+28*t.epsilon)*t.epsilon,r=(26+288*t.epsilon)*t.epsilon*t.epsilon,l=(0,t.vec)(4),i=(0,t.vec)(4),c=(0,t.vec)(4),p=(0,t.vec)(4),n=(0,t.vec)(4),a=(0,t.vec)(4),o=(0,t.vec)(4),u=(0,t.vec)(4),v=(0,t.vec)(4),b=(0,t.vec)(8),f=(0,t.vec)(8),M=(0,t.vec)(8),h=(0,t.vec)(4),m=(0,t.vec)(8),d=(0,t.vec)(8),x=(0,t.vec)(8),j=(0,t.vec)(12);let _=(0,t.vec)(192),q=(0,t.vec)(192);function y(e,s,r){e=(0,t.sum)(e,_,s,r,q);const l=_;return _=q,q=l,e}function O(e,s,r,l,i,c,p,n){let a,o,u,v,b,f,M,h,m,d,x,j,_,q,y;return 0===e?0===s?(p[0]=0,n[0]=0,1):(d=(y=-s)*r,v=y-(u=(o=t.splitter*y)-(o-y)),f=r-(b=(o=t.splitter*r)-(o-r)),p[0]=v*f-(d-u*b-v*b-u*f),p[1]=d,d=s*i,v=s-(u=(o=t.splitter*s)-(o-s)),f=i-(b=(o=t.splitter*i)-(o-i)),n[0]=v*f-(d-u*b-v*b-u*f),n[1]=d,2):0===s?(d=e*l,v=e-(u=(o=t.splitter*e)-(o-e)),f=l-(b=(o=t.splitter*l)-(o-l)),p[0]=v*f-(d-u*b-v*b-u*f),p[1]=d,d=(y=-e)*c,v=y-(u=(o=t.splitter*y)-(o-y)),f=c-(b=(o=t.splitter*c)-(o-c)),n[0]=v*f-(d-u*b-v*b-u*f),n[1]=d,2):(d=e*l,j=s*r,a=(x=(v=e-(u=(o=t.splitter*e)-(o-e)))*(f=l-(b=(o=t.splitter*l)-(o-l)))-(d-u*b-v*b-u*f))-(M=x-(_=(v=s-(u=(o=t.splitter*s)-(o-s)))*(f=r-(b=(o=t.splitter*r)-(o-r)))-(j-u*b-v*b-u*f))),p[0]=x-(M+a)+(a-_),a=(m=d-((h=d+M)-(a=h-d))+(M-a))-(M=m-j),p[1]=m-(M+a)+(a-j),a=(q=h+M)-h,p[2]=h-(q-a)+(M-a),p[3]=q,d=s*i,j=e*c,a=(x=(v=s-(u=(o=t.splitter*s)-(o-s)))*(f=i-(b=(o=t.splitter*i)-(o-i)))-(d-u*b-v*b-u*f))-(M=x-(_=(v=e-(u=(o=t.splitter*e)-(o-e)))*(f=c-(b=(o=t.splitter*c)-(o-c)))-(j-u*b-v*b-u*f))),n[0]=x-(M+a)+(a-_),a=(m=d-((h=d+M)-(a=h-d))+(M-a))-(M=m-j),n[1]=m-(M+a)+(a-j),a=(q=h+M)-h,n[2]=h-(q-a)+(M-a),n[3]=q,4)}function P(e,s,r,l,i){let c,p,n,a,o,u,v,b,f,M,m,d,x;return m=s*r,d=(a=s-(n=(p=t.splitter*s)-(p-s)))*(u=r-(o=(p=t.splitter*r)-(p-r)))-(m-n*o-a*o-n*u),u=l-(o=(p=t.splitter*l)-(p-l)),v=d*l,a=d-(n=(p=t.splitter*d)-(p-d)),h[0]=a*u-(v-n*o-a*o-n*u),b=m*l,c=(f=v+(M=(a=m-(n=(p=t.splitter*m)-(p-m)))*u-(b-n*o-a*o-n*u)))-v,h[1]=v-(f-c)+(M-c),x=b+f,h[2]=f-(x-b),h[3]=x,e=y(e,4,h),0!==i&&(u=i-(o=(p=t.splitter*i)-(p-i)),v=d*i,a=d-(n=(p=t.splitter*d)-(p-d)),h[0]=a*u-(v-n*o-a*o-n*u),b=m*i,c=(f=v+(M=(a=m-(n=(p=t.splitter*m)-(p-m)))*u-(b-n*o-a*o-n*u)))-v,h[1]=v-(f-c)+(M-c),x=b+f,h[2]=f-(x-b),h[3]=x,e=y(e,4,h)),e}function g(e,h,q,g,k,w,z,A,B,C,D,E,F){let G,H,I,J,K,L,N,Q,R,S,T,U,V,W,X,Y,Z,$,tt,et,st,rt,lt,it;const ct=e-C,pt=g-C,nt=z-C,at=h-D,ot=k-D,ut=A-D,vt=q-E,bt=w-E,ft=B-E;et=pt*ut,rt=nt*ot,T=(st=(W=pt-(V=(U=t.splitter*pt)-(U-pt)))*(Y=ut-(X=(U=t.splitter*ut)-(U-ut)))-(et-V*X-W*X-V*Y))-(Z=st-(lt=(W=nt-(V=(U=t.splitter*nt)-(U-nt)))*(Y=ot-(X=(U=t.splitter*ot)-(U-ot)))-(rt-V*X-W*X-V*Y))),l[0]=st-(Z+T)+(T-lt),T=(tt=et-(($=et+Z)-(T=$-et))+(Z-T))-(Z=tt-rt),l[1]=tt-(Z+T)+(T-rt),T=(it=$+Z)-$,l[2]=$-(it-T)+(Z-T),l[3]=it,et=nt*at,rt=ct*ut,T=(st=(W=nt-(V=(U=t.splitter*nt)-(U-nt)))*(Y=at-(X=(U=t.splitter*at)-(U-at)))-(et-V*X-W*X-V*Y))-(Z=st-(lt=(W=ct-(V=(U=t.splitter*ct)-(U-ct)))*(Y=ut-(X=(U=t.splitter*ut)-(U-ut)))-(rt-V*X-W*X-V*Y))),i[0]=st-(Z+T)+(T-lt),T=(tt=et-(($=et+Z)-(T=$-et))+(Z-T))-(Z=tt-rt),i[1]=tt-(Z+T)+(T-rt),T=(it=$+Z)-$,i[2]=$-(it-T)+(Z-T),i[3]=it,et=ct*ot,rt=pt*at,T=(st=(W=ct-(V=(U=t.splitter*ct)-(U-ct)))*(Y=ot-(X=(U=t.splitter*ot)-(U-ot)))-(et-V*X-W*X-V*Y))-(Z=st-(lt=(W=pt-(V=(U=t.splitter*pt)-(U-pt)))*(Y=at-(X=(U=t.splitter*at)-(U-at)))-(rt-V*X-W*X-V*Y))),c[0]=st-(Z+T)+(T-lt),T=(tt=et-(($=et+Z)-(T=$-et))+(Z-T))-(Z=tt-rt),c[1]=tt-(Z+T)+(T-rt),T=(it=$+Z)-$,c[2]=$-(it-T)+(Z-T),c[3]=it,G=(0,t.sum)((0,t.sum)((0,t.scale)(4,l,vt,m),m,(0,t.scale)(4,i,bt,d),d,x),x,(0,t.scale)(4,c,ft,m),m,_);let Mt=(0,t.estimate)(G,_),ht=s*F;if(Mt>=ht||-Mt>=ht)return Mt;if(H=e-(ct+(T=e-ct))+(T-C),I=g-(pt+(T=g-pt))+(T-C),J=z-(nt+(T=z-nt))+(T-C),K=h-(at+(T=h-at))+(T-D),L=k-(ot+(T=k-ot))+(T-D),N=A-(ut+(T=A-ut))+(T-D),Q=q-(vt+(T=q-vt))+(T-E),R=w-(bt+(T=w-bt))+(T-E),S=B-(ft+(T=B-ft))+(T-E),0===H&&0===I&&0===J&&0===K&&0===L&&0===N&&0===Q&&0===R&&0===S)return Mt;if(ht=r*F+t.resulterrbound*Math.abs(Mt),(Mt+=vt*(pt*N+ut*I-(ot*J+nt*L))+Q*(pt*ut-ot*nt)+bt*(nt*K+at*J-(ut*H+ct*N))+R*(nt*at-ut*ct)+ft*(ct*L+ot*H-(at*I+pt*K))+S*(ct*ot-at*pt))>=ht||-Mt>=ht)return Mt;const mt=O(H,K,pt,ot,nt,ut,p,n),dt=O(I,L,nt,ut,ct,at,a,o),xt=O(J,N,ct,at,pt,ot,u,v),jt=(0,t.sum)(dt,a,xt,v,b);G=y(G,(0,t.scale)(jt,b,vt,x),x);const _t=(0,t.sum)(xt,u,mt,n,f);G=y(G,(0,t.scale)(_t,f,bt,x),x);const qt=(0,t.sum)(mt,p,dt,o,M);return G=y(G,(0,t.scale)(qt,M,ft,x),x),0!==Q&&(G=y(G,(0,t.scale)(4,l,Q,j),j),G=y(G,(0,t.scale)(jt,b,Q,x),x)),0!==R&&(G=y(G,(0,t.scale)(4,i,R,j),j),G=y(G,(0,t.scale)(_t,f,R,x),x)),0!==S&&(G=y(G,(0,t.scale)(4,c,S,j),j),G=y(G,(0,t.scale)(qt,M,S,x),x)),0!==H&&(0!==L&&(G=P(G,H,L,ft,S)),0!==N&&(G=P(G,-H,N,bt,R))),0!==I&&(0!==N&&(G=P(G,I,N,vt,Q)),0!==K&&(G=P(G,-I,K,ft,S))),0!==J&&(0!==K&&(G=P(G,J,K,bt,R)),0!==L&&(G=P(G,-J,L,vt,Q))),_[G-1]}function k(t,s,r,l,i,c,p,n,a,o,u,v){const b=t-o,f=l-o,M=p-o,h=s-u,m=i-u,d=n-u,x=r-v,j=c-v,_=a-v,q=f*d,y=M*m,O=M*h,P=b*d,k=b*m,w=f*h,z=x*(q-y)+j*(O-P)+_*(k-w),A=(Math.abs(q)+Math.abs(y))*Math.abs(x)+(Math.abs(O)+Math.abs(P))*Math.abs(j)+(Math.abs(k)+Math.abs(w))*Math.abs(_),B=e*A;return z>B||-z>B?z:g(t,s,r,l,i,c,p,n,a,o,u,v,A)}function w(t,e,s,r,l,i,c,p,n,a,o,u){const v=e-o,b=l-o,f=p-o,M=s-u,h=i-u,m=n-u;return(t-a)*(b*m-h*f)+(r-a)*(f*M-m*v)+(c-a)*(v*h-M*b)}
},{"./util.js":882}],866:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.incircle=G,exports.incirclefast=H;var e=require("./util.js");const s=(10+96*e.epsilon)*e.epsilon,l=(4+48*e.epsilon)*e.epsilon,t=(44+576*e.epsilon)*e.epsilon*e.epsilon,c=(0,e.vec)(4),a=(0,e.vec)(4),r=(0,e.vec)(4),i=(0,e.vec)(4),p=(0,e.vec)(4),u=(0,e.vec)(4),n=(0,e.vec)(4),o=(0,e.vec)(4),v=(0,e.vec)(8),m=(0,e.vec)(8),h=(0,e.vec)(8),f=(0,e.vec)(8),_=(0,e.vec)(8),b=(0,e.vec)(8),M=(0,e.vec)(8),d=(0,e.vec)(8),x=(0,e.vec)(8),j=(0,e.vec)(4),q=(0,e.vec)(4),y=(0,e.vec)(4),O=(0,e.vec)(8),P=(0,e.vec)(16),g=(0,e.vec)(16),k=(0,e.vec)(16),w=(0,e.vec)(32),z=(0,e.vec)(32),A=(0,e.vec)(48),B=(0,e.vec)(64);let C=(0,e.vec)(1152),D=(0,e.vec)(1152);function E(s,l,t){s=(0,e.sum)(s,C,l,t,D);const c=C;return C=D,D=c,s}function F(s,D,F,G,H,I,J,K,L){let N,Q,R,S,T,U,V,W,X,Y,Z,$,ee,se,le,te,ce,ae,re,ie,pe,ue,ne,oe,ve,me,he,fe,_e,be,Me,de,xe,je,qe;const ye=s-J,Oe=F-J,Pe=H-J,ge=D-K,ke=G-K,we=I-K;Me=Oe*we,xe=Pe*ke,ue=(de=(ve=Oe-(oe=(ne=e.splitter*Oe)-(ne-Oe)))*(he=we-(me=(ne=e.splitter*we)-(ne-we)))-(Me-oe*me-ve*me-oe*he))-(fe=de-(je=(ve=Pe-(oe=(ne=e.splitter*Pe)-(ne-Pe)))*(he=ke-(me=(ne=e.splitter*ke)-(ne-ke)))-(xe-oe*me-ve*me-oe*he))),c[0]=de-(fe+ue)+(ue-je),ue=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))-(fe=be-xe),c[1]=be-(fe+ue)+(ue-xe),ue=(qe=_e+fe)-_e,c[2]=_e-(qe-ue)+(fe-ue),c[3]=qe,Me=Pe*ge,xe=ye*we,ue=(de=(ve=Pe-(oe=(ne=e.splitter*Pe)-(ne-Pe)))*(he=ge-(me=(ne=e.splitter*ge)-(ne-ge)))-(Me-oe*me-ve*me-oe*he))-(fe=de-(je=(ve=ye-(oe=(ne=e.splitter*ye)-(ne-ye)))*(he=we-(me=(ne=e.splitter*we)-(ne-we)))-(xe-oe*me-ve*me-oe*he))),a[0]=de-(fe+ue)+(ue-je),ue=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))-(fe=be-xe),a[1]=be-(fe+ue)+(ue-xe),ue=(qe=_e+fe)-_e,a[2]=_e-(qe-ue)+(fe-ue),a[3]=qe,Me=ye*ke,xe=Oe*ge,ue=(de=(ve=ye-(oe=(ne=e.splitter*ye)-(ne-ye)))*(he=ke-(me=(ne=e.splitter*ke)-(ne-ke)))-(Me-oe*me-ve*me-oe*he))-(fe=de-(je=(ve=Oe-(oe=(ne=e.splitter*Oe)-(ne-Oe)))*(he=ge-(me=(ne=e.splitter*ge)-(ne-ge)))-(xe-oe*me-ve*me-oe*he))),r[0]=de-(fe+ue)+(ue-je),ue=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))-(fe=be-xe),r[1]=be-(fe+ue)+(ue-xe),ue=(qe=_e+fe)-_e,r[2]=_e-(qe-ue)+(fe-ue),r[3]=qe,N=(0,e.sum)((0,e.sum)((0,e.sum)((0,e.scale)((0,e.scale)(4,c,ye,O),O,ye,P),P,(0,e.scale)((0,e.scale)(4,c,ge,O),O,ge,g),g,w),w,(0,e.sum)((0,e.scale)((0,e.scale)(4,a,Oe,O),O,Oe,P),P,(0,e.scale)((0,e.scale)(4,a,ke,O),O,ke,g),g,z),z,B),B,(0,e.sum)((0,e.scale)((0,e.scale)(4,r,Pe,O),O,Pe,P),P,(0,e.scale)((0,e.scale)(4,r,we,O),O,we,g),g,w),w,C);let ze=(0,e.estimate)(N,C),Ae=l*L;if(ze>=Ae||-ze>=Ae)return ze;if(Q=s-(ye+(ue=s-ye))+(ue-J),T=D-(ge+(ue=D-ge))+(ue-K),R=F-(Oe+(ue=F-Oe))+(ue-J),U=G-(ke+(ue=G-ke))+(ue-K),S=H-(Pe+(ue=H-Pe))+(ue-J),V=I-(we+(ue=I-we))+(ue-K),0===Q&&0===R&&0===S&&0===T&&0===U&&0===V)return ze;if(Ae=t*L+e.resulterrbound*Math.abs(ze),(ze+=(ye*ye+ge*ge)*(Oe*V+we*R-(ke*S+Pe*U))+2*(ye*Q+ge*T)*(Oe*we-ke*Pe)+((Oe*Oe+ke*ke)*(Pe*T+ge*S-(we*Q+ye*V))+2*(Oe*R+ke*U)*(Pe*ge-we*ye))+((Pe*Pe+we*we)*(ye*U+ke*Q-(ge*R+Oe*T))+2*(Pe*S+we*V)*(ye*ke-ge*Oe)))>=Ae||-ze>=Ae)return ze;if(0===R&&0===U&&0===S&&0===V||(Me=ye*ye,xe=ge*ge,ue=(fe=(de=(ve=ye-(oe=(ne=e.splitter*ye)-(ne-ye)))*ve-(Me-oe*oe-(oe+oe)*ve))+(je=(ve=ge-(oe=(ne=e.splitter*ge)-(ne-ge)))*ve-(xe-oe*oe-(oe+oe)*ve)))-de,i[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,i[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,i[2]=_e-(qe-ue)+(fe-ue),i[3]=qe),0===S&&0===V&&0===Q&&0===T||(Me=Oe*Oe,xe=ke*ke,ue=(fe=(de=(ve=Oe-(oe=(ne=e.splitter*Oe)-(ne-Oe)))*ve-(Me-oe*oe-(oe+oe)*ve))+(je=(ve=ke-(oe=(ne=e.splitter*ke)-(ne-ke)))*ve-(xe-oe*oe-(oe+oe)*ve)))-de,p[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,p[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,p[2]=_e-(qe-ue)+(fe-ue),p[3]=qe),0===Q&&0===T&&0===R&&0===U||(Me=Pe*Pe,xe=we*we,ue=(fe=(de=(ve=Pe-(oe=(ne=e.splitter*Pe)-(ne-Pe)))*ve-(Me-oe*oe-(oe+oe)*ve))+(je=(ve=we-(oe=(ne=e.splitter*we)-(ne-we)))*ve-(xe-oe*oe-(oe+oe)*ve)))-de,u[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,u[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,u[2]=_e-(qe-ue)+(fe-ue),u[3]=qe),0!==Q&&(W=(0,e.scale)(4,c,Q,v),N=E(N,(0,e.sum_three)((0,e.scale)(W,v,2*ye,P),P,(0,e.scale)((0,e.scale)(4,u,Q,O),O,ke,g),g,(0,e.scale)((0,e.scale)(4,p,Q,O),O,-we,k),k,w,A),A)),0!==T&&(X=(0,e.scale)(4,c,T,m),N=E(N,(0,e.sum_three)((0,e.scale)(X,m,2*ge,P),P,(0,e.scale)((0,e.scale)(4,p,T,O),O,Pe,g),g,(0,e.scale)((0,e.scale)(4,u,T,O),O,-Oe,k),k,w,A),A)),0!==R&&(Y=(0,e.scale)(4,a,R,h),N=E(N,(0,e.sum_three)((0,e.scale)(Y,h,2*Oe,P),P,(0,e.scale)((0,e.scale)(4,i,R,O),O,we,g),g,(0,e.scale)((0,e.scale)(4,u,R,O),O,-ge,k),k,w,A),A)),0!==U&&(Z=(0,e.scale)(4,a,U,f),N=E(N,(0,e.sum_three)((0,e.scale)(Z,f,2*ke,P),P,(0,e.scale)((0,e.scale)(4,u,U,O),O,ye,g),g,(0,e.scale)((0,e.scale)(4,i,U,O),O,-Pe,k),k,w,A),A)),0!==S&&($=(0,e.scale)(4,r,S,_),N=E(N,(0,e.sum_three)((0,e.scale)($,_,2*Pe,P),P,(0,e.scale)((0,e.scale)(4,p,S,O),O,ge,g),g,(0,e.scale)((0,e.scale)(4,i,S,O),O,-ke,k),k,w,A),A)),0!==V&&(ee=(0,e.scale)(4,r,V,b),N=E(N,(0,e.sum_three)((0,e.scale)(ee,b,2*we,P),P,(0,e.scale)((0,e.scale)(4,i,V,O),O,Oe,g),g,(0,e.scale)((0,e.scale)(4,p,V,O),O,-ye,k),k,w,A),A)),0!==Q||0!==T){if(0!==R||0!==U||0!==S||0!==V?(Me=R*we,xe=Oe*V,ue=(fe=(de=(ve=R-(oe=(ne=e.splitter*R)-(ne-R)))*(he=we-(me=(ne=e.splitter*we)-(ne-we)))-(Me-oe*me-ve*me-oe*he))+(je=(ve=Oe-(oe=(ne=e.splitter*Oe)-(ne-Oe)))*(he=V-(me=(ne=e.splitter*V)-(ne-V)))-(xe-oe*me-ve*me-oe*he)))-de,n[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,n[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,n[2]=_e-(qe-ue)+(fe-ue),n[3]=qe,Me=S*-ke,xe=Pe*-U,ue=(fe=(de=(ve=S-(oe=(ne=e.splitter*S)-(ne-S)))*(he=-ke-(me=(ne=e.splitter*-ke)-(ne- -ke)))-(Me-oe*me-ve*me-oe*he))+(je=(ve=Pe-(oe=(ne=e.splitter*Pe)-(ne-Pe)))*(he=-U-(me=(ne=e.splitter*-U)-(ne- -U)))-(xe-oe*me-ve*me-oe*he)))-de,o[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,o[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,o[2]=_e-(qe-ue)+(fe-ue),o[3]=qe,le=(0,e.sum)(4,n,4,o,d),Me=R*V,xe=S*U,ue=(de=(ve=R-(oe=(ne=e.splitter*R)-(ne-R)))*(he=V-(me=(ne=e.splitter*V)-(ne-V)))-(Me-oe*me-ve*me-oe*he))-(fe=de-(je=(ve=S-(oe=(ne=e.splitter*S)-(ne-S)))*(he=U-(me=(ne=e.splitter*U)-(ne-U)))-(xe-oe*me-ve*me-oe*he))),q[0]=de-(fe+ue)+(ue-je),ue=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))-(fe=be-xe),q[1]=be-(fe+ue)+(ue-xe),ue=(qe=_e+fe)-_e,q[2]=_e-(qe-ue)+(fe-ue),q[3]=qe,ae=4):(d[0]=0,le=1,q[0]=0,ae=1),0!==Q){const s=(0,e.scale)(le,d,Q,k);N=E(N,(0,e.sum)((0,e.scale)(W,v,Q,P),P,(0,e.scale)(s,k,2*ye,w),w,A),A);const l=(0,e.scale)(ae,q,Q,O);N=E(N,(0,e.sum_three)((0,e.scale)(l,O,2*ye,P),P,(0,e.scale)(l,O,Q,g),g,(0,e.scale)(s,k,Q,w),w,z,B),B),0!==U&&(N=E(N,(0,e.scale)((0,e.scale)(4,u,Q,O),O,U,P),P)),0!==V&&(N=E(N,(0,e.scale)((0,e.scale)(4,p,-Q,O),O,V,P),P))}if(0!==T){const s=(0,e.scale)(le,d,T,k);N=E(N,(0,e.sum)((0,e.scale)(X,m,T,P),P,(0,e.scale)(s,k,2*ge,w),w,A),A);const l=(0,e.scale)(ae,q,T,O);N=E(N,(0,e.sum_three)((0,e.scale)(l,O,2*ge,P),P,(0,e.scale)(l,O,T,g),g,(0,e.scale)(s,k,T,w),w,z,B),B)}}if(0!==R||0!==U){if(0!==S||0!==V||0!==Q||0!==T?(Me=S*ge,xe=Pe*T,ue=(fe=(de=(ve=S-(oe=(ne=e.splitter*S)-(ne-S)))*(he=ge-(me=(ne=e.splitter*ge)-(ne-ge)))-(Me-oe*me-ve*me-oe*he))+(je=(ve=Pe-(oe=(ne=e.splitter*Pe)-(ne-Pe)))*(he=T-(me=(ne=e.splitter*T)-(ne-T)))-(xe-oe*me-ve*me-oe*he)))-de,n[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,n[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,n[2]=_e-(qe-ue)+(fe-ue),n[3]=qe,Me=Q*(ie=-we),xe=ye*(pe=-V),ue=(fe=(de=(ve=Q-(oe=(ne=e.splitter*Q)-(ne-Q)))*(he=ie-(me=(ne=e.splitter*ie)-(ne-ie)))-(Me-oe*me-ve*me-oe*he))+(je=(ve=ye-(oe=(ne=e.splitter*ye)-(ne-ye)))*(he=pe-(me=(ne=e.splitter*pe)-(ne-pe)))-(xe-oe*me-ve*me-oe*he)))-de,o[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,o[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,o[2]=_e-(qe-ue)+(fe-ue),o[3]=qe,te=(0,e.sum)(4,n,4,o,x),Me=S*T,xe=Q*V,ue=(de=(ve=S-(oe=(ne=e.splitter*S)-(ne-S)))*(he=T-(me=(ne=e.splitter*T)-(ne-T)))-(Me-oe*me-ve*me-oe*he))-(fe=de-(je=(ve=Q-(oe=(ne=e.splitter*Q)-(ne-Q)))*(he=V-(me=(ne=e.splitter*V)-(ne-V)))-(xe-oe*me-ve*me-oe*he))),y[0]=de-(fe+ue)+(ue-je),ue=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))-(fe=be-xe),y[1]=be-(fe+ue)+(ue-xe),ue=(qe=_e+fe)-_e,y[2]=_e-(qe-ue)+(fe-ue),y[3]=qe,re=4):(x[0]=0,te=1,y[0]=0,re=1),0!==R){const s=(0,e.scale)(te,x,R,k);N=E(N,(0,e.sum)((0,e.scale)(Y,h,R,P),P,(0,e.scale)(s,k,2*Oe,w),w,A),A);const l=(0,e.scale)(re,y,R,O);N=E(N,(0,e.sum_three)((0,e.scale)(l,O,2*Oe,P),P,(0,e.scale)(l,O,R,g),g,(0,e.scale)(s,k,R,w),w,z,B),B),0!==V&&(N=E(N,(0,e.scale)((0,e.scale)(4,i,R,O),O,V,P),P)),0!==T&&(N=E(N,(0,e.scale)((0,e.scale)(4,u,-R,O),O,T,P),P))}if(0!==U){const s=(0,e.scale)(te,x,U,k);N=E(N,(0,e.sum)((0,e.scale)(Z,f,U,P),P,(0,e.scale)(s,k,2*ke,w),w,A),A);const l=(0,e.scale)(re,y,U,O);N=E(N,(0,e.sum_three)((0,e.scale)(l,O,2*ke,P),P,(0,e.scale)(l,O,U,g),g,(0,e.scale)(s,k,U,w),w,z,B),B)}}if(0!==S||0!==V){if(0!==Q||0!==T||0!==R||0!==U?(Me=Q*ke,xe=ye*U,ue=(fe=(de=(ve=Q-(oe=(ne=e.splitter*Q)-(ne-Q)))*(he=ke-(me=(ne=e.splitter*ke)-(ne-ke)))-(Me-oe*me-ve*me-oe*he))+(je=(ve=ye-(oe=(ne=e.splitter*ye)-(ne-ye)))*(he=U-(me=(ne=e.splitter*U)-(ne-U)))-(xe-oe*me-ve*me-oe*he)))-de,n[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,n[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,n[2]=_e-(qe-ue)+(fe-ue),n[3]=qe,Me=R*(ie=-ge),xe=Oe*(pe=-T),ue=(fe=(de=(ve=R-(oe=(ne=e.splitter*R)-(ne-R)))*(he=ie-(me=(ne=e.splitter*ie)-(ne-ie)))-(Me-oe*me-ve*me-oe*he))+(je=(ve=Oe-(oe=(ne=e.splitter*Oe)-(ne-Oe)))*(he=pe-(me=(ne=e.splitter*pe)-(ne-pe)))-(xe-oe*me-ve*me-oe*he)))-de,o[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,o[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,o[2]=_e-(qe-ue)+(fe-ue),o[3]=qe,se=(0,e.sum)(4,n,4,o,M),Me=Q*U,xe=R*T,ue=(de=(ve=Q-(oe=(ne=e.splitter*Q)-(ne-Q)))*(he=U-(me=(ne=e.splitter*U)-(ne-U)))-(Me-oe*me-ve*me-oe*he))-(fe=de-(je=(ve=R-(oe=(ne=e.splitter*R)-(ne-R)))*(he=T-(me=(ne=e.splitter*T)-(ne-T)))-(xe-oe*me-ve*me-oe*he))),j[0]=de-(fe+ue)+(ue-je),ue=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))-(fe=be-xe),j[1]=be-(fe+ue)+(ue-xe),ue=(qe=_e+fe)-_e,j[2]=_e-(qe-ue)+(fe-ue),j[3]=qe,ce=4):(M[0]=0,se=1,j[0]=0,ce=1),0!==S){const s=(0,e.scale)(se,M,S,k);N=E(N,(0,e.sum)((0,e.scale)($,_,S,P),P,(0,e.scale)(s,k,2*Pe,w),w,A),A);const l=(0,e.scale)(ce,j,S,O);N=E(N,(0,e.sum_three)((0,e.scale)(l,O,2*Pe,P),P,(0,e.scale)(l,O,S,g),g,(0,e.scale)(s,k,S,w),w,z,B),B),0!==T&&(N=E(N,(0,e.scale)((0,e.scale)(4,p,S,O),O,T,P),P)),0!==U&&(N=E(N,(0,e.scale)((0,e.scale)(4,i,-S,O),O,U,P),P))}if(0!==V){const s=(0,e.scale)(se,M,V,k);N=E(N,(0,e.sum)((0,e.scale)(ee,b,V,P),P,(0,e.scale)(s,k,2*we,w),w,A),A);const l=(0,e.scale)(ce,j,V,O);N=E(N,(0,e.sum_three)((0,e.scale)(l,O,2*we,P),P,(0,e.scale)(l,O,V,g),g,(0,e.scale)(s,k,V,w),w,z,B),B)}}return C[N-1]}function G(e,l,t,c,a,r,i,p){const u=e-i,n=t-i,o=a-i,v=l-p,m=c-p,h=r-p,f=n*h,_=o*m,b=u*u+v*v,M=o*v,d=u*h,x=n*n+m*m,j=u*m,q=n*v,y=o*o+h*h,O=b*(f-_)+x*(M-d)+y*(j-q),P=(Math.abs(f)+Math.abs(_))*b+(Math.abs(M)+Math.abs(d))*x+(Math.abs(j)+Math.abs(q))*y,g=s*P;return O>g||-O>g?O:F(e,l,t,c,a,r,i,p,P)}function H(e,s,l,t,c,a,r,i){const p=e-r,u=s-i,n=l-r,o=t-i,v=c-r,m=a-i;return(p*p+u*u)*(n*m-v*o)+(n*n+o*o)*(v*u-p*m)+(v*v+m*m)*(p*o-n*u)}
},{"./util.js":882}],867:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.insphere=et,exports.inspherefast=st;var t=require("./util.js");const e=(16+224*t.epsilon)*t.epsilon,s=(5+72*t.epsilon)*t.epsilon,r=(71+1408*t.epsilon)*t.epsilon*t.epsilon,l=(0,t.vec)(4),i=(0,t.vec)(4),c=(0,t.vec)(4),p=(0,t.vec)(4),a=(0,t.vec)(4),v=(0,t.vec)(4),n=(0,t.vec)(4),u=(0,t.vec)(4),o=(0,t.vec)(4),h=(0,t.vec)(4),b=(0,t.vec)(24),M=(0,t.vec)(24),m=(0,t.vec)(24),f=(0,t.vec)(24),_=(0,t.vec)(24),d=(0,t.vec)(24),g=(0,t.vec)(24),x=(0,t.vec)(24),j=(0,t.vec)(24),q=(0,t.vec)(24),y=(0,t.vec)(1152),O=(0,t.vec)(1152),P=(0,t.vec)(1152),k=(0,t.vec)(1152),w=(0,t.vec)(1152),z=(0,t.vec)(2304),A=(0,t.vec)(2304),B=(0,t.vec)(3456),C=(0,t.vec)(5760),D=(0,t.vec)(8),E=(0,t.vec)(8),F=(0,t.vec)(8),G=(0,t.vec)(16),H=(0,t.vec)(24),I=(0,t.vec)(48),J=(0,t.vec)(48),K=(0,t.vec)(96),L=(0,t.vec)(192),N=(0,t.vec)(384),Q=(0,t.vec)(384),R=(0,t.vec)(384),S=(0,t.vec)(768);function T(e,s,r,l,i,c,p){return(0,t.sum_three)((0,t.scale)(4,e,l,D),D,(0,t.scale)(4,s,i,E),E,(0,t.scale)(4,r,c,F),F,G,p)}function U(e,s,r,l,i,c,p,a,v,n,u,o){const h=(0,t.sum)((0,t.sum)(e,s,r,l,I),I,(0,t.negate)((0,t.sum)(i,c,p,a,J),J),J,K);return(0,t.sum_three)((0,t.scale)((0,t.scale)(h,K,v,L),L,v,N),N,(0,t.scale)((0,t.scale)(h,K,n,L),L,n,Q),Q,(0,t.scale)((0,t.scale)(h,K,u,L),L,u,R),R,S,o)}function V(e,s,r,D,E,F,G,H,I,J,K,L,N,Q,R){let S,V,W,X,Y,Z,$,tt,et,st,rt,lt,it,ct;st=e*E,lt=D*s,S=(rt=(X=e-(W=(V=t.splitter*e)-(V-e)))*(Z=E-(Y=(V=t.splitter*E)-(V-E)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=D-(W=(V=t.splitter*D)-(V-D)))*(Z=s-(Y=(V=t.splitter*s)-(V-s)))-(lt-W*Y-X*Y-W*Z))),l[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),l[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,l[2]=tt-(ct-S)+($-S),l[3]=ct,st=D*H,lt=G*E,S=(rt=(X=D-(W=(V=t.splitter*D)-(V-D)))*(Z=H-(Y=(V=t.splitter*H)-(V-H)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=G-(W=(V=t.splitter*G)-(V-G)))*(Z=E-(Y=(V=t.splitter*E)-(V-E)))-(lt-W*Y-X*Y-W*Z))),i[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),i[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,i[2]=tt-(ct-S)+($-S),i[3]=ct,st=G*K,lt=J*H,S=(rt=(X=G-(W=(V=t.splitter*G)-(V-G)))*(Z=K-(Y=(V=t.splitter*K)-(V-K)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=J-(W=(V=t.splitter*J)-(V-J)))*(Z=H-(Y=(V=t.splitter*H)-(V-H)))-(lt-W*Y-X*Y-W*Z))),c[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),c[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,c[2]=tt-(ct-S)+($-S),c[3]=ct,st=J*Q,lt=N*K,S=(rt=(X=J-(W=(V=t.splitter*J)-(V-J)))*(Z=Q-(Y=(V=t.splitter*Q)-(V-Q)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=N-(W=(V=t.splitter*N)-(V-N)))*(Z=K-(Y=(V=t.splitter*K)-(V-K)))-(lt-W*Y-X*Y-W*Z))),p[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),p[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,p[2]=tt-(ct-S)+($-S),p[3]=ct,st=N*s,lt=e*Q,S=(rt=(X=N-(W=(V=t.splitter*N)-(V-N)))*(Z=s-(Y=(V=t.splitter*s)-(V-s)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=e-(W=(V=t.splitter*e)-(V-e)))*(Z=Q-(Y=(V=t.splitter*Q)-(V-Q)))-(lt-W*Y-X*Y-W*Z))),a[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),a[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,a[2]=tt-(ct-S)+($-S),a[3]=ct,st=e*H,lt=G*s,S=(rt=(X=e-(W=(V=t.splitter*e)-(V-e)))*(Z=H-(Y=(V=t.splitter*H)-(V-H)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=G-(W=(V=t.splitter*G)-(V-G)))*(Z=s-(Y=(V=t.splitter*s)-(V-s)))-(lt-W*Y-X*Y-W*Z))),v[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),v[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,v[2]=tt-(ct-S)+($-S),v[3]=ct,st=D*K,lt=J*E,S=(rt=(X=D-(W=(V=t.splitter*D)-(V-D)))*(Z=K-(Y=(V=t.splitter*K)-(V-K)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=J-(W=(V=t.splitter*J)-(V-J)))*(Z=E-(Y=(V=t.splitter*E)-(V-E)))-(lt-W*Y-X*Y-W*Z))),n[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),n[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,n[2]=tt-(ct-S)+($-S),n[3]=ct,st=G*Q,lt=N*H,S=(rt=(X=G-(W=(V=t.splitter*G)-(V-G)))*(Z=Q-(Y=(V=t.splitter*Q)-(V-Q)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=N-(W=(V=t.splitter*N)-(V-N)))*(Z=H-(Y=(V=t.splitter*H)-(V-H)))-(lt-W*Y-X*Y-W*Z))),u[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),u[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,u[2]=tt-(ct-S)+($-S),u[3]=ct,st=J*s,lt=e*K,S=(rt=(X=J-(W=(V=t.splitter*J)-(V-J)))*(Z=s-(Y=(V=t.splitter*s)-(V-s)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=e-(W=(V=t.splitter*e)-(V-e)))*(Z=K-(Y=(V=t.splitter*K)-(V-K)))-(lt-W*Y-X*Y-W*Z))),o[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),o[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,o[2]=tt-(ct-S)+($-S),o[3]=ct,st=N*E,lt=D*Q,S=(rt=(X=N-(W=(V=t.splitter*N)-(V-N)))*(Z=E-(Y=(V=t.splitter*E)-(V-E)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=D-(W=(V=t.splitter*D)-(V-D)))*(Z=Q-(Y=(V=t.splitter*Q)-(V-Q)))-(lt-W*Y-X*Y-W*Z))),h[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),h[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,h[2]=tt-(ct-S)+($-S),h[3]=ct;const pt=T(l,i,v,I,r,-F,b),at=T(i,c,n,L,F,-I,M),vt=T(c,p,u,R,I,-L,m),nt=T(p,a,o,r,L,-R,f),ut=T(a,l,h,F,R,-r,_),ot=T(l,n,o,L,r,F,d),ht=T(i,u,h,R,F,I,g),bt=T(c,o,v,r,I,L,x),Mt=T(p,h,n,F,L,R,j),mt=T(a,v,u,I,R,r,q),ft=(0,t.sum_three)(U(vt,m,ht,g,Mt,j,at,M,e,s,r,y),y,U(nt,f,bt,x,mt,q,vt,m,D,E,F,O),O,(0,t.sum_three)(U(ut,_,Mt,j,ot,d,nt,f,G,H,I,P),P,U(pt,b,mt,q,ht,g,ut,_,J,K,L,k),k,U(at,M,ot,d,bt,x,pt,b,N,Q,R,w),w,A,B),B,z,C);return C[ft-1]}const W=(0,t.vec)(96),X=(0,t.vec)(96),Y=(0,t.vec)(96),Z=(0,t.vec)(1152);function $(e,s,r,l,i,c,p,a,v,n){const u=T(e,s,r,l,i,c,H);return(0,t.sum_three)((0,t.scale)((0,t.scale)(u,H,p,I),I,p,W),W,(0,t.scale)((0,t.scale)(u,H,a,I),I,a,X),X,(0,t.scale)((0,t.scale)(u,H,v,I),I,v,Y),Y,L,n)}function tt(e,p,a,u,h,b,M,m,f,_,d,g,x,j,q,w){let B,C,D,E,F,G,H,I,J,K,L,N,Q,R,S,T,U,W,X,Y,tt,et,st,rt,lt,it,ct,pt,at,vt,nt;const ut=e-x,ot=u-x,ht=M-x,bt=_-x,Mt=p-j,mt=h-j,ft=m-j,_t=d-j,dt=a-q,gt=b-q,xt=f-q,jt=g-q;pt=ut*mt,vt=ot*Mt,X=(at=(et=ut-(tt=(Y=t.splitter*ut)-(Y-ut)))*(rt=mt-(st=(Y=t.splitter*mt)-(Y-mt)))-(pt-tt*st-et*st-tt*rt))-(lt=at-(nt=(et=ot-(tt=(Y=t.splitter*ot)-(Y-ot)))*(rt=Mt-(st=(Y=t.splitter*Mt)-(Y-Mt)))-(vt-tt*st-et*st-tt*rt))),l[0]=at-(lt+X)+(X-nt),X=(ct=pt-((it=pt+lt)-(X=it-pt))+(lt-X))-(lt=ct-vt),l[1]=ct-(lt+X)+(X-vt),X=(B=it+lt)-it,l[2]=it-(B-X)+(lt-X),l[3]=B,pt=ot*ft,vt=ht*mt,X=(at=(et=ot-(tt=(Y=t.splitter*ot)-(Y-ot)))*(rt=ft-(st=(Y=t.splitter*ft)-(Y-ft)))-(pt-tt*st-et*st-tt*rt))-(lt=at-(nt=(et=ht-(tt=(Y=t.splitter*ht)-(Y-ht)))*(rt=mt-(st=(Y=t.splitter*mt)-(Y-mt)))-(vt-tt*st-et*st-tt*rt))),i[0]=at-(lt+X)+(X-nt),X=(ct=pt-((it=pt+lt)-(X=it-pt))+(lt-X))-(lt=ct-vt),i[1]=ct-(lt+X)+(X-vt),X=(C=it+lt)-it,i[2]=it-(C-X)+(lt-X),i[3]=C,pt=ht*_t,vt=bt*ft,X=(at=(et=ht-(tt=(Y=t.splitter*ht)-(Y-ht)))*(rt=_t-(st=(Y=t.splitter*_t)-(Y-_t)))-(pt-tt*st-et*st-tt*rt))-(lt=at-(nt=(et=bt-(tt=(Y=t.splitter*bt)-(Y-bt)))*(rt=ft-(st=(Y=t.splitter*ft)-(Y-ft)))-(vt-tt*st-et*st-tt*rt))),c[0]=at-(lt+X)+(X-nt),X=(ct=pt-((it=pt+lt)-(X=it-pt))+(lt-X))-(lt=ct-vt),c[1]=ct-(lt+X)+(X-vt),X=(D=it+lt)-it,c[2]=it-(D-X)+(lt-X),c[3]=D,pt=bt*Mt,vt=ut*_t,X=(at=(et=bt-(tt=(Y=t.splitter*bt)-(Y-bt)))*(rt=Mt-(st=(Y=t.splitter*Mt)-(Y-Mt)))-(pt-tt*st-et*st-tt*rt))-(lt=at-(nt=(et=ut-(tt=(Y=t.splitter*ut)-(Y-ut)))*(rt=_t-(st=(Y=t.splitter*_t)-(Y-_t)))-(vt-tt*st-et*st-tt*rt))),o[0]=at-(lt+X)+(X-nt),X=(ct=pt-((it=pt+lt)-(X=it-pt))+(lt-X))-(lt=ct-vt),o[1]=ct-(lt+X)+(X-vt),X=(E=it+lt)-it,o[2]=it-(E-X)+(lt-X),o[3]=E,pt=ut*ft,vt=ht*Mt,X=(at=(et=ut-(tt=(Y=t.splitter*ut)-(Y-ut)))*(rt=ft-(st=(Y=t.splitter*ft)-(Y-ft)))-(pt-tt*st-et*st-tt*rt))-(lt=at-(nt=(et=ht-(tt=(Y=t.splitter*ht)-(Y-ht)))*(rt=Mt-(st=(Y=t.splitter*Mt)-(Y-Mt)))-(vt-tt*st-et*st-tt*rt))),v[0]=at-(lt+X)+(X-nt),X=(ct=pt-((it=pt+lt)-(X=it-pt))+(lt-X))-(lt=ct-vt),v[1]=ct-(lt+X)+(X-vt),X=(F=it+lt)-it,v[2]=it-(F-X)+(lt-X),v[3]=F,pt=ot*_t,vt=bt*mt,X=(at=(et=ot-(tt=(Y=t.splitter*ot)-(Y-ot)))*(rt=_t-(st=(Y=t.splitter*_t)-(Y-_t)))-(pt-tt*st-et*st-tt*rt))-(lt=at-(nt=(et=bt-(tt=(Y=t.splitter*bt)-(Y-bt)))*(rt=mt-(st=(Y=t.splitter*mt)-(Y-mt)))-(vt-tt*st-et*st-tt*rt))),n[0]=at-(lt+X)+(X-nt),X=(ct=pt-((it=pt+lt)-(X=it-pt))+(lt-X))-(lt=ct-vt),n[1]=ct-(lt+X)+(X-vt),X=(G=it+lt)-it,n[2]=it-(G-X)+(lt-X),n[3]=G;const qt=(0,t.sum)((0,t.sum)((0,t.negate)($(i,c,n,jt,gt,-xt,ut,Mt,dt,y),y),y,$(c,o,v,dt,xt,jt,ot,mt,gt,O),O,z),z,(0,t.sum)((0,t.negate)($(o,l,n,gt,jt,dt,ht,ft,xt,P),P),P,$(l,i,v,xt,dt,-gt,bt,_t,jt,k),k,A),A,Z);let yt=(0,t.estimate)(qt,Z),Ot=s*w;if(yt>=Ot||-yt>=Ot)return yt;if(H=e-(ut+(X=e-ut))+(X-x),L=p-(Mt+(X=p-Mt))+(X-j),S=a-(dt+(X=a-dt))+(X-q),I=u-(ot+(X=u-ot))+(X-x),N=h-(mt+(X=h-mt))+(X-j),T=b-(gt+(X=b-gt))+(X-q),J=M-(ht+(X=M-ht))+(X-x),Q=m-(ft+(X=m-ft))+(X-j),U=f-(xt+(X=f-xt))+(X-q),K=_-(bt+(X=_-bt))+(X-x),R=d-(_t+(X=d-_t))+(X-j),W=g-(jt+(X=g-jt))+(X-q),0===H&&0===L&&0===S&&0===I&&0===N&&0===T&&0===J&&0===Q&&0===U&&0===K&&0===R&&0===W)return yt;Ot=r*w+t.resulterrbound*Math.abs(yt);const Pt=ut*N+mt*H-(Mt*I+ot*L),kt=ot*Q+ft*I-(mt*J+ht*N),wt=ht*R+_t*J-(ft*K+bt*Q),zt=bt*L+Mt*K-(_t*H+ut*R),At=ut*Q+ft*H-(Mt*J+ht*L),Bt=ot*R+_t*I-(mt*K+bt*N);return(yt+=(ot*ot+mt*mt+gt*gt)*(xt*zt+jt*At+dt*wt+(U*E+W*F+S*D))+(bt*bt+_t*_t+jt*jt)*(dt*kt-gt*At+xt*Pt+(S*C-T*F+U*B))-((ut*ut+Mt*Mt+dt*dt)*(gt*wt-xt*Bt+jt*kt+(T*D-U*G+W*C))+(ht*ht+ft*ft+xt*xt)*(jt*Pt+dt*Bt+gt*zt+(W*B+S*G+T*E)))+2*((ot*I+mt*N+gt*T)*(xt*E+jt*F+dt*D)+(bt*K+_t*R+jt*W)*(dt*C-gt*F+xt*B)-((ut*H+Mt*L+dt*S)*(gt*D-xt*G+jt*C)+(ht*J+ft*Q+xt*U)*(jt*B+dt*G+gt*E))))>=Ot||-yt>=Ot?yt:V(e,p,a,u,h,b,M,m,f,_,d,g,x,j,q)}function et(t,s,r,l,i,c,p,a,v,n,u,o,h,b,M){const m=t-h,f=l-h,_=p-h,d=n-h,g=s-b,x=i-b,j=a-b,q=u-b,y=r-M,O=c-M,P=v-M,k=o-M,w=m*x,z=f*g,A=w-z,B=f*j,C=_*x,D=B-C,E=_*q,F=d*j,G=E-F,H=d*g,I=m*q,J=H-I,K=m*j,L=_*g,N=K-L,Q=f*q,R=d*x,S=Q-R,T=m*m+g*g+y*y,U=f*f+x*x+O*O,V=_*_+j*j+P*P,W=d*d+q*q+k*k,X=V*(k*A+y*S+O*J)-W*(y*D-O*N+P*A)+(T*(O*G-P*S+k*D)-U*(P*J+k*N+y*G)),Y=Math.abs(y),Z=Math.abs(O),$=Math.abs(P),et=Math.abs(k),st=Math.abs(w),rt=Math.abs(z),lt=Math.abs(B),it=Math.abs(C),ct=Math.abs(E),pt=Math.abs(F),at=Math.abs(H),vt=Math.abs(I),nt=Math.abs(K),ut=Math.abs(L),ot=Math.abs(Q),ht=Math.abs(R),bt=((ct+pt)*Z+(ht+ot)*$+(lt+it)*et)*T+((at+vt)*$+(nt+ut)*et+(ct+pt)*Y)*U+((st+rt)*et+(ot+ht)*Y+(at+vt)*Z)*V+((lt+it)*Y+(ut+nt)*Z+(st+rt)*$)*W,Mt=e*bt;return X>Mt||-X>Mt?X:-tt(t,s,r,l,i,c,p,a,v,n,u,o,h,b,M,bt)}function st(t,e,s,r,l,i,c,p,a,v,n,u,o,h,b){const M=t-o,m=r-o,f=c-o,_=v-o,d=e-h,g=l-h,x=p-h,j=n-h,q=s-b,y=i-b,O=a-b,P=u-b,k=M*g-m*d,w=m*x-f*g,z=f*j-_*x,A=_*d-M*j,B=M*x-f*d,C=m*j-_*g;return(f*f+x*x+O*O)*(P*k+q*C+y*A)-(_*_+j*j+P*P)*(q*w-y*B+O*k)+((M*M+d*d+q*q)*(y*z-O*C+P*w)-(m*m+g*g+y*y)*(O*A+P*B+q*z))}
},{"./util.js":882}],861:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./esm/orient2d.js");Object.defineProperty(exports,"orient2d",{enumerable:!0,get:function(){return e.orient2d}}),Object.defineProperty(exports,"orient2dfast",{enumerable:!0,get:function(){return e.orient2dfast}});var r=require("./esm/orient3d.js");Object.defineProperty(exports,"orient3d",{enumerable:!0,get:function(){return r.orient3d}}),Object.defineProperty(exports,"orient3dfast",{enumerable:!0,get:function(){return r.orient3dfast}});var t=require("./esm/incircle.js");Object.defineProperty(exports,"incircle",{enumerable:!0,get:function(){return t.incircle}}),Object.defineProperty(exports,"incirclefast",{enumerable:!0,get:function(){return t.incirclefast}});var n=require("./esm/insphere.js");Object.defineProperty(exports,"insphere",{enumerable:!0,get:function(){return n.insphere}}),Object.defineProperty(exports,"inspherefast",{enumerable:!0,get:function(){return n.inspherefast}});
},{"./esm/orient2d.js":864,"./esm/orient3d.js":865,"./esm/incircle.js":866,"./esm/insphere.js":867}],819:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("robust-predicates");const i=Math.pow(2,-52),s=new Uint32Array(512);class e{static from(t,i=c,s=u){const h=t.length,n=new Float64Array(2*h);for(let e=0;e<h;e++){const h=t[e];n[2*e]=i(h),n[2*e+1]=s(h)}return new e(n)}constructor(t){const i=t.length>>1;if(i>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const s=Math.max(2*i-5,0);this._triangles=new Uint32Array(3*s),this._halfedges=new Int32Array(3*s),this._hashSize=Math.ceil(Math.sqrt(i)),this._hullPrev=new Uint32Array(i),this._hullNext=new Uint32Array(i),this._hullTri=new Uint32Array(i),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(i),this._dists=new Float64Array(i),this.update()}update(){const{coords:s,_hullPrev:e,_hullNext:h,_hullTri:r,_hullHash:_}=this,c=s.length>>1;let u=1/0,f=1/0,d=-1/0,g=-1/0;for(let t=0;t<c;t++){const i=s[2*t],e=s[2*t+1];i<u&&(u=i),e<f&&(f=e),i>d&&(d=i),e>g&&(g=e),this._ids[t]=t}const y=(u+d)/2,w=(f+g)/2;let b,A,k,x=1/0;for(let t=0;t<c;t++){const i=n(y,w,s[2*t],s[2*t+1]);i<x&&(b=t,x=i)}const S=s[2*b],z=s[2*b+1];x=1/0;for(let t=0;t<c;t++){if(t===b)continue;const i=n(S,z,s[2*t],s[2*t+1]);i<x&&i>0&&(A=t,x=i)}let M=s[2*A],U=s[2*A+1],p=1/0;for(let t=0;t<c;t++){if(t===b||t===A)continue;const i=l(S,z,M,U,s[2*t],s[2*t+1]);i<p&&(k=t,p=i)}let T=s[2*k],K=s[2*k+1];if(p===1/0){for(let t=0;t<c;t++)this._dists[t]=s[2*t]-s[0]||s[2*t+1]-s[1];o(this._ids,this._dists,0,c-1);const t=new Uint32Array(c);let i=0;for(let s=0,e=-1/0;s<c;s++){const h=this._ids[s];this._dists[h]>e&&(t[i++]=h,e=this._dists[h])}return this.hull=t.subarray(0,i),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if((0,t.orient2d)(S,z,M,U,T,K)<0){const t=A,i=M,s=U;A=k,M=T,U=K,k=t,T=i,K=s}const v=a(S,z,M,U,T,K);this._cx=v.x,this._cy=v.y;for(let t=0;t<c;t++)this._dists[t]=n(s[2*t],s[2*t+1],v.x,v.y);o(this._ids,this._dists,0,c-1),this._hullStart=b;let L=3;h[b]=e[k]=A,h[A]=e[b]=k,h[k]=e[A]=b,r[b]=0,r[A]=1,r[k]=2,_.fill(-1),_[this._hashKey(S,z)]=b,_[this._hashKey(M,U)]=A,_[this._hashKey(T,K)]=k,this.trianglesLen=0,this._addTriangle(b,A,k,-1,-1,-1);for(let n,l,a=0;a<this._ids.length;a++){const o=this._ids[a],c=s[2*o],u=s[2*o+1];if(a>0&&Math.abs(c-n)<=i&&Math.abs(u-l)<=i)continue;if(n=c,l=u,o===b||o===A||o===k)continue;let f=0;for(let t=0,i=this._hashKey(c,u);t<this._hashSize&&(-1===(f=_[(i+t)%this._hashSize])||f===h[f]);t++);let d,g=f=e[f];for(;d=h[g],(0,t.orient2d)(c,u,s[2*g],s[2*g+1],s[2*d],s[2*d+1])>=0;)if((g=d)===f){g=-1;break}if(-1===g)continue;let y=this._addTriangle(g,o,h[g],-1,-1,r[g]);r[o]=this._legalize(y+2),r[g]=y,L++;let w=h[g];for(;d=h[w],(0,t.orient2d)(c,u,s[2*w],s[2*w+1],s[2*d],s[2*d+1])<0;)y=this._addTriangle(w,o,d,r[o],-1,r[w]),r[o]=this._legalize(y+2),h[w]=w,L--,w=d;if(g===f)for(;d=e[g],(0,t.orient2d)(c,u,s[2*d],s[2*d+1],s[2*g],s[2*g+1])<0;)y=this._addTriangle(d,o,g,-1,r[g],r[d]),this._legalize(y+2),r[d]=y,h[g]=g,L--,g=d;this._hullStart=e[o]=g,h[g]=e[w]=o,h[o]=w,_[this._hashKey(c,u)]=o,_[this._hashKey(s[2*g],s[2*g+1])]=g}this.hull=new Uint32Array(L);for(let t=0,i=this._hullStart;t<L;t++)this.hull[t]=i,i=h[i];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,i){return Math.floor(h(t-this._cx,i-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:i,_halfedges:e,coords:h}=this;let n=0,l=0;for(;;){const a=e[t],o=t-t%3;if(l=o+(t+2)%3,-1===a){if(0===n)break;t=s[--n];continue}const _=a-a%3,c=o+(t+1)%3,u=_+(a+2)%3,f=i[l],d=i[t],g=i[c],y=i[u];if(r(h[2*f],h[2*f+1],h[2*d],h[2*d+1],h[2*g],h[2*g+1],h[2*y],h[2*y+1])){i[t]=y,i[a]=f;const h=e[u];if(-1===h){let i=this._hullStart;do{if(this._hullTri[i]===u){this._hullTri[i]=t;break}i=this._hullPrev[i]}while(i!==this._hullStart)}this._link(t,h),this._link(a,e[l]),this._link(l,u);const r=_+(a+1)%3;n<s.length&&(s[n++]=r)}else{if(0===n)break;t=s[--n]}}return l}_link(t,i){this._halfedges[t]=i,-1!==i&&(this._halfedges[i]=t)}_addTriangle(t,i,s,e,h,n){const r=this.trianglesLen;return this._triangles[r]=t,this._triangles[r+1]=i,this._triangles[r+2]=s,this._link(r,e),this._link(r+1,h),this._link(r+2,n),this.trianglesLen+=3,r}}function h(t,i){const s=t/(Math.abs(t)+Math.abs(i));return(i>0?3-s:1+s)/4}function n(t,i,s,e){const h=t-s,n=i-e;return h*h+n*n}function r(t,i,s,e,h,n,r,l){const a=t-r,o=i-l,_=s-r,c=e-l,u=h-r,f=n-l,d=_*_+c*c,g=u*u+f*f;return a*(c*g-d*f)-o*(_*g-d*u)+(a*a+o*o)*(_*f-c*u)<0}function l(t,i,s,e,h,n){const r=s-t,l=e-i,a=h-t,o=n-i,_=r*r+l*l,c=a*a+o*o,u=.5/(r*o-l*a),f=(o*_-l*c)*u,d=(r*c-a*_)*u;return f*f+d*d}function a(t,i,s,e,h,n){const r=s-t,l=e-i,a=h-t,o=n-i,_=r*r+l*l,c=a*a+o*o,u=.5/(r*o-l*a);return{x:t+(o*_-l*c)*u,y:i+(r*c-a*_)*u}}function o(t,i,s,e){if(e-s<=20)for(let h=s+1;h<=e;h++){const e=t[h],n=i[e];let r=h-1;for(;r>=s&&i[t[r]]>n;)t[r+1]=t[r--];t[r+1]=e}else{let h=s+1,n=e;_(t,s+e>>1,h),i[t[s]]>i[t[e]]&&_(t,s,e),i[t[h]]>i[t[e]]&&_(t,h,e),i[t[s]]>i[t[h]]&&_(t,s,h);const r=t[h],l=i[r];for(;;){do{h++}while(i[t[h]]<l);do{n--}while(i[t[n]]>l);if(n<h)break;_(t,h,n)}t[s+1]=t[n],t[n]=r,e-h+1>=n-s?(o(t,i,h,e),o(t,i,s,n-1)):(o(t,i,s,n-1),o(t,i,h,e))}}function _(t,i,s){const e=t[i];t[i]=t[s],t[s]=e}function c(t){return t[0]}function u(t){return t[1]}exports.default=e;
},{"robust-predicates":861}],817:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=1e-6;class s{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,s){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+s}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,s){this._+=`L${this._x1=+t},${this._y1=+s}`}arc(s,h,i){const _=(s=+s)+(i=+i),e=h=+h;if(i<0)throw new Error("negative radius");null===this._x1?this._+=`M${_},${e}`:(Math.abs(this._x1-_)>t||Math.abs(this._y1-e)>t)&&(this._+="L"+_+","+e),i&&(this._+=`A${i},${i},0,1,1,${s-i},${h}A${i},${i},0,1,1,${this._x1=_},${this._y1=e}`)}rect(t,s,h,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+s}h${+h}v${+i}h${-h}Z`}value(){return this._||null}}exports.default=s;
},{}],818:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class s{constructor(){this._=[]}moveTo(s,t){this._.push([s,t])}closePath(){this._.push(this._[0].slice())}lineTo(s,t){this._.push([s,t])}value(){return this._.length?this._:null}}exports.default=s;
},{}],557:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./path.js"),e=s(t),i=require("./polygon.js"),n=s(i);function s(t){return t&&t.__esModule?t:{default:t}}class h{constructor(t,[e,i,n,s]=[0,0,960,500]){if(!((n=+n)>=(e=+e)&&(s=+s)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=n,this.xmin=e,this.ymax=s,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:i},vectors:n}=this,s=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let e,n,h=0,l=0,r=i.length;h<r;h+=3,l+=2){const r=2*i[h],o=2*i[h+1],a=2*i[h+2],c=t[r],u=t[r+1],m=t[o],x=t[o+1],g=t[a],d=t[a+1],f=m-c,y=x-u,_=g-c,p=d-u,v=2*(f*p-y*_);if(Math.abs(v)<1e-9){let s=1e9;const h=2*i[0];e=(c+g)/2-(s*=Math.sign((t[h]-c)*p-(t[h+1]-u)*_))*p,n=(u+d)/2+s*_}else{const t=1/v,i=f*f+y*y,s=_*_+p*p;e=c+(p*i-y*s)*t,n=u+(f*s-_*i)*t}s[l]=e,s[l+1]=n}let h,l,r,o=e[e.length-1],a=4*o,c=t[2*o],u=t[2*o+1];n.fill(0);for(let i=0;i<e.length;++i)h=a,l=c,r=u,a=4*(o=e[i]),c=t[2*o],u=t[2*o+1],n[h+2]=n[a]=r-u,n[h+3]=n[a+1]=c-l}render(t){const i=null==t?t=new e.default:void 0,{delaunay:{halfedges:n,inedges:s,hull:h},circumcenters:l,vectors:r}=this;if(h.length<=1)return null;for(let e=0,i=n.length;e<i;++e){const i=n[e];if(i<e)continue;const s=2*Math.floor(e/3),h=2*Math.floor(i/3),r=l[s],o=l[s+1],a=l[h],c=l[h+1];this._renderSegment(r,o,a,c,t)}let o,a=h[h.length-1];for(let e=0;e<h.length;++e){o=a,a=h[e];const i=2*Math.floor(s[a]/3),n=l[i],c=l[i+1],u=4*o,m=this._project(n,c,r[u+2],r[u+3]);m&&this._renderSegment(n,c,m[0],m[1],t)}return i&&i.value()}renderBounds(t){const i=null==t?t=new e.default:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),i&&i.value()}renderCell(t,i){const n=null==i?i=new e.default:void 0,s=this._clip(t);if(null===s||!s.length)return;i.moveTo(s[0],s[1]);let h=s.length;for(;s[0]===s[h-2]&&s[1]===s[h-1]&&h>1;)h-=2;for(let t=2;t<h;t+=2)s[t]===s[t-2]&&s[t+1]===s[t-1]||i.lineTo(s[t],s[t+1]);return i.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,i=t.length/2;e<i;++e){const t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){const e=new n.default;return this.renderCell(t,e),e.value()}_renderSegment(t,e,i,n,s){let h;const l=this._regioncode(t,e),r=this._regioncode(i,n);0===l&&0===r?(s.moveTo(t,e),s.lineTo(i,n)):(h=this._clipSegment(t,e,i,n,l,r))&&(s.moveTo(h[0],h[1]),s.lineTo(h[2],h[3]))}contains(t,e,i){return(e=+e)==e&&(i=+i)==i&&this.delaunay._step(t,e,i)===t}*neighbors(t){const e=this._clip(t);if(e)for(const i of this.delaunay.neighbors(t)){const t=this._clip(i);if(t)t:for(let n=0,s=e.length;n<s;n+=2)for(let h=0,l=t.length;h<l;h+=2)if(e[n]==t[h]&&e[n+1]==t[h+1]&&e[(n+2)%s]==t[(h+l-2)%l]&&e[(n+3)%s]==t[(h+l-1)%l]){yield i;break t}}}_cell(t){const{circumcenters:e,delaunay:{inedges:i,halfedges:n,triangles:s}}=this,h=i[t];if(-1===h)return null;const l=[];let r=h;do{const i=Math.floor(r/3);if(l.push(e[2*i],e[2*i+1]),s[r=r%3==2?r-2:r+1]!==t)break;r=n[r]}while(r!==h&&-1!==r);return l}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(null===e)return null;const{vectors:i}=this,n=4*t;return i[n]||i[n+1]?this._clipInfinite(t,e,i[n],i[n+1],i[n+2],i[n+3]):this._clipFinite(t,e)}_clipFinite(t,e){const i=e.length;let n,s,h,l,r=null,o=e[i-2],a=e[i-1],c=this._regioncode(o,a),u=0;for(let m=0;m<i;m+=2)if(n=o,s=a,o=e[m],a=e[m+1],h=c,c=this._regioncode(o,a),0===h&&0===c)l=u,u=0,r?r.push(o,a):r=[o,a];else{let e,i,m,x,g;if(0===h){if(null===(e=this._clipSegment(n,s,o,a,h,c)))continue;[i,m,x,g]=e}else{if(null===(e=this._clipSegment(o,a,n,s,c,h)))continue;[x,g,i,m]=e,l=u,u=this._edgecode(i,m),l&&u&&this._edge(t,l,u,r,r.length),r?r.push(i,m):r=[i,m]}l=u,u=this._edgecode(x,g),l&&u&&this._edge(t,l,u,r,r.length),r?r.push(x,g):r=[x,g]}if(r)l=u,u=this._edgecode(r[0],r[1]),l&&u&&this._edge(t,l,u,r,r.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(t,e,i,n,s,h){for(;;){if(0===s&&0===h)return[t,e,i,n];if(s&h)return null;let l,r,o=s||h;8&o?(l=t+(i-t)*(this.ymax-e)/(n-e),r=this.ymax):4&o?(l=t+(i-t)*(this.ymin-e)/(n-e),r=this.ymin):2&o?(r=e+(n-e)*(this.xmax-t)/(i-t),l=this.xmax):(r=e+(n-e)*(this.xmin-t)/(i-t),l=this.xmin),s?(t=l,e=r,s=this._regioncode(t,e)):(i=l,n=r,h=this._regioncode(i,n))}}_clipInfinite(t,e,i,n,s,h){let l,r=Array.from(e);if((l=this._project(r[0],r[1],i,n))&&r.unshift(l[0],l[1]),(l=this._project(r[r.length-2],r[r.length-1],s,h))&&r.push(l[0],l[1]),r=this._clipFinite(t,r))for(let e,i=0,n=r.length,s=this._edgecode(r[n-2],r[n-1]);i<n;i+=2)e=s,s=this._edgecode(r[i],r[i+1]),e&&s&&(i=this._edge(t,e,s,r,i),n=r.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(r=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return r}_edge(t,e,i,n,s){for(;e!==i;){let i,h;switch(e){case 5:e=4;continue;case 4:e=6,i=this.xmax,h=this.ymin;break;case 6:e=2;continue;case 2:e=10,i=this.xmax,h=this.ymax;break;case 10:e=8;continue;case 8:e=9,i=this.xmin,h=this.ymax;break;case 9:e=1;continue;case 1:e=5,i=this.xmin,h=this.ymin}n[s]===i&&n[s+1]===h||!this.contains(t,i,h)||(n.splice(s,0,i,h),s+=2)}if(n.length>4)for(let t=0;t<n.length;t+=2){const e=(t+2)%n.length,i=(t+4)%n.length;(n[t]===n[e]&&n[e]===n[i]||n[t+1]===n[e+1]&&n[e+1]===n[i+1])&&(n.splice(e,2),t-=2)}return s}_project(t,e,i,n){let s,h,l,r=1/0;if(n<0){if(e<=this.ymin)return null;(s=(this.ymin-e)/n)<r&&(l=this.ymin,h=t+(r=s)*i)}else if(n>0){if(e>=this.ymax)return null;(s=(this.ymax-e)/n)<r&&(l=this.ymax,h=t+(r=s)*i)}if(i>0){if(t>=this.xmax)return null;(s=(this.xmax-t)/i)<r&&(h=this.xmax,l=e+(r=s)*n)}else if(i<0){if(t<=this.xmin)return null;(s=(this.xmin-t)/i)<r&&(h=this.xmin,l=e+(r=s)*n)}return[h,l]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}}exports.default=h;
},{"./path.js":817,"./polygon.js":818}],556:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("delaunator"),e=h(t),n=require("./path.js"),l=h(n),r=require("./polygon.js"),i=h(r),o=require("./voronoi.js"),s=h(o);function h(t){return t&&t.__esModule?t:{default:t}}const a=2*Math.PI,u=Math.pow;function d(t){return t[0]}function c(t){return t[1]}function f(t){const{triangles:e,coords:n}=t;for(let t=0;t<e.length;t+=3){const l=2*e[t],r=2*e[t+1],i=2*e[t+2];if((n[i]-n[l])*(n[r+1]-n[l+1])-(n[r]-n[l])*(n[i+1]-n[l+1])>1e-10)return!1}return!0}function g(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class v{static from(t,e=d,n=c,l){return new v("length"in t?y(t,e,n,l):Float64Array.from(_(t,e,n,l)))}constructor(t){this._delaunator=new e.default(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&f(t)){this.collinear=Int32Array.from({length:n.length/2},(t,e)=>e).sort((t,e)=>n[2*t]-n[2*e]||n[2*t+1]-n[2*e+1]);const t=this.collinear[0],l=this.collinear[this.collinear.length-1],r=[n[2*t],n[2*t+1],n[2*l],n[2*l+1]],i=1e-8*Math.hypot(r[3]-r[1],r[2]-r[0]);for(let t=0,e=n.length/2;t<e;++t){const e=g(n[2*t],n[2*t+1],i);n[2*t]=e[0],n[2*t+1]=e[1]}this._delaunator=new e.default(n)}else delete this.collinear;const l=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),s=this._hullIndex.fill(-1);for(let t=0,e=l.length;t<e;++t){const e=i[t%3==2?t-2:t+1];-1!==l[t]&&-1!==o[e]||(o[e]=t)}for(let t=0,e=r.length;t<e;++t)s[r[t]]=t;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],o[r[0]]=1,2===r.length&&(o[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(t){return new s.default(this,t)}*neighbors(t){const{inedges:e,hull:n,_hullIndex:l,halfedges:r,triangles:i,collinear:o}=this;if(o){const e=o.indexOf(t);return e>0&&(yield o[e-1]),void(e<o.length-1&&(yield o[e+1]))}const s=e[t];if(-1===s)return;let h=s,a=-1;do{if(yield a=i[h],i[h=h%3==2?h-2:h+1]!==t)return;if(-1===(h=r[h])){const e=n[(l[t]+1)%n.length];return void(e!==a&&(yield e))}}while(h!==s)}find(t,e,n=0){if((t=+t)!=t||(e=+e)!=e)return-1;const l=n;let r;for(;(r=this._step(n,t,e))>=0&&r!==n&&r!==l;)n=r;return r}_step(t,e,n){const{inedges:l,hull:r,_hullIndex:i,halfedges:o,triangles:s,points:h}=this;if(-1===l[t]||!h.length)return(t+1)%(h.length>>1);let a=t,d=u(e-h[2*t],2)+u(n-h[2*t+1],2);const c=l[t];let f=c;do{let l=s[f];const c=u(e-h[2*l],2)+u(n-h[2*l+1],2);if(c<d&&(d=c,a=l),s[f=f%3==2?f-2:f+1]!==t)break;if(-1===(f=o[f])){if((f=r[(i[t]+1)%r.length])!==l&&u(e-h[2*f],2)+u(n-h[2*f+1],2)<d)return f;break}}while(f!==c);return a}render(t){const e=null==t?t=new l.default:void 0,{points:n,halfedges:r,triangles:i}=this;for(let e=0,l=r.length;e<l;++e){const l=r[e];if(l<e)continue;const o=2*i[e],s=2*i[l];t.moveTo(n[o],n[o+1]),t.lineTo(n[s],n[s+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e){void 0!==e||t&&"function"==typeof t.moveTo||(e=t,t=null),e=null==e?2:+e;const n=null==t?t=new l.default:void 0,{points:r}=this;for(let n=0,l=r.length;n<l;n+=2){const l=r[n],i=r[n+1];t.moveTo(l+e,i),t.arc(l,i,e,0,a)}return n&&n.value()}renderHull(t){const e=null==t?t=new l.default:void 0,{hull:n,points:r}=this,i=2*n[0],o=n.length;t.moveTo(r[i],r[i+1]);for(let e=1;e<o;++e){const l=2*n[e];t.lineTo(r[l],r[l+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new i.default;return this.renderHull(t),t.value()}renderTriangle(t,e){const n=null==e?e=new l.default:void 0,{points:r,triangles:i}=this,o=2*i[t*=3],s=2*i[t+1],h=2*i[t+2];return e.moveTo(r[o],r[o+1]),e.lineTo(r[s],r[s+1]),e.lineTo(r[h],r[h+1]),e.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,n=t.length/3;e<n;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new i.default;return this.renderTriangle(t,e),e.value()}}function y(t,e,n,l){const r=t.length,i=new Float64Array(2*r);for(let o=0;o<r;++o){const r=t[o];i[2*o]=e.call(l,r,o,t),i[2*o+1]=n.call(l,r,o,t)}return i}function*_(t,e,n,l){let r=0;for(const i of t)yield e.call(l,i,r,t),yield n.call(l,i,r,t),++r}exports.default=v;
},{"delaunator":819,"./path.js":817,"./polygon.js":818,"./voronoi.js":557}],296:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./delaunay.js");Object.defineProperty(exports,"Delaunay",{enumerable:!0,get:function(){return t(e).default}});var r=require("./voronoi.js");function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"Voronoi",{enumerable:!0,get:function(){return t(r).default}});
},{"./delaunay.js":556,"./voronoi.js":557}],278:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/coin.5839515c.gltf";
},{}],785:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/forest.8f809333.glb";
},{}],786:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grasslands.dcfecd66.glb";
},{}],787:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/hat.53eac66f.gltf";
},{}],788:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-0A3C840A-1259-4342-94A8-476258923E0C.b0d46310.jpg";
},{}],789:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-0DB6312F-078E-464F-9597-198B12899E4D.5c3398d0.jpg";
},{}],790:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-10C9B800-5663-492A-8F3A-BE6D7256387E.ef28b6bd.jpg";
},{}],791:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-19306294-F575-479A-AA37-C2DB5020A469.3074bbfb.jpg";
},{}],792:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-3CA1D1C7-F1C1-46A4-9892-094F299AA6FE.f41b3093.jpg";
},{}],793:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-554D4548-E3F4-4F92-8137-887B88B2E0AD.fb94c877.jpg";
},{}],794:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-5B229F00-724F-42B0-A8B3-3F24E3FDD766.98d47f09.jpg";
},{}],795:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-5E463828-72AC-4402-93B9-F1A30FBAF1A9.7df26cfb.jpg";
},{}],796:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-61639B10-AEB3-4390-AAFD-BA15E257F174.bd1c96cb.jpg";
},{}],797:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-84EECF42-EC52-4843-9D60-A84F2B2F189A.d4914687.jpg";
},{}],798:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-8A5767B2-5854-4C51-B601-B218F4B1CAB3.3482a108.jpg";
},{}],799:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-8BE18773-E490-48B0-8799-F10071581689.c1fddb2e.jpg";
},{}],800:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-95E4709A-A35D-4B74-9CF9-3A00E8805100.902d3828.jpg";
},{}],801:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-9A24D72F-C314-4B3D-83E0-1633769C4335.ea1d5ebe.jpg";
},{}],802:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-B1791F03-1745-4A58-B1B2-E66309AA223F.b8187de8.jpg";
},{}],803:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-C2C4D224-8C13-475F-9702-5A70F0E3EBD7.32856383.jpg";
},{}],804:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-CC6E3490-F52C-48B8-8FC3-E8E0D99C8C34.5cab5fd3.jpg";
},{}],805:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-CFA60390-A98D-4E16-8F6D-09215731619C.219711a6.jpg";
},{}],806:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-E9EACF7C-BD3B-4052-8366-C50F0FC1E6DA.f6b9e431.jpg";
},{}],807:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/origin.4d7fb1e5.glb";
},{}],780:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/sprites-forest-0.b248a6ba.png";
},{}],781:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/sprites-forest-1.87cf3833.png";
},{}],782:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/sprites-grasslands-0.4f622099.png";
},{}],783:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/sprites-origin-0.74e58ada.png";
},{}],784:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/sprites-tundra-0.6668ee83.png";
},{}],808:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tundra.3a1eb508.glb";
},{}],314:[function(require,module,exports) {
module.exports={coin:{gltf:require("./coin.gltf")},forest:{glb:require("./forest.glb")},grasslands:{glb:require("./grasslands.glb")},hat:{gltf:require("./hat.gltf")},"map-0A3C840A-1259-4342-94A8-476258923E0C":{jpg:require("./map-0A3C840A-1259-4342-94A8-476258923E0C.jpg")},"map-0DB6312F-078E-464F-9597-198B12899E4D":{jpg:require("./map-0DB6312F-078E-464F-9597-198B12899E4D.jpg")},"map-10C9B800-5663-492A-8F3A-BE6D7256387E":{jpg:require("./map-10C9B800-5663-492A-8F3A-BE6D7256387E.jpg")},"map-19306294-F575-479A-AA37-C2DB5020A469":{jpg:require("./map-19306294-F575-479A-AA37-C2DB5020A469.jpg")},"map-3CA1D1C7-F1C1-46A4-9892-094F299AA6FE":{jpg:require("./map-3CA1D1C7-F1C1-46A4-9892-094F299AA6FE.jpg")},"map-554D4548-E3F4-4F92-8137-887B88B2E0AD":{jpg:require("./map-554D4548-E3F4-4F92-8137-887B88B2E0AD.jpg")},"map-5B229F00-724F-42B0-A8B3-3F24E3FDD766":{jpg:require("./map-5B229F00-724F-42B0-A8B3-3F24E3FDD766.jpg")},"map-5E463828-72AC-4402-93B9-F1A30FBAF1A9":{jpg:require("./map-5E463828-72AC-4402-93B9-F1A30FBAF1A9.jpg")},"map-61639B10-AEB3-4390-AAFD-BA15E257F174":{jpg:require("./map-61639B10-AEB3-4390-AAFD-BA15E257F174.jpg")},"map-84EECF42-EC52-4843-9D60-A84F2B2F189A":{jpg:require("./map-84EECF42-EC52-4843-9D60-A84F2B2F189A.jpg")},"map-8A5767B2-5854-4C51-B601-B218F4B1CAB3":{jpg:require("./map-8A5767B2-5854-4C51-B601-B218F4B1CAB3.jpg")},"map-8BE18773-E490-48B0-8799-F10071581689":{jpg:require("./map-8BE18773-E490-48B0-8799-F10071581689.jpg")},"map-95E4709A-A35D-4B74-9CF9-3A00E8805100":{jpg:require("./map-95E4709A-A35D-4B74-9CF9-3A00E8805100.jpg")},"map-9A24D72F-C314-4B3D-83E0-1633769C4335":{jpg:require("./map-9A24D72F-C314-4B3D-83E0-1633769C4335.jpg")},"map-B1791F03-1745-4A58-B1B2-E66309AA223F":{jpg:require("./map-B1791F03-1745-4A58-B1B2-E66309AA223F.jpg")},"map-C2C4D224-8C13-475F-9702-5A70F0E3EBD7":{jpg:require("./map-C2C4D224-8C13-475F-9702-5A70F0E3EBD7.jpg")},"map-CC6E3490-F52C-48B8-8FC3-E8E0D99C8C34":{jpg:require("./map-CC6E3490-F52C-48B8-8FC3-E8E0D99C8C34.jpg")},"map-CFA60390-A98D-4E16-8F6D-09215731619C":{jpg:require("./map-CFA60390-A98D-4E16-8F6D-09215731619C.jpg")},"map-E9EACF7C-BD3B-4052-8366-C50F0FC1E6DA":{jpg:require("./map-E9EACF7C-BD3B-4052-8366-C50F0FC1E6DA.jpg")},origin:{glb:require("./origin.glb")},"sprites-forest-0":{png:require("./sprites-forest-0.png")},"sprites-forest-1":{png:require("./sprites-forest-1.png")},"sprites-grasslands-0":{png:require("./sprites-grasslands-0.png")},"sprites-origin-0":{png:require("./sprites-origin-0.png")},"sprites-tundra-0":{png:require("./sprites-tundra-0.png")},tundra:{glb:require("./tundra.glb")}};
},{"./coin.gltf":278,"./forest.glb":785,"./grasslands.glb":786,"./hat.gltf":787,"./map-0A3C840A-1259-4342-94A8-476258923E0C.jpg":788,"./map-0DB6312F-078E-464F-9597-198B12899E4D.jpg":789,"./map-10C9B800-5663-492A-8F3A-BE6D7256387E.jpg":790,"./map-19306294-F575-479A-AA37-C2DB5020A469.jpg":791,"./map-3CA1D1C7-F1C1-46A4-9892-094F299AA6FE.jpg":792,"./map-554D4548-E3F4-4F92-8137-887B88B2E0AD.jpg":793,"./map-5B229F00-724F-42B0-A8B3-3F24E3FDD766.jpg":794,"./map-5E463828-72AC-4402-93B9-F1A30FBAF1A9.jpg":795,"./map-61639B10-AEB3-4390-AAFD-BA15E257F174.jpg":796,"./map-84EECF42-EC52-4843-9D60-A84F2B2F189A.jpg":797,"./map-8A5767B2-5854-4C51-B601-B218F4B1CAB3.jpg":798,"./map-8BE18773-E490-48B0-8799-F10071581689.jpg":799,"./map-95E4709A-A35D-4B74-9CF9-3A00E8805100.jpg":800,"./map-9A24D72F-C314-4B3D-83E0-1633769C4335.jpg":801,"./map-B1791F03-1745-4A58-B1B2-E66309AA223F.jpg":802,"./map-C2C4D224-8C13-475F-9702-5A70F0E3EBD7.jpg":803,"./map-CC6E3490-F52C-48B8-8FC3-E8E0D99C8C34.jpg":804,"./map-CFA60390-A98D-4E16-8F6D-09215731619C.jpg":805,"./map-E9EACF7C-BD3B-4052-8366-C50F0FC1E6DA.jpg":806,"./origin.glb":807,"./sprites-forest-0.png":780,"./sprites-forest-1.png":781,"./sprites-grasslands-0.png":782,"./sprites-origin-0.png":783,"./sprites-tundra-0.png":784,"./tundra.glb":808}],706:[function(require,module,exports) {
module.exports=module.exports={"forest-items-autumn":{type:"forest",boundingBox:[[-15.075365,-.201858,-9.123892],[15.075365,10.988423,9.123892]],boundingCircle:{center:[0,0],radius:17.62135168228842}},"forest-items-dry":{type:"forest",boundingBox:[[-20.1001245,-.166717,-11.677783],[20.1001245,10.988423,11.677783]],boundingCircle:{center:[0,0],radius:23.246195833094696}},"forest-items-triangle":{type:"forest",boundingBox:[[-16.3033225,-.166717,-9.929113000000001],[16.3033225,10.988423,9.929113000000001]],boundingCircle:{center:[0,0],radius:19.088887068285967}},"forest-patch-01":{type:"forest",boundingBox:[[-4.282827470550442,-.225994,-5.5629157463329975],[4.282827470550442,16.013626,5.5629157463329975]],boundingCircle:{center:[0,0],radius:7.020587065431289}},"forest-patch-02":{type:"forest",boundingBox:[[-5.679010180449813,-.8172855571679642,-4.018972643388868],[5.679010180449813,13.773834,4.018972643388867]],boundingCircle:{center:[0,-8.881784197001252e-16],radius:6.9572478565852975}},"forest-patch-03":{type:"forest",boundingBox:[[-7.050933692768162,-2.0237250280074877,-6.357039456992861],[7.05093369277567,16.096272,6.357039456992576]],boundingCircle:{center:[3.754330180072429e-12,-1.4299672557172016e-13],radius:9.493556583158309}},"forest-patch-04":{type:"forest",boundingBox:[[-11.78628,-1.5445471634768424,-7.587937542475294],[11.78628,15.291956,7.5879377151416705]],boundingCircle:{center:[0,8.63331885980756e-8],radius:14.01760299398894}},"forest-patch-05":{type:"forest",boundingBox:[[-12.62494825,-1.5445471634768424,-11.368848],[12.62494825,14.61118,11.368848]],boundingCircle:{center:[0,0],radius:16.989409146944517}},"forest-patch-06":{type:"forest",boundingBox:[[-10.70346825,-1.5445471634768424,-11.918848],[10.70346825,14.61118,11.918848]],boundingCircle:{center:[0,0],radius:16.019462232729975}},"forest-patch-07":{type:"forest",boundingBox:[[-14.5646979992935,-.3694360944802759,-17.295879783627747],[14.564697999293498,20.0170325,17.295879783627747]],boundingCircle:{center:[0,0],radius:22.6114547364898}},"forest-patch-08":{type:"forest",boundingBox:[[-18.971581498912506,-.327765,-18.083026509657323],[18.971581498912506,1.856911,18.083026509657323]],boundingCircle:{center:[0,0],radius:26.209096747481567}},"forest-patch-09":{type:"forest",boundingBox:[[-8.731351668853138,-.327765,-6.684054056717754],[8.73135166885314,1.486463,6.684054056717753]],boundingCircle:{center:[1.7763568394002505e-15,0],radius:10.996048408328765}},"forest-patch-10":{type:"forest",boundingBox:[[-11.197153498005997,-.268145,-7.866099509657324],[11.197153498006,1.856911,7.866099509657323]],boundingCircle:{center:[1.7763568394002505e-15,-8.881784197001252e-16],radius:13.683996782875212}},"forest-patch-11":{type:"forest",boundingBox:[[-8.983995498912504,-.268145,-7.866099509657324],[8.983995498912506,1.486463,7.866099509657323]],boundingCircle:{center:[1.7763568394002505e-15,-8.881784197001252e-16],radius:11.941009028566695}},"forest-patch-12":{type:"forest",boundingBox:[[-7.330616433621152,-.3694360944802759,-8.510333287792683],[7.330616433621153,14.043758,8.510333287792681]],boundingCircle:{center:[0,0],radius:11.232262014669562}},"forest-patch-13":{type:"forest",boundingBox:[[-14.2951739443525,-.6105425455860001,-8.432619685039],[14.2951739443525,14.967650787505,8.432619685039]],boundingCircle:{center:[0,0],radius:16.597019999138457}},"forest-patch-14":{type:"forest",boundingBox:[[-9.470601411567001,-.6105425455860001,-7.050573921378],[9.470601411567,13.472909359065,7.050573921378]],boundingCircle:{center:[-1.7763568394002505e-15,0],radius:11.806899835163776}},"forest-patch-15":{type:"forest",boundingBox:[[-6.347426777728752,-.34234517972188266,-8.205905287232017],[6.347426777728751,14.967650787505,8.205905287232017]],boundingCircle:{center:[-8.881784197001252e-16,0],radius:10.37432929309892}},"forest-patch-16":{type:"forest",boundingBox:[[-13.431709136212001,-.6105425455860001,-8.432619685039],[13.431709136212001,14.967650787505,8.432619685039]],boundingCircle:{center:[0,0],radius:15.859378457944317}},"forest-patch-17":{type:"forest",boundingBox:[[-7.59376126906725,-.6105425455860001,-7.050573921378],[7.593761269067249,14.482444680213,7.050573921378]],boundingCircle:{center:[-8.881784197001252e-16,0],radius:10.3622296265042}},"forest-patch-18":{type:"forest",boundingBox:[[-5.5603789513075,-.03805385048043891,-8.205905287232017],[5.560378951307501,14.967650787505,8.205905287232017]],boundingCircle:{center:[0,0],radius:9.912350662943975}},"origin-patch-0":{type:"origin",boundingBox:[[-5.280339000000001,-.2832338416705871,-5.668591315287967],[5.001145,10.19964,3.65937712011832]],boundingCircle:{center:[-.1395970000000002,-1.004607097584823],radius:6.941179805591266}},"tundra-items-basic":{type:"tundra",boundingBox:[[-8.8325125,-.13764725184078516,-11.163409000000001],[8.8325125,3.927917,11.163409000000001]],boundingCircle:{center:[0,0],radius:14.23499130888169}},"tundra-items-ice":{type:"tundra",boundingBox:[[-10.259167378689172,-.4111513000239432,-8.718396812160492],[10.25916737868917,1.1697286148071289,8.718396812160492]],boundingCircle:{center:[-1.7763568394002505e-15,0],radius:13.463318991922097}},"tundra-patch-rock-01":{type:"tundra",boundingBox:[[-8.469741291864153,-.22670792279715837,-11.065931719579186],[8.469741291864157,6.068279626955509,11.065931719579186]],boundingCircle:{center:[1.7763568394002505e-15,0],radius:13.935256092856616}},"tundra-patch-rock-02":{type:"tundra",boundingBox:[[-16.520271783891413,-.6568209019796876,-11.133370217871766],[16.52027178389141,10.381391628779411,11.133370217871768]],boundingCircle:{center:[-3.552713678800501e-15,1.7763568394002505e-15],radius:19.92162925620876}},"tundra-patch-rock-03":{type:"tundra",boundingBox:[[-10.268560327452711,-3.6310188780527115,-9.497291529625407],[10.018307334331904,4.905083811461026,9.49729152966382]],boundingCircle:{center:[-.1251264965604033,1.9205970147595508e-11],radius:13.895603487461416}},"tundra-patch-rock-04":{type:"tundra",boundingBox:[[-7.87126668514793,-2.1669320795611555,-8.236571820530331],[7.871266685387804,2.4768795429526858,8.236571820530333]],boundingCircle:{center:[1.199369492610458e-10,1.7763568394002505e-15],radius:11.392890528104013}},"tundra-patch-rock-05":{type:"tundra",boundingBox:[[-9.35049296050986,-3.0744205886997986,-8.983492483035336],[9.350493216352906,4.3417406702058505,8.983492484233793]],boundingCircle:{center:[1.279215222638186e-7,5.992273344190835e-10],radius:12.966682621253662}},"tundra-patch-rock-06":{type:"tundra",boundingBox:[[-14.893484516967165,-5.467920771498083,-14.308852236946258],[14.063264769059757,6.345591006819735,13.383327007132198]],boundingCircle:{center:[-.41510987395370513,-.46276261490702986],radius:20.033410346843034}},"tundra-patch-rock-07":{type:"tundra",boundingBox:[[-14.407030459073379,-5.467920771498083,-9.779526112076555],[13.576810711165969,5.790646771498082,9.779526112076555]],boundingCircle:{center:[-.41510987395370513,0],radius:17.070822260133895}},"tundra-patch-rock-08":{type:"tundra",boundingBox:[[-11.606490749999999,-4.038116878052712,-8.678903948533314],[11.60649075,4.8079788993186945,8.678903704277717]],boundingCircle:{center:[0,-1.2212779765263804e-7],radius:14.49254978110587}},"grasslands-items-field":{type:"grasslands",boundingBox:[[-7.623313964143387,-.174038,-10.987582973752348],[7.623313964143387,2.62681,10.98758297375235]],boundingCircle:{center:[0,1.7763568394002505e-15],radius:13.373178208675606}},"grasslands-items-water":{type:"grasslands",boundingBox:[[-4.323165250000001,-.0691744677450005,-2.7235592888081],[4.32316525,1.8051,2.7235592888081]],boundingCircle:{center:[0,0],radius:5.109553109466663}},"grasslands-items-wet":{type:"grasslands",boundingBox:[[-7.412936621334076,0,-9.3358775],[7.412936621334076,1.887006,9.3358775]],boundingCircle:{center:[0,0],radius:11.920999876139675}},"grasslands-items-yellow":{type:"grasslands",boundingBox:[[-9.128126714143386,-.05953242321757357,-10.987582973752348],[9.128126714143386,1.847419,10.98758297375235]],boundingCircle:{center:[0,1.7763568394002505e-15],radius:14.284595791080358}},"grasslands-patch-01":{type:"grasslands",boundingBox:[[-14.959938216016791,-3.6909649259600004,-15.666905179722484],[14.959938216016791,4.328240447011341,15.666905179722482]],boundingCircle:{center:[0,0],radius:21.66221755355289}},"grasslands-patch-02":{type:"grasslands",boundingBox:[[-15.080166880418545,-.7677941213827133,-15.51645185207366],[15.080166880418542,4.411131786013842,15.51645185207366]],boundingCircle:{center:[-1.7763568394002505e-15,0],radius:21.63727596577241}},"grasslands-patch-03":{type:"grasslands",boundingBox:[[-14.960831770021974,-.7677941213827133,-9.253754335327436],[14.960831770021972,4.411131786013842,9.253754335327436]],boundingCircle:{center:[-1.7763568394002505e-15,0],radius:17.59143133885046}},"grasslands-patch-04":{type:"grasslands",boundingBox:[[-11.609907879139005,-.7408588420858384,-10.60802881274413],[11.609907879139005,5.171772259669173,10.60802881274413]],boundingCircle:{center:[0,0],radius:15.726418417875813}},"grasslands-patch-05":{type:"grasslands",boundingBox:[[-10.771474194501113,-1.108371,-9.920363270294326],[10.771474194501112,4.488878414156625,9.920363270294327]],boundingCircle:{center:[0,1.7763568394002505e-15],radius:14.643710722948887}},"grasslands-patch-06":{type:"grasslands",boundingBox:[[-8.876350413088124,-.360653,-8.983931123813939],[8.876350413088124,3.158583462026596,8.983931123813939]],boundingCircle:{center:[0,0],radius:12.629355292071029}},"grasslands-patch-07":{type:"grasslands",boundingBox:[[-15.12404227126358,-.437882,-15.125275886896539],[15.12404227126358,2.64724140059495,15.125275886896539]],boundingCircle:{center:[0,0],radius:21.389498013691238}},"grasslands-patch-08":{type:"grasslands",boundingBox:[[-15.495199489332597,-.437882,-15.53378018801633],[15.495199489332599,2.64724140059495,15.533780188016332]],boundingCircle:{center:[1.7763568394002505e-15,0],radius:21.940818903218307}},"grasslands-patch-09":{type:"grasslands",boundingBox:[[-15.495199489332597,-.437882,-15.53378018801633],[15.495199489332599,2.64724140059495,15.533780188016332]],boundingCircle:{center:[1.7763568394002505e-15,0],radius:21.940818903218307}},"grasslands-patch-10":{type:"grasslands",boundingBox:[[-15.204815010466952,-.437882,-15.125275886896539],[15.204815010466952,1.4065690000000002,15.125275886896539]],boundingCircle:{center:[0,0],radius:21.446686694155233}},"grasslands-patch-11":{type:"grasslands",boundingBox:[[-6.212267913747341,-.053716637376036436,-7.429459542071392],[6.2122679137473416,4.328240447011341,7.429459542071392]],boundingCircle:{center:[8.881784197001252e-16,0],radius:9.684479424287627}},"grasslands-patch-wetlands-01":{type:"grasslands",boundingBox:[[-7.17840425,-.477838,-4.578204980444312],[7.17840425,1.893844,4.578204980444312]],boundingCircle:{center:[0,0],radius:8.514073550268588}},"grasslands-patch-wetlands-02":{type:"grasslands",boundingBox:[[-6.306689158825398,-.743551,-4.0401339732815025],[6.306689158825398,1.893844,4.0401339732815025]],boundingCircle:{center:[0,0],radius:7.489793766727438}},"grasslands-patch-wetlands-03":{type:"grasslands",boundingBox:[[-7.119687073700281,-.477838,-4.3895528552785725],[7.119687073700281,3.1333588074259757,4.389552855278571]],boundingCircle:{center:[0,-8.881784197001252e-16],radius:8.364096980349949}},"grasslands-patch-wetlands-04":{type:"grasslands",boundingBox:[[-5.479535,-.1604245623280853,-3.483777072610855],[5.479535,2.1422665485835077,3.483777072610855]],boundingCircle:{center:[0,0],radius:6.493227741876459}},"grasslands-patch-wetlands-05":{type:"grasslands",boundingBox:[[-6.196706936844499,-.477838,-5.6178066792835],[6.1967069368445,1.893844,5.617806679283499]],boundingCircle:{center:[8.881784197001252e-16,-8.881784197001252e-16],radius:8.364145428370973}},"grasslands-patch-wetlands-06":{type:"grasslands",boundingBox:[[-9.886904918619768,-.477838,-6.46925514625175],[9.886904918619766,1.929008,6.469255146251749]],boundingCircle:{center:[-1.7763568394002505e-15,-8.881784197001252e-16],radius:11.815335417038844}},"grasslands-patch-wetlands-07":{type:"grasslands",boundingBox:[[-6.402575567778268,-.477838,-5.982054236971601],[6.402575567778268,1.929008,5.982054236971601]],boundingCircle:{center:[0,0],radius:8.762302596645535}}};
},{}],841:[function(require,module,exports) {
module.exports=module.exports={name:"sprites-forest",frames:[[{id:"67294C14-EF1A-4AF8-BB5F-8931621A01F8",x:2,y:2,w:706,h:256},{id:"D3023B91-0D14-4C90-8F6D-2CA9E616804A",x:2,y:260,w:706,h:256},{id:"15FDCF1E-B75B-4AD5-9A1F-51462126B983",x:2,y:518,w:660,h:256},{id:"D0C25487-3087-47CD-B9C8-FC37D7E87396",x:664,y:518,w:660,h:256},{id:"9F9AFA55-44A5-4539-8066-786C33BFA3CF",x:710,y:2,w:580,h:154},{id:"694CC69A-37B1-4108-BD6B-BD6D80C765A5",x:710,y:158,w:580,h:154},{id:"3C4AE536-1BCE-48D7-90E0-6EA95120DB56",x:2,y:776,w:319,h:512},{id:"200B1345-E245-4BD6-A133-D362B8C79468",x:323,y:776,w:284,h:512},{id:"7FD2B13D-374A-4FBA-B0B8-6AFF6D0AD473",x:609,y:776,w:255,h:512},{id:"5200A118-22E4-446B-B07F-E1AB2D8275D7",x:866,y:776,w:243,h:512},{id:"474D93F1-70A8-4B81-BAB1-83CDEF88983B",x:2,y:1290,w:280,h:512},{id:"FB1FE2FA-8594-492D-8A27-7C3268B0302B",x:284,y:1290,w:354,h:512},{id:"76635BA8-2B70-45C0-8284-5009E6C13D3A",x:640,y:1290,w:354,h:512},{id:"BB410FB3-19E2-42EC-B23A-1A065363C543",x:996,y:1290,w:243,h:512},{id:"64135345-B589-4847-9449-CE88B327F315",x:1111,y:776,w:150,h:512},{id:"E113EB20-B7F7-46BD-9065-A91588D2A1EC",x:1241,y:1290,w:169,h:512},{id:"B7B3A496-E705-4973-B0FF-BA1D43B42F4F",x:1263,y:776,w:256,h:512},{id:"6FDC8BD1-0459-49DA-A212-611A7E9F607F",x:1412,y:1290,w:312,h:501},{id:"6A045629-CB5F-45ED-974F-7F4F5EEC138D",x:1292,y:2,w:312,h:501},{id:"A4FD1645-A4D5-4A87-95BB-DE692A857F7B",x:1521,y:505,w:312,h:501},{id:"7946261F-3A99-4652-802B-58EDAC13FB69",x:710,y:314,w:472,h:125},{id:"C9587649-B939-45E8-9097-F909053FD963",x:2,y:1804,w:472,h:125},{id:"E409C6F3-5350-473F-9957-CC005E66DA10",x:1521,y:1008,w:333,h:256},{id:"D5E397E9-F9CC-4430-8403-CD74DDB4A09A",x:1606,y:2,w:214,h:256},{id:"4DEBC28F-CC95-4631-B620-86E50A2282D1",x:1326,y:505,w:184,h:256},{id:"9B20BD15-62FA-4669-8829-13981D18F6FE",x:1726,y:1266,w:113,h:256},{id:"7E224099-CB10-480E-AA42-BDA2C5EE2DCE",x:1606,y:260,w:151,h:181},{id:"72C6CB9C-EF46-46E5-B277-D4A082D0C704",x:1856,y:2,w:151,h:181},{id:"7A047DBE-B785-4A6F-A7D1-18654BEC802F",x:476,y:1804,w:52,h:106},{id:"C5F6AD70-D605-40AD-8055-143DAC798B46",x:530,y:1804,w:60,h:83},{id:"C342A4B3-66C6-45E5-A39F-FBC4FE5A085E",x:592,y:1804,w:60,h:83}],[{id:"E44FE03F-EC29-4753-AF0E-895B951AFD42",x:2,y:2,w:488,h:256},{id:"34E60BA5-7E9D-4BDA-B6E5-19E474F18C84",x:2,y:260,w:488,h:256},{id:"1F644C9D-CE32-4667-A423-212879544372",x:492,y:2,w:431,h:143},{id:"77BF338F-5948-4A23-900D-652440F7C5A7",x:492,y:147,w:348,h:185},{id:"4F18AF0D-5A0E-43BD-B5DC-D7AB1AE2F51B",x:492,y:334,w:300,h:175},{id:"2150843C-15A9-4274-980E-3244D20CAA59",x:2,y:518,w:292,h:256},{id:"A65F86AF-621C-4D69-9383-232F4A045463",x:296,y:518,w:286,h:256},{id:"531C91F2-2508-469A-8117-E2E981EA6A33",x:584,y:511,w:257,h:203},{id:"35B446D4-87AC-452F-AC6C-F88D4F38CD8A",x:2,y:776,w:214,h:256},{id:"3111DE17-2B61-4EBE-8BA4-D7EC477AD571",x:218,y:776,w:213,h:256},{id:"55DFC82B-9970-44B3-A887-654CA5BB772D",x:433,y:776,w:233,h:256},{id:"A32211DA-F0B6-4449-A465-66015AC5ABE5",x:668,y:716,w:249,h:256}]],images:[{width:2010,height:1931},{width:925,height:1034}]};
},{}],842:[function(require,module,exports) {
module.exports=module.exports={name:"sprites-grasslands",frames:[[{id:"272CEE5F-A472-4CA5-A600-88C97949B9D1",x:2,y:2,w:613,h:256},{id:"92C81C7F-4C91-4A70-BA1B-B2B2B1E47A9B",x:2,y:260,w:564,h:256},{id:"FE57E7C9-22FB-44A6-93B4-2045102DDF6B",x:2,y:518,w:462,h:256},{id:"6FA38119-6C0C-44F3-889F-496E8D51D25A",x:617,y:2,w:379,h:248},{id:"14D5CD8C-26D1-4B3E-B5CB-6268B7F2910D",x:466,y:518,w:319,h:256},{id:"C1A7A698-9EBB-4B24-932E-72D6120A3FFB",x:568,y:260,w:319,h:256},{id:"447CCD67-AA9F-4D4D-831E-2D4B4AC39FA3",x:2,y:776,w:319,h:256},{id:"BB607FAF-EF57-4EC6-853B-4F8AA9D94099",x:323,y:776,w:319,h:256},{id:"87C25A5F-357A-4ED4-AE02-C3BC9A00B125",x:644,y:776,w:284,h:197},{id:"4282A509-F0EE-4B3A-8A0A-3716682CBA18",x:787,y:518,w:59,h:256},{id:"26F6F112-A247-43B6-A304-A096C69397C3",x:848,y:518,w:59,h:256},{id:"38583CBC-4C68-47B6-8AC2-762F789EC3A5",x:889,y:252,w:77,h:256},{id:"656660D5-68B2-4509-854E-A6FA2D70D809",x:998,y:2,w:129,h:256},{id:"8225022F-694B-4EE7-AE15-A87FB613D243",x:909,y:510,w:151,h:256},{id:"10476B9E-A1C7-4BA0-BC31-B580E3A2D252",x:930,y:768,w:151,h:256},{id:"997789AE-F835-4778-95A7-A35CD2E43E4D",x:2,y:1034,w:128,h:256},{id:"2D285696-01B4-4459-AD74-4BB85BA63FCF",x:132,y:1034,w:224,h:256},{id:"4A747DC3-EF7B-492A-96DD-F862FBDBFDB5",x:358,y:1034,w:140,h:256},{id:"159F5249-279B-4252-82C4-C41A0F0B7BC0",x:500,y:1034,w:179,h:256},{id:"177F1D36-0623-4ACF-91FF-3D7119452232",x:681,y:1026,w:150,h:256},{id:"39B9478E-3AAE-4D2B-93B6-CB8C4EECFC80",x:833,y:1026,w:224,h:256},{id:"AD1BF24C-4FD3-4FCF-93EA-09E93B2E313B",x:1129,y:2,w:215,h:256},{id:"F342F4E7-C2C0-4E3C-9FB7-93349C420A46",x:968,y:252,w:25,h:256},{id:"8D0A87D9-B1F6-48C1-8F04-CD1F59BE22F3",x:1059,y:1026,w:215,h:256},{id:"4895E2C7-D5D5-4D02-88CE-77E1BBA9913D",x:1083,y:260,w:88,h:256},{id:"E55BD68A-8FD1-45D1-A01F-43CB85807C59",x:1276,y:260,w:47,h:256},{id:"4E515EB2-B904-442B-BCDB-7D671447F7C6",x:1173,y:260,w:88,h:256},{id:"14B6073B-71AD-4486-B074-1FC52F371FDB",x:1083,y:518,w:173,h:256},{id:"8CBE7088-0036-4A84-90B3-F8A42FE538B8",x:2,y:1292,w:248,h:256},{id:"DA1E3CE8-278B-47B9-BF7B-438E5F5BF687",x:252,y:1292,w:176,h:256},{id:"66A3A3B8-1F1A-4CFF-8D90-CA6045326BBD",x:430,y:1292,w:113,h:256},{id:"28B0D1BD-9F16-4B35-8B58-B4AEAD15134D",x:545,y:1292,w:214,h:256},{id:"C9DAEE46-E76B-4E1F-9FA5-D4B631BE3BB0",x:761,y:1284,w:190,h:256},{id:"C17EE260-68CC-4154-8486-E556444748A0",x:953,y:1284,w:224,h:256},{id:"78B40147-FE41-47F1-A198-08E7F1666C6F",x:1179,y:1284,w:113,h:256},{id:"845BAF92-DAA7-4D5B-AC73-5F1FCB0D98A2",x:1346,y:2,w:176,h:256},{id:"4A3A388F-7316-46A6-A459-79BB449DE3BF",x:1294,y:518,w:224,h:256},{id:"FF97616C-0E3F-4DD7-B21D-9C62E034E1C5",x:1325,y:260,w:100,h:256},{id:"829BF8AC-A4B1-4BF8-8376-04162F33CD76",x:1294,y:776,w:153,h:256},{id:"596C0606-0D9C-436F-9760-75258E264B0D",x:1294,y:1034,w:153,h:256},{id:"42343ABE-D860-4F4D-B74D-1E2809226F61",x:1294,y:1292,w:100,h:256},{id:"DB5AFCB3-5F84-4E19-93B6-30A3C6C12959",x:1427,y:260,w:173,h:256},{id:"B28BDFF1-A351-4EB0-B74D-25BD39CBF590",x:1396,y:1292,w:125,h:256},{id:"328AD96F-C60B-4B4E-A543-0AD2A427204E",x:1524,y:2,w:145,h:256},{id:"99136B7E-AD50-43D6-BB49-3F35B179353B",x:1083,y:776,w:188,h:238},{id:"9FB4FF7E-DD1E-485D-9E08-270C3CC75DCF",x:1449,y:776,w:188,h:238},{id:"6DD1ADCB-DC65-4F60-994B-2A2769506F72",x:1449,y:1016,w:188,h:238},{id:"C407E6EC-8BC1-4588-B03A-045C6D2214E3",x:1523,y:1256,w:158,h:216},{id:"37870464-078A-456E-BEDB-B1F56233DF2A",x:995,y:260,w:72,h:186},{id:"E1E25202-78F2-48E4-9326-31ECF38B57F2",x:1520,y:518,w:118,h:179},{id:"7F355756-B79B-420F-827A-88185C25E4B9",x:2,y:1550,w:118,h:179},{id:"83586F94-349F-48B1-8E6F-31A2D035C3FB",x:122,y:1550,w:118,h:179},{id:"23B4A43A-76A1-4364-B844-2E22D6C7C7AD",x:242,y:1550,w:118,h:179},{id:"F7A31617-D992-4797-AD56-01D72E9C7A57",x:1523,y:1474,w:173,h:107},{id:"FB695BDB-085E-4533-85EA-35CA6927534D",x:1520,y:699,w:157,h:69},{id:"0D478784-C3EB-4028-AA86-1999670A0885",x:1602,y:260,w:84,h:149},{id:"CE380EE5-CBF2-41E8-A056-B91DC3B7AE14",x:362,y:1583,w:146,h:69},{id:"157E3CF4-FEB6-4558-A985-9F59E0CF9DF1",x:510,y:1583,w:73,h:124}]],images:[{width:1699,height:1731}]};
},{}],843:[function(require,module,exports) {
module.exports=module.exports={name:"sprites-origin",frames:[[{id:"C814F21A-DCEF-47F0-A4B1-5D18493C9FCD",x:2,y:2,w:512,h:512}]],images:[{width:516,height:516}]};
},{}],844:[function(require,module,exports) {
module.exports=module.exports={name:"sprites-tundra",frames:[[{id:"2ADEE4BA-D634-4AE2-9E34-847720036905",x:2,y:2,w:423,h:256},{id:"0C1AFF0C-B255-4053-8F3E-7978F605B5D0",x:2,y:260,w:397,h:256},{id:"EBD22B3A-DD03-4BB8-ACB3-01749D82A483",x:401,y:260,w:372,h:256},{id:"5E4192AF-6D8D-4989-AC17-D590045E491B",x:427,y:2,w:288,h:256},{id:"8EEE2A15-69BE-4517-BF3B-3BC21A9CB6D8",x:2,y:518,w:288,h:256},{id:"B1F97040-C8B3-43B4-AEDC-62832559C2A5",x:292,y:518,w:285,h:256},{id:"22F536A6-14AD-49CC-8E3D-EE8D9FC21E0E",x:579,y:518,w:164,h:256},{id:"F6608748-5508-4CB3-BF1E-92DB889FDDAC",x:2,y:776,w:102,h:256},{id:"07A77C07-3CEA-42C3-8F5A-80A3CF6C0207",x:106,y:776,w:112,h:256},{id:"051EF604-6EA1-467A-BEE6-65416C43E48D",x:220,y:776,w:157,h:256},{id:"775CCE63-C68E-4A1E-BEEB-85C25EA90573",x:379,y:776,w:95,h:256},{id:"AF28AE6A-0DC7-4939-8D49-80B5D2289AE5",x:476,y:776,w:141,h:256},{id:"49E1172E-8FE2-42F3-9E51-71527EC1051E",x:619,y:776,w:161,h:256},{id:"E1B090AE-7227-4E22-9F91-3523A71E9852",x:717,y:2,w:147,h:256},{id:"247C70CB-47F4-41AB-99A6-870C24E6D8B5",x:745,y:518,w:147,h:256},{id:"F6BC2B99-0869-4309-A283-F101EF7F1DF0",x:775,y:260,w:105,h:256},{id:"82F07511-B165-43BB-82A0-3DCB8CED9CB6",x:782,y:776,w:163,h:256},{id:"B7BF4F8D-67AE-474B-B7A9-621D961AF81D",x:866,y:2,w:159,h:256},{id:"AC17F6A7-D39E-4EC7-AD53-3DB7F7382C0B",x:882,y:260,w:158,h:256},{id:"BE472EC6-4177-4DE5-A8AE-B9179F5FD73D",x:894,y:518,w:207,h:256},{id:"682EEA65-3EEB-4D5B-9A15-C29397F47783",x:2,y:1034,w:204,h:256},{id:"24B4566B-D599-4096-B720-8E81B15BA4CF",x:208,y:1034,w:205,h:256},{id:"2A08376C-C912-40B9-A013-A505DE480FD3",x:415,y:1034,w:204,h:256},{id:"5096DBF2-2498-4053-BBC6-56DCE99A4CFA",x:621,y:1034,w:105,h:256},{id:"FDE9698A-B5C6-4669-8849-FA2740AFA2F5",x:728,y:1034,w:105,h:256},{id:"209C5714-30A8-4438-A5F5-2ADF19A061EA",x:835,y:1034,w:105,h:256},{id:"B67B0A7A-A20F-41BB-8678-B7E2D8FF17B5",x:942,y:1034,w:105,h:256},{id:"9D1E1373-0BD4-489E-928B-B14480890D02",x:947,y:776,w:105,h:256},{id:"0460DCAA-ED7A-4F59-A337-B1622C92E62D",x:1027,y:2,w:105,h:256},{id:"2B3AD1B2-0277-4C92-8105-48A1B395C9E9",x:1049,y:1034,w:232,h:256},{id:"8ADAC56A-2108-4C19-8D4A-2815DC1B82E2",x:1042,y:260,w:232,h:256},{id:"A5B847C2-6951-4E21-9055-520B0EC7F1AD",x:1054,y:776,w:215,h:256},{id:"E438792C-F36B-4D86-91B1-980207835107",x:1134,y:2,w:232,h:256},{id:"206B9D1C-15C0-4887-9E46-9DB46E052C84",x:1103,y:518,w:161,h:256},{id:"B8F11F36-5A33-4DA4-8DC7-3C3461C64EA0",x:2,y:1292,w:204,h:256},{id:"446682BA-30CD-472C-A05C-87863D6CA8B4",x:1266,y:518,w:113,h:239},{id:"8E5EC789-52F4-4603-9835-1726FEF2835A",x:208,y:1292,w:188,h:238},{id:"41441AC2-F2C2-4A8F-860F-63EE69FBF3D4",x:398,y:1292,w:188,h:238},{id:"044B0250-2E97-4675-A25F-DEF4933070CB",x:588,y:1292,w:226,h:159},{id:"EFE8E349-BB06-45B0-8C90-CEFF7C91DDF1",x:816,y:1292,w:204,h:141},{id:"2547E4A8-05BC-4344-A43D-D57E894FD4FF",x:1283,y:759,w:123,h:185},{id:"EA3AD5F2-3868-4FA3-B74D-6C8D15220124",x:1283,y:946,w:118,h:179},{id:"0E194309-4864-4FDF-A71E-FDE2C49EF348",x:1283,y:1127,w:118,h:179},{id:"4601ADDE-E3F7-4B72-9123-5B44D27B8DDF",x:1276,y:260,w:118,h:179},{id:"382F966C-0A31-43CB-9357-0E0E7EF699FA",x:1381,y:441,w:68,h:160},{id:"0DC724E1-ED07-43DA-AC37-E68D4C992BF1",x:1381,y:603,w:59,h:123},{id:"3E434D3C-6022-4C03-9174-DF575F0394E4",x:1396,y:2,w:52,h:118},{id:"B5718C69-661D-4F3B-83D1-54D0F5696911",x:1022,y:1308,w:100,h:114},{id:"EAE51B1B-A07D-41CF-8ADE-C0912D41367C",x:588,y:1453,w:109,h:95},{id:"B4FAE2BF-E183-463D-8FF1-E46A1264B55E",x:1368,y:122,w:66,h:58}]],images:[{width:1452,height:1550}]};
},{}],316:[function(require,module,exports) {
module.exports={forest:require("./sprites-forest.json"),grasslands:require("./sprites-grasslands.json"),origin:require("./sprites-origin.json"),tundra:require("./sprites-tundra.json")};
},{"./sprites-forest.json":841,"./sprites-grasslands.json":842,"./sprites-origin.json":843,"./sprites-tundra.json":844}],317:[function(require,module,exports) {
module.exports={"forest-0":require("./sprites-forest-0.png"),"forest-1":require("./sprites-forest-1.png"),"grasslands-0":require("./sprites-grasslands-0.png"),"origin-0":require("./sprites-origin-0.png"),"tundra-0":require("./sprites-tundra-0.png")};
},{"./sprites-forest-0.png":780,"./sprites-forest-1.png":781,"./sprites-grasslands-0.png":782,"./sprites-origin-0.png":783,"./sprites-tundra-0.png":784}],695:[function(require,module,exports) {
"use strict";function e(e,t){if(t)for(let o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}Object.defineProperty(exports,"__esModule",{value:!0}),exports.fastAssign=e;
},{}],286:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getWeightedSets=s,exports.addSampleData=o;var e=require("../../tags"),t=a(e),r=require("../../util/objects");function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}const n={flower:50,tree:75,twig:25,acorns:10,stump:25,shroom:25,rock:50,"flower-patch":10,sapling:20};function s(e){const t=new Map;e.filter(e=>e.userData.tag).map(e=>{const r=e.userData.tag;let a;return t.has(r)?a=t.get(r):(a=[],t.set(r,a)),a.push(e),{tag:r,child:e}});return Array.from(t.entries()).map(([e,t])=>{return{value:t,weight:e in n?n[e]:50,tag:e}})}function o(e,r,a,n,s){if(!r)return;if(!r.has(n))return void console.warn(`No cell class by key ${n}`);const o=r.get(n);if(!o||!o.sets||!o.sets.length)return void console.warn(`Cell not yet ready ${n}`);const i=s.weightedSet(o.sets),u=o.next(s.pick(i));if(!u||!u.userData.tag)return void(u&&console.warn("no tag for",u.name,n));const l=u.uuid;a.add(t.GroundAssetData);const c=a.get(t.GroundAssetData);return c.key=l,c.variance=s.gaussian(0,1),c.rotation=s.range(-1,1)*Math.PI*2,c.flip=s.boolean(),c.instance=u,c.audio=u.scale.y>5,c.ignoreFlip="tree"===u.userData.tag,u}
},{"../../tags":60,"../../util/objects":695}],252:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MetaData=void 0;var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},t=require("../tags"),a=v(t),r=require("three"),n=v(r),s=require("../util/GLTFLoader"),i=require("../assets/gltf/*.{gltf,glb,png,jpg}"),o=T(i),u=require("./materials"),l=require("./load"),c=require("./EditorWayfinderSprite"),d=require("../assets/gltf/meta.json"),f=T(d),p=require("./helpers"),m=v(p),y=require("../util/Assets"),g=T(y),h=require("../assets/gltf/sprites-*.json"),w=T(h),D=require("../assets/gltf/sprites-*.png"),b=T(D),O=require("./three-util"),_=require("../systems/environment/asset-types"),M=require("./ObjectPool"),j=T(M),x=require("./addFrameTasks");function T(e){return e&&e.__esModule?e:{default:e}}function v(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}let S={};Object.keys(b.default).forEach(e=>{const t=b.default[e],a=e.match(/([^\-]+)\-/);let r=a?a[1]:"";const n=parseInt(e.replace(/[^\d]+/g,""),10);if(r in S||(S[r]=[]),S[r][n]=t,"forest"===r){const e=g.default.urlToID(t);g.default.prepare(e)}});const q=L(o.default,["jpg","png"],"map-"),E=L(o.default,["gltf","glb"]),k=19;Object.keys(f.default).forEach(e=>{f.default[e].boundingBox[0][1]=0,f.default[e].boundingBox[1][1]+=19});const P=exports.MetaData=f.default;async function I(e){return new Promise(t=>{const a=new n.LoadingManager,r=new s.GLTFLoader(a);r.setCrossOrigin("anonymous"),r.load(e,e=>{t(e)})})}function L(e,t,a){return t=[].concat(t),Object.keys(e).filter(r=>!(a&&!r.startsWith(a))&&Object.keys(e[r]).some(e=>t.includes(e))).reduce((t,a)=>{const r=a.replace(/^map\-/,"").replace(/^geometry\-/,"").replace(/^scene\-/,""),n=e[a],s=Object.keys(n)[0];return s?t.set(r,n[s]):console.warn("Object does not have any URL keys"),Object.keys(n).length>1&&console.log("Object has more than one URL key"),t},new Map)}exports.default=async function(t){const r=new Map,s=new Map,i=new Map,o=(new n.BufferGeometry,(0,u.getEmptyTexture)()),d=new n.Vector3,p=t.findTag(a.Renderer),m=new Map,y={};for(let[e,t]of Object.entries(S))y[e]=t.map(e=>{const t=g.default.urlToID(e);return g.default.createGPUTextureTask(p,t)});Object.entries(w.default).forEach(([t,a])=>{const r=y[t];a.frames.forEach((t,s)=>{t.forEach(t=>{if(m.has(t.id))console.error("WARN: Clashing UUIDs in GLTF sprite sheet data");else{const{width:i,height:o}=a.images[s],u=new n.Vector2,l=new n.Vector2;u.set(t.w/i,t.h/o),l.x=t.x/i,l.y=1-t.h/o-t.y/o;const c=r[s],d=e({},t,{repeat:u,offset:l,atlas:c[0],atlasPromise:c[1],sheetIndex:s});delete d.id,m.set(t.id,d)}})})});const h=new Map,D=new Map;return await Promise.all(["forest-items-dry","forest-items-autumn","forest-items-triangle","grasslands-items-water","grasslands-items-yellow","grasslands-items-wet","grasslands-items-field","tundra-items-basic","tundra-items-ice"].map(async e=>{const t=await x(e,!1,!1),a=e.replace(/^items\-/i,""),r=(0,_.getWeightedSets)(t.children),n=function(e){return{sets:e,getPool:b,next:e=>(function(e){return b(e).next()})(e)}}(r);D.set(a,n),r.forEach(e=>{e.value.forEach(e=>{n.getPool(e,10)})})})),t.entity().add(a.GLTFSpawnItemsMap,D),{killEntities:M,nextPooledByName:function(e,t){return x(e,!0,t)},loadSceneByName:x};function b(e,r=1){let n;return h.has(e)?n=h.get(e):(n=function(e,r=1){const n=e.name;return new j.default({initialCapacity:r,name:`GLTFMesh-${n}`,create(){const t=T(e);return t.userData._pool=this,t},renew(e){return e.userData&&(e.userData._pool=this),e.traverse(e=>{e.isMesh&&function(e){const r=e.isSprite||"WayfinderSprite"===e.userData.type;e.userData._entity&&(e.userData._entity.kill(),console.error("ERROR: Entity already existed on child, removing it."));const n=e.userData?e.userData.tag:null,s=!!n&&n.includes("noshadow");if(r){const r=e.getWorldScale(d).y;e.userData._entity=t.entity().add(a.Object3D,e).add(a.Object3DKeepAlive).add(a.ShaderUniformTime,{uniform:e.material.uniforms.time}),s||e.userData._entity.add(a.ShadowCaster,{sprite:!0}),n&&"origin_tree"===n&&(e.userData._entity.add(a.SpriteAnimation,{key:e.userData.tag}),e.userData._entity.add(a.SpriteAnimationOriginTreeTag)),"origin_tree"!==n&&r>5&&e.userData._entity.add(a.WillTriggerAudio)}else e.userData._entity=t.entity().add(a.Object3D,e).add(a.Object3DKeepAlive),s||e.userData._entity.add(a.ShadowCaster,{sprite:!1});n&&"fox"===n&&e.userData._entity.add(a.FoxSpriteTag)}(e)}),e},release(e){e.userData&&(e.userData._pool=null),M(e)}})}(e,r),h.set(e,n)),n}function M(e){e.traverse(e=>{e.userData&&e.userData._entity&&(e.userData._entity.kill(),e.userData._entity=null)})}async function x(e,t,a){let r;if(i.has(e))r=i.get(e);else{const t=e.match(/([^\-]+)\-/);let a=t?t[1]:"";const o=await async function(e){if(!e||!E.has(e))return console.warn(`No scene by ID prefix ${e}`),null;const t=E.get(e);let a;return s.has(t)?a=s.get(t):(a=I(t).then(e=>{const t={};return e.scenes.forEach(e=>{t[e.name]=e}),t}),s.set(t,a)),a}(a);if(!o)return console.warn(`No scene by ID prefix ${a}`),new n.Scene;if(!(e in o))return console.warn(`Missing patch ${e} in ${a}`),new n.Scene;r=o[e];const u=f.default[e];u||console.warn(`No Meta for ${e}`),await async function(e,t){const a=[];return e.traverse(e=>{e.isMesh&&a.push(e)}),await Promise.all(a.map(async e=>{const a=e.isSprite||"WayfinderSprite"===e.userData.type;if(e.userData.$m){const t=await v(e.userData.$m);e.material.uniforms?e.material.uniforms.map.value=t:e.material.map=t,!a&&t&&(t.flipY=!1),delete e.userData.$m}k(e,t)})),e}(r,u),i.set(e,r)}if(t){return b(r).next()}return T(r)}function T(e){const t=e.clone(!0),a=e.name,r=a in f.default?f.default[a]:null;return t.traverse(e=>{e.isMesh&&k(e,r)}),t}async function v(e){if(r.has(e))return r.get(e);if(m.has(e)){const t=m.get(e);await t.atlasPromise;const a=new n.Texture;return a.repeat.copy(t.repeat),a.offset.copy(t.offset),(0,O.shareAtlasTexture)(p,t.atlas,a),a}if(!q.has(e))return console.warn(`Could not find map by UUID ${e}`),o;const t=q.get(e),a=(0,l.loadTexture)(t);return r.set(e,a),a}function k(e,a){const r=e.isSprite||"WayfinderSprite"===e.userData.type;if(a&&"origin"===a.type&&e.name&&e.name.endsWith("origin-0-ORIGIN_TREE")&&(e.userData.animation="origin-0"),r)(0,c.setMeshToSprite)(t,e);else{const a=e.material.uniforms&&e.material.uniforms.map?e.material.uniforms.map.value:e.material.map,r=e.userData?e.userData.tag:null,s=!!r&&(r.includes("noshadow")||r.includes("noground"));s&&(e.material.alphaTest=.5,e.material.transparent=!0),e.material=(0,u.createMeshMaterial)(t,e,{map:a,ignoreGround:s}),a.minFilter=n.LinearFilter,a.generateMipmaps=!1}}};
},{"../tags":60,"three":74,"../util/GLTFLoader":279,"../assets/gltf/*.{gltf,glb,png,jpg}":314,"./materials":82,"./load":247,"./EditorWayfinderSprite":81,"../assets/gltf/meta.json":706,"./helpers":250,"../util/Assets":31,"../assets/gltf/sprites-*.json":316,"../assets/gltf/sprites-*.png":317,"./three-util":80,"../systems/environment/asset-types":286,"./ObjectPool":236,"./addFrameTasks":140}],743:[function(require,module,exports) {
"use strict";function r(r,t,l,e){if(isNaN(t)||isNaN(l))return r;var n,a,i,o,u,s,_,c,f,h=r._root,y={data:e},d=r._x0,x=r._y0,N=r._x1,v=r._y1;if(!h)return r._root=y,r;for(;h.length;)if((s=t>=(a=(d+N)/2))?d=a:N=a,(_=l>=(i=(x+v)/2))?x=i:v=i,n=h,!(h=h[c=_<<1|s]))return n[c]=y,r;if(o=+r._x.call(null,h.data),u=+r._y.call(null,h.data),t===o&&l===u)return y.next=h,n?n[c]=y:r._root=y,r;do{n=n?n[c]=new Array(4):r._root=new Array(4),(s=t>=(a=(d+N)/2))?d=a:N=a,(_=l>=(i=(x+v)/2))?x=i:v=i}while((c=_<<1|s)==(f=(u>=i)<<1|o>=a));return n[f]=h,n[c]=y,r}function t(t){var l,e,n,a,i=t.length,o=new Array(i),u=new Array(i),s=1/0,_=1/0,c=-1/0,f=-1/0;for(e=0;e<i;++e)isNaN(n=+this._x.call(null,l=t[e]))||isNaN(a=+this._y.call(null,l))||(o[e]=n,u[e]=a,n<s&&(s=n),n>c&&(c=n),a<_&&(_=a),a>f&&(f=a));if(s>c||_>f)return this;for(this.cover(s,_).cover(c,f),e=0;e<i;++e)r(this,o[e],u[e],t[e]);return this}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(t){const l=+this._x.call(null,t),e=+this._y.call(null,t);return r(this.cover(l,e),l,e,t)},exports.addAll=t;
},{}],744:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(t,s){if(isNaN(t=+t)||isNaN(s=+s))return this;var e=this._x0,i=this._y0,r=this._x1,h=this._y1;if(isNaN(e))r=(e=Math.floor(t))+1,h=(i=Math.floor(s))+1;else{for(var o,a,_=r-e||1,c=this._root;e>t||t>=r||i>s||s>=h;)switch(a=(s<i)<<1|t<e,(o=new Array(4))[a]=c,c=o,_*=2,a){case 0:r=e+_,h=i+_;break;case 1:e=r-_,h=i+_;break;case 2:r=e+_,i=h-_;break;case 3:e=r-_,i=h-_}this._root&&this._root.length&&(this._root=c)}return this._x0=e,this._y0=i,this._x1=r,this._y1=h,this};
},{}],745:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(){var e=[];return this.visit(function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)}),e};
},{}],746:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]};
},{}],826:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(t,e,s,i,o){this.node=t,this.x0=e,this.y0=s,this.x1=i,this.y1=o};
},{}],747:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(e,l,a){var u,n,r,s,d,h,i,f=this._x0,o=this._y0,_=this._x1,p=this._y1,x=[],c=this._root;for(c&&x.push(new t.default(c,f,o,_,p)),null==a?a=1/0:(f=e-a,o=l-a,_=e+a,p=l+a,a*=a);h=x.pop();)if(!(!(c=h.node)||(n=h.x0)>_||(r=h.y0)>p||(s=h.x1)<f||(d=h.y1)<o))if(c.length){var v=(n+s)/2,y=(r+d)/2;x.push(new t.default(c[3],v,y,s,d),new t.default(c[2],n,y,v,d),new t.default(c[1],v,r,s,y),new t.default(c[0],n,r,v,y)),(i=(l>=y)<<1|e>=v)&&(h=x[x.length-1],x[x.length-1]=x[x.length-1-i],x[x.length-1-i]=h)}else{var g=e-+this._x.call(null,c.data),w=l-+this._y.call(null,c.data),q=g*g+w*w;if(q<a){var M=Math.sqrt(a=q);f=e-M,o=l-M,_=e+M,p=l+M,u=c.data}}return u};var e=require("./quad.js"),t=l(e);function l(e){return e&&e.__esModule?e:{default:e}}
},{"./quad.js":826}],748:[function(require,module,exports) {
"use strict";function t(t){for(var e=0,i=t.length;e<i;++e)this.remove(t[e]);return this}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(t){if(isNaN(h=+this._x.call(null,t))||isNaN(n=+this._y.call(null,t)))return this;var e,i,r,s,h,n,l,o,u,f,a,x,_=this._root,d=this._x0,c=this._y0,v=this._x1,g=this._y1;if(!_)return this;if(_.length)for(;;){if((u=h>=(l=(d+v)/2))?d=l:v=l,(f=n>=(o=(c+g)/2))?c=o:g=o,e=_,!(_=_[a=f<<1|u]))return this;if(!_.length)break;(e[a+1&3]||e[a+2&3]||e[a+3&3])&&(i=e,x=a)}for(;_.data!==t;)if(r=_,!(_=_.next))return this;return(s=_.next)&&delete _.next,r?(s?r.next=s:delete r.next,this):e?(s?e[a]=s:delete e[a],(_=e[0]||e[1]||e[2]||e[3])&&_===(e[3]||e[2]||e[1]||e[0])&&!_.length&&(i?i[x]=_:this._root=_),this):(this._root=s,this)},exports.removeAll=t;
},{}],749:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(){return this._root};
},{}],750:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(){var e=0;return this.visit(function(t){if(!t.length)do{++e}while(t=t.next)}),e};
},{}],751:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(e){var u,s,r,n,a,d,f=[],h=this._root;for(h&&f.push(new t.default(h,this._x0,this._y0,this._x1,this._y1));u=f.pop();)if(!e(h=u.node,r=u.x0,n=u.y0,a=u.x1,d=u.y1)&&h.length){var i=(r+a)/2,o=(n+d)/2;(s=h[3])&&f.push(new t.default(s,i,o,a,d)),(s=h[2])&&f.push(new t.default(s,r,o,i,d)),(s=h[1])&&f.push(new t.default(s,i,n,a,o)),(s=h[0])&&f.push(new t.default(s,r,n,i,o))}return this};var e=require("./quad.js"),t=u(e);function u(e){return e&&e.__esModule?e:{default:e}}
},{"./quad.js":826}],752:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(e){var u,s=[],r=[];for(this._root&&s.push(new t.default(this._root,this._x0,this._y0,this._x1,this._y1));u=s.pop();){var o=u.node;if(o.length){var n,h=u.x0,a=u.y0,d=u.x1,f=u.y1,i=(h+d)/2,p=(a+f)/2;(n=o[0])&&s.push(new t.default(n,h,a,i,p)),(n=o[1])&&s.push(new t.default(n,i,a,d,p)),(n=o[2])&&s.push(new t.default(n,h,p,i,f)),(n=o[3])&&s.push(new t.default(n,i,p,d,f))}r.push(u)}for(;u=r.pop();)e(u.node,u.x0,u.y0,u.x1,u.y1);return this};var e=require("./quad.js"),t=u(e);function u(e){return e&&e.__esModule?e:{default:e}}
},{"./quad.js":826}],753:[function(require,module,exports) {
"use strict";function t(t){return t[0]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultX=t,exports.default=function(t){return arguments.length?(this._x=t,this):this._x};
},{}],754:[function(require,module,exports) {
"use strict";function t(t){return t[1]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultY=t,exports.default=function(t){return arguments.length?(this._y=t,this):this._y};
},{}],558:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=w;var e=require("./add.js"),t=m(e),r=require("./cover.js"),a=m(r),u=require("./data.js"),i=m(u),s=require("./extent.js"),o=m(s),d=require("./find.js"),l=m(d),n=require("./remove.js"),f=m(n),_=require("./root.js"),v=m(_),h=require("./size.js"),x=m(h),y=require("./visit.js"),c=m(y),j=require("./visitAfter.js"),q=m(j),p=require("./x.js"),A=m(p),N=require("./y.js"),g=m(N);function m(e){return e&&e.__esModule?e:{default:e}}function w(e,t,r){var a=new z(null==t?p.defaultX:t,null==r?N.defaultY:r,NaN,NaN,NaN,NaN);return null==e?a:a.addAll(e)}function z(e,t,r,a,u,i){this._x=e,this._y=t,this._x0=r,this._y0=a,this._x1=u,this._y1=i,this._root=void 0}function M(e){for(var t={data:e.data},r=t;e=e.next;)r=r.next={data:e.data};return t}var b=w.prototype=z.prototype;b.copy=function(){var e,t,r=new z(this._x,this._y,this._x0,this._y0,this._x1,this._y1),a=this._root;if(!a)return r;if(!a.length)return r._root=M(a),r;for(e=[{source:a,target:r._root=new Array(4)}];a=e.pop();)for(var u=0;u<4;++u)(t=a.source[u])&&(t.length?e.push({source:t,target:a.target[u]=new Array(4)}):a.target[u]=M(t));return r},b.add=t.default,b.addAll=e.addAll,b.cover=a.default,b.data=i.default,b.extent=o.default,b.find=l.default,b.remove=f.default,b.removeAll=n.removeAll,b.root=v.default,b.size=x.default,b.visit=c.default,b.visitAfter=q.default,b.x=A.default,b.y=g.default;
},{"./add.js":743,"./cover.js":744,"./data.js":745,"./extent.js":746,"./find.js":747,"./remove.js":748,"./root.js":749,"./size.js":750,"./visit.js":751,"./visitAfter.js":752,"./x.js":753,"./y.js":754}],299:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./quadtree.js");function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"quadtree",{enumerable:!0,get:function(){return r(e).default}});
},{"./quadtree.js":558}],809:[function(require,module,exports) {
module.exports={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};
},{}],852:[function(require,module,exports) {
function r(r){var e,n,o,t,u,f=r[0],a=r[1],i=r[2];if(0===a)return[u=i,u,u];e=2*i-(n=i<.5?i*(1+a):i+a-i*a),t=[0,0,0];for(var v=0;v<3;v++)(o=f+1/3*-(v-1))<0&&o++,o>1&&o--,u=6*o<1?e+6*(n-e)*o:2*o<1?n:3*o<2?e+(n-e)*(2/3-o)*6:e,t[v]=u;return t}module.exports=r;
},{}],853:[function(require,module,exports) {
function t(t){var a,n,m=t[0],r=t[1],e=t[2],h=Math.min(m,r,e),i=Math.max(m,r,e),o=i-h;return i===h?a=0:m===i?a=(r-e)/o:r===i?a=2+(e-m)/o:e===i&&(a=4+(m-r)/o),(a=Math.min(60*a,360))<0&&(a+=360),n=(h+i)/2,[a/360,i===h?0:n<=.5?o/(i+h):o/(2-i-h),n]}module.exports=t;
},{}],812:[function(require,module,exports) {
var a=require("float-hsl2rgb"),t=require("float-rgb2hsl"),r=require("./wrap");function h(a){var r=t([a[0]/255,a[1]/255,a[2]/255]);return[Math.max(0,Math.min(360,Math.round(360*r[0]))),Math.max(0,Math.min(100,Math.round(100*r[1]))),Math.max(0,Math.min(100,Math.round(100*r[2]))),a[3]]}function n(t){var h=r(t[0],0,360),n=a([h/360,t[1]/100,t[2]/100]);return[Math.max(0,Math.min(255,Math.round(255*n[0]))),Math.max(0,Math.min(255,Math.round(255*n[1]))),Math.max(0,Math.min(255,Math.round(255*n[2]))),t[3]]}module.exports.RGBAToHSLA=h,module.exports.HSLAToRGBA=n;
},{"float-hsl2rgb":852,"float-rgb2hsl":853,"./wrap":741}],813:[function(require,module,exports) {
function e(e){if("string"!=typeof e)throw new TypeError("Hex code parsing must be performed on a string parameter");if(e=e.toLowerCase(),!/^#[a-f0-9]+$/.test(e))return null;var r=e.replace(/^#/,""),t=1;8===r.length&&(t=parseInt(r.slice(6,8),16)/255,r=r.slice(0,6)),4===r.length&&(t=parseInt(r.slice(3,4).repeat(2),16)/255,r=r.slice(0,3)),3===r.length&&(r=r[0]+r[0]+r[1]+r[1]+r[2]+r[2]);var n=parseInt(r,16);return[n>>16,n>>8&255,255&n,t]}module.exports=e;
},{}],814:[function(require,module,exports) {
function t(t){if(!t||!Array.isArray(t))throw new TypeError("Must specify an array to convert into a hex code");var a=Math.max(0,Math.min(255,Math.round(t[0]||0))),r=Math.max(0,Math.min(255,Math.round(t[1]||0))),n=Math.max(0,Math.min(255,Math.round(t[2]||0))),i=t[3];void 0!==i&&isFinite(i)||(i=1);var o=Math.max(0,Math.min(255,Math.round(255*i))),h=255===o?"":(256|o).toString(16).slice(1);return"#"+((n|r<<8|a<<16|1<<24).toString(16).slice(1)+h)}module.exports=t;
},{}],810:[function(require,module,exports) {
var r=require("./css-color-names.json"),a=require("./hsl"),e=require("./hex-to-rgba"),t=require("./rgba-to-hex"),n=require("./wrap");function i(i){if("string"!=typeof i)throw new TypeError("Color parsing must be performed on a string parameter");var s,o,h;if((i=i.toLowerCase())in r?i=r[i]:"transparent"===i&&(i="#00000000"),/^#[a-f0-9]+$/.test(i))s=e(i),h=t(s),o=a.RGBAToHSLA(s);else{var l=/^((?:rgb|hsl)a?)\s*\(([^)]*)\)/.exec(i);if(!l)return null;var u=l[1].replace(/a$/,""),m=l[2].replace(/^\s+|\s+$/g,"").split(/\s*,\s*/).map(function(r,a){return a<=2?Math.round(parseFloat(r)||0):("number"==typeof(r=parseFloat(r))&&isFinite(r)||(r=1),r)});void 0!==m[3]&&isFinite(m[3])||(m[3]=1),"rgb"===u?(o=a.RGBAToHSLA(m),s=m):"hsl"===u&&(s=a.HSLAToRGBA(m),m[0]=n(m[0],0,360),o=m),h=t(s)}return s||h||o?{hex:h,alpha:s[3],rgb:s.slice(0,3),rgba:s,hsl:o.slice(0,3),hsla:o}:null}function s(r){return"string"==typeof r?i(r):Array.isArray(r)&&r.length>=3?i(h(r[0],r[1],r[2],r[3])):r&&"object"==typeof r&&(r.hex?a=r.hex:r.rgba?a=h(r.rgba[0],r.rgba[1],r.rgba[2],r.rgba[3]):r.hsla?a=l(r.hsla[0],r.hsla[1],r.hsla[2],r.hsla[3]):r.rgb?a=h(r.rgb[0],r.rgb[1],r.rgb[2]):r.hsl&&(a=l(r.hsl[0],r.hsl[1],r.hsl[2])),a)?i(a):null;var a}function o(r){var a=module.exports.parse(r);if(a){var e=a.rgba;return h(e[0],e[1],e[2],e[3])}return null}function h(r,a,e,t){return r=Math.max(0,Math.min(255,Math.round(r))),a=Math.max(0,Math.min(255,Math.round(a))),e=Math.max(0,Math.min(255,Math.round(e))),1!==t&&isFinite(t)&&void 0!==t?"rgba("+[r,a,e,t=Math.max(0,Math.min(1,t))].join(", ")+")":"rgb("+[r,a,e].join(", ")+")"}function l(r,a,e,t){return r=n(r,0,360),r=Math.max(0,Math.min(360,Math.round(r))),a=Math.max(0,Math.min(100,Math.round(a))),e=Math.max(0,Math.min(100,Math.round(e))),1!==t&&isFinite(t)&&void 0!==t?"hsla("+[r,a,e,t=Math.max(0,Math.min(1,t))].join(", ")+")":"hsl("+[r,a,e].join(", ")+")"}module.exports.parse=s,module.exports.style=o;
},{"./css-color-names.json":809,"./hsl":812,"./hex-to-rgba":813,"./rgba-to-hex":814,"./wrap":741}],811:[function(require,module,exports) {
var r=.2126,n=.7152,t=.0722,o=1/12.92;function u(r){return Math.pow((r+.055)/1.055,2.4)}function e(e){var a=e[0]/255,c=e[1]/255,f=e[2]/255,i=a<=.03928?a*o:u(a),p=c<=.03928?c*o:u(c),v=f<=.03928?f*o:u(f);return i*r+p*n+v*t}module.exports=e;
},{}],699:[function(require,module,exports) {
var e=require("./lib/css-color"),r=require("./lib/css-color-names.json"),o=require("./lib/relative-luminance"),l=require("./lib/hsl"),t=require("./lib/hex-to-rgba"),a=require("./lib/rgba-to-hex");module.exports.parse=e.parse,module.exports.style=e.style,module.exports.names=r,module.exports.relativeLuminance=function(e){var r=module.exports.parse(e);return r?o(r.rgb):null},module.exports.contrastRatio=function(e,r){var o=module.exports.relativeLuminance(e),l=module.exports.relativeLuminance(r);return null==o||null==l?null:(Math.max(o,l)+.05)/(Math.min(o,l)+.05)},module.exports.offsetHSL=function(e,r,o,l){var t=module.exports.parse(e);return t?(t.hsla[0]+=r||0,t.hsla[1]=Math.max(0,Math.min(100,t.hsla[1]+(o||0))),t.hsla[2]=Math.max(0,Math.min(100,t.hsla[2]+(l||0))),module.exports.parse({hsla:t.hsla})):null},module.exports.blend=function(e,r,o){var l=module.exports.parse(e),t=module.exports.parse(r);if(null==l||null==t)return null;var a=l.rgba,u=t.rgba,s=(o="number"==typeof o&&isFinite(o)?o:1)*u[3];if(s>=1)return t;for(var n=0;n<3;n++)u[n]=u[n]*s+a[n]*(a[3]*(1-s));return u[3]=Math.max(0,Math.min(1,s+a[3]*(1-s))),module.exports.parse(u)},module.exports.hexToRGBA=t,module.exports.RGBAToHex=a,module.exports.RGBAToHSLA=l.RGBAToHSLA,module.exports.HSLAToRGBA=l.HSLAToRGBA;
},{"./lib/css-color":810,"./lib/css-color-names.json":809,"./lib/relative-luminance":811,"./lib/hsl":812,"./lib/hex-to-rgba":813,"./lib/rgba-to-hex":814}],696:[function(require,module,exports) {
module.exports="#define GLSLIFY 1\nvarying vec2 vUv;\nvarying vec2 vTextureUv;\nvarying vec2 vSurfUv;\nvarying vec3 vWorldPosition;\n\nuniform sampler2D worldDataMap;\n\nuniform vec3 centroidPosition;\nuniform sampler2D waterDistortMap;\nuniform sampler2D waterNoiseMap;\nuniform sampler2D dataMapColor;\nuniform sampler2D dataMapLake;\nuniform sampler2D dataMapLakeBlur;\nuniform sampler2D groundMap;\nuniform vec3 colorA;\nuniform vec3 colorB;\nuniform float lakeSize;\nuniform float time;\nvarying float vAngle;\nvarying vec2 vDataUv;\nvarying vec2 vGroundUv;\n\n#define distortionScale 1.0\n#define waterScale 2.5\n\n// #define WATER 1\n\nvoid main2 () {\n  float lake = 1.0-texture2D(dataMapLake, vUv).r;\n  float lakeBlur = 1.0-texture2D(dataMapLakeBlur, vUv).r;\n  vec3 groundColor = texture2D(dataMapColor, vUv).rgb;\n  vec4 wakeData = texture2D(worldDataMap, vDataUv).rgba;\n\n  vec4 tex = texture2D(waterNoiseMap, vTextureUv * waterScale).rgba;\n\n  gl_FragColor = vec4(vec3(colorB.rgb), 1.0);\n}\n\nvoid main () {\n  // float lake = texture2D(dataMapLake, vUv).r;\n  float lake = 1.0-texture2D(dataMapLake, vUv).r;\n  float lakeBlur = 1.0-texture2D(dataMapLakeBlur, vUv).r;\n  // vec3 groundColor = texture2D(dataMapColor, vUv).rgb;\n  vec3 groundColor = texture2D(groundMap, vGroundUv).rgb;\n\n  vec4 wakeData = texture2D(worldDataMap, vDataUv).rgba;\n  // float foam = smoothstep(1.0, 0.85, lake);\n\n  // float ld = 0.2 + sin(time + vAngle) * 0.1;\n  // float foam = smoothstep(1.0, ld, lake);\n  // gl_FragColor = vec4(color + vec3(foam), 1.0);\n\n  float dst = smoothstep(0.0, 0.5, lake);\n  // float off = 0.0;\n  // // float off = sin(vAngle + time) * (1.0 / steps) * 0.1;\n  // dst = abs(fract((dst + 0.05 * time + off) * steps) - 0.5)*2.0;\n  // dst *= smoothstep(0.1, 0.75, lake);\n\n  vec2 uvDistort = vec2(0.0);\n\n  float wakeStrength = wakeData.r;\n\n  \n  #ifdef WATER\n  vec2 wakeDirection = wakeData.gb * 0.2 * wakeStrength;\n  uvDistort -= wakeDirection;\n  float timeOff = time;\n  #else\n  vec2 wakeDirection = vec2(0.0);\n  float timeOff = 0.0;\n  #endif\n\n  vec2 uvDistortOff = vec2(timeOff * 0.1, timeOff * -0.1);\n  vec2 distortion = texture2D(waterDistortMap, uvDistortOff + vTextureUv * distortionScale).rg * 2.0 - 1.0;\n  uvDistort += distortion.rg * 0.05;\n\n  vec4 waterColorMap = texture2D(waterNoiseMap, vTextureUv * waterScale + uvDistort);\n  float foam = waterColorMap.r;\n\n  float lakeCentroidDepth = distance(centroidPosition, vWorldPosition)/lakeSize;\n  lakeCentroidDepth = smoothstep(0.0, 1.0, lakeCentroidDepth);\n\n  float lakeBlurDepth = lakeBlur;\n  // float lakeBlurDepth = smoothstep(0.0, 1.0, lakeBlur);\n\n  float depth = smoothstep(0.0, 0.75, lake);\n  vec3 col = mix(colorA, colorB, lakeBlurDepth);\n\n  vec2 edgeOff2D = texture2D(waterDistortMap, vec2(0.0, 0.0) + vTextureUv * distortionScale + distortion.rg * 0.02 - wakeDirection).rg * 2.0 - 1.0;\n  float edgeOff = edgeOff2D.r;\n  float strongEdge = smoothstep(0.4, 0.55, lake + edgeOff2D.g * 0.05);\n\n  float ft0 = 0.4;\n  float ftf = 0.3;\n  // float edgeFalloff = 1.0 - smoothstep(0.8, 0.0, lake);\n  float edgeFalloff = smoothstep(ft0-ftf, ft0+ftf, lake + edgeOff2D.r * 0.05);\n\n  #ifdef WATER\n  col += foam * 0.1 * lakeBlurDepth + foam * 0.2 * wakeStrength;\n  col = mix(col, groundColor, edgeFalloff);\n  #else\n  col += foam * mix(0.0, 0.1, lakeBlurDepth) + foam * 0.2 * wakeStrength;\n  col = mix(col, groundColor, edgeFalloff);\n  #endif\n\n  col *= (1.0 - wakeStrength * 0.05);\n  // col = mix(col, groundColor, strongEdge);\n  // col = mix(col, col + 0.1, strongEdge);\n  \n\n  float steps = 4.0 + edgeOff2D.g * 0.2;\n  // float waves = sin(distortion.r * 0.25 + edgeOff2D. + timeOff * -0.05);\n  float worldOff = 0.0;\n  float waves = fract(edgeOff2D.r * 0.1 + edgeOff2D.g * 0.1 + timeOff * 0.1 + worldOff);\n  // waves -= sin(length(vUv - 0.5) * 10.0 + timeOff);\n  float movingDst = smoothstep(0.0, 0.7, lake + edgeOff2D.r * 0.05);\n  movingDst = smoothstep(0.5, 0.0, abs(fract((movingDst + waves) * steps) - 0.5) * 2.0);\n  movingDst *= depth;\n  // movingDst *= sin(length(vUv - 0.5) * 10.0 + timeOff);\n\n  // movingDst = mix(movingDst, 1.0, strongEdge);\n  // movingDst = mix(movingDst, 1.0, smoothstep(0.5, 0.55, lake + edgeOff2D.g * 0.05));\n\n  float et = 0.4;\n  float ef = 0.05;\n  float sharpFoam = smoothstep(et-ef,et+ef, movingDst + edgeOff2D.r * 0.6) * smoothstep(et-ef,et+ef, movingDst + edgeOff2D.g * 0.6);\n  sharpFoam = clamp(sharpFoam, 0.0, 1.0);\n  // sharpFoam *= smoothstep(-0.2, -0.0, edgeOff2D.r);\n  // sharpFoam *= smoothstep(-0.3, -0.2, edgeOff2D.g);\n\n  #ifdef WATER\n  float et0 = 0.4;\n  float ef0 = 0.05;\n  col = mix(col, vec3(col + 0.4 *(edgeOff2D.r*0.5+0.5)), (1.0-strongEdge) * sharpFoam);\n  #else\n  float et0 = 0.4;\n  float ef0 = 0.05;\n  col += 1.0 * mix(col, vec3(col + 0.4 *(edgeOff2D.r*0.5+0.5)), (1.0-strongEdge) * sharpFoam) * foam;\n  #endif\n  // col = mix(col, mix(col, vec3(0.8), smoothstep(et0+ef0, et0-ef0, lake)), sharpFoam);\n  \n  float strongEdge2 = smoothstep(0.4, 0.55, lake +edgeOff2D.r * 0.1);\n  // col = mix(col, groundColor, strongEdge2);\n  \n  // col += sharpFoam * 0.5 * (smoothstep(0.5, 0.3, lake));\n  // col += step(0.4, lake + edgeOff2D.r * 0.6) * step(0.4, lake + edgeOff2D.g * 0.6);\n  // col += smoothstep(et-ef, et+ef, edgeOff2D.g) * movingDst * depth;\n  // col = vec3(movingDst);\n  // col += step(0.6, lake + edgeOff);\n\n  // float edgeFoam01 = step(0.5, lake + distortion.r);\n  // float edgeFoam02 = step(0.5, lake + distortion.g);\n  // col += edgeFoam01 * edgeFoam02;\n\n  // col = vec3(smoothstep(0.0, 0.7, lake));\n  // col += smoothstep(0.1, 0.5, lake);\n\n  // col = vec3(lakeBlurDepth);\n\n   \n  #ifdef WATER\n  ft0 = 0.5;\n  ftf = 0.1;\n  float edgeAlpha = smoothstep(ft0+ftf, ft0-ftf, lake + edgeOff2D.r * 0.05);\n  gl_FragColor = vec4(mix(groundColor, col, edgeAlpha), 1.0);\n  #else\n  ftf = 0.4;\n  ft0 = 0.1;\n  float edgeAlpha = smoothstep(ftf+ft0, ftf-ft0, lake + (waterColorMap.g*2.0-1.0) * 0.25);\n  // gl_FragColor = vec4(vec3(step(0.25, lake)), 1.0);\n  gl_FragColor = vec4(col, edgeAlpha);\n  // gl_FragColor = vec4(mix(groundColor, col, edgeAlpha), 1.0);\n  #endif\n  \n  // gl_FragColor = vec4(vec3(col), edgeAlpha);\n  gl_FragColor = clamp(gl_FragColor.rgba, 0.0, 1.0);\n  // vec3 distortion = texture2D(mapWaterNormal, vTextureUv * distortionScale).rgb * 2.0 - 1.0;\n\n  // gl_FragColor = vec4(vec3(wakeData.r), 1.0);\n  // dst *= sin(vTextureUv.x * 4.0 + timeOff);\n\n  // gl_FragColor = vec4(vec3(distortion.r), 1.0);\n  // gl_FragColor = vec4(vec3(1.0-lake), 1.0);\n}";
},{}],874:[function(require,module,exports) {
"use strict";function t(t,r,a,f,n){o(t,r,a||0,f||t.length-1,n||e)}function o(t,e,a,f,n){for(;f>a;){if(f-a>600){var u=f-a+1,h=e-a+1,i=Math.log(u),M=.5*Math.exp(2*i/3),l=.5*Math.sqrt(i*M*(u-M)/u)*(h-u/2<0?-1:1);o(t,e,Math.max(a,Math.floor(e-h*M/u+l)),Math.min(f,Math.floor(e+(u-h)*M/u+l)),n)}var c=t[e],s=a,p=f;for(r(t,a,e),n(t[f],c)>0&&r(t,a,f);s<p;){for(r(t,s,p),s++,p--;n(t[s],c)<0;)s++;for(;n(t[p],c)>0;)p--}0===n(t[a],c)?r(t,a,p):r(t,++p,f),p<=e&&(a=p+1),e<=p&&(f=p-1)}}function r(t,o,r){var e=t[o];t[o]=t[r],t[r]=e}function e(t,o){return t<o?-1:t>o?1:0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t;
},{}],838:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("quickselect"),i=n(t);function n(t){return t&&t.__esModule?t:{default:t}}class e{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(t){let i=this.data;const n=[];if(!x(t,i))return n;const e=this.toBBox,h=[];for(;i;){for(let r=0;r<i.children.length;r++){const s=i.children[r],a=i.leaf?e(s):s;x(t,a)&&(i.leaf?n.push(s):d(t,a)?this._all(s,n):h.push(s))}i=h.pop()}return n}collides(t){let i=this.data;if(!x(t,i))return!1;const n=[];for(;i;){for(let e=0;e<i.children.length;e++){const h=i.children[e],r=i.leaf?this.toBBox(h):h;if(x(t,r)){if(i.leaf||d(t,r))return!0;n.push(h)}}i=n.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(let i=0;i<t.length;i++)this.insert(t[i]);return this}let i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){const t=this.data;this.data=i,i=t}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=p([]),this}remove(t,i){if(!t)return this;let n=this.data;const e=this.toBBox(t),r=[],s=[];let a,l,o;for(;n||r.length;){if(n||(n=r.pop(),l=r[r.length-1],a=s.pop(),o=!0),n.leaf){const e=h(t,n.children,i);if(-1!==e)return n.children.splice(e,1),r.push(n),this._condense(r),this}o||n.leaf||!d(n,e)?l?(a++,n=l.children[a],o=!1):n=null:(r.push(n),s.push(a),a=0,l=n,n=n.children[0])}return this}toBBox(t){return t}compareMinX(t,i){return t.minX-i.minX}compareMinY(t,i){return t.minY-i.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,i){const n=[];for(;t;)t.leaf?i.push(...t.children):n.push(...t.children),t=n.pop();return i}_build(t,i,n,e){const h=n-i+1;let s,a=this._maxEntries;if(h<=a)return r(s=p(t.slice(i,n+1)),this.toBBox),s;e||(e=Math.ceil(Math.log(h)/Math.log(a)),a=Math.ceil(h/Math.pow(a,e-1))),(s=p([])).leaf=!1,s.height=e;const l=Math.ceil(h/a),o=l*Math.ceil(Math.sqrt(a));M(t,i,n,o,this.compareMinX);for(let h=i;h<=n;h+=o){const i=Math.min(h+o-1,n);M(t,h,i,l,this.compareMinY);for(let n=h;n<=i;n+=l){const h=Math.min(n+l-1,i);s.children.push(this._build(t,n,h,e-1))}}return r(s,this.toBBox),s}_chooseSubtree(t,i,n,e){for(;e.push(i),!i.leaf&&e.length-1!==n;){let n,e=1/0,h=1/0;for(let r=0;r<i.children.length;r++){const s=i.children[r],a=c(s),l=u(t,s)-a;l<h?(h=l,e=a<e?a:e,n=s):l===h&&a<e&&(e=a,n=s)}i=n||i.children[0]}return i}_insert(t,i,n){const e=n?t:this.toBBox(t),h=[],r=this._chooseSubtree(e,this.data,i,h);for(r.children.push(t),a(r,e);i>=0&&h[i].children.length>this._maxEntries;)this._split(h,i),i--;this._adjustParentBBoxes(e,h,i)}_split(t,i){const n=t[i],e=n.children.length,h=this._minEntries;this._chooseSplitAxis(n,h,e);const s=this._chooseSplitIndex(n,h,e),a=p(n.children.splice(s,n.children.length-s));a.height=n.height,a.leaf=n.leaf,r(n,this.toBBox),r(a,this.toBBox),i?t[i-1].children.push(a):this._splitRoot(n,a)}_splitRoot(t,i){this.data=p([t,i]),this.data.height=t.height+1,this.data.leaf=!1,r(this.data,this.toBBox)}_chooseSplitIndex(t,i,n){let e,h=1/0,r=1/0;for(let a=i;a<=n-i;a++){const i=s(t,0,a,this.toBBox),l=s(t,a,n,this.toBBox),o=f(i,l),m=c(i)+c(l);o<h?(h=o,e=a,r=m<r?m:r):o===h&&m<r&&(r=m,e=a)}return e||n-i}_chooseSplitAxis(t,i,n){const e=t.leaf?this.compareMinX:l,h=t.leaf?this.compareMinY:o;this._allDistMargin(t,i,n,e)<this._allDistMargin(t,i,n,h)&&t.children.sort(e)}_allDistMargin(t,i,n,e){t.children.sort(e);const h=this.toBBox,r=s(t,0,i,h),l=s(t,n-i,n,h);let o=m(r)+m(l);for(let e=i;e<n-i;e++){const i=t.children[e];a(r,t.leaf?h(i):i),o+=m(r)}for(let e=n-i-1;e>=i;e--){const i=t.children[e];a(l,t.leaf?h(i):i),o+=m(l)}return o}_adjustParentBBoxes(t,i,n){for(let e=n;e>=0;e--)a(i[e],t)}_condense(t){for(let i,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(i=t[n-1].children).splice(i.indexOf(t[n]),1):this.clear():r(t[n],this.toBBox)}}function h(t,i,n){if(!n)return i.indexOf(t);for(let e=0;e<i.length;e++)if(n(t,i[e]))return e;return-1}function r(t,i){s(t,0,t.children.length,i,t)}function s(t,i,n,e,h){h||(h=p(null)),h.minX=1/0,h.minY=1/0,h.maxX=-1/0,h.maxY=-1/0;for(let r=i;r<n;r++){const i=t.children[r];a(h,t.leaf?e(i):i)}return h}function a(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function l(t,i){return t.minX-i.minX}function o(t,i){return t.minY-i.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function m(t){return t.maxX-t.minX+(t.maxY-t.minY)}function u(t,i){return(Math.max(i.maxX,t.maxX)-Math.min(i.minX,t.minX))*(Math.max(i.maxY,t.maxY)-Math.min(i.minY,t.minY))}function f(t,i){const n=Math.max(t.minX,i.minX),e=Math.max(t.minY,i.minY),h=Math.min(t.maxX,i.maxX),r=Math.min(t.maxY,i.maxY);return Math.max(0,h-n)*Math.max(0,r-e)}function d(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function x(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function M(t,n,e,h,r){const s=[n,e];for(;s.length;){if((e=s.pop())-(n=s.pop())<=h)continue;const a=n+Math.ceil((e-n)/h/2)*h;(0,i.default)(t,a,n,e,r),s.push(n,a,a,e)}}exports.default=e;
},{"quickselect":874}],839:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class t{constructor(t=[],h=s){if(this.data=t,this.length=this.data.length,this.compare=h,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:h}=this,e=s[t];for(;t>0;){const i=t-1>>1,n=s[i];if(h(e,n)>=0)break;s[t]=n,t=i}s[t]=e}_down(t){const{data:s,compare:h}=this,e=this.length>>1,i=s[t];for(;t<e;){let e=1+(t<<1),n=s[e];const a=e+1;if(a<this.length&&h(s[a],n)<0&&(e=a,n=s[a]),h(n,i)>=0)break;s[t]=n,t=e}s[t]=i}}function s(t,s){return t<s?-1:t>s?1:0}exports.default=t;
},{}],840:[function(require,module,exports) {
var define;
var t;!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof t&&t.amd?t(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).predicates={})}(this,function(t){"use strict";const e=134217729;function n(t,e,n,o,r){let f,u,i,s,c=e[0],a=o[0],l=0,d=0;a>c==a>-c?(f=c,c=e[++l]):(f=a,a=o[++d]);let p=0;if(l<t&&d<n)for(a>c==a>-c?(i=f-((u=c+f)-c),c=e[++l]):(i=f-((u=a+f)-a),a=o[++d]),f=u,0!==i&&(r[p++]=i);l<t&&d<n;)a>c==a>-c?(i=f-((u=f+c)-(s=u-f))+(c-s),c=e[++l]):(i=f-((u=f+a)-(s=u-f))+(a-s),a=o[++d]),f=u,0!==i&&(r[p++]=i);for(;l<t;)i=f-((u=f+c)-(s=u-f))+(c-s),c=e[++l],f=u,0!==i&&(r[p++]=i);for(;d<n;)i=f-((u=f+a)-(s=u-f))+(a-s),a=o[++d],f=u,0!==i&&(r[p++]=i);return 0===f&&0!==p||(r[p++]=f),p}function o(t){return new Float64Array(t)}const r=o(4),f=o(8),u=o(12),i=o(16),s=o(4);t.orient2d=function(t,o,c,a,l,d){const p=(o-d)*(c-l),b=(t-l)*(a-d),h=p-b;if(0===p||0===b||p>0!=b>0)return h;const y=Math.abs(p+b);return Math.abs(h)>=3.3306690738754716e-16*y?h:-function(t,o,c,a,l,d,p){let b,h,y,M,x,g,j,m,v,T,_,w,A,F,O,P,k,q;const z=t-l,B=c-l,C=o-d,D=a-d;x=(O=(m=z-(j=(g=e*z)-(g-z)))*(T=D-(v=(g=e*D)-(g-D)))-((F=z*D)-j*v-m*v-j*T))-(_=O-(k=(m=C-(j=(g=e*C)-(g-C)))*(T=B-(v=(g=e*B)-(g-B)))-((P=C*B)-j*v-m*v-j*T))),r[0]=O-(_+x)+(x-k),x=(A=F-((w=F+_)-(x=w-F))+(_-x))-(_=A-P),r[1]=A-(_+x)+(x-P),x=(q=w+_)-w,r[2]=w-(q-x)+(_-x),r[3]=q;let E=function(t,e){let n=e[0];for(let t=1;t<4;t++)n+=e[t];return n}(0,r),G=2.2204460492503146e-16*p;if(E>=G||-E>=G)return E;if(b=t-(z+(x=t-z))+(x-l),y=c-(B+(x=c-B))+(x-l),h=o-(C+(x=o-C))+(x-d),M=a-(D+(x=a-D))+(x-d),0===b&&0===h&&0===y&&0===M)return E;if(G=1.1093356479670487e-31*p+3.3306690738754706e-16*Math.abs(E),(E+=z*M+D*b-(C*y+B*h))>=G||-E>=G)return E;x=(O=(m=b-(j=(g=e*b)-(g-b)))*(T=D-(v=(g=e*D)-(g-D)))-((F=b*D)-j*v-m*v-j*T))-(_=O-(k=(m=h-(j=(g=e*h)-(g-h)))*(T=B-(v=(g=e*B)-(g-B)))-((P=h*B)-j*v-m*v-j*T))),s[0]=O-(_+x)+(x-k),x=(A=F-((w=F+_)-(x=w-F))+(_-x))-(_=A-P),s[1]=A-(_+x)+(x-P),x=(q=w+_)-w,s[2]=w-(q-x)+(_-x),s[3]=q;const H=n(4,r,4,s,f);x=(O=(m=z-(j=(g=e*z)-(g-z)))*(T=M-(v=(g=e*M)-(g-M)))-((F=z*M)-j*v-m*v-j*T))-(_=O-(k=(m=C-(j=(g=e*C)-(g-C)))*(T=y-(v=(g=e*y)-(g-y)))-((P=C*y)-j*v-m*v-j*T))),s[0]=O-(_+x)+(x-k),x=(A=F-((w=F+_)-(x=w-F))+(_-x))-(_=A-P),s[1]=A-(_+x)+(x-P),x=(q=w+_)-w,s[2]=w-(q-x)+(_-x),s[3]=q;const I=n(H,f,4,s,u);x=(O=(m=b-(j=(g=e*b)-(g-b)))*(T=M-(v=(g=e*M)-(g-M)))-((F=b*M)-j*v-m*v-j*T))-(_=O-(k=(m=h-(j=(g=e*h)-(g-h)))*(T=y-(v=(g=e*y)-(g-y)))-((P=h*y)-j*v-m*v-j*T))),s[0]=O-(_+x)+(x-k),x=(A=F-((w=F+_)-(x=w-F))+(_-x))-(_=A-P),s[1]=A-(_+x)+(x-P),x=(q=w+_)-w,s[2]=w-(q-x)+(_-x),s[3]=q;const J=n(I,u,4,s,i);return i[J-1]}(t,o,c,a,l,d,y)},t.orient2dfast=function(t,e,n,o,r,f){return(e-f)*(n-r)-(t-r)*(o-f)},Object.defineProperty(t,"__esModule",{value:!0})});
},{}],697:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fastConvexHull=g;var n=require("rbush"),r=m(n),e=require("tinyqueue"),t=m(e),a=require("point-in-polygon"),i=m(a),u=require("robust-predicates/umd/orient2d.min.js"),o=f(u);function f(n){if(n&&n.__esModule)return n;var r={};if(null!=n)for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(r[e]=n[e]);return r.default=n,r}function m(n){return n&&n.__esModule?n:{default:n}}const p=o.orient2d;function l(n,e,t){e=Math.max(0,void 0===e?2:e),t=t||0;var a=g(n),i=new r.default(16);i.toBBox=function(n){return{minX:n[0],minY:n[1],maxX:n[0],maxY:n[1]}},i.compareMinX=function(n,r){return n[0]-r[0]},i.compareMinY=function(n,r){return n[1]-r[1]},i.load(n);for(var u,o=[],f=0;f<a.length;f++){var m=a[f];i.remove(m),u=M(m,u),o.push(u)}var p=new r.default(16);for(f=0;f<o.length;f++)p.insert(Y(o[f]));for(var l=e*e,v=t*t;o.length;){var x=o.shift(),c=x.p,s=x.next.p,d=_(c,s);if(!(d<v)){var X=d/l;(m=h(i,x.prev.p,c,s,x.next.next.p,X,p))&&Math.min(_(m,c),_(m,s))<=X&&(o.push(x),o.push(M(m,x)),i.remove(m),p.remove(x),p.insert(Y(x)),p.insert(Y(x.next)))}}x=u;var q=[];do{q.push(x.p),x=x.next}while(x!==u);return q.push(x.p),q}function h(n,r,e,a,i,u,o){for(var f=new t.default([],v),m=n.data;m;){for(var p=0;p<m.children.length;p++){var l=m.children[p],h=m.leaf?q(l,e,a):x(e,a,l);h>u||f.push({node:l,dist:h})}for(;f.length&&!f.peek().node.children;){var c=f.pop(),d=c.node,X=q(d,r,e),Y=q(d,a,i);if(c.dist<X&&c.dist<Y&&s(e,d,o)&&s(a,d,o))return d}(m=f.pop())&&(m=m.node)}return null}function v(n,r){return n.dist-r.dist}function x(n,r,e){if(c(n,e)||c(r,e))return 0;var t=w(n[0],n[1],r[0],r[1],e.minX,e.minY,e.maxX,e.minY);if(0===t)return 0;var a=w(n[0],n[1],r[0],r[1],e.minX,e.minY,e.minX,e.maxY);if(0===a)return 0;var i=w(n[0],n[1],r[0],r[1],e.maxX,e.minY,e.maxX,e.maxY);if(0===i)return 0;var u=w(n[0],n[1],r[0],r[1],e.minX,e.maxY,e.maxX,e.maxY);return 0===u?0:Math.min(t,a,i,u)}function c(n,r){return n[0]>=r.minX&&n[0]<=r.maxX&&n[1]>=r.minY&&n[1]<=r.maxY}function s(n,r,e){for(var t=Math.min(n[0],r[0]),a=Math.min(n[1],r[1]),i=Math.max(n[0],r[0]),u=Math.max(n[1],r[1]),o=e.search({minX:t,minY:a,maxX:i,maxY:u}),f=0;f<o.length;f++)if(X(o[f].p,o[f].next.p,n,r))return!1;return!0}function d(n,r,e){return p(n[0],n[1],r[0],r[1],e[0],e[1])}function X(n,r,e,t){return n!==t&&r!==e&&d(n,r,e)>0!=d(n,r,t)>0&&d(e,t,n)>0!=d(e,t,r)>0}function Y(n){var r=n.p,e=n.next.p;return n.minX=Math.min(r[0],e[0]),n.minY=Math.min(r[1],e[1]),n.maxX=Math.max(r[0],e[0]),n.maxY=Math.max(r[1],e[1]),n}function g(n){for(var r=n[0],e=n[0],t=n[0],a=n[0],u=0;u<n.length;u++){var o=n[u];o[0]<r[0]&&(r=o),o[0]>t[0]&&(t=o),o[1]<e[1]&&(e=o),o[1]>a[1]&&(a=o)}var f=[r,e,t,a],m=f.slice();for(u=0;u<n.length;u++)(0,i.default)(n[u],f)||m.push(n[u]);return b(m)}function M(n,r){var e={p:n,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return r?(e.next=r.next,e.prev=r,r.next.prev=e,r.next=e):(e.prev=e,e.next=e),e}function _(n,r){var e=n[0]-r[0],t=n[1]-r[1];return e*e+t*t}function q(n,r,e){var t=r[0],a=r[1],i=e[0]-t,u=e[1]-a;if(0!==i||0!==u){var o=((n[0]-t)*i+(n[1]-a)*u)/(i*i+u*u);o>1?(t=e[0],a=e[1]):o>0&&(t+=i*o,a+=u*o)}return(i=n[0]-t)*i+(u=n[1]-a)*u}function w(n,r,e,t,a,i,u,o){var f,m,p,l,h=e-n,v=t-r,x=u-a,c=o-i,s=n-a,d=r-i,X=h*h+v*v,Y=h*x+v*c,g=x*x+c*c,M=h*s+v*d,_=x*s+c*d,q=X*g-Y*Y,w=q,y=q;0===q?(m=0,w=1,l=_,y=g):(l=X*_-Y*M,(m=Y*_-g*M)<0?(m=0,l=_,y=g):m>w&&(m=w,l=_+Y,y=g)),l<0?(l=0,-M<0?m=0:-M>X?m=w:(m=-M,w=X)):l>y&&(l=y,-M+Y<0?m=0:-M+Y>X?m=w:(m=-M+Y,w=X));var b=(1-(p=0===l?0:l/y))*a+p*u-((1-(f=0===m?0:m/w))*n+f*e),j=(1-p)*i+p*o-((1-f)*r+f*t);return b*b+j*j}function y(n,r){return n[0]===r[0]?n[1]-r[1]:n[0]-r[0]}function b(n){n.sort(y);for(var r=[],e=0;e<n.length;e++){for(;r.length>=2&&d(r[r.length-2],r[r.length-1],n[e])<=0;)r.pop();r.push(n[e])}for(var t=[],a=n.length-1;a>=0;a--){for(;t.length>=2&&d(t[t.length-2],t[t.length-1],n[a])<=0;)t.pop();t.push(n[a])}return t.pop(),r.pop(),r.concat(t)}exports.default=l;
},{"rbush":838,"tinyqueue":839,"point-in-polygon":298,"robust-predicates/umd/orient2d.min.js":840}],701:[function(require,module,exports) {
function e(e,n,o,r){return e[0]=n[0]+o[0]*r,e[1]=n[1]+o[1]*r,e}module.exports=e;
},{}],702:[function(require,module,exports) {
function t(t,n,o){var r=Math.cos(o),a=Math.sin(o),e=n[0],s=n[1];return t[0]=e*r-s*a,t[1]=e*a+s*r,t}module.exports=t;
},{}],700:[function(require,module,exports) {
var r=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],n=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function t(t,e,f,o){if(!(isNaN(o)||o<1)){var x,b,g,i,l,s,u,h,v,c,w,N,d,m,p,j,k,q,y,z,A,B,C,D,E=(o|=0)+o+1,F=e-1,G=f-1,H=o+1,I=H*(H+1)/2,J=new a,K=J;for(g=1;g<E;g++)if(K=K.next=new a,g==H)var L=K;K.next=J;var M=null,O=null;u=s=0;var P=r[o],Q=n[o];for(b=0;b<f;b++){for(j=k=q=y=h=v=c=w=0,N=H*(z=t[s]),d=H*(A=t[s+1]),m=H*(B=t[s+2]),p=H*(C=t[s+3]),h+=I*z,v+=I*A,c+=I*B,w+=I*C,K=J,g=0;g<H;g++)K.r=z,K.g=A,K.b=B,K.a=C,K=K.next;for(g=1;g<H;g++)i=s+((F<g?F:g)<<2),h+=(K.r=z=t[i])*(D=H-g),v+=(K.g=A=t[i+1])*D,c+=(K.b=B=t[i+2])*D,w+=(K.a=C=t[i+3])*D,j+=z,k+=A,q+=B,y+=C,K=K.next;for(M=J,O=L,x=0;x<e;x++)t[s+3]=C=w*P>>Q,0!=C?(C=255/C,t[s]=(h*P>>Q)*C,t[s+1]=(v*P>>Q)*C,t[s+2]=(c*P>>Q)*C):t[s]=t[s+1]=t[s+2]=0,h-=N,v-=d,c-=m,w-=p,N-=M.r,d-=M.g,m-=M.b,p-=M.a,i=u+((i=x+o+1)<F?i:F)<<2,h+=j+=M.r=t[i],v+=k+=M.g=t[i+1],c+=q+=M.b=t[i+2],w+=y+=M.a=t[i+3],M=M.next,N+=z=O.r,d+=A=O.g,m+=B=O.b,p+=C=O.a,j-=z,k-=A,q-=B,y-=C,O=O.next,s+=4;u+=e}for(x=0;x<e;x++){for(k=q=y=j=v=c=w=h=0,N=H*(z=t[s=x<<2]),d=H*(A=t[s+1]),m=H*(B=t[s+2]),p=H*(C=t[s+3]),h+=I*z,v+=I*A,c+=I*B,w+=I*C,K=J,g=0;g<H;g++)K.r=z,K.g=A,K.b=B,K.a=C,K=K.next;for(l=e,g=1;g<=o;g++)s=l+x<<2,h+=(K.r=z=t[s])*(D=H-g),v+=(K.g=A=t[s+1])*D,c+=(K.b=B=t[s+2])*D,w+=(K.a=C=t[s+3])*D,j+=z,k+=A,q+=B,y+=C,K=K.next,g<G&&(l+=e);for(s=x,M=J,O=L,b=0;b<f;b++)t[(i=s<<2)+3]=C=w*P>>Q,C>0?(C=255/C,t[i]=(h*P>>Q)*C,t[i+1]=(v*P>>Q)*C,t[i+2]=(c*P>>Q)*C):t[i]=t[i+1]=t[i+2]=0,h-=N,v-=d,c-=m,w-=p,N-=M.r,d-=M.g,m-=M.b,p-=M.a,i=x+((i=b+H)<G?i:G)*e<<2,h+=j+=M.r=t[i],v+=k+=M.g=t[i+1],c+=q+=M.b=t[i+2],w+=y+=M.a=t[i+3],M=M.next,N+=z=O.r,d+=A=O.g,m+=B=O.b,p+=C=O.a,j-=z,k-=A,q-=B,y-=C,O=O.next,s+=e}}}function a(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}module.exports=t;
},{}],274:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EnvironmentGrid=exports.GridBounds=exports.EnvironmentCell=void 0;var i=require("../../util/math"),s=o(i),e=require("../../util/Random"),t=l(e);function l(i){return i&&i.__esModule?i:{default:i}}function o(i){if(i&&i.__esModule)return i;var s={};if(null!=i)for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(s[e]=i[e]);return s.default=i,s}class n{constructor(i,s,e,t,l){this.samples=[],this.waterSamples=[],this.patches=[],this.tokens=[],this.seed=i,this.moisture=0,this.elevation=0,this.path=0,this.colorIndex=0,this.x=s,this.y=e,this.cx=t,this.cy=l,this.entity=null}}exports.EnvironmentCell=n;class r{constructor(i,s,e,t){this.minX=i,this.minY=s,this.maxX=e,this.maxY=t}}exports.GridBounds=r;class h{constructor(i,s,e,t,l){this.size=e,this.cellDivisions=Math.ceil(this.size/t),this.colorDivisions=Math.ceil(this.size/l),this.cellTileSize=this.size/this.cellDivisions,this.colorTileSize=this.size/this.colorDivisions,this.colors=s,this.colorIndices=new Uint8Array(this.colorDivisions*this.colorDivisions),this.cells=new Array(this.cellDivisions*this.cellDivisions);for(let s=0;s<this.cells.length;s++){const e=new Uint16Array(4);for(let s=0;s<4;s++)e[s]=65536*i.value();const t=Math.floor(s%this.cellDivisions),l=Math.floor(s/this.cellDivisions),o=-this.size/2+t*this.cellTileSize+this.cellTileSize/2,r=-this.size/2+l*this.cellTileSize+this.cellTileSize/2;this.cells[s]=new n(e,t,l,o,r)}}box3ToBounds(i,e=new r){const t=i.min,l=i.max,o=s.inverseLerp(-this.size/2,this.size/2,t.x),n=s.inverseLerp(-this.size/2,this.size/2,t.z),h=s.inverseLerp(-this.size/2,this.size/2,l.x),c=s.inverseLerp(-this.size/2,this.size/2,l.z);return e.minX=s.clamp(Math.floor(o*this.cellDivisions),0,this.cellDivisions-1),e.minY=s.clamp(Math.floor(n*this.cellDivisions),0,this.cellDivisions-1),e.maxX=s.clamp(Math.floor(h*this.cellDivisions),0,this.cellDivisions-1),e.maxY=s.clamp(Math.floor(c*this.cellDivisions),0,this.cellDivisions-1),e}forEachCellInBounds(i,s){const{maxX:e,maxY:t,minX:l,minY:o}=i;for(let i=l;i<=e;i++)for(let e=o;e<=t;e++){const t=i+e*this.cellDivisions;s(this.cells[t])}}isCellInBounds(i,s){const{maxX:e,maxY:t,minX:l,minY:o}=s;return i.x>=l&&i.x<=e&&i.y>=o&&i.y<=t}getCellAt(i,e){const t=s.inverseLerp(-this.size/2,this.size/2,i),l=s.inverseLerp(-this.size/2,this.size/2,e),o=Math.floor(t*this.cellDivisions)+Math.floor(l*this.cellDivisions)*this.cellDivisions;return this.cells[o]}getColorAt(i,e){const t=s.inverseLerp(-this.size/2,this.size/2,i),l=s.inverseLerp(-this.size/2,this.size/2,e),o=Math.floor(t*this.colorDivisions)+Math.floor(l*this.colorDivisions)*this.colorDivisions;return this.colors[this.colorIndices[o]%this.colors.length]}}exports.EnvironmentGrid=h;
},{"../../util/math":240,"../../util/Random":235}],287:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};exports.default=te;var t=require("../../tags"),n=K(t),o=require("three"),r=K(o),a=require("d3-polygon"),i=require("canvas-sketch-util/color"),s=$(i),l=require("fast-2d-poisson-disk-sampling"),u=$(l),c=require("../../shaders/water.frag"),d=$(c),f=require("../../util/Random"),p=$(f),h=require("../../util/mst"),m=require("euclidean-distance/squared"),g=$(m),v=require("d3-delaunay"),w=require("simplex-noise"),M=$(w),k=require("../../util/concaveman"),y=$(k),D=require("../../util/helpers"),b=K(D),q=require("simplify-path"),x=$(q),A=require("point-in-polygon"),S=$(A),C=require("bound-points"),E=$(C),B=require("gl-vec2/scaleAndAdd"),P=$(B),I=require("gl-vec2/rotate"),T=$(I),L=require("stackblur"),R=$(L),_=require("../../util/geometry"),G=require("../../util/ShaderManager"),F=K(G),O=require("../../util/RefGLTFLoader"),V=require("d3-quadtree"),U=require("earcut"),j=$(U),H=require("../../util/math"),N=K(H),W=require("euclidean-distance"),z=$(W),J=require("../../util/load"),X=require("./EnvironmentGrid"),Y=require("../../util/tokens");function $(e){return e&&e.__esModule?e:{default:e}}function K(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}const Q=25,Z=45,ee=2025;function te(t,{biome:o="forest",biomeData:i,width:s,height:l,bounds:c,renderer:f,uvMat:m,repeatX:w,repeatY:k,mapGround:D,mapOverlay:b,mapGroundPath:q,waterDistortMap:A,waterNoiseMap:C,waterVertexShader:B}){const I=[0,0],L=i[o],G=L.hasLakes,U=L.hasIce,H=L.colors,W=L.waterColors,J=new Uint16Array(L.seed),$=(0,p.default)(J),K=new M.default($.value),Z=new M.default($.value),te=new r.Group;te.name=`Environment-${o}`;const oe=function(e,t,n,o,i,u){let d=t.shuffle(Le(s,l,n,t)).map(e=>{const o=e.slice(),r=t.insideCircle(.5*n,I);return o[0]+=r[0],o[1]+=r[1],{center:e,radius:n,position:o}});const f=4*n,p=f;let m=[];o&&(m=Le(s,l,f,t),m=t.shuffle(m.filter(e=>(0,z.default)(e,[0,0])>4*n)).slice(0,8));d=d.filter(e=>{(0,z.default)(e.position,[0,0]);for(let t=0;t<m.length;t++){const n=(0,z.default)(e.position,m[t]);if(n<p/2)return!1}const t=Math.abs(e.position[0]),n=Math.abs(e.position[1]);return t<s/2*.95&&n<l/2*.95});const w=(0,h.getMinimumSpanningTree)(d.map(e=>e.position),(e,t)=>(0,g.default)(e,t)).map(e=>e.indices),M=w.map(e=>{const t=e.map(e=>d[e]);return t.map(e=>e.position)}),k=c.flat(),y=M.map(e=>{const o=t.rangeFloor(5,5),r=[];for(let a=0;a<o;a++){const i=a/o,s=N.lerpArray(e[0],e[1],i);t.insideCircle(n/8,I),s[0]+=I[0],s[1]+=I[1],r.push(s)}return r}).flat(),D=function(e,t,n,o){const r=Math.max(1,Math.ceil(e/n)),a=Math.max(1,Math.ceil(t/n)),i=Math.round(5*Math.max(r,a));return N.linspace(i).map(()=>[o.range(-e/2,e/2),o.range(-t/2,t/2)])}(s,l,1,t),b=v.Delaunay.from(D);for(let e=0;e<2;e++)Te(k,b,.5);const q=b.voronoi(k),A=Array.from(q.cellPolygons()).map((e,t)=>{const n=e.index;return n!==t&&console.error("ERR! poly index doesn't match"),e=Array.from(e).slice(0,e.length-1)}),S=A.map(e=>(0,a.polygonCentroid)(e)),C=S.map(e=>Ie(e[0],e[1],y,n)),B=S.map(e=>Ie(e[0],e[1],m,p/4,1,1.5)),P=A.map((e,t)=>{const n=S[t],{elevation:o,moisture:r}=ne(s,l,i,u,n[0],n[1]),a=C[t],c=B[t];return{polygon:e,connections:w,segments:M,distance:a,lakeDistance:c,moisture:r,elevation:o}});Pe(P,"moisture"),Pe(P,"elevation"),Pe(P,"lakeDistance"),Pe(P,"distance");const T=new Set;P.forEach((e,t)=>{const{distance:n,moisture:r,elevation:a,lakeDistance:i}=e,s=r,l=a,u=(0,z.default)([0,0],S[t]);e.centroid=S[t],e.lengthFromCenter=u,o&&u>40&&n<.25&&(s>.5&&l<.5||i>.5)&&T.add(t)});const L=function(e,t){const n=new Set,o=new Set;return t.forEach(r=>{if(!n.has(r)){const a=function(e,t,n,o){const r=new Set,a=[n];for(;a.length>0;){const n=a.shift();r.add(n);for(let i of e.neighbors(n))!t.has(i)||r.has(i)||o.has(i)||(r.add(i),a.push(i))}return r}(e,t,r,n);a.forEach(e=>{n.add(e)}),o.add([...a])}}),[...o]}(q,T).filter(e=>e.length>2).map(e=>Be(P,e)).map(e=>{const t=(0,x.default)(e,1);return t.length&&t.pop(),t}).filter(e=>e.length>4).map(e=>{const t=e.map(e=>new r.Vector3(e[0],0,e[1]));return new r.CatmullRomCurve3(t,!0,"chordal",.5).getSpacedPoints(8*e.length).map(e=>[e.x,e.z])});return{lakes:L,lakeBounds:L.map(e=>(0,E.default)(e)),tokens:d,segments:M,cells:P}}(0,$,20,G,K,Z);!function(e){e.cells.forEach(t=>{const{distance:n,moisture:o,elevation:a,lakeDistance:i}=t,s=o,l=a;let u=0;if(G){const n=10;u=t.lengthFromCenter>n&&(Ce(e,t.centroid,n)||t.polygon.some(o=>Ce(e,t.centroid,n)))?3:s<.5&&l>=.5?0:s<.5&&l<.5?1:2}else u=s<.5&&l>=.5?0:s<.5&&l<.5?1:s>=.5&&l>=.5?2:3;t.colorIndex=u;const c=new r.Color;c.set(H[t.colorIndex%H.length].color),c.offsetHSL(0,0,.05*(2*t.elevation-1)),c.offsetHSL(0,0,.1*(2*t.moisture-1)),c.offsetHSL(.01*$.range(-1,1),.01*$.range(-1,1),.1*(2*N.smoothstep(0,1,t.distance)-1)),t.color=c})}(oe);const re=$.shuffle(oe.tokens.filter(e=>{const t=(0,g.default)(e.position,[0,0]);return $.chance(.7)&&t>=ee})),ae=Math.round(.75*re.length),ie=[],se=new X.EnvironmentGrid($,H,Math.min(s,l),40,10),le=(0,V.quadtree)().x(e=>e.centroid[0]).y(e=>e.centroid[1]);le.extent(c),le.addAll(oe.cells),function(e,t){for(let n=0;n<t.colorDivisions;n++)for(let o=0;o<t.colorDivisions;o++){const r=o/(t.colorDivisions-1),a=n/(t.colorDivisions-1),i=N.lerp(-s/2,s/2,r),u=N.lerp(-l/2,l/2,a),c=e.find(i,u);t.colorIndices[o+n*t.colorDivisions]=c.colorIndex}}(le,se);const ue=Object.keys(O.MetaData).filter(e=>O.MetaData[e].type===o&&!e.includes("items")),ce=$.deck(ue);for(let e=0;e<re.length&&ie.length<ae;e++){const t=re[e];if(!Ce(oe,t.position,4)){const e=t.position.slice(),n=(se.getColorAt(e[0],e[1]),ce.current),o=O.MetaData[n];if(N.linspace(8).map(t=>{const n=2*Math.PI*t;return[Math.cos(n)*o.boundingCircle.radius+e[0],Math.sin(n)*o.boundingCircle.radius+e[1]]}).some(e=>Ce(oe,e,4)))continue;const r={name:n,position:e};ie.push(r);const a=.85*o.boundingCircle.radius;t.position[1]+=a,ce.next()}}const de=re.filter(e=>!1!==e.active&&(0,_.point2DInsideBounds)(e.position,c)&&!Ce(oe,e.position,4));let fe=function(e,t,n,o,r,a){const i=new u.default({shape:[s,l],tries:10,radius:3},o.value),c=[0,0],d=[0,0],f=[0,0],p=[0,0],h=[0,0],m=[0,0];t.segments.forEach(([e,t])=>{!function(e=[],t,n){let o=n[0]-t[0],r=n[1]-t[1];const a=o*o+r*r;if(0!==a){const e=Math.sqrt(a);o/=e,r/=e}e[0]=o,e[1]=r}(c,e,t),function(e=[],t){e[0]=-t[1],e[1]=t[0]}(d,c);const n=(0,z.default)(e,t),{elevation:u,moisture:g}=ne(s,l,r,a,(e[0]+t[0])/2,(e[1]+t[1])/2),v=N.lerp(.25,20,u),w=Math.max(2,Math.ceil(n/v));for(let n=0;n<w;n++){let r=n/(w-1);r=N.lerp(0,1,r);const a=o.rangeFloor(1,6);for(let n=0;n<a;n++){const n=N.lerpArray(e,t,r,f);n[0]+=s/2,n[1]+=l/2;const a=Math.abs(o.gaussian(1,1));(0,P.default)(n,n,o.insideCircle(a,m),1);const u=o.range(15,20)+Math.abs(o.gaussian(0,5));for(let e=0;e<2;e++){const t=0===e?-1:1,r=45;(0,T.default)(h,d,N.degToRad(o.range(-r,r))),(0,P.default)(p,n,h,u*t),i.inNeighbourhood(p)||((0,P.default)(p,p,o.insideCircle(o.range(0,1.5),m),1),i.addPoint(p))}}}});const v=Q*Q;return i.samplePoints.map(e=>[-s/2+e[0],-l/2+e[1]]).filter(t=>{return!n.some(e=>(0,g.default)(e.position,t)<16)&&!e.some(e=>{const n=e.name in O.MetaData&&O.MetaData[e.name];if(n){const o=n.boundingCircle.radius;return(0,_.circlesIntersect)(t,1,e.position,o)}return!1})&&(0,g.default)(t,[0,0])>v})}(ie,oe,de,$,K,Z),pe=[],he=[];fe.forEach(e=>{if(Ce(oe,e,1));else{if(U&&$.chance(.5))return;pe.push(e)}}),G&&oe.lakeBounds.forEach((e,t)=>{const[n,o]=e,r=o[0]-n[0],a=o[1]-n[1];new u.default({shape:[r,a],tries:10,radius:10},$.value).fill().map(e=>[n[0]+e[0],n[1]+e[1]]).filter(n=>{if((0,_.point2DInsideBounds)(n,e)&&(0,S.default)(n,oe.lakes[t])){const e=2.5,o=e*e;if(!oe.lakes[t].some(e=>(0,g.default)(e,n)<o))return!0}return!1}).forEach(e=>{he.push(e)})});const me=function(e,t,n,o){const a=document.createElement("canvas"),i=a.getContext("2d");return[0,1,2,3,4].map((u,d)=>{let f=u>=2?256:512;4===u&&(f=128),a.width=f,a.height=f,function(e,t,n,o){t.fillStyle="black",t.clearRect(0,0,n,n),t.fillRect(0,0,n,n);const[r,a]=c,i=a[0]-r[0],u=a[1]-r[1],d=e.width/i,f=e.height/u;t.save(),t.scale(d,f),t.translate(s/2,l/2),t.scale(1,1),o({context:t,canvas:e}),t.restore()}(a,i,f,({canvas:e,context:a})=>(function({c:e,i:t,canvas:n,context:o,geo:a,groundColors:i,waterColors:s}){const l=new r.Color;0===e||1===e?a.cells.forEach(t=>{let n;if(0===e){const e=.2*$.range(-1,1),o=.2*$.range(-1,1),r=.2*$.range(-1,1);l.setRGB(N.clamp01(t.moisture+e),N.clamp01(t.elevation+o),N.clamp01(t.distance+r)),n=l.getStyle()}else n=t.color.getStyle();o.fillStyle=o.strokeStyle=n,o.beginPath(),t.polygon.forEach(e=>o.lineTo(...e)),o.lineJoin="round",o.lineWidth=1,o.fill(),o.stroke()}):a.lakes.forEach((t,n)=>{o.fillStyle="white",o.strokeStyle=4===e?"white":"black",o.beginPath(),t.forEach(e=>o.lineTo(...e)),o.lineJoin="round",o.closePath(),o.lineWidth=4===e?.5:2,o.fill(),o.stroke()})})({c:u,i:d,canvas:e,context:a,geo:t,groundColors:n,waterColors:o}));let p=2,h=4;2===u?(p=1,h=2):3===u?(p=2,h=8):4===u&&(p=0,h=0),p>0&&function(e,t,n,o=1,r=8){const a=e.getImageData(0,0,t,n);for(let e=0;e<o;e++)(0,R.default)(a.data,t,n,r);e.putImageData(a,0,0)}(i,f,f,p,h);const m=new r.Texture(a);return m.needsUpdate=!0,e.initTexture(m),m.image=null,m})}(f,oe,H,W),[ge,ve,we,Me,ke]=me,ye=function(e,o){const i=t.findTag(n.GroundDataRenderTarget),u=t.findTag(n.GroundPlaneView);return oe.lakes.map((e,c)=>{const[f,p]=oe.lakeBounds[c],h=p[0]-f[0],g=p[1]-f[1],v=Math.sqrt(h*h+g*g)/2,M=(0,a.polygonCentroid)(e),y=e.flat(1/0),D=(0,j.default)(y,[],2),b=new r.BufferGeometry,q=[],x=[],S=[],E=[];e.forEach((e,t,n)=>{S.push(t/(n.length-1)*Math.PI*2),x.push(e[0],0,e[1]);const o=N.inverseLerp(-s/2,s/2,e[0]),r=N.inverseLerp(l/2,-l/2,e[1]);q.push(o,r);const a=N.inverseLerp(f[0],p[0],e[0]),i=N.inverseLerp(f[1],p[1],e[1]);E.push(a,i)}),b.setAttribute("position",new r.Float32BufferAttribute(x,3)),b.setAttribute("uv",new r.Float32BufferAttribute(q,2)),b.setAttribute("surfUv",new r.Float32BufferAttribute(E,2)),b.setAttribute("angle",new r.Float32BufferAttribute(S,1)),b.setIndex(new r.Uint16BufferAttribute(D,1));const P=F.create({name:"WaterShader",uniforms:{uvScale:{value:new r.Vector2(w,k)},time:{value:0},centroidPosition:{value:new r.Vector3(M[0],0,M[1])},uvTransform:{value:m},environmentSize:{value:new r.Vector2(s,l)},worldDataMap:{value:i?i.target.texture:getEmptyTexture()},worldDataProjection:{value:i?i.projection:new r.Matrix4},worldDataView:{value:i?i.view:new r.Matrix4},waterDistortMap:{value:A},waterNoiseMap:{value:C},lakeSize:{value:v},colorA:{value:new r.Color(U?"#698193":"#163d84")},colorB:{value:new r.Color(U?"#a8bec4":"#49c2ff")},groundMap:{value:u.target.texture},dataMapBiome:{value:o[0]},dataMapColor:{value:o[1]},dataMapLake:{value:o[2]},dataMapLakeBlur:{value:o[3]},uvRepeatScale:{value:1}},side:r.BackSide,vertexShader:B,transparent:!0,defines:{WATER:!U,HAS_GROUND_MAP:!0,HAS_DATA_MAP:!0,HAS_ANGLE:!0,HAS_SURF_UV:!0},fragmentShader:d.default}),I=new r.Mesh(b,P);return I.userData.colorA=P.uniforms.colorA.value.clone(),I.userData.colorB=P.uniforms.colorB.value.clone(),te.add(I),t.entity().add(n.ShaderUniformTime,{uniform:P.uniforms.time}),I.layers.set(t.findTag(n.RenderLayers).water),I.renderOrder=-1,I.position.y=.05,I})}(0,me);!function(e,t,n,o){n.forEach((e,n)=>{const o=t.getCellAt(e[0],e[1]);o&&o.samples.push(n)}),o.forEach((e,n)=>{const o=t.getCellAt(e[0],e[1]);o&&o.waterSamples.push(n)});for(let n=0;n<t.cellDivisions;n++)for(let o=0;o<t.cellDivisions;o++){const r=o/(t.cellDivisions-1),a=n/(t.cellDivisions-1),i=N.lerp(-s/2,s/2,r),u=N.lerp(-l/2,l/2,a),c=e.find(i,u),d=t.cells[o+n*t.cellDivisions];d.elevation=c.elevation,d.moisture=c.moisture,d.path=c.distance,d.colorIndex=c.colorIndex}}(le,se,pe,he);const De=Y.BiomeFeatures[o].tokens,be=de.filter(e=>{const[t,n]=c;return Math.abs(e.position[0]-t[0])>15&&Math.abs(e.position[1]-t[1])>15&&Math.abs(e.position[0]-n[0])>15&&Math.abs(e.position[1]-n[1])>15}).map(e=>({position:e.position,type:$.pick(De)})),qe=ie.filter(e=>{const t=(0,z.default)(e.position,[0,0]);return t>=25&&t<192}),xe=$.pick(qe),Ae=O.MetaData[xe.name],Se=new r.Vector3(xe.position[0]-.75*Ae.boundingCircle.radius,0,xe.position[1]-.75*Ae.boundingCircle.radius);return be.forEach((e,t)=>{const[n,o]=e.position;se.getCellAt(n,o).tokens.push(t)}),ie.push({name:"origin-patch-0",position:[0,0]}),ie.forEach((e,t)=>{const[n,o]=e.position;se.getCellAt(n,o).patches.push(t)}),t.entity().add(n.EnvironmentState,e({},L,{data:{width:s,height:l},waterMeshes:ye,name:o,haikusTotal:L.haikusTotal,patches:ie,tokens:be,group:te,lakes:oe.lakes.map((e,t)=>({bounds:oe.lakeBounds[t],polygon:e})),idleViewPoint:Se,colors:H,textures:me,waterMap:ke,grid:se,samples:pe,waterSamples:he}));function Ce(e,t,n=2){for(let o=0;o<e.lakeBounds.length;o++)if(Ee(e,t,o,n))return!0;return!1}function Ee(e,t,n,o=2){const r=o*o,a=e.lakeBounds[n];return!(!(0,_.point2DInsideBounds)(t,a)||!(0,S.default)(t,e.lakes[n]))||!!e.lakes[n].some(e=>(0,g.default)(e,t)<r)}function Be(e,t){const n=[];return t.forEach(t=>{const[o,r]=(0,E.default)(e[t].polygon),a=r[0]-o[0],i=r[1]-o[1],s=.5*Math.min(a,i),l=$.range(-1,1)*Math.PI*2;N.linspace(8).map(e=>{const t=2*e*Math.PI+l,r=o[0]+a/2+Math.cos(t)*s,u=o[1]+i/2+Math.sin(t)*s;n.push([r,u])})}),(0,y.default)(n)}function Pe(e,t){const n=e.reduce((e,n)=>Math.max(e,n[t]),-1/0),o=e.reduce((e,n)=>Math.min(e,n[t]),1/0);n!==o&&e.forEach(e=>{e[t]=N.mapRange(e[t],o,n,0,1,!0)})}function Ie(e,t,n,o,r=1,a=1.5,i=.5){let s=0;for(let l=0;l<n.length;l++){const u=n[l],c=e-u[0],d=t-u[1],f=c*c+d*d;let p=0===f?0:Math.sqrt(f);const h=o*r,m=o*a,g=N.clamp01(N.inverseLerp(h,m,p));s+=1-Math.pow(g,i)}return s}function Te(e,t,n=.5){const o=t.voronoi(e);for(let e=0;e<t.points.length;e+=2){const r=o.cellPolygon(e>>1);if(null===r)continue;const i=t.points[e],s=t.points[e+1],[l,u]=(0,a.polygonCentroid)(r);t.points[e]=i+(l-i)*n,t.points[e+1]=s+(u-s)}t.update()}function Le(e,t,n,o){const r=new u.default({shape:[e,t],tries:10,radius:2*n},o.value);return r.addPoint([e/2,t/2]),r.fill().map(n=>[-e/2+n[0],-t/2+n[1]])}}function ne(e,t,n,o,r,a){const{t1:i,f1:s,k1:l,t2:u,f2:c,k2:d}={f1:2,t1:4,k1:.5,f2:2,t2:4,k2:.25},f=e/t;let p=N.inverseLerp(-e/2,e/2,r),h=N.inverseLerp(-t/2,t/2,a);return p*=f,{elevation:N.lerp(Math.pow(oe(n,p,h,0,i),1.2),.5*n.noise2D(p*s,h*s)+.5,l),moisture:N.lerp(Math.pow(oe(o,p,h,0,u),1),.5*o.noise2D(p*c,h*c)+.5,d)}}function oe(e,t,n,o=0,r=.1){const a=t*r,i=n*r;let s=1*(.5*e.noise3D(1*a,1*i,o)+.5)+.5*(.5*e.noise3D(2*a,2*i,o)+.5)+.25*(.5*e.noise3D(4*a,4*i,o)+.5)+.13*(.5*e.noise3D(8*a,8*i,o)+.5)+.06*(.5*e.noise3D(16*a,16*i,o)+.5)+.03*(.5*e.noise3D(32*a,32*i,o)+.5);return s/=1.97}
},{"../../tags":60,"three":74,"d3-polygon":295,"canvas-sketch-util/color":699,"fast-2d-poisson-disk-sampling":289,"../../shaders/water.frag":696,"../../util/Random":235,"../../util/mst":282,"euclidean-distance/squared":307,"d3-delaunay":296,"simplex-noise":294,"../../util/concaveman":697,"../../util/helpers":250,"simplify-path":297,"point-in-polygon":298,"bound-points":300,"gl-vec2/scaleAndAdd":701,"gl-vec2/rotate":702,"stackblur":700,"../../util/geometry":251,"../../util/ShaderManager":243,"../../util/RefGLTFLoader":252,"d3-quadtree":299,"earcut":301,"../../util/math":240,"euclidean-distance":698,"../../util/load":247,"./EnvironmentGrid":274,"../../util/tokens":138}],283:[function(require,module,exports) {
module.exports="#define GLSLIFY 1\nvarying vec2 vUv;\nvarying vec2 vTextureUv;\n#ifdef HAS_ANGLE\nattribute float angle;\nvarying float vAngle;\n#endif\n#ifdef HAS_GROUND_MAP\nvarying vec2 vGroundUv;\n#endif\n#ifdef HAS_SURF_UV\nattribute vec2 surfUv;\nvarying vec2 vSurfUv;\n#endif\nvarying vec3 vWorldPosition;\n#ifdef HAS_DATA_MAP\nvarying vec2 vDataUv;\nuniform mat4 worldDataProjection;\nuniform mat4 worldDataView;\nuniform vec2 environmentSize;\n#endif\n#ifdef HAS_SHADOW_MAP\nvarying vec2 vShadowUv;\nvarying vec3 vShadowClipPos;\nuniform mat4 shadowProjection;\n#endif\nuniform mat3 uvTransform;\nuniform vec2 uvScale;\n\nuniform float uvRepeatScale;\n\nvoid main () {\n  vec4 worldPos = modelMatrix * vec4(position.xyz, 1.0);\n\n  #ifdef HAS_ANGLE\n  vAngle = angle;\n  #endif\n  #ifdef HAS_SURF_UV\n  vSurfUv = surfUv;\n  #endif\n\n  #ifdef HAS_SHADOW_MAP\n  // vec4 vShadowPos = shadowProjection * vec4(position.xyz, 1.0);\n  // vec2 vShadowScreen = vShadowPos.xy / vShadowPos.w;\n  // vShadowUv = vShadowScreen.xy * 0.5 + 0.5;\n\n  vec4 baseClipPos = shadowProjection * vec4(worldPos.xyz, 1.0);\n  vShadowClipPos = vec3(baseClipPos.xy, baseClipPos.w);\n  // vShadowUv = (baseClipPos.xy / baseClipPos.w) * 0.5 + 0.5;\n  #endif\n\n  #ifdef HAS_DATA_MAP\n  vec2 worldPosUV = uv;\n  worldPosUV.y = 1.0 - worldPosUV.y;\n  vec2 dataWorldPos = (worldPosUV * 2.0 - 1.0) * environmentSize / 2.0;\n  vec4 vDataUvPos4 = worldDataProjection * worldDataView * vec4(dataWorldPos.xy, 0.0, 1.0);\n  vec2 vDataScreen = vDataUvPos4.xy / vDataUvPos4.w;\n  vDataUv = vDataScreen.xy * 0.5 + 0.5;\n  #endif\n\n  vUv = uv;\n  vTextureUv = uv * uvScale * uvRepeatScale;\n  vTextureUv = (uvTransform * vec3(vTextureUv, 1.0)).xy;\n  vWorldPosition = worldPos.xyz;\n\n  gl_Position = projectionMatrix * viewMatrix * worldPos;\n\n  #ifdef HAS_GROUND_MAP\n  vGroundUv = gl_Position.xy / gl_Position.w * 0.5 + 0.5;\n  #endif\n}";
},{}],284:[function(require,module,exports) {
module.exports="#define GLSLIFY 1\nfloat blendSoftLight(float base, float blend) {\n\treturn (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n}\n\nvec3 blendSoftLight(vec3 base, vec3 blend) {\n\treturn vec3(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b));\n}\n\nvec3 blendSoftLight(vec3 base, vec3 blend, float opacity) {\n\treturn (blendSoftLight(base, blend) * opacity + base * (1.0 - opacity));\n}\n\nfloat blendOverlay(float base, float blend) {\n\treturn base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n}\n\nvec3 blendOverlay(vec3 base, vec3 blend) {\n\treturn vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n}\n\nvec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n\treturn (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n}\n\nfloat luma(vec3 color) {\n  return dot(color, vec3(0.299, 0.587, 0.114));\n}\n\nfloat luma(vec4 color) {\n  return dot(color.rgb, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vUv;\nvarying vec2 vDataUv;\nvarying vec2 vShadowUv;\nvarying vec2 vTextureUv;\nvarying vec3 vShadowClipPos;\nuniform sampler2D dataMapBiome;\nuniform sampler2D dataMapColor;\nuniform sampler2D dataMapLake;\nuniform float overlayOpacity;\n\nuniform float time;\n\n#ifdef USE_MAP_OVERRIDE\nuniform sampler2D overrideMap;\n#endif\n\nuniform sampler2D shadowMap;\n\nuniform mat4 worldFogProjection;\nuniform sampler2D worldFogMap;\nuniform vec3 clearColor;\n\n#ifdef USE_MAP_OVERRIDE\nuniform bool useOverrideMap;\n#endif\n\nuniform bool useOverrideColor;\nuniform vec3 overrideColor;\nuniform float solved;\nuniform vec3 originColor;\nuniform sampler2D worldDataMap;\n\n// uniform sampler2D map0;\n// uniform sampler2D map1;\n// uniform sampler2D map2;\n// uniform sampler2D map3;\n// uniform sampler2D mapPath;\nuniform sampler2D mapGround;\nuniform sampler2D mapGroundPath;\nuniform sampler2D mapOverlay;\n\nuniform float tutorial;\n\n// vec3 blend(vec4 texture1, float a1, vec4 texture2, float a2) {\n//     float depth = 0.2;\n//     float ma = max(texture1.a + a1, texture2.a + a2) - depth;\n\n//     float b1 = max(texture1.a + a1 - ma, 0);\n//     float b2 = max(texture2.a + a2 - ma, 0);\n\n//     return (texture1.rgb * b1 + texture2.rgb * b2) / (b1 + b2);\n// }\n\nvec3 blend(vec4 texture1, float a1, vec4 texture2, float a2) {\n  return texture1.a > texture2.a ? texture1.rgb : texture2.rgb;\n}\n\nvec4 textureLuma(sampler2D tex, vec2 uv) {\n  vec3 rgb = texture2D(tex, uv).rgb;\n  float d = dot(rgb, vec3(0.299, 0.587, 0.114));\n  return vec4(rgb, d);\n}\n\n// vec3 splat (float m, float e, float p, vec2 uv) {\n//   vec3 tex0 = texture2D(map0, uv).rgb;\n//   vec3 tex1 = texture2D(map1, uv).rgb;\n//   vec3 tex2 = texture2D(map2, uv).rgb;\n//   vec3 tex3 = texture2D(map3, uv).rgb;\n//   vec3 texPath = texture2D(mapPath, uv).rgb;\n//   //   mix(tex0, tex1, m),\n//   //   mix(tex2, tex3, e),\n//   //   p);\n//   // return tex;\n\n//   // vec3 tex;\n//   // if (m < 0.5 && e >= 0.5) {\n//   //   // dry, high\n//   //   tex = tex0;\n//   // } else if (m < 0.5 && e < 0.5) {\n//   //   // dry, low\n//   //   tex = tex1;\n//   // } else if (m >= 0.5 && e >= 0.5) {\n//   //   // wet, high\n//   //   tex = tex2;\n//   // } else {\n//   //   // wet, low\n//   //   tex = tex3;\n//   // }\n//   // return mix(tex, texPath, step(0.4, p));\n\n//   float w0 = 0.0;\n//   float w1 = 0.0;\n//   float w2 = 0.0;\n//   float w3 = 0.0;\n//   float feather = 0.1;\n//   float t = 0.5;\n//   w0 = smoothstep(t + feather, t - feather, m) * smoothstep(t - feather, t + feather, e);\n//   w1 = smoothstep(t + feather, t - feather, m) * smoothstep(t + feather, t - feather, e);\n//   w2 = smoothstep(t - feather, t + feather, m) * smoothstep(t - feather, t + feather, e);\n//   w3 = smoothstep(t - feather, t + feather, m) * smoothstep(t + feather, t - feather, e);\n//   vec3 tex = vec3(0.0);\n//   // tex = tex0 * w0;\n//   tex += tex0 * w0 + tex1 * w1;\n//   tex += tex2 * w2 + tex3 * w3;\n//   float pt = 0.35;\n//   float pf = 0.5;\n//   return mix(tex * 0.5, tex, smoothstep(pt - pf, pt + pf, p));\n//   // return mix(mix(tex, texPath.r * tex, 0.15), tex, smoothstep(pt - pf, pt + pf, p));\n//   // return mix(tex, texPath.rgb, smoothstep(pt - pf, pt + pf, p));\n// }\n\n// void main () {\n//   vec3 dataColor = texture2D(worldDataMap, vDataUv).rgb;\n//   vec3 biome = texture2D(dataMapBiome, vUv).rgb;\n//   vec3 worldColor = texture2D(dataMapColor, vUv).rgb;\n//   if (useOverrideColor) {\n//     worldColor = overrideColor;\n//   }\n//   vec3 overlay = texture2D(mapOverlay, vTextureUv).rgb;\n//   vec3 groundTex = texture2D(mapGround, vTextureUv).rgb;\n//   vec3 pathTex = texture2D(mapGroundPath, vTextureUv * 2.0).rgb;\n//   gl_FragColor.rgb = vec3(worldColor);\n\n//   vec3 worldFogColor = texture2D(worldFogMap, vUv).rgb;\n//   gl_FragColor.rgb *= worldFogColor;\n//   gl_FragColor.a = 1.0;\n// }\n\nfloat sdBox( in vec2 p, in vec2 b )\n{\n    vec2 d = abs(p)-b;\n    return length(max(d,0.0)) + min(max(d.x,d.y),0.0);\n}\n\nvoid main2 () {\n  vec3 dataColor = texture2D(worldDataMap, vDataUv).rgb;\n  vec3 biome = texture2D(dataMapBiome, vUv).rgb;\n  vec3 worldColor = texture2D(dataMapColor, vUv).rgb;\n  gl_FragColor.rgb = worldColor;\n  gl_FragColor.a = 1.0;\n}\n\nvoid main () {\n  vec3 dataColor = texture2D(worldDataMap, vDataUv).rgb;\n  vec3 biome = texture2D(dataMapBiome, vUv).rgb;\n  vec3 worldColor = texture2D(dataMapColor, vUv).rgb;\n  vec3 oWorldColor = worldColor;\n  if (useOverrideColor) {\n    worldColor = overrideColor;\n  }\n\n  vec3 overlay = texture2D(mapOverlay, vTextureUv).rgb;\n  vec3 groundTex = texture2D(mapGround, vTextureUv).rgb;\n  vec3 pathTex = texture2D(mapGroundPath, vTextureUv * 2.0).rgb;\n\n  float wdist = 0.04;\n  float wd = distance(vUv, vec2(0.5, 0.5)) / wdist;\n  float wt = 0.5 + ((groundTex.x*2.0-1.0) * 0.5) + ((pathTex.x*2.0-1.0) * 0.5);\n  float wg = 0.45;\n  wd = smoothstep(wt - wg, wt + wg, wd);\n  float distFromCenter = 1.0 - clamp(wd, 0.0, 1.0);\n  // worldColor = mix(worldColor, vec3(0.45), distFromCenter);\n  worldColor = mix(mix(worldColor, vec3(originColor), tutorial), vec3(originColor), distFromCenter);\n\n  // worldColor = mix(worldColor, vec3(originColor), distFromCenter);\n  \n  // float boxLen = abs(vUv.x - 0.5) + abs(vUv.y - 0.5);\n  float edgeThreshold = 0.5;\n  float edgeGlow = 0.025;\n  // worldColor = vec3(boxLen);\n  // worldColor *= step(boxLen, 0.48);\n\n  float edge0 = smoothstep(edgeThreshold, edgeThreshold-edgeGlow, abs(vUv.x - 0.5));\n  float edge1 = smoothstep(edgeThreshold, edgeThreshold-edgeGlow, abs(vUv.y - 0.5));\n  // worldColor = originColor;\n  // worldColor = mix(originColor, worldColor, distFromCenter);\n\n  // vec3 worldFogColor = texture2D(worldFogMap, vUv).rgb;\n  // worldColor.rgb *= mix(1.0, 0.0, (1.0-distFromCenter) * (1.0-worldFogColor.r));\n\n  float lake = texture2D(dataMapLake, vUv).r;\n\n  float pathEdge = smoothstep(0.4, 0.75, biome.b + (biome.r * 2.0 - 1.0) * 0.1);\n  pathEdge = clamp(pathEdge, 0.0, 1.0);\n  vec3 tex = mix(groundTex, pathTex, pathEdge);\n\n  vec3 col = worldColor;\n\n  // #ifdef USE_MAP_OVERRIDE\n  // vec3 overrideRGB = texture2D(overrideMap, vTextureUv).rgb;\n  // if (useOverrideMap) {\n  //   col *= overrideRGB;\n  // } else {\n    float darken = 0.45; //0.66;\n    col = blendSoftLight(col, col + overlay, overlayOpacity * 0.3 * biome.b * (1.0 - darken * dataColor.r));\n    col = mix(col, col * (1.0 - overlay), 0.075 * (biome.b));\n    //blendSoftLight(col, col + overlay, overlayOpacity * biome.b * (1.0 - darken * dataColor.r));\n    col = blendSoftLight(col, tex, 1.0 - darken * dataColor.r);\n    // col = blendSoftLight(col, col + overlay, overlayOpacity * biome.b * 0.075);\n    // col = blendSoftLight(col, tex, 1.0);\n  // }\n\n  // col = vec3(gl_FragCoord.x / 800.0);\n  // vec2 shadowUv = (vShadowClipPos.xy / vShadowClipPos.z) * 0.5 + 0.5;\n  // col *= 1.0 - 0.25 * texture2D(shadowMap, shadowUv).r;\n  \n  // col = texture2D(mapGround, vShadowUv).rgb;\n  // float pt = 0.4;\n  // float pf = 0.4;\n  // float pathEdge = smoothstep(pt-pf, pt+pf, biome.b  );\n  // col = mix(col * 0.75, col * 1.0, pathEdge);\n  // col = vec3(pathEdge);\n  gl_FragColor = vec4(vec3(col), 1.0);\n  gl_FragColor = clamp(gl_FragColor, 0.0, 1.0);\n  gl_FragColor.rgb = mix(clearColor, gl_FragColor.rgb, edge0 * edge1);\n  // gl_FragColor.rgb = vec3(edge0);\n\n  // gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(1.0), lake);\n}";
},{}],113:[function(require,module,exports) {
var process = require("process");
var e=require("process");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=oe;var a=require("../tags"),r=J(a),t=require("three"),o=J(t),n=require("../util/helpers"),i=J(n),l=require("d3-polygon"),s=require("fast-2d-poisson-disk-sampling"),u=K(s),d=require("../util/Random"),m=K(d),c=require("../util/mst"),v=require("euclidean-distance/squared"),f=K(v),p=require("d3-delaunay"),g=require("simplex-noise"),h=K(g),w=require("simplify-path"),T=K(w),y=require("point-in-polygon"),M=K(y),S=require("../util/query-string"),E=K(S),q=require("../util/ShaderManager"),C=J(q),O=require("../util/RefGLTFLoader"),b=require("d3-quadtree"),D=require("bound-points"),x=K(D),A=require("earcut"),G=K(A),P=require("../util/load"),R=require("../config"),B=K(R),j=require("./environment/createEnvironmentEntity"),k=K(j),L=require("../shaders/ground-simple.vert"),W=K(L),F=require("../shaders/ground-simple.frag"),U=K(F),V=require("../util/three-util"),I=require("../util/Assets"),N=K(I),_=require("../util/materials"),X=require("../util/resetPlayerPos"),Y=K(X),z=require("./AnimationSystem"),H=require("../nfb");function K(e){return e&&e.__esModule?e:{default:e}}function J(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=e[r]);return a.default=e,a}const Q="image/data/water-distort",Z="image/data/water-noise",$="image/opaque/ice",ee="image/opaque/floor-overlay",ae="image/opaque/floor-path",re="image/opaque/floor",te="image/opaque/floor-tundra";function oe(e){const a=e.findTag(r.Renderer),t=new o.Texture,n=new o.Texture,i={wrapS:o.RepeatWrapping,wrapT:o.RepeatWrapping},[l,s,u]=[re,ee,ae].map(e=>{const[r]=N.default.createGPUTextureTask(a,e,{wrapS:o.RepeatWrapping,wrapT:o.RepeatWrapping});return r});let d=!1;const m=e.listen([r.EndGameState,r.ResetToCameraDrift]),c=new o.PlaneBufferGeometry(1,1,1,1);c.rotateX(-Math.PI/2);const v=512,f=512,p=[[-v/2,-f/2],[v/2,f/2]],g=new o.Matrix3,h=1024/60*1,w=1/(v/f)*(1024/60)*-1;g.setUvTransform(0,0,1,1,o.MathUtils.degToRad(-45),0,0);const T=(0,B.default)().haikusPerBiome,y={forest:{grassInstanceCount:700,grassScale:.6,grassTipFactor:1.5,colors:[{name:"forest-items-triangle",color:"#9D9166"},{name:"forest-items-dry",color:"#59622a"},{name:"forest-items-autumn",color:"#745C13"},{name:"forest-items-triangle",color:"#766D43"}],waterId:"forest-items-water",haikusTotal:T,waterColors:[],seed:[18632,45808,21972,11421],hasLakes:!1},grasslands:{grassInstanceCount:1e3,grassScale:1,grassTipFactor:1.5,hasLakes:!0,haikusTotal:T,seed:[23005,20871,29486,37533],colors:[{name:"grasslands-items-field",color:"#556325"},{name:"grasslands-items-yellow",color:"#8D7721"},{name:"grasslands-items-field",color:"#486b25"},{name:"grasslands-items-wet",color:"#605e41"}],waterId:"grasslands-items-water",waterColors:[{name:"lake",color:"#072d17"}]},tundra:{grassInstanceCount:500,grassScale:.6,grassTipFactor:.5,hasLakes:!0,hasIce:!0,haikusTotal:T,seed:[13005,27871,29486,37533],overlayOpacity:0,colors:[{name:"tundra-items-basic",color:"#797f84"}],waterId:"tundra-items-ice",waterColors:[{name:"lake",color:"#072d17"}]}},M=new o.Mesh(c,new o.MeshBasicMaterial({colorWrite:!1}));M.layers.set(e.findTag(r.RenderLayers).groundDepth),M.scale.set(v,1,f),M.position.y=0,M.name="env-depth-mesh",e.entity().add(r.Object3D,M);const S=function(){const a=e.findTag(r.GroundDataRenderTarget),t=C.create({depthWrite:!1,depthTest:!1,name:"GroundShader",uniforms:{solved:{value:0},uvRepeatScale:{value:1},clearColor:{value:new o.Color("#130904")},uvScale:{value:new o.Vector2(h,w)},uvTransform:{value:g},environmentSize:{value:new o.Vector2(v,f)},worldDataMap:{value:a?a.target.texture:(0,_.getEmptyTexture)()},worldDataProjection:{value:a?a.projection:new o.Matrix4},worldDataView:{value:a?a.view:new o.Matrix4},dataMapBiome:{value:(0,_.getEmptyTexture)()},dataMapColor:{value:(0,_.getEmptyTexture)()},dataMapLake:{value:(0,_.getEmptyTexture)()},overrideColor:{value:new o.Color("red")},originColor:{value:new o.Color("#969492")},useOverrideColor:{value:!0,type:"b"},useOverrideMap:{value:!0,type:"b"},overrideMap:{value:(0,_.getEmptyTexture)()},time:{value:0},tutorial:{value:0},outro:{value:0},mapOverlay:{value:s},mapGroundPath:{value:u},mapGround:{value:l},overlayOpacity:{value:.3}},defines:{HAS_DATA_MAP:!0},fragmentShader:U.default,vertexShader:W.default}),n=new o.Mesh(c,t);return n.scale.set(v,1,f),n.layers.set(e.findTag(r.RenderLayers).ground),n.name="ground-quad",e.entity().add(r.Object3D,n).add(r.ShaderUniformTime,{uniform:n.material.uniforms.time}).add(r.GroundMeshEditableData).add(r.GroundPlaneLayer,n)}(),q=(0,B.default)(),O=!1,b=e.listen(r.TutorialBarrenGround),D={value:0,lastValue:0,colorA:S.get(r.Object3D).material.uniforms.originColor.value.clone(),colorB:new o.Color("#59622a")},x=e.listen(r.FinalBiomeResolution),A=e.view([r.GroundAsset,r.GroundAssetData]),G=e.view(r.EnvironmentCell),P=(e.view([r.GroundAsset,r.GroundAssetData]),e.view(r.GLTFRefAsset)),R=e.view(r.EnvironmentState),j=e.view([r.EnvironmentState,r.ActiveEnvironmentState]),L=["forest","grasslands","tundra"],F={};let I=null,K="forest";"grasslands"===E.default.biome?K="grasslands":"tundra"===E.default.biome&&(K="tundra");let J=null;setTimeout(()=>{let e;window.swapEnv=(()=>{(e=e||function(){const e=J,a=ue("grasslands");let t=e;return e.name="forest",a.name="grasslands",()=>{const o=t===e?a:e;t.remove(r.ActiveEnvironmentState),o.add(r.ActiveEnvironmentState),t=o}}())()})},0);const oe=e.view(r.SafeToSwapBiomes),ne=(e.view(r.ShadowCaster),e.listen(r.TransitionToNextBiome)),ie=e.view([r.TransitionToNextBiome,r.CameraStopUserMovement]);se();let le=null;return{process:function(a){ne.added.forEach(e=>{e.add(r.CameraStopUserMovement)}),m.added.length>0&&e.entity().add(r.TransitionToNextBiome).add(r.SafeToSwapBiomes);if(oe.length>0){ie.forEach(e=>{e.remove(r.CameraStopUserMovement)}),oe.forEach(e=>{e.remove(r.SafeToSwapBiomes)}),(0,Y.default)(e),le=null;const a=j.length?j[0]:null,t=a?a.get(r.EnvironmentState).name:"forest",o=L.indexOf(t);if(o>=0){let a=o+1;if(a>=L.length&&(a=1),a<L.length){const t=L[a];G.forEach(e=>e.kill()),A.forEach(e=>e.kill()),R.forEach(e=>e.kill());const o=ue(t);o.add(r.ActiveEnvironmentState),e.query(r.TransitionToNextBiome).entities.forEach(e=>{e.remove(r.TransitionToNextBiome)}),F[t]||(F[t]=!0,(0,H.sendAnalytics)({event:"biome_visited",eventLabel:t}))}else console.log("VIEW LAYER END STATE")}}const t=S.get(r.Object3D),o=S.get(r.GroundMeshEditableData);t.material.uniforms.uvRepeatScale.value=o.uvRepeatScale,t.material.uniforms.useOverrideColor.value=o.useOverrideColor,t.material.uniforms.useOverrideMap.value=o.useOverrideMap,t.material.uniforms.overrideMap.value=o.overrideMap,le!==o.overrideColor&&(t.material.uniforms.overrideColor.value.set(o.overrideColor),le=o.overrideColor);let i=null;if(j.length>0){const e=j[0],a=e.get(r.EnvironmentState);i=e,t.material.uniforms.solved.value=O||q.embed?1:a.solved,t.material.uniforms.dataMapBiome.value=a.textures[0],t.material.uniforms.dataMapColor.value=a.textures[1],t.material.uniforms.dataMapLake.value=a.textures[2],t.material.uniforms.overlayOpacity.value=a.overlayOpacity;for(let e=0;e<a.waterMeshes.length;e++){const r=a.waterMeshes[e];r.material.uniforms.waterNoiseMap.value=o.useOverrideWater?o.overrideWater:n,r.material.uniforms.colorA.value.set(o.useOverrideWaterColor?o.overrideWaterColorA:r.userData.colorA),r.material.uniforms.colorB.value.set(o.useOverrideWaterColor?o.overrideWaterColorB:r.userData.colorB)}}if(i!==I){if(I&&I.has(r.Object3D)){const e=I.get(r.Object3D);(0,V.detachObject)(e),console.log("Killing previous environment"),I.remove(r.Object3D)}if(I=i,i){const a=i.get(r.EnvironmentState),t=a.group;i.add(r.Object3D,t),P.forEach(e=>{const t=e.get(r.GLTFRefAsset);t.biome!==a.name&&e.kill()}),a.patches.forEach(t=>{e.entity().add(r.GLTFRefAsset,{position:t.position,name:t.name,biome:a.name})})}}if(x.changed){const a=S.get(r.Object3D).material.uniforms,t=a.tutorial;x.added.length>0?(D.colorA.copy(a.originColor.value),(0,z.tweenFromTo)(e,D,"value",0,1,8,"sineOut"),(0,z.tweenFromTo)(e,t,"value",t.value,1,8,"sineOut")):x.removing.length>0&&(D.value=0,t.value=0)}if(D.value!==D.lastValue){D.lastValue=D.value;const e=S.get(r.Object3D).material.uniforms;e.originColor.value.copy(D.colorA).lerp(D.colorB,D.value)}if(b.changed)if(b.added.length>0)S.has(r.Object3D)&&(S.get(r.Object3D).material.uniforms.tutorial.value=1);else if(b.removing.length>0&&S.has(r.Object3D)){const a=S.get(r.Object3D).material.uniforms.tutorial;(0,z.tweenFromTo)(e,a,"value",a.value,0,2,"sineOut")}},createInitialEnvironment:se};function se(){if(!J)if((J=ue(K)).add(r.ActiveEnvironmentState),E.default.testwater){const a=J.get(r.EnvironmentState).lakes;if(a&&a.length){const r=a[Math.floor(Math.random()*a.length)].polygon,t=r[Math.floor(Math.random()*r.length)];(0,X.setPlayerPos)(e,new o.Vector3(t[0],0,t[1]))}}else if(E.default.testfox){const a=J.get(r.EnvironmentState).patches.find(e=>e.name.includes("patch-17"));a&&(0,X.setPlayerPos)(e,new o.Vector3(a.position[0],0,a.position[1]))}}function ue(r){return"grasslands"!==r&&"tundra"!==r||d||(d=!0,N.default.loadGPUTexture(a,t,Q,i)),"grasslands"===r?N.default.loadGPUTexture(a,n,Z,i):"tundra"===r&&(console.log("CREATE ENV"),N.default.loadGPUTexture(a,n,$,i),N.default.loadGPUTexture(a,l,te,i)),(0,k.default)(e,{biome:r,biomeData:y,width:v,height:f,bounds:p,renderer:a,uvMat:g,waterVertexShader:W.default,repeatX:h,repeatY:w,mapGround:l,mapOverlay:s,mapGroundPath:u,waterDistortMap:t,waterNoiseMap:n})}}N.default.prepare([re,ae,ee]);
},{"../tags":60,"three":74,"../util/helpers":250,"d3-polygon":295,"fast-2d-poisson-disk-sampling":289,"../util/Random":235,"../util/mst":282,"euclidean-distance/squared":307,"d3-delaunay":296,"simplex-noise":294,"simplify-path":297,"point-in-polygon":298,"../util/query-string":30,"../util/ShaderManager":243,"../util/RefGLTFLoader":252,"d3-quadtree":299,"bound-points":300,"earcut":301,"../util/load":247,"../config":28,"./environment/createEnvironmentEntity":287,"../shaders/ground-simple.vert":283,"../shaders/ground-simple.frag":284,"../util/three-util":80,"../util/Assets":31,"../util/materials":82,"../util/resetPlayerPos":132,"./AnimationSystem":108,"../nfb":75,"process":271}],114:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=f;var e=require("../tags"),t=m(e),n=require("three"),i=m(n),r=require("../util/Random"),a=d(r),l=require("../util/ObjectPool"),o=d(l),c=require("../util/three-util"),s=require("./environment/EnvironmentGrid"),u=require("../util/water-util");function d(e){return e&&e.__esModule?e:{default:e}}function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function f(e){const r=e.view([t.ActiveEnvironmentState,t.EnvironmentState]),l=new Uint16Array(4),c=new o.default({initialCapacity:12,create:()=>(0,a.default)(l)}),d=[0,0],m=new i.Box3,f=new i.Raycaster,v=new i.Plane(new i.Vector3(-0,-1,-0),-0),y=new i.Vector2,p=new i.Vector3,w=new i.Vector3,g=[[-1,1],[1,1],[1,-1],[-1,-1]],h=e.view(t.EnvironmentCell),x=e.tag(t.EnvironmentUnderPlayerState),C=new s.GridBounds;return function(i){const a=e.findTag(t.UserTarget).position,l=e.findTag(t.MainCamera);l.updateProjectionMatrix();m.makeEmpty();for(let e=0;e<g.length;e++){const t=g[e];if(y.fromArray(t),f.setFromCamera(y,l),!f.ray.intersectPlane(v,p))return;const n=w.copy(p).sub(a),i=n.length();0!==i&&n.divideScalar(i),i>80&&p.copy(a).addScaledVector(w,80),m.expandByPoint(p)}if(m.min.y=0,m.max.y=12,x.water=!1,x.lake=null,r.length>0){!function(i){const r=i.grid;r.box3ToBounds(m,C);C.minX=n.MathUtils.clamp(C.minX-0,0,r.cellDivisions-1),C.minY=n.MathUtils.clamp(C.minY-0,0,r.cellDivisions-1),C.maxX=n.MathUtils.clamp(C.maxX+0,0,r.cellDivisions-1),C.maxY=n.MathUtils.clamp(C.maxY+0+1,0,r.cellDivisions-1),h.forEach(e=>{const n=e.get(t.EnvironmentCell);n.environmentState===i&&r.isCellInBounds(n.cell,C)||(c.release(n.random),n.cell.entity=null,n.environmentState=null,n.cell=null,e.kill())});r.forEachCellInBounds(C,n=>{if(0,!n.entity){n.entity=e.entity().add(t.EnvironmentCell);const r=n.entity.get(t.EnvironmentCell);r.cell=n,r.environmentState=i,r.random=c.next(),r.random.seed(n.seed)}});const a=e.findTag(t.UserCharacter).position;d[0]=a.x,d[1]=a.z;const l=!e.findTag(t.HideCharacter)&&!e.findTag(t.AnimateOutCharacter);if(!x.water&&l){const e=(0,u.getLakeObject)(i,d);x.water=Boolean(e),x.lake=e}}(r[0].get(t.EnvironmentState))}}}
},{"../tags":60,"three":74,"../util/Random":235,"../util/ObjectPool":236,"../util/three-util":80,"./environment/EnvironmentGrid":274,"../util/water-util":249}],285:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e},i=require("../../tags"),a=f(i),t=require("three"),r=f(t),s=require("../../util/ObjectPool"),n=g(s),o=require("../../util/SpriteManager"),d=g(o),l=require("../../util/three-util"),c=require("../../util/load"),u=require("../../util/math"),h=f(u),p=require("../AnimationSystem"),m=require("../../util/materials");function g(e){return e&&e.__esModule?e:{default:e}}function f(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(i[a]=e[a]);return i.default=e,i}const S=20,w={height:15},z={tree_naked2:e({},w,{ignoreFlip:!0,shadow:!0,shadowScale:.7,shadowOffsetX:-.35,shadowOffsetY:.05,varianceStd:.5,useMapDiscard:!0}),"forest-twig1":{minSize:.5,maxSize:.75},"forest-twig2":{minSize:.5,maxSize:.75},"forest-twig3":{minSize:.5,maxSize:.75},tree1:e({},w,{ignoreFlip:!0,minSize:8,useMapDiscard:!0}),tree2:e({},w,{ignoreFlip:!0,useMapDiscard:!0}),"origin-tree":{ignoreFlip:!0,height:10,useMapDiscard:!0},tree3:e({},w,{ignoreFlip:!0,useMapDiscard:!0}),tree5:e({},w,{ignoreFlip:!0,varianceStd:.25,useMapDiscard:!0}),acorns1:{height:.5},fallen_wood1:{height:.5},fallen_wood2:{height:.5},tree_naked1:e({},w,{ignoreFlip:!0,shadow:!0,shadowScale:.7,shadowOffsetX:-.3,shadowOffsetY:-.6,varianceStd:.5}),tree_naked3:e({},w,{ignoreFlip:!0,height:7,shadow:!0,shadowScale:.5,shadowOffsetX:-.2,varianceStd:.5,useMapDiscard:!0}),smalltree1:{useMapDiscard:!1,minSize:3},tree_naked2:e({},w,{ignoreFlip:!0,shadow:!0,shadowScale:.6,shadowOffsetX:-.35,shadowOffsetY:.1,varianceStd:.5,useMapDiscard:!0}),decayed_stump1:{ignoreFlip:!0,height:1.5,minSize:1.5,maxSize:2.25,varianceStd:.25,shadow:!0,shadowScale:1,shadowOffsetX:-.25,shadowOffsetY:-.5,useMapDiscard:!0},decayed_twig1:{minSize:1,height:1.25,maxSize:1.5,useMapDiscard:!1},decayed_twig2:{minSize:1,height:1.25,maxSize:1.5,useMapDiscard:!1},decayed_twig3:{minSize:1,height:1.25,maxSize:1.5,useMapDiscard:!1},decayed_twig4:{minSize:1,height:1.25,maxSize:1.5,useMapDiscard:!1},"oat-shadow1":{minSize:1,height:1.5,maxSize:2,useMapDiscard:!1,ignoreFlip:!0},"small-rock1":{minSize:.35,height:.5,maxSize:.65,useMapDiscard:!1,ignoreFlip:!0},"small-rock2":{minSize:.35,height:.5,maxSize:.65,useMapDiscard:!1,ignoreFlip:!0},"wetland-plant1":{minSize:1,height:1.25,maxSize:1.5,useMapDiscard:!1},"wetland-plant2":{minSize:1,height:1.25,maxSize:1.5,useMapDiscard:!1},"wetland-grass1":{minSize:1,height:1.25,maxSize:1.5,useMapDiscard:!1}},D=e({},w,{ignoreFlip:!0,minSize:8,useMapDiscard:!0}),M={minSize:1.5,height:1.5,maxSize:2.25,useMapDiscard:!1};exports.default=async function(e){e.findTag(a.Renderer),e.findTag(a.GroundDataRenderTarget),e.findTag(a.GroundPlaneView),(0,m.getEmptyTexture)(),(0,m.getSpriteGeometry)();return{next:function(e){if(!e.has(a.GroundAssetData))return;const i=e.get(a.GroundAsset),t=i.cellEntity.get(a.EnvironmentCell),s=e.get(a.GroundAssetData),n=(t.random,s.instance);if(!n)return;n.position.set(i.x,0,i.z);const o=n.isMesh&&"WayfinderSprite"===n.userData.type;let d=h.clamp(Math.abs(s.variance),.95,1.05);if(n.scale.multiplyScalar(d),s.scale.copy(n.scale),o){const e=s.flip&&!s.ignoreFlip;n.material.uniforms.flip.value=e?-1:1,n.material.side=e?r.BackSide:r.FrontSide;let i=!1;"boolean"==typeof s.useMapDiscard&&(i=s.useMapDiscard),n.material.uniforms.useMapDiscard.value=i;const t=n.scale.x/n.scale.y;n.material.uniforms.aspect.value=t,n.material.uniforms.spriteHeight.value=n.scale.y;const o=n.userData._entity;if(o){o.has(a.ShaderUniformTime)||o.add(a.ShaderUniformTime);const e=o.get(a.ShaderUniformTime);e.uniform=n.material.uniforms.time}}else n.rotation.y=s.rotation},release(e){const i=e.get(a.GroundAssetData);i.instance&&i.instance.userData._pool&&i.instance.userData._pool.release(i.instance),(0,l.detachObject)(i.instance),i.instance=null},update(e){e.has(a.Object3D)}}};
},{"../../tags":60,"three":74,"../../util/ObjectPool":236,"../../util/SpriteManager":248,"../../util/three-util":80,"../../util/load":247,"../../util/math":240,"../AnimationSystem":108,"../../util/materials":82}],115:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../tags"),t=p(e),n=require("three"),s=p(n),o=require("./environment/AssetSprites"),r=m(o),a=require("./environment/asset-types"),i=require("../util/three-util"),l=require("./AnimationSystem"),d=require("../util/math"),c=p(d),u=require("../util/Random"),g=m(u);function m(e){return e&&e.__esModule?e:{default:e}}function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}const h=new s.Box3,f=new s.Vector3;function G(e,t){t.getWorldScale(f);const n=f.y;e.max.y+=.4*n,e.min.x-=2,e.max.x+=0}function y(e,t){}exports.default=async function(e){const n=await(0,r.default)(e);const o=new s.Group;o.name="assets",e.entity().add(t.Object3D,o);e.view(t.EnvironmentCell);const d=e.listen(t.EnvironmentCell),u=e.findTag(t.MainCameraFrustum),m=e.listen([t.GroundAsset,t.GroundAssetData]),p=e.view([t.GroundAsset,t.GroundAssetData]),h=e.view([t.GroundAsset,t.GroundAssetData,t.Object3D]),f=(Boolean(void 0),new s.Vector2),y=new s.Box3,A=e.findTag(t.GLTFSpawnItemsMap),v=(0,g.default)(),D=e.listen(t.TutorialBarrenGround),F=e.listen(t.FinalBiomeResolution),w=e.view(t.TutorialBarrenGround),S=e.listen(t.ActiveEnvironmentState);let x=0;return function(s){S.changed,x+=s;for(let n=0;n<d.added.length;n++){const s=d.added[n],r=s.get(t.EnvironmentCell),i=r.cell,l=r.random,c=r.environmentState.colors[i.colorIndex%r.environmentState.colors.length],u=c?c.name:null;r.children.length=0;for(let n=0;n<i.samples.length;n++){const d=i.samples[n],c=e.entity().add(t.GroundAsset),g=c.get(t.GroundAsset),m=r.environmentState.samples[d];g.x=m[0],g.z=m[1],g.cellEntity=s;const p=(0,a.addSampleData)(o,A,c,u,l);p&&c.add(t.Object3D,p),r.children.push(c)}for(let n=0;n<i.waterSamples.length;n++){const d=i.waterSamples[n],c=e.entity().add(t.GroundAsset),u=c.get(t.GroundAsset),g=r.environmentState.waterSamples[d];if(u.x=g[0],u.z=g[1],u.cellEntity=s,l.chance(.5)){const e=(0,a.addSampleData)(o,A,c,r.environmentState.waterId,l);e&&c.add(t.Object3D,e)}else c.add(t.WaterFishPlaceholderTag);r.children.push(c)}for(let n=0;n<i.tokens.length;n++){const o=i.tokens[n],a=e.entity().add(t.GroundAsset).add(t.GroundAssetData).add(t.GroundAssetToken);a.get(t.GroundAssetData).type="token";const l=r.environmentState.tokens[o];a.get(t.GroundAssetToken).type=l.type;const d=a.get(t.GroundAsset);d.x=l.position[0],d.z=l.position[1],d.cellEntity=s,r.children.push(a)}}for(let e=0;e<m.added.length;e++){const s=m.added[e],o=s.get(t.GroundAsset),r=s.get(t.GroundAssetData);o.cellEntity.get(t.EnvironmentCell);w.length>0&&(r.sizeFactor=0),"sprite"===r.type&&n.next(s)}for(let e=0;e<h.length;e++){const n=h[e],s=(n.get(t.GroundAsset),n.get(t.GroundAssetData));if("patch"!==s.type){const e=n.get(t.Object3D);y.setFromObject(e),"sprite"===s.type&&G(y,e);const o=u.intersectsBox(y),r=n.has(t.GroundAssetInsideFrustum);r!==o&&(o&&!r?n.add(t.GroundAssetInsideFrustum):!o&&r&&n.remove(t.GroundAssetInsideFrustum))}}F.changed&&(F.added.length>0?p.forEach(n=>{const s=n.get(t.GroundAssetData);if("token"!==s.type&&"patch"!==s.type&&s.sizeFactor>0){const o=n.get(t.GroundAsset),r=1*c.clamp01(f.set(o.x,o.z).length()/50)+v.range(0,.5);(0,l.tweenFromTo)(e,s,"sizeFactor",s.sizeFactor,0,1,"sineOut",r)}}):F.removing.length>0&&p.forEach(e=>{const n=e.get(t.GroundAssetData);"token"!==n.type&&"patch"!==n.type&&n.sizeFactor>0&&(n.sizeFactor=1)})),D.changed&&(D.added.length>0?p.forEach(e=>{e.get(t.GroundAssetData).sizeFactor=0}):D.removing.length>0&&p.forEach(n=>{const s=n.get(t.GroundAssetData);if("token"!==s.type&&"patch"!==s.type&&s.sizeFactor<=0){const o=n.get(t.GroundAsset),r=1*c.clamp01(f.set(o.x,o.z).length()/50)+v.range(0,.5);(0,l.tweenFromTo)(e,s,"sizeFactor",0,1,1,"sineOut",r)}}));for(let e=0;e<p.length;e++){const s=p[e],o=s.get(t.GroundAssetData);if("sprite"===o.type&&n.update(s),"token"!==o.type&&"patch"!==o.type){const e=o.sizeFactor,t=o.instance;t&&t.material&&t.material.uniforms.spin&&(t.material.uniforms.spin.value=1-e),t.scale.copy(o.scale).multiplyScalar(e)}if("patch"!==o.type&&s.has(t.Object3D)){s.get(t.Object3D).visible=s.has(t.GroundAssetInsideFrustum)}}for(let e=0;e<m.removing.length;e++){const s=m.removing[e];"sprite"===s.get(t.GroundAssetData).type&&n.release(s)}for(let e=0;e<d.removing.length;e++){const n=d.removing[e].get(t.EnvironmentCell);n.children.forEach(e=>{if(e.alive){if(e.has(t.Object3D)){const n=e.get(t.Object3D);(0,i.detachObject)(n)}e.kill()}}),n.children.length=0}}};
},{"../tags":60,"three":74,"./environment/AssetSprites":285,"./environment/asset-types":286,"../util/three-util":80,"./AnimationSystem":108,"../util/math":240,"../util/Random":235}],116:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=s;var e=require("../tags"),r=c(e),a=require("three"),o=c(a),n=require("../util/materials"),t=require("../util/three-util"),i=require("../util/ShaderManager"),l=c(i);function c(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(r[a]=e[a]);return r.default=e,r}function s(e){e.view([r.Object3D,r.ShadowCaster]);const a=e.listen([r.Object3D,r.ShadowCaster]),n=e.findTag(r.RenderLayers),i=(new o.Vector3(0,0,0),new o.Vector3(0,0,0),new o.PerspectiveCamera),c=new o.Matrix4,s=new o.Matrix4,d=l.create({name:"ShadowSilhouetteMesh",vertexShader:"\n      #include <common>\n      uniform mat4 projection;\n      uniform mat4 view;\n      varying vec3 vCenterPos;\n      varying vec3 vRealWorldPos;\n\n      void main () {\n        vec4 realWorldPos = modelMatrix * vec4(position.xyz, 1.0);\n        vRealWorldPos = realWorldPos.xyz;\n        vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n        vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n        vec3 camBack = cross(camUpWorld, camRightWorld);\n        float xSkew = -60.0 * (PI/180.0);\n        float ySkew = 0.0;\n\n        // Create a transform that will skew our texture coords\n        mat3 trans = mat3(\n          1.0       , tan(xSkew), 0.0,\n          tan(ySkew), 1.0,        0.0,\n          0.0       , 0.0,        1.0\n        );\n        \n        vec4 worldSpace = modelMatrix * vec4(position.xyz, 1.0);\n        worldSpace.y *= 0.25;\n        // worldSpace.xyz *= trans;\n        worldSpace.xyz += realWorldPos.y * camRightWorld * -0.5;\n\n        worldSpace.z += -0.25;\n        worldSpace.x += -0.1;\n        vec4 camSpace = view * worldSpace;\n\n        vCenterPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n\n        gl_Position = projectionMatrix * viewMatrix * worldSpace;\n        // gl_Position.y += 0.4;\n        // gl_Position.x -= 0.4;\n      }\n    ",fragmentShader:"\n      uniform float opacity;\n      uniform vec3 color;\n      varying vec3 vCenterPos;\n      varying vec3 vRealWorldPos;\n      void main () {\n        gl_FragColor = vec4(color, 1.0);\n\n        // float falloff = 1.0 - clamp(pow(distance(vRealWorldPos, vCenterPos) / 1.0, 0.5), 0.0, 1.0);\n        float falloff = 1.0 - clamp(pow(vRealWorldPos.y / 2.0, 1.0), 0.0, 1.0);\n        float shadowOpacity = 0.25;\n        gl_FragColor.rgb = mix(vec3(1.0), gl_FragColor.rgb, shadowOpacity * falloff);\n      }\n    ",transparent:!0,depthWrite:!1,side:o.DoubleSide,blending:o.MultiplyBlending,uniforms:{color:{value:new o.Color("#280422")},projection:{value:c},view:{value:s}}});(new o.Vector3).set(1,1,.25).normalize();return function(o){a.added.forEach(e=>{const a=e.get(r.ShadowCaster).sprite;e.get(r.Object3D).traverse(e=>{e.layers&&e.layers.enable(n.shadow),e.isMesh&&(e.userData.__shadowEnabled=!0,e.userData.__shadowMaterial=a?e.material:d)})});const l=e.findTag(r.MainCamera);(0,t.fastCopyCameraData)(l,i);e.findTag(r.UserFollow).currentTarget;i.updateProjectionMatrix(),i.updateMatrixWorld(),c.copy(i.projectionMatrix),s.copy(i.matrixWorldInverse)}}
},{"../tags":60,"three":74,"../util/materials":82,"../util/three-util":80,"../util/ShaderManager":243}],117:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../tags"),t=O(e),r=require("three"),o=O(r),n=require("../util/helpers"),u=O(n),s=require("deep-clone"),a=h(s),i=require("../util/three-util"),c=require("../util/EditorWayfinderSprite"),l=require("../util/RefGLTFLoader"),p=h(l),d=require("../util/Random"),f=h(d),g=require("../util/geometry"),m=require("../util/ObjectPool"),b=h(m);function h(e){return e&&e.__esModule?e:{default:e}}function O(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}exports.default=async function(e){const r=new o.Group;r.name="loadrefgroup",e.entity().add(t.Object3D,r);const n=await(0,p.default)(e),u=e.listen(t.GLTFRefAsset),s=e.listen(t.ActiveEnvironmentState),a=e.view(t.GLTFRefAsset),c=(e.findTag(t.MainCameraFrustum),new o.Box3,new o.Vector3,[0,0]),d=new o.Box3,f=new b.default({initialCapacity:50,create(){const e=new o.Group;return e.userData._pool=this,e},release(e){(0,i.clearGroup)(e)}});return function(r){if(!e.findTag(t.AppState).ready)return;const o=e.findTag(t.UserTarget).position;c[0]=o.x,c[1]=o.z,s.changed&&a.forEach(e=>{const r=e.get(t.GLTFRefAsset);m(e,r),a.forEach(e=>e.kill())}),u.removing.forEach(e=>{const r=e.get(t.GLTFRefAsset);if(e.has(t.Object3D)){const r=e.get(t.Object3D);(0,i.detachObject)(r),e.remove(t.Object3D)}r.group&&(r.group.parent&&console.warn("GLTF Ref still has parent"),h(r.group),r.group=null)}),a.forEach(e=>{const r=e.get(t.GLTFRefAsset),o=r.position,u=r.name,s=l.MetaData[u],a=o[0],p=o[1],b=s.boundingCircle.radius;let O=!1;if((0,g.circlesIntersect)(o,b,c,50)&&(O=!0),O!==e.has(t.IsInFrustum)&&(O?e.add(t.IsInFrustum):e.has(t.IsInFrustum)&&(e.remove(t.IsInFrustum),m(e,r)),e.has(t.IsInFrustum)&&(e.has(t.Object3D)||function(e,r,o,u,s){r.group&&(console.error("Group already exists"),h(r.group),(0,i.detachObject)(r.group));const a=f.next();r.group=a,a.name=o,r.promise=n.nextPooledByName(o,!0).then(e=>{if(!r.group)return console.log("Early release",e),h(e),null;const t=r.group;return t.position.x=u,t.position.z=s,t.add(e),d.setFromObject(t),r.boundsMin.copy(d.min),r.boundsMax.copy(d.max),r.boundsSet=!0,e});const c=r.group;e.add(t.Object3D,c)}(e,r,u,a,p)),e.has(t.Object3D))){e.get(t.Object3D).visible=O}})};function m(e,r){if(r.group&&h(r.group),e.has(t.Object3D)){const r=e.get(t.Object3D);(0,i.detachObject)(r),e.remove(t.Object3D)}r.promise&&r.promise.then(h),r.group=null,r.promise=null}function h(e){e&&e.userData._pool&&e.userData._pool.release(e)}};
},{"../tags":60,"three":74,"../util/helpers":250,"deep-clone":221,"../util/three-util":80,"../util/EditorWayfinderSprite":81,"../util/RefGLTFLoader":252,"../util/Random":235,"../util/geometry":251,"../util/ObjectPool":236}],118:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=i;var e=require("../tags"),r=o(e),t=require("svelte/store");function o(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function i(e){e.entity().add(r.ViewLayer,{id:"poem-collection"})}
},{"../tags":60,"svelte/store":310}],119:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=h;var e=require("../tags"),t=O(e),i=require("three"),n=O(i),o=require("../util/locale"),a=require("../util/haikugen"),r=T(a),d=require("./AnimationSystem"),s=require("../util/query-string"),l=T(s),c=require("../util/tokens"),g=require("../util/Random"),f=T(g),u=require("../util/resetPlayerPos"),m=T(u),v=require("../nfb");function T(e){return e&&e.__esModule?e:{default:e}}function O(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function h(e){const i=(0,f.default)();window.addPoem=((n,o)=>{const a=(0,r.default)();n||(n=i.shuffle(c.AllTokens).slice(0,3)),o=o||n.map((e,t)=>a.generateStanza({stanza:t,token:e})),console.log(o,n);e.entity().add(t.FinishedPoem,{lines:o.slice(),tokens:n.slice()});console.log(n),console.log(o.map(e=>e.en).join(" / "))}),window.addTestPoem=(()=>{window.addPoem(i.shuffle(c.AllTokens).slice(0,3))});const n=e.listen(t.FinishedPoem),a=(e.listen(t.HaikuInInventory),e.view(t.HaikuAddingToInventory)),s=e.view(t.HaikuInInventory),g=e.entity(),m=e.listen(t.HaikuCardSaved);let T;const O=e.view(t.ActiveEnvironmentState),h=e.listen(t.ActiveEnvironmentState),p=e.view([t.SpriteAnimation,t.SpriteAnimationOriginTreeTag]);let y=!1,A=!1,E=0,C=0,S=!1;e.view(t.EndGameState);let M=!1;const k=e.view(t.TextHint);setTimeout(()=>{const e=l.default.poems;if("number"==typeof e)for(let t=0;t<e;t++)window.addTestPoem()},0);const w=e.listen(t.ResetToCameraDrift),F=e.view(t.AutoRemoveCapeMagicalEffect);return function(i){const r=O[0],c=r?r.get(t.EnvironmentState):null,f=c?c.name:null;if(w.changed&&w.added.length>0){g.remove(t.FinalBiomeResolution);const i=e.findEntity(t.ActiveEnvironmentState);if(i){const n=i.get(t.EnvironmentState);(0,u.setPlayerPos)(e,n.idleViewPoint)}g.tagOff(t.DirectUserToOrigin),g.tagOff(t.CapeMagicalEffect),g.tagOff(t.AutoRemoveCapeMagicalEffect),g.tagOff(t.WaitingForBiomeResolution),g.tagOff(t.ShowBiomeResolution),g.tagOff(t.CameraFocusOnTarget),g.tagOff(t.MoveUserToOrigin);const n=e.entity();n.tagOn(t.GameLandingCameraDrift),n.tagOn(t.CameraZoomOut),n.tagOn(t.BlockTokenCollection),n.tagOn(t.HideCharacter),n.tagOn(t.HideHUD),n.tagOn(t.BlockUserMove),n.tagOn(t.CameraStopUserMovement),n.tagOn(t.ModalStoppingUserMovement);const o=e.entity().add(t.ScreenFade).get(t.ScreenFade);o.from=1,o.to=0}h.changed&&(g.remove(t.DirectUserToOrigin),g.tagOff(t.CapeMagicalEffect),g.tagOff(t.AutoRemoveCapeMagicalEffect),g.remove(t.WaitingForBiomeResolution),g.remove(t.ShowBiomeResolution),g.remove(t.CameraFocusOnTarget),g.remove(t.MoveUserToOrigin),g.remove(t.TriggerTreeTransitionAudio),s.forEach(e=>{e.remove(t.HaikuInInventory)}),p.forEach(e=>{e.get(t.SpriteAnimation).reset()}),T=f,k.forEach(e=>e.kill()));const R=c?c.haikusTotal:2,I=s.length;if(n.changed){const e=Math.max(0,R-I);for(let i=0;i<e&&i<n.added.length;i++)n.added[i].add(t.HaikuAddingToInventory)}a.forEach(e=>{const n=e.get(t.HaikuAddingToInventory);n.time+=i,n.time>=n.delay&&(e.remove(t.HaikuAddingToInventory),e.add(t.HaikuInInventory))}),s.length>=R&&(g.has(t.DirectUserToOrigin)||(g.add(t.DirectUserToOrigin),F.forEach(e=>{e.get(t.AutoRemoveCapeMagicalEffect).elapsed=0,e.remove(t.AutoRemoveCapeMagicalEffect)}),g.add(t.CapeMagicalEffect),g.add(t.WaitingForBiomeResolution)));const U=!e.findTag(t.IsGameUIActive);if(Boolean(e.findTag(t.DirectUserToOrigin))&&U&&m.added.length&&m.changed&&!M&&(l.default.resolve||(M=!0,e.entity().add(t.TutorialMessage,{id:"resolve",message:o.localize.get().tutorialResolve,iconMode:"tree",delay:0,duration:6}))),c&&g.has(t.DirectUserToOrigin)&&U&&g.has(t.WaitingForBiomeResolution)){const i=20,n=i*i;if(e.findTag(t.UserCharacter).position.lengthSq()<n){(0,d.tweenFromTo)(e,c,"solved",0,1,4,"sineInOut",0),g.remove(t.WaitingForBiomeResolution),g.add(t.CameraFocusOnTarget),g.add(t.MoveUserToOrigin),g.add(t.ShowBiomeResolution),g.tagOff(t.CapeMagicalEffect),g.tagOff(t.AutoRemoveCapeMagicalEffect),"tundra"===f&&(S=!0,g.add(t.FinalBiomeResolution)),g.get(t.CameraFocusOnTarget).target.set(0,4,0),A=!0,y=!0,E=0,C=0}}if(y){(E+=i)>=("tundra"===f?17:4)&&(y=!1,p.forEach(e=>{e.get(t.SpriteAnimation).start()}),g.add(t.TriggerTreeTransitionAudio))}if(A){if(C+=i,S&&C>=3&&(S=!1,g.add(t.AnimateOutCharacter)),C>=("tundra"===f?23:10))if(A=!1,s.forEach(e=>{e.remove(t.HaikuInInventory)}),"tundra"===f){const i=e.entity();i.add(t.EndGameState);const n=e.entity().add(t.ScreenFade).get(t.ScreenFade);n.from=0,n.to=1,n.callbackOnFinish=(()=>{i.add(t.ResetToCameraDrift),i.add(t.OutroFinished)}),(0,v.sendAnalytics)({event:"completed",eventLabel:"end"})}else g.add(t.TransitionToNextBiome)}}}
},{"../tags":60,"three":74,"../util/locale":227,"../util/haikugen":276,"./AnimationSystem":108,"../util/query-string":30,"../util/tokens":138,"../util/Random":235,"../util/resetPlayerPos":132,"../nfb":75}],120:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=S;var e=require("../tags"),t=m(e),i=require("three"),a=m(i),r=require("../util/materials"),n=require("../util/EditorWayfinderSprite"),s=require("../util/load"),u=require("./AnimationSystem"),o=require("../util/Random"),d=f(o),l=require("../util/Assets"),c=f(l);function f(e){return e&&e.__esModule?e:{default:e}}function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function S(e){const i=(0,d.default)(),a=["GRASSLAND-FLOWER-1","GRASSLAND-FLOWER-2","GRASSLAND-FLOWER-white-1","GRASSLAND-FLOWER-white-2"].map(e=>`image/stanza-spawn/${e}`),r=e.findTag(t.Renderer),s=a.map(e=>{const[t]=c.default.createGPUTextureTask(r,e);return t}),o=e.view(t.StanzaLineSpawningAsset),l=e.listen(t.StanzaLineSpawningAsset);return function(a){l.added.forEach(a=>{const r=a.get(t.StanzaLineSpawningAsset),o=i.gaussian(1,.25),d=i.pick(s);if(d&&d.image&&d.image.width>0&&d.image.height>0){const s=(0,n.createSprite)(e,d,o);s.position.set(r.x,0,r.z),s.scale.y=0,a.add(t.Object3D,s).add(t.ShaderUniformTime,{uniform:s.material.uniforms.time}).add(t.ShadowCaster,{sprite:!0}),(0,u.tweenFromTo)(e,s.scale,"y",0,o,1,"sineOut",i.range(0,1))}}),o.forEach(e=>{if(e.has(t.Object3D)){const i=e.get(t.Object3D),a=i.material.uniforms.map.value,r=a.image.width/a.image.height,n=i.scale.y*r;i.scale.x=n}})}}
},{"../tags":60,"three":74,"../util/materials":82,"../util/EditorWayfinderSprite":81,"../util/load":247,"./AnimationSystem":108,"../util/Random":235,"../util/Assets":31}],121:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=g;var e=require("../util/math"),t=d(e),a=require("../tags"),r=d(a),i=require("three"),o=d(i),n=require("../util/ObjectPool"),l=u(n),s=require("../util/Random"),c=u(s);function u(e){return e&&e.__esModule?e:{default:e}}function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function g(e){const a=e.findTag(r.EnvironmentUnderPlayerState),i=e.entity(),n=(0,c.default)(),s=new o.SphereBufferGeometry(1,8,8),u=new o.SphereBufferGeometry(1,8,8);u.scale(1,.75,1);const d=new o.Color("#3ea7e0"),g=new o.MeshBasicMaterial({}),f=new o.Mesh(s,g),m=new l.default({maxCapacity:100,initialCapacity:50,create(){const e=f.clone();e.geometry=n.boolean()?s:u,e.material=g.clone(),e.userData.velocity=new o.Vector3,e.material.color.copy(d),e.material.color.offsetHSL(0*n.range(-1,1),0*n.range(-1,1),.1*n.range(-1,1)),e.material.color.multiplyScalar(n.range(.2,1));return e.material.color.r+=1,e.material.color.g+=1,e.material.color.b+=1,e.userData.time=0,e.userData.scale=1,e.userData.duration=1,e.userData.delay=1,e.userData.speed=1,e.visible=!1,e},renew(e){e.visible=!0},release(e){}}),y=()=>n.range(.1,.2);let p=y(),D=n.range(0,p);const v=[0,0],h=[0,0,0,0],w=e.view(r.WaterFollowParticle),b=()=>n.range(1,2);let P=b(),S=0;const E=e.view([r.EnvironmentState,r.ActiveEnvironmentState]),M=e.entity(),T=e.view(r.ParticleEmit);let C=null;return function(l){a.water&&!i.has(r.UserCarryingTokenCollectionFeature)&&i.add(r.UserCarryingTokenCollectionFeature);const s=e.findTag(r.UserCharacter),c=s.velocity,u=s.position,d=!C||u.distanceToSquared(C)>=4;M.has(r.UserHitAudioTrigger)&&(S+=l)>=P&&(S%=P,P=b(),M.remove(r.UserHitAudioTrigger));const g=a.water,f=T.length>0;if(g){if((D+=l)>=p){D%=p,p=y();const e=n.rangeFloor(1,5);for(let t=0;t<e&&U(u,c);t++);}if(d&&g&&!M.has(r.UserHitAudioTrigger)){C||(C=new o.Vector3),C.copy(u),M.add(r.UserHitAudioTrigger);const e=M.get(r.UserHitAudioTrigger),t=!!E.length&&"tundra"===E[0].get(r.EnvironmentState).name;e.type=t?"ice":"water"}}else if(f&&(D+=l)>=p){D%=p,p=y();e:for(let e=0;e<T.length;e++){T[e].get(r.ParticleEmit).position;const t=n.rangeFloor(1,5);for(let e=0;e<t;e++)if(!U(u,c,!0))break e}}T.forEach(e=>{const t=e.get(r.ParticleEmit);t.elapsed+=l,t.elapsed>=t.duration&&e.tagOff(r.ParticleEmit)}),w.forEach(e=>{const a=e.get(r.Object3D);a.userData.time+=l;const i=a.userData.time-a.userData.delay;!a.visible&&i>=0&&(a.visible=!0);const o=Math.max(0,i),n=t.clamp01(o/a.userData.duration),s=Math.max(1e-5,Math.sin(n*Math.PI));a.scale.setScalar(a.userData.scale*s),a.position.addScaledVector(a.userData.velocity,a.userData.speed),a.position.y+=l,o>=a.userData.duration&&(a.visible=!1,e.kill(),a.userData._entity=null,m.release(a))})};function U(t,a,i){const o=m.next();return!!o&&(o.userData._entity=e.entity().add(r.WaterFollowParticle).add(r.Object3D,o),o.userData.velocity.copy(a),o.quaternion.fromArray(n.quaternion(h)),o.position.copy(t),n.insideCircle(n.range(1,2),v),o.position.x+=v[0],o.position.z+=v[1],o.position.y=n.range(.01,.25),o.visible=!1,o.userData.scale=(i?.6:.4)*n.gaussian(.1,.1/3),o.userData.time=0,o.userData.delay=n.range(0,.5),o.userData.speed=n.range(.05,.5),o.userData.duration=n.range(1,1.5),o)}}
},{"../util/math":240,"../tags":60,"three":74,"../util/ObjectPool":236,"../util/Random":235}],122:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=c;var e=require("../tags"),t=s(e),o=require("three"),r=s(o),n=require("../util/Random"),i=a(n);function a(e){return e&&e.__esModule?e:{default:e}}function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}class l extends e.Data{}function c(e){let o=0;const n=new r.MeshBasicMaterial,a=new r.BoxGeometry(1,1,1),s=(0,i.default)(),c=e.view([t.Object3D,l]),u=e.listen(l);return i=>{(o+=i)>=1&&(o%=1,function(){const o=e.findTag(t.UserCharacter).position,i=new r.Mesh(a,n);i.position.copy(o),i.quaternion.fromArray(s.quaternion());const c=e.entity();c.add(t.Object3D,i);const u=s.range(1,2);c.add(l,{speed:u})}()),u.added.forEach(e=>{console.log("Box initialized")}),c.forEach(e=>{const o=e.get(t.Object3D),r=e.get(l);o.position.y+=r.speed*i,o.position.y>5&&e.kill()}),u.removing.forEach(e=>{console.log("Removing box")})}}Object.defineProperty(l,"data",{enumerable:!0,writable:!0,value:{speed:e.Types.Ref(1)}});
},{"../tags":60,"three":74,"../util/Random":235}],254:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three");function t(){}const i="\n#include <common>\nvarying vec2 vUv;\nuniform bool uLeft;\nuniform float uRotation;\n\nvoid main() {\n\n\n  // vec3 centerWorldPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n  // vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n  // vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n  // vec2 scale;\n  // scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n  // scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n  \n  // vec3 vertexWorldPos = centerWorldPos\n  //   + camRightWorld * position.x * scale.x\n  //   + camUpWorld * position.y * scale.y;\n\n  vec2 center = vec2(0.5);\n  vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n  if (uLeft) scale.x *= -1.0;\n\n  vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n  vec2 rotatedPosition;\n  float rot = uRotation * (uLeft ? -1.0 : 1.0);\n  rotatedPosition.x = cos( rot ) * alignedPosition.x - sin( rot ) * alignedPosition.y;\n  rotatedPosition.y = sin( rot ) * alignedPosition.x + cos( rot ) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n\n  gl_Position = projectionMatrix * mvPosition;\n  vUv = uv;\n  // if (uLeft) vUv.x = 1.0 - vUv.x;\n}\n",r="\nuniform sampler2D tSprite;\n\nuniform vec2 uSize;\nuniform vec2 uOffset;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n  // get single sprite UV\n  vec2 newUV = vUv * uSize;\n  newUV += uOffset;\n  newUV.y -= uSize.y;\n\n  vec4 spriteColor = texture2D(tSprite, newUV);\n\n  if ( spriteColor.a < 0.5 ) discard;\n\n  gl_FragColor = vec4(spriteColor.rgb, spriteColor.a);\n}\n",a=new e.TextureLoader;class n{constructor(e,t,i){this.data=e,this.spriteURL=t,this.texture=null,this.isLoaded=!1,this.isPlaying=!0,this.elapsed=0,this.framerate=i&&i.framerate||1/12,this.loop=i&&i.loop||!0,this.skipFrames=i&&i.skipFrames||[],this.currentFrame=0,this.currentFrameData=this.data.frames[0],this.material=null,window.addEventListener("keyup",()=>{})}async load(){return new Promise((e,i)=>{a.load(this.spriteURL,t=>{this.texture=t,this.onLoaded(),e()},t,e=>{i(e)})})}onLoaded(){this.isLoaded=!0,this.material=this.makeMaterial()}play(){this.isPlaying=!0}pause(){this.isPlaying=!1}stop(){this.pause(),this.currentFrame=0}gotoFrame(e){this.currentFrame=e}update(e){if(!this.isPlaying)return;let t=!1;this.elapsed+=e;const i=this.data.frames.length,r=this.loop&&this.loopEnd?this.loopEnd:i-1;this.elapsed>=this.framerate&&(this.elapsed=0,this.currentFrame++,t=!0,this.isFrameValid(this.currentFrame)&&(this.currentFrameData=this.data.frames[this.currentFrame])),this.currentFrame>=r&&this.loop&&(this.currentFrame=this.loopStart?this.loopStart:0,this.currentFrameData=this.data.frames[this.currentFrame]),this.currentFrame=Math.max(0,Math.min(this.currentFrame,i));const a=this.data,n=this.currentFrameData;return n&&0!=this.currentFrame&&(this.material.uniforms.uSize.value.x=n.sourceSize.w/a.meta.size.w,this.material.uniforms.uSize.value.y=n.sourceSize.h/a.meta.size.h,this.material.uniforms.uOffset.value.x=n.frame.x/a.meta.size.w,this.material.uniforms.uOffset.value.y=1-n.frame.y/a.meta.size.h),t}isFrameValid(e){let t=!0;for(let i=0;i<this.skipFrames.length;i++)this.skipFrames[i]==e&&(t=!1);return t}makeMaterial(){this.texture.minFilter=e.LinearFilter,this.texture.magFilter=e.LinearFilter;const t=new e.ShaderMaterial({uniforms:{tSprite:{value:this.texture},uSize:{value:new e.Vector2},uOffset:{value:new e.Vector2},uFlip:{value:0},uRotation:{value:0},uLeft:{value:!0,type:"i"}},side:e.DoubleSide,vertexShader:i,fragmentShader:r});return this.material=t,t}getMaterial(){return this.material}}exports.default=n;
},{"three":74}],308:[function(require,module,exports) {
module.exports=module.exports={frames:[{filename:"BIRD_FLY_1_0000.png",frame:{x:1,y:1,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0001.png",frame:{x:166,y:1,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0002.png",frame:{x:331,y:1,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0003.png",frame:{x:1,y:166,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0004.png",frame:{x:166,y:166,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0005.png",frame:{x:331,y:166,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0006.png",frame:{x:1,y:331,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0007.png",frame:{x:166,y:331,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0008.png",frame:{x:331,y:331,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0009.png",frame:{x:1,y:496,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0010.png",frame:{x:166,y:496,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0011.png",frame:{x:166,y:1,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0012.png",frame:{x:331,y:1,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0013.png",frame:{x:331,y:496,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0014.png",frame:{x:1,y:661,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0015.png",frame:{x:166,y:661,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0016.png",frame:{x:331,y:661,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0017.png",frame:{x:166,y:331,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0018.png",frame:{x:331,y:331,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0019.png",frame:{x:1,y:496,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0020.png",frame:{x:1,y:1,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}}],meta:{app:"https://www.codeandweb.com/texturepacker",version:"1.0",image:"bird-fly.png",format:"RGBA8888",size:{w:495,h:825},scale:"0.25",smartupdate:"$TexturePacker:SmartUpdate:f0f421fcb3358c8b88a64ecc25121c3b:72b4781501fa14a996a7799bb788d834:7c301bb00a7c24e9cfe7ed7518c7859d$"}};
},{}],123:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../tags"),t=y(e),n=require("three"),i=y(n),a=require("../util/Random"),r=m(a),o=require("../assets/spritesheets/bird_fly.png"),s=m(o),l=require("../util/math"),u=y(l),c=require("../util/SpriteAnimation"),d=m(c),f=require("../assets/spritesheets/bird_fly.sheet"),p=m(f);function m(e){return e&&e.__esModule?e:{default:e}}function y(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}const g=()=>{},T=new n.TextureLoader;class b extends e.Data{}Object.defineProperty(b,"data",{enumerable:!0,writable:!0,value:{time:e.Types.Ref(0),animateInDuration:e.Types.Ref(.25),size:e.Types.Ref(.6),animation:e.Types.Ref(null),left:e.Types.Ref(!1),speed:e.Types.Ref(1),velocity:e.Types.Vector3()}}),exports.default=async function(e){const n=await async function(e){return new Promise((t,n)=>{T.load(e,e=>{t(e)},g,e=>{n(e)})})}(s.default),a=new i.PlaneBufferGeometry(1,1),o=(0,r.default)(),l=e.view([t.Object3D,b]),c=(e.listen(b),e.listen([t.Object3D,t.UserHitAudioTrigger])),f=new i.Vector3,m=new i.Box3;let y=0,h=null;return function(r){e.findTag(t.MainCamera);const s=e.findTag(t.MainCameraFrustum),g=Boolean(e.findTag(t.ShowBiomeResolution)||e.findTag(t.WrittenStanzaLineActive)||e.findTag(t.HaikuAddingToInventory));y+=r,c.added.forEach(r=>{if(g)return;const s=r.get(t.UserHitAudioTrigger).type,u=l.length<4,c=null==h||y-h>=2;if("tree"===s&&o.chance(.5)&&u&&c){const s=r.get(t.Object3D);f.copy(s.position);const l=Math.min(s.scale.y,o.range(4,5));f.y+=l,function(r,s){const l=new d.default(p.default,null);l.texture=n,l.makeMaterial();l.getMaterial();const u=new i.Mesh(a,l.getMaterial());u.position.copy(s);const c=e.entity();c.add(t.Object3D,u),c.add(t.AnimalSound,"birdChirp");c.add(b);const f=c.get(b),m=o.boolean();f.animation=l,f.velocity.set(m?-.5:.5,.25,-.5).normalize(),f.left=m,f.size=2,f.speed=7}(0,f),h=y}}),l.forEach(e=>{const n=e.get(b),i=n.speed,a=e.get(t.Object3D),o=a.material;n.animation.update(r),n.time+=r;const l=u.clamp01(n.time/n.animateInDuration);a.scale.setScalar(l*n.size),a.position.addScaledVector(n.velocity,r*i),o.uniforms.uLeft.value=n.left,o.uniforms.uRotation.value=u.degToRad(0),m.setFromObject(a),s.intersectsBox(m)||e.kill()})}};
},{"../tags":60,"three":74,"../util/Random":235,"../assets/spritesheets/bird_fly.png":253,"../util/math":240,"../util/SpriteAnimation":254,"../assets/spritesheets/bird_fly.sheet":308}],309:[function(require,module,exports) {
module.exports=module.exports={frames:[{filename:"BIRD-STILL-0000.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0001.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0002.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0003.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0004.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0005.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0006.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0007.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0008.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0009.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0010.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0011.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0012.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0013.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0014.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0015.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0016.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0017.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0018.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0019.png",frame:{x:0,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0020.png",frame:{x:160,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0021.png",frame:{x:160,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0022.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0023.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0024.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0025.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0026.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0027.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0028.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0029.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0030.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0031.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0032.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0033.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0034.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0035.png",frame:{x:320,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0036.png",frame:{x:320,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0037.png",frame:{x:320,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0038.png",frame:{x:320,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0039.png",frame:{x:320,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0040.png",frame:{x:320,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0041.png",frame:{x:320,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0042.png",frame:{x:320,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0043.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0044.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0045.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0046.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0047.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0048.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0049.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0050.png",frame:{x:320,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0051.png",frame:{x:320,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0052.png",frame:{x:320,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0053.png",frame:{x:320,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0054.png",frame:{x:480,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0055.png",frame:{x:480,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0056.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0057.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0058.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0059.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0060.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0061.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0062.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0063.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0064.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0065.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0066.png",frame:{x:640,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0067.png",frame:{x:800,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0068.png",frame:{x:640,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0069.png",frame:{x:320,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0070.png",frame:{x:320,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0071.png",frame:{x:320,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0072.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0073.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0074.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0075.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0076.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0077.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0078.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0079.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0080.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0081.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0082.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0083.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0084.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0085.png",frame:{x:800,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0086.png",frame:{x:800,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0087.png",frame:{x:800,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0088.png",frame:{x:800,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}}],meta:{app:"https://www.codeandweb.com/texturepacker",version:"1.0",image:"bird_still.png",format:"RGBA8888",size:{w:960,h:450},scale:"1",smartupdate:"$TexturePacker:SmartUpdate:1c195fab3f9fa70597046d6840707ff0:134ce8759e0ad3bea10d9e63432d9745:851287a48f709fb1b9488bdebbcefbcb$"}};
},{}],124:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../util/math"),t=w(e),i=require("../tags"),a=w(i),n=require("three"),r=w(n),l=require("../util/Random"),s=b(l),o=require("../assets/spritesheets/bird_still.png"),u=b(o),c=require("../assets/spritesheets/bird_fly.png"),d=b(c),f=require("../util/SpriteAnimation"),m=b(f),p=require("../util/water-util"),y=require("../assets/spritesheets/bird_still.sheet"),g=b(y),h=require("../assets/spritesheets/bird_fly.sheet"),v=b(h);function b(e){return e&&e.__esModule?e:{default:e}}function w(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}const A=()=>{},T=new n.TextureLoader;class M extends i.Data{}Object.defineProperty(M,"data",{enumerable:!0,writable:!0,value:{time:i.Types.Ref(0),size:i.Types.Ref(1.4),animateInDuration:i.Types.Ref(.25),duration:i.Types.Ref(5),speed:i.Types.Ref(7),left:i.Types.Ref(!0),state:i.Types.Ref("idle"),idleAnimation:i.Types.Ref(null),flyingAnimation:i.Types.Ref(null),velocity:i.Types.Vector3(0,0,0)}}),exports.default=async function(e){const i=new r.Box3,n=new r.PlaneBufferGeometry(1,1),l=await w(u.default),o=await w(d.default),c=e.findTag(a.MainCameraFrustum),f=(0,s.default)(),p=e.view([a.Object3D,M]),y=e.listen(M),h=e.listen(a.AnimalSpawn),b=e.listen(a.ActiveEnvironmentState);return function(s){h.added.forEach(t=>{const i=t.get(a.AnimalSpawn);p.length<2&&"forest"===i.biome&&"bird"===i.animal&&!i.lake&&(!function(t){const i=new m.default(g.default,null,{skipFrames:[67]});i.texture=l,i.makeMaterial();const s=new m.default(v.default,null);s.texture=o,s.makeMaterial();const u=i.getMaterial(),c=(i.currentFrameData.sourceSize.w,i.currentFrameData.sourceSize.h,new r.Mesh(n,u)),d=e.entity();d.add(a.Object3D,c),d.add(M),d.add(a.Animal);const p=d.get(M);p.idleAnimation=i,p.flyingAnimation=s,function(e,t){const i=f.boolean(),n=e.get(M);n.state="idle",n.velocity.set(0,0,0),n.left=i;const r=n.idleAnimation,l=n.flyingAnimation;r.currentFrame=Math.floor(f.range(0,20)),l.currentFrame=Math.floor(f.range(0,20)),l.elapsed=0,r.elapsed=0;const s=e.get(a.Object3D);s.material=r.getMaterial(),s.position.copy(t),s.position.y+=.5,s.material.uniforms.uLeft.value=i}(d,t)}(i.position),t.kill())}),b.changed&&p.forEach(e=>e.kill());const u=e.findTag(a.UserCharacter).position;p.forEach(e=>{const n=e.get(a.Object3D),r=e.get(M);if(r.time+=s,n.position.distanceTo(u)<4&&"idle"==r.state){e.add(a.AnimalSound,"birdFlap"),r.state="flying",n.material=r.flyingAnimation.getMaterial(),n.material.uniforms.uRotation.value=t.degToRad(0);const i=r.left;n.material.uniforms.uLeft.value=i,r.velocity.x=i?-.5:.5,r.velocity.y=.25,r.velocity.z=-.5,r.velocity.normalize(),r.size=2}("idle"==r.state?r.idleAnimation:r.flyingAnimation).update(s);r.time+=s;const l=t.clamp01(r.time/r.animateInDuration);n.scale.setScalar(l*r.size),n.position.addScaledVector(r.velocity,s*r.speed),r.time>=r.duration&&(i.setFromObject(n),c.intersectsBox(i)||e.kill())}),y.removing.forEach(e=>{})};async function w(e){return new Promise((t,i)=>{T.load(e,e=>{t(e)},A,e=>{i(e)})})}};
},{"../util/math":240,"../tags":60,"three":74,"../util/Random":235,"../assets/spritesheets/bird_still.png":275,"../assets/spritesheets/bird_fly.png":253,"../util/SpriteAnimation":254,"../util/water-util":249,"../assets/spritesheets/bird_still.sheet":309,"../assets/spritesheets/bird_fly.sheet":308}],145:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("simplex-noise"),t=T(e),n=require("../../tags"),i=S(n),a=require("three"),s=S(a),o=require("../../util/Random"),r=T(o),l=require("../../util/SpriteAnimation"),d=T(l),p=require("../../assets/spritesheets/butterfly.png"),u=T(p),c=require("../../assets/spritesheets/butterfly.sheet"),f=T(c),y=require("canvas-sketch-util/math"),g=require("../../util/math"),m=S(g),h=require("../../util/EditorWayfinderSprite");function S(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function T(e){return e&&e.__esModule?e:{default:e}}const R=()=>{},A=new a.TextureLoader,P=new s.Vector3,w=new s.Vector3,b=new s.Vector3;let x=new s.Color("hsl(50, 100%, 100%)");class E extends n.Data{}Object.defineProperty(E,"data",{enumerable:!0,writable:!0,value:{time:n.Types.Ref(0),animateInDuration:n.Types.Ref(.25),duration:n.Types.Ref(5),outOfScreenElapsed:n.Types.Ref(0),outOfScreenLimit:n.Types.Ref(5),size:n.Types.Ref(.65),state:n.Types.Ref("flying"),flyingAnimation:n.Types.Ref(null),velocity:n.Types.Vector3(0,0,0),left:n.Types.Ref(!1),restPosition:n.Types.Vector3(0,0,0),tgtPosition:n.Types.Vector3(0,0,0),tgtAngle:n.Types.Ref(0),tgtSpeed:n.Types.Ref(0),tgtAngleRadius:n.Types.Ref(0),fleeThreshold:n.Types.Ref(0),followSpeed:n.Types.Ref(0),inRadiusElapsed:n.Types.Ref(0),canGetAnnoyed:n.Types.Ref(!1),isAnnoyed:n.Types.Ref(!1),annoyedElapsed:n.Types.Ref(0)}}),exports.default=async function(e){const n=new s.Box3,a=(new s.PlaneBufferGeometry(1,1),await async function(e){return new Promise((t,n)=>{A.load(e,e=>{t(e)},R,e=>{n(e)})})}(u.default),(0,r.default)()),o=(new t.default(a.value),e.view([i.Object3D,E])),l=(e.listen(E),new s.Vector3(-10,0,-10),e.listen(i.AnimalSpawn)),d=e.entity(),p=e.listen(i.ActiveEnvironmentState);return t=>{p.changed&&o.forEach(e=>e.kill()),l.added.forEach(t=>{const n=t.get(i.AnimalSpawn);o.length<25&&"grasslands"===n.biome&&"butterfly"===n.animal&&!n.lake&&(!function(t){const n=a.rangeFloor(3,8),o=a.pick([0,30,50,330]),r=o/360,l=330===o?.5:.75;for(let o=0;o<n;o++){const n=(0,h.createSprite)(e,new s.Texture);n.position.set(t.x,0,t.z);const d=e.entity().add(i.Object3D,n).add(i.ShaderUniformTime,{uniform:n.material.uniforms.time}).add(i.ShadowCaster,{sprite:!0}).add(i.Animal).add(E),p=d.get(E);p.left=o%2==0,p.state="flying",(0,h.setSpriteFlip)(n,p.left);const u=a.range(0,2*Math.PI);p.angle=u,p.angleSpeed=a.range(-2,2),p.angleRadius=a.range(.3,1);const c=a.range(.8,1.2);p.restPosition.y=1,p.restPosition.x-=a.range(-c,c),p.restPosition.z-=a.range(-c,c),p.restPosition.add(t),p.tgtPosition.x=0,p.tgtPosition.y=1,p.tgtPosition.z=0,p.tgtPosition.add(t),p.fleeThreshold=a.range(1.5,2),p.followSpeed=a.range(1,2);const f=a.range(.4,.65);p.size=f,n.scale.x=f,n.scale.y=f,d.add(i.SpriteAnimation);const y=d.get(i.SpriteAnimation);y.looping=!0;const g=d.get(i.Object3D),S=a.range(-20,20)/360,T=a.range(0,.1);x.setHSL(m.mod(r+S,1),l,.5+T),g.material.uniforms.tintColor.value.copy(x),p.canGetAnnoyed=a.chance(.5),d.add(i.SpriteAnimationLazyLoadSheet);const R=d.get(i.SpriteAnimationLazyLoadSheet);R.id="spritesheets/butterfly"}}(n.position),t.kill())});const r=e.findTag(i.MainCameraFrustum),u=e.findTag(i.UserCharacter).position;let c=!1;o.forEach(e=>{const a=e.get(i.Object3D),s=e.get(E);s.time+=t;const o=a.position.distanceTo(u),l=s.restPosition.distanceToSquared(u);o<=4&&(c=!0),l<=16?s.inRadiusElapsed+=t:s.inRadiusElapsed*=.5,s.inRadiusElapsed>=1&&s.canGetAnnoyed&&!s.isAnnoyed&&l<=16&&(s.isAnnoyed=!0),s.isAnnoyed&&l>16&&(s.annoyedElapsed+=t,s.annoyedElapsed>2&&(s.isAnnoyed=!1,s.annoyedElapsed=0));const d=s.fleeThreshold;let p=(0,y.mapRange)(o/d,0,d,5,1);p=Math.max(1,p),s.angle+=s.angleSpeed*t,s.tgtPosition.x=s.restPosition.x+Math.cos(s.angle)*s.angleRadius,s.tgtPosition.z=s.restPosition.z+Math.sin(s.angle)*s.angleRadius,s.isAnnoyed&&(s.tgtPosition.x=u.x+Math.cos(s.angle)*s.angleRadius,s.tgtPosition.z=u.z+Math.sin(s.angle)*s.angleRadius);const f=m.clamp01(s.time/s.animateInDuration);a.scale.setScalar(f*s.size),P.copy(s.tgtPosition),P.sub(a.position);const g=Math.min(6,P.length());P.normalize(),P.multiplyScalar(.01*g*s.followSpeed);const S=s.fleeThreshold;let T=(0,y.mapRange)(o/S,0,S,.15,0);T=Math.max(0,Math.min(.08,T)),w.copy(a.position),w.sub(u),w.normalize(),w.multiplyScalar(T),P.add(w),a.position.add(P),a.position.y=1+.4*Math.sin(s.time*s.angleSpeed),(0,h.setSpriteFlip)(a,s.left),s.time>=s.duration&&(n.setFromObject(a),r.intersectsBox(n)||(s.outOfScreenElapsed+=t,s.outOfScreenElapsed>s.outOfScreenLimit&&e.kill()))}),c?d.has(i.AnimalSound)||d.add(i.AnimalSound,"butterfly"):d.tagOff(i.AnimalSound)}};
},{"simplex-noise":294,"../../tags":60,"three":74,"../../util/Random":235,"../../util/SpriteAnimation":254,"../../assets/spritesheets/butterfly.png":311,"../../assets/spritesheets/butterfly.sheet":312,"canvas-sketch-util/math":306,"../../util/math":240,"../../util/EditorWayfinderSprite":81}],527:[function(require,module,exports) {
module.exports=module.exports={frames:[{filename:"rabbit.png",frame:{x:1,y:1,w:128,h:130},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:128,h:130},sourceSize:{w:128,h:130}}],meta:{app:"https://www.codeandweb.com/texturepacker",version:"1.0",image:"rabbit.png",format:"RGBA8888",size:{w:130,h:132},scale:"0.125",smartupdate:"$TexturePacker:SmartUpdate:08b128059a6a4415147d59821ae0430b:9bf3f0adc5d3336c983fe6c591567cb0:728f3986df73c95a11c23983e61158cd$"}};
},{}],146:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../tags"),t=y(e),a=require("three"),n=y(a),i=require("../../util/Random"),r=m(i),o=require("../../assets/spritesheets/rabbit.png"),s=m(o),l=require("../../util/math"),u=y(l),f=require("../../util/SpriteAnimation"),c=m(f),d=require("../../assets/spritesheets/rabbit.sheet.json"),p=m(d);function m(e){return e&&e.__esModule?e:{default:e}}function y(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}const g=()=>{},b=new a.TextureLoader;class T extends e.Data{}Object.defineProperty(T,"data",{enumerable:!0,writable:!0,value:{time:e.Types.Ref(0),animateInDuration:e.Types.Ref(.25),size:e.Types.Ref(1.2),animation:e.Types.Ref(null),left:e.Types.Ref(!1),speed:e.Types.Ref(1),velocity:e.Types.Vector3(),state:e.Types.Ref("")}}),exports.default=async function(e){const a=await async function(e){return new Promise((t,a)=>{b.load(e,e=>{t(e)},g,e=>{a(e)})})}(s.default),i=new n.PlaneBufferGeometry(1,1),o=(0,r.default)(),l=e.view([t.Object3D,T]);e.listen(T),new n.Box3;let f=0;const d=e.listen(t.AnimalSpawn);new n.Vector3(-8,1,-6);return function(r){e.findTag(t.MainCamera),e.findTag(t.MainCameraFrustum);d.added.forEach(r=>{const s=r.get(t.AnimalSpawn);l.length<20&&"grasslands"===s.biome&&"rabbit"===s.animal&&!s.lake&&(!function(r,s){const l=new c.default(p.default,null);l.texture=a,l.makeMaterial();l.getMaterial();const u=new n.Mesh(i,l.getMaterial());u.position.copy(s),u.position.y+=.5;const f=e.entity();f.add(t.Object3D,u);f.add(T);const d=f.get(T),m=o.boolean();d.animation=l,d.velocity.set(m?-.1:.1,0,-.1).normalize(),d.left=m,d.speed=7}(0,s.position),r.kill())});Boolean(e.findTag(t.ShowBiomeResolution)||e.findTag(t.WrittenStanzaLineActive)||e.findTag(t.HaikuAddingToInventory));f+=r,l.forEach(e=>{const a=e.get(T),n=(a.speed,e.get(t.Object3D)),i=n.material;a.animation.update(r),a.time+=r;const o=u.clamp01(a.time/a.animateInDuration);n.scale.setScalar(o*a.size),i.uniforms.uLeft.value=a.left,i.uniforms.uRotation.value=u.degToRad(0)})}};
},{"../../tags":60,"three":74,"../../util/Random":235,"../../assets/spritesheets/rabbit.png":328,"../../util/math":240,"../../util/SpriteAnimation":254,"../../assets/spritesheets/rabbit.sheet.json":527}],530:[function(require,module,exports) {
module.exports=module.exports={frames:[{filename:"seal_1.png",frame:{x:1,y:1,w:103,h:75},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:103,h:75},sourceSize:{w:103,h:75}}],meta:{app:"https://www.codeandweb.com/texturepacker",version:"1.0",image:"seal.png",format:"RGBA8888",size:{w:105,h:77},scale:"0.125",smartupdate:"$TexturePacker:SmartUpdate:4459159640a2f3aa7d478805520d49fb:a1c6057bb18b47b8b1c34c942fb3eb96:77441584f386b1802c776f35e0e1106e$"}};
},{}],147:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../tags"),t=y(e),a=require("three"),n=y(a),i=require("../../util/Random"),s=m(i),o=require("../../assets/spritesheets/seal.png"),r=m(o),l=require("../../util/math"),u=y(l),f=require("../../util/SpriteAnimation"),c=m(f),d=require("../../assets/spritesheets/seal.sheet.json"),p=m(d);function m(e){return e&&e.__esModule?e:{default:e}}function y(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}const g=()=>{},T=new a.TextureLoader;class w extends e.Data{}Object.defineProperty(w,"data",{enumerable:!0,writable:!0,value:{time:e.Types.Ref(0),animateInDuration:e.Types.Ref(.25),size:e.Types.Ref(2),animation:e.Types.Ref(null),left:e.Types.Ref(!1),speed:e.Types.Ref(1),velocity:e.Types.Vector3(),state:e.Types.Ref("")}}),exports.default=async function(e){const a=await async function(e){return new Promise((t,a)=>{T.load(e,e=>{t(e)},g,e=>{a(e)})})}(r.default),i=new n.PlaneBufferGeometry(1.07,.77),o=(0,s.default)(),l=e.view([t.Object3D,w]);e.listen(w),new n.Box3;let f=0;const d=e.listen(t.AnimalSpawn);new n.Vector3(-10,1,-10);return function(s){e.findTag(t.MainCamera),e.findTag(t.MainCameraFrustum);d.added.forEach(s=>{const r=s.get(t.AnimalSpawn);l.length<20&&"grasslands"===r.biome&&"seal"===r.animal&&!r.lake&&(!function(s,r){const l=new c.default(p.default,null);l.texture=a,l.makeMaterial();l.getMaterial();const u=new n.Mesh(i,l.getMaterial());u.position.copy(r),u.position.y=1;const f=e.entity();f.add(t.Object3D,u);f.add(w);const d=f.get(w),m=o.boolean();d.animation=l,d.velocity.set(m?-.1:.1,0,-.1).normalize(),d.left=m,d.speed=7}(0,r.position),s.kill())});Boolean(e.findTag(t.ShowBiomeResolution)||e.findTag(t.WrittenStanzaLineActive)||e.findTag(t.HaikuAddingToInventory));f+=s,l.forEach(e=>{const a=e.get(w),n=(a.speed,e.get(t.Object3D)),i=n.material;a.animation.update(s),a.time+=s;const o=u.clamp01(a.time/a.animateInDuration);n.scale.setScalar(o*a.size),i.uniforms.uLeft.value=a.left,i.uniforms.uRotation.value=u.degToRad(0)})}};
},{"../../tags":60,"three":74,"../../util/Random":235,"../../assets/spritesheets/seal.png":329,"../../util/math":240,"../../util/SpriteAnimation":254,"../../assets/spritesheets/seal.sheet.json":530}],528:[function(require,module,exports) {
module.exports=module.exports={frames:[{filename:"OWL-1_0000.png",frame:{x:1,y:1,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}}],meta:{app:"https://www.codeandweb.com/texturepacker",version:"1.0",image:"owl_sleep.png",format:"RGBA8888",size:{w:142,h:142},scale:"1",smartupdate:"$TexturePacker:SmartUpdate:21eaf86d4169e0ddc4011243b75b342b:dcc49444f38700aee47bfd37a7041e0a:6bc02c8c74c6acf003ca8634b6b6245d$"}};
},{}],529:[function(require,module,exports) {
module.exports=module.exports={frames:[{filename:"OWL-1_0000.png",frame:{x:1,y:1,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0001.png",frame:{x:143,y:1,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0002.png",frame:{x:285,y:1,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0003.png",frame:{x:1,y:143,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0004.png",frame:{x:143,y:143,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0005.png",frame:{x:285,y:143,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0006.png",frame:{x:1,y:285,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0007.png",frame:{x:143,y:285,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0008.png",frame:{x:285,y:285,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0009.png",frame:{x:1,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0010.png",frame:{x:1,y:1,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0011.png",frame:{x:143,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0012.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0013.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0014.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0015.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0016.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0017.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0018.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0019.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0020.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0021.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0022.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0023.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0024.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0025.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0026.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0027.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0028.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0029.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0030.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0031.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0032.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0033.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0034.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0035.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0036.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0037.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0038.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0039.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0040.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0041.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0042.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0043.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0044.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0045.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0046.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0047.png",frame:{x:285,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0048.png",frame:{x:1,y:1,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}}],meta:{app:"https://www.codeandweb.com/texturepacker",version:"1.0",image:"owl_wakeup.png",format:"RGBA8888",size:{w:426,h:710},scale:"1",smartupdate:"$TexturePacker:SmartUpdate:72e1158335e3a375f958ba9c57f12e1b:7ae100e830d5001477212dfd1b1f81c1:4803889c0639208641360bc38f21b5a2$"}};
},{}],148:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../tags"),t=T(e),n=require("three"),a=T(n),i=require("../../util/Random"),r=g(i),s=require("../../assets/spritesheets/owl_sleep.png"),o=g(s),l=require("../../assets/spritesheets/owl_wakeup.png"),u=g(l),c=require("../../util/math"),p=T(c),f=require("../../util/SpriteAnimation"),m=g(f),d=require("../../assets/spritesheets/owl_sleep.sheet.json"),w=g(d),A=require("../../assets/spritesheets/owl_wakeup.sheet.json"),y=g(A);function g(e){return e&&e.__esModule?e:{default:e}}function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}const h=()=>{},k=new n.TextureLoader;class R extends e.Data{}Object.defineProperty(R,"data",{enumerable:!0,writable:!0,value:{time:e.Types.Ref(0),animateInDuration:e.Types.Ref(.25),size:e.Types.Ref(1),left:e.Types.Ref(!1),state:e.Types.Ref("sleep"),currentAnimation:e.Types.Ref(null),sleepAnimation:e.Types.Ref(null),wakeupAnimation:e.Types.Ref(null)}}),exports.default=async function(e){const n=await A(u.default),i=await A(o.default),s=new a.PlaneBufferGeometry(1,1),l=(0,r.default)(),c=e.view([t.Object3D,R]);e.listen(R),new a.Box3;let f=0;const d=e.listen(t.AnimalSpawn);new a.Vector3(-5,1,-5);return function(r){e.findTag(t.MainCamera),e.findTag(t.MainCameraFrustum);const o=e.findTag(t.UserCharacter).position;d.added.forEach(r=>{const o=r.get(t.AnimalSpawn);c.length<20&&"forest"===o.biome&&"owl"===o.animal&&!o.lake&&(!function(r,o){const u=new m.default(w.default,null);u.texture=i,u.makeMaterial();const c=new m.default(y.default,null);c.texture=n,c.loop=!1,c.makeMaterial();const p=new a.Mesh(s,u.getMaterial());p.position.copy(o),p.position.y+=.5;const f=e.entity();f.add(t.Object3D,p);f.add(R);const d=f.get(R);d.state="sleep";const A=l.boolean();d.sleepAnimation=u,d.wakeupAnimation=c,d.currentAnimation=u,d.left=A,d.speed=7}(0,o.position),r.kill())});Boolean(e.findTag(t.ShowBiomeResolution)||e.findTag(t.WrittenStanzaLineActive)||e.findTag(t.HaikuAddingToInventory));f+=r,c.forEach(e=>{const n=e.get(R),a=e.get(t.Object3D),i=a.position.distanceTo(o);i<14&&"sleep"==n.state?(n.state="wakeup",n.currentAnimation=n.wakeupAnimation,n.currentAnimation.stop(),n.currentAnimation.play(),a.material=n.currentAnimation.getMaterial()):i>4&&"wakeup"==n.state&&n.currentAnimation.currentFrame>47&&(n.state="sleep",n.currentAnimation=n.sleepAnimation,n.currentAnimation.stop(),n.currentAnimation.play(),a.material=n.currentAnimation.getMaterial()),n.currentAnimation.update(r),n.time+=r;const s=p.clamp01(n.time/n.animateInDuration);a.scale.setScalar(s*n.size);const l=a.material;l.uniforms.uLeft.value=n.left,l.uniforms.uRotation.value=p.degToRad(0)})};async function A(e){return new Promise((t,n)=>{k.load(e,e=>{t(e)},h,e=>{n(e)})})}};
},{"../../tags":60,"three":74,"../../util/Random":235,"../../assets/spritesheets/owl_sleep.png":325,"../../assets/spritesheets/owl_wakeup.png":326,"../../util/math":240,"../../util/SpriteAnimation":254,"../../assets/spritesheets/owl_sleep.sheet.json":528,"../../assets/spritesheets/owl_wakeup.sheet.json":529}],149:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=g;var e=require("../../tags"),t=p(e),o=require("three"),r=p(o),a=require("../../util/Random"),n=c(a),i=require("../../util/math"),s=p(i),d=require("../../util/SpriteAnimation"),l=c(d),u=require("../../util/EditorWayfinderSprite");function c(e){return e&&e.__esModule?e:{default:e}}function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}const m=new r.Vector3,f=new r.Vector3;class x extends e.Data{}let S;function g(e){const o=(0,n.default)(),a=e.listen([t.Object3D,t.FoxSpriteTag]),i=e.view([t.Object3D,t.FoxSpriteTag]),s=(e.listen(t.FoxHm),e.findTag(t.UserCharacter)),d=new r.Box3;return function(r){a.added.forEach((e,r)=>{const a=e.get(t.Object3D);e.add(x),(0,u.setSpriteFlip)(a,o.boolean()),a.scale.y=1.5,e.add(t.SpriteAnimation);const n=e.get(t.SpriteAnimation);n.looping=!0,n.loopStart=0,n.loopEnd=29,e.add(t.SpriteAnimationLazyLoadSheet),e.get(t.SpriteAnimationLazyLoadSheet).id="spritesheets/fox"});const n=e.findTag(t.MainCameraFrustum),l=s.position;m.x=l.x,m.z=l.z,i.forEach((e,o)=>{const r=e.get(t.Object3D),a=e.get(t.SpriteAnimation),i=e.get(x);f.setFromMatrixPosition(r.matrixWorld);const s=m.x-f.x,l=m.z-f.z;s*s+l*l<169?(i.state="awake",a.loopStart=29,a.loopEnd=68,a.frame>=30&&a.frame<=33&&i.canPlayHmSound&&(i.canPlayHmSound=!1,e.add(t.FoxHm),e.remove(t.FoxPurring),S=setTimeout(()=>{e.remove(t.FoxHm),i.canPlayHmSound=!0},5e3))):(i.state="sleep",a.loopStart=0,a.loopEnd=29,d.setFromObject(r),n.intersectsBox(d)?e.add(t.FoxPurring):(e.remove(t.FoxHm),e.remove(t.FoxPurring)))})}}Object.defineProperty(x,"data",{enumerable:!0,writable:!0,value:{state:e.Types.Ref("sleep"),canPlayHmSound:e.Types.Ref(!0)}});
},{"../../tags":60,"three":74,"../../util/Random":235,"../../util/math":240,"../../util/SpriteAnimation":254,"../../util/EditorWayfinderSprite":81}],150:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=v;var e=require("../../tags"),t=m(e),i=require("three"),r=m(i),a=require("../../util/Random"),n=c(a),s=require("../../assets/spritesheets/fish.png"),o=c(s),d=require("../../util/math"),u=m(d),l=require("../../util/SpriteAnimation"),p=c(l),f=require("../../util/EditorWayfinderSprite");function c(e){return e&&e.__esModule?e:{default:e}}function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}class h extends e.Data{}Object.defineProperty(h,"data",{enumerable:!0,writable:!0,value:{spawnEntity:e.Types.Ref(null)}});class S extends e.Tag{}function v(e){const i=(0,n.default)(),a=e.view(t.WaterFishPlaceholderTag),s=e.findTag(t.UserCharacter),o=e.view([t.SpriteAnimation,h]),d=e.view([t.EnvironmentState,t.ActiveEnvironmentState]);return function(n){if(d.length&&"grasslands"!==d[0].get(t.EnvironmentState).name)return;const u=s.position;o.forEach(e=>{e.get(t.SpriteAnimation).finished&&(e.get(h).spawnEntity.remove(S),e.kill())}),a.forEach(a=>{const n=a.get(t.GroundAsset),s=n.x-u.x,o=n.z-u.z;s*s+o*o<=64?a.has(t.UserHasHit)||(a.add(t.UserHasHit),a.has(S)||(a.add(S),function(a,n,s){const o=(0,f.createSprite)(e,new r.Texture);o.position.set(n,0,s);const d=e.entity().add(t.Object3D,o).add(t.ShaderUniformTime,{uniform:o.material.uniforms.time}).add(t.ShadowCaster,{sprite:!0}).add(t.AnimalSound,"fish").add(h,{spawnEntity:a});(0,f.setSpriteFlip)(o,i.boolean());o.scale.x=4,o.scale.y=2.6664,d.add(t.SpriteAnimation);d.get(t.SpriteAnimation);d.add(t.SpriteAnimationLazyLoadSheet),d.get(t.SpriteAnimationLazyLoadSheet).id="spritesheets/fish"}(a,n.x,n.z))):a.has(t.UserHasHit)&&a.remove(t.UserHasHit)})}}
},{"../../tags":60,"three":74,"../../util/Random":235,"../../assets/spritesheets/fish.png":313,"../../util/math":240,"../../util/SpriteAnimation":254,"../../util/EditorWayfinderSprite":81}],151:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../util/math"),t=f(e),i=require("../../tags"),n=f(i),o=require("three"),a=f(o),r=require("../../util/Random"),s=u(r),l=require("../../util/water-util"),p=require("canvas-sketch-util/math"),d=require("../../util/EditorWayfinderSprite");function u(e){return e&&e.__esModule?e:{default:e}}function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}const m=new a.Vector3,c=()=>{},g=new o.TextureLoader,y=new a.Color("#ffffff");class S extends i.Data{}Object.defineProperty(S,"data",{enumerable:!0,writable:!0,value:{time:i.Types.Ref(0),size:i.Types.Ref(2.5),animateInDuration:i.Types.Ref(.25),duration:i.Types.Ref(10),speed:i.Types.Ref(7),left:i.Types.Ref(!0),newLeft:i.Types.Ref(null),state:i.Types.Ref("idle"),animation:i.Types.Ref(null),jumpSpeed:i.Types.Ref(1)}}),exports.default=async function(e){const i=new a.Box3,o=(new a.Box3,new a.PlaneBufferGeometry(1,1),e.findTag(n.MainCameraFrustum)),r=(0,s.default)(),l=e.view([n.Object3D,S]),p=e.view([n.GroundAsset,n.GroundAssetData]),u=e.listen(n.AnimalSpawn);return function(s){u.added.forEach(t=>{const i=t.get(n.AnimalSpawn);if(l.length<10&&"tundra"===i.biome&&"jumpingrabbit"===i.animal&&!i.lake){let o=!0;p.forEach((e,t)=>{const a=e.get(n.GroundAsset);m.x=a.x,m.z=a.z,m.distanceTo(i.position)<5&&(o=!1)}),r.chance(.4)&&function(t){const i=(0,d.createSprite)(e,new a.Texture);i.position.set(t.x,0,t.z);const o=e.entity().add(n.Object3D,i).add(n.ShaderUniformTime,{uniform:i.material.uniforms.time}).add(n.ShadowCaster,{sprite:!0}).add(S),s=o.get(S);s.left=r.boolean(),(0,d.setSpriteFlip)(i,s.left);i.scale.x=4,i.scale.y*=62/128,s.jumpSpeed=r.range(3,4.5),o.add(n.SpriteAnimation);const l=o.get(n.SpriteAnimation);l.looping=!0,l.loopStart=0,l.loopEnd=18;const p=o.get(n.Object3D);p.material.uniforms.tintColor.value.r=y.r,p.material.uniforms.tintColor.value.g=y.g,p.material.uniforms.tintColor.value.b=y.b,p.material.needsUpdate=!0,l.onLoopEnd=(e=>{const t=e.get(n.Object3D),i=e.get(n.SpriteAnimation),o=e.get(S),a=i.frame>=18&&i.frame<35;a&&(t.position.x+=o.left?.43*o.size:.43*-o.size),"jumping"===o.state?(i.loopStart=18,i.loopEnd=35):"idle"===o.state&&(i.loopStart=0,i.loopEnd=18),i.frame=i.loopStart,i.dirty=!0,o.left!==o.newLeft&&(o.left=o.newLeft,(0,d.setSpriteFlip)(t,o.left),t.position.x+=o.left?.43*o.size:.43*-o.size)}),o.add(n.SpriteAnimationLazyLoadSheet),o.get(n.SpriteAnimationLazyLoadSheet).id="spritesheets/jumpingrabbit"}(i.position),t.kill()}});const f=e.findTag(n.UserCharacter).position;l.forEach(e=>{const a=e.get(n.Object3D),r=e.get(S),l=e.get(n.SpriteAnimation);r.time+=s;const d=l.frame>=18&&l.frame<35;l.speed=d?r.jumpSpeed:1;const u=a.position.distanceTo(f);let c=f.x-a.position.x>0?1:-1;p.forEach((e,t)=>{e.get(n.GroundAsset);const i=e.get(n.Object3D);if(i.geometry&&i.geometry.boundingSphere){m.x=i.matrixWorld.elements[12],m.z=i.matrixWorld.elements[14],m.distanceTo(a.position)<(i.geometry?2*i.geometry.boundingSphere.radius:4)&&(c*=-1)}}),r.newLeft=1!=c,u<10&&"idle"==r.state&&(console.log("start running away"),r.state="jumping",l.loopStart=18,l.loopEnd=35,l.frame=l.loopStart,l.dirty=!0),"jumping"===r.state&&u>10&&(r.state="idle");const g=t.clamp01(r.time/r.animateInDuration);a.scale.setScalar(g*r.size),a.scale.y*=62/128,r.time>=r.duration&&(i.setFromObject(a),o.intersectsBox(i)||e.kill())})}};
},{"../../util/math":240,"../../tags":60,"three":74,"../../util/Random":235,"../../util/water-util":249,"canvas-sketch-util/math":306,"../../util/EditorWayfinderSprite":81}],125:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t};exports.default=b;var e=require("../tags"),n=h(e),o=require("three"),a=h(o),i=require("../util/math"),r=h(i),s=require("../util/Random"),l=y(s),c=require("../util/Assets"),u=y(c),v=require("../util/ShaderManager"),m=h(v),f=require("../util/array"),p=require("../util/query-string"),d=y(p),g=require("../util/resetPlayerPos");function y(t){return t&&t.__esModule?t:{default:t}}function h(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function w(){this.position=new a.Vector3(0,0,0),this.velocity=new a.Vector3(0,0,0),this.lastPosition=new a.Vector3(0,0,0),this.speed=1,this.scale=1,this.timeScale=1,this.currentRotation=new a.Quaternion(0,0,0,0),this.spinRotation=new a.Quaternion(0,0,0,0),this.flatRotation=new a.Quaternion(0,0,0,0),this.rotationAxis=new a.Vector3(0,0,0),this.rotationSpeed=1,this.rotationAngleOffset=0}function b(e){const o=(0,l.default)(),i=[0,0],s=new a.Vector3(0,0,0),c=new a.Vector3(0,0,0),v=[0,0,0],p=e.findTag(n.Renderer),d=Math.min(8,p.capabilities.getMaxAnisotropy()),[g]=u.default.createGPUTextureTask(p,"image/ui/ico_about",{anisotropy:d}),y=new a.Quaternion(0,0,0,1);new a.Quaternion(0,0,0,1).setFromEuler(new a.Euler(-Math.PI/2,0,0));const h=1e3,b=new a.Group,A=()=>o.range(.1,.3);let x=A(),S=0;const R=new a.PlaneBufferGeometry(1,1,4,4),C=new a.InstancedBufferGeometry;C.instanceCount=h,C.setAttribute("position",R.getAttribute("position")),C.setAttribute("normal",R.getAttribute("normal")),C.setAttribute("uv",R.getAttribute("uv")),C.setIndex(R.getIndex());const q=new Float32Array(3e3),z=new Float32Array(4e3),M=new Float32Array(3e3),N=new Float32Array(2e3),T=new a.Quaternion,F=new a.Color,O=new a.Color("hsl(40, 100%, 50%)"),P=(0,f.newArray)(h).map((t,e)=>{F.copy(O).offsetHSL(o.range(-1,1)*(5/360),.05*o.range(-1,0),.1*o.range(-1,1)),F.r=r.clamp(F.r,0,1),F.g=r.clamp(F.g,0,1),F.b=r.clamp(F.b,0,1);const n=o.range(0,h),[s,l]=o.onCircle(o.gaussian(7,2),i),c=new w;c.timeScale=o.range(1,1),c.position.set(s,o.range(0,4),l),c.rotationAxis.fromArray(o.insideSphere(1,v)),c.rotationAngleOffset=o.range(-1,1)*Math.PI*2,c.rotationSpeed=o.range(.1,1);const u=new a.Euler(0,0,0);return u.x=-Math.PI/2+.1*o.range(-1,1),u.z=o.range(-1,1)*Math.PI*2,T.setFromEuler(u),c.spinRotation.copy(T),c.flatRotation.copy(T),c.currentRotation.copy(T),c.speed=o.range(.5,1.5),c.scale=Math.abs(o.gaussian(.75,.1)),c.velocity.copy(c.position).normalize().multiplyScalar(o.gaussian(1,.25)),M[3*e+0]=F.r,M[3*e+1]=F.g,M[3*e+2]=F.b,N[2*e+0]=c.scale,N[2*e+1]=n,{body:c}});C.setAttribute("instanceColor",new a.InstancedBufferAttribute(M,3));const _=new a.InstancedBufferAttribute(q,3);C.setAttribute("instancePosition",_);const U=new a.InstancedBufferAttribute(z,4);C.setAttribute("instanceRotation",U),C.setAttribute("instanceScaleAndTime",new a.InstancedBufferAttribute(N,2));const V=function(e={}){const{map:n,color:o="white",opacity:i=1,timeOffset:r=0,time:s=0,minY:l,spriteRadius:c}=e;return delete(e=t({},e)).time,delete e.opacity,delete e.color,delete e.map,delete e.spriteRadius,delete e.minY,delete e.timeOffset,m.create(t({name:"origin-tree-leaves",uniforms:{color:{value:new a.Color(o)},map:{value:n},time:{value:s},globalScale:{value:1},opacity:{value:i},straighten:{value:0},minY:{value:l},spriteRadius:{value:c},fadeAway:{value:0},timeOffset:{value:r}}},e,{vertexShader:"\n        attribute vec3 instancePosition;\n        attribute vec4 instanceRotation;\n        attribute vec3 instanceColor;\n        attribute vec2 instanceScaleAndTime;\n        varying vec2 vUv;\n        varying vec3 vNormal;\n        uniform float mapScale;\n        // uniform float timeOffset;\n        uniform float time;\n        // uniform float straighten;\n        varying float vStraighten;\n        uniform float globalScale;\n        uniform float spriteRadius;\n        uniform float minY;\n        uniform float fadeAway;\n        varying vec3 vColor;\n\n        mat3 rotation3dY(float angle) {\n        \tfloat s = sin(angle);\n        \tfloat c = cos(angle);\n\n        \treturn mat3(\n        \t\tc, 0.0, -s,\n        \t\t0.0, 1.0, 0.0,\n        \t\ts, 0.0, c\n        \t);\n        }\n\n        float invLerp (float minV, float maxV, float t) {\n          return (t - minV) / (maxV - minV);\n        }\n\n        vec3 rotate_vector( vec4 quat, vec3 vec ) {\n          return vec + 2.0 * cross( cross( vec, quat.xyz ) + quat.w * vec, quat.xyz );\n        }\n\n        float ease (float t) {\n          return 1.0 - pow(2.0, -10.0 * t);\n        }\n\n        // http://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/,\n        vec3 applyTRS( vec3 position, vec3 translation, vec4 quaternion, vec3 scale ) {\n        \tposition *= scale;\n        \tposition += 2.0 * cross( quaternion.xyz, cross( quaternion.xyz, position ) + quaternion.w * position );\n        \treturn position + translation;\n        }\n\n        void main () {\n          vUv = uv;\n          vec3 transformed = position.xyz;\n          \n          vColor = instanceColor;\n          vec3 worldCenter = (modelMatrix * vec4(vec3(instancePosition), 1.0)).xyz;\n\n          float straighten = 1.0 - clamp(invLerp(minY, 1.0, worldCenter.y - spriteRadius), 0.0, 1.0);\n          vStraighten = straighten;\n\n          float timeOffset = instanceScaleAndTime.y;\n          float angle = 3.14 * sin(time + timeOffset + position.x);\n          transformed *= rotation3dY(angle * (1.0 - straighten));\n\n          vec3 transformedNormal = normal;\n          vec4 invQuat = vec4(-instanceRotation.xyz, instanceRotation.w);\n          float nAngle = (3.14 / -1.0 + 3.14 * sin(position.x)) * (1.0 - straighten);\n          transformedNormal = normalize(transformedNormal * rotation3dY(nAngle));\n          transformedNormal = normalize(rotate_vector(invQuat, transformedNormal));\n          transformedNormal = normalize(normalMatrix * transformedNormal);\n\n          vNormal = transformedNormal;\n\n          float dFromCenter = 1.0 - length(instancePosition.xz) / 20.0;\n          float disappear = 1.0 - min(1.0, ease(max(fadeAway - dFromCenter * 2.0, 0.0) / (4.0)));\n          transformed = applyTRS(transformed, instancePosition, instanceRotation, vec3(disappear * globalScale * instanceScaleAndTime.x));\n\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(transformed, 1.0);\n        }\n      ",fragmentShader:"\n        varying vec2 vUv;\n        varying float vStraighten;\n        varying vec3 vNormal;\n        varying vec3 vColor;\n        uniform sampler2D map;\n        uniform float opacity;\n        // uniform vec3 color;\n        void main () {\n          gl_FragColor = vec4(vColor, opacity) * texture2D(map, vUv);\n          // gl_FragColor.rgb *= 1.0 - (1.0 - (vNormal.y * 0.5 + 0.5)) * 0.25;\n          // gl_FragColor.rgb += (1.0 - (vNormal.y * 0.5 + 0.5)) * 1.0 * (1.0 - vStraighten);\n          float grad = (1.0 - (vNormal.y * 0.5 + 0.5));\n          gl_FragColor.rgb += (1.0 - vStraighten) * 0.25 + grad * 0.5;\n          if (!gl_FrontFacing) gl_FragColor.rgb *= 0.5;\n\n          // gl_FragColor = vec4(vec3((1.0-(vNormal.y * 0.5 + 0.5))), 1.0);\n          // gl_FragColor = vec4(vec3(vNormal.y * 0.5 + 0.5), 1.0);\n          if (gl_FragColor.a < 0.5) discard;\n        }\n      "}))}({minY:.1,spriteRadius:.1,map:g,time:0,timeOffset:0,side:a.DoubleSide}),I=new a.Mesh(C,V);b.add(I),b.name="origin-tree-leaves",I.frustumCulled=!1;var j=15*Math.PI*15/1e4;const Y=new a.Vector3(1,1,1),D=e.entity();D.add(n.Object3D,b);const Q=e.entity();let B=0;return function(t){if(!e.findTag(n.AppState).ready)return;const a=e.findTag(n.CameraStopUserMovement);let i=!1;Q.has(n.UserHitAudioTrigger)&&(i=!0,(S+=t)>=x&&(i=!1,S%=x,x=A(),Q.remove(n.UserHitAudioTrigger)));const l=e.findTag(n.UserCharacter),u=e.findTag(n.UserTarget),m=l.position,f=l.velocity,p=f.lengthSq(),d=Math.sqrt(p),g=u.position.length(),h=1-r.clamp01(r.smoothstep(40,45,g));let w=!0;g>=45?(D.has(n.Object3D)&&D.remove(n.Object3D),w=!1):D.has(n.Object3D)||D.add(n.Object3D,b);let R=0;e.findTag(n.FinalBiomeResolution)?(B+=t,V.uniforms.fadeAway.value=-2+B):V.uniforms.fadeAway.value=0;for(let e=0;w&&e<P.length;e++){const n=P[e].body;if(!a&&p>1e-6){const t=n.position.distanceToSquared(m);if(t<=4){d>.05&&!i&&R++;const e=Math.sqrt(t);r.clamp01(e/2);n.velocity.x+=f.x*Y.x,n.velocity.z+=f.z*Y.z,n.position.y-.1<=.100001&&(n.position.y=.200001);const a=1-r.clamp01(r.inverseLerp(.1,1,n.position.y-.1));n.velocity.y+=o.range(0,1)*Y.y*d*a,s.fromArray(o.insideSphere(1,v)),n.velocity.addScaledVector(s,o.range(.5,1))}}n.velocity.x=r.clamp(n.velocity.x,-4,4),n.velocity.y=r.clamp(n.velocity.y,-4,4),n.velocity.z=r.clamp(n.velocity.z,-4,4);let l=!1;if(n.position.y-.1<.1&&(l=!0,n.position.y=.200001),l){const t=n.velocity.lengthSq();if(t>1e-6){const e=Math.sqrt(t);c.set(1,-1,1);const o=.25;c.multiplyScalar(e*o),0!==e&&n.velocity.divideScalar(e),n.velocity.multiply(c)}}var C=n.velocity.x,M=n.velocity.y,N=n.velocity.z,T=-.235*j*1.22*C*C*C/Math.abs(C),F=-.235*j*1.22*M*M*M/Math.abs(M),O=-.235*j*1.22*N*N*N/Math.abs(N),H=(T=isNaN(T)?0:T)/.05,L=(F=isNaN(F)?0:F)/.05,E=(O=isNaN(O)?0:O)/.05;L+=.1*-9.81,n.velocity.x+=H*t,n.velocity.y+=L*t,n.velocity.z+=E*t;const u=n.speed;n.position.x+=n.velocity.x*t*u,n.position.y+=n.velocity.y*t*u,n.position.z+=n.velocity.z*t*u;const g=r.clamp(n.velocity.length()/.1,0,7.5),h=1-r.clamp01(r.inverseLerp(.1,.5,n.position.y-.1));y.setFromAxisAngle(n.rotationAxis,g*n.rotationSpeed*t),n.spinRotation.premultiply(y),n.spinRotation.slerp(n.flatRotation,.5*h),n.currentRotation.copy(n.spinRotation),q[3*e+0]=n.position.x,q[3*e+1]=n.position.y,q[3*e+2]=n.position.z,z[4*e+0]=n.currentRotation.x,z[4*e+1]=n.currentRotation.y,z[4*e+2]=n.currentRotation.z,z[4*e+3]=n.currentRotation.w}if(w&&(U.needsUpdate=!0,_.needsUpdate=!0,V.uniforms.time.value+=t,V.uniforms.globalScale.value=h),I.visible=w,R>5&&(i=!0,!Q.has(n.UserHitAudioTrigger))){Q.add(n.UserHitAudioTrigger),Q.get(n.UserHitAudioTrigger).type="leaf"}}}
},{"../tags":60,"three":74,"../util/math":240,"../util/Random":235,"../util/Assets":31,"../util/ShaderManager":243,"../util/array":139,"../util/query-string":30,"../util/resetPlayerPos":132}],255:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},t=require("svelte/internal"),n=require("svelte"),i=require("svelte/store"),a=require("../nfb"),o=require("../animations/transitions"),r=require("../components/AnimatedTextSpan.svelte"),s=v(r),d=require("../util/locale"),l=require("../components/ImageButton.svelte"),u=v(l),c=require("../util/globalIntroVideo"),p=require("../util/objectFit"),_=v(p);function v(e){return e&&e.__esModule?e:{default:e}}const{window:m}=t.globals;function f(e){let n,i,a,r,s,d=e[5][e[1][0].key]+"";return{c(){n=(0,t.element)("div"),i=(0,t.text)(d),(0,t.attr)(n,"class","text-container svelte-qit7e6")},m(e,a){(0,t.insert)(e,n,a),(0,t.append)(n,i),s=!0},p(e,n){(!s||34&n)&&d!==(d=e[5][e[1][0].key]+"")&&(0,t.set_data)(i,d)},i(e){s||((0,t.add_render_callback)(()=>{r&&r.end(1),a||(a=(0,t.create_in_transition)(n,o.fadeInTransition,{duration:1e3,delay:0})),a.start()}),s=!0)},o(e){a&&a.invalidate(),r=(0,t.create_out_transition)(n,o.fadeInTransition,{duration:1e3,delay:0}),s=!1},d(e){e&&(0,t.detach)(n),e&&r&&r.end()}}}function y(e){let n,i,a,r,s,d=e[5][e[1][1].key]+"";return{c(){n=(0,t.element)("div"),i=(0,t.text)(d),(0,t.attr)(n,"class","text-container svelte-qit7e6")},m(e,a){(0,t.insert)(e,n,a),(0,t.append)(n,i),s=!0},p(e,n){(!s||34&n)&&d!==(d=e[5][e[1][1].key]+"")&&(0,t.set_data)(i,d)},i(e){s||((0,t.add_render_callback)(()=>{r&&r.end(1),a||(a=(0,t.create_in_transition)(n,o.fadeInTransition,{duration:1e3,delay:0})),a.start()}),s=!0)},o(e){a&&a.invalidate(),r=(0,t.create_out_transition)(n,o.fadeInTransition,{duration:1e3,delay:0}),s=!1},d(e){e&&(0,t.detach)(n),e&&r&&r.end()}}}function h(e){let n,i,a,r,s,d=e[5][e[1][2].key]+"";return{c(){n=(0,t.element)("div"),i=(0,t.text)(d),(0,t.attr)(n,"class","text-container svelte-qit7e6")},m(e,a){(0,t.insert)(e,n,a),(0,t.append)(n,i),s=!0},p(e,n){(!s||34&n)&&d!==(d=e[5][e[1][2].key]+"")&&(0,t.set_data)(i,d)},i(e){s||((0,t.add_render_callback)(()=>{r&&r.end(1),a||(a=(0,t.create_in_transition)(n,o.fadeInTransition,{duration:1e3,delay:0})),a.start()}),s=!0)},o(e){a&&a.invalidate(),r=(0,t.create_out_transition)(n,o.fadeInTransition,{duration:1e3,delay:0}),s=!1},d(e){e&&(0,t.detach)(n),e&&r&&r.end()}}}function b(e){let n,i;return{c(){n=(0,t.element)("div"),(0,t.attr)(n,"class","white-overlay svelte-qit7e6")},m(e,i){(0,t.insert)(e,n,i)},i(e){i||(0,t.add_render_callback)(()=>{(i=(0,t.create_in_transition)(n,o.fadeInTransition,{opacity:0,delay:0,duration:500,y:0})).start()})},o:t.noop,d(e){e&&(0,t.detach)(n)}}}function g(e){let n,i,a,r,s,d,l,c,p,_,v,g,k,q,T,x,w,$=e[1][0].visible&&f(e),I=e[1][1].visible&&y(e),V=e[1][2].visible&&h(e);(g=new u.default({props:{inTransition:(0,o.transition)(o.fadeInTransition,{delay:2500}),mode:"normal_small",text:e[5].skipButton}})).$on("click",e[13]);let O=e[2]&&b(e);return{c(){n=(0,t.element)("div"),i=(0,t.element)("div"),r=(0,t.space)(),s=(0,t.element)("div"),l=(0,t.space)(),$&&$.c(),c=(0,t.space)(),I&&I.c(),p=(0,t.space)(),V&&V.c(),_=(0,t.space)(),v=(0,t.element)("div"),(0,t.create_component)(g.$$.fragment),k=(0,t.space)(),O&&O.c(),(0,t.attr)(i,"class","black-overlay svelte-qit7e6"),(0,t.attr)(s,"class","intro-video-container svelte-qit7e6"),(0,t.attr)(v,"class","button-container svelte-qit7e6"),(0,t.attr)(n,"class","intro svelte-qit7e6")},m(a,o){(0,t.insert)(a,n,o),(0,t.append)(n,i),e[10](i),(0,t.append)(n,r),(0,t.append)(n,s),e[12](s),(0,t.append)(n,l),$&&$.m(n,null),(0,t.append)(n,c),I&&I.m(n,null),(0,t.append)(n,p),V&&V.m(n,null),(0,t.append)(n,_),(0,t.append)(n,v),(0,t.mount_component)(g,v,null),(0,t.append)(n,k),O&&O.m(n,null),T=!0,x||(w=[(0,t.listen)(m,"resize",e[6],{passive:!0}),(0,t.listen)(i,"introend",e[11]),(0,t.listen)(n,"outrostart",e[14]),(0,t.listen)(n,"outroend",e[15])],x=!0)},p(e,[i]){e[1][0].visible?$?($.p(e,i),2&i&&(0,t.transition_in)($,1)):(($=f(e)).c(),(0,t.transition_in)($,1),$.m(n,c)):$&&((0,t.group_outros)(),(0,t.transition_out)($,1,1,()=>{$=null}),(0,t.check_outros)()),e[1][1].visible?I?(I.p(e,i),2&i&&(0,t.transition_in)(I,1)):((I=y(e)).c(),(0,t.transition_in)(I,1),I.m(n,p)):I&&((0,t.group_outros)(),(0,t.transition_out)(I,1,1,()=>{I=null}),(0,t.check_outros)()),e[1][2].visible?V?(V.p(e,i),2&i&&(0,t.transition_in)(V,1)):((V=h(e)).c(),(0,t.transition_in)(V,1),V.m(n,_)):V&&((0,t.group_outros)(),(0,t.transition_out)(V,1,1,()=>{V=null}),(0,t.check_outros)());const a={};32&i&&(a.text=e[5].skipButton),g.$set(a),e[2]?O?4&i&&(0,t.transition_in)(O,1):((O=b(e)).c(),(0,t.transition_in)(O,1),O.m(n,null)):O&&(O.d(1),O=null)},i(e){T||(a||(0,t.add_render_callback)(()=>{(a=(0,t.create_in_transition)(i,o.fadeInTransition,{delay:0,duration:1e3,y:0})).start()}),d||(0,t.add_render_callback)(()=>{(d=(0,t.create_in_transition)(s,o.fadeOpacityTransition,{delay:1e3,duration:500})).start()}),(0,t.transition_in)($),(0,t.transition_in)(I),(0,t.transition_in)(V),(0,t.transition_in)(g.$$.fragment,e),(0,t.transition_in)(O),q&&q.end(1),T=!0)},o(e){(0,t.transition_out)($),(0,t.transition_out)(I),(0,t.transition_out)(V),(0,t.transition_out)(g.$$.fragment,e),q=(0,t.create_out_transition)(n,o.fadeOpacityTransition,{delay:1250,duration:1500}),T=!1},d(i){i&&(0,t.detach)(n),e[10](null),e[12](null),$&&$.d(),I&&I.d(),V&&V.d(),(0,t.destroy_component)(g),O&&O.d(),i&&q&&q.end(),x=!1,(0,t.run_all)(w)}}}let k=!1,q=0;function T(e){console.log("kill",e)}function x(i,o,r){let s;(0,t.component_subscribe)(i,d.localize,e=>r(5,s=e));let{store:l}=o,{delay:u=0}=o,{duration:p=33}=o;/(Android|iOS|iPad|iPod|iPhone)/i.test(navigator.userAgent);let v,m,f,y,h=[{visible:!1,key:"introVideoLine0",timestamp:2e3,delay:0,duration:4250},{visible:!1,key:"introVideoLine1",timestamp:14e3,duration:4500,delay:0},{visible:!1,key:"introVideoLine2",timestamp:23e3,duration:5e3,delay:0}],b=!1,g=l.subscribe(e=>{m=e.visible});function k(){window.innerWidth,window.innerHeight;const e=(0,c.hasVideo)()?(0,c.getVideo)():null;if(e){const[t,n,i,a]=(0,_.default)({parentWidth:window.innerWidth,parentHeight:window.innerHeight,childWidth:e.videoWidth,childHeight:e.videoHeight,fit:"cover"});Object.assign(e.style,{left:`${t}px`,top:`${n}px`,width:`${i}px`,height:`${a}px`})}}function q(){r(2,b=!0),(0,c.pauseVideo)(),clearTimeout(f),l.update(t=>e({},t,{visible:!1}))}h.forEach((e,t)=>{setTimeout(()=>{r(1,h[t].visible=!0,h),r(1,h),setTimeout(()=>{r(1,h[t].visible=!1,h),r(1,h)},e.duration)},e.timestamp)}),(0,n.onMount)(()=>{if(v){const e=(0,c.getVideo)();v.appendChild(e),e.style.visibility="",(0,c.getMetadata)().then(()=>{k()})}return f=setTimeout(()=>{(0,a.sendAnalytics)({event:"intro_finish",eventLabel:"finish"}),q()},1e3*p),()=>{g(),(0,c.unmountVideo)(),clearTimeout(void 0),clearTimeout(f)}});return i.$$set=(e=>{"store"in e&&r(0,l=e.store),"delay"in e&&r(8,u=e.delay),"duration"in e&&r(9,p=e.duration)}),[l,h,b,v,y,s,function(){if(!(0,c.hasVideo)())return;(0,c.getVideo)().readyState<=0?(0,c.getMetadata)().then(()=>k()):k()},q,u,p,function(e){t.binding_callbacks[e?"unshift":"push"](()=>{r(4,y=e)})},()=>l.update(t=>e({},t,{covering:!0})),function(e){t.binding_callbacks[e?"unshift":"push"](()=>{r(3,v=e)})},()=>{(0,a.sendAnalytics)({event:"intro_skip",eventLabel:"skip"}),q()},()=>l.update(t=>e({},t,{covering:!1})),()=>l.update(t=>e({},t,{finished:!0}))]}class w extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,x,g,t.safe_not_equal,{store:0,delay:8,duration:9})}}exports.default=w;
},{"svelte/internal":226,"svelte":220,"svelte/store":310,"../nfb":75,"../animations/transitions":689,"../components/AnimatedTextSpan.svelte":688,"../util/locale":227,"../components/ImageButton.svelte":739,"../util/globalIntroVideo":131,"../util/objectFit":740}],126:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};exports.default=I;var t=require("../tags"),r=M(t),n=require("three"),a=M(n),i=require("../util/math"),o=M(i),s=require("../util/Random"),u=b(s),g=require("../util/Assets"),l=b(g),d=require("../util/ShaderManager"),f=M(d),O=require("../util/array"),c=require("../util/query-string"),v=b(c),p=require("../util/resetPlayerPos"),m=b(p),y=require("../overlays/OriginTreeIntroOverlay.svelte"),S=b(y),q=require("./AnimationSystem"),h=require("svelte/store"),C=require("../nfb");function b(e){return e&&e.__esModule?e:{default:e}}function M(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function I(t){const n=t.entity(),a=t.listen(r.GameStarted);if(v.default.nointroseq||v.default.nolanding)n.tagOn(r.CanSetIntroTags);else{const e=t.findEntity(r.ActiveEnvironmentState);if(e){const n=e.get(r.EnvironmentState);(0,p.setPlayerPos)(t,n.idleViewPoint)}n.add(r.OriginTreeIntroSequence),n.add(r.GameLandingCameraDrift),n.tagOn(r.CameraZoomOut),n.tagOn(r.HideCharacter),n.tagOn(r.LetterboxBars),n.tagOn(r.HideHUD),n.tagOn(r.BlockUserMove),n.tagOn(r.CameraStopUserMovement),n.tagOn(r.ModalStoppingUserMovement),n.tagOn(r.ClearInputPress)}t.view(r.ScreenFade);const i=(0,h.writable)({finished:!1,covering:!1,visible:!1}),o=t.findTag(r.AppState);i.subscribe(e=>{e.covering?o.running=!1:o.running=!0,!e.visible&&n.has(r.ViewLayer)&&(n.remove(r.ViewLayer),o.running=!0,n.tagOn(r.CanSetIntroTags),n.tagOff(r.HideHUD),n.tagOff(r.OriginTreeIntroSequence),n.tagOff(r.CameraStopUserMovement),n.tagOff(r.OriginTreeIntroSequenceStarted),n.tagOff(r.GameLandingCameraDrift),n.tagOn(r.ClearInputPress)),e.finished&&(n.tagOff(r.HideCharacter),n.tagOff(r.CameraZoomOut),n.tagOff(r.LetterboxBars),n.tagOff(r.BlockUserMove),n.tagOff(r.CameraStopUserMovement),n.tagOff(r.ModalStoppingUserMovement),n.tagOn(r.ClearInputPress),n.tagOn(r.AnimateInCharacter),(0,C.sendAnalytics)({event:"playing",eventLabel:"playing"}))});return function(o){t.findTag(r.CameraStopUserMovement);t.findTag(r.AppState).ready&&n.has(r.OriginTreeIntroSequence)&&a.changed&&a.added.length>0&&((0,C.hideHeader)(),n.add(r.OriginTreeIntroSequenceStarted),n.add(r.ViewLayer,{component:S.default,id:"origin-tree-intro-overlay",props:{delay:1250,store:i}}),i.update(t=>e({},t,{visible:!0})))}}
},{"../tags":60,"three":74,"../util/math":240,"../util/Random":235,"../util/Assets":31,"../util/ShaderManager":243,"../util/array":139,"../util/query-string":30,"../util/resetPlayerPos":132,"../overlays/OriginTreeIntroOverlay.svelte":255,"./AnimationSystem":108,"svelte/store":310,"../nfb":75}],127:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=p;var e=require("../tags"),t=O(e),r=require("three"),i=O(r),o=require("../util/resetPlayerPos"),a=T(o),n=require("./AnimationSystem"),l=require("./writing/Line3D"),u=T(l),s=require("../util/locale"),d=require("../util/Assets"),g=T(d),f=require("../util/query-string"),c=T(f);function T(e){return e&&e.__esModule?e:{default:e}}function O(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function p(e){const r=e.entity();/(iOS|Android|iPhone|iPad)/i.test(navigator.userAgent);let o=!1,a=!1,n=!1;let l=0,u=!1,d=!1,g=!1;const f=new i.Vector3,T=e.view(t.TutorialMessage),O=e.listen(t.FinishedPoem);e.listen(t.DirectUserToOrigin),e.listen(t.HaikuCardSaved);const p=(r={})=>e.entity().add(t.TutorialMessage,r);return c.default.resolve&&(g=!0),i=>{const m=e.findTag(t.UserTarget),q=m.position,y=e.findTag(t.CanSetIntroTags);!a&&y&&(a=!0,e.findTag(t.UserTarget).position.set(0,0,0),r.tagOn(t.BlockTokenCollection),r.tagOn(t.TutorialState),r.tagOn(t.CameraZoomOut),r.tagOn(t.TutorialBarrenGround),r.tagOn(t.ClearInputPress));const v=e.findTag(t.GameStarted)&&y&&!e.findTag(t.OriginTreeIntroSequence);if(!o&&v&&(o=!0,n=!0),n&&(l+=i)>=2&&(l=0,n=!1,u=!0,g||p({id:"tap-to-move",message:s.localize.get().tutorialTapHold,iconMode:"finger",delay:1})),u&&m.forceApplied&&(r.tagOff(t.CameraZoomOut),u=!1,d=!0),d){(m.position.lengthSq()>=100||c.default.resolve)&&(d=!1,r.tagOff(t.TutorialBarrenGround),r.tagOff(t.TutorialState),r.tagOff(t.BlockTokenCollection),f.copy(q),g||p({id:"find-token",message:s.localize.get().tutorialCollect,iconMode:"token-random",delay:3,duration:6}))}O.changed&&(g=!0,T.forEach(e=>e.kill()))}}
},{"../tags":60,"three":74,"../util/resetPlayerPos":132,"./AnimationSystem":108,"./writing/Line3D":267,"../util/locale":227,"../util/Assets":31,"../util/query-string":30}],256:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),t=require("eases"),i=n(t),a=require("svelte/transition");function n(e){return e&&e.__esModule?e:{default:e}}function r(t){let i,n,r,s,l,d;return{c(){i=(0,e.element)("div"),r=(0,e.space)(),s=(0,e.element)("div"),(0,e.attr)(i,"class","letterbox top svelte-1ui17ha"),(0,e.set_style)(i,"height",t[2]+"px"),(0,e.attr)(s,"class","letterbox bottom svelte-1ui17ha"),(0,e.set_style)(s,"height",t[2]+"px")},m(t,a){(0,e.insert)(t,i,a),(0,e.insert)(t,r,a),(0,e.insert)(t,s,a),d=!0},p(a,[n]){t=a,(!d||4&n)&&(0,e.set_style)(i,"height",t[2]+"px"),(!d||4&n)&&(0,e.set_style)(s,"height",t[2]+"px")},i(r){d||((0,e.add_render_callback)(()=>{n||(n=(0,e.create_bidirectional_transition)(i,a.fly,{delay:t[1],easing:t[3],duration:t[0],y:-t[2],opacity:1},!0)),n.run(1)}),(0,e.add_render_callback)(()=>{l||(l=(0,e.create_bidirectional_transition)(s,a.fly,{delay:t[1],easing:t[3],duration:t[0],y:t[2],opacity:1},!0)),l.run(1)}),d=!0)},o(r){n||(n=(0,e.create_bidirectional_transition)(i,a.fly,{delay:t[1],easing:t[3],duration:t[0],y:-t[2],opacity:1},!1)),n.run(0),l||(l=(0,e.create_bidirectional_transition)(s,a.fly,{delay:t[1],easing:t[3],duration:t[0],y:t[2],opacity:1},!1)),l.run(0),d=!1},d(t){t&&(0,e.detach)(i),t&&n&&n.end(),t&&(0,e.detach)(r),t&&(0,e.detach)(s),t&&l&&l.end()}}}function s(e,t,a){let{duration:n=1e3}=t,{delay:r=0}=t,{height:s=12.5}=t,{easing:l=i.default.quartOut}=t;return e.$$set=(e=>{"duration"in e&&a(0,n=e.duration),"delay"in e&&a(1,r=e.delay),"height"in e&&a(2,s=e.height),"easing"in e&&a(3,l=e.easing)}),[n,r,s,l]}class l extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,s,r,e.safe_not_equal,{duration:0,delay:1,height:2,easing:3})}}exports.default=l;
},{"svelte/internal":226,"eases":291,"svelte/transition":687}],128:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=s;var e=require("../tags"),r=i(e),t=require("three"),a=i(t),o=require("../overlays/LetterboxBarsOverlay.svelte"),u=n(o);function n(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function s(e){const t=e.entity(),a=e.view(r.LetterboxBars);return o=>{e.findTag(r.ShowBiomeResolution)?t.tagOn(r.LetterboxBars):t.tagOff(r.LetterboxBars),a.length>0?(t.tagOn(r.CameraZoomOut),t.has(r.ViewLayer)):(t.tagOff(r.CameraZoomOut),t.remove(r.ViewLayer))}}
},{"../tags":60,"three":74,"../overlays/LetterboxBarsOverlay.svelte":256}],129:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=s;var e=require("../tags"),t=u(e),n=require("three"),i=u(n),a=require("../util/water-util"),r=require("../util/Random"),o=l(r);function l(e){return e&&e.__esModule?e:{default:e}}function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function s(e){let n=0;const r={forest:["bird"],grasslands:["butterfly"],tundra:["jumpingrabbit"]},l=(0,o.default)(),u=()=>l.range(5,5);let s=u();const d=e.view(t.ActiveEnvironmentState),c=new i.Vector3,f=[0,0],p=(e.view(t.Animal),e.view(t.AnimalSpawn)),m=e.findTag(t.EnvironmentUnderPlayerState),g=e.findTag(t.UserTarget);let w=null;return o=>{const v=d.length?d[0].get(t.EnvironmentState):null,S=v&&v.name;if(!S||!r[S].length)return;let y=m.water;const b=e.findTag(t.GameLandingCameraDrift),T=!w||g.position.distanceToSquared(w)>=16;if(!y&&!b&&T&&(n+=o)>=s&&(n%=s,s=u(),w||(w=new i.Vector3),w.copy(g.position),!e.findTag(t.TutorialState))){let n,i=!1,o=!1;if(c.copy(g.position).addScaledVector(g.direction,25),f[0]=c.x,f[1]=c.z,i=!0,c.x*c.x+c.z*c.z<225&&(i=!1),i&&(0,a.insideWaterPolys)(v,f)&&(i=!1),i&&(n=l.pick(r[S])),i&&n){console.log("Spawning animals!",n,o);const i=e.entity();i.add(t.AnimalSpawn);const a=i.get(t.AnimalSpawn);a.position.copy(c),a.lake=o,a.biome=S,a.animal=n}}p.forEach(e=>{const n=e.get(t.AnimalSpawn);n.time+=o,n.time>=n.duration&&e.kill()})}}
},{"../tags":60,"three":74,"../util/water-util":249,"../util/Random":235}],293:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},e={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},t=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],r={CSS:{},springs:{}};function a(n,e,t){return Math.min(Math.max(n,e),t)}function u(n,e){return n.indexOf(e)>-1}function o(n,e){return n.apply(null,e)}var i={arr:function(n){return Array.isArray(n)},obj:function(n){return u(Object.prototype.toString.call(n),"Object")},pth:function(n){return i.obj(n)&&n.hasOwnProperty("totalLength")},svg:function(n){return n instanceof SVGElement},inp:function(n){return n instanceof HTMLInputElement},dom:function(n){return n.nodeType||i.svg(n)},str:function(n){return"string"==typeof n},fnc:function(n){return"function"==typeof n},und:function(n){return void 0===n},nil:function(n){return i.und(n)||null===n},hex:function(n){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n)},rgb:function(n){return/^rgb/.test(n)},hsl:function(n){return/^hsl/.test(n)},col:function(n){return i.hex(n)||i.rgb(n)||i.hsl(n)},key:function(t){return!n.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&"targets"!==t&&"keyframes"!==t}};function c(n){var e=/\(([^)]+)\)/.exec(n);return e?e[1].split(",").map(function(n){return parseFloat(n)}):[]}function s(n,e){var t=c(n),u=a(i.und(t[0])?1:t[0],.1,100),o=a(i.und(t[1])?100:t[1],.1,100),s=a(i.und(t[2])?10:t[2],.1,100),f=a(i.und(t[3])?0:t[3],.1,100),l=Math.sqrt(o/u),d=s/(2*Math.sqrt(o*u)),p=d<1?l*Math.sqrt(1-d*d):0,v=1,h=d<1?(d*l-f)/p:-f+l;function g(n){var t=e?e*n/1e3:n;return t=d<1?Math.exp(-t*d*l)*(v*Math.cos(p*t)+h*Math.sin(p*t)):(v+h*t)*Math.exp(-t*l),0===n||1===n?n:1-t}return e?g:function(){var e=r.springs[n];if(e)return e;for(var t=0,a=0;;)if(1===g(t+=1/6)){if(++a>=16)break}else a=0;var u=t*(1/6)*1e3;return r.springs[n]=u,u}}function f(n){return void 0===n&&(n=10),function(e){return Math.ceil(a(e,1e-6,1)*n)*(1/n)}}var l=function(){var n=11,e=1/(n-1);function t(n,e){return 1-3*e+3*n}function r(n,e){return 3*e-6*n}function a(n){return 3*n}function u(n,e,u){return((t(e,u)*n+r(e,u))*n+a(e))*n}function o(n,e,u){return 3*t(e,u)*n*n+2*r(e,u)*n+a(e)}return function(t,r,a,i){if(0<=t&&t<=1&&0<=a&&a<=1){var c=new Float32Array(n);if(t!==r||a!==i)for(var s=0;s<n;++s)c[s]=u(s*e,t,a);return function(n){return t===r&&a===i?n:0===n||1===n?n:u(f(n),r,i)}}function f(r){for(var i=0,s=1,f=n-1;s!==f&&c[s]<=r;++s)i+=e;var l=i+(r-c[--s])/(c[s+1]-c[s])*e,d=o(l,t,a);return d>=.001?function(n,e,t,r){for(var a=0;a<4;++a){var i=o(e,t,r);if(0===i)return e;e-=(u(e,t,r)-n)/i}return e}(r,l,t,a):0===d?l:function(n,e,t,r,a){var o,i,c=0;do{(o=u(i=e+(t-e)/2,r,a)-n)>0?t=i:e=i}while(Math.abs(o)>1e-7&&++c<10);return i}(r,i,i+e,t,a)}}}(),d=function(){var n={linear:function(){return function(n){return n}}},e={Sine:function(){return function(n){return 1-Math.cos(n*Math.PI/2)}},Circ:function(){return function(n){return 1-Math.sqrt(1-n*n)}},Back:function(){return function(n){return n*n*(3*n-2)}},Bounce:function(){return function(n){for(var e,t=4;n<((e=Math.pow(2,--t))-1)/11;);return 1/Math.pow(4,3-t)-7.5625*Math.pow((3*e-2)/22-n,2)}},Elastic:function(n,e){void 0===n&&(n=1),void 0===e&&(e=.5);var t=a(n,1,10),r=a(e,.1,2);return function(n){return 0===n||1===n?n:-t*Math.pow(2,10*(n-1))*Math.sin((n-1-r/(2*Math.PI)*Math.asin(1/t))*(2*Math.PI)/r)}}};return["Quad","Cubic","Quart","Quint","Expo"].forEach(function(n,t){e[n]=function(){return function(n){return Math.pow(n,t+2)}}}),Object.keys(e).forEach(function(t){var r=e[t];n["easeIn"+t]=r,n["easeOut"+t]=function(n,e){return function(t){return 1-r(n,e)(1-t)}},n["easeInOut"+t]=function(n,e){return function(t){return t<.5?r(n,e)(2*t)/2:1-r(n,e)(-2*t+2)/2}},n["easeOutIn"+t]=function(n,e){return function(t){return t<.5?(1-r(n,e)(1-2*t))/2:(r(n,e)(2*t-1)+1)/2}}}),n}();function p(n,e){if(i.fnc(n))return n;var t=n.split("(")[0],r=d[t],a=c(n);switch(t){case"spring":return s(n,e);case"cubicBezier":return o(l,a);case"steps":return o(f,a);default:return o(r,a)}}function v(n){try{return document.querySelectorAll(n)}catch(n){return}}function h(n,e){for(var t=n.length,r=arguments.length>=2?e:void 0,a=[],u=0;u<t;u++)if(u in n){var o=n[u];e.call(r,o,u,n)&&a.push(o)}return a}function g(n){return n.reduce(function(n,e){return n.concat(i.arr(e)?g(e):e)},[])}function m(n){return i.arr(n)?n:(i.str(n)&&(n=v(n)||n),n instanceof NodeList||n instanceof HTMLCollection?[].slice.call(n):[n])}function y(n,e){return n.some(function(n){return n===e})}function b(n){var e={};for(var t in n)e[t]=n[t];return e}function M(n,e){var t=b(n);for(var r in n)t[r]=e.hasOwnProperty(r)?e[r]:n[r];return t}function x(n,e){var t=b(n);for(var r in e)t[r]=i.und(n[r])?e[r]:n[r];return t}function w(n){var e=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(n);return e?"rgba("+e[1]+",1)":n}function O(n){var e=n.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(n,e,t,r){return e+e+t+t+r+r}),t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return"rgba("+parseInt(t[1],16)+","+parseInt(t[2],16)+","+parseInt(t[3],16)+",1)"}function k(n){var e,t,r,a=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(n)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(n),u=parseInt(a[1],10)/360,o=parseInt(a[2],10)/100,i=parseInt(a[3],10)/100,c=a[4]||1;function s(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+(e-n)*(2/3-t)*6:n}if(0==o)e=t=r=i;else{var f=i<.5?i*(1+o):i+o-i*o,l=2*i-f;e=s(l,f,u+1/3),t=s(l,f,u),r=s(l,f,u-1/3)}return"rgba("+255*e+","+255*t+","+255*r+","+c+")"}function P(n){return i.rgb(n)?w(n):i.hex(n)?O(n):i.hsl(n)?k(n):void 0}function C(n){var e=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(n);if(e)return e[1]}function I(n){return u(n,"translate")||"perspective"===n?"px":u(n,"rotate")||u(n,"skew")?"deg":void 0}function D(n,e){return i.fnc(n)?n(e.target,e.id,e.total):n}function B(n,e){return n.getAttribute(e)}function T(n,e,t){if(y([t,"deg","rad","turn"],C(e)))return e;var a=r.CSS[e+t];if(!i.und(a))return a;var u=document.createElement(n.tagName),o=n.parentNode&&n.parentNode!==document?n.parentNode:document.body;o.appendChild(u),u.style.position="absolute",u.style.width=100+t;var c=100/u.offsetWidth;o.removeChild(u);var s=c*parseFloat(e);return r.CSS[e+t]=s,s}function E(n,e,t){if(e in n.style){var r=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),a=n.style[e]||getComputedStyle(n).getPropertyValue(r)||"0";return t?T(n,a,t):a}}function F(n,e){return i.dom(n)&&!i.inp(n)&&(!i.nil(B(n,e))||i.svg(n)&&n[e])?"attribute":i.dom(n)&&y(t,e)?"transform":i.dom(n)&&"transform"!==e&&E(n,e)?"css":null!=n[e]?"object":void 0}function A(n){if(i.dom(n)){for(var e,t=n.style.transform||"",r=/(\w+)\(([^)]*)\)/g,a=new Map;e=r.exec(t);)a.set(e[1],e[2]);return a}}function N(n,e,t,r){var a=u(e,"scale")?1:0+I(e),o=A(n).get(e)||a;return t&&(t.transforms.list.set(e,o),t.transforms.last=e),r?T(n,o,r):o}function S(n,e,t,r){switch(F(n,e)){case"transform":return N(n,e,r,t);case"css":return E(n,e,t);case"attribute":return B(n,e);default:return n[e]||0}}function L(n,e){var t=/^(\*=|\+=|-=)/.exec(n);if(!t)return n;var r=C(n)||0,a=parseFloat(e),u=parseFloat(n.replace(t[0],""));switch(t[0][0]){case"+":return a+u+r;case"-":return a-u+r;case"*":return a*u+r}}function j(n,e){if(i.col(n))return P(n);if(/\s/g.test(n))return n;var t=C(n),r=t?n.substr(0,n.length-t.length):n;return e?r+e:r}function q(n,e){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function H(n){return 2*Math.PI*B(n,"r")}function V(n){return 2*B(n,"width")+2*B(n,"height")}function $(n){return q({x:B(n,"x1"),y:B(n,"y1")},{x:B(n,"x2"),y:B(n,"y2")})}function W(n){for(var e,t=n.points,r=0,a=0;a<t.numberOfItems;a++){var u=t.getItem(a);a>0&&(r+=q(e,u)),e=u}return r}function X(n){var e=n.points;return W(n)+q(e.getItem(e.numberOfItems-1),e.getItem(0))}function Y(n){if(n.getTotalLength)return n.getTotalLength();switch(n.tagName.toLowerCase()){case"circle":return H(n);case"rect":return V(n);case"line":return $(n);case"polyline":return W(n);case"polygon":return X(n)}}function Z(n){var e=Y(n);return n.setAttribute("stroke-dasharray",e),e}function _(n){for(var e=n.parentNode;i.svg(e)&&i.svg(e.parentNode);)e=e.parentNode;return e}function G(n,e){var t=e||{},r=t.el||_(n),a=r.getBoundingClientRect(),u=B(r,"viewBox"),o=a.width,i=a.height,c=t.viewBox||(u?u.split(" "):[0,0,o,i]);return{el:r,viewBox:c,x:c[0]/1,y:c[1]/1,w:o,h:i,vW:c[2],vH:c[3]}}function Q(n,e){var t=i.str(n)?v(n)[0]:n,r=e||100;return function(n){return{property:n,el:t,svg:G(t),totalLength:Y(t)*(r/100)}}}function z(n,e,t){function r(t){void 0===t&&(t=0);var r=e+t>=1?e+t:0;return n.el.getPointAtLength(r)}var a=G(n.el,n.svg),u=r(),o=r(-1),i=r(1),c=t?1:a.w/a.vW,s=t?1:a.h/a.vH;switch(n.property){case"x":return(u.x-a.x)*c;case"y":return(u.y-a.y)*s;case"angle":return 180*Math.atan2(i.y-o.y,i.x-o.x)/Math.PI}}function R(n,e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=j(i.pth(n)?n.totalLength:n,e)+"";return{original:r,numbers:r.match(t)?r.match(t).map(Number):[0],strings:i.str(n)||e?r.split(t):[]}}function J(n){return h(n?g(i.arr(n)?n.map(m):m(n)):[],function(n,e,t){return t.indexOf(n)===e})}function K(n){var e=J(n);return e.map(function(n,t){return{target:n,id:t,total:e.length,transforms:{list:A(n)}}})}function U(n,e){var t=b(e);if(/^spring/.test(t.easing)&&(t.duration=s(t.easing)),i.arr(n)){var r=n.length;2===r&&!i.obj(n[0])?n={value:n}:i.fnc(e.duration)||(t.duration=e.duration/r)}var a=i.arr(n)?n:[n];return a.map(function(n,t){var r=i.obj(n)&&!i.pth(n)?n:{value:n};return i.und(r.delay)&&(r.delay=t?0:e.delay),i.und(r.endDelay)&&(r.endDelay=t===a.length-1?e.endDelay:0),r}).map(function(n){return x(n,t)})}function nn(n){for(var e=h(g(n.map(function(n){return Object.keys(n)})),function(n){return i.key(n)}).reduce(function(n,e){return n.indexOf(e)<0&&n.push(e),n},[]),t={},r=function(r){var a=e[r];t[a]=n.map(function(n){var e={};for(var t in n)i.key(t)?t==a&&(e.value=n[t]):e[t]=n[t];return e})},a=0;a<e.length;a++)r(a);return t}function en(n,e){var t=[],r=e.keyframes;for(var a in r&&(e=x(nn(r),e)),e)i.key(a)&&t.push({name:a,tweens:U(e[a],n)});return t}function tn(n,e){var t={};for(var r in n){var a=D(n[r],e);i.arr(a)&&1===(a=a.map(function(n){return D(n,e)})).length&&(a=a[0]),t[r]=a}return t.duration=parseFloat(t.duration),t.delay=parseFloat(t.delay),t}function rn(n,e){var t;return n.tweens.map(function(r){var a=tn(r,e),u=a.value,o=i.arr(u)?u[1]:u,c=C(o),s=S(e.target,n.name,c,e),f=t?t.to.original:s,l=i.arr(u)?u[0]:f,d=C(l)||C(s),v=c||d;return i.und(o)&&(o=f),a.from=R(l,v),a.to=R(L(o,l),v),a.start=t?t.end:0,a.end=a.start+a.delay+a.duration+a.endDelay,a.easing=p(a.easing,a.duration),a.isPath=i.pth(u),a.isPathTargetInsideSVG=a.isPath&&i.svg(e.target),a.isColor=i.col(a.from.original),a.isColor&&(a.round=1),t=a,a})}var an={css:function(n,e,t){return n.style[e]=t},attribute:function(n,e,t){return n.setAttribute(e,t)},object:function(n,e,t){return n[e]=t},transform:function(n,e,t,r,a){if(r.list.set(e,t),e===r.last||a){var u="";r.list.forEach(function(n,e){u+=e+"("+n+") "}),n.style.transform=u}}};function un(n,e){K(n).forEach(function(n){for(var t in e){var r=D(e[t],n),a=n.target,u=C(r),o=S(a,t,u,n),i=L(j(r,u||C(o)),o),c=F(a,t);an[c](a,t,i,n.transforms,!0)}})}function on(n,e){var t=F(n.target,e.name);if(t){var r=rn(e,n),a=r[r.length-1];return{type:t,property:e.name,animatable:n,tweens:r,duration:a.end,delay:r[0].delay,endDelay:a.endDelay}}}function cn(n,e){return h(g(n.map(function(n){return e.map(function(e){return on(n,e)})})),function(n){return!i.und(n)})}function sn(n,e){var t=n.length,r=function(n){return n.timelineOffset?n.timelineOffset:0},a={};return a.duration=t?Math.max.apply(Math,n.map(function(n){return r(n)+n.duration})):e.duration,a.delay=t?Math.min.apply(Math,n.map(function(n){return r(n)+n.delay})):e.delay,a.endDelay=t?a.duration-Math.max.apply(Math,n.map(function(n){return r(n)+n.duration-n.endDelay})):e.endDelay,a}var fn=0;function ln(t){var r=M(n,t),a=M(e,t),u=en(a,t),o=K(t.targets),i=cn(o,u),c=sn(i,a),s=fn;return fn++,x(r,{id:s,children:[],animatables:o,animations:i,duration:c.duration,delay:c.delay,endDelay:c.endDelay})}var dn=[],pn=function(){var n;function e(t){for(var r=dn.length,a=0;a<r;){var u=dn[a];u.paused?(dn.splice(a,1),r--):(u.tick(t),a++)}n=a>0?requestAnimationFrame(e):void 0}return"undefined"!=typeof document&&document.addEventListener("visibilitychange",function(){hn.suspendWhenDocumentHidden&&(vn()?n=cancelAnimationFrame(n):(dn.forEach(function(n){return n._onDocumentVisibility()}),pn()))}),function(){n||vn()&&hn.suspendWhenDocumentHidden||!(dn.length>0)||(n=requestAnimationFrame(e))}}();function vn(){return!!document&&document.hidden}function hn(n){void 0===n&&(n={});var e,t=0,r=0,u=0,o=0,i=null;function c(n){var e=window.Promise&&new Promise(function(n){return i=n});return n.finished=e,e}var s=ln(n);c(s);function f(){var n=s.direction;"alternate"!==n&&(s.direction="normal"!==n?"normal":"reverse"),s.reversed=!s.reversed,e.forEach(function(n){return n.reversed=s.reversed})}function l(n){return s.reversed?s.duration-n:n}function d(){t=0,r=l(s.currentTime)*(1/hn.speed)}function p(n,e){e&&e.seek(n-e.timelineOffset)}function v(n){for(var e=0,t=s.animations,r=t.length;e<r;){var u=t[e],o=u.animatable,i=u.tweens,c=i.length-1,f=i[c];c&&(f=h(i,function(e){return n<e.end})[0]||f);for(var l=a(n-f.start-f.delay,0,f.duration)/f.duration,d=isNaN(l)?1:f.easing(l),p=f.to.strings,v=f.round,g=[],m=f.to.numbers.length,y=void 0,b=0;b<m;b++){var M=void 0,x=f.to.numbers[b],w=f.from.numbers[b]||0;M=f.isPath?z(f.value,d*x,f.isPathTargetInsideSVG):w+d*(x-w),v&&(f.isColor&&b>2||(M=Math.round(M*v)/v)),g.push(M)}var O=p.length;if(O){y=p[0];for(var k=0;k<O;k++){p[k];var P=p[k+1],C=g[k];isNaN(C)||(y+=P?C+P:C+" ")}}else y=g[0];an[u.type](o.target,u.property,y,o.transforms),u.currentValue=y,e++}}function g(n){s[n]&&!s.passThrough&&s[n](s)}function m(n){var d=s.duration,h=s.delay,m=d-s.endDelay,y=l(n);s.progress=a(y/d*100,0,100),s.reversePlayback=y<s.currentTime,e&&function(n){if(s.reversePlayback)for(var t=o;t--;)p(n,e[t]);else for(var r=0;r<o;r++)p(n,e[r])}(y),!s.began&&s.currentTime>0&&(s.began=!0,g("begin")),!s.loopBegan&&s.currentTime>0&&(s.loopBegan=!0,g("loopBegin")),y<=h&&0!==s.currentTime&&v(0),(y>=m&&s.currentTime!==d||!d)&&v(d),y>h&&y<m?(s.changeBegan||(s.changeBegan=!0,s.changeCompleted=!1,g("changeBegin")),g("change"),v(y)):s.changeBegan&&(s.changeCompleted=!0,s.changeBegan=!1,g("changeComplete")),s.currentTime=a(y,0,d),s.began&&g("update"),n>=d&&(r=0,s.remaining&&!0!==s.remaining&&s.remaining--,s.remaining?(t=u,g("loopComplete"),s.loopBegan=!1,"alternate"===s.direction&&f()):(s.paused=!0,s.completed||(s.completed=!0,g("loopComplete"),g("complete"),!s.passThrough&&"Promise"in window&&(i(),c(s)))))}return s.reset=function(){var n=s.direction;s.passThrough=!1,s.currentTime=0,s.progress=0,s.paused=!0,s.began=!1,s.loopBegan=!1,s.changeBegan=!1,s.completed=!1,s.changeCompleted=!1,s.reversePlayback=!1,s.reversed="reverse"===n,s.remaining=s.loop,e=s.children;for(var t=o=e.length;t--;)s.children[t].reset();(s.reversed&&!0!==s.loop||"alternate"===n&&1===s.loop)&&s.remaining++,v(s.reversed?s.duration:0)},s._onDocumentVisibility=d,s.set=function(n,e){return un(n,e),s},s.tick=function(n){u=n,t||(t=u),m((u+(r-t))*hn.speed)},s.seek=function(n){m(l(n))},s.pause=function(){s.paused=!0,d()},s.play=function(){s.paused&&(s.completed&&s.reset(),s.paused=!1,dn.push(s),d(),pn())},s.reverse=function(){f(),s.completed=!s.reversed,d()},s.restart=function(){s.reset(),s.play()},s.remove=function(n){mn(J(n),s)},s.reset(),s.autoplay&&s.play(),s}function gn(n,e){for(var t=e.length;t--;)y(n,e[t].animatable.target)&&e.splice(t,1)}function mn(n,e){var t=e.animations,r=e.children;gn(n,t);for(var a=r.length;a--;){var u=r[a],o=u.animations;gn(n,o),o.length||u.children.length||r.splice(a,1)}t.length||r.length||e.pause()}function yn(n){for(var e=J(n),t=dn.length;t--;){mn(e,dn[t])}}function bn(n,e){void 0===e&&(e={});var t=e.direction||"normal",r=e.easing?p(e.easing):null,a=e.grid,u=e.axis,o=e.from||0,c="first"===o,s="center"===o,f="last"===o,l=i.arr(n),d=l?parseFloat(n[0]):parseFloat(n),v=l?parseFloat(n[1]):0,h=C(l?n[1]:n)||0,g=e.start||0+(l?d:0),m=[],y=0;return function(n,e,i){if(c&&(o=0),s&&(o=(i-1)/2),f&&(o=i-1),!m.length){for(var p=0;p<i;p++){if(a){var b=s?(a[0]-1)/2:o%a[0],M=s?(a[1]-1)/2:Math.floor(o/a[0]),x=b-p%a[0],w=M-Math.floor(p/a[0]),O=Math.sqrt(x*x+w*w);"x"===u&&(O=-x),"y"===u&&(O=-w),m.push(O)}else m.push(Math.abs(o-p));y=Math.max.apply(Math,m)}r&&(m=m.map(function(n){return r(n/y)*y})),"reverse"===t&&(m=m.map(function(n){return u?n<0?-1*n:-n:Math.abs(y-n)}))}return g+(l?(v-d)/y:d)*(Math.round(100*m[e])/100)+h}}function Mn(n){void 0===n&&(n={});var t=hn(n);return t.duration=0,t.add=function(r,a){var u=dn.indexOf(t),o=t.children;function c(n){n.passThrough=!0}u>-1&&dn.splice(u,1);for(var s=0;s<o.length;s++)c(o[s]);var f=x(r,M(e,n));f.targets=f.targets||n.targets;var l=t.duration;f.autoplay=!1,f.direction=t.direction,f.timelineOffset=i.und(a)?l:L(a,l),c(t),t.seek(f.timelineOffset);var d=hn(f);c(d),o.push(d);var p=sn(o,n);return t.delay=p.delay,t.endDelay=p.endDelay,t.duration=p.duration,t.seek(0),t.reset(),t.autoplay&&t.play(),t},t}hn.version="3.2.1",hn.speed=1,hn.suspendWhenDocumentHidden=!0,hn.running=dn,hn.remove=yn,hn.get=S,hn.set=un,hn.convertPx=T,hn.path=Q,hn.setDashoffset=Z,hn.stagger=bn,hn.timeline=Mn,hn.easing=p,hn.penner=d,hn.random=function(n,e){return Math.floor(Math.random()*(e-n+1))+n},exports.default=hn;
},{}],277:[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/coins.bbd025f5.jpg";
},{}],130:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=R;var e=require("simplex-noise"),a=P(e),t=require("animejs"),n=P(t),i=require("../tags"),r=A(i),o=require("three"),l=A(o),s=require("../util/resetPlayerPos"),u=P(s),c=require("./AnimationSystem"),d=require("./writing/Line3D"),f=P(d),g=require("../util/locale"),p=require("../util/Assets"),y=P(p),m=require("../util/query-string"),S=P(m),v=require("../assets/textures/coins.jpg"),h=P(v),w=require("../assets/gltf/coin.gltf"),I=P(w),O=require("../util/GLTFLoader"),M=require("../util/ShaderManager"),G=A(M),q=require("../util/Random"),D=P(q),k=require("canvas-sketch-util/math");function A(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t]);return a.default=e,a}function P(e){return e&&e.__esModule?e:{default:e}}const b=()=>{},x=new o.TextureLoader,T=new l.PlaneBufferGeometry(2,2),F=(0,D.default)(),_=new a.default(F.value),E=G.create({name:"coinShader",uniforms:{uTime:{value:0},tMap:{value:new l.Texture},uOffset:{value:new l.Vector2},uGlowIntensity:{value:1}},vertexShader:"\n    attribute vec2 aOffset;\n    attribute float aGlowDelay;\n\n    uniform float uTime;\n    \n    varying vec2 vUv;\n    varying vec2 vOffset;\n    varying float vGlowDelay;\n    \n    void main() {\n      \n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n      \n      vUv = uv;\n      vOffset = aOffset;\n      vGlowDelay = aGlowDelay;\n    }\n  ",fragmentShader:"\n    uniform sampler2D tMap;\n    uniform float uGlowIntensity;\n    varying float vGlowDelay;\n\n    varying vec2 vUv;\n    varying vec2 vOffset;\n\n    void main() {\n\n      vec2 uv = vec2(vUv.x, 1. - vUv.y);\n      uv *= .5;\n\n      uv += vOffset;\n      float glow = uGlowIntensity - vGlowDelay;\n      glow = clamp(glow, 1., 3.);\n      vec3 color = texture2D(tMap, uv).rgb * glow;\n\n      gl_FragColor = vec4(color, 1.);\n    }\n  "}),U=G.create({name:"coinShader",uniforms:{uOpacity:{value:0}},transparent:!0,depthTest:!1,depthWrite:!1,vertexShader:"\n    void main() {\n      gl_Position = vec4( position, 1.0 );\n    }\n  ",fragmentShader:"\n    uniform float uOpacity;\n    void main() {\n      gl_FragColor = vec4(1., 1.0, 1.0, uOpacity);\n    }\n  "});function L(e){return new Promise((a,t)=>{x.load(e,e=>{a(e)},b,e=>{t(e)})})}const j={yOffset:0,magicalEffect:0,capeSpeed:.2,glowIntensity:1,glowIntensity2:1,coinScl:.001,coinGlow:1,shakeSpeed:.5,flash:0,coinSpinSpeed:1,coinAngularSpeed:.1,camDistance:15,camShake:0,camShakeSpeed:1};function R(e){let a=!1,t=0,i=0,o=!1,s=!1,u=!1;const c=new l.Group;c.name="coins",e.entity().add(r.Object3D,c);let d=null;const f=e.findTag(r.UserCharacter),g=e.findTag(r.UserZoom),p=e.findTag(r.UserFollow),y=e.listen(r.FinalBiomeResolution);let m=new l.Vector3;const S=new l.LoadingManager,v=new O.GLTFLoader(S),w=[];let M=null;return v.load(I.default,function(e){d=e.scene.children[0].geometry,function(){const e=2*Math.PI/3;let a=0;for(let t=0;t<3;t++){const n=t%2,i=1-Math.floor(t/2),r=d.clone(),o=new Float32Array(2*r.attributes.position.count),s=new Float32Array(r.attributes.position.count);for(let e=0;e<o.length;e+=2)o[e]=.5*n,o[e+1]=.5*i;for(let e=0;e<s.length;e++)s[e]=2*t;r.setAttribute("aOffset",new l.BufferAttribute(o,2)),r.setAttribute("aGlowDelay",new l.BufferAttribute(s,1));const u=new l.Mesh(r,E);u.scale.setScalar(.5),a+=e,u.position.x=2*Math.cos(a),u.position.z=2*Math.sin(a),c.add(u),u.rotateX(2*Math.PI*F.range(0,1)),u.rotateY(2*Math.PI*F.range(0,1)),u.rotateZ(2*Math.PI*F.range(0,1)),u.time=F.range(0,3),u.scaleDelay=.5*t,u.angularPos=a,u.angularSpeed=1,u.radius=F.range(5,6),w.push(u)}}(),(M=new l.Mesh(T,U)).frustumCulled=!1,M.renderOrder=1e10,c.add(M),a=!0}),n=>{if(!a)return;t+=n,o&&(i+=n);e.findTag(r.UserCharacter);w.forEach((e,a)=>{e.rotateX(.015*j.coinSpinSpeed),e.rotateY(.015*j.coinSpinSpeed),e.rotateZ(.015*j.coinSpinSpeed);let t=j.coinScl-e.scaleDelay;t=(0,k.clamp)(t,.001,.5),e.scale.setScalar(t),e.time+=2*n;const i=(0,k.mapRange)(j.coinAngularSpeed,1,20,.7,.1);e.position.y=3+1.5*a+Math.cos(e.time)*i,e.angularPos+=n*e.angularSpeed*j.coinAngularSpeed,e.position.x=m.x+Math.cos(e.angularPos)*(e.radius-(0,k.mapRange)(j.coinAngularSpeed,1,20,0,1)),e.position.z=m.z-.5+Math.sin(e.angularPos)*(e.radius-(0,k.mapRange)(j.coinAngularSpeed,1,20,0,1)),e.material.uniforms.uGlowIntensity.value=j.coinGlow}),M.material.uniforms.uOpacity.value=j.flash,M.material.uniforms.uOpacity.value=j.flash,i>9.7&&!s&&(s=!0,e.entity().add(r.FlashSound,"flash-build-up")),i>12.4&&!u&&(u=!0,e.entity().add(r.FinalBiomeResolutionLines)),y.added.forEach(a=>{o=!0;const t=e.view([r.SpriteAnimation,r.SpriteAnimationOriginTreeTag]);m=t[0].get(r.Object3D).position,L(h.default).then(e=>{w.forEach((a,t)=>{a.material.uniforms.tMap.value=e})}),G()})};function G(){(0,n.default)({targets:j,magicalEffect:10,capeSpeed:2,duration:1e3,delay:0,easing:"easeInQuart",update:function(){f.magicalEffect=j.magicalEffect,f.capeSpeed=j.capeSpeed}}),(0,n.default)({targets:j,glowIntensity:20,duration:6e3,delay:0,easing:"easeInOutSine",update:function(){f.glowIntensity=j.glowIntensity}}),(0,n.default)({targets:j,yOffset:3,duration:5e3,delay:3e3,easing:"easeInOutSine",update:function(){f.yOffset=j.yOffset}}),(0,n.default)({targets:j,coinScl:1.5,duration:1300,delay:7e3,easing:"easeOutSine"}),(0,n.default)({targets:j,coinGlow:80,duration:6e3,delay:9500,easing:"easeInSine",complete:()=>{}}),(0,n.default)({targets:j,coinSpinSpeed:10,duration:4500,delay:8e3,easing:"easeInSine"}),(0,n.default)({targets:j,coinAngularSpeed:20,duration:4e3,delay:9e3,easing:"easeInQuart"}),(0,n.default)({targets:j,glowIntensity2:2,duration:2e3,delay:12e3,easing:"easeInSine",update:function(){f.glowIntensity2=j.glowIntensity2},complete:()=>{j.glowIntensity2=1,f.glowIntensity2=j.glowIntensity2,p.shake=0,p.shakeSpeed=1}}),(0,n.default)({targets:j,flash:1,duration:500,delay:12800,easing:"easeOutSine",update:()=>{f.glowIntensity-=1.5*j.flash,f.magicalEffect-=.5*j.flash},complete:()=>{w.forEach(e=>{e.visible=!1}),e.pause(),a.pause(),t.pause(),j.capeSpeed=.2,j.glowIntensity2=1,f.glowIntensity2=j.glowIntensity2,p.shake=0,p.shakeSpeed=0,g.distance=15,(0,n.default)({targets:j,flash:0,duration:3e3,delay:1500,easing:"easeOutSine"})}});const e=(0,n.default)({targets:j,camDistance:12,duration:9e3,delay:5e3,easing:"easeInOutSine",update:function(){g.distance=j.camDistance}}),a=(0,n.default)({targets:j,camShake:2,duration:3e3,delay:12e3,easing:"easeInOutSine",update:function(){p.shake=j.camShake,p.shakeSpeed=j.camShakeSpeed}}),t=(0,n.default)({targets:j,camShakeSpeed:5,duration:2e3,delay:11e3,easing:"easeInOutSine",update:function(){p.shakeSpeed=j.camShakeSpeed}})}}
},{"simplex-noise":294,"animejs":293,"../tags":60,"three":74,"../util/resetPlayerPos":132,"./AnimationSystem":108,"./writing/Line3D":267,"../util/locale":227,"../util/Assets":31,"../util/query-string":30,"../assets/textures/coins.jpg":277,"../assets/gltf/coin.gltf":278,"../util/GLTFLoader":279,"../util/ShaderManager":243,"../util/Random":235,"canvas-sketch-util/math":306}],79:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal");function n(n){let t;return{c(){(t=(0,e.element)("main")).innerHTML='<div class="svelte-1wrnee7"><p>Your browser does not support WebGL, or it has been disabled.</p> \n\n    <p>Try viewing this experience in latest Chrome, Safari or FireFox. You may\n      need to go into the browser settings and enable WebGL and hardware\n      acceleration in order to play.</p></div>',(0,e.attr)(t,"class","svelte-1wrnee7")},m(n,r){(0,e.insert)(n,t,r)},p:e.noop,i:e.noop,o:e.noop,d(n){n&&(0,e.detach)(t)}}}class t extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,null,n,e.safe_not_equal,{})}}exports.default=t;
},{"svelte/internal":226}],133:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../tags"),t=c(e),r=require("three"),a=c(r),i=require("../util/math"),n=c(i),o=require("../util/SpriteManager"),s=d(o),l=require("../util/load"),p=require("../util/three-util"),u=require("../util/Assets"),f=d(u);function d(e){return e&&e.__esModule?e:{default:e}}function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}const m={forest:"spritesheets/tree-anim-a",grasslands:"spritesheets/tree-anim-b",tundra:"spritesheets/tree-anim-b"};exports.default=async function(e){const r=e.findTag(t.Renderer);const a=e.view([t.Object3D,t.SpriteAnimation]),i=e.view([t.SpriteAnimation,t.SpriteAnimationLazyLoadSheet]),n={};return function(e){i.forEach(e=>{const a=e.get(t.SpriteAnimationLazyLoadSheet),i=e.get(t.SpriteAnimation),o=a.id;if(o in n){const r=n[o];r&&r.loaded&&(i.sheet=r.sheet,a.playOnLoad&&!i.playing&&i.start(),e.remove(t.SpriteAnimationLazyLoadSheet))}else n[o]={sheet:null,loaded:!1,promise:(0,s.default)(o,r).then(e=>{n[o].loaded=!0,n[o].sheet=e})}}),a.forEach(r=>{const a=r.get(t.SpriteAnimation),i=a.sheet,n=r.get(t.Object3D);if(null==a.lastFrame&&i){const e=i.frames[0];o(n,e,a.fixSpriteAspect),a.lastFrame=e,a.frame=0,a.dirty=!1}if(n.material.visible=Boolean(i),a.playing&&i){const t=i.frames.length;if(a.elapsed+=e*a.speed,a.elapsed>=a.delay&&a.elapsed-a.delay>=1/12){a.elapsed=a.delay,a.frame++;const e=a.looping&&null!=a.loopEnd?a.loopEnd:t;a.frame>=e&&(a.looping?(null!=a.loopStart?a.frame=a.loopStart:a.frame=0,a.currentLoop++):(a.frame=t-1,a.playing=!1,a.finished=!0),a.onLoopEnd&&a.onLoopEnd(r)),a.dirty=!0}}if(a.dirty&&i){a.dirty=!1;const e=i.frames[a.frame];o(n,e,a.fixSpriteAspect),a.lastFrame=e}})};function o(e,t,a){const i=e.material,n=i.uniforms.map.value;if((0,p.shareAtlasTexture)(r,t.atlas,n),i.uniforms.repeat.value.copy(t.repeat),i.uniforms.offset.value.copy(t.offset),a){const r=t.width/t.height;e.scale.x=e.scale.y*r}}};
},{"../tags":60,"three":74,"../util/math":240,"../util/SpriteManager":248,"../util/load":247,"../util/three-util":80,"../util/Assets":31}],691:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),t=require("../assets/image/ui/hint-card-left.png"),n=f(t),a=require("../assets/image/ui/hint-card-middle.png"),r=f(a),i=require("../assets/image/ui/hint-card-right.png"),s=f(i),l=require("svelte"),c=require("../util/locale"),d=require("../util/tokens"),u=require("../util/Random"),o=f(u),p=require("../assets/image/ui/touch-inv.png"),m=f(p),g=require("../assets/image/ui/tree-inv.png"),v=f(g);function f(e){return e&&e.__esModule?e:{default:e}}function b(t){let n,a,r;return{c(){n=(0,e.element)("div"),(a=(0,e.element)("img")).src!==(r=t[2])&&(0,e.attr)(a,"src",r),(0,e.attr)(a,"alt",""),(0,e.attr)(a,"class","token-image svelte-1c19bb0"),(0,e.attr)(n,"class","icon-container svelte-1c19bb0")},m(t,r){(0,e.insert)(t,n,r),(0,e.append)(n,a)},p(t,n){4&n&&a.src!==(r=t[2])&&(0,e.attr)(a,"src",r)},d(t){t&&(0,e.detach)(n)}}}function h(t){let n,a=t[0][c.language.get()]+"";return{c(){n=(0,e.text)(a)},m(t,a){(0,e.insert)(t,n,a)},p(t,r){1&r&&a!==(a=t[0][c.language.get()]+"")&&(0,e.set_data)(n,a)},d(t){t&&(0,e.detach)(n)}}}function k(t){let n;return{c(){n=(0,e.text)(t[0])},m(t,a){(0,e.insert)(t,n,a)},p(t,a){1&a&&(0,e.set_data)(n,t[0])},d(t){t&&(0,e.detach)(n)}}}function x(t){let a,i,l,c,d,u,o,p,m,g,v,f,x,_,q,M=t[2]&&b(t);function $(e,t){return e[0]&&"string"==typeof e[0]?k:e[0]&&"en"in e[0]?h:void 0}let y=$(t),w=y&&y(t);return{c(){a=(0,e.element)("div"),i=(0,e.element)("div"),l=(0,e.element)("img"),d=(0,e.space)(),u=(0,e.element)("div"),o=(0,e.space)(),p=(0,e.element)("img"),g=(0,e.space)(),v=(0,e.element)("div"),M&&M.c(),f=(0,e.space)(),x=(0,e.element)("div"),w&&w.c(),(0,e.attr)(l,"class","card-hint-image slice-0 svelte-1c19bb0"),(0,e.attr)(l,"alt",""),l.src!==(c=n.default)&&(0,e.attr)(l,"src",c),(0,e.attr)(u,"class","card-hint-image slice-1 svelte-1c19bb0"),(0,e.set_style)(u,"background-image","url('"+r.default+"')"),(0,e.attr)(p,"class","card-hint-image slice-2 svelte-1c19bb0"),(0,e.attr)(p,"alt",""),p.src!==(m=s.default)&&(0,e.attr)(p,"src",m),(0,e.attr)(i,"class","card-box svelte-1c19bb0"),(0,e.set_style)(i,"width",t[3]+"px"),(0,e.attr)(x,"class","card-text svelte-1c19bb0"),(0,e.attr)(v,"class","card-content svelte-1c19bb0"),(0,e.attr)(a,"class","card-hint-container svelte-1c19bb0")},m(n,r){(0,e.insert)(n,a,r),(0,e.append)(a,i),(0,e.append)(i,l),(0,e.append)(i,d),(0,e.append)(i,u),(0,e.append)(i,o),(0,e.append)(i,p),(0,e.append)(a,g),(0,e.append)(a,v),M&&M.m(v,null),(0,e.append)(v,f),(0,e.append)(v,x),w&&w.m(x,null),t[9](x),_||(q=[(0,e.listen)(window,"resize",t[4],{passive:!0}),(0,e.listen)(a,"click",t[5])],_=!0)},p(t,[n]){8&n&&(0,e.set_style)(i,"width",t[3]+"px"),t[2]?M?M.p(t,n):((M=b(t)).c(),M.m(v,f)):M&&(M.d(1),M=null),y===(y=$(t))&&w?w.p(t,n):(w&&w.d(1),(w=y&&y(t))&&(w.c(),w.m(x,null)))},i:e.noop,o:e.noop,d(n){n&&(0,e.detach)(a),M&&M.d(),w&&w.d(),t[9](null),_=!1,(0,e.run_all)(q)}}}function _(e,t){const n=e.getBoundingClientRect();return Math.max(270,n.width+10+24+40)}function q(t,n,a){const r=(0,l.createEventDispatcher)();let i,s,c,{text:u=""}=n,{iconMode:p=null}=n,{token:g=""}=n;const f=(0,o.default)();let b;const h=()=>{a(8,b=d.InvertedTokenURLs[f.pick(d.AllTokens)]),"token-random"===p&&a(2,i=b)};function k(){a(3,c=_(s,u))}return h(),(0,l.onMount)(()=>{let e;k();let t=setTimeout(()=>{e=setInterval(h,1e3)},1e3);return()=>{clearTimeout(t),clearInterval(e)}}),t.$$set=(e=>{"text"in e&&a(0,u=e.text),"iconMode"in e&&a(6,p=e.iconMode),"token"in e&&a(7,g=e.token)}),t.$$.update=(()=>{3&t.$$.dirty&&s&&u&&a(3,c=_(s,u)),448&t.$$.dirty&&("token-random"===p?a(2,i=b):"finger"===p?a(2,i=m.default):"tree"===p?a(2,i=v.default):"token"===p&&a(2,i=d.InvertedTokenURLs[g]))}),[u,s,i,c,k,function(){r("close")},p,g,b,function(t){e.binding_callbacks[t?"unshift":"push"](()=>{a(1,s=t)})}]}class M extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,q,x,e.safe_not_equal,{text:0,iconMode:6,token:7})}}exports.default=M;
},{"svelte/internal":226,"../assets/image/ui/hint-card-left.png":487,"../assets/image/ui/hint-card-middle.png":488,"../assets/image/ui/hint-card-right.png":489,"svelte":220,"../util/locale":227,"../util/tokens":138,"../util/Random":235,"../assets/image/ui/touch-inv.png":521,"../assets/image/ui/tree-inv.png":523}],258:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),t=require("svelte/transition"),n=require("svelte"),o=require("../alec-svelte"),i=require("../tags"),r=$(i),s=require("../config"),a=q(s),l=require("../components/AnimatedTextSpan.svelte"),u=q(l),c=require("../animations/transitions"),d=require("../util/tokens"),_=require("../components/Image.svelte"),p=q(_),f=require("../util/Random"),m=q(f),v=require("../components/CardHint.svelte"),g=q(v);function q(e){return e&&e.__esModule?e:{default:e}}function $(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function x(t){let n,o;return(n=new g.default({props:{token:t[3],iconMode:t[2],text:t[1]}})).$on("close",t[6]),{c(){(0,e.create_component)(n.$$.fragment)},m(t,i){(0,e.mount_component)(n,t,i),o=!0},p(e,t){const o={};8&t&&(o.token=e[3]),4&t&&(o.iconMode=e[2]),2&t&&(o.text=e[1]),n.$set(o)},i(t){o||((0,e.transition_in)(n.$$.fragment,t),o=!0)},o(t){(0,e.transition_out)(n.$$.fragment,t),o=!1},d(t){(0,e.destroy_component)(n,t)}}}function h(t){let n,o,i,r,s,a,l=t[4]&&x(t);return{c(){n=(0,e.element)("div"),l&&l.c(),(0,e.attr)(n,"class","container svelte-1lvhwzd"),(0,e.toggle_class)(n,"ignorePointer",k)},m(t,o){(0,e.insert)(t,n,o),l&&l.m(n,null),r=!0,s||(a=(0,e.listen)(n,"introin",M),s=!0)},p(t,[o]){t[4]?l?(l.p(t,o),16&o&&(0,e.transition_in)(l,1)):((l=x(t)).c(),(0,e.transition_in)(l,1),l.m(n,null)):l&&((0,e.group_outros)(),(0,e.transition_out)(l,1,1,()=>{l=null}),(0,e.check_outros)()),0&o&&(0,e.toggle_class)(n,"ignorePointer",k)},i(t){r||((0,e.transition_in)(l),(0,e.add_render_callback)(()=>{i&&i.end(1),o||(o=(0,e.create_in_transition)(n,c.fadeInTransition,{delay:0,duration:1e3})),o.start()}),r=!0)},o(t){(0,e.transition_out)(l),o&&o.invalidate(),i=(0,e.create_out_transition)(n,c.fadeInTransition,{delay:0,duration:1e3}),r=!1},d(t){t&&(0,e.detach)(n),l&&l.d(),t&&i&&i.end(),s=!1,a()}}}let k=!0;const M=()=>{};function y(t,i,r){let s,a=e.noop,l=()=>(a(),a=(0,e.subscribe)(d,e=>r(4,s=e)),d);t.$$.on_destroy.push(()=>a());const{entity:u}=(0,o.context)(),c=u.ref();let{canShow:d}=i;l();let{text:_=""}=i,{iconMode:p=!1}=i,{token:f=""}=i;(0,n.onMount)(()=>()=>{});return t.$$set=(e=>{"canShow"in e&&l(r(0,d=e.canShow)),"text"in e&&r(1,_=e.text),"iconMode"in e&&r(2,p=e.iconMode),"token"in e&&r(3,f=e.token)}),[d,_,p,f,s,c,()=>{c.kill()}]}class w extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,y,h,e.safe_not_equal,{canShow:0,text:1,iconMode:2,token:3})}}exports.default=w;
},{"svelte/internal":226,"svelte/transition":687,"svelte":220,"../alec-svelte":225,"../tags":60,"../config":28,"../components/AnimatedTextSpan.svelte":688,"../animations/transitions":689,"../util/tokens":138,"../components/Image.svelte":690,"../util/Random":235,"../components/CardHint.svelte":691}],134:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=l;var e=require("../tags"),t=u(e),r=require("three"),o=u(r),a=require("../overlays/TutorialMessage.svelte"),i=s(a),n=require("svelte/store");function s(e){return e&&e.__esModule?e:{default:e}}function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function l(e){const r=e.view(t.TutorialMessage);let o=!Boolean(e.findTag(t.IsGameUIActive));const a=(0,n.writable)(o);return a.subscribe(e=>{o=e}),function(n){const s=!Boolean(e.findTag(t.IsGameUIActive));s!==o&&(o=s,a.update(e=>o)),o&&r.forEach(e=>{const r=e.get(t.TutorialMessage);r.time+=n,r.time>=r.delay&&!e.has(t.ViewLayer)&&e.add(t.ViewLayer,{component:i.default,id:r.id,props:{canShow:a,token:r.token,iconMode:r.iconMode,text:r.message}}),Math.max(0,r.time-r.delay)>=r.duration&&e.kill()})}}
},{"../tags":60,"three":74,"../overlays/TutorialMessage.svelte":258,"svelte/store":310}],135:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=m;var e=require("../tags"),t=f(e),n=require("three"),i=f(n),a=require("../util/Random"),r=c(a),o=require("./writing/Line3D"),u=c(o),s=require("./AnimationSystem"),l=require("../util/ease-animate"),d=c(l);function c(e){return e&&e.__esModule?e:{default:e}}function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function m(e){const n=(0,r.default)(),i=e.listen(t.FinalBiomeResolutionLines),a=e.view(t.FloatingEndLine);return function(r){i.added.length>0&&Array(50).fill().map(()=>{const i=new u.default(e,{thickness:1}),[a,r]=n.onCircle(n.range(2.5,15));i.userData._lineThickness=1,i.position.x=a,i.position.y=n.range(2,10),i.position.z=r,i.updatePath([[0,-1,0],[0,0,0],[0,1,0]],!1,!1),i.userData._entity=e.entity().add(t.Object3D,i).add(t.FloatingEndLine);const o=i.userData._entity.get(t.FloatingEndLine);return o.duration=n.range(2,3.5),o.delay=2+n.range(0,2),o.animateDuration=.5,o.speed=n.range(.5,2),i}),a.forEach(e=>{const n=e.get(t.FloatingEndLine);n.time+=r;const i=Math.max(0,n.time-n.delay),a=(0,d.default)(n.time,n.duration,n.delay,n.animateDuration,n.ease),o=e.get(t.Object3D);o.material.uniforms.thickness.value=o.userData._lineThickness*a,o.material.uniforms.opacity.value=a,o.position.y+=r*n.speed,i>=n.duration&&e.kill()})}}
},{"../tags":60,"three":74,"../util/Random":235,"./writing/Line3D":267,"./AnimationSystem":108,"../util/ease-animate":259}],136:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=M;var e=require("../tags"),t=G(e),r=require("../util/math"),a=G(r),i=require("three"),n=G(i),o=require("./AnimationSystem"),s=require("./writing/Line3D"),l=C(s),u=require("../util/tween-ticker"),d=C(u),c=require("../util/tokens"),g=require("../util/load"),f=require("../nfb"),p=require("../util/geometry"),h=require("../util/haikugen"),T=C(h),m=require("../util/ShaderManager"),k=G(m),y=require("../util/materials"),w=require("../util/Assets"),D=C(w),v=require("../util/ObjectPool"),q=C(v),O=require("../util/locale"),S=require("../util/Random"),b=C(S);function C(e){return e&&e.__esModule?e:{default:e}}function G(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}const A=1.25;function M(e){const r=.666,i=e.findTag(t.RenderLayers),o=e.findTag(t.Renderer),s=(new n.Color(1,1,1),new n.Color(1+r,1+r,1+r),.1),l=new n.Color("#000"),u=((0,T.default)(),(0,d.default)()),[g]=D.default.createGPUTextureTask(o,"image/data/soft-circle"),f=new q.default({initialCapacity:10,create:()=>(function(){const e=new n.Mesh((0,y.getSpriteGeometry)(),(0,y.createTokenMaterial)(r,!1));e.renderOrder=10,e.userData.alpha=1,e.name="token";const t=new n.Sprite(new n.SpriteMaterial({map:g,depthTest:!1,depthWrite:!1,color:l,opacity:s,transparent:!0}));t.scale.set(2,.66,1).multiplyScalar(.75),t.layers.disableAll(),t.layers.enable(i.shadow);const a=new n.Group;return a.add(e),a.add(t),a.userData.sprite=e,a.userData.shadow=t,a})(),renew(e){},release(e){}}),h=(Object.keys(c.TokenURLs),e.view([t.GroundAsset,t.GroundAssetToken,t.Object3D])),m=e.view(t.TokenIsCollecting),k=e.view(t.TriggerTokenLine),w=e.listen(t.GroundAssetToken),v=(e.listen(t.HaikuCardSaved),e.view(t.FinishedPoem),e.view(t.CollectedToken)),O=e.listen(t.CollectedToken),S=e.view(t.TutorialMessage),C=(e.view([t.WrittenStanzaLine]),[0,0]),G=[0,0],A=e.tag(t.TokensDiscoveredSet,new Set),M=e.listen(t.ActiveEnvironmentState),j=e.findTag(t.UserCharacter);new n.SphereBufferGeometry(1,16,16);let E=!1,x=0;(0,b.default)();return function(i){u.tick(i);const n=j.position;C[0]=n.x,C[1]=n.z,M.changed&&(A.clear(),v.forEach(e=>e.kill()),m.forEach(e=>e.tagOff(t.TokenIsCollecting)),k.forEach(e=>e.tagOff(t.TriggerTokenLine))),w.added.forEach(e=>{const r=e.get(t.GroundAsset),a=e.get(t.GroundAssetToken),i=f.next(),n=i.userData.sprite;(0,y.setSpriteToken)(o,n,a.type,1.25);n.userData.startY=1,n.userData.endY=n.userData.startY+1,n.position.x=r.x,n.position.z=r.z,n.position.y=n.userData.startY,n.userData.show=null;const s=i.userData.shadow;s.position.copy(n.position),s.position.y=0,i.visible=!1,e.add(t.Object3D,i),e.add(t.ShaderUniformTime),e.get(t.ShaderUniformTime).uniform=n.material.uniforms.time}),w.removing.forEach(e=>{if(e.has(t.Object3D)){const r=e.get(t.Object3D);f.release(r)}});const l=Boolean(e.findTag(t.DirectUserToOrigin)),d=Boolean(e.findTag(t.OriginTreeIntroSequence)),c=Boolean(e.findTag(t.BlockTokenCollection)),g=!d&&v.length<3&&!l&&!c,T=m.length>0,D=k.length>0,q=T||D;if(h.forEach(e=>{const i=e.get(t.GroundAsset),n=e.get(t.GroundAssetToken),o=e.get(t.Object3D),l=o.userData.sprite,d=o.userData.shadow,c=l.userData.show,f=!A.has(n.type),h=l.material.uniforms.map.value,T=Boolean(h),m=g&&f&&T&&!q;m!==c&&(l.userData.show=m,u.to(l.position,{y:m?l.userData.startY:l.userData.endY,ease:"sineOut",duration:1}),u.to(l.userData,{alpha:m?1:0,ease:"sineOut",duration:1}).on("update",e=>{const t=l.userData.alpha;l.material.uniforms.opacity.value=t;const i=a.lerp(1,1+r,t);l.material.uniforms.color.value.setRGB(i,i,i),l.material.visible=t>=1e-5,d.material.opacity=t*s}).on("complete",e=>{e.cancelling||m||(o.visible=!1)})),G[0]=i.x,G[1]=i.z;f&&m&&(0,p.circlesIntersect)(G,2,C,1)&&(e.tagOn(t.TriggerTokenLine),S.forEach(e=>e.kill()))}),O.added.length>0){const r=O.query.entities,a=O.added[O.added.length-1];if(r.length<3){const r=e.entity().add(t.TutorialMessage),i=a.get(t.CollectedToken),n=r.get(t.TutorialMessage);n.iconMode="token",n.token=i.type,n.message=i.stanza,n.id=i.type,n.delay=.5,n.duration=6}!E&&r.length>=3&&(E=!0,x=0)}if(E&&(x+=i)>=1){E=!1;const r=e.entity().add(t.FinishedPoem).get(t.FinishedPoem),a=O.query.entities;for(let e=0;e<3;e++){const i=a[e].get(t.CollectedToken);r.lines[e]=i.stanza,r.tokens[e]=i.type}v.forEach(e=>e.kill())}}}
},{"../tags":60,"../util/math":240,"three":74,"./AnimationSystem":108,"./writing/Line3D":267,"../util/tween-ticker":244,"../util/tokens":138,"../util/load":247,"../nfb":75,"../util/geometry":251,"../util/haikugen":276,"../util/ShaderManager":243,"../util/materials":82,"../util/Assets":31,"../util/ObjectPool":236,"../util/locale":227,"../util/Random":235}],137:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=I;var e=require("../tags"),t=A(e),n=require("../util/math"),a=A(n),r=require("three"),i=A(r),o=require("../util/helpers"),s=A(o),l=require("./AnimationSystem"),u=require("./writing/Line3D"),c=E(u),d=require("../util/tween-ticker"),p=E(d),h=require("../util/tokens"),g=require("../util/load"),m=require("../util/geometry"),f=require("../util/haikugen"),k=E(f),w=require("../util/ShaderManager"),D=A(w),y=require("../util/materials"),O=require("../util/Assets"),T=E(O),b=require("../util/ObjectPool"),v=E(b),x=require("../util/locale"),C=require("../util/Random"),z=E(C),S=require("../util/three-util"),j=require("../util/query-string"),_=E(j),q=require("../nfb");function E(e){return e&&e.__esModule?e:{default:e}}function A(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}const M=1.25,P=2.5,V=6.25;function F(e){const t=e.split(" "),n=[];return t.forEach(e=>{e.split("-").forEach((e,t,a)=>{let r=e;t<a.length-1&&(r+="-"),r&&n.push(r)})}),n}function I(e){const n=e.findTag(t.RenderLayers),r=e.findTag(t.Renderer),o=new i.Color(1,1,1),s=(new i.Color(1.666,1.666,1.666),new i.Color("#280422").lerp(o,.9)),u=(0,k.default)(),d=(0,p.default)(),h=1.75,g=2.25,f=new i.PlaneBufferGeometry(1,1,1,1),w=e.listen([t.GroundAsset,t.GroundAssetToken,t.Object3D,t.TriggerTokenLine]),D=e.view(t.FinishedPoem),O=e.view(t.CollectedToken),b=(e.listen(t.CollectedToken),e.view(t.HaikuInInventory),e.findTag(t.TokensDiscoveredSet)),C=[0,0],j=e.listen(t.ActiveEnvironmentState),_=e.findTag(t.UserCharacter),q=(0,z.default)(),E=e.view(t.TokenChildren),[A]=T.default.createGPUTextureTask(r,"image/data/compass-dot"),P=new v.default({initialCapacity:12,name:"orbs",create(){const e=new i.Mesh(f,(0,y.createTokenMaterial)(1,!1));return e.material.uniforms.map.value=A,e.renderOrder=10,e.position.y=M,e.userData.smallScale=0,e.userData.bigScale=.45,e.userData.alpha=1,e.userData.visibility=0,e.userData.finalScale=1,e.userData._entity=null,B(e),e},renew(e){e.userData._pool=this},release(e){e.userData._pool=null,e.userData._entity&&(e.userData._entity.kill(),e.userData._entity=null)}}),I=(e.view(t.DirectUserToOrigin),e.listen(t.DirectUserToOrigin),e.view([t.Object3D,t.MusicalOrb]));new i.Vector3,new i.Vector3;return function(a){d.tick(a);const r=_.position;C[0]=r.x,C[1]=r.z,I.forEach(e=>{const n=e.get(t.MusicalOrb),a=e.get(t.Object3D);if(!n.killing&&!n.killing&&!n.hit){const r=a.position.x-C[0],i=a.position.z-C[1];if(r*r+i*i<=V){n.hit=!0,e.tagOff(t.CollectTokenOrb),e.tagOn(t.CollectTokenOrb),e.add(t.ParticleEmit),e.get(t.ParticleEmit).position.copy(a.position),n.killing=!0,((e,t=!1)=>{e&&(e.userData._pool&&P.release(e),t&&e.userData._entity&&(e.userData._entity.kill(),e.userData._entity=null),(0,S.detachObject)(e)),d.to(e.userData,{alpha:0,duration:1,ease:"expoOut"}).on("update",()=>{B(e)}).on("complete",()=>{e&&(e.userData._pool&&P.release(e),t&&e.userData._entity&&(e.userData._entity.kill(),e.userData._entity=null),(0,S.detachObject)(e))})})(a,!0)}}}),w.added.forEach(a=>{const r=a.get(t.GroundAsset),o=a.get(t.GroundAssetToken);a.get(t.Object3D);a.tagOff(t.TriggerTokenLine),function(a,r){const o=Math.atan2(_.direction.z,_.direction.x),p=e.entity().add(t.TokenChildren);p.add(t.TokenIsCollecting);const h=p.get(t.TokenChildren),g=new i.Group;h.group=g;const f=o,k=Math.cos(f),w=Math.sin(f),y=new i.Vector3(r.x,0,r.z).addScaledVector(new i.Vector3(k,0,w),4),T=D.map(e=>e.get(t.FinishedPoem).lines),b=O.slice(0,2).map(e=>e.get(t.CollectedToken).stanza),v=O.length,C=u.generateStanza({stanza:v,token:a,ignore:T,state:b});h.x=r.x,h.z=r.z,h.type=a,h.stanzaIndex=v,h.stanza=C;const z=F(C[x.language.get()]),S=[],j=O.length;for(let e=0;e<z.length;e++){S.push(z[e]);for(let t=0;t<j;t++)e<z.length-1&&S.push(null)}const E=z.length,A=5*E,V=q.sign(),I=y.clone().addScaledVector(new i.Vector3(k,0,w),A),G=y.clone().lerp(I,.25),R=y.clone().lerp(I,.75),L=new i.Vector2(y.x,y.z).sub(new i.Vector2(I.x,I.z)).normalize(),U=new i.Vector2(-L.y,L.x);let H;const K=new i.Vector3(U.x,0,U.y);E>3?(G.addScaledVector(K,-A/2*V),R.addScaledVector(K,A/2*V),H=new i.CubicBezierCurve3(y,G,R,I)):(G.addScaledVector(K,A/2*V),H=new i.QuadraticBezierCurve3(y,G,I));const Q=new c.default(e,{taper:!0,thickness:.35,dotted:!0,filling:!1,draw:1,depthWrite:!1,depthTest:!1}),W=new c.default(e,{bloom:0,thickness:.75,blending:i.MultiplyBlending,color:s,geometry:Q.geometry});W.layers.set(n.shadow),W.userData.thickness=W.material.uniforms.thickness.value;const J=z.map((e,t,n)=>{const a=n.length<=1?.5:t/(n.length-1),r=new i.Vector3;return H.getPointAt(a,r),r}),N=new i.CatmullRomCurve3(J,!1,"catmullrom",.5);h.markers.length=0;const X=S;for(let e=0;e<X.length;e++){const t=X[e],n=X.length<=1?.5:e/(X.length-1),a=P.next();console.log(P.log()),N.getPointAt(n,a.position),a.position.y=M,a.userData.alpha=1,a.userData.visibility=0,a.userData.finalScale=1,g.add(a),B(a),0===e&&d.to(a.userData,{visibility:1,duration:1,ease:"expoOut"}).on("update",()=>B(a)),h.markers.push({hit:!1,word:t,sphere:a,position:a.position})}const Y=h.markers.map(e=>{const t=e.position;return t}),Z=(0,m.getBoundingCircle)(Y.map(e=>[e.x,e.z]));h.center=Z.center,h.radius=Z.radius,Q.updatePath(N.getSpacedPoints(30),!1,!0);const $=Q.material.uniforms.thickness.value;(0,l.tweenFromTo)(e,Q.material.uniforms.thickness,"value",0,$,1,"sineOut"),Q.material.uniforms.filling.value=!0,W.material.uniforms.filling.value=!0,(0,l.tweenFromTo)(e,Q.material.uniforms.draw,"value",0,1,1,"sineOut"),(0,l.tweenFromTo)(e,W.material.uniforms.draw,"value",0,1,1,"sineOut"),g.add(Q),g.add(W),Q.position.y=M,h.line=Q,h.shadow=W,p.add(t.Object3D,g)}(o.type,r)}),E.forEach(n=>{const r=n.get(t.TokenChildren);if(r.complete||r.killing)return;const i=(0,m.circlesIntersect)(C,5,r.center,r.radius);r.removing||i?r.removing&&i&&(r.removing=!1,console.log("token back in range")):(console.log("token out of range"),r.removeTime=0,r.removing=!0),r.removing&&(r.removeTime+=a,r.removeTime>=r.removeDelay&&(r.killing=!0,r.removing=!0,function(n,a){!function(n){if(!n.has(t.TokenChildren))return;const a=n.get(t.TokenChildren);a.markers.forEach(n=>{n.text&&function(n){if(n.has(t.Object3D)){const a=n.get(t.Object3D);a&&a.userData.tweenA&&(a.userData.tweenA.kill(),a.userData.tweenB.kill());const r=n.get(t.TextSprite3D);(0,l.tweenTo)(e,a.position,"y",h,1,"expoOut");(0,l.setEntityTweenFromTo)(n,r,"opacity",1,0,1,"sineOut");const i=n.get(t.TargetKeyTween);i.killEntityOnFinish=!0,i.assignFromOnStart=!0}}(n.text);const a=n.sphere;d.to(n.sphere.userData,{finalScale:0,duration:1,ease:"sineOut"}).on("update",()=>B(n.sphere)).on("complete",()=>{a.userData._pool&&P.release(a),(0,S.detachObject)(a)})}),d.to(a.line.material.uniforms.thickness,{value:0,duration:1,ease:"sineOut"}),d.to(a.shadow.material.uniforms.thickness,{value:0,duration:1,ease:"sineOut"}).on("complete",()=>{console.log("dispose"),a.line.geometry.dispose(),a.shadow.geometry.dispose(),(0,S.detachObject)(a.line),(0,S.detachObject)(a.shadow),(0,S.detachObject)(a.group),n.kill()})}(n)}(n))),r.complete||r.killing||r.removing||function(n,a){for(let r=0;r<a.markers.length;r++){const i=a.markers[r];if(!i.hit){const o=r>0&&a.markers.length>1?a.markers[r-1]:null;if(o&&!o.hit)break;const s=i.position.x-C[0],l=i.position.z-C[1],u=s*s+l*l;if(u<=V){i.hit=!0,n.tagOff(t.CollectTokenOrb),n.tagOn(t.CollectTokenOrb),n.add(t.ParticleEmit);const o=n.get(t.ParticleEmit);o.position.copy(i.position),i.word&&(i.text=G(i.word,i.sphere.position));a.markers.length<=1||a.markers.length;d.to(i.sphere.userData,{alpha:0,duration:1,ease:"expoOut"}).on("update",()=>{B(i.sphere)}).on("complete",()=>{i.sphere&&(i.sphere.userData._pool&&P.release(i.sphere),(0,S.detachObject)(i.sphere))});const s=r<a.markers.length-1?a.markers[r+1]:null;if(s&&d.to(s.sphere.userData,{visibility:1,duration:1,ease:"expoOut"}).on("update",()=>{B(s.sphere)}),r===a.markers.length-1){a.complete=!0,b.add(a.type),n.tagOff(t.TokenIsCollecting);const r=e.entity().add(t.CollectedToken),i=r.get(t.CollectedToken);r.add(t.CapeMagicalEffect),r.add(t.AutoRemoveCapeMagicalEffect),i.x=a.x,i.z=a.z,i.type=a.type,i.stanza=a.stanza,i.stanzaIndex=a.stanzaIndex,d.to(a.line.material.uniforms.dottedFill,{value:1,duration:1,ease:"quadInOut"})}}}}}(n,r)}),j.changed&&E.forEach(e=>{!function(e){if(!e.has(t.TokenChildren))return;const n=e.get(t.TokenChildren);n.markers.forEach(e=>{e.text&&function(e){if(e.has(t.Object3D)){const n=e.get(t.Object3D);n&&n.userData.tweenA&&(n.userData.tweenA.kill(),n.userData.tweenB.kill())}e.kill()}(e.text),e.sphere&&(e.sphere.userData._pool&&P.release(e.sphere),(0,S.detachObject)(e.sphere))}),n.line.geometry.dispose(),n.shadow.geometry.dispose(),(0,S.detachObject)(n.line),(0,S.detachObject)(n.shadow),(0,S.detachObject)(n.group),e.kill()}(e)})};function B(e){const t=a.lerp(e.userData.smallScale,e.userData.bigScale,e.userData.alpha)*e.userData.visibility*e.userData.finalScale;e.visible=t>1e-14,e.scale.setScalar(Math.max(t,1e-14))}function G(n,a){const r=new i.Group;r.position.copy(a),r.position.y=h;const o=e.entity().add(t.TextSprite3D).add(t.Object3D,r),s=o.get(t.TextSprite3D);s.text=n,s.depth=!1,s.parent=r,s.fontSize=16,s.opacity=0;const u=(0,l.tweenTo)(e,r.position,"y",g,2,"expoOut"),c=(0,l.tweenTo)(e,s,"opacity",1,1,"sineOut");return r.userData.tweenA=u.ref(),r.userData.tweenB=c.ref(),o}}
},{"../tags":60,"../util/math":240,"three":74,"../util/helpers":250,"./AnimationSystem":108,"./writing/Line3D":267,"../util/tween-ticker":244,"../util/tokens":138,"../util/load":247,"../util/geometry":251,"../util/haikugen":276,"../util/ShaderManager":243,"../util/materials":82,"../util/Assets":31,"../util/ObjectPool":236,"../util/locale":227,"../util/Random":235,"../util/three-util":80,"../util/query-string":30,"../nfb":75}],29:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../tags"),t=Et(e),r=require("three"),a=Et(r),d=require("../util/query-string"),i=Ut(d),s=require("./SnowAtmosphereSystem"),u=Ut(s),m=require("./DOMTextSystem"),n=Ut(m),o=require("./GameUISystem"),l=Ut(o),S=require("./CanvasSystem"),y=Ut(S),f=require("./TokenPaperFollowSystem"),q=Ut(f),c=require("./SceneSystem"),g=Ut(c),p=require("./InputSystem"),w=Ut(p),v=require("./CompassSystem"),b=Ut(v),T=require("./ScreenCompassSystem"),h=Ut(T),P=require("./UserMoveSystem"),A=Ut(P),_=require("./WindAtmosphereSystem"),F=Ut(_),L=require("./RainAtmosphereSystem"),M=Ut(L),O=require("./CharacterSystem"),x=Ut(O),C=require("./HatWindLineSystem"),U=Ut(C),E=require("./AtmosphericsSystem"),G=Ut(E),R=require("./TallGrassSystem"),k=Ut(R),D=require("./HaikuFloraSystem"),H=Ut(D),I=require("./UserZoomSystem"),V=Ut(I),B=require("./RenderDebugTargetsSystem"),z=Ut(B),J=require("./UserFollowSystem"),W=Ut(J),j=require("./ShaderUniformSystem"),N=Ut(j),Q=require("./LoadJSONSystem"),Z=Ut(Q),K=require("./TreeSpriteAnimationSystem"),X=Ut(K),Y=require("./TextSpriteSystem"),$=Ut(Y),ee=require("./EnvironmentGrassSystem"),te=Ut(ee),re=require("./EnvironmentGroundRenderTextureSystem"),ae=Ut(re),de=require("./SubmitFrameSystem"),ie=Ut(de),se=require("./AnimationSystem"),ue=Ut(se),me=require("./ProceduralSpawningLeaves"),ne=Ut(me),oe=require("./ProceduralSpawningDots"),le=Ut(oe),Se=require("./EnvironmentGroundDataTextureSystem"),ye=Ut(Se),fe=require("./AudioSystem"),qe=Ut(fe),ce=require("./SimpleEnvironmentSystem"),ge=Ut(ce),pe=require("./SimpleEnvironmentCellSystem"),we=Ut(pe),ve=require("./SimpleEnvironmentAssetsSystem"),be=Ut(ve),Te=require("./ShadowMapSystem"),he=Ut(Te),Pe=require("./LoadRefGLTFSystem"),Ae=Ut(Pe),_e=require("./PoemCollectionSystem"),Fe=Ut(_e),Le=require("./HaikuCollectionSystem"),Me=Ut(Le),Oe=require("./StanzaLineSpawningGrowthSystem"),xe=Ut(Oe),Ce=require("./WaterCollectionSystem"),Ue=Ut(Ce),Ee=require("./DevTutorialSystem"),Ge=Ut(Ee),Re=require("./BirdFlyingSystem"),ke=Ut(Re),De=require("./GroundBirdsSystem"),He=Ut(De),Ie=require("./animals/ButterflySystem"),Ve=Ut(Ie),Be=require("./animals/RabbitSystem"),ze=Ut(Be),Je=require("./animals/SealSystem"),We=Ut(Je),je=require("./animals/OwlSystem"),Ne=Ut(je),Qe=require("./animals/FoxSystem"),Ze=Ut(Qe),Ke=require("./animals/FishSystem"),Xe=Ut(Ke),Ye=require("./animals/JumpingRabbitSystem"),$e=Ut(Ye),et=require("./OriginTreeSystem"),tt=Ut(et),rt=require("./OriginTreeIntroSystem"),at=Ut(rt),dt=require("./IntroTutorialSystem"),it=Ut(dt),st=require("./LetterboxBarsSystem"),ut=Ut(st),mt=require("./AnimalSpawnSystem"),nt=Ut(mt),ot=require("./OutroSystem"),lt=Ut(ot),St=require("../util/globalIntroVideo"),yt=require("../config"),ft=Ut(yt),qt=require("../util/resetPlayerPos"),ct=Ut(qt),gt=require("../util/Assets"),pt=Ut(gt),wt=require("../overlays/NotSupportedOverlay.svelte"),vt=Ut(wt),bt=require("./SpriteSheetAnimationSystem"),Tt=Ut(bt),ht=require("./TutorialMessageSystem"),Pt=Ut(ht),At=require("../nfb"),_t=require("./FloatingEndLines"),Ft=Ut(_t),Lt=require("./TokenPlacementSystem"),Mt=Ut(Lt),Ot=require("./TokenConstellationSystem"),xt=Ut(Ot),Ct=require("../util/tokens");function Ut(e){return e&&e.__esModule?e:{default:e}}function Et(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function Gt(){return Promise.all(["image/svg/nfblogo"].map(e=>pt.default.load(e)))}async function Rt(e,r){const d=(0,ft.default)();if(e.entity().add(t.RenderLayers),e.addSystem(g.default),e.addSystem(w.default),e.addSystem(N.default),e.addSystem(A.default),e.addSystem(x.default),e.addSystem(U.default),e.addSystem(V.default,{allowMouseZoom:!1,maxDistance:400}),e.addSystem(W.default),e.addSystem(ue.default),e.addSystem(ye.default),e.addSystem(ae.default),e.addSystem(he.default),d.embed||await e.addSystem(Ae.default),e.addSystem(ge.default),await e.addSystem(te.default),e.addSystem(we.default),await e.addSystem(be.default),e.addSystem(Tt.default),e.addSystem(X.default),d.embed&&await e.addSystem(Z.default),await e.addSystem(ne.default),e.addSystem(le.default),d.embed||e.addSystem(tt.default),d.embed||e.addSystem(at.default),e.addSystem(Pt.default),d.embed||i.default.notutorial||e.addSystem(it.default),e.addSystem(Mt.default),e.addSystem(xt.default),e.addSystem(q.default),e.addSystem(Ue.default),e.addSystem(M.default),e.addSystem(F.default),e.addSystem(u.default),e.addSystem(nt.default),e.addSystem(H.default),e.addSystem(b.default),e.addSystem(ke.default),e.addSystem(He.default),e.addSystem(Ve.default),e.addSystem(Ze.default),e.addSystem(Xe.default),e.addSystem($e.default),e.addSystem(Ft.default),e.addSystem(lt.default),d.embed||e.addSystem(ut.default),d.embed||e.addSystem(Me.default),d.embed||e.addSystem(qe.default),await e.addSystem(ie.default,{fade:d.embed?0:1}),i.default.nointroseq&&(0,ct.default)(e),d.embed&&(0,qt.setPlayerPos)(e,new a.Vector3(-20.625336223781655,0,-7.556151890652441)),i.default.resolve){(0,qt.setPlayerPos)(e,new a.Vector3(25,0,-25));for(let e=0;e<3;e++)window.addPoem()}if(i.default.testtoken){const t=new a.Vector3(-71.4775163757554,0,-34.91576302604653);(0,qt.setPlayerPos)(e,t)}}exports.default=async function(e){const r=(0,ft.default)();let a;window.world=e,window.Tags=t;const d=new Promise(e=>{a=e});await Gt(),e.addSystem(y.default,{context:r.context});const s=e.findTag(t.AppState);s.rendering=!1,e.root.process(1/60);const u=e.getSystem(y.default).instance;u.running=!0,u.show(),u.step();let m=Promise.resolve();e.addSystem(n.default),e.addSystem(l.default,{readyToInitialize:function(){console.log("[init] Initialize Game Systems"),pt.default.prepare(["spritesheets/temp_grass_sprites"]),m=Rt(e);pt.default.loadQueued()},readyToShowEngine:async function(){await m,(0,At.sendAnalytics)({event:"finished_loading",label:"FinishedLoading"}),console.log("[init] Start Rendering Engine"),s.rendering=!0,e.root.process(1/60),requestAnimationFrame(()=>{o.remove(t.HideHUD),e.entity().add(t.ScreenFade,{duration:3,from:1,to:0}),o.remove(t.MoveUserToOrigin),o.remove(t.CameraStopUserMovement),a()})}}),(0,yt.hideLoader)();const o=e.entity();o.add(t.CameraStopUserMovement),o.add(t.HideHUD),o.add(t.MoveUserToOrigin),pt.default.prepare(["image/ui/close-button","image/ui/ico_resume","image/ui/btn_start","image/ui/btn_about","image/ui/hint-card-left","image/ui/hint-card-middle","image/ui/hint-card-right","image/ui/ico_paperJournal1-rotated"]),i.default.nolanding||(console.log("[video] Loading video"),(0,St.getVideo)().load());const S=e.findTag(t.Renderer);return await Promise.all([pt.default.loadQueued(),(0,Ct.loadTokenSprites)(S)]),d};
},{"../tags":60,"three":74,"../util/query-string":30,"./SnowAtmosphereSystem":83,"./DOMTextSystem":84,"./GameUISystem":85,"./CanvasSystem":34,"./TokenPaperFollowSystem":86,"./SceneSystem":87,"./InputSystem":88,"./CompassSystem":89,"./ScreenCompassSystem":90,"./UserMoveSystem":91,"./WindAtmosphereSystem":92,"./RainAtmosphereSystem":93,"./CharacterSystem":94,"./HatWindLineSystem":95,"./AtmosphericsSystem":96,"./TallGrassSystem":97,"./HaikuFloraSystem":98,"./UserZoomSystem":99,"./RenderDebugTargetsSystem":100,"./UserFollowSystem":101,"./ShaderUniformSystem":102,"./LoadJSONSystem":35,"./TreeSpriteAnimationSystem":103,"./TextSpriteSystem":104,"./EnvironmentGrassSystem":105,"./EnvironmentGroundRenderTextureSystem":106,"./SubmitFrameSystem":107,"./AnimationSystem":108,"./ProceduralSpawningLeaves":109,"./ProceduralSpawningDots":110,"./EnvironmentGroundDataTextureSystem":111,"./AudioSystem":112,"./SimpleEnvironmentSystem":113,"./SimpleEnvironmentCellSystem":114,"./SimpleEnvironmentAssetsSystem":115,"./ShadowMapSystem":116,"./LoadRefGLTFSystem":117,"./PoemCollectionSystem":118,"./HaikuCollectionSystem":119,"./StanzaLineSpawningGrowthSystem":120,"./WaterCollectionSystem":121,"./DevTutorialSystem":122,"./BirdFlyingSystem":123,"./GroundBirdsSystem":124,"./animals/ButterflySystem":145,"./animals/RabbitSystem":146,"./animals/SealSystem":147,"./animals/OwlSystem":148,"./animals/FoxSystem":149,"./animals/FishSystem":150,"./animals/JumpingRabbitSystem":151,"./OriginTreeSystem":125,"./OriginTreeIntroSystem":126,"./IntroTutorialSystem":127,"./LetterboxBarsSystem":128,"./AnimalSpawnSystem":129,"./OutroSystem":130,"../util/globalIntroVideo":131,"../config":28,"../util/resetPlayerPos":132,"../util/Assets":31,"../overlays/NotSupportedOverlay.svelte":79,"./SpriteSheetAnimationSystem":133,"./TutorialMessageSystem":134,"../nfb":75,"./FloatingEndLines":135,"./TokenPlacementSystem":136,"./TokenConstellationSystem":137,"../util/tokens":138}],32:[function(require,module,exports) {
var define;
var t;!function(){"use strict";function e(t,n){var i;if(n=n||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=n.touchBoundary||10,this.layer=t,this.tapDelay=n.tapDelay||200,this.tapTimeout=n.tapTimeout||700,!e.notNeeded(t)){for(var r=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],a=0,s=r.length;a<s;a++)this[r[a]]=c(this[r[a]],this);o&&(t.addEventListener("mouseover",this.onMouse,{passive:!0}),t.addEventListener("mousedown",this.onMouse,{passive:!0}),t.addEventListener("mouseup",this.onMouse,{passive:!0})),t.addEventListener("click",this.onClick,{passive:!0}),t.addEventListener("touchstart",this.onTouchStart,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove,{passive:!1}),t.addEventListener("touchend",this.onTouchEnd,{passive:!1}),t.addEventListener("touchcancel",this.onTouchCancel,{passive:!1}),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,n,o){var i=Node.prototype.removeEventListener;"click"===e?i.call(t,e,n.hijacked||n,o):i.call(t,e,n,o)},t.addEventListener=function(e,n,o){var i=Node.prototype.addEventListener;"click"===e?i.call(t,e,n.hijacked||(n.hijacked=function(t){t.propagationStopped||n(t)}),o):i.call(t,e,n,o)}),"function"==typeof t.onclick&&(i=t.onclick,t.addEventListener("click",function(t){i(t)},!1),t.onclick=null)}function c(t,e){return function(){return t.apply(e,arguments)}}}var n=navigator.userAgent.indexOf("Windows Phone")>=0,o=navigator.userAgent.indexOf("Android")>0&&!n,i=/iP(ad|hone|od)/.test(navigator.userAgent)&&!n,r=i&&/OS 4_\d(_\d)?/.test(navigator.userAgent),a=i&&/OS [6-7]_\d/.test(navigator.userAgent),s=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(t){switch(t.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(t.disabled)return!0;break;case"input":if(i&&"file"===t.type||t.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(t.className)},e.prototype.needsFocus=function(t){switch(t.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!o;case"input":switch(t.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!t.disabled&&!t.readOnly;default:return/\bneedsfocus\b/.test(t.className)}},e.prototype.sendClick=function(t,e){var n,o;document.activeElement&&document.activeElement!==t&&document.activeElement.blur(),o=e.changedTouches[0],(n=document.createEvent("MouseEvents")).initMouseEvent(this.determineEventType(t),!0,!0,window,1,o.screenX,o.screenY,o.clientX,o.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,t.dispatchEvent(n)},e.prototype.determineEventType=function(t){return o&&"select"===t.tagName.toLowerCase()?"mousedown":"click"},e.prototype.focus=function(t){var e;i&&t.setSelectionRange&&0!==t.type.indexOf("date")&&"time"!==t.type&&"month"!==t.type?(e=t.value.length,t.setSelectionRange(e,e)):t.focus()},e.prototype.updateScrollParent=function(t){var e,n;if(!(e=t.fastClickScrollParent)||!e.contains(t)){n=t;do{if(n.scrollHeight>n.offsetHeight){e=n,t.fastClickScrollParent=n;break}n=n.parentElement}while(n)}e&&(e.fastClickLastScrollTop=e.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(t){return t.nodeType===Node.TEXT_NODE?t.parentNode:t},e.prototype.onTouchStart=function(t){var e,n,o;if(t.targetTouches.length>1)return!0;if(e=this.getTargetElementFromEventTarget(t.target),n=t.targetTouches[0],i){if((o=window.getSelection()).rangeCount&&!o.isCollapsed)return!0;if(!r){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return t.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(e)}}return this.trackingClick=!0,this.trackingClickStart=t.timeStamp,this.targetElement=e,this.touchStartX=n.pageX,this.touchStartY=n.pageY,t.timeStamp-this.lastClickTime<this.tapDelay&&t.preventDefault(),!0},e.prototype.touchHasMoved=function(t){var e=t.changedTouches[0],n=this.touchBoundary;return Math.abs(e.pageX-this.touchStartX)>n||Math.abs(e.pageY-this.touchStartY)>n},e.prototype.onTouchMove=function(t){return!this.trackingClick||((this.targetElement!==this.getTargetElementFromEventTarget(t.target)||this.touchHasMoved(t))&&(this.trackingClick=!1,this.targetElement=null),!0)},e.prototype.findControl=function(t){return void 0!==t.control?t.control:t.htmlFor?document.getElementById(t.htmlFor):t.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(t){var e,n,s,c,u,l=this.targetElement;if(!this.trackingClick)return!0;if(t.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(t.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=t.timeStamp,n=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,a&&(u=t.changedTouches[0],(l=document.elementFromPoint(u.pageX-window.pageXOffset,u.pageY-window.pageYOffset)||l).fastClickScrollParent=this.targetElement.fastClickScrollParent),"label"===(s=l.tagName.toLowerCase())){if(e=this.findControl(l)){if(this.focus(l),o)return!1;l=e}}else if(this.needsFocus(l))return t.timeStamp-n>100||i&&window.top!==window&&"input"===s?(this.targetElement=null,!1):(this.focus(l),this.sendClick(l,t),i&&"select"===s||(this.targetElement=null,t.preventDefault()),!1);return!(!i||r||!(c=l.fastClickScrollParent)||c.fastClickLastScrollTop===c.scrollTop)||(this.needsClick(l)||(t.preventDefault(),this.sendClick(l,t)),!1)},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(t){return!this.targetElement||(!!t.forwardedTouchEvent||(!t.cancelable||(!(!this.needsClick(this.targetElement)||this.cancelNextClick)||(t.stopImmediatePropagation?t.stopImmediatePropagation():t.propagationStopped=!0,t.stopPropagation(),t.preventDefault(),!1))))},e.prototype.onClick=function(t){var e;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===t.target.type&&0===t.detail||((e=this.onMouse(t))||(this.targetElement=null),e)},e.prototype.destroy=function(){var t=this.layer;o&&(t.removeEventListener("mouseover",this.onMouse,!0),t.removeEventListener("mousedown",this.onMouse,!0),t.removeEventListener("mouseup",this.onMouse,!0)),t.removeEventListener("click",this.onClick,!0),t.removeEventListener("touchstart",this.onTouchStart,!1),t.removeEventListener("touchmove",this.onTouchMove,!1),t.removeEventListener("touchend",this.onTouchEnd,!1),t.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(t){var e,n,i;if(void 0===window.ontouchstart)return!0;if(n=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!o)return!0;if(e=document.querySelector("meta[name=viewport]")){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(n>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(s&&(i=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/))[1]>=10&&i[2]>=3&&(e=document.querySelector("meta[name=viewport]"))){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===t.style.msTouchAction||"manipulation"===t.style.touchAction||(!!(+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]>=27&&(e=document.querySelector("meta[name=viewport]"))&&(-1!==e.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))||("none"===t.style.touchAction||"manipulation"===t.style.touchAction))},e.attach=function(t,n){return new e(t,n)},"function"==typeof t&&"object"==typeof t.amd&&t.amd?t(function(){return e}):"undefined"!=typeof module&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e}();
},{}],234:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},e=require("svelte/internal"),n=require("./"),o=require("svelte");function r(t){let n,o,r;const s=[t[0]];var i=t[1];function p(t){let n={};for(let t=0;t<s.length;t+=1)n=(0,e.assign)(n,s[t]);return{props:n}}return i&&(n=new i(p())),{c(){n&&(0,e.create_component)(n.$$.fragment),o=(0,e.empty)()},m(t,s){n&&(0,e.mount_component)(n,t,s),(0,e.insert)(t,o,s),r=!0},p(t,[r]){const c=1&r?(0,e.get_spread_update)(s,[(0,e.get_spread_object)(t[0])]):{};if(i!==(i=t[1])){if(n){(0,e.group_outros)();const t=n;(0,e.transition_out)(t.$$.fragment,1,0,()=>{(0,e.destroy_component)(t,1)}),(0,e.check_outros)()}i?(n=new i(p()),(0,e.create_component)(n.$$.fragment),(0,e.transition_in)(n.$$.fragment,1),(0,e.mount_component)(n,o.parentNode,o)):n=null}else i&&n.$set(c)},i(t){r||(n&&(0,e.transition_in)(n.$$.fragment,t),r=!0)},o(t){n&&(0,e.transition_out)(n.$$.fragment,t),r=!1},d(t){t&&(0,e.detach)(o),n&&(0,e.destroy_component)(n,t)}}}function s(e,r,s){let{entity:i}=r,{props:p}=r,{component:c}=r;const a=(0,o.getContext)(n.CONTEXT_KEY_NODE);return(0,o.setContext)(n.CONTEXT_KEY_NODE,t({},a,{entity:i})),e.$$set=(t=>{"entity"in t&&s(2,i=t.entity),"props"in t&&s(0,p=t.props),"component"in t&&s(1,c=t.component)}),[p,c,i]}class i extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,s,r,e.safe_not_equal,{entity:2,props:0,component:1})}}exports.default=i;
},{"svelte/internal":226,"./":225,"svelte":220}],78:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),t=require("./LayeredViewComponent.svelte"),n=o(t),r=require("./");function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){const r=e.slice();return r[1]=t[n],r}function s(t,o){let i,s,a;return s=new n.default({props:{props:o[1].get(r.ViewLayer).props,component:o[1].get(r.ViewLayer).component,entity:o[1]}}),{key:t,first:null,c(){i=(0,e.empty)(),(0,e.create_component)(s.$$.fragment),this.first=i},m(t,n){(0,e.insert)(t,i,n),(0,e.mount_component)(s,t,n),a=!0},p(e,t){const n={};1&t&&(n.props=e[1].get(r.ViewLayer).props),1&t&&(n.component=e[1].get(r.ViewLayer).component),1&t&&(n.entity=e[1]),s.$set(n)},i(t){a||((0,e.transition_in)(s.$$.fragment,t),a=!0)},o(t){(0,e.transition_out)(s.$$.fragment,t),a=!1},d(t){t&&(0,e.detach)(i),(0,e.destroy_component)(s,t)}}}function a(t){let n,o,a=[],l=new Map,c=t[0];const u=e=>e[1].get(r.ViewLayer).id;for(let e=0;e<c.length;e+=1){let n=i(t,c,e),r=u(n);l.set(r,a[e]=s(r,n))}return{c(){for(let e=0;e<a.length;e+=1)a[e].c();n=(0,e.empty)()},m(t,r){for(let e=0;e<a.length;e+=1)a[e].m(t,r);(0,e.insert)(t,n,r),o=!0},p(t,[r]){if(1&r){const o=t[0];(0,e.group_outros)(),a=(0,e.update_keyed_each)(a,r,u,1,t,o,l,n.parentNode,e.outro_and_destroy_block,s,n,i),(0,e.check_outros)()}},i(t){if(!o){for(let t=0;t<c.length;t+=1)(0,e.transition_in)(a[t]);o=!0}},o(t){for(let t=0;t<a.length;t+=1)(0,e.transition_out)(a[t]);o=!1},d(t){for(let e=0;e<a.length;e+=1)a[e].d(t);t&&(0,e.detach)(n)}}}function l(e,t,n){let{layers:o=[]}=t;return e.$$set=(e=>{"layers"in e&&n(0,o=e.layers)}),e.$$.update=(()=>{if(1&e.$$.dirty){const e=new Set;o.forEach(t=>{const n=t.get(r.ViewLayer).id;if(!n)throw new Error(`Must specify an ID for ViewLayer ${t.name} ${t.get(r.ViewLayer).component.name}`);if(e.has(n))throw new Error(`You already added the view layer with ID ${n}`);e.add(n)})}}),[o]}class c extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,l,a,e.safe_not_equal,{layers:0})}}exports.default=c;
},{"svelte/internal":226,"./LayeredViewComponent.svelte":234,"./":225}],33:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("svelte/internal"),t=require("."),n=require("svelte"),o=require("./LayeredView.svelte"),r=c(o),i=require("../config"),u=c(i),s=require("../overlays/NotSupportedOverlay.svelte"),a=c(s);function c(e){return e&&e.__esModule?e:{default:e}}function l(t){let n,o;return n=new r.default({props:{layers:t[2]}}),{c(){(0,e.create_component)(n.$$.fragment)},m(t,r){(0,e.mount_component)(n,t,r),o=!0},p(e,t){const o={};4&t&&(o.layers=e[2]),n.$set(o)},i(t){o||((0,e.transition_in)(n.$$.fragment,t),o=!0)},o(t){(0,e.transition_out)(n.$$.fragment,t),o=!1},d(t){(0,e.destroy_component)(n,t)}}}function d(t){let n,o;return n=new a.default({}),{c(){(0,e.create_component)(n.$$.fragment)},m(t,r){(0,e.mount_component)(n,t,r),o=!0},p:e.noop,i(t){o||((0,e.transition_in)(n.$$.fragment,t),o=!0)},o(t){(0,e.transition_out)(n.$$.fragment,t),o=!1},d(t){(0,e.destroy_component)(n,t)}}}function p(t){let n,o,r,i,u,s;const a=[d,l],c=[];function p(e,t){return e[0]?e[1]?1:-1:0}return~(n=p(t))&&(o=c[n]=a[n](t)),{c(){o&&o.c(),r=(0,e.empty)()},m(t,o){~n&&c[n].m(t,o),(0,e.insert)(t,r,o),i=!0,u||(s=(0,e.listen)(window,"contextmenu",_),u=!0)},p(t,[i]){let u=n;(n=p(t))===u?~n&&c[n].p(t,i):(o&&((0,e.group_outros)(),(0,e.transition_out)(c[u],1,1,()=>{c[u]=null}),(0,e.check_outros)()),~n?((o=c[n])?o.p(t,i):(o=c[n]=a[n](t)).c(),(0,e.transition_in)(o,1),o.m(r.parentNode,r)):o=null)},i(t){i||((0,e.transition_in)(o),i=!0)},o(t){(0,e.transition_out)(o),i=!1},d(t){~n&&c[n].d(t),t&&(0,e.detach)(r),u=!1,s()}}}const _=e=>e.preventDefault();function f(e,o,r){let{onCreate:s=(()=>{})}=o;const{world:a,viewLayerStore:c}=(0,t.createRootWorld)(),l=(0,u.default)(),d={world:a};(0,n.setContext)(t.CONTEXT_KEY_NODE,d);let p,_=!0,f=!1;return(0,n.onMount)(()=>{!async function(){r(1,f=!0),l.context?s(a):(r(0,_=!1),(0,i.hideLoader)())}()}),c.subscribe(e=>{r(2,p=e)}),e.$$set=(e=>{"onCreate"in e&&r(3,s=e.onCreate)}),[_,f,p,s]}class m extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,f,p,e.safe_not_equal,{onCreate:3})}}exports.default=m;
},{"svelte/internal":226,".":225,"svelte":220,"./LayeredView.svelte":78,"../config":28,"../overlays/NotSupportedOverlay.svelte":79}],11:[function(require,module,exports) {
"use strict";require("./polyfills");var e=require("./systems/initialize"),t=v(e),r=require("./util/query-string"),n=v(r),i=require("./tags"),s=S(i),u=require("./util/Assets"),a=v(u),l=require("./vendor/fastclick"),o=v(l),c=require("./alec-svelte/GameApp.svelte"),d=v(c),f=require("./config"),m=v(f),y=require("./systems/CanvasSystem"),q=v(y),g=require("./systems/LoadJSONSystem"),p=v(g);function S(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function v(e){return e&&e.__esModule?e:{default:e}}(0,o.default)(document.body);const w=(0,m.default)();let _;function h(){return _||(_=new Promise(e=>{const r=w.container||document.querySelector("main.content");new d.default({target:r,props:{onCreate:async function(r){await(0,t.default)(r);const n=r.hasSystem(q.default)?r.getSystem(q.default).instance:null;let i;r.hasSystem(p.default)&&(i=r.getSystem(p.default).instance);w.stop=(()=>{n&&(n.running=!1)}),w.start=(()=>{n&&(n.running=!0)}),w.load=(e=>{i&&i.load(e)}),w.world=r,w.Tags=s,e()}}})}))}w.init=h,!1!==w.autoInit&&window.requestAnimationFrame(()=>{w.init()});
},{"./polyfills":27,"./systems/initialize":29,"./util/query-string":30,"./tags":60,"./util/Assets":31,"./vendor/fastclick":32,"./alec-svelte/GameApp.svelte":33,"./config":28,"./systems/CanvasSystem":34,"./systems/LoadJSONSystem":35}],884:[function(require,module,exports) {
var t=null;function r(){return t||(t=e()),t}function e(){try{throw new Error}catch(r){var t=(""+r.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(t)return n(t[0])}return"/"}function n(t){return(""+t).replace(/^((?:https?|file|ftp):\/\/.+)\/[^\/]+$/,"$1")+"/"}exports.getBundleURL=r,exports.getBaseURL=n;
},{}],883:[function(require,module,exports) {
var r=require("./bundle-url").getBundleURL;function e(r){Array.isArray(r)||(r=[r]);var e=r[r.length-1];try{return Promise.resolve(require(e))}catch(n){if("MODULE_NOT_FOUND"===n.code)return new u(function(n,i){t(r.slice(0,-1)).then(function(){return require(e)}).then(n,i)});throw n}}function t(r){return Promise.all(r.map(s))}var n={};function i(r,e){n[r]=e}module.exports=exports=e,exports.load=t,exports.register=i;var o={};function s(e){var t;if(Array.isArray(e)&&(t=e[1],e=e[0]),o[e])return o[e];var i=(e.substring(e.lastIndexOf(".")+1,e.length)||e).toLowerCase(),s=n[i];return s?o[e]=s(r()+e).then(function(r){return r&&module.bundle.register(t,r),r}):void 0}function u(r){this.executor=r,this.promise=null}u.prototype.then=function(r,e){return null===this.promise&&(this.promise=new Promise(this.executor)),this.promise.then(r,e)},u.prototype.catch=function(r){return null===this.promise&&(this.promise=new Promise(this.executor)),this.promise.catch(r)};
},{"./bundle-url":884}],0:[function(require,module,exports) {
var b=require(883);b.load([["ico_about.060f66ff.png",16]]).then(function(){require(11);});
},{}]},{},[0], null)
//# sourceMappingURL=/SB-Playgrounds/games/nfb-wayfinder/src.49dab2f8.map
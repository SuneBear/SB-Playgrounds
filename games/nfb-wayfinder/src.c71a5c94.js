parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"R8wO":[function(require,module,exports) {
Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function r(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(a,e){return Array.isArray(e)?a.push.apply(a,r.call(e,t-1)):a.push(e),a},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(r){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});
},{}],"IV0r":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AmbientLight=mf,exports.AmbientLightProbe=Uf,exports.AnimationClip=dd,exports.AnimationLoader=wd,exports.AnimationMixer=vm,exports.AnimationObjectGroup=mm,exports.ArcCurve=Cd,exports.ArrayCamera=uh,exports.ArrowHelper=sg,exports.Audio=Zf,exports.AudioAnalyser=em,exports.AudioListener=Yf,exports.AudioLoader=Ff,exports.AxesHelper=ag,exports.AxisHelper=av,exports.BinaryTextureLoader=pv,exports.Bone=qh,exports.BooleanKeyframeTrack=sd,exports.BoundingBoxHelper=cv,exports.Box2=Em,exports.Box3=Ii,exports.Box3Helper=eg,exports.BoxHelper=tg,exports.BufferAttribute=br,exports.BufferGeometry=zr,exports.BufferGeometryLoader=Mf,exports.Camera=bo,exports.CameraHelper=Qm,exports.CanvasRenderer=mv,exports.CanvasTexture=yu,exports.CatmullRomCurve3=Bd,exports.CircleBufferGeometry=Hp,exports.CircleGeometry=zp,exports.Clock=Vf,exports.ClosedSplineCurve3=rv,exports.Color=ur,exports.ColorKeyframeTrack=ad,exports.CompressedTexture=vu,exports.CompressedTextureLoader=Md,exports.ConeBufferGeometry=Up,exports.ConeGeometry=Gp,exports.CubeCamera=To,exports.CubeTexture=gc,exports.CubeTextureLoader=Ed,exports.CubicBezierCurve=Xd,exports.CubicBezierCurve3=Yd,exports.CubicInterpolant=nd,exports.Curve=Ld,exports.CurvePath=ef,exports.CylinderBufferGeometry=Fp,exports.CylinderGeometry=Bp,exports.Cylindrical=Sm,exports.DataTexture=Ao,exports.DataTexture2DArray=vc,exports.DataTexture3D=yc,exports.DataTextureLoader=Sd,exports.DepthTexture=xu,exports.DirectionalLight=ff,exports.DirectionalLightHelper=Ym,exports.DirectionalLightShadow=df,exports.DiscreteInterpolant=rd,exports.DodecahedronBufferGeometry=Ou,exports.DodecahedronGeometry=Pu,exports.DynamicBufferAttribute=Yg,exports.EdgesGeometry=Ip,exports.EdgesHelper=lv,exports.EllipseCurve=Rd,exports.Euler=oi,exports.EventDispatcher=Dn,exports.ExtrudeBufferGeometry=bp,exports.ExtrudeGeometry=_p,exports.Face3=mr,exports.Face4=Dg,exports.FileLoader=bd,exports.Float32Attribute=nv,exports.Float32BufferAttribute=Rr,exports.Float64Attribute=iv,exports.Float64BufferAttribute=Cr,exports.Fog=xh,exports.FogExp2=yh,exports.Font=Pf,exports.FontLoader=Nf,exports.Frustum=Co,exports.Geometry=uo,exports.GridHelper=Vm,exports.Group=ph,exports.HemisphereLight=sf,exports.HemisphereLightHelper=km,exports.HemisphereLightProbe=Gf,exports.IcosahedronBufferGeometry=Cu,exports.IcosahedronGeometry=Ru,exports.ImageBitmapLoader=Rf,exports.ImageLoader=Td,exports.ImmediateRenderObject=Cm,exports.InstancedBufferAttribute=wf,exports.InstancedBufferGeometry=bf,exports.InstancedInterleavedBuffer=xm,exports.InstancedMesh=Qh,exports.Int16Attribute=Kg,exports.Int16BufferAttribute=Tr,exports.Int32Attribute=tv,exports.Int32BufferAttribute=Ar,exports.Int8Attribute=Zg,exports.Int8BufferAttribute=wr,exports.InterleavedBuffer=_h,exports.InterleavedBufferAttribute=wh,exports.Interpolant=ed,exports.JSONLoader=gv,exports.KeyframeTrack=od,exports.LOD=Hh,exports.LatheBufferGeometry=Pp,exports.LatheGeometry=Cp,exports.Layers=si,exports.LensFlare=yv,exports.Light=of,exports.LightProbe=yf,exports.LightShadow=af,exports.Line=ru,exports.Line3=Rm,exports.LineBasicMaterial=Kh,exports.LineCurve=Zd,exports.LineCurve3=Jd,exports.LineDashedMaterial=Kp,exports.LineLoop=cu,exports.LineSegments=au,exports.LinearInterpolant=id,exports.Loader=xd,exports.LoadingManager=vd,exports.Material=vr,exports.MaterialLoader=xf,exports.Matrix3=Fn,exports.Matrix4=ni,exports.Mesh=ro,exports.MeshBasicMaterial=yr,exports.MeshDepthMaterial=ih,exports.MeshDistanceMaterial=rh,exports.MeshFaceMaterial=Ug,exports.MeshLambertMaterial=Jp,exports.MeshMatcapMaterial=Qp,exports.MeshNormalMaterial=Zp,exports.MeshPhongMaterial=Xp,exports.MeshPhysicalMaterial=qp,exports.MeshStandardMaterial=Wp,exports.MeshToonMaterial=Yp,exports.MultiMaterial=zg,exports.NumberKeyframeTrack=cd,exports.Object3D=_i,exports.ObjectLoader=Tf,exports.OctahedronBufferGeometry=Lu,exports.OctahedronGeometry=Au,exports.OrthographicCamera=pf,exports.PMREMGenerator=Mg,exports.ParametricBufferGeometry=wu,exports.ParametricGeometry=bu,exports.Particle=kg,exports.ParticleBasicMaterial=Wg,exports.ParticleSystem=Vg,exports.ParticleSystemMaterial=qg,exports.Path=nf,exports.PerspectiveCamera=wo,exports.Plane=Ji,exports.PlaneBufferGeometry=Io,exports.PlaneGeometry=No,exports.PlaneHelper=ng,exports.PointCloud=Hg,exports.PointCloudMaterial=jg,exports.PointLight=uf,exports.PointLightHelper=Gm,exports.Points=fu,exports.PointsMaterial=lu,exports.PolarGridHelper=jm,exports.PolyhedronBufferGeometry=Su,exports.PolyhedronGeometry=Mu,exports.PositionalAudio=tm,exports.PropertyBinding=fm,exports.PropertyMixer=nm,exports.QuadraticBezierCurve=Qd,exports.QuadraticBezierCurve3=Kd,exports.Quaternion=Wn,exports.QuaternionKeyframeTrack=hd,exports.QuaternionLinearInterpolant=ld,exports.RawShaderMaterial=jp,exports.Ray=qi,exports.Raycaster=_m,exports.RectAreaLight=gf,exports.RingBufferGeometry=Rp,exports.RingGeometry=Lp,exports.Scene=bi,exports.ShaderMaterial=_o,exports.ShadowMaterial=Vp,exports.Shape=rf,exports.ShapeBufferGeometry=Dp,exports.ShapeGeometry=Op,exports.ShapePath=Cf,exports.Skeleton=Wh,exports.SkeletonHelper=Fm,exports.SkinnedMesh=kh,exports.Sphere=Gi,exports.SphereBufferGeometry=Ap,exports.SphereGeometry=Ep,exports.Spherical=Mm,exports.SphericalHarmonics3=vf,exports.Spline=sv,exports.SplineCurve=$d,exports.SplineCurve3=ov,exports.SpotLight=lf,exports.SpotLightHelper=Om,exports.SpotLightShadow=cf,exports.Sprite=Fh,exports.SpriteMaterial=Mh,exports.StereoCamera=kf,exports.StringKeyframeTrack=ud,exports.TetrahedronBufferGeometry=Eu,exports.TetrahedronGeometry=Tu,exports.TextBufferGeometry=Tp,exports.TextGeometry=Sp,exports.Texture=Hn,exports.TextureLoader=Ad,exports.TorusBufferGeometry=Gu,exports.TorusGeometry=Fu,exports.TorusKnotBufferGeometry=Bu,exports.TorusKnotGeometry=Iu,exports.Triangle=ar,exports.TubeBufferGeometry=Nu,exports.TubeGeometry=Du,exports.Uint16Attribute=$g,exports.Uint16BufferAttribute=Er,exports.Uint32Attribute=ev,exports.Uint32BufferAttribute=Lr,exports.Uint8Attribute=Jg,exports.Uint8BufferAttribute=Mr,exports.Uint8ClampedAttribute=Qg,exports.Uint8ClampedBufferAttribute=Sr,exports.Uniform=ym,exports.Vector2=Bn,exports.Vector3=Yn,exports.Vector4=kn,exports.VectorKeyframeTrack=pd,exports.Vertex=Xg,exports.VideoTexture=gu,exports.WebGL1Renderer=vh,exports.WebGLCubeRenderTarget=Eo,exports.WebGLMultisampleRenderTarget=jn,exports.WebGLRenderTarget=Vn,exports.WebGLRenderTargetCube=dv,exports.WebGLRenderer=gh,exports.WebGLUtils=hh,exports.WireframeGeometry=_u,exports.WireframeHelper=hv,exports.XHRLoader=uv,exports.NearestMipmapLinearFilter=exports.NearestMipMapNearestFilter=exports.NearestMipMapLinearFilter=exports.NearestFilter=exports.MultiplyOperation=exports.MultiplyBlending=exports.MixOperation=exports.MirroredRepeatWrapping=exports.MinEquation=exports.MaxEquation=exports.MathUtils=exports.Math=exports.MOUSE=exports.LuminanceFormat=exports.LuminanceAlphaFormat=exports.LoopRepeat=exports.LoopPingPong=exports.LoopOnce=exports.LogLuvEncoding=exports.LoaderUtils=exports.LinearToneMapping=exports.LinearMipmapNearestFilter=exports.LinearMipmapLinearFilter=exports.LinearMipMapNearestFilter=exports.LinearMipMapLinearFilter=exports.LinearFilter=exports.LinearEncoding=exports.LineStrip=exports.LinePieces=exports.LessStencilFunc=exports.LessEqualStencilFunc=exports.LessEqualDepth=exports.LessDepth=exports.KeepStencilOp=exports.InvertStencilOp=exports.InterpolateSmooth=exports.InterpolateLinear=exports.InterpolateDiscrete=exports.IntType=exports.IncrementWrapStencilOp=exports.IncrementStencilOp=exports.ImageUtils=exports.HalfFloatType=exports.GreaterStencilFunc=exports.GreaterEqualStencilFunc=exports.GreaterEqualDepth=exports.GreaterDepth=exports.GeometryUtils=exports.GammaEncoding=exports.FrontSide=exports.FrontFaceDirectionCW=exports.FrontFaceDirectionCCW=exports.FloatType=exports.FlatShading=exports.FaceColors=exports.EquirectangularRefractionMapping=exports.EquirectangularReflectionMapping=exports.EqualStencilFunc=exports.EqualDepth=exports.DynamicReadUsage=exports.DynamicDrawUsage=exports.DynamicCopyUsage=exports.DstColorFactor=exports.DstAlphaFactor=exports.DoubleSide=exports.DepthStencilFormat=exports.DepthFormat=exports.DefaultLoadingManager=exports.DecrementWrapStencilOp=exports.DecrementStencilOp=exports.CustomToneMapping=exports.CustomBlending=exports.CullFaceNone=exports.CullFaceFrontBack=exports.CullFaceFront=exports.CullFaceBack=exports.CubeUVRefractionMapping=exports.CubeUVReflectionMapping=exports.CubeRefractionMapping=exports.CubeReflectionMapping=exports.ClampToEdgeWrapping=exports.CineonToneMapping=exports.Cache=exports.ByteType=exports.CubeGeometry=exports.BoxGeometry=exports.BoxBufferGeometry=exports.BasicShadowMap=exports.BasicDepthPacking=exports.BackSide=exports.AudioContext=exports.AnimationUtils=exports.AlwaysStencilFunc=exports.AlwaysDepth=exports.AlphaFormat=exports.AdditiveBlending=exports.AdditiveAnimationBlendMode=exports.AddOperation=exports.AddEquation=exports.ACESFilmicToneMapping=void 0,exports.UVMapping=exports.TrianglesDrawMode=exports.TriangleStripDrawMode=exports.TriangleFanDrawMode=exports.TangentSpaceNormalMap=exports.TOUCH=exports.SubtractiveBlending=exports.SubtractEquation=exports.StreamReadUsage=exports.StreamDrawUsage=exports.StreamCopyUsage=exports.StaticReadUsage=exports.StaticDrawUsage=exports.StaticCopyUsage=exports.SrcColorFactor=exports.SrcAlphaSaturateFactor=exports.SrcAlphaFactor=exports.SmoothShading=exports.ShortType=exports.ShapeUtils=exports.ShaderLib=exports.ShaderChunk=exports.SceneUtils=exports.SRGB8_ALPHA8_ASTC_8x8_Format=exports.SRGB8_ALPHA8_ASTC_8x6_Format=exports.SRGB8_ALPHA8_ASTC_8x5_Format=exports.SRGB8_ALPHA8_ASTC_6x6_Format=exports.SRGB8_ALPHA8_ASTC_6x5_Format=exports.SRGB8_ALPHA8_ASTC_5x5_Format=exports.SRGB8_ALPHA8_ASTC_5x4_Format=exports.SRGB8_ALPHA8_ASTC_4x4_Format=exports.SRGB8_ALPHA8_ASTC_12x12_Format=exports.SRGB8_ALPHA8_ASTC_12x10_Format=exports.SRGB8_ALPHA8_ASTC_10x8_Format=exports.SRGB8_ALPHA8_ASTC_10x6_Format=exports.SRGB8_ALPHA8_ASTC_10x5_Format=exports.SRGB8_ALPHA8_ASTC_10x10_Format=exports.ReverseSubtractEquation=exports.ReplaceStencilOp=exports.RepeatWrapping=exports.ReinhardToneMapping=exports.RedIntegerFormat=exports.RedFormat=exports.RGIntegerFormat=exports.RGFormat=exports.RGB_S3TC_DXT1_Format=exports.RGB_PVRTC_4BPPV1_Format=exports.RGB_PVRTC_2BPPV1_Format=exports.RGB_ETC2_Format=exports.RGB_ETC1_Format=exports.RGBM7Encoding=exports.RGBM16Encoding=exports.RGBIntegerFormat=exports.RGBFormat=exports.RGBEFormat=exports.RGBEEncoding=exports.RGBDEncoding=exports.RGBA_S3TC_DXT5_Format=exports.RGBA_S3TC_DXT3_Format=exports.RGBA_S3TC_DXT1_Format=exports.RGBA_PVRTC_4BPPV1_Format=exports.RGBA_PVRTC_2BPPV1_Format=exports.RGBA_ETC2_EAC_Format=exports.RGBA_BPTC_Format=exports.RGBA_ASTC_8x8_Format=exports.RGBA_ASTC_8x6_Format=exports.RGBA_ASTC_8x5_Format=exports.RGBA_ASTC_6x6_Format=exports.RGBA_ASTC_6x5_Format=exports.RGBA_ASTC_5x5_Format=exports.RGBA_ASTC_5x4_Format=exports.RGBA_ASTC_4x4_Format=exports.RGBA_ASTC_12x12_Format=exports.RGBA_ASTC_12x10_Format=exports.RGBA_ASTC_10x8_Format=exports.RGBA_ASTC_10x6_Format=exports.RGBA_ASTC_10x5_Format=exports.RGBA_ASTC_10x10_Format=exports.RGBAIntegerFormat=exports.RGBAFormat=exports.RGBADepthPacking=exports.REVISION=exports.PCFSoftShadowMap=exports.PCFShadowMap=exports.OneMinusSrcColorFactor=exports.OneMinusSrcAlphaFactor=exports.OneMinusDstColorFactor=exports.OneMinusDstAlphaFactor=exports.OneFactor=exports.ObjectSpaceNormalMap=exports.NotEqualStencilFunc=exports.NotEqualDepth=exports.NormalBlending=exports.NormalAnimationBlendMode=exports.NoToneMapping=exports.NoColors=exports.NoBlending=exports.NeverStencilFunc=exports.NeverDepth=exports.NearestMipmapNearestFilter=void 0,exports.sRGBEncoding=exports.ZeroStencilOp=exports.ZeroSlopeEnding=exports.ZeroFactor=exports.ZeroCurvatureEnding=exports.WrapAroundEnding=exports.VertexColors=exports.VSMShadowMap=exports.UnsignedShortType=exports.UnsignedShort565Type=exports.UnsignedShort5551Type=exports.UnsignedShort4444Type=exports.UnsignedIntType=exports.UnsignedInt248Type=exports.UnsignedByteType=exports.UniformsUtils=exports.UniformsLib=void 0,void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");const e=Object(t);for(let n=1;n<arguments.length;n++){const t=arguments[n];if(null!=t)for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e});const t="118";exports.REVISION="118";const e={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2};exports.MOUSE=e;const n={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3};exports.TOUCH=n;const i=0;exports.CullFaceNone=i;const r=1;exports.CullFaceBack=r;const o=2;exports.CullFaceFront=o;const s=3;exports.CullFaceFrontBack=3;const a=0;exports.FrontFaceDirectionCW=0;const c=1;exports.FrontFaceDirectionCCW=1;const l=0;exports.BasicShadowMap=0;const h=1;exports.PCFShadowMap=h;const u=2;exports.PCFSoftShadowMap=u;const p=3;exports.VSMShadowMap=p;const d=0;exports.FrontSide=d;const f=1;exports.BackSide=f;const m=2;exports.DoubleSide=m;const g=1;exports.FlatShading=1;const v=2;exports.SmoothShading=2;const y=0;exports.NoBlending=y;const x=1;exports.NormalBlending=x;const _=2;exports.AdditiveBlending=_;const b=3;exports.SubtractiveBlending=b;const w=4;exports.MultiplyBlending=w;const M=5;exports.CustomBlending=M;const S=100;exports.AddEquation=S;const T=101;exports.SubtractEquation=T;const E=102;exports.ReverseSubtractEquation=E;const A=103;exports.MinEquation=A;const L=104;exports.MaxEquation=L;const R=200;exports.ZeroFactor=R;const C=201;exports.OneFactor=C;const P=202;exports.SrcColorFactor=P;const O=203;exports.OneMinusSrcColorFactor=O;const D=204;exports.SrcAlphaFactor=D;const N=205;exports.OneMinusSrcAlphaFactor=N;const I=206;exports.DstAlphaFactor=I;const B=207;exports.OneMinusDstAlphaFactor=B;const F=208;exports.DstColorFactor=F;const G=209;exports.OneMinusDstColorFactor=G;const U=210;exports.SrcAlphaSaturateFactor=U;const z=0;exports.NeverDepth=z;const H=1;exports.AlwaysDepth=H;const k=2;exports.LessDepth=k;const V=3;exports.LessEqualDepth=V;const j=4;exports.EqualDepth=j;const W=5;exports.GreaterEqualDepth=W;const q=6;exports.GreaterDepth=q;const X=7;exports.NotEqualDepth=X;const Y=0;exports.MultiplyOperation=Y;const Z=1;exports.MixOperation=Z;const J=2;exports.AddOperation=J;const Q=0;exports.NoToneMapping=Q;const K=1;exports.LinearToneMapping=K;const $=2;exports.ReinhardToneMapping=$;const tt=3;exports.CineonToneMapping=tt;const et=4;exports.ACESFilmicToneMapping=et;const nt=5;exports.CustomToneMapping=nt;const it=300;exports.UVMapping=300;const rt=301;exports.CubeReflectionMapping=rt;const ot=302;exports.CubeRefractionMapping=ot;const st=303;exports.EquirectangularReflectionMapping=st;const at=304;exports.EquirectangularRefractionMapping=at;const ct=306;exports.CubeUVReflectionMapping=ct;const lt=307;exports.CubeUVRefractionMapping=lt;const ht=1e3;exports.RepeatWrapping=ht;const ut=1001;exports.ClampToEdgeWrapping=ut;const pt=1002;exports.MirroredRepeatWrapping=pt;const dt=1003;exports.NearestFilter=dt;const ft=1004;exports.NearestMipmapNearestFilter=ft;const mt=1004;exports.NearestMipMapNearestFilter=1004;const gt=1005;exports.NearestMipmapLinearFilter=gt;const vt=1005;exports.NearestMipMapLinearFilter=1005;const yt=1006;exports.LinearFilter=yt;const xt=1007;exports.LinearMipmapNearestFilter=xt;const _t=1007;exports.LinearMipMapNearestFilter=1007;const bt=1008;exports.LinearMipmapLinearFilter=bt;const wt=1008;exports.LinearMipMapLinearFilter=1008;const Mt=1009;exports.UnsignedByteType=Mt;const St=1010;exports.ByteType=St;const Tt=1011;exports.ShortType=Tt;const Et=1012;exports.UnsignedShortType=Et;const At=1013;exports.IntType=At;const Lt=1014;exports.UnsignedIntType=Lt;const Rt=1015;exports.FloatType=Rt;const Ct=1016;exports.HalfFloatType=Ct;const Pt=1017;exports.UnsignedShort4444Type=Pt;const Ot=1018;exports.UnsignedShort5551Type=Ot;const Dt=1019;exports.UnsignedShort565Type=Dt;const Nt=1020;exports.UnsignedInt248Type=Nt;const It=1021;exports.AlphaFormat=It;const Bt=1022;exports.RGBFormat=Bt;const Ft=1023;exports.RGBAFormat=Ft;const Gt=1024;exports.LuminanceFormat=Gt;const Ut=1025;exports.LuminanceAlphaFormat=Ut;const zt=Ft;exports.RGBEFormat=zt;const Ht=1026;exports.DepthFormat=Ht;const kt=1027;exports.DepthStencilFormat=kt;const Vt=1028;exports.RedFormat=Vt;const jt=1029;exports.RedIntegerFormat=jt;const Wt=1030;exports.RGFormat=Wt;const qt=1031;exports.RGIntegerFormat=qt;const Xt=1032;exports.RGBIntegerFormat=Xt;const Yt=1033;exports.RGBAIntegerFormat=Yt;const Zt=33776;exports.RGB_S3TC_DXT1_Format=Zt;const Jt=33777;exports.RGBA_S3TC_DXT1_Format=Jt;const Qt=33778;exports.RGBA_S3TC_DXT3_Format=Qt;const Kt=33779;exports.RGBA_S3TC_DXT5_Format=Kt;const $t=35840;exports.RGB_PVRTC_4BPPV1_Format=$t;const te=35841;exports.RGB_PVRTC_2BPPV1_Format=te;const ee=35842;exports.RGBA_PVRTC_4BPPV1_Format=ee;const ne=35843;exports.RGBA_PVRTC_2BPPV1_Format=ne;const ie=36196;exports.RGB_ETC1_Format=ie;const re=37492;exports.RGB_ETC2_Format=re;const oe=37496;exports.RGBA_ETC2_EAC_Format=oe;const se=37808;exports.RGBA_ASTC_4x4_Format=se;const ae=37809;exports.RGBA_ASTC_5x4_Format=ae;const ce=37810;exports.RGBA_ASTC_5x5_Format=ce;const le=37811;exports.RGBA_ASTC_6x5_Format=le;const he=37812;exports.RGBA_ASTC_6x6_Format=he;const ue=37813;exports.RGBA_ASTC_8x5_Format=ue;const pe=37814;exports.RGBA_ASTC_8x6_Format=pe;const de=37815;exports.RGBA_ASTC_8x8_Format=de;const fe=37816;exports.RGBA_ASTC_10x5_Format=fe;const me=37817;exports.RGBA_ASTC_10x6_Format=me;const ge=37818;exports.RGBA_ASTC_10x8_Format=ge;const ve=37819;exports.RGBA_ASTC_10x10_Format=ve;const ye=37820;exports.RGBA_ASTC_12x10_Format=ye;const xe=37821;exports.RGBA_ASTC_12x12_Format=xe;const _e=36492;exports.RGBA_BPTC_Format=_e;const be=37840;exports.SRGB8_ALPHA8_ASTC_4x4_Format=be;const we=37841;exports.SRGB8_ALPHA8_ASTC_5x4_Format=we;const Me=37842;exports.SRGB8_ALPHA8_ASTC_5x5_Format=Me;const Se=37843;exports.SRGB8_ALPHA8_ASTC_6x5_Format=Se;const Te=37844;exports.SRGB8_ALPHA8_ASTC_6x6_Format=Te;const Ee=37845;exports.SRGB8_ALPHA8_ASTC_8x5_Format=Ee;const Ae=37846;exports.SRGB8_ALPHA8_ASTC_8x6_Format=Ae;const Le=37847;exports.SRGB8_ALPHA8_ASTC_8x8_Format=Le;const Re=37848;exports.SRGB8_ALPHA8_ASTC_10x5_Format=Re;const Ce=37849;exports.SRGB8_ALPHA8_ASTC_10x6_Format=Ce;const Pe=37850;exports.SRGB8_ALPHA8_ASTC_10x8_Format=Pe;const Oe=37851;exports.SRGB8_ALPHA8_ASTC_10x10_Format=Oe;const De=37852;exports.SRGB8_ALPHA8_ASTC_12x10_Format=De;const Ne=37853;exports.SRGB8_ALPHA8_ASTC_12x12_Format=Ne;const Ie=2200;exports.LoopOnce=2200;const Be=2201;exports.LoopRepeat=Be;const Fe=2202;exports.LoopPingPong=2202;const Ge=2300;exports.InterpolateDiscrete=2300;const Ue=2301;exports.InterpolateLinear=2301;const ze=2302;exports.InterpolateSmooth=2302;const He=2400;exports.ZeroCurvatureEnding=He;const ke=2401;exports.ZeroSlopeEnding=2401;const Ve=2402;exports.WrapAroundEnding=2402;const je=2500;exports.NormalAnimationBlendMode=je;const We=2501;exports.AdditiveAnimationBlendMode=2501;const qe=0;exports.TrianglesDrawMode=0;const Xe=1;exports.TriangleStripDrawMode=1;const Ye=2;exports.TriangleFanDrawMode=2;const Ze=3e3;exports.LinearEncoding=Ze;const Je=3001;exports.sRGBEncoding=Je;const Qe=3007;exports.GammaEncoding=Qe;const Ke=3002;exports.RGBEEncoding=Ke;const $e=3003;exports.LogLuvEncoding=$e;const tn=3004;exports.RGBM7Encoding=tn;const en=3005;exports.RGBM16Encoding=en;const nn=3006;exports.RGBDEncoding=nn;const rn=3200;exports.BasicDepthPacking=rn;const on=3201;exports.RGBADepthPacking=on;const sn=0;exports.TangentSpaceNormalMap=sn;const an=1;exports.ObjectSpaceNormalMap=an;const cn=0;exports.ZeroStencilOp=0;const ln=7680;exports.KeepStencilOp=ln;const hn=7681;exports.ReplaceStencilOp=7681;const un=7682;exports.IncrementStencilOp=7682;const pn=7683;exports.DecrementStencilOp=7683;const dn=34055;exports.IncrementWrapStencilOp=34055;const fn=34056;exports.DecrementWrapStencilOp=34056;const mn=5386;exports.InvertStencilOp=5386;const gn=512;exports.NeverStencilFunc=512;const vn=513;exports.LessStencilFunc=513;const yn=514;exports.EqualStencilFunc=514;const xn=515;exports.LessEqualStencilFunc=515;const _n=516;exports.GreaterStencilFunc=516;const bn=517;exports.NotEqualStencilFunc=517;const wn=518;exports.GreaterEqualStencilFunc=518;const Mn=519;exports.AlwaysStencilFunc=Mn;const Sn=35044;exports.StaticDrawUsage=Sn;const Tn=35048;exports.DynamicDrawUsage=Tn;const En=35040;exports.StreamDrawUsage=35040;const An=35045;exports.StaticReadUsage=35045;const Ln=35049;exports.DynamicReadUsage=35049;const Rn=35041;exports.StreamReadUsage=35041;const Cn=35046;exports.StaticCopyUsage=35046;const Pn=35050;exports.DynamicCopyUsage=35050;const On=35042;function Dn(){}exports.StreamCopyUsage=35042,Object.assign(Dn.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}},dispatchEvent:function(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,i=n.length;e<i;e++)n[e].call(this,t)}}});const Nn=[];for(let xv=0;xv<256;xv++)Nn[xv]=(xv<16?"0":"")+xv.toString(16);const In={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Nn[255&t]+Nn[t>>8&255]+Nn[t>>16&255]+Nn[t>>24&255]+"-"+Nn[255&e]+Nn[e>>8&255]+"-"+Nn[e>>16&15|64]+Nn[e>>24&255]+"-"+Nn[63&n|128]+Nn[n>>8&255]+"-"+Nn[n>>16&255]+Nn[n>>24&255]+Nn[255&i]+Nn[i>>8&255]+Nn[i>>16&255]+Nn[i>>24&255]).toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*In.DEG2RAD},radToDeg:function(t){return t*In.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,i,r){const o=Math.cos,s=Math.sin,a=o(n/2),c=s(n/2),l=o((e+i)/2),h=s((e+i)/2),u=o((e-i)/2),p=s((e-i)/2),d=o((i-e)/2),f=s((i-e)/2);switch(r){case"XYX":t.set(a*h,c*u,c*p,a*l);break;case"YZY":t.set(c*p,a*h,c*u,a*l);break;case"ZXZ":t.set(c*u,c*p,a*h,a*l);break;case"XZX":t.set(a*h,c*f,c*d,a*l);break;case"YXY":t.set(c*d,a*h,c*f,a*l);break;case"ZYZ":t.set(c*f,c*d,a*h,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}};function Bn(t=0,e=0){this.x=t,this.y=e}function Fn(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}let Gn;exports.MathUtils=exports.Math=In,Object.defineProperties(Bn.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(Bn.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*n-o*i+t.x,this.y=r*i+o*n+t.y,this},random:function(){return this.x=Math.random(),this.y=Math.random(),this}}),Object.assign(Fn.prototype,{isMatrix3:!0,set:function(t,e,n,i,r,o,s,a,c){const l=this.elements;return l[0]=t,l[1]=i,l[2]=s,l[3]=e,l[4]=r,l[5]=a,l[6]=n,l[7]=o,l[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},extractBasis:function(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){const n=t.elements,i=e.elements,r=this.elements,o=n[0],s=n[3],a=n[6],c=n[1],l=n[4],h=n[7],u=n[2],p=n[5],d=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],x=i[7],_=i[2],b=i[5],w=i[8];return r[0]=o*f+s*v+a*_,r[3]=o*m+s*y+a*b,r[6]=o*g+s*x+a*w,r[1]=c*f+l*v+h*_,r[4]=c*m+l*y+h*b,r[7]=c*g+l*x+h*w,r[2]=u*f+p*v+d*_,r[5]=u*m+p*y+d*b,r[8]=u*g+p*x+d*w,this},multiplyScalar:function(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],s=t[5],a=t[6],c=t[7],l=t[8];return e*o*l-e*s*c-n*r*l+n*s*a+i*r*c-i*o*a},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");const n=t.elements,i=this.elements,r=n[0],o=n[1],s=n[2],a=n[3],c=n[4],l=n[5],h=n[6],u=n[7],p=n[8],d=p*c-l*u,f=l*h-p*a,m=u*a-c*h,g=r*d+o*f+s*m;if(0===g)return this.set(0,0,0,0,0,0,0,0,0);const v=1/g;return i[0]=d*v,i[1]=(s*u-p*o)*v,i[2]=(l*o-s*c)*v,i[3]=f*v,i[4]=(p*r-s*h)*v,i[5]=(s*a-l*r)*v,i[6]=m*v,i[7]=(o*h-u*r)*v,i[8]=(c*r-o*a)*v,this},transpose:function(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,n,i,r,o,s){const a=Math.cos(r),c=Math.sin(r);this.set(n*a,n*c,-n*(a*o+c*s)+o+t,-i*c,i*a,-i*(-c*o+a*s)+s+e,0,0,1)},scale:function(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},rotate:function(t){const e=Math.cos(t),n=Math.sin(t),i=this.elements,r=i[0],o=i[3],s=i[6],a=i[1],c=i[4],l=i[7];return i[0]=e*r+n*a,i[3]=e*o+n*c,i[6]=e*s+n*l,i[1]=-n*r+e*a,i[4]=-n*o+e*c,i[7]=-n*s+e*l,this},translate:function(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},equals:function(t){const e=this.elements,n=t.elements;for(let i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}});const Un={getDataURL:function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Gn&&(Gn=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Gn.width=t.width,Gn.height=t.height;const n=Gn.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Gn}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}};exports.ImageUtils=Un;let zn=0;function Hn(t,e,n,i,r,o,s,a,c,l){Object.defineProperty(this,"id",{value:zn++}),this.uuid=In.generateUUID(),this.name="",this.image=void 0!==t?t:Hn.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:Hn.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:ut,this.wrapT=void 0!==i?i:ut,this.magFilter=void 0!==r?r:yt,this.minFilter=void 0!==o?o:bt,this.anisotropy=void 0!==c?c:1,this.format=void 0!==s?s:Ft,this.internalFormat=null,this.type=void 0!==a?a:Mt,this.offset=new Bn(0,0),this.repeat=new Bn(1,1),this.center=new Bn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Fn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==l?l:Ze,this.version=0,this.onUpdate=null}function kn(t=0,e=0,n=0,i=1){this.x=t,this.y=e,this.z=n,this.w=i}function Vn(t,e,n){this.width=t,this.height=e,this.scissor=new kn(0,0,t,e),this.scissorTest=!1,this.viewport=new kn(0,0,t,e),n=n||{},this.texture=new Hn(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:yt,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function jn(t,e,n){Vn.call(this,t,e,n),this.samples=4}function Wn(t=0,e=0,n=0,i=1){this._x=t,this._y=e,this._z=n,this._w=i}Hn.DEFAULT_IMAGE=void 0,Hn.DEFAULT_MAPPING=300,Hn.prototype=Object.assign(Object.create(Dn.prototype),{constructor:Hn,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=In.generateUUID()),!e&&void 0===t.images[i.uuid]){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)e.push(Un.getDataURL(i[t]))}else e=Un.getDataURL(i);t.images[i.uuid]={uuid:i.uuid,url:e}}n.image=i.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case ht:t.x=t.x-Math.floor(t.x);break;case ut:t.x=t.x<0?0:1;break;case pt:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case ht:t.y=t.y-Math.floor(t.y);break;case ut:t.y=t.y<0?0:1;break;case pt:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Hn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.defineProperties(kn.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(kn.prototype,{isVector4:!0,set:function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){const e=this.x,n=this.y,i=this.z,r=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*e+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*e+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*e+o[7]*n+o[11]*i+o[15]*r,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){let e,n,i,r;const o=t.elements,s=o[0],a=o[4],c=o[8],l=o[1],h=o[5],u=o[9],p=o[2],d=o[6],f=o[10];if(Math.abs(a-l)<.01&&Math.abs(c-p)<.01&&Math.abs(u-d)<.01){if(Math.abs(a+l)<.1&&Math.abs(c+p)<.1&&Math.abs(u+d)<.1&&Math.abs(s+h+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const t=(s+1)/2,o=(h+1)/2,m=(f+1)/2,g=(a+l)/4,v=(c+p)/4,y=(u+d)/4;return t>o&&t>m?t<.01?(n=0,i=.707106781,r=.707106781):(i=g/(n=Math.sqrt(t)),r=v/n):o>m?o<.01?(n=.707106781,i=0,r=.707106781):(n=g/(i=Math.sqrt(o)),r=y/i):m<.01?(n=.707106781,i=.707106781,r=0):(n=v/(r=Math.sqrt(m)),i=y/r),this.set(n,i,r,e),this}let m=Math.sqrt((d-u)*(d-u)+(c-p)*(c-p)+(l-a)*(l-a));return Math.abs(m)<.001&&(m=1),this.x=(d-u)/m,this.y=(c-p)/m,this.z=(l-a)/m,this.w=Math.acos((s+h+f-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},clampLength:function(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}),Vn.prototype=Object.assign(Object.create(Dn.prototype),{constructor:Vn,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),jn.prototype=Object.assign(Object.create(Vn.prototype),{constructor:jn,isWebGLMultisampleRenderTarget:!0,copy:function(t){return Vn.prototype.copy.call(this,t),this.samples=t.samples,this}}),Object.assign(Wn,{slerp:function(t,e,n,i){return n.copy(t).slerp(e,i)},slerpFlat:function(t,e,n,i,r,o,s){let a=n[i+0],c=n[i+1],l=n[i+2],h=n[i+3];const u=r[o+0],p=r[o+1],d=r[o+2],f=r[o+3];if(h!==f||a!==u||c!==p||l!==d){let t=1-s,e=a*u+c*p+l*d+h*f,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,e*n);t=Math.sin(t*o)/r,s=Math.sin(s*o)/r}const r=s*n;if(a=a*t+u*r,c=c*t+p*r,l=l*t+d*r,h=h*t+f*r,t===1-s){const t=1/Math.sqrt(a*a+c*c+l*l+h*h);a*=t,c*=t,l*=t,h*=t}}t[e]=a,t[e+1]=c,t[e+2]=l,t[e+3]=h},multiplyQuaternionsFlat:function(t,e,n,i,r,o){const s=n[i],a=n[i+1],c=n[i+2],l=n[i+3],h=r[o],u=r[o+1],p=r[o+2],d=r[o+3];return t[e]=s*d+l*h+a*p-c*u,t[e+1]=a*d+l*u+c*h-s*p,t[e+2]=c*d+l*p+s*u-a*h,t[e+3]=l*d-s*h-a*u-c*p,t}}),Object.defineProperties(Wn.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(Wn.prototype,{isQuaternion:!0,set:function(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,i=t._y,r=t._z,o=t.order,s=Math.cos,a=Math.sin,c=s(n/2),l=s(i/2),h=s(r/2),u=a(n/2),p=a(i/2),d=a(r/2);switch(o){case"XYZ":this._x=u*l*h+c*p*d,this._y=c*p*h-u*l*d,this._z=c*l*d+u*p*h,this._w=c*l*h-u*p*d;break;case"YXZ":this._x=u*l*h+c*p*d,this._y=c*p*h-u*l*d,this._z=c*l*d-u*p*h,this._w=c*l*h+u*p*d;break;case"ZXY":this._x=u*l*h-c*p*d,this._y=c*p*h+u*l*d,this._z=c*l*d+u*p*h,this._w=c*l*h-u*p*d;break;case"ZYX":this._x=u*l*h-c*p*d,this._y=c*p*h+u*l*d,this._z=c*l*d-u*p*h,this._w=c*l*h+u*p*d;break;case"YZX":this._x=u*l*h+c*p*d,this._y=c*p*h+u*l*d,this._z=c*l*d-u*p*h,this._w=c*l*h-u*p*d;break;case"XZY":this._x=u*l*h-c*p*d,this._y=c*p*h-u*l*d,this._z=c*l*d+u*p*h,this._w=c*l*h+u*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(t){const e=t.elements,n=e[0],i=e[4],r=e[8],o=e[1],s=e[5],a=e[9],c=e[2],l=e[6],h=e[10],u=n+s+h;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(l-a)*t,this._y=(r-c)*t,this._z=(o-i)*t}else if(n>s&&n>h){const t=2*Math.sqrt(1+n-s-h);this._w=(l-a)/t,this._x=.25*t,this._y=(i+o)/t,this._z=(r+c)/t}else if(s>h){const t=2*Math.sqrt(1+s-n-h);this._w=(r-c)/t,this._x=(i+o)/t,this._y=.25*t,this._z=(a+l)/t}else{const t=2*Math.sqrt(1+h-n-s);this._w=(o-i)/t,this._x=(r+c)/t,this._y=(a+l)/t,this._z=.25*t}return this._onChangeCallback(),this},setFromUnitVectors:function(t,e){let n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(In.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){const n=t._x,i=t._y,r=t._z,o=t._w,s=e._x,a=e._y,c=e._z,l=e._w;return this._x=n*l+o*s+i*c-r*a,this._y=i*l+o*a+r*s-n*c,this._z=r*l+o*c+n*a-i*s,this._w=o*l-n*s-i*a-r*c,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,o=this._w;let s=o*t._w+n*t._x+i*t._y+r*t._z;if(s<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,s=-s):this.copy(t),s>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const a=1-s*s;if(a<=Number.EPSILON){const t=1-e;return this._w=t*o+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(a),l=Math.atan2(c,s),h=Math.sin((1-e)*l)/c,u=Math.sin(e*l)/c;return this._w=o*h+this._w*u,this._x=n*h+this._x*u,this._y=i*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},fromBufferAttribute:function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});const qn=new Yn,Xn=new Wn;function Yn(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}Object.assign(Yn.prototype,{isVector3:!0,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Xn.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(Xn.setFromAxisAngle(t,e))},applyMatrix3:function(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){const e=this.x,n=this.y,i=this.z,r=t.elements,o=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*o,this},applyQuaternion:function(t){const e=this.x,n=this.y,i=this.z,r=t.x,o=t.y,s=t.z,a=t.w,c=a*e+o*i-s*n,l=a*n+s*e-r*i,h=a*i+r*n-o*e,u=-r*e-o*n-s*i;return this.x=c*a+u*-r+l*-s-h*-o,this.y=l*a+u*-o+h*-r-c*-s,this.z=h*a+u*-s+c*-o-l*-r,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){const n=t.x,i=t.y,r=t.z,o=e.x,s=e.y,a=e.z;return this.x=i*a-r*s,this.y=r*o-n*a,this.z=n*s-i*o,this},projectOnVector:function(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)},projectOnPlane:function(t){return qn.copy(this).projectOnVector(t),this.sub(qn)},reflect:function(t){return this.sub(qn.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(In.clamp(n,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},setFromMatrix3Column:function(t,e){return this.fromArray(t.elements,3*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}});const Zn=new Yn,Jn=new ni,Qn=new Yn(0,0,0),Kn=new Yn(1,1,1),$n=new Yn,ti=new Yn,ei=new Yn;function ni(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(ni.prototype,{isMatrix4:!0,set:function(t,e,n,i,r,o,s,a,c,l,h,u,p,d,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=c,g[6]=l,g[10]=h,g[14]=u,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new ni).fromArray(this.elements)},copy:function(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},copyPosition:function(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},extractBasis:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},extractRotation:function(t){const e=this.elements,n=t.elements,i=1/Zn.setFromMatrixColumn(t,0).length(),r=1/Zn.setFromMatrixColumn(t,1).length(),o=1/Zn.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,i=t.y,r=t.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(i),c=Math.sin(i),l=Math.cos(r),h=Math.sin(r);if("XYZ"===t.order){const t=o*l,n=o*h,i=s*l,r=s*h;e[0]=a*l,e[4]=-a*h,e[8]=c,e[1]=n+i*c,e[5]=t-r*c,e[9]=-s*a,e[2]=r-t*c,e[6]=i+n*c,e[10]=o*a}else if("YXZ"===t.order){const t=a*l,n=a*h,i=c*l,r=c*h;e[0]=t+r*s,e[4]=i*s-n,e[8]=o*c,e[1]=o*h,e[5]=o*l,e[9]=-s,e[2]=n*s-i,e[6]=r+t*s,e[10]=o*a}else if("ZXY"===t.order){const t=a*l,n=a*h,i=c*l,r=c*h;e[0]=t-r*s,e[4]=-o*h,e[8]=i+n*s,e[1]=n+i*s,e[5]=o*l,e[9]=r-t*s,e[2]=-o*c,e[6]=s,e[10]=o*a}else if("ZYX"===t.order){const t=o*l,n=o*h,i=s*l,r=s*h;e[0]=a*l,e[4]=i*c-n,e[8]=t*c+r,e[1]=a*h,e[5]=r*c+t,e[9]=n*c-i,e[2]=-c,e[6]=s*a,e[10]=o*a}else if("YZX"===t.order){const t=o*a,n=o*c,i=s*a,r=s*c;e[0]=a*l,e[4]=r-t*h,e[8]=i*h+n,e[1]=h,e[5]=o*l,e[9]=-s*l,e[2]=-c*l,e[6]=n*h+i,e[10]=t-r*h}else if("XZY"===t.order){const t=o*a,n=o*c,i=s*a,r=s*c;e[0]=a*l,e[4]=-h,e[8]=c*l,e[1]=t*h+r,e[5]=o*l,e[9]=n*h-i,e[2]=i*h-n,e[6]=s*l,e[10]=r*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(Qn,t,Kn)},lookAt:function(t,e,n){const i=this.elements;return ei.subVectors(t,e),0===ei.lengthSq()&&(ei.z=1),ei.normalize(),$n.crossVectors(n,ei),0===$n.lengthSq()&&(1===Math.abs(n.z)?ei.x+=1e-4:ei.z+=1e-4,ei.normalize(),$n.crossVectors(n,ei)),$n.normalize(),ti.crossVectors(ei,$n),i[0]=$n.x,i[4]=ti.x,i[8]=ei.x,i[1]=$n.y,i[5]=ti.y,i[9]=ei.y,i[2]=$n.z,i[6]=ti.z,i[10]=ei.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){const n=t.elements,i=e.elements,r=this.elements,o=n[0],s=n[4],a=n[8],c=n[12],l=n[1],h=n[5],u=n[9],p=n[13],d=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],_=n[15],b=i[0],w=i[4],M=i[8],S=i[12],T=i[1],E=i[5],A=i[9],L=i[13],R=i[2],C=i[6],P=i[10],O=i[14],D=i[3],N=i[7],I=i[11],B=i[15];return r[0]=o*b+s*T+a*R+c*D,r[4]=o*w+s*E+a*C+c*N,r[8]=o*M+s*A+a*P+c*I,r[12]=o*S+s*L+a*O+c*B,r[1]=l*b+h*T+u*R+p*D,r[5]=l*w+h*E+u*C+p*N,r[9]=l*M+h*A+u*P+p*I,r[13]=l*S+h*L+u*O+p*B,r[2]=d*b+f*T+m*R+g*D,r[6]=d*w+f*E+m*C+g*N,r[10]=d*M+f*A+m*P+g*I,r[14]=d*S+f*L+m*O+g*B,r[3]=v*b+y*T+x*R+_*D,r[7]=v*w+y*E+x*C+_*N,r[11]=v*M+y*A+x*P+_*I,r[15]=v*S+y*L+x*O+_*B,this},multiplyScalar:function(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},determinant:function(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],o=t[1],s=t[5],a=t[9],c=t[13],l=t[2],h=t[6],u=t[10],p=t[14];return t[3]*(+r*a*h-i*c*h-r*s*u+n*c*u+i*s*p-n*a*p)+t[7]*(+e*a*p-e*c*u+r*o*u-i*o*p+i*c*l-r*a*l)+t[11]*(+e*c*h-e*s*p-r*o*h+n*o*p+r*s*l-n*c*l)+t[15]*(-i*s*l-e*a*h+e*s*u+i*o*h-n*o*u+n*a*l)},transpose:function(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");const n=this.elements,i=t.elements,r=i[0],o=i[1],s=i[2],a=i[3],c=i[4],l=i[5],h=i[6],u=i[7],p=i[8],d=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],x=i[15],_=d*y*u-v*f*u+v*h*m-l*y*m-d*h*x+l*f*x,b=g*f*u-p*y*u-g*h*m+c*y*m+p*h*x-c*f*x,w=p*v*u-g*d*u+g*l*m-c*v*m-p*l*x+c*d*x,M=g*d*h-p*v*h-g*l*f+c*v*f+p*l*y-c*d*y,S=r*_+o*b+s*w+a*M;if(0===S)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/S;return n[0]=_*T,n[1]=(v*f*a-d*y*a-v*s*m+o*y*m+d*s*x-o*f*x)*T,n[2]=(l*y*a-v*h*a+v*s*u-o*y*u-l*s*x+o*h*x)*T,n[3]=(d*h*a-l*f*a-d*s*u+o*f*u+l*s*m-o*h*m)*T,n[4]=b*T,n[5]=(p*y*a-g*f*a+g*s*m-r*y*m-p*s*x+r*f*x)*T,n[6]=(g*h*a-c*y*a-g*s*u+r*y*u+c*s*x-r*h*x)*T,n[7]=(c*f*a-p*h*a+p*s*u-r*f*u-c*s*m+r*h*m)*T,n[8]=w*T,n[9]=(g*d*a-p*v*a-g*o*m+r*v*m+p*o*x-r*d*x)*T,n[10]=(c*v*a-g*l*a+g*o*u-r*v*u-c*o*x+r*l*x)*T,n[11]=(p*l*a-c*d*a-p*o*u+r*d*u+c*o*m-r*l*m)*T,n[12]=M*T,n[13]=(p*v*s-g*d*s+g*o*f-r*v*f-p*o*y+r*d*y)*T,n[14]=(g*l*s-c*v*s-g*o*h+r*v*h+c*o*y-r*l*y)*T,n[15]=(c*d*s-p*l*s+p*o*h-r*d*h-c*o*f+r*l*f)*T,this},scale:function(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this},getMaxScaleOnAxis:function(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},makeRotationY:function(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},makeRotationZ:function(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,o=t.x,s=t.y,a=t.z,c=r*o,l=r*s;return this.set(c*o+n,c*s-i*a,c*a+i*s,0,c*s+i*a,l*s+n,l*a-i*o,0,c*a-i*s,l*a+i*o,r*a*a+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,n){const i=this.elements,r=e._x,o=e._y,s=e._z,a=e._w,c=r+r,l=o+o,h=s+s,u=r*c,p=r*l,d=r*h,f=o*l,m=o*h,g=s*h,v=a*c,y=a*l,x=a*h,_=n.x,b=n.y,w=n.z;return i[0]=(1-(f+g))*_,i[1]=(p+x)*_,i[2]=(d-y)*_,i[3]=0,i[4]=(p-x)*b,i[5]=(1-(u+g))*b,i[6]=(m+v)*b,i[7]=0,i[8]=(d+y)*w,i[9]=(m-v)*w,i[10]=(1-(u+f))*w,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this},decompose:function(t,e,n){const i=this.elements;let r=Zn.set(i[0],i[1],i[2]).length(),o=Zn.set(i[4],i[5],i[6]).length(),s=Zn.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],Jn.copy(this);const a=1/r,c=1/o,l=1/s;return Jn.elements[0]*=a,Jn.elements[1]*=a,Jn.elements[2]*=a,Jn.elements[4]*=c,Jn.elements[5]*=c,Jn.elements[6]*=c,Jn.elements[8]*=l,Jn.elements[9]*=l,Jn.elements[10]*=l,e.setFromRotationMatrix(Jn),n.x=r,n.y=o,n.z=s,this},makePerspective:function(t,e,n,i,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,a=2*r/(e-t),c=2*r/(n-i),l=(e+t)/(e-t),h=(n+i)/(n-i),u=-(o+r)/(o-r),p=-2*o*r/(o-r);return s[0]=a,s[4]=0,s[8]=l,s[12]=0,s[1]=0,s[5]=c,s[9]=h,s[13]=0,s[2]=0,s[6]=0,s[10]=u,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(t,e,n,i,r,o){const s=this.elements,a=1/(e-t),c=1/(n-i),l=1/(o-r),h=(e+t)*a,u=(n+i)*c,p=(o+r)*l;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-h,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-u,s[2]=0,s[6]=0,s[10]=-2*l,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(t){const e=this.elements,n=t.elements;for(let i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}});const ii=new ni,ri=new Wn;function oi(t=0,e=0,n=0,i=oi.DefaultOrder){this._x=t,this._y=e,this._z=n,this._order=i}function si(){this.mask=1}oi.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],oi.DefaultOrder="XYZ",Object.defineProperties(oi.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(oi.prototype,{isEuler:!0,set:function(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._order=i||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,n){const i=In.clamp,r=t.elements,o=r[0],s=r[4],a=r[8],c=r[1],l=r[5],h=r[9],u=r[2],p=r[6],d=r[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(i(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(p,l),this._z=0);break;case"YXZ":this._x=Math.asin(-i(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-u,o),this._z=0);break;case"ZXY":this._x=Math.asin(i(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-i(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(p,d),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(i(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-i(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(p,l),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,n){return ii.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ii,e,n)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return ri.setFromEuler(this),this.setFromQuaternion(ri,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new Yn(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(si.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}});let ai=0;const ci=new Yn,li=new Wn,hi=new ni,ui=new Yn,pi=new Yn,di=new Yn,fi=new Wn,mi=new Yn(1,0,0),gi=new Yn(0,1,0),vi=new Yn(0,0,1),yi={type:"added"},xi={type:"removed"};function _i(){Object.defineProperty(this,"id",{value:ai++}),this.uuid=In.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=_i.DefaultUp.clone();const t=new Yn,e=new oi,n=new Wn,i=new Yn(1,1,1);e._onChange(function(){n.setFromEuler(e,!1)}),n._onChange(function(){e.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new ni},normalMatrix:{value:new Fn}}),this.matrix=new ni,this.matrixWorld=new ni,this.matrixAutoUpdate=_i.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new si,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function bi(){_i.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}_i.DefaultUp=new Yn(0,1,0),_i.DefaultMatrixAutoUpdate=!0,_i.prototype=Object.assign(Object.create(Dn.prototype),{constructor:_i,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return li.setFromAxisAngle(t,e),this.quaternion.multiply(li),this},rotateOnWorldAxis:function(t,e){return li.setFromAxisAngle(t,e),this.quaternion.premultiply(li),this},rotateX:function(t){return this.rotateOnAxis(mi,t)},rotateY:function(t){return this.rotateOnAxis(gi,t)},rotateZ:function(t){return this.rotateOnAxis(vi,t)},translateOnAxis:function(t,e){return ci.copy(t).applyQuaternion(this.quaternion),this.position.add(ci.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(mi,t)},translateY:function(t){return this.translateOnAxis(gi,t)},translateZ:function(t){return this.translateOnAxis(vi,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(hi.getInverse(this.matrixWorld))},lookAt:function(t,e,n){t.isVector3?ui.copy(t):ui.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),pi.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?hi.lookAt(pi,ui,this.up):hi.lookAt(ui,pi,this.up),this.quaternion.setFromRotationMatrix(hi),i&&(hi.extractRotation(i.matrixWorld),li.setFromRotationMatrix(hi),this.quaternion.premultiply(li.inverse()))},add:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(yi)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(xi)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),hi.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),hi.multiply(t.parent.matrixWorld)),t.applyMatrix4(hi),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Yn),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Wn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(pi,t,di),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Yn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(pi,fi,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Yn),this.updateMatrixWorld(!0);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)},traverseAncestors:function(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}},toJSON:function(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];r(t.shapes,i)}else r(t.shapes,n)}}if(void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(r(t.materials,this.material[n]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(e){const e=o(t.geometries),i=o(t.materials),r=o(t.textures),s=o(t.images),a=o(t.shapes);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a)}return n.object=i,n;function o(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let n=0;n<t.children.length;n++){const e=t.children[n];this.add(e.clone())}return this}}),bi.prototype=Object.assign(Object.create(_i.prototype),{constructor:bi,isScene:!0,copy:function(t,e){return _i.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){const e=_i.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e},dispose:function(){this.dispatchEvent({type:"dispose"})}});const wi=[new Yn,new Yn,new Yn,new Yn,new Yn,new Yn,new Yn,new Yn],Mi=new Yn,Si=new Ii,Ti=new Yn,Ei=new Yn,Ai=new Yn,Li=new Yn,Ri=new Yn,Ci=new Yn,Pi=new Yn,Oi=new Yn,Di=new Yn,Ni=new Yn;function Ii(t,e){this.min=void 0!==t?t:new Yn(1/0,1/0,1/0),this.max=void 0!==e?e:new Yn(-1/0,-1/0,-1/0)}function Bi(t,e,n,i,r){for(let o=0,s=t.length-3;o<=s;o+=3){Ni.fromArray(t,o);const s=r.x*Math.abs(Ni.x)+r.y*Math.abs(Ni.y)+r.z*Math.abs(Ni.z),a=e.dot(Ni),c=n.dot(Ni),l=i.dot(Ni);if(Math.max(-Math.max(a,c,l),Math.min(a,c,l))>s)return!1}return!0}Object.assign(Ii.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){let e=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,s=-1/0;for(let a=0,c=t.length;a<c;a+=3){const c=t[a],l=t[a+1],h=t[a+2];c<e&&(e=c),l<n&&(n=l),h<i&&(i=h),c>r&&(r=c),l>o&&(o=l),h>s&&(s=h)}return this.min.set(e,n,i),this.max.set(r,o,s),this},setFromBufferAttribute:function(t){let e=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,s=-1/0;for(let a=0,c=t.count;a<c;a++){const c=t.getX(a),l=t.getY(a),h=t.getZ(a);c<e&&(e=c),l<n&&(n=l),h<i&&(i=h),c>r&&(r=c),l>o&&(o=l),h>s&&(s=h)}return this.min.set(e,n,i),this.max.set(r,o,s),this},setFromPoints:function(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){const n=Mi.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Yn),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Yn),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),Si.copy(e.boundingBox),Si.applyMatrix4(t.matrixWorld),this.union(Si));const n=t.children;for(let i=0,r=n.length;i<r;i++)this.expandByObject(n[i]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Yn),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,Mi),Mi.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant},intersectsTriangle:function(t){if(this.isEmpty())return!1;this.getCenter(Pi),Oi.subVectors(this.max,Pi),Ti.subVectors(t.a,Pi),Ei.subVectors(t.b,Pi),Ai.subVectors(t.c,Pi),Li.subVectors(Ei,Ti),Ri.subVectors(Ai,Ei),Ci.subVectors(Ti,Ai);let e=[0,-Li.z,Li.y,0,-Ri.z,Ri.y,0,-Ci.z,Ci.y,Li.z,0,-Li.x,Ri.z,0,-Ri.x,Ci.z,0,-Ci.x,-Li.y,Li.x,0,-Ri.y,Ri.x,0,-Ci.y,Ci.x,0];return!!Bi(e,Ti,Ei,Ai,Oi)&&(!!Bi(e=[1,0,0,0,1,0,0,0,1],Ti,Ei,Ai,Oi)&&(Di.crossVectors(Li,Ri),Bi(e=[Di.x,Di.y,Di.z],Ti,Ei,Ai,Oi)))},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Yn),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return Mi.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(Mi).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()?this:(wi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),wi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),wi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),wi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),wi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),wi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),wi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),wi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(wi),this)},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});const Fi=new Ii;function Gi(t,e){this.center=void 0!==t?t:new Yn,this.radius=void 0!==e?e:-1}Object.assign(Gi.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(t,e){const n=this.center;void 0!==e?n.copy(e):Fi.setFromPoints(t).getCenter(n);let i=0;for(let r=0,o=t.length;r<o;r++)i=Math.max(i,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},isEmpty:function(){return this.radius<0},makeEmpty:function(){return this.center.set(0,0,0),this.radius=-1,this},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){const n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Yn),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Ii),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});const Ui=new Yn,zi=new Yn,Hi=new Yn,ki=new Yn,Vi=new Yn,ji=new Yn,Wi=new Yn;function qi(t,e){this.origin=void 0!==t?t:new Yn,this.direction=void 0!==e?e:new Yn(0,0,-1)}Object.assign(qi.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Yn),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,Ui)),this},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Yn),e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){const e=Ui.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Ui.copy(this.direction).multiplyScalar(e).add(this.origin),Ui.distanceToSquared(t))},distanceSqToSegment:function(t,e,n,i){zi.copy(t).add(e).multiplyScalar(.5),Hi.copy(e).sub(t).normalize(),ki.copy(this.origin).sub(zi);const r=.5*t.distanceTo(e),o=-this.direction.dot(Hi),s=ki.dot(this.direction),a=-ki.dot(Hi),c=ki.lengthSq(),l=Math.abs(1-o*o);let h,u,p,d;if(l>0)if(u=o*s-a,d=r*l,(h=o*a-s)>=0)if(u>=-d)if(u<=d){const t=1/l;p=(h*=t)*(h+o*(u*=t)+2*s)+u*(o*h+u+2*a)+c}else u=r,p=-(h=Math.max(0,-(o*u+s)))*h+u*(u+2*a)+c;else u=-r,p=-(h=Math.max(0,-(o*u+s)))*h+u*(u+2*a)+c;else u<=-d?p=-(h=Math.max(0,-(-o*r+s)))*h+(u=h>0?-r:Math.min(Math.max(-r,-a),r))*(u+2*a)+c:u<=d?(h=0,p=(u=Math.min(Math.max(-r,-a),r))*(u+2*a)+c):p=-(h=Math.max(0,-(o*r+s)))*h+(u=h>0?r:Math.min(Math.max(-r,-a),r))*(u+2*a)+c;else u=o>0?-r:r,p=-(h=Math.max(0,-(o*u+s)))*h+u*(u+2*a)+c;return n&&n.copy(this.direction).multiplyScalar(h).add(this.origin),i&&i.copy(Hi).multiplyScalar(u).add(zi),p},intersectSphere:function(t,e){Ui.subVectors(t.center,this.origin);const n=Ui.dot(this.direction),i=Ui.dot(Ui)-n*n,r=t.radius*t.radius;if(i>r)return null;const o=Math.sqrt(r-i),s=n-o,a=n+o;return s<0&&a<0?null:s<0?this.at(a,e):this.at(s,e)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null},intersectPlane:function(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)},intersectsPlane:function(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){let n,i,r,o,s,a;const c=1/this.direction.x,l=1/this.direction.y,h=1/this.direction.z,u=this.origin;return c>=0?(n=(t.min.x-u.x)*c,i=(t.max.x-u.x)*c):(n=(t.max.x-u.x)*c,i=(t.min.x-u.x)*c),l>=0?(r=(t.min.y-u.y)*l,o=(t.max.y-u.y)*l):(r=(t.max.y-u.y)*l,o=(t.min.y-u.y)*l),n>o||r>i?null:((r>n||n!=n)&&(n=r),(o<i||i!=i)&&(i=o),h>=0?(s=(t.min.z-u.z)*h,a=(t.max.z-u.z)*h):(s=(t.max.z-u.z)*h,a=(t.min.z-u.z)*h),n>a||s>i?null:((s>n||n!=n)&&(n=s),(a<i||i!=i)&&(i=a),i<0?null:this.at(n>=0?n:i,e)))},intersectsBox:function(t){return null!==this.intersectBox(t,Ui)},intersectTriangle:function(t,e,n,i,r){Vi.subVectors(e,t),ji.subVectors(n,t),Wi.crossVectors(Vi,ji);let o,s=this.direction.dot(Wi);if(s>0){if(i)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}ki.subVectors(this.origin,t);const a=o*this.direction.dot(ji.crossVectors(ki,ji));if(a<0)return null;const c=o*this.direction.dot(Vi.cross(ki));if(c<0)return null;if(a+c>s)return null;const l=-o*ki.dot(Wi);return l<0?null:this.at(l/s,r)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});const Xi=new Yn,Yi=new Yn,Zi=new Fn;function Ji(t,e){this.normal=void 0!==t?t:new Yn(1,0,0),this.constant=void 0!==e?e:0}Object.assign(Ji.prototype,{isPlane:!0,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,n){const i=Xi.subVectors(n,e).cross(Yi.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Yn),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new Yn);const n=t.delta(Xi),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):void 0;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?void 0:e.copy(n).multiplyScalar(r).add(t.start)},intersectsLine:function(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Yn),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,e){const n=e||Zi.getNormalMatrix(t),i=this.coplanarPoint(Xi).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});const Qi=new Yn,Ki=new Yn,$i=new Yn,tr=new Yn,er=new Yn,nr=new Yn,ir=new Yn,rr=new Yn,or=new Yn,sr=new Yn;function ar(t,e,n){this.a=void 0!==t?t:new Yn,this.b=void 0!==e?e:new Yn,this.c=void 0!==n?n:new Yn}Object.assign(ar,{getNormal:function(t,e,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Yn),i.subVectors(n,e),Qi.subVectors(t,e),i.cross(Qi);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)},getBarycoord:function(t,e,n,i,r){Qi.subVectors(i,e),Ki.subVectors(n,e),$i.subVectors(t,e);const o=Qi.dot(Qi),s=Qi.dot(Ki),a=Qi.dot($i),c=Ki.dot(Ki),l=Ki.dot($i),h=o*c-s*s;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new Yn),0===h)return r.set(-2,-1,-1);const u=1/h,p=(c*a-s*l)*u,d=(o*l-s*a)*u;return r.set(1-p-d,d,p)},containsPoint:function(t,e,n,i){return ar.getBarycoord(t,e,n,i,tr),tr.x>=0&&tr.y>=0&&tr.x+tr.y<=1},getUV:function(t,e,n,i,r,o,s,a){return this.getBarycoord(t,e,n,i,tr),a.set(0,0),a.addScaledVector(r,tr.x),a.addScaledVector(o,tr.y),a.addScaledVector(s,tr.z),a},isFrontFacing:function(t,e,n,i){return Qi.subVectors(n,e),Ki.subVectors(t,e),Qi.cross(Ki).dot(i)<0}}),Object.assign(ar.prototype,{set:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},setFromPointsAndIndices:function(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return Qi.subVectors(this.c,this.b),Ki.subVectors(this.a,this.b),.5*Qi.cross(Ki).length()},getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Yn),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return ar.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Ji),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return ar.getBarycoord(t,this.a,this.b,this.c,e)},getUV:function(t,e,n,i,r){return ar.getUV(t,this.a,this.b,this.c,e,n,i,r)},containsPoint:function(t){return ar.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return ar.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Yn);const n=this.a,i=this.b,r=this.c;let o,s;er.subVectors(i,n),nr.subVectors(r,n),rr.subVectors(t,n);const a=er.dot(rr),c=nr.dot(rr);if(a<=0&&c<=0)return e.copy(n);or.subVectors(t,i);const l=er.dot(or),h=nr.dot(or);if(l>=0&&h<=l)return e.copy(i);const u=a*h-l*c;if(u<=0&&a>=0&&l<=0)return o=a/(a-l),e.copy(n).addScaledVector(er,o);sr.subVectors(t,r);const p=er.dot(sr),d=nr.dot(sr);if(d>=0&&p<=d)return e.copy(r);const f=p*c-a*d;if(f<=0&&c>=0&&d<=0)return s=c/(c-d),e.copy(n).addScaledVector(nr,s);const m=l*d-p*h;if(m<=0&&h-l>=0&&p-d>=0)return ir.subVectors(r,i),s=(h-l)/(h-l+(p-d)),e.copy(i).addScaledVector(ir,s);const g=1/(m+f+u);return o=f*g,s=u*g,e.copy(n).addScaledVector(er,o).addScaledVector(nr,s)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});const cr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},lr={h:0,s:0,l:0},hr={h:0,s:0,l:0};function ur(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}function pr(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function dr(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function fr(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}function mr(t,e,n,i,r,o){this.a=t,this.b=e,this.c=n,this.normal=i&&i.isVector3?i:new Yn,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new ur,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==o?o:0}Object.assign(ur.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,n){return this.r=t,this.g=e,this.b=n,this},setHSL:function(t,e,n){if(t=In.euclideanModulo(t,1),e=In.clamp(e,0,1),n=In.clamp(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=pr(r,i,t+1/3),this.g=pr(r,i,t),this.b=pr(r,i,t-1/3)}return this},setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){let t;const i=n[1],r=n[2];switch(i){case"rgb":case"rgba":if(t=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[5]),this;if(t=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[5]),this;break;case"hsl":case"hsla":if(t=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r)){const n=parseFloat(t[1])/360,i=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100;return e(t[5]),this.setHSL(n,i,r)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(t)){const t=n[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this},setColorName:function(t){const e=cr[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);const n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=dr(t.r),this.g=dr(t.g),this.b=dr(t.b),this},copyLinearToSRGB:function(t){return this.r=fr(t.r),this.g=fr(t.g),this.b=fr(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const e=this.r,n=this.g,i=this.b,r=Math.max(e,n,i),o=Math.min(e,n,i);let s,a;const c=(o+r)/2;if(o===r)s=0,a=0;else{const t=r-o;switch(a=c<=.5?t/(r+o):t/(2-r-o),r){case e:s=(n-i)/t+(n<i?6:0);break;case n:s=(i-e)/t+2;break;case i:s=(e-n)/t+4}s/=6}return t.h=s,t.s=a,t.l=c,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,n){return this.getHSL(lr),lr.h+=t,lr.s+=e,lr.l+=n,this.setHSL(lr.h,lr.s,lr.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:function(t,e){this.getHSL(lr),t.getHSL(hr);const n=In.lerp(lr.h,hr.h,e),i=In.lerp(lr.s,hr.s,e),r=In.lerp(lr.l,hr.l,e);return this.setHSL(n,i,r),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},fromBufferAttribute:function(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this},toJSON:function(){return this.getHex()}}),ur.NAMES=cr,Object.assign(mr.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(let e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});let gr=0;function vr(){Object.defineProperty(this,"id",{value:gr++}),this.uuid=In.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=x,this.side=d,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=D,this.blendDst=N,this.blendEquation=S,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=V,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Mn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ln,this.stencilZFail=ln,this.stencilZPass=ln,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function yr(t){vr.call(this),this.type="MeshBasicMaterial",this.color=new ur(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}vr.prototype=Object.assign(Object.create(Dn.prototype),{constructor:vr,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}},toJSON:function(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==x&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==d&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=i(t.textures),r=i(t.images);e.length>0&&(n.textures=e),r.length>0&&(n.images=r)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(vr.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),yr.prototype=Object.create(vr.prototype),yr.prototype.constructor=yr,yr.prototype.isMeshBasicMaterial=!0,yr.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};const xr=new Yn,_r=new Bn;function br(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=Sn,this.updateRange={offset:0,count:-1},this.version=0}function wr(t,e,n){br.call(this,new Int8Array(t),e,n)}function Mr(t,e,n){br.call(this,new Uint8Array(t),e,n)}function Sr(t,e,n){br.call(this,new Uint8ClampedArray(t),e,n)}function Tr(t,e,n){br.call(this,new Int16Array(t),e,n)}function Er(t,e,n){br.call(this,new Uint16Array(t),e,n)}function Ar(t,e,n){br.call(this,new Int32Array(t),e,n)}function Lr(t,e,n){br.call(this,new Uint32Array(t),e,n)}function Rr(t,e,n){br.call(this,new Float32Array(t),e,n)}function Cr(t,e,n){br.call(this,new Float64Array(t),e,n)}function Pr(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Or(t){if(0===t.length)return-1/0;let e=t[0];for(let n=1,i=t.length;n<i;++n)t[n]>e&&(e=t[n]);return e}Object.defineProperty(br.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(br.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new ur),e[n++]=r.r,e[n++]=r.g,e[n++]=r.b}return this},copyVector2sArray:function(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new Bn),e[n++]=r.x,e[n++]=r.y}return this},copyVector3sArray:function(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new Yn),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z}return this},copyVector4sArray:function(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new kn),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z,e[n++]=r.w}return this},applyMatrix3:function(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)_r.fromBufferAttribute(this,e),_r.applyMatrix3(t),this.setXY(e,_r.x,_r.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)xr.fromBufferAttribute(this,e),xr.applyMatrix3(t),this.setXYZ(e,xr.x,xr.y,xr.z);return this},applyMatrix4:function(t){for(let e=0,n=this.count;e<n;e++)xr.x=this.getX(e),xr.y=this.getY(e),xr.z=this.getZ(e),xr.applyMatrix4(t),this.setXYZ(e,xr.x,xr.y,xr.z);return this},applyNormalMatrix:function(t){for(let e=0,n=this.count;e<n;e++)xr.x=this.getX(e),xr.y=this.getY(e),xr.z=this.getZ(e),xr.applyNormalMatrix(t),this.setXYZ(e,xr.x,xr.y,xr.z);return this},transformDirection:function(t){for(let e=0,n=this.count;e<n;e++)xr.x=this.getX(e),xr.y=this.getY(e),xr.z=this.getZ(e),xr.transformDirection(t),this.setXYZ(e,xr.x,xr.y,xr.z);return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this},setXYZW:function(t,e,n,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),wr.prototype=Object.create(br.prototype),wr.prototype.constructor=wr,Mr.prototype=Object.create(br.prototype),Mr.prototype.constructor=Mr,Sr.prototype=Object.create(br.prototype),Sr.prototype.constructor=Sr,Tr.prototype=Object.create(br.prototype),Tr.prototype.constructor=Tr,Er.prototype=Object.create(br.prototype),Er.prototype.constructor=Er,Ar.prototype=Object.create(br.prototype),Ar.prototype.constructor=Ar,Lr.prototype=Object.create(br.prototype),Lr.prototype.constructor=Lr,Rr.prototype=Object.create(br.prototype),Rr.prototype.constructor=Rr,Cr.prototype=Object.create(br.prototype),Cr.prototype.constructor=Cr,Object.assign(Pr.prototype,{computeGroups:function(t){const e=[];let n,i,r=void 0;const o=t.faces;for(i=0;i<o.length;i++){const t=o[i];t.materialIndex!==r&&(r=t.materialIndex,void 0!==n&&(n.count=3*i-n.start,e.push(n)),n={start:3*i,materialIndex:r})}void 0!==n&&(n.count=3*i-n.start,e.push(n)),this.groups=e},fromGeometry:function(t){const e=t.faces,n=t.vertices,i=t.faceVertexUvs,r=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=t.morphTargets,a=s.length;let c;if(a>0){c=[];for(let t=0;t<a;t++)c[t]={name:s[t].name,data:[]};this.morphTargets.position=c}const l=t.morphNormals,h=l.length;let u;if(h>0){u=[];for(let t=0;t<h;t++)u[t]={name:l[t].name,data:[]};this.morphTargets.normal=u}const p=t.skinIndices,d=t.skinWeights,f=p.length===n.length,m=d.length===n.length;n.length>0&&0===e.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<e.length;g++){const t=e[g];this.vertices.push(n[t.a],n[t.b],n[t.c]);const v=t.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{const e=t.normal;this.normals.push(e,e,e)}const y=t.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{const e=t.color;this.colors.push(e,e,e)}if(!0===r){const t=i[0][g];void 0!==t?this.uvs.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new Bn,new Bn,new Bn))}if(!0===o){const t=i[1][g];void 0!==t?this.uvs2.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new Bn,new Bn,new Bn))}for(let e=0;e<a;e++){const n=s[e].vertices;c[e].data.push(n[t.a],n[t.b],n[t.c])}for(let e=0;e<h;e++){const t=l[e].vertexNormals[g];u[e].data.push(t.a,t.b,t.c)}f&&this.skinIndices.push(p[t.a],p[t.b],p[t.c]),m&&this.skinWeights.push(d[t.a],d[t.b],d[t.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});let Dr=1;const Nr=new ni,Ir=new _i,Br=new Yn,Fr=new Ii,Gr=new Ii,Ur=new Yn;function zr(){Object.defineProperty(this,"id",{value:Dr+=2}),this.uuid=In.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}zr.prototype=Object.assign(Object.create(Dn.prototype),{constructor:zr,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(Or(t)>65535?Lr:Er)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,n){this.groups.push({start:t,count:e,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new Fn).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return Nr.makeRotationX(t),this.applyMatrix4(Nr),this},rotateY:function(t){return Nr.makeRotationY(t),this.applyMatrix4(Nr),this},rotateZ:function(t){return Nr.makeRotationZ(t),this.applyMatrix4(Nr),this},translate:function(t,e,n){return Nr.makeTranslation(t,e,n),this.applyMatrix4(Nr),this},scale:function(t,e,n){return Nr.makeScale(t,e,n),this.applyMatrix4(Nr),this},lookAt:function(t){return Ir.lookAt(t),Ir.updateMatrix(),this.applyMatrix4(Ir.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Br).negate(),this.translate(Br.x,Br.y,Br.z),this},setFromObject:function(t){const e=t.geometry;if(t.isPoints||t.isLine){const t=new Rr(3*e.vertices.length,3),n=new Rr(3*e.colors.length,3);if(this.setAttribute("position",t.copyVector3sArray(e.vertices)),this.setAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){const t=new Rr(e.lineDistances.length,1);this.setAttribute("lineDistance",t.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Rr(e,3)),this},updateFromObject:function(t){let e=t.geometry;if(t.isMesh){let t=e.__directGeometry;if(!0===e.elementsNeedUpdate&&(t=void 0,e.elementsNeedUpdate=!1),void 0===t)return this.fromGeometry(e);t.verticesNeedUpdate=e.verticesNeedUpdate,t.normalsNeedUpdate=e.normalsNeedUpdate,t.colorsNeedUpdate=e.colorsNeedUpdate,t.uvsNeedUpdate=e.uvsNeedUpdate,t.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=t}if(!0===e.verticesNeedUpdate){const t=this.attributes.position;void 0!==t&&(t.copyVector3sArray(e.vertices),t.needsUpdate=!0),e.verticesNeedUpdate=!1}if(!0===e.normalsNeedUpdate){const t=this.attributes.normal;void 0!==t&&(t.copyVector3sArray(e.normals),t.needsUpdate=!0),e.normalsNeedUpdate=!1}if(!0===e.colorsNeedUpdate){const t=this.attributes.color;void 0!==t&&(t.copyColorsArray(e.colors),t.needsUpdate=!0),e.colorsNeedUpdate=!1}if(e.uvsNeedUpdate){const t=this.attributes.uv;void 0!==t&&(t.copyVector2sArray(e.uvs),t.needsUpdate=!0),e.uvsNeedUpdate=!1}if(e.lineDistancesNeedUpdate){const t=this.attributes.lineDistance;void 0!==t&&(t.copyArray(e.lineDistances),t.needsUpdate=!0),e.lineDistancesNeedUpdate=!1}return e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new Pr).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){const e=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new br(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){const e=new Float32Array(3*t.normals.length);this.setAttribute("normal",new br(e,3).copyVector3sArray(t.normals))}if(t.colors.length>0){const e=new Float32Array(3*t.colors.length);this.setAttribute("color",new br(e,3).copyColorsArray(t.colors))}if(t.uvs.length>0){const e=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new br(e,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){const e=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new br(e,2).copyVector2sArray(t.uvs2))}this.groups=t.groups;for(const n in t.morphTargets){const e=[],i=t.morphTargets[n];for(let t=0,n=i.length;t<n;t++){const n=i[t],r=new Rr(3*n.data.length,3);r.name=n.name,e.push(r.copyVector3sArray(n.data))}this.morphAttributes[n]=e}if(t.skinIndices.length>0){const e=new Rr(4*t.skinIndices.length,4);this.setAttribute("skinIndex",e.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){const e=new Rr(4*t.skinWeights.length,4);this.setAttribute("skinWeight",e.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ii);const t=this.attributes.position,e=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,i=e.length;n<i;n++){const t=e[n];Fr.setFromBufferAttribute(t),this.morphTargetsRelative?(Ur.addVectors(this.boundingBox.min,Fr.min),this.boundingBox.expandByPoint(Ur),Ur.addVectors(this.boundingBox.max,Fr.max),this.boundingBox.expandByPoint(Ur)):(this.boundingBox.expandByPoint(Fr.min),this.boundingBox.expandByPoint(Fr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Gi);const t=this.attributes.position,e=this.morphAttributes.position;if(t){const n=this.boundingSphere.center;if(Fr.setFromBufferAttribute(t),e)for(let t=0,r=e.length;t<r;t++){const n=e[t];Gr.setFromBufferAttribute(n),this.morphTargetsRelative?(Ur.addVectors(Fr.min,Gr.min),Fr.expandByPoint(Ur),Ur.addVectors(Fr.max,Gr.max),Fr.expandByPoint(Ur)):(Fr.expandByPoint(Gr.min),Fr.expandByPoint(Gr.max))}Fr.getCenter(n);let i=0;for(let e=0,r=t.count;e<r;e++)Ur.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(Ur));if(e)for(let r=0,o=e.length;r<o;r++){const o=e[r],s=this.morphTargetsRelative;for(let e=0,r=o.count;e<r;e++)Ur.fromBufferAttribute(o,e),s&&(Br.fromBufferAttribute(t,e),Ur.add(Br)),i=Math.max(i,n.distanceToSquared(Ur))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new br(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new Yn,r=new Yn,o=new Yn,s=new Yn,a=new Yn,c=new Yn,l=new Yn,h=new Yn;if(t)for(let u=0,p=t.count;u<p;u+=3){const p=t.getX(u+0),d=t.getX(u+1),f=t.getX(u+2);i.fromBufferAttribute(e,p),r.fromBufferAttribute(e,d),o.fromBufferAttribute(e,f),l.subVectors(o,r),h.subVectors(i,r),l.cross(h),s.fromBufferAttribute(n,p),a.fromBufferAttribute(n,d),c.fromBufferAttribute(n,f),s.add(l),a.add(l),c.add(l),n.setXYZ(p,s.x,s.y,s.z),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(f,c.x,c.y,c.z)}else for(let t=0,u=e.count;t<u;t+=3)i.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),o.fromBufferAttribute(e,t+2),l.subVectors(o,r),h.subVectors(i,r),l.cross(h),n.setXYZ(t+0,l.x,l.y,l.z),n.setXYZ(t+1,l.x,l.y,l.z),n.setXYZ(t+2,l.x,l.y,l.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===t.attributes[i])continue;const r=n[i].array,o=t.attributes[i],s=o.array,a=o.itemSize*e,c=Math.min(s.length,r.length-a);for(let t=0,e=a;t<c;t++,e++)r[e]=s[t]}return this},normalizeNormals:function(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Ur.fromBufferAttribute(t,e),Ur.normalize(),t.setXYZ(e,Ur.x,Ur.y,Ur.z)},toNonIndexed:function(){function t(t,e){const n=t.array,i=t.itemSize,r=t.normalized,o=new n.constructor(e.length*i);let s=0,a=0;for(let c=0,l=e.length;c<l;c++){s=e[c]*i;for(let t=0;t<i;t++)o[a++]=n[s++]}return new br(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const e=new zr,n=this.index.array,i=this.attributes;for(const s in i){const r=t(i[s],n);e.setAttribute(s,r)}const r=this.morphAttributes;for(const s in r){const i=[],o=r[s];for(let e=0,r=o.length;e<r;e++){const r=t(o[e],n);i.push(r)}e.morphAttributes[s]=i}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let s=0,a=o.length;s<a;s++){const t=o[s];e.addGroup(t.start,t.count,t.materialIndex)}return e},toJSON:function(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const a in n){const e=n[a],i=e.toJSON(t.data);""!==e.name&&(i.name=e.name),t.data.attributes[a]=i}const i={};let r=!1;for(const a in this.morphAttributes){const e=this.morphAttributes[a],n=[];for(let i=0,r=e.length;i<r;i++){const r=e[i],o=r.toJSON(t.data);""!==r.name&&(o.name=r.name),n.push(o)}n.length>0&&(i[a]=n,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(t.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),t},clone:function(){return(new zr).copy(this)},copy:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const i=t.attributes;for(const c in i){const t=i[c];this.setAttribute(c,t.clone(e))}const r=t.morphAttributes;for(const c in r){const t=[],n=r[c];for(let i=0,r=n.length;i<r;i++)t.push(n[i].clone(e));this.morphAttributes[c]=t}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let c=0,l=o.length;c<l;c++){const t=o[c];this.addGroup(t.start,t.count,t.materialIndex)}const s=t.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const Hr=new ni,kr=new qi,Vr=new Gi,jr=new Yn,Wr=new Yn,qr=new Yn,Xr=new Yn,Yr=new Yn,Zr=new Yn,Jr=new Yn,Qr=new Yn,Kr=new Yn,$r=new Bn,to=new Bn,eo=new Bn,no=new Yn,io=new Yn;function ro(t,e){_i.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new zr,this.material=void 0!==e?e:new yr,this.updateMorphTargets()}function oo(t,e,n,i,r,o,s,a){let c;if(null===(c=e.side===f?i.intersectTriangle(s,o,r,!0,a):i.intersectTriangle(r,o,s,e.side!==m,a)))return null;io.copy(a),io.applyMatrix4(t.matrixWorld);const l=n.ray.origin.distanceTo(io);return l<n.near||l>n.far?null:{distance:l,point:io.clone(),object:t}}function so(t,e,n,i,r,o,s,a,c,l,h,u){jr.fromBufferAttribute(r,l),Wr.fromBufferAttribute(r,h),qr.fromBufferAttribute(r,u);const p=t.morphTargetInfluences;if(e.morphTargets&&o&&p){Jr.set(0,0,0),Qr.set(0,0,0),Kr.set(0,0,0);for(let t=0,e=o.length;t<e;t++){const e=p[t],n=o[t];0!==e&&(Xr.fromBufferAttribute(n,l),Yr.fromBufferAttribute(n,h),Zr.fromBufferAttribute(n,u),s?(Jr.addScaledVector(Xr,e),Qr.addScaledVector(Yr,e),Kr.addScaledVector(Zr,e)):(Jr.addScaledVector(Xr.sub(jr),e),Qr.addScaledVector(Yr.sub(Wr),e),Kr.addScaledVector(Zr.sub(qr),e)))}jr.add(Jr),Wr.add(Qr),qr.add(Kr)}t.isSkinnedMesh&&(t.boneTransform(l,jr),t.boneTransform(h,Wr),t.boneTransform(u,qr));const d=oo(t,e,n,i,jr,Wr,qr,no);if(d){a&&($r.fromBufferAttribute(a,l),to.fromBufferAttribute(a,h),eo.fromBufferAttribute(a,u),d.uv=ar.getUV(no,jr,Wr,qr,$r,to,eo,new Bn)),c&&($r.fromBufferAttribute(c,l),to.fromBufferAttribute(c,h),eo.fromBufferAttribute(c,u),d.uv2=ar.getUV(no,jr,Wr,qr,$r,to,eo,new Bn));const t=new mr(l,h,u);ar.getNormal(jr,Wr,qr,t.normal),d.face=t}return d}ro.prototype=Object.assign(Object.create(_i.prototype),{constructor:ro,isMesh:!0,copy:function(t){return _i.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Vr.copy(n.boundingSphere),Vr.applyMatrix4(r),!1===t.ray.intersectsSphere(Vr))return;if(Hr.getInverse(r),kr.copy(t.ray).applyMatrix4(Hr),null!==n.boundingBox&&!1===kr.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const r=n.index,s=n.attributes.position,a=n.morphAttributes.position,c=n.morphTargetsRelative,l=n.attributes.uv,h=n.attributes.uv2,u=n.groups,p=n.drawRange;if(null!==r)if(Array.isArray(i))for(let n=0,d=u.length;n<d;n++){const d=u[n],f=i[d.materialIndex];for(let n=Math.max(d.start,p.start),i=Math.min(d.start+d.count,p.start+p.count);n<i;n+=3){const i=r.getX(n),u=r.getX(n+1),p=r.getX(n+2);(o=so(this,f,t,kr,s,a,c,l,h,i,u,p))&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=d.materialIndex,e.push(o))}}else{for(let n=Math.max(0,p.start),u=Math.min(r.count,p.start+p.count);n<u;n+=3){const u=r.getX(n),p=r.getX(n+1),d=r.getX(n+2);(o=so(this,i,t,kr,s,a,c,l,h,u,p,d))&&(o.faceIndex=Math.floor(n/3),e.push(o))}}else if(void 0!==s)if(Array.isArray(i))for(let n=0,d=u.length;n<d;n++){const r=u[n],d=i[r.materialIndex];for(let n=Math.max(r.start,p.start),i=Math.min(r.start+r.count,p.start+p.count);n<i;n+=3){(o=so(this,d,t,kr,s,a,c,l,h,n,n+1,n+2))&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=r.materialIndex,e.push(o))}}else{for(let n=Math.max(0,p.start),r=Math.min(s.count,p.start+p.count);n<r;n+=3){(o=so(this,i,t,kr,s,a,c,l,h,n,n+1,n+2))&&(o.faceIndex=Math.floor(n/3),e.push(o))}}}else if(n.isGeometry){const r=Array.isArray(i),s=n.vertices,a=n.faces;let c;const l=n.faceVertexUvs[0];l.length>0&&(c=l);for(let n=0,h=a.length;n<h;n++){const l=a[n],h=r?i[l.materialIndex]:i;if(void 0===h)continue;const u=s[l.a],p=s[l.b],d=s[l.c];if(o=oo(this,h,t,kr,u,p,d,no)){if(c&&c[n]){const t=c[n];$r.copy(t[0]),to.copy(t[1]),eo.copy(t[2]),o.uv=ar.getUV(no,u,p,d,$r,to,eo,new Bn)}o.face=l,o.faceIndex=n,e.push(o)}}}}});let ao=0;const co=new ni,lo=new _i,ho=new Yn;function uo(){Object.defineProperty(this,"id",{value:ao+=2}),this.uuid=In.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}uo.prototype=Object.assign(Object.create(Dn.prototype),{constructor:uo,isGeometry:!0,applyMatrix4:function(t){const e=(new Fn).getNormalMatrix(t);for(let n=0,i=this.vertices.length;n<i;n++){this.vertices[n].applyMatrix4(t)}for(let n=0,i=this.faces.length;n<i;n++){const t=this.faces[n];t.normal.applyMatrix3(e).normalize();for(let n=0,i=t.vertexNormals.length;n<i;n++)t.vertexNormals[n].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return co.makeRotationX(t),this.applyMatrix4(co),this},rotateY:function(t){return co.makeRotationY(t),this.applyMatrix4(co),this},rotateZ:function(t){return co.makeRotationZ(t),this.applyMatrix4(co),this},translate:function(t,e,n){return co.makeTranslation(t,e,n),this.applyMatrix4(co),this},scale:function(t,e,n){return co.makeScale(t,e,n),this.applyMatrix4(co),this},lookAt:function(t){return lo.lookAt(t),lo.updateMatrix(),this.applyMatrix4(lo.matrix),this},fromBufferGeometry:function(t){const e=this,n=null!==t.index?t.index:void 0,i=t.attributes;if(void 0===i.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const r=i.position,o=i.normal,s=i.color,a=i.uv,c=i.uv2;void 0!==c&&(this.faceVertexUvs[1]=[]);for(let u=0;u<r.count;u++)e.vertices.push((new Yn).fromBufferAttribute(r,u)),void 0!==s&&e.colors.push((new ur).fromBufferAttribute(s,u));function l(t,n,i,r){const l=void 0===s?[]:[e.colors[t].clone(),e.colors[n].clone(),e.colors[i].clone()],h=new mr(t,n,i,void 0===o?[]:[(new Yn).fromBufferAttribute(o,t),(new Yn).fromBufferAttribute(o,n),(new Yn).fromBufferAttribute(o,i)],l,r);e.faces.push(h),void 0!==a&&e.faceVertexUvs[0].push([(new Bn).fromBufferAttribute(a,t),(new Bn).fromBufferAttribute(a,n),(new Bn).fromBufferAttribute(a,i)]),void 0!==c&&e.faceVertexUvs[1].push([(new Bn).fromBufferAttribute(c,t),(new Bn).fromBufferAttribute(c,n),(new Bn).fromBufferAttribute(c,i)])}const h=t.groups;if(h.length>0)for(let u=0;u<h.length;u++){const t=h[u],e=t.start;for(let i=e,r=e+t.count;i<r;i+=3)void 0!==n?l(n.getX(i),n.getX(i+1),n.getX(i+2),t.materialIndex):l(i,i+1,i+2,t.materialIndex)}else if(void 0!==n)for(let u=0;u<n.count;u+=3)l(n.getX(u),n.getX(u+1),n.getX(u+2));else for(let u=0;u<r.count;u+=3)l(u,u+1,u+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ho).negate(),this.translate(ho.x,ho.y,ho.z),this},normalize:function(){this.computeBoundingSphere();const t=this.boundingSphere.center,e=this.boundingSphere.radius,n=0===e?1:1/e,i=new ni;return i.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix4(i),this},computeFaceNormals:function(){const t=new Yn,e=new Yn;for(let n=0,i=this.faces.length;n<i;n++){const i=this.faces[n],r=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];t.subVectors(s,o),e.subVectors(r,o),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){void 0===t&&(t=!0);const e=new Array(this.vertices.length);for(let n=0,i=this.vertices.length;n<i;n++)e[n]=new Yn;if(t){const t=new Yn,n=new Yn;for(let i=0,r=this.faces.length;i<r;i++){const r=this.faces[i],o=this.vertices[r.a],s=this.vertices[r.b],a=this.vertices[r.c];t.subVectors(a,s),n.subVectors(o,s),t.cross(n),e[r.a].add(t),e[r.b].add(t),e[r.c].add(t)}}else{this.computeFaceNormals();for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t];e[n.a].add(n.normal),e[n.b].add(n.normal),e[n.c].add(n.normal)}}for(let n=0,i=this.vertices.length;n<i;n++)e[n].normalize();for(let n=0,i=this.faces.length;n<i;n++){const t=this.faces[n],i=t.vertexNormals;3===i.length?(i[0].copy(e[t.a]),i[1].copy(e[t.b]),i[2].copy(e[t.c])):(i[0]=e[t.a].clone(),i[1]=e[t.b].clone(),i[2]=e[t.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],n=e.vertexNormals;3===n.length?(n[0].copy(e.normal),n[1].copy(e.normal),n[2].copy(e.normal)):(n[0]=e.normal.clone(),n[1]=e.normal.clone(),n[2]=e.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let e=0,n=this.faces.length;e<n;e++){const t=this.faces[e];t.__originalFaceNormal?t.__originalFaceNormal.copy(t.normal):t.__originalFaceNormal=t.normal.clone(),t.__originalVertexNormals||(t.__originalVertexNormals=[]);for(let e=0,n=t.vertexNormals.length;e<n;e++)t.__originalVertexNormals[e]?t.__originalVertexNormals[e].copy(t.vertexNormals[e]):t.__originalVertexNormals[e]=t.vertexNormals[e].clone()}const t=new uo;t.faces=this.faces;for(let e=0,n=this.morphTargets.length;e<n;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];const t=this.morphNormals[e].faceNormals,n=this.morphNormals[e].vertexNormals;for(let e=0,i=this.faces.length;e<i;e++){const e=new Yn,i={a:new Yn,b:new Yn,c:new Yn};t.push(e),n.push(i)}}const n=this.morphNormals[e];t.vertices=this.morphTargets[e].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],i=n.faceNormals[t],r=n.vertexNormals[t];i.copy(e.normal),r.a.copy(e.vertexNormals[0]),r.b.copy(e.vertexNormals[1]),r.c.copy(e.vertexNormals[2])}}for(let e=0,n=this.faces.length;e<n;e++){const t=this.faces[e];t.normal=t.__originalFaceNormal,t.vertexNormals=t.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ii),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Gi),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if(!t||!t.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);let i,r=this.vertices.length,o=this.vertices,s=t.vertices,a=this.faces,c=t.faces,l=this.colors,h=t.colors;void 0===n&&(n=0),void 0!==e&&(i=(new Fn).getNormalMatrix(e));for(let u=0,p=s.length;u<p;u++){const t=s[u].clone();void 0!==e&&t.applyMatrix4(e),o.push(t)}for(let u=0,p=h.length;u<p;u++)l.push(h[u].clone());for(let u=0,p=c.length;u<p;u++){let t,e,o,s=c[u],l=s.vertexNormals,h=s.vertexColors;(t=new mr(s.a+r,s.b+r,s.c+r)).normal.copy(s.normal),void 0!==i&&t.normal.applyMatrix3(i).normalize();for(let n=0,r=l.length;n<r;n++)e=l[n].clone(),void 0!==i&&e.applyMatrix3(i).normalize(),t.vertexNormals.push(e);t.color.copy(s.color);for(let n=0,i=h.length;n<i;n++)o=h[n],t.vertexColors.push(o.clone());t.materialIndex=s.materialIndex+n,a.push(t)}for(let u=0,p=t.faceVertexUvs.length;u<p;u++){const e=t.faceVertexUvs[u];void 0===this.faceVertexUvs[u]&&(this.faceVertexUvs[u]=[]);for(let t=0,n=e.length;t<n;t++){const n=e[t],i=[];for(let t=0,e=n.length;t<e;t++)i.push(n[t].clone());this.faceVertexUvs[u].push(i)}}},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){const t={},e=[],n=[],i=Math.pow(10,4);for(let s=0,a=this.vertices.length;s<a;s++){const r=this.vertices[s],o=Math.round(r.x*i)+"_"+Math.round(r.y*i)+"_"+Math.round(r.z*i);void 0===t[o]?(t[o]=s,e.push(this.vertices[s]),n[s]=e.length-1):n[s]=n[t[o]]}const r=[];for(let s=0,a=this.faces.length;s<a;s++){const t=this.faces[s];t.a=n[t.a],t.b=n[t.b],t.c=n[t.c];const e=[t.a,t.b,t.c];for(let n=0;n<3;n++)if(e[n]===e[(n+1)%3]){r.push(s);break}}for(let s=r.length-1;s>=0;s--){const t=r[s];this.faces.splice(t,1);for(let e=0,n=this.faceVertexUvs.length;e<n;e++)this.faceVertexUvs[e].splice(t,1)}const o=this.vertices.length-e.length;return this.vertices=e,o},setFromPoints:function(t){this.vertices=[];for(let e=0,n=t.length;e<n;e++){const n=t[e];this.vertices.push(new Yn(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){const t=this.faces,e=t.length;for(let s=0;s<e;s++)t[s]._id=s;t.sort(function(t,e){return t.materialIndex-e.materialIndex});const n=this.faceVertexUvs[0],i=this.faceVertexUvs[1];let r,o;n&&n.length===e&&(r=[]),i&&i.length===e&&(o=[]);for(let s=0;s<e;s++){const e=t[s]._id;r&&r.push(n[e]),o&&o.push(i[e])}r&&(this.faceVertexUvs[0]=r),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){const t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}const e=[];for(let d=0;d<this.vertices.length;d++){const t=this.vertices[d];e.push(t.x,t.y,t.z)}const n=[],i=[],r={},o=[],s={},a=[],c={};for(let d=0;d<this.faces.length;d++){const t=this.faces[d],e=!0,i=!1,r=void 0!==this.faceVertexUvs[0][d],o=t.normal.length()>0,s=t.vertexNormals.length>0,a=1!==t.color.r||1!==t.color.g||1!==t.color.b,c=t.vertexColors.length>0;let f=0;if(f=l(f,0,0),f=l(f,1,e),f=l(f,2,i),f=l(f,3,r),f=l(f,4,o),f=l(f,5,s),f=l(f,6,a),f=l(f,7,c),n.push(f),n.push(t.a,t.b,t.c),n.push(t.materialIndex),r){const t=this.faceVertexUvs[0][d];n.push(p(t[0]),p(t[1]),p(t[2]))}if(o&&n.push(h(t.normal)),s){const e=t.vertexNormals;n.push(h(e[0]),h(e[1]),h(e[2]))}if(a&&n.push(u(t.color)),c){const e=t.vertexColors;n.push(u(e[0]),u(e[1]),u(e[2]))}}function l(t,e,n){return n?t|1<<e:t&~(1<<e)}function h(t){const e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==r[e]?r[e]:(r[e]=i.length/3,i.push(t.x,t.y,t.z),r[e])}function u(t){const e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==s[e]?s[e]:(s[e]=o.length,o.push(t.getHex()),s[e])}function p(t){const e=t.x.toString()+t.y.toString();return void 0!==c[e]?c[e]:(c[e]=a.length/2,a.push(t.x,t.y),c[e])}return t.data={},t.data.vertices=e,t.data.normals=i,o.length>0&&(t.data.colors=o),a.length>0&&(t.data.uvs=[a]),t.data.faces=n,t},clone:function(){return(new uo).copy(this)},copy:function(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;const e=t.vertices;for(let u=0,p=e.length;u<p;u++)this.vertices.push(e[u].clone());const n=t.colors;for(let u=0,p=n.length;u<p;u++)this.colors.push(n[u].clone());const i=t.faces;for(let u=0,p=i.length;u<p;u++)this.faces.push(i[u].clone());for(let u=0,p=t.faceVertexUvs.length;u<p;u++){const e=t.faceVertexUvs[u];void 0===this.faceVertexUvs[u]&&(this.faceVertexUvs[u]=[]);for(let t=0,n=e.length;t<n;t++){const n=e[t],i=[];for(let t=0,e=n.length;t<e;t++){const e=n[t];i.push(e.clone())}this.faceVertexUvs[u].push(i)}}const r=t.morphTargets;for(let u=0,p=r.length;u<p;u++){const t={};if(t.name=r[u].name,void 0!==r[u].vertices){t.vertices=[];for(let e=0,n=r[u].vertices.length;e<n;e++)t.vertices.push(r[u].vertices[e].clone())}if(void 0!==r[u].normals){t.normals=[];for(let e=0,n=r[u].normals.length;e<n;e++)t.normals.push(r[u].normals[e].clone())}this.morphTargets.push(t)}const o=t.morphNormals;for(let u=0,p=o.length;u<p;u++){const t={};if(void 0!==o[u].vertexNormals){t.vertexNormals=[];for(let e=0,n=o[u].vertexNormals.length;e<n;e++){const n=o[u].vertexNormals[e],i={};i.a=n.a.clone(),i.b=n.b.clone(),i.c=n.c.clone(),t.vertexNormals.push(i)}}if(void 0!==o[u].faceNormals){t.faceNormals=[];for(let e=0,n=o[u].faceNormals.length;e<n;e++)t.faceNormals.push(o[u].faceNormals[e].clone())}this.morphNormals.push(t)}const s=t.skinWeights;for(let u=0,p=s.length;u<p;u++)this.skinWeights.push(s[u].clone());const a=t.skinIndices;for(let u=0,p=a.length;u<p;u++)this.skinIndices.push(a[u].clone());const c=t.lineDistances;for(let u=0,p=c.length;u<p;u++)this.lineDistances.push(c[u]);const l=t.boundingBox;null!==l&&(this.boundingBox=l.clone());const h=t.boundingSphere;return null!==h&&(this.boundingSphere=h.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class po extends uo{constructor(t,e,n,i,r,o){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:o},this.fromBufferGeometry(new fo(t,e,n,i,r,o)),this.mergeVertices()}}exports.CubeGeometry=exports.BoxGeometry=po;class fo extends zr{constructor(t,e,n,i,r,o){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const s=this;t=t||1,e=e||1,n=n||1,i=Math.floor(i)||1,r=Math.floor(r)||1,o=Math.floor(o)||1;const a=[],c=[],l=[],h=[];let u=0,p=0;function d(t,e,n,i,r,o,d,f,m,g,v){const y=o/m,x=d/g,_=o/2,b=d/2,w=f/2,M=m+1,S=g+1;let T=0,E=0;const A=new Yn;for(let s=0;s<S;s++){const o=s*x-b;for(let a=0;a<M;a++){const u=a*y-_;A[t]=u*i,A[e]=o*r,A[n]=w,c.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=f>0?1:-1,l.push(A.x,A.y,A.z),h.push(a/m),h.push(1-s/g),T+=1}}for(let s=0;s<g;s++)for(let t=0;t<m;t++){const e=u+t+M*s,n=u+t+M*(s+1),i=u+(t+1)+M*(s+1),r=u+(t+1)+M*s;a.push(e,n,r),a.push(n,i,r),E+=6}s.addGroup(p,E,v),p+=E,u+=T}d("z","y","x",-1,-1,n,e,t,o,r,0),d("z","y","x",1,-1,n,e,-t,o,r,1),d("x","z","y",1,1,t,n,e,i,o,2),d("x","z","y",1,-1,t,n,-e,i,o,3),d("x","y","z",1,-1,t,e,n,i,r,4),d("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(a),this.setAttribute("position",new Rr(c,3)),this.setAttribute("normal",new Rr(l,3)),this.setAttribute("uv",new Rr(h,2))}}function mo(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function go(t){const e={};for(let n=0;n<t.length;n++){const i=mo(t[n]);for(const t in i)e[t]=i[t]}return e}exports.BoxBufferGeometry=fo;const vo={clone:mo,merge:go};exports.UniformsUtils=vo;var yo="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",xo="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function _o(t){vr.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=yo,this.fragmentShader=xo,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function bo(){_i.call(this),this.type="Camera",this.matrixWorldInverse=new ni,this.projectionMatrix=new ni,this.projectionMatrixInverse=new ni}function wo(t,e,n,i){bo.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}_o.prototype=Object.create(vr.prototype),_o.prototype.constructor=_o,_o.prototype.isShaderMaterial=!0,_o.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=mo(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this},_o.prototype.toJSON=function(t){const e=vr.prototype.toJSON.call(this,t);e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(e.extensions=n),e},bo.prototype=Object.assign(Object.create(_i.prototype),{constructor:bo,isCamera:!0,copy:function(t,e){return _i.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Yn),this.updateMatrixWorld(!0);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){_i.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,e){_i.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),wo.prototype=Object.assign(Object.create(bo.prototype),{constructor:wo,isPerspectiveCamera:!0,copy:function(t,e){return bo.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){const e=.5*this.getFilmHeight()/t;this.fov=2*In.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){const t=Math.tan(.5*In.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*In.RAD2DEG*Math.atan(Math.tan(.5*In.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,i,r,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){let t=this.near,e=t*Math.tan(.5*In.DEG2RAD*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i,o=this.view;if(null!==this.view&&this.view.enabled){const t=o.fullWidth,s=o.fullHeight;r+=o.offsetX*i/t,e-=o.offsetY*n/s,i*=o.width/t,n*=o.height/s}const s=this.filmOffset;0!==s&&(r+=t*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){const e=_i.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});const Mo=90,So=1;function To(t,e,n){if(_i.call(this),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new wo(Mo,So,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Yn(1,0,0)),this.add(i);const r=new wo(Mo,So,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Yn(-1,0,0)),this.add(r);const o=new wo(Mo,So,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new Yn(0,1,0)),this.add(o);const s=new wo(Mo,So,t,e);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new Yn(0,-1,0)),this.add(s);const a=new wo(Mo,So,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Yn(0,0,1)),this.add(a);const c=new wo(Mo,So,t,e);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new Yn(0,0,-1)),this.add(c),this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();const l=t.xr.enabled,h=t.getRenderTarget();t.xr.enabled=!1;const u=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,r),t.setRenderTarget(n,2),t.render(e,o),t.setRenderTarget(n,3),t.render(e,s),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=u,t.setRenderTarget(n,5),t.render(e,c),t.setRenderTarget(h),t.xr.enabled=l},this.clear=function(t,e,i,r){const o=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(n,s),t.clear(e,i,r);t.setRenderTarget(o)}}function Eo(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),Vn.call(this,t,t,e)}function Ao(t,e,n,i,r,o,s,a,c,l,h,u){Hn.call(this,null,o,s,a,c,l,i,r,h,u),this.image={data:t||null,width:e||1,height:n||1},this.magFilter=void 0!==c?c:dt,this.minFilter=void 0!==l?l:dt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}To.prototype=Object.create(_i.prototype),To.prototype.constructor=To,Eo.prototype=Object.create(Vn.prototype),Eo.prototype.constructor=Eo,Eo.prototype.isWebGLCubeRenderTarget=!0,Eo.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=e.format,this.texture.encoding=e.encoding;const n=new bi,i={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#include <common>","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV = equirectUv( direction );","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},r=new _o({name:"CubemapFromEquirect",uniforms:mo(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:f,blending:y});r.uniforms.tEquirect.value=e;const o=new ro(new fo(5,5,5),r);return n.add(o),new To(1,10,this).update(t,n),o.geometry.dispose(),o.material.dispose(),this},Ao.prototype=Object.create(Hn.prototype),Ao.prototype.constructor=Ao,Ao.prototype.isDataTexture=!0;const Lo=new Gi,Ro=new Yn;function Co(t,e,n,i,r,o){this.planes=[void 0!==t?t:new Ji,void 0!==e?e:new Ji,void 0!==n?n:new Ji,void 0!==i?i:new Ji,void 0!==r?r:new Ji,void 0!==o?o:new Ji]}Object.assign(Co.prototype,{set:function(t,e,n,i,r,o){const s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(n),s[3].copy(i),s[4].copy(r),s[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this},setFromProjectionMatrix:function(t){const e=this.planes,n=t.elements,i=n[0],r=n[1],o=n[2],s=n[3],a=n[4],c=n[5],l=n[6],h=n[7],u=n[8],p=n[9],d=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return e[0].setComponents(s-i,h-a,f-u,y-m).normalize(),e[1].setComponents(s+i,h+a,f+u,y+m).normalize(),e[2].setComponents(s+r,h+c,f+p,y+g).normalize(),e[3].setComponents(s-r,h-c,f-p,y-g).normalize(),e[4].setComponents(s-o,h-l,f-d,y-v).normalize(),e[5].setComponents(s+o,h+l,f+d,y+v).normalize(),this},intersectsObject:function(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Lo.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Lo)},intersectsSprite:function(t){return Lo.center.set(0,0,0),Lo.radius=.7071067811865476,Lo.applyMatrix4(t.matrixWorld),this.intersectsSphere(Lo)},intersectsSphere:function(t){const e=this.planes,n=t.center,i=-t.radius;for(let r=0;r<6;r++){if(e[r].distanceToPoint(n)<i)return!1}return!0},intersectsBox:function(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(Ro.x=i.normal.x>0?t.max.x:t.min.x,Ro.y=i.normal.y>0?t.max.y:t.min.y,Ro.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(Ro)<0)return!1}return!0},containsPoint:function(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}});const Po={common:{diffuse:{value:new ur(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Fn},uv2Transform:{value:new Fn},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Bn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ur(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new ur(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Fn}},sprite:{diffuse:{value:new ur(15658734)},opacity:{value:1},center:{value:new Bn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Fn}}};function Oo(){let t=null,e=!1,n=null,i=null;function r(e,o){n(e,o),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function Do(t,e){const n=e.isWebGL2,i=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=i.get(e);n&&(t.deleteBuffer(n.buffer),i.delete(e))},update:function(e,r){e.isInterleavedBufferAttribute&&(e=e.data);const o=i.get(e);void 0===o?i.set(e,function(e,n){const i=e.array,r=e.usage,o=t.createBuffer();t.bindBuffer(n,o),t.bufferData(n,i,r),e.onUploadCallback();let s=5126;return i instanceof Float32Array?s=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?s=5123:i instanceof Int16Array?s=5122:i instanceof Uint32Array?s=5125:i instanceof Int32Array?s=5124:i instanceof Int8Array?s=5120:i instanceof Uint8Array&&(s=5121),{buffer:o,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}(e,r)):o.version<e.version&&(function(e,i,r){const o=i.array,s=i.updateRange;t.bindBuffer(r,e),-1===s.count?t.bufferSubData(r,0,o):(n?t.bufferSubData(r,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):t.bufferSubData(r,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1)}(o.buffer,e,r),o.version=e.version)}}}function No(t,e,n,i){uo.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i},this.fromBufferGeometry(new Io(t,e,n,i)),this.mergeVertices()}function Io(t,e,n,i){zr.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=(t=t||1)/2,o=(e=e||1)/2,s=Math.floor(n)||1,a=Math.floor(i)||1,c=s+1,l=a+1,h=t/s,u=e/a,p=[],d=[],f=[],m=[];for(let g=0;g<l;g++){const t=g*u-o;for(let e=0;e<c;e++){const n=e*h-r;d.push(n,-t,0),f.push(0,0,1),m.push(e/s),m.push(1-g/a)}}for(let g=0;g<a;g++)for(let t=0;t<s;t++){const e=t+c*g,n=t+c*(g+1),i=t+1+c*(g+1),r=t+1+c*g;p.push(e,n,r),p.push(n,i,r)}this.setIndex(p),this.setAttribute("position",new Rr(d,3)),this.setAttribute("normal",new Rr(f,3)),this.setAttribute("uv",new Rr(m,2))}exports.UniformsLib=Po,No.prototype=Object.create(uo.prototype),No.prototype.constructor=No,Io.prototype=Object.create(zr.prototype),Io.prototype.constructor=Io;var Bo="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",Fo="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",Go="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",Uo="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",zo="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",Ho="vec3 transformed = vec3( position );",ko="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",Vo="vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",jo="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",Wo="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",qo="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",Xo="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",Yo="#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",Zo="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",Jo="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",Qo="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",Ko="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",$o="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",ts="#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);    } else if (face == 1.0) {\n      uv = vec2(-direction.x, -direction.z) / abs(direction.y);    } else if (face == 2.0) {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);    } else if (face == 3.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);    } else if (face == 4.0) {\n      uv = vec2(-direction.x, direction.z) / abs(direction.y);    } else {\n      uv = vec2(direction.x, direction.y) / abs(direction.z);    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",es="vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",ns="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",is="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",rs="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",os="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",ss="gl_FragColor = linearToOutputTexel( gl_FragColor );",as="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",cs="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",ls="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",hs="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",us="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",ps="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",ds="#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fs="#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",ms="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",gs="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",vs="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",ys="#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",xs="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",_s="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",bs="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",ws="#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",Ms="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",Ss="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",Ts="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",Es="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",As="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",Ls="struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",Rs="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",Cs="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",Ps="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",Os="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",Ds="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",Ns="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",Is="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",Bs="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",Fs="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",Gs="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",Us="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",zs="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",Hs="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",ks="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",Vs="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",js="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",Ws="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",qs="#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",Xs="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",Ys="#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",Zs="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",Js="#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",Qs="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",Ks="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",$s="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",ta="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",ea="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",na="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",ia="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",ra="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",oa="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",sa="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",aa="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",ca="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",la="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",ha="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",ua="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",pa="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",da="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",fa="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",ma="#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",ga="#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",va="#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",ya="#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",xa="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",_a="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",ba="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",wa="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",Ma="uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",Sa="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",Ta="#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",Ea="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",Aa="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",La="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",Ra="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",Ca="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",Pa="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",Oa="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",Da="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",Na="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",Ia="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Ba="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",Fa="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Ga="#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Ua="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",za="#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",Ha="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",ka="#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Va="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",ja="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Wa="#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",qa="#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Xa="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",Ya="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",Za="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",Ja="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",Qa="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",Ka="#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",$a="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",tc="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}";const ec={alphamap_fragment:Bo,alphamap_pars_fragment:Fo,alphatest_fragment:Go,aomap_fragment:Uo,aomap_pars_fragment:zo,begin_vertex:Ho,beginnormal_vertex:ko,bsdfs:Vo,bumpmap_pars_fragment:jo,clipping_planes_fragment:Wo,clipping_planes_pars_fragment:qo,clipping_planes_pars_vertex:Xo,clipping_planes_vertex:Yo,color_fragment:Zo,color_pars_fragment:Jo,color_pars_vertex:Qo,color_vertex:Ko,common:$o,cube_uv_reflection_fragment:ts,defaultnormal_vertex:es,displacementmap_pars_vertex:ns,displacementmap_vertex:is,emissivemap_fragment:rs,emissivemap_pars_fragment:os,encodings_fragment:ss,encodings_pars_fragment:as,envmap_fragment:cs,envmap_common_pars_fragment:ls,envmap_pars_fragment:hs,envmap_pars_vertex:us,envmap_physical_pars_fragment:ws,envmap_vertex:ps,fog_vertex:ds,fog_pars_vertex:fs,fog_fragment:ms,fog_pars_fragment:gs,gradientmap_pars_fragment:vs,lightmap_fragment:ys,lightmap_pars_fragment:xs,lights_lambert_vertex:_s,lights_pars_begin:bs,lights_toon_fragment:Ms,lights_toon_pars_fragment:Ss,lights_phong_fragment:Ts,lights_phong_pars_fragment:Es,lights_physical_fragment:As,lights_physical_pars_fragment:Ls,lights_fragment_begin:Rs,lights_fragment_maps:Cs,lights_fragment_end:Ps,logdepthbuf_fragment:Os,logdepthbuf_pars_fragment:Ds,logdepthbuf_pars_vertex:Ns,logdepthbuf_vertex:Is,map_fragment:Bs,map_pars_fragment:Fs,map_particle_fragment:Gs,map_particle_pars_fragment:Us,metalnessmap_fragment:zs,metalnessmap_pars_fragment:Hs,morphnormal_vertex:ks,morphtarget_pars_vertex:Vs,morphtarget_vertex:js,normal_fragment_begin:Ws,normal_fragment_maps:qs,normalmap_pars_fragment:Xs,clearcoat_normal_fragment_begin:Ys,clearcoat_normal_fragment_maps:Zs,clearcoat_pars_fragment:Js,packing:Qs,premultiplied_alpha_fragment:Ks,project_vertex:$s,dithering_fragment:ta,dithering_pars_fragment:ea,roughnessmap_fragment:na,roughnessmap_pars_fragment:ia,shadowmap_pars_fragment:ra,shadowmap_pars_vertex:oa,shadowmap_vertex:sa,shadowmask_pars_fragment:aa,skinbase_vertex:ca,skinning_pars_vertex:la,skinning_vertex:ha,skinnormal_vertex:ua,specularmap_fragment:pa,specularmap_pars_fragment:da,tonemapping_fragment:fa,tonemapping_pars_fragment:ma,uv_pars_fragment:ga,uv_pars_vertex:va,uv_vertex:ya,uv2_pars_fragment:xa,uv2_pars_vertex:_a,uv2_vertex:ba,worldpos_vertex:wa,background_frag:Ma,background_vert:Sa,cube_frag:Ta,cube_vert:Ea,depth_frag:Aa,depth_vert:La,distanceRGBA_frag:Ra,distanceRGBA_vert:Ca,equirect_frag:Pa,equirect_vert:Oa,linedashed_frag:Da,linedashed_vert:Na,meshbasic_frag:Ia,meshbasic_vert:Ba,meshlambert_frag:Fa,meshlambert_vert:Ga,meshmatcap_frag:Ua,meshmatcap_vert:za,meshtoon_frag:Ha,meshtoon_vert:ka,meshphong_frag:Va,meshphong_vert:ja,meshphysical_frag:Wa,meshphysical_vert:qa,normal_frag:Xa,normal_vert:Ya,points_frag:Za,points_vert:Ja,shadow_frag:Qa,shadow_vert:Ka,sprite_frag:$a,sprite_vert:tc};exports.ShaderChunk=ec;const nc={basic:{uniforms:go([Po.common,Po.specularmap,Po.envmap,Po.aomap,Po.lightmap,Po.fog]),vertexShader:ec.meshbasic_vert,fragmentShader:ec.meshbasic_frag},lambert:{uniforms:go([Po.common,Po.specularmap,Po.envmap,Po.aomap,Po.lightmap,Po.emissivemap,Po.fog,Po.lights,{emissive:{value:new ur(0)}}]),vertexShader:ec.meshlambert_vert,fragmentShader:ec.meshlambert_frag},phong:{uniforms:go([Po.common,Po.specularmap,Po.envmap,Po.aomap,Po.lightmap,Po.emissivemap,Po.bumpmap,Po.normalmap,Po.displacementmap,Po.fog,Po.lights,{emissive:{value:new ur(0)},specular:{value:new ur(1118481)},shininess:{value:30}}]),vertexShader:ec.meshphong_vert,fragmentShader:ec.meshphong_frag},standard:{uniforms:go([Po.common,Po.envmap,Po.aomap,Po.lightmap,Po.emissivemap,Po.bumpmap,Po.normalmap,Po.displacementmap,Po.roughnessmap,Po.metalnessmap,Po.fog,Po.lights,{emissive:{value:new ur(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ec.meshphysical_vert,fragmentShader:ec.meshphysical_frag},toon:{uniforms:go([Po.common,Po.aomap,Po.lightmap,Po.emissivemap,Po.bumpmap,Po.normalmap,Po.displacementmap,Po.gradientmap,Po.fog,Po.lights,{emissive:{value:new ur(0)}}]),vertexShader:ec.meshtoon_vert,fragmentShader:ec.meshtoon_frag},matcap:{uniforms:go([Po.common,Po.bumpmap,Po.normalmap,Po.displacementmap,Po.fog,{matcap:{value:null}}]),vertexShader:ec.meshmatcap_vert,fragmentShader:ec.meshmatcap_frag},points:{uniforms:go([Po.points,Po.fog]),vertexShader:ec.points_vert,fragmentShader:ec.points_frag},dashed:{uniforms:go([Po.common,Po.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ec.linedashed_vert,fragmentShader:ec.linedashed_frag},depth:{uniforms:go([Po.common,Po.displacementmap]),vertexShader:ec.depth_vert,fragmentShader:ec.depth_frag},normal:{uniforms:go([Po.common,Po.bumpmap,Po.normalmap,Po.displacementmap,{opacity:{value:1}}]),vertexShader:ec.normal_vert,fragmentShader:ec.normal_frag},sprite:{uniforms:go([Po.sprite,Po.fog]),vertexShader:ec.sprite_vert,fragmentShader:ec.sprite_frag},background:{uniforms:{uvTransform:{value:new Fn},t2D:{value:null}},vertexShader:ec.background_vert,fragmentShader:ec.background_frag},cube:{uniforms:go([Po.envmap,{opacity:{value:1}}]),vertexShader:ec.cube_vert,fragmentShader:ec.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ec.equirect_vert,fragmentShader:ec.equirect_frag},distanceRGBA:{uniforms:go([Po.common,Po.displacementmap,{referencePosition:{value:new Yn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ec.distanceRGBA_vert,fragmentShader:ec.distanceRGBA_frag},shadow:{uniforms:go([Po.lights,Po.fog,{color:{value:new ur(0)},opacity:{value:1}}]),vertexShader:ec.shadow_vert,fragmentShader:ec.shadow_frag}};function ic(t,e,n,i){const r=new ur(0);let o,s,a=0,c=null,l=0,h=null;function u(t,n){e.buffers.color.setClear(t.r,t.g,t.b,n,i)}return{getClearColor:function(){return r},setClearColor:function(t,e){r.set(t),u(r,a=void 0!==e?e:1)},getClearAlpha:function(){return a},setClearAlpha:function(t){u(r,a=t)},render:function(e,i,p,m){let g=!0===i.isScene?i.background:null;const v=t.xr,y=v.getSession&&v.getSession();if(y&&"additive"===y.environmentBlendMode&&(g=null),null===g?u(r,a):g&&g.isColor&&(u(g,1),m=!0),(t.autoClear||m)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),g&&(g.isCubeTexture||g.isWebGLCubeRenderTarget||g.mapping===ct)){void 0===s&&((s=new ro(new fo(1,1,1),new _o({name:"BackgroundCubeMaterial",uniforms:mo(nc.cube.uniforms),vertexShader:nc.cube.vertexShader,fragmentShader:nc.cube.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(s));const i=g.isWebGLCubeRenderTarget?g.texture:g;s.material.uniforms.envMap.value=i,s.material.uniforms.flipEnvMap.value=i.isCubeTexture?-1:1,c===g&&l===i.version&&h===t.toneMapping||(s.material.needsUpdate=!0,c=g,l=i.version,h=t.toneMapping),e.unshift(s,s.geometry,s.material,0,0,null)}else g&&g.isTexture&&(void 0===o&&((o=new ro(new Io(2,2),new _o({name:"BackgroundMaterial",uniforms:mo(nc.background.uniforms),vertexShader:nc.background.vertexShader,fragmentShader:nc.background.fragmentShader,side:d,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=g,!0===g.matrixAutoUpdate&&g.updateMatrix(),o.material.uniforms.uvTransform.value.copy(g.matrix),c===g&&l===g.version&&h===t.toneMapping||(o.material.needsUpdate=!0,c=g,l=g.version,h=t.toneMapping),e.unshift(o,o.geometry,o.material,0,0,null))}}}function rc(t,e,n,i){const r=t.getParameter(34921),o=null,s=!1,a={},c=p(null);let l=c;function h(e){return i.isWebGL2?t.bindVertexArray(e):o.bindVertexArrayOES(e)}function u(e){return i.isWebGL2?t.deleteVertexArray(e):o.deleteVertexArrayOES(e)}function p(t){const e=[],n=[],i=[];for(let o=0;o<r;o++)e[o]=0,n[o]=0,i[o]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:i,object:t,attributes:{}}}function d(){const t=l.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function f(t){m(t,0)}function m(n,r){const o=l.newAttributes,s=l.enabledAttributes,a=l.attributeDivisors;if(o[n]=1,0===s[n]&&(t.enableVertexAttribArray(n),s[n]=1),a[n]!==r){(i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),a[n]=r}}function g(){const e=l.newAttributes,n=l.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function v(e,n,r,o,s,a){!0!==i.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,n,r,o,s,a):t.vertexAttribIPointer(e,n,r,o,s,a)}function y(){x(),l!==c&&h((l=c).object)}function x(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function(r,c,u,y,x){let _=!1;if(s){const e=function(e,n,r){const s=!0===r.wireframe;let c=a[e.id];void 0===c&&(c={},a[e.id]=c);let l=c[n.id];void 0===l&&(l={},c[n.id]=l);let h=l[s];return void 0===h&&(h=p(i.isWebGL2?t.createVertexArray():o.createVertexArrayOES()),l[s]=h),h}(y,u,c);l!==e&&h((l=e).object),(_=function(t){const e=l.attributes,n=t.attributes;if(Object.keys(e).length!==Object.keys(n).length)return!0;for(const i in n){const t=e[i],r=n[i];if(t.attribute!==r)return!0;if(t.data!==r.data)return!0}return!1}(y))&&function(t){const e={},n=t.attributes;for(const i in n){const t=n[i],r={};r.attribute=t,t.data&&(r.data=t.data),e[i]=r}l.attributes=e}(y)}else{const t=!0===c.wireframe;l.geometry===y.id&&l.program===u.id&&l.wireframe===t||(l.geometry=y.id,l.program=u.id,l.wireframe=t,_=!0)}!0===r.isInstancedMesh&&(_=!0),null!==x&&n.update(x,34963),_&&(function(r,o,s,a){if(!1===i.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;d();const c=a.attributes,l=s.getAttributes(),h=o.defaultAttributeValues;for(const e in l){const i=l[e];if(i>=0){const o=c[e];if(void 0!==o){const e=o.normalized,r=o.itemSize,s=n.get(o);if(void 0===s)continue;const c=s.buffer,l=s.type,h=s.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,s=n.stride,u=o.offset;n&&n.isInstancedInterleavedBuffer?(m(i,n.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)):f(i),t.bindBuffer(34962,c),v(i,r,l,e,s*h,u*h)}else o.isInstancedBufferAttribute?(m(i,o.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)):f(i),t.bindBuffer(34962,c),v(i,r,l,e,0,0)}else if("instanceMatrix"===e){const e=n.get(r.instanceMatrix);if(void 0===e)continue;const o=e.buffer,s=e.type;m(i+0,1),m(i+1,1),m(i+2,1),m(i+3,1),t.bindBuffer(34962,o),t.vertexAttribPointer(i+0,4,s,!1,64,0),t.vertexAttribPointer(i+1,4,s,!1,64,16),t.vertexAttribPointer(i+2,4,s,!1,64,32),t.vertexAttribPointer(i+3,4,s,!1,64,48)}else if(void 0!==h){const n=h[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(i,n);break;case 3:t.vertexAttrib3fv(i,n);break;case 4:t.vertexAttrib4fv(i,n);break;default:t.vertexAttrib1fv(i,n)}}}}g()}(r,c,u,y),null!==x&&t.bindBuffer(34963,n.get(x).buffer))},reset:y,resetDefaultState:x,dispose:function(){y();for(const t in a){const e=a[t];for(const t in e){const n=e[t];for(const t in n)u(n[t].object),delete n[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const n in e){const t=e[n];for(const e in t)u(t[e].object),delete t[e];delete e[n]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const n=a[e];if(void 0===n[t.id])continue;const i=n[t.id];for(const t in i)u(i[t].object),delete i[t];delete n[t.id]}},initAttributes:d,enableAttribute:f,disableUnusedAttributes:g}}function oc(t,e,n,i){const r=i.isWebGL2;let o;this.setMode=function(t){o=t},this.render=function(e,i){t.drawArrays(o,e,i),n.update(i,o)},this.renderInstances=function(i,s,a,c){if(0===c)return;let l,h;if(r)l=t,h="drawArraysInstanced";else if(h="drawArraysInstancedANGLE",null===(l=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[h](o,s,a,c),n.update(a,o,c)}}function sc(t,e,n){let i;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let s=void 0!==n.precision?n.precision:"highp";const a=r(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const c=!0===n.logarithmicDepthBuffer,l=t.getParameter(34930),h=t.getParameter(35660),u=t.getParameter(3379),p=t.getParameter(34076),d=t.getParameter(34921),f=t.getParameter(36347),m=t.getParameter(36348),g=t.getParameter(36349),v=h>0,y=o||!!e.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==i)return i;const n=e.get("EXT_texture_filter_anisotropic");return i=null!==n?t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:s,logarithmicDepthBuffer:c,maxTextures:l,maxVertexTextures:h,maxTextureSize:u,maxCubemapSize:p,maxAttributes:d,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?t.getParameter(36183):0}}function ac(){const t=this;let e=null,n=0,i=!1,r=!1;const o=new Ji,s=new Fn,a={value:null,needsUpdate:!1};function c(){a.value!==e&&(a.value=e,a.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function l(e,n,i,r){let c=null!==e?e.length:0,l=null;if(0!==c){if(l=a.value,!0!==r||null===l){const t=i+4*c,r=n.matrixWorldInverse;s.getNormalMatrix(r),(null===l||l.length<t)&&(l=new Float32Array(t));for(let n=0,a=i;n!==c;++n,a+=4)o.copy(e[n]).applyMatrix4(r,s),o.normal.toArray(l,a),l[a+3]=o.constant}a.value=l,a.needsUpdate=!0}return t.numPlanes=c,t.numIntersection=0,l}this.uniform=a,this.numPlanes=0,this.numIntersection=0,this.init=function(t,r,o){const s=0!==t.length||r||0!==n||i;return i=r,e=l(t,o,0),n=t.length,s},this.beginShadows=function(){r=!0,l(null)},this.endShadows=function(){r=!1,c()},this.setState=function(t,o,s,h,u,p){if(!i||null===t||0===t.length||r&&!s)r?l(null):c();else{const i=r?0:n,s=4*i;let c=u.clippingState||null;a.value=c,c=l(t,h,s,p);for(let t=0;t!==s;++t)c[t]=e[t];u.clippingState=c,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=i}}}function cc(t){const e={};return{get:function(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return null===i&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),e[n]=i,i}}}function lc(t,e,n,i){const r=new WeakMap,o=new WeakMap;function s(t){const a=t.target,c=r.get(a);null!==c.index&&e.remove(c.index);for(const n in c.attributes)e.remove(c.attributes[n]);a.removeEventListener("dispose",s),r.delete(a);const l=o.get(c);l&&(e.remove(l),o.delete(c)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){const n=[],i=t.index,r=t.attributes.position;let s=0;if(null!==i){const t=i.array;s=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],r=t[e+1],o=t[e+2];n.push(i,r,r,o,o,i)}}else{const t=r.array;s=r.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,r=e+2;n.push(t,i,i,r,r,t)}}const a=new(Or(n)>65535?Lr:Er)(n,1);a.version=s;const c=o.get(t);c&&e.remove(c),o.set(t,a)}return{get:function(t,e){let i=r.get(e);return i||(e.addEventListener("dispose",s),e.isBufferGeometry?i=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new zr).setFromObject(t)),i=e._bufferGeometry),r.set(e,i),n.memory.geometries++,i)},update:function(t){const n=t.attributes;for(const r in n)e.update(n[r],34962);const i=t.morphAttributes;for(const r in i){const t=i[r];for(let n=0,i=t.length;n<i;n++)e.update(t[n],34962)}},getWireframeAttribute:function(t){const e=o.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return o.get(t)}}}function hc(t,e,n,i){const r=i.isWebGL2;let o,s,a;this.setMode=function(t){o=t},this.setIndex=function(t){s=t.type,a=t.bytesPerElement},this.render=function(e,i){t.drawElements(o,i,s,e*a),n.update(i,o)},this.renderInstances=function(i,c,l,h){if(0===h)return;let u,p;if(r)u=t,p="drawElementsInstanced";else if(p="drawElementsInstancedANGLE",null===(u=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[p](o,l,s,c*a,h),n.update(l,o,h)}}function uc(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,i){switch(i=i||1,e.calls++,n){case 4:e.triangles+=i*(t/3);break;case 1:e.lines+=i*(t/2);break;case 3:e.lines+=i*(t-1);break;case 2:e.lines+=i*t;break;case 0:e.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function pc(t,e){return t[0]-e[0]}function dc(t,e){return Math.abs(e[1])-Math.abs(t[1])}function fc(t){const e={},n=new Float32Array(8),i=[];for(let r=0;r<8;r++)i[r]=[r,0];return{update:function(r,o,s,a){const c=r.morphTargetInfluences,l=void 0===c?0:c.length;let h=e[o.id];if(void 0===h){h=[];for(let t=0;t<l;t++)h[t]=[t,0];e[o.id]=h}for(let t=0;t<l;t++){const e=h[t];e[0]=t,e[1]=c[t]}h.sort(dc);for(let t=0;t<8;t++)t<l&&h[t][1]?(i[t][0]=h[t][0],i[t][1]=h[t][1]):(i[t][0]=Number.MAX_SAFE_INTEGER,i[t][1]=0);i.sort(pc);const u=s.morphTargets&&o.morphAttributes.position,p=s.morphNormals&&o.morphAttributes.normal;let d=0;for(let t=0;t<8;t++){const e=i[t],r=e[0],s=e[1];r!==Number.MAX_SAFE_INTEGER&&s?(u&&o.getAttribute("morphTarget"+t)!==u[r]&&o.setAttribute("morphTarget"+t,u[r]),p&&o.getAttribute("morphNormal"+t)!==p[r]&&o.setAttribute("morphNormal"+t,p[r]),n[t]=s,d+=s):(u&&void 0!==o.getAttribute("morphTarget"+t)&&o.deleteAttribute("morphTarget"+t),p&&void 0!==o.getAttribute("morphNormal"+t)&&o.deleteAttribute("morphNormal"+t),n[t]=0)}const f=o.morphTargetsRelative?1:1-d;a.getUniforms().setValue(t,"morphTargetBaseInfluence",f),a.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function mc(t,e,n,i){let r=new WeakMap;return{update:function(t){const o=i.render.frame,s=t.geometry,a=e.get(t,s);return r.get(a)!==o&&(s.isGeometry&&a.updateFromObject(t),e.update(a),r.set(a,o)),t.isInstancedMesh&&n.update(t.instanceMatrix,34962),a},dispose:function(){r=new WeakMap}}}function gc(t,e,n,i,r,o,s,a,c,l){t=void 0!==t?t:[],e=void 0!==e?e:rt,s=void 0!==s?s:Bt,Hn.call(this,t,e,n,i,r,o,s,a,c,l),this.flipY=!1}function vc(t,e,n,i){Hn.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:i||1},this.magFilter=dt,this.minFilter=dt,this.wrapR=ut,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function yc(t,e,n,i){Hn.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:i||1},this.magFilter=dt,this.minFilter=dt,this.wrapR=ut,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}exports.ShaderLib=nc,nc.physical={uniforms:go([nc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Bn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new ur(0)},transparency:{value:0}}]),vertexShader:ec.meshphysical_vert,fragmentShader:ec.meshphysical_frag},gc.prototype=Object.create(Hn.prototype),gc.prototype.constructor=gc,gc.prototype.isCubeTexture=!0,Object.defineProperty(gc.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),vc.prototype=Object.create(Hn.prototype),vc.prototype.constructor=vc,vc.prototype.isDataTexture2DArray=!0,yc.prototype=Object.create(Hn.prototype),yc.prototype.constructor=yc,yc.prototype.isDataTexture3D=!0;const xc=new Hn,_c=new vc,bc=new yc,wc=new gc,Mc=[],Sc=[],Tc=new Float32Array(16),Ec=new Float32Array(9),Ac=new Float32Array(4);function Lc(t,e,n){const i=t[0];if(i<=0||i>0)return t;let r=e*n,o=Mc[r];if(void 0===o&&(o=new Float32Array(r),Mc[r]=o),0!==e){i.toArray(o,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(o,r)}return o}function Rc(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Cc(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function Pc(t,e){let n=Sc[e];void 0===n&&(n=new Int32Array(e),Sc[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function Oc(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Dc(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Rc(n,e))return;t.uniform2fv(this.addr,e),Cc(n,e)}}function Nc(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Rc(n,e))return;t.uniform3fv(this.addr,e),Cc(n,e)}}function Ic(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Rc(n,e))return;t.uniform4fv(this.addr,e),Cc(n,e)}}function Bc(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Rc(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Cc(n,e)}else{if(Rc(n,i))return;Ac.set(i),t.uniformMatrix2fv(this.addr,!1,Ac),Cc(n,i)}}function Fc(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Rc(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Cc(n,e)}else{if(Rc(n,i))return;Ec.set(i),t.uniformMatrix3fv(this.addr,!1,Ec),Cc(n,i)}}function Gc(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Rc(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Cc(n,e)}else{if(Rc(n,i))return;Tc.set(i),t.uniformMatrix4fv(this.addr,!1,Tc),Cc(n,i)}}function Uc(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(e||xc,r)}function zc(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||_c,r)}function Hc(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||bc,r)}function kc(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(e||wc,r)}function Vc(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function jc(t,e){const n=this.cache;Rc(n,e)||(t.uniform2iv(this.addr,e),Cc(n,e))}function Wc(t,e){const n=this.cache;Rc(n,e)||(t.uniform3iv(this.addr,e),Cc(n,e))}function qc(t,e){const n=this.cache;Rc(n,e)||(t.uniform4iv(this.addr,e),Cc(n,e))}function Xc(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Yc(t){switch(t){case 5126:return Oc;case 35664:return Dc;case 35665:return Nc;case 35666:return Ic;case 35674:return Bc;case 35675:return Fc;case 35676:return Gc;case 5124:case 35670:return Vc;case 35667:case 35671:return jc;case 35668:case 35672:return Wc;case 35669:case 35673:return qc;case 5125:return Xc;case 35678:case 36198:case 36298:case 36306:case 35682:return Uc;case 35679:case 36299:case 36307:return Hc;case 35680:case 36300:case 36308:case 36293:return kc;case 36289:case 36303:case 36311:case 36292:return zc}}function Zc(t,e){t.uniform1fv(this.addr,e)}function Jc(t,e){t.uniform1iv(this.addr,e)}function Qc(t,e){t.uniform2iv(this.addr,e)}function Kc(t,e){t.uniform3iv(this.addr,e)}function $c(t,e){t.uniform4iv(this.addr,e)}function tl(t,e){const n=Lc(e,this.size,2);t.uniform2fv(this.addr,n)}function el(t,e){const n=Lc(e,this.size,3);t.uniform3fv(this.addr,n)}function nl(t,e){const n=Lc(e,this.size,4);t.uniform4fv(this.addr,n)}function il(t,e){const n=Lc(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function rl(t,e){const n=Lc(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function ol(t,e){const n=Lc(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function sl(t,e,n){const i=e.length,r=Pc(n,i);t.uniform1iv(this.addr,r);for(let o=0;o!==i;++o)n.safeSetTexture2D(e[o]||xc,r[o])}function al(t,e,n){const i=e.length,r=Pc(n,i);t.uniform1iv(this.addr,r);for(let o=0;o!==i;++o)n.safeSetTextureCube(e[o]||wc,r[o])}function cl(t){switch(t){case 5126:return Zc;case 35664:return tl;case 35665:return el;case 35666:return nl;case 35674:return il;case 35675:return rl;case 35676:return ol;case 5124:case 35670:return Jc;case 35667:case 35671:return Qc;case 35668:case 35672:return Kc;case 35669:case 35673:return $c;case 35678:case 36198:case 36298:case 36306:case 35682:return sl;case 35680:case 36300:case 36308:case 36293:return al}}function ll(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=Yc(e.type)}function hl(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=cl(e.type)}function ul(t){this.id=t,this.seq=[],this.map={}}hl.prototype.updateCache=function(t){let e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),Cc(e,t)},ul.prototype.setValue=function(t,e,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const o=i[r];o.setValue(t,e[o.id],n)}};const pl=/([\w\d_]+)(\])?(\[|\.)?/g;function dl(t,e){t.seq.push(e),t.map[e.id]=e}function fl(t,e,n){const i=t.name,r=i.length;for(pl.lastIndex=0;;){const o=pl.exec(i),s=pl.lastIndex;let a=o[1],c="]"===o[2],l=o[3];if(c&&(a|=0),void 0===l||"["===l&&s+2===r){dl(n,void 0===l?new ll(a,t,e):new hl(a,t,e));break}{let t=n.map[a];void 0===t&&dl(n,t=new ul(a)),n=t}}}function ml(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);fl(n,t.getUniformLocation(e,n.name),this)}}function gl(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}ml.prototype.setValue=function(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)},ml.prototype.setOptional=function(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)},ml.upload=function(t,e,n,i){for(let r=0,o=e.length;r!==o;++r){const o=e[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(t,s.value,i)}},ml.seqWithValue=function(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const r=t[i];r.id in e&&n.push(r)}return n};let vl=0;function yl(t){const e=t.split("\n");for(let n=0;n<e.length;n++)e[n]=n+1+": "+e[n];return e.join("\n")}function xl(t){switch(t){case Ze:return["Linear","( value )"];case Je:return["sRGB","( value )"];case Ke:return["RGBE","( value )"];case tn:return["RGBM","( value, 7.0 )"];case en:return["RGBM","( value, 16.0 )"];case nn:return["RGBD","( value, 256.0 )"];case Qe:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case $e:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function _l(t,e,n){const i=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();return i&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+r+yl(t.getShaderSource(e))}function bl(t,e){const n=xl(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function wl(t,e){const n=xl(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Ml(t,e){let n;switch(e){case K:n="Linear";break;case $:n="Reinhard";break;case tt:n="OptimizedCineon";break;case et:n="ACESFilmic";break;case nt:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Sl(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Al).join("\n")}function Tl(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}function El(t,e){const n={},i=t.getProgramParameter(e,35721);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r).name;n[i]=t.getAttribLocation(e,i)}return n}function Al(t){return""!==t}function Ll(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Rl(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Cl=/^[ \t]*#include +<([\w\d.\/]+)>/gm;function Pl(t){return t.replace(Cl,Ol)}function Ol(t,e){const n=ec[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return Pl(n)}const Dl=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Nl=/#pragma unroll_loop_start[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g;function Il(t){return t.replace(Nl,Fl).replace(Dl,Bl)}function Bl(t,e,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Fl(t,e,n,i)}function Fl(t,e,n,i){let r="";for(let o=parseInt(e);o<parseInt(n);o++)r+=i.replace(/\[ i \]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function Gl(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Ul(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===h?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===u?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===p&&(e="SHADOWMAP_TYPE_VSM"),e}function zl(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case rt:case ot:e="ENVMAP_TYPE_CUBE";break;case ct:case lt:e="ENVMAP_TYPE_CUBE_UV";break;case st:case at:e="ENVMAP_TYPE_EQUIREC"}return e}function Hl(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case ot:case at:e="ENVMAP_MODE_REFRACTION"}return e}function kl(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Y:e="ENVMAP_BLENDING_MULTIPLY";break;case Z:e="ENVMAP_BLENDING_MIX";break;case J:e="ENVMAP_BLENDING_ADD"}return e}function Vl(t,e,n,i){const r=t.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const c=Ul(n),l=zl(n),h=Hl(n),u=kl(n),p=t.gammaFactor>0?t.gammaFactor:1,d=n.isWebGL2?"":Sl(n),f=Tl(o),m=r.createProgram();let g,v;if(n.isRawShaderMaterial?((g=[f].filter(Al).join("\n")).length>0&&(g+="\n"),(v=[d,f].filter(Al).join("\n")).length>0&&(v+="\n")):(g=[Gl(n),"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+p,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Al).join("\n"),v=[d,Gl(n),"#define SHADER_NAME "+n.shaderName,f,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+h:"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Q?"#define TONE_MAPPING":"",n.toneMapping!==Q?ec.tonemapping_pars_fragment:"",n.toneMapping!==Q?Ml("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",ec.encodings_pars_fragment,n.map?bl("mapTexelToLinear",n.mapEncoding):"",n.matcap?bl("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?bl("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?bl("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?bl("lightMapTexelToLinear",n.lightMapEncoding):"",wl("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Al).join("\n")),s=Rl(s=Ll(s=Pl(s),n),n),a=Rl(a=Ll(a=Pl(a),n),n),s=Il(s),a=Il(a),n.isWebGL2&&!n.isRawShaderMaterial){let t=!1;const e=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&null!==s.match(e)&&null!==a.match(e)&&(t=!0,s=s.replace(e,""),a=a.replace(e,"")),g=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#version 300 es\n","#define varying in",t?"":"out highp vec4 pc_fragColor;",t?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v}const y=v+a,x=gl(r,35633,g+s),_=gl(r,35632,y);if(r.attachShader(m,x),r.attachShader(m,_),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(m).trim(),e=r.getShaderInfoLog(x).trim(),n=r.getShaderInfoLog(_).trim();let i=!0,o=!0;if(!1===r.getProgramParameter(m,35714)){i=!1;const e=_l(r,x,"vertex"),n=_l(r,_,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(m,35715),"gl.getProgramInfoLog",t,e,n)}else""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==e&&""!==n||(o=!1);o&&(this.diagnostics={runnable:i,programLog:t,vertexShader:{log:e,prefix:g},fragmentShader:{log:n,prefix:v}})}let b,w;return r.deleteShader(x),r.deleteShader(_),this.getUniforms=function(){return void 0===b&&(b=new ml(r,m)),b},this.getAttributes=function(){return void 0===w&&(w=El(r,m)),w},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=vl++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=_,this}function jl(t,e,n,i){const r=[],o=n.isWebGL2,s=n.logarithmicDepthBuffer,a=n.floatVertexTextures,c=n.maxVertexUniforms,l=n.vertexTextures;let h=n.precision;const u={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function d(t){let e;return t?t.isTexture?e=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=Ze,e}return{getParameters:function(i,r,p,g,v,y,x){const _=g.fog,b=i.isMeshStandardMaterial?g.environment:null,w=i.envMap||b,M=u[i.type],S=x.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(a)return 1024;{const t=c,n=Math.floor((t-20)/4),i=Math.min(n,e.length);return i<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+i+"."),0):i}}(x):0;null!==i.precision&&(h=n.getMaxPrecision(i.precision))!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",h,"instead.");const T=function(t,e){let n;if(e){const i=nc[e];n={name:t.name||t.type,uniforms:vo.clone(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}}else n={name:t.name||t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};return n}(i,M);i.onBeforeCompile(T,t);const E=t.getRenderTarget();return{isWebGL2:o,shaderID:M,shaderName:T.name,uniforms:T.uniforms,vertexShader:T.vertexShader,fragmentShader:T.fragmentShader,defines:i.defines,isRawShaderMaterial:i.isRawShaderMaterial,isShaderMaterial:i.isShaderMaterial,precision:h,instancing:!0===x.isInstancedMesh,supportsVertexTextures:l,outputEncoding:null!==E?d(E.texture):t.outputEncoding,map:!!i.map,mapEncoding:d(i.map),matcap:!!i.matcap,matcapEncoding:d(i.matcap),envMap:!!w,envMapMode:w&&w.mapping,envMapEncoding:d(w),envMapCubeUV:!!w&&(w.mapping===ct||w.mapping===lt),lightMap:!!i.lightMap,lightMapEncoding:d(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:d(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:i.normalMapType===an,tangentSpaceNormalMap:i.normalMapType===sn,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexUvs:!!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatMap||i.clearcoatRoughnessMap||i.clearcoatNormalMap||i.displacementMap),uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||!i.displacementMap),fog:!!_,useFog:i.fog,fogExp2:_&&_.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:s,skinning:i.skinning&&S>0,maxBones:S,useVertexTexture:a,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numDirLightShadows:r.directionalShadowMap.length,numPointLightShadows:r.pointShadowMap.length,numSpotLightShadows:r.spotShadowMap.length,numClippingPlanes:v,numClipIntersection:y,dithering:i.dithering,shadowMapEnabled:t.shadowMap.enabled&&p.length>0,shadowMapType:t.shadowMap.type,toneMapping:i.toneMapped?t.toneMapping:Q,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:i.side===m,flipSided:i.side===f,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:o||null!==e.get("EXT_frag_depth"),rendererExtensionDrawBuffers:o||null!==e.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:o||null!==e.get("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);if(void 0===e.isRawShaderMaterial){for(let t=0;t<p.length;t++)n.push(e[p[t]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},acquireProgram:function(e,n){let o;for(let t=0,i=r.length;t<i;t++){const e=r[t];if(e.cacheKey===n){++(o=e).usedTimes;break}}return void 0===o&&(o=new Vl(t,n,e,i),r.push(o)),o},releaseProgram:function(t){if(0==--t.usedTimes){const e=r.indexOf(t);r[e]=r[r.length-1],r.pop(),t.destroy()}},programs:r}}function Wl(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function ql(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Xl(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Yl(){const t=[];let e=0;const n=[],i=[],r={id:-1};function o(n,i,o,s,a,c){let l=t[e];return void 0===l?(l={id:n.id,object:n,geometry:i,material:o,program:o.program||r,groupOrder:s,renderOrder:n.renderOrder,z:a,group:c},t[e]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=o,l.program=o.program||r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=a,l.group=c),e++,l}return{opaque:n,transparent:i,init:function(){e=0,n.length=0,i.length=0},push:function(t,e,r,s,a,c){const l=o(t,e,r,s,a,c);(!0===r.transparent?i:n).push(l)},unshift:function(t,e,r,s,a,c){const l=o(t,e,r,s,a,c);(!0===r.transparent?i:n).unshift(l)},finish:function(){for(let n=e,i=t.length;n<i;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.program=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||ql),i.length>1&&i.sort(e||Xl)}}}function Zl(){let t=new WeakMap;function e(n){const i=n.target;i.removeEventListener("dispose",e),t.delete(i)}return{get:function(n,i){const r=t.get(n);let o;return void 0===r?(o=new Yl,t.set(n,new WeakMap),t.get(n).set(i,o),n.addEventListener("dispose",e)):void 0===(o=r.get(i))&&(o=new Yl,r.set(i,o)),o},dispose:function(){t=new WeakMap}}}function Jl(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Yn,color:new ur};break;case"SpotLight":n={position:new Yn,direction:new Yn,color:new ur,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Yn,color:new ur,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Yn,skyColor:new ur,groundColor:new ur};break;case"RectAreaLight":n={color:new ur,position:new Yn,halfWidth:new Yn,halfHeight:new Yn}}return t[e.id]=n,n}}}function Ql(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Bn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Bn,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}let Kl=0;function $l(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function th(){const t=new Jl,e=Ql(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let s=0;s<9;s++)n.probe.push(new Yn);const i=new Yn,r=new ni,o=new ni;return{setup:function(s,a,c){let l=0,h=0,u=0;for(let t=0;t<9;t++)n.probe[t].set(0,0,0);let p=0,d=0,f=0,m=0,g=0,v=0,y=0,x=0;const _=c.matrixWorldInverse;s.sort($l);for(let w=0,M=s.length;w<M;w++){const a=s[w],c=a.color,b=a.intensity,M=a.distance,S=a.shadow&&a.shadow.map?a.shadow.map.texture:null;if(a.isAmbientLight)l+=c.r*b,h+=c.g*b,u+=c.b*b;else if(a.isLightProbe)for(let t=0;t<9;t++)n.probe[t].addScaledVector(a.sh.coefficients[t],b);else if(a.isDirectionalLight){const r=t.get(a);if(r.color.copy(a.color).multiplyScalar(a.intensity),r.direction.setFromMatrixPosition(a.matrixWorld),i.setFromMatrixPosition(a.target.matrixWorld),r.direction.sub(i),r.direction.transformDirection(_),a.castShadow){const t=a.shadow,i=e.get(a);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,n.directionalShadow[p]=i,n.directionalShadowMap[p]=S,n.directionalShadowMatrix[p]=a.shadow.matrix,v++}n.directional[p]=r,p++}else if(a.isSpotLight){const r=t.get(a);if(r.position.setFromMatrixPosition(a.matrixWorld),r.position.applyMatrix4(_),r.color.copy(c).multiplyScalar(b),r.distance=M,r.direction.setFromMatrixPosition(a.matrixWorld),i.setFromMatrixPosition(a.target.matrixWorld),r.direction.sub(i),r.direction.transformDirection(_),r.coneCos=Math.cos(a.angle),r.penumbraCos=Math.cos(a.angle*(1-a.penumbra)),r.decay=a.decay,a.castShadow){const t=a.shadow,i=e.get(a);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,n.spotShadow[f]=i,n.spotShadowMap[f]=S,n.spotShadowMatrix[f]=a.shadow.matrix,x++}n.spot[f]=r,f++}else if(a.isRectAreaLight){const e=t.get(a);e.color.copy(c).multiplyScalar(b),e.position.setFromMatrixPosition(a.matrixWorld),e.position.applyMatrix4(_),o.identity(),r.copy(a.matrixWorld),r.premultiply(_),o.extractRotation(r),e.halfWidth.set(.5*a.width,0,0),e.halfHeight.set(0,.5*a.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),n.rectArea[m]=e,m++}else if(a.isPointLight){const i=t.get(a);if(i.position.setFromMatrixPosition(a.matrixWorld),i.position.applyMatrix4(_),i.color.copy(a.color).multiplyScalar(a.intensity),i.distance=a.distance,i.decay=a.decay,a.castShadow){const t=a.shadow,i=e.get(a);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,n.pointShadow[d]=i,n.pointShadowMap[d]=S,n.pointShadowMatrix[d]=a.shadow.matrix,y++}n.point[d]=i,d++}else if(a.isHemisphereLight){const e=t.get(a);e.direction.setFromMatrixPosition(a.matrixWorld),e.direction.transformDirection(_),e.direction.normalize(),e.skyColor.copy(a.color).multiplyScalar(b),e.groundColor.copy(a.groundColor).multiplyScalar(b),n.hemi[g]=e,g++}}n.ambient[0]=l,n.ambient[1]=h,n.ambient[2]=u;const b=n.hash;b.directionalLength===p&&b.pointLength===d&&b.spotLength===f&&b.rectAreaLength===m&&b.hemiLength===g&&b.numDirectionalShadows===v&&b.numPointShadows===y&&b.numSpotShadows===x||(n.directional.length=p,n.spot.length=f,n.rectArea.length=m,n.point.length=d,n.hemi.length=g,n.directionalShadow.length=v,n.directionalShadowMap.length=v,n.pointShadow.length=y,n.pointShadowMap.length=y,n.spotShadow.length=x,n.spotShadowMap.length=x,n.directionalShadowMatrix.length=v,n.pointShadowMatrix.length=y,n.spotShadowMatrix.length=x,b.directionalLength=p,b.pointLength=d,b.spotLength=f,b.rectAreaLength=m,b.hemiLength=g,b.numDirectionalShadows=v,b.numPointShadows=y,b.numSpotShadows=x,n.version=Kl++)},state:n}}function eh(){const t=new th,e=[],n=[];return{init:function(){e.length=0,n.length=0},state:{lightsArray:e,shadowsArray:n,lights:t},setupLights:function(i){t.setup(e,n,i)},pushLight:function(t){e.push(t)},pushShadow:function(t){n.push(t)}}}function nh(){let t=new WeakMap;function e(n){const i=n.target;i.removeEventListener("dispose",e),t.delete(i)}return{get:function(n,i){let r;return!1===t.has(n)?(r=new eh,t.set(n,new WeakMap),t.get(n).set(i,r),n.addEventListener("dispose",e)):!1===t.get(n).has(i)?(r=new eh,t.get(n).set(i,r)):r=t.get(n).get(i),r},dispose:function(){t=new WeakMap}}}function ih(t){vr.call(this),this.type="MeshDepthMaterial",this.depthPacking=rn,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function rh(t){vr.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Yn,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}ih.prototype=Object.create(vr.prototype),ih.prototype.constructor=ih,ih.prototype.isMeshDepthMaterial=!0,ih.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},rh.prototype=Object.create(vr.prototype),rh.prototype.constructor=rh,rh.prototype.isMeshDistanceMaterial=!0,rh.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};var oh="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",sh="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function ah(t,e,n){let i=new Co;const r=new Bn,o=new Bn,s=new kn,a=[],c=[],l={},u={0:f,1:d,2:m},g=new _o({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Bn},radius:{value:4}},vertexShader:sh,fragmentShader:oh}),v=g.clone();v.defines.HORIZONAL_PASS=1;const x=new zr;x.setAttribute("position",new br(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new ro(x,g),b=this;function w(n,i){const r=e.update(_);g.uniforms.shadow_pass.value=n.map.texture,g.uniforms.resolution.value=n.mapSize,g.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,r,g,_,null),v.uniforms.shadow_pass.value=n.mapPass.texture,v.uniforms.resolution.value=n.mapSize,v.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,r,v,_,null)}function M(t,e,n){const i=t<<0|e<<1|n<<2;let r=a[i];return void 0===r&&(r=new ih({depthPacking:on,morphTargets:t,skinning:e}),a[i]=r),r}function S(t,e,n){const i=t<<0|e<<1|n<<2;let r=c[i];return void 0===r&&(r=new rh({morphTargets:t,skinning:e}),c[i]=r),r}function T(e,n,i,r,o,s,a){let c=null,h=M,d=e.customDepthMaterial;if(!0===r.isPointLight&&(h=S,d=e.customDistanceMaterial),void 0===d){let t=!1;!0===i.morphTargets&&(t=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let r=!1;!0===e.isSkinnedMesh&&(!0===i.skinning?r=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e)),c=h(t,r,!0===e.isInstancedMesh)}else c=d;if(t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){const t=c.uuid,e=i.uuid;let n=l[t];void 0===n&&(n={},l[t]=n);let r=n[e];void 0===r&&(r=c.clone(),n[e]=r),c=r}return c.visible=i.visible,c.wireframe=i.wireframe,c.side=a===p?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:u[i.side],c.clipShadows=i.clipShadows,c.clippingPlanes=i.clippingPlanes,c.clipIntersection=i.clipIntersection,c.wireframeLinewidth=i.wireframeLinewidth,c.linewidth=i.linewidth,!0===r.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(r.matrixWorld),c.nearDistance=o,c.farDistance=s),c}function E(n,r,o,s,a){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===p)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const i=e.update(n),r=n.material;if(Array.isArray(r)){const e=i.groups;for(let c=0,l=e.length;c<l;c++){const l=e[c],h=r[l.materialIndex];if(h&&h.visible){const e=T(n,i,h,s,o.near,o.far,a);t.renderBufferDirect(o,null,i,e,n,l)}}}else if(r.visible){const e=T(n,i,r,s,o.near,o.far,a);t.renderBufferDirect(o,null,i,e,n,null)}}const c=n.children;for(let t=0,e=c.length;t<e;t++)E(c[t],r,o,s,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=h,this.render=function(e,a,c){if(!1===b.enabled)return;if(!1===b.autoUpdate&&!1===b.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),h=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(y),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let f=0,m=e.length;f<m;f++){const l=e[f],h=l.shadow;if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;if(void 0===h){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}r.copy(h.mapSize);const u=h.getFrameExtents();if(r.multiply(u),o.copy(h.mapSize),(r.x>n||r.y>n)&&(r.x>n&&(o.x=Math.floor(n/u.x),r.x=o.x*u.x,h.mapSize.x=o.x),r.y>n&&(o.y=Math.floor(n/u.y),r.y=o.y*u.y,h.mapSize.y=o.y)),null===h.map&&!h.isPointLightShadow&&this.type===p){const t={minFilter:yt,magFilter:yt,format:Ft};h.map=new Vn(r.x,r.y,t),h.map.texture.name=l.name+".shadowMap",h.mapPass=new Vn(r.x,r.y,t),h.camera.updateProjectionMatrix()}if(null===h.map){const t={minFilter:dt,magFilter:dt,format:Ft};h.map=new Vn(r.x,r.y,t),h.map.texture.name=l.name+".shadowMap",h.camera.updateProjectionMatrix()}t.setRenderTarget(h.map),t.clear();const m=h.getViewportCount();for(let t=0;t<m;t++){const e=h.getViewport(t);s.set(o.x*e.x,o.y*e.y,o.x*e.z,o.y*e.w),d.viewport(s),h.updateMatrices(l,t),i=h.getFrustum(),E(a,c,h.camera,l,this.type)}h.isPointLightShadow||this.type!==p||w(h,c),h.needsUpdate=!1}b.needsUpdate=!1,t.setRenderTarget(l,h,u)}}function ch(t,e,n){const s=n.isWebGL2;const a=new function(){let e=!1;const n=new kn;let i=null;const r=new kn(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,o,s,a){!0===a&&(e*=s,i*=s,o*=s),n.set(e,i,o,s),!1===r.equals(n)&&(t.clearColor(e,i,o,s),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},c=new function(){let e=!1,n=null,i=null,r=null;return{setTest:function(t){t?ft(2929):mt(2929)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){if(e)switch(e){case z:t.depthFunc(512);break;case H:t.depthFunc(519);break;case k:t.depthFunc(513);break;case V:t.depthFunc(515);break;case j:t.depthFunc(514);break;case W:t.depthFunc(518);break;case q:t.depthFunc(516);break;case X:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}},l=new function(){let e=!1,n=null,i=null,r=null,o=null,s=null,a=null,c=null,l=null;return{setTest:function(t){e||(t?ft(2960):mt(2960))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,s){i===e&&r===n&&o===s||(t.stencilFunc(e,n,s),i=e,r=n,o=s)},setOp:function(e,n,i){s===e&&a===n&&c===i||(t.stencilOp(e,n,i),s=e,a=n,c=i)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,n=null,i=null,r=null,o=null,s=null,a=null,c=null,l=null}}};let h={},u=null,p=null,d=null,g=null,v=null,Y=null,Z=null,J=null,Q=null,K=!1,$=null,tt=null,et=null,nt=null,it=null;const rt=t.getParameter(35661);let ot=!1,st=0;const at=t.getParameter(7938);-1!==at.indexOf("WebGL")?(st=parseFloat(/^WebGL\ ([0-9])/.exec(at)[1]),ot=st>=1):-1!==at.indexOf("OpenGL ES")&&(st=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(at)[1]),ot=st>=2);let ct=null,lt={};const ht=new kn,ut=new kn;function pt(e,n,i){const r=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let s=0;s<i;s++)t.texImage2D(n+s,0,6408,1,1,0,6408,5121,r);return o}const dt={};function ft(e){!0!==h[e]&&(t.enable(e),h[e]=!0)}function mt(e){!1!==h[e]&&(t.disable(e),h[e]=!1)}dt[3553]=pt(3553,3553,1),dt[34067]=pt(34067,34069,6),a.setClear(0,0,0,1),c.setClear(1),l.setClear(0),ft(2929),c.setFunc(V),xt(!1),_t(r),ft(2884),yt(y);const gt={[S]:32774,[T]:32778,[E]:32779};if(s)gt[A]=32775,gt[L]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(gt[A]=t.MIN_EXT,gt[L]=t.MAX_EXT)}const vt={[R]:0,[C]:1,[P]:768,[D]:770,[U]:776,[F]:774,[I]:772,[O]:769,[N]:771,[G]:775,[B]:773};function yt(e,n,i,r,o,s,a,c){if(e!==y){if(p||(ft(3042),p=!0),e===M)o=o||n,s=s||i,a=a||r,n===g&&o===Z||(t.blendEquationSeparate(gt[n],gt[o]),g=n,Z=o),i===v&&r===Y&&s===J&&a===Q||(t.blendFuncSeparate(vt[i],vt[r],vt[s],vt[a]),v=i,Y=r,J=s,Q=a),d=e,K=null;else if(e!==d||c!==K){if(g===S&&Z===S||(t.blendEquation(32774),g=S,Z=S),c)switch(e){case x:t.blendFuncSeparate(1,771,1,771);break;case _:t.blendFunc(1,1);break;case b:t.blendFuncSeparate(0,0,769,771);break;case w:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case x:t.blendFuncSeparate(770,771,1,771);break;case _:t.blendFunc(770,1);break;case b:t.blendFunc(0,769);break;case w:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}v=null,Y=null,J=null,Q=null,d=e,K=c}}else p&&(mt(3042),p=!1)}function xt(e){$!==e&&(e?t.frontFace(2304):t.frontFace(2305),$=e)}function _t(e){e!==i?(ft(2884),e!==tt&&(e===r?t.cullFace(1029):e===o?t.cullFace(1028):t.cullFace(1032))):mt(2884),tt=e}function bt(e,n,i){e?(ft(32823),nt===n&&it===i||(t.polygonOffset(n,i),nt=n,it=i)):mt(32823)}function wt(e){void 0===e&&(e=33984+rt-1),ct!==e&&(t.activeTexture(e),ct=e)}return{buffers:{color:a,depth:c,stencil:l},enable:ft,disable:mt,useProgram:function(e){return u!==e&&(t.useProgram(e),u=e,!0)},setBlending:yt,setMaterial:function(t,e){t.side===m?mt(2884):ft(2884);let n=t.side===f;e&&(n=!n),xt(n),t.blending===x&&!1===t.transparent?yt(y):yt(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),c.setFunc(t.depthFunc),c.setTest(t.depthTest),c.setMask(t.depthWrite),a.setMask(t.colorWrite);const i=t.stencilWrite;l.setTest(i),i&&(l.setMask(t.stencilWriteMask),l.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),l.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),bt(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:xt,setCullFace:_t,setLineWidth:function(e){e!==et&&(ot&&t.lineWidth(e),et=e)},setPolygonOffset:bt,setScissorTest:function(t){t?ft(3089):mt(3089)},activeTexture:wt,bindTexture:function(e,n){null===ct&&wt();let i=lt[ct];void 0===i&&(i={type:void 0,texture:void 0},lt[ct]=i),i.type===e&&i.texture===n||(t.bindTexture(e,n||dt[e]),i.type=e,i.texture=n)},unbindTexture:function(){const e=lt[ct];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===ht.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),ht.copy(e))},viewport:function(e){!1===ut.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),ut.copy(e))},reset:function(){h={},ct=null,lt={},u=null,d=null,$=null,tt=null,a.reset(),c.reset(),l.reset()}}}function lh(t,e,n,i,r,o,s){const a=r.isWebGL2,c=r.maxTextures,l=r.maxCubemapSize,h=r.maxTextureSize,u=r.maxSamples,p=new WeakMap;let d,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(U){}function m(t,e){return f?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(t,e,n,i){let r=1;if((t.width>i||t.height>i)&&(r=i/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const i=e?In.floorPowerOfTwo:Math.floor,o=i(r*t.width),s=i(r*t.height);void 0===d&&(d=m(o,s));const a=n?m(o,s):d;return a.width=o,a.height=s,a.getContext("2d").drawImage(t,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+o+"x"+s+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function v(t){return In.isPowerOfTwo(t.width)&&In.isPowerOfTwo(t.height)}function y(t,e){return t.generateMipmaps&&e&&t.minFilter!==dt&&t.minFilter!==yt}function x(e,n,r,o){t.generateMipmap(e),i.get(n).__maxMipLevel=Math.log(Math.max(r,o))*Math.LOG2E}function _(n,i,r){if(!1===a)return i;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=i;return 6403===i&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),6407===i&&(5126===r&&(o=34837),5131===r&&(o=34843),5121===r&&(o=32849)),6408===i&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||e.get("EXT_color_buffer_float"),o}function b(t){return t===dt||t===ft||t===gt?9728:9729}function w(e){const n=e.target;n.removeEventListener("dispose",w),function(e){const n=i.get(e);if(void 0===n.__webglInit)return;t.deleteTexture(n.__webglTexture),i.remove(e)}(n),n.isVideoTexture&&p.delete(n),s.memory.textures--}function M(e){const n=e.target;n.removeEventListener("dispose",M),function(e){const n=i.get(e),r=i.get(e.texture);if(!e)return;void 0!==r.__webglTexture&&t.deleteTexture(r.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let i=0;i<6;i++)t.deleteFramebuffer(n.__webglFramebuffer[i]),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[i]);else t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&t.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer);i.remove(e.texture),i.remove(e)}(n),s.memory.textures--}let S=0;function T(t,e){const r=i.get(t);if(t.isVideoTexture&&function(t){const e=s.render.frame;p.get(t)!==e&&(p.set(t,e),t.update())}(t),t.version>0&&r.__version!==t.version){const n=t.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void O(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,r.__webglTexture)}function E(e,r){if(6!==e.image.length)return;const s=i.get(e);if(e.version>0&&s.__version!==e.version){P(s,e),n.activeTexture(33984+r),n.bindTexture(34067,s.__webglTexture),t.pixelStorei(37440,e.flipY);const i=e&&(e.isCompressedTexture||e.image[0].isCompressedTexture),c=e.image[0]&&e.image[0].isDataTexture,h=[];for(let t=0;t<6;t++)h[t]=i||c?c?e.image[t].image:e.image[t]:g(e.image[t],!1,!0,l);const u=h[0],p=v(u)||a,d=o.convert(e.format),f=o.convert(e.type),m=_(e.internalFormat,d,f);let b;if(C(34067,e,p),i){for(let t=0;t<6;t++){b=h[t].mipmaps;for(let i=0;i<b.length;i++){const r=b[i];e.format!==Ft&&e.format!==Bt?null!==d?n.compressedTexImage2D(34069+t,i,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+t,i,m,r.width,r.height,0,d,f,r.data)}}s.__maxMipLevel=b.length-1}else{b=e.mipmaps;for(let t=0;t<6;t++)if(c){n.texImage2D(34069+t,0,m,h[t].width,h[t].height,0,d,f,h[t].data);for(let e=0;e<b.length;e++){const i=b[e].image[t].image;n.texImage2D(34069+t,e+1,m,i.width,i.height,0,d,f,i.data)}}else{n.texImage2D(34069+t,0,m,d,f,h[t]);for(let e=0;e<b.length;e++){const i=b[e];n.texImage2D(34069+t,e+1,m,d,f,i.image[t])}}s.__maxMipLevel=b.length}y(e,p)&&x(34067,e,u.width,u.height),s.__version=e.version,e.onUpdate&&e.onUpdate(e)}else n.activeTexture(33984+r),n.bindTexture(34067,s.__webglTexture)}function A(t,e){n.activeTexture(33984+e),n.bindTexture(34067,i.get(t).__webglTexture)}const L={[ht]:10497,[ut]:33071,[pt]:33648},R={[dt]:9728,[ft]:9984,[gt]:9986,[yt]:9729,[xt]:9985,[bt]:9987};function C(n,o,s){s?(t.texParameteri(n,10242,L[o.wrapS]),t.texParameteri(n,10243,L[o.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,L[o.wrapR]),t.texParameteri(n,10240,R[o.magFilter]),t.texParameteri(n,10241,R[o.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),o.wrapS===ut&&o.wrapT===ut||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,b(o.magFilter)),t.texParameteri(n,10241,b(o.minFilter)),o.minFilter!==dt&&o.minFilter!==yt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const c=e.get("EXT_texture_filter_anisotropic");if(c){if(o.type===Rt&&null===e.get("OES_texture_float_linear"))return;if(o.type===Ct&&null===(a||e.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(t.texParameterf(n,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function P(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",w),e.__webglTexture=t.createTexture(),s.memory.textures++)}function O(e,i,r){let s=3553;i.isDataTexture2DArray&&(s=35866),i.isDataTexture3D&&(s=32879),P(e,i),n.activeTexture(33984+r),n.bindTexture(s,e.__webglTexture),t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment);const c=function(t){return!a&&(t.wrapS!==ut||t.wrapT!==ut||t.minFilter!==dt&&t.minFilter!==yt)}(i)&&!1===v(i.image),l=g(i.image,c,!1,h),u=v(l)||a,p=o.convert(i.format);let d,f=o.convert(i.type),m=_(i.internalFormat,p,f);C(s,i,u);const b=i.mipmaps;if(i.isDepthTexture)m=6402,a?m=i.type===Rt?36012:i.type===Lt?33190:i.type===Nt?35056:33189:i.type===Rt&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===Ht&&6402===m&&i.type!==Et&&i.type!==Lt&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=Et,f=o.convert(i.type)),i.format===kt&&6402===m&&(m=34041,i.type!==Nt&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=Nt,f=o.convert(i.type))),n.texImage2D(3553,0,m,l.width,l.height,0,p,f,null);else if(i.isDataTexture)if(b.length>0&&u){for(let t=0,e=b.length;t<e;t++)d=b[t],n.texImage2D(3553,t,m,d.width,d.height,0,p,f,d.data);i.generateMipmaps=!1,e.__maxMipLevel=b.length-1}else n.texImage2D(3553,0,m,l.width,l.height,0,p,f,l.data),e.__maxMipLevel=0;else if(i.isCompressedTexture){for(let t=0,e=b.length;t<e;t++)d=b[t],i.format!==Ft&&i.format!==Bt?null!==p?n.compressedTexImage2D(3553,t,m,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,t,m,d.width,d.height,0,p,f,d.data);e.__maxMipLevel=b.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,m,l.width,l.height,l.depth,0,p,f,l.data),e.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,m,l.width,l.height,l.depth,0,p,f,l.data),e.__maxMipLevel=0;else if(b.length>0&&u){for(let t=0,e=b.length;t<e;t++)d=b[t],n.texImage2D(3553,t,m,p,f,d);i.generateMipmaps=!1,e.__maxMipLevel=b.length-1}else n.texImage2D(3553,0,m,p,f,l),e.__maxMipLevel=0;y(i,u)&&x(s,i,l.width,l.height),e.__version=i.version,i.onUpdate&&i.onUpdate(i)}function D(e,r,s,a){const c=o.convert(r.texture.format),l=o.convert(r.texture.type),h=_(r.texture.internalFormat,c,l);n.texImage2D(a,0,h,r.width,r.height,0,c,l,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,s,a,i.get(r.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function N(e,n,i){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===Rt?r=36012:e.type===Lt&&(r=33190));const i=B(n);t.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else t.renderbufferStorage(36161,r,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){if(i){const e=B(n);t.renderbufferStorageMultisample(36161,e,35056,n.width,n.height)}else t.renderbufferStorage(36161,34041,n.width,n.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=o.convert(n.texture.format),r=o.convert(n.texture.type),s=_(n.texture.internalFormat,e,r);if(i){const e=B(n);t.renderbufferStorageMultisample(36161,e,s,n.width,n.height)}else t.renderbufferStorage(36161,s,n.width,n.height)}t.bindRenderbuffer(36161,null)}function I(e){const n=i.get(e),r=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),T(n.depthTexture,0);const r=i.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===Ht)t.framebufferTexture2D(36160,36096,3553,r,0);else{if(n.depthTexture.format!==kt)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,r,0)}}(n.__webglFramebuffer,e)}else if(r){n.__webglDepthbuffer=[];for(let i=0;i<6;i++)t.bindFramebuffer(36160,n.__webglFramebuffer[i]),n.__webglDepthbuffer[i]=t.createRenderbuffer(),N(n.__webglDepthbuffer[i],e,!1)}else t.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=t.createRenderbuffer(),N(n.__webglDepthbuffer,e,!1);t.bindFramebuffer(36160,null)}function B(t){return a&&t.isWebGLMultisampleRenderTarget?Math.min(u,t.samples):0}let F=!1,G=!1;this.allocateTextureUnit=function(){const t=S;return t>=c&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+c),S+=1,t},this.resetTextureUnits=function(){S=0},this.setTexture2D=T,this.setTexture2DArray=function(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?O(r,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?O(r,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=E,this.setTextureCubeDynamic=A,this.setupRenderTarget=function(e){const r=i.get(e),c=i.get(e.texture);e.addEventListener("dispose",M),c.__webglTexture=t.createTexture(),s.memory.textures++;const l=!0===e.isWebGLCubeRenderTarget,h=!0===e.isWebGLMultisampleRenderTarget,u=v(e)||a;if(!a||e.texture.format!==Bt||e.texture.type!==Rt&&e.texture.type!==Ct||(e.texture.format=Ft,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),l){r.__webglFramebuffer=[];for(let e=0;e<6;e++)r.__webglFramebuffer[e]=t.createFramebuffer()}else if(r.__webglFramebuffer=t.createFramebuffer(),h)if(a){r.__webglMultisampledFramebuffer=t.createFramebuffer(),r.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,r.__webglColorRenderbuffer);const n=o.convert(e.texture.format),i=o.convert(e.texture.type),s=_(e.texture.internalFormat,n,i),a=B(e);t.renderbufferStorageMultisample(36161,a,s,e.width,e.height),t.bindFramebuffer(36160,r.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,r.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(r.__webglDepthRenderbuffer=t.createRenderbuffer(),N(r.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){n.bindTexture(34067,c.__webglTexture),C(34067,e.texture,u);for(let t=0;t<6;t++)D(r.__webglFramebuffer[t],e,36064,34069+t);y(e.texture,u)&&x(34067,e.texture,e.width,e.height),n.bindTexture(34067,null)}else n.bindTexture(3553,c.__webglTexture),C(3553,e.texture,u),D(r.__webglFramebuffer,e,36064,3553),y(e.texture,u)&&x(3553,e.texture,e.width,e.height),n.bindTexture(3553,null);e.depthBuffer&&I(e)},this.updateRenderTargetMipmap=function(t){const e=t.texture;if(y(e,v(t)||a)){const r=t.isWebGLCubeRenderTarget?34067:3553,o=i.get(e).__webglTexture;n.bindTexture(r,o),x(r,e,t.width,t.height),n.bindTexture(r,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(a){const n=i.get(e);t.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,n.__webglFramebuffer);const r=e.width,o=e.height;let s=16384;e.depthBuffer&&(s|=256),e.stencilBuffer&&(s|=1024),t.blitFramebuffer(0,0,r,o,0,0,r,o,s,9728),t.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),F=!0),t=t.texture),T(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===G&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),G=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?E(t,e):A(t,e)}}function hh(t,e,n){const i=n.isWebGL2;return{convert:function(t){let n;if(t===Mt)return 5121;if(t===Pt)return 32819;if(t===Ot)return 32820;if(t===Dt)return 33635;if(t===St)return 5120;if(t===Tt)return 5122;if(t===Et)return 5123;if(t===At)return 5124;if(t===Lt)return 5125;if(t===Rt)return 5126;if(t===Ct)return i?5131:null!==(n=e.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(t===It)return 6406;if(t===Bt)return 6407;if(t===Ft)return 6408;if(t===Gt)return 6409;if(t===Ut)return 6410;if(t===Ht)return 6402;if(t===kt)return 34041;if(t===Vt)return 6403;if(t===jt)return 36244;if(t===Wt)return 33319;if(t===qt)return 33320;if(t===Xt)return 36248;if(t===Yt)return 36249;if(t===Zt||t===Jt||t===Qt||t===Kt){if(null===(n=e.get("WEBGL_compressed_texture_s3tc")))return null;if(t===Zt)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Jt)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Qt)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Kt)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===$t||t===te||t===ee||t===ne){if(null===(n=e.get("WEBGL_compressed_texture_pvrtc")))return null;if(t===$t)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===te)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===ee)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===ne)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===ie)return null!==(n=e.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===re||t===oe)&&null!==(n=e.get("WEBGL_compressed_texture_etc"))){if(t===re)return n.COMPRESSED_RGB8_ETC2;if(t===oe)return n.COMPRESSED_RGBA8_ETC2_EAC}return t===se||t===ae||t===ce||t===le||t===he||t===ue||t===pe||t===de||t===fe||t===me||t===ge||t===ve||t===ye||t===xe||t===be||t===we||t===Me||t===Se||t===Te||t===Ee||t===Ae||t===Le||t===Re||t===Ce||t===Pe||t===Oe||t===De||t===Ne?null!==(n=e.get("WEBGL_compressed_texture_astc"))?t:null:t===_e?null!==(n=e.get("EXT_texture_compression_bptc"))?t:null:t===Nt?i?34042:null!==(n=e.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function uh(t){wo.call(this),this.cameras=t||[]}function ph(){_i.call(this),this.type="Group"}function dh(){this._targetRay=null,this._grip=null}function fh(t,e){const n=this;let i=null,r=1,o=null,s="local-floor",a=null;const c=[],l=new Map,h=new wo;h.layers.enable(1),h.viewport=new kn;const u=new wo;u.layers.enable(2),u.viewport=new kn;const p=[h,u],d=new uh;d.layers.enable(1),d.layers.enable(2);let f=null,m=null;function g(t){const e=l.get(t.inputSource);e&&e.dispatchEvent({type:t.type})}function v(){l.forEach(function(t,e){t.disconnect(e)}),l.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),S.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function y(t){o=t,S.setContext(i),S.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function x(t){const e=i.inputSources;for(let n=0;n<c.length;n++)l.set(e[n],c[n]);for(let n=0;n<t.removed.length;n++){const e=t.removed[n],i=l.get(e);i&&(i.dispatchEvent({type:"disconnected",data:e}),l.delete(e))}for(let n=0;n<t.added.length;n++){const e=t.added[n],i=l.get(e);i&&i.dispatchEvent({type:"connected",data:e})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=c[t];return void 0===e&&(e=new dh,c[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=c[t];return void 0===e&&(e=new dh,c[t]=e),e.getGripSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){s=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return i},this.setSession=function(t){if(null!==(i=t)){i.addEventListener("select",g),i.addEventListener("selectstart",g),i.addEventListener("selectend",g),i.addEventListener("squeeze",g),i.addEventListener("squeezestart",g),i.addEventListener("squeezeend",g),i.addEventListener("end",v);const t=e.getContextAttributes();!0!==t.xrCompatible&&e.makeXRCompatible();const n={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:r},o=new XRWebGLLayer(i,e,n);i.updateRenderState({baseLayer:o}),i.requestReferenceSpace(s).then(y),i.addEventListener("inputsourceschange",x)}};const _=new Yn,b=new Yn;function w(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}this.getCamera=function(t){d.near=u.near=h.near=t.near,d.far=u.far=h.far=t.far,f===d.near&&m===d.far||(i.updateRenderState({depthNear:d.near,depthFar:d.far}),f=d.near,m=d.far);const e=t.parent,n=d.cameras;w(d,e);for(let i=0;i<n.length;i++)w(n[i],e);t.matrixWorld.copy(d.matrixWorld);const r=t.children;for(let i=0,o=r.length;i<o;i++)r[i].updateMatrixWorld(!0);return 2===n.length?function(t,e,n){_.setFromMatrixPosition(e.matrixWorld),b.setFromMatrixPosition(n.matrixWorld);const i=_.distanceTo(b),r=e.projectionMatrix.elements,o=n.projectionMatrix.elements,s=r[14]/(r[10]-1),a=r[14]/(r[10]+1),c=(r[9]+1)/r[5],l=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(o[8]+1)/o[0],p=s*h,d=s*u,f=i/(-h+u),m=f*-h;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);const g=s+f,v=a+f,y=p-m,x=d+(i-m),w=c*a/v*g,M=l*a/v*g;t.projectionMatrix.makePerspective(y,x,w,M,g,v)}(d,h,u):d.projectionMatrix.copy(h.projectionMatrix),d};let M=null;const S=new Oo;S.setAnimationLoop(function(e,n){if(null!==(a=n.getViewerPose(o))){const e=a.views,n=i.renderState.baseLayer;t.setFramebuffer(n.framebuffer);let r=!1;e.length!==d.cameras.length&&(d.cameras.length=0,r=!0);for(let t=0;t<e.length;t++){const i=e[t],o=n.getViewport(i),s=p[t];s.matrix.fromArray(i.transform.matrix),s.projectionMatrix.fromArray(i.projectionMatrix),s.viewport.set(o.x,o.y,o.width,o.height),0===t&&d.matrix.copy(s.matrix),!0===r&&d.cameras.push(s)}}const r=i.inputSources;for(let t=0;t<c.length;t++){const e=c[t],i=r[t];e.update(i,n,o)}M&&M(e,n)}),this.setAnimationLoop=function(t){M=t},this.dispose=function(){}}function mh(t){function e(e,n,i){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap);const r=n.envMap||i;let o,s;r&&(e.envMap.value=r,e.flipEnvMap.value=r.isCubeTexture?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio,e.maxMipLevel.value=t.get(r).__maxMipLevel),n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?o=n.map:n.specularMap?o=n.specularMap:n.displacementMap?o=n.displacementMap:n.normalMap?o=n.normalMap:n.bumpMap?o=n.bumpMap:n.roughnessMap?o=n.roughnessMap:n.metalnessMap?o=n.metalnessMap:n.alphaMap?o=n.alphaMap:n.emissiveMap&&(o=n.emissiveMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),e.uvTransform.value.copy(o.matrix)),n.aoMap?s=n.aoMap:n.lightMap&&(s=n.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uv2Transform.value.copy(s.matrix))}function n(t,e,n){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===f&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===f&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),(e.envMap||n)&&(t.envMapIntensity.value=e.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,i,r,o,s){i.isMeshBasicMaterial?e(t,i):i.isMeshLambertMaterial?(e(t,i),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,i)):i.isMeshToonMaterial?(e(t,i),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===f&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===f&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshPhongMaterial?(e(t,i),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===f&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===f&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshStandardMaterial?(e(t,i,r),i.isMeshPhysicalMaterial?function(t,e,i){n(t,e,i),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen),e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===f&&t.clearcoatNormalScale.value.negate()),t.transparency.value=e.transparency}(t,i,r):n(t,i,r)):i.isMeshMatcapMaterial?(e(t,i),function(t,e){e.matcap&&(t.matcap.value=e.matcap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===f&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===f&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshDepthMaterial?(e(t,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshDistanceMaterial?(e(t,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,i)):i.isMeshNormalMaterial?(e(t,i),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===f&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===f&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,i),i.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,i)):i.isPointsMaterial?function(t,e,n,i){let r;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*i,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?r=e.map:e.alphaMap&&(r=e.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,i,o,s):i.isSpriteMaterial?function(t,e){let n;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?n=e.map:e.alphaMap&&(n=e.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,i):i.isShadowMaterial?(t.color.value.copy(i.color),t.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function gh(t){const e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==t.context?t.context:null,i=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,o=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,c=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",h=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let u=null,p=null;this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Ze,this.physicallyCorrectLights=!1,this.toneMapping=Q,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const d=this;let f=!1,m=null,g=0,v=0,y=null,x=null,_=-1,b=null,w=null;const M=new kn,S=new kn;let T=null,E=e.width,A=e.height,L=1,R=null,C=null;const P=new kn(0,0,E,A),O=new kn(0,0,E,A);let D=!1;const N=new Co,I=new ac;let B=!1,F=!1;const G=new ni,U=new Yn,z={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function H(){return null===y?L:1}let k,V,j,W,q,X,Y,Z,J,K,$,tt,et,nt,it,rt,ot,st,at,ct=n;function lt(t,n){for(let i=0;i<t.length;i++){const r=t[i],o=e.getContext(r,n);if(null!==o)return o}return null}try{const t={alpha:i,depth:r,stencil:o,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:c,powerPreference:l,failIfMajorPerformanceCaveat:h};if(e.addEventListener("webglcontextlost",dt,!1),e.addEventListener("webglcontextrestored",ft,!1),null===ct){const e=["webgl2","webgl","experimental-webgl"];if(!0===d.isWebGL1Renderer&&e.shift(),null===(ct=lt(e,t)))throw lt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ct.getShaderPrecisionFormat&&(ct.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(St){throw console.error("THREE.WebGLRenderer: "+St.message),St}function ht(){k=new cc(ct),!1===(V=new sc(ct,k,t)).isWebGL2&&(k.get("WEBGL_depth_texture"),k.get("OES_texture_float"),k.get("OES_texture_half_float"),k.get("OES_texture_half_float_linear"),k.get("OES_standard_derivatives"),k.get("OES_element_index_uint"),k.get("OES_vertex_array_object"),k.get("ANGLE_instanced_arrays")),k.get("OES_texture_float_linear"),st=new hh(ct,k,V),(j=new ch(ct,k,V)).scissor(S.copy(O).multiplyScalar(L).floor()),j.viewport(M.copy(P).multiplyScalar(L).floor()),W=new uc(ct),q=new Wl,X=new lh(ct,k,j,q,V,st,W),Y=new Do(ct,V),at=new rc(ct,k,Y,V),Z=new lc(ct,Y,W,at),J=new mc(ct,Z,Y,W),it=new fc(ct),K=new jl(d,k,V,at),$=new mh(q),tt=new Zl,et=new nh,nt=new ic(d,j,J,a),rt=new oc(ct,k,W,V),ot=new hc(ct,k,W,V),W.programs=K.programs,d.capabilities=V,d.extensions=k,d.properties=q,d.renderLists=tt,d.state=j,d.info=W}ht();const ut=new fh(d,ct);this.xr=ut;const pt=new ah(d,J,V.maxTextureSize);function dt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),f=!0}function ft(){console.log("THREE.WebGLRenderer: Context Restored."),f=!1,ht()}function mt(t){const e=t.target;e.removeEventListener("dispose",mt),function(t){gt(t),q.remove(t)}(e)}function gt(t){const e=q.get(t).program;t.program=void 0,void 0!==e&&K.releaseProgram(e)}this.shadowMap=pt,this.getContext=function(){return ct},this.getContextAttributes=function(){return ct.getContextAttributes()},this.forceContextLoss=function(){const t=k.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=k.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(t){void 0!==t&&(L=t,this.setSize(E,A,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new Bn),t.set(E,A)},this.setSize=function(t,n,i){ut.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(E=t,A=n,e.width=Math.floor(t*L),e.height=Math.floor(n*L),!1!==i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new Bn),t.set(E*L,A*L).floor()},this.setDrawingBufferSize=function(t,n,i){E=t,A=n,L=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new kn),t.copy(M)},this.getViewport=function(t){return t.copy(P)},this.setViewport=function(t,e,n,i){t.isVector4?P.set(t.x,t.y,t.z,t.w):P.set(t,e,n,i),j.viewport(M.copy(P).multiplyScalar(L).floor())},this.getScissor=function(t){return t.copy(O)},this.setScissor=function(t,e,n,i){t.isVector4?O.set(t.x,t.y,t.z,t.w):O.set(t,e,n,i),j.scissor(S.copy(O).multiplyScalar(L).floor())},this.getScissorTest=function(){return D},this.setScissorTest=function(t){j.setScissorTest(D=t)},this.setOpaqueSort=function(t){R=t},this.setTransparentSort=function(t){C=t},this.getClearColor=function(){return nt.getClearColor()},this.setClearColor=function(){nt.setClearColor.apply(nt,arguments)},this.getClearAlpha=function(){return nt.getClearAlpha()},this.setClearAlpha=function(){nt.setClearAlpha.apply(nt,arguments)},this.clear=function(t,e,n){let i=0;(void 0===t||t)&&(i|=16384),(void 0===e||e)&&(i|=256),(void 0===n||n)&&(i|=1024),ct.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",dt,!1),e.removeEventListener("webglcontextrestored",ft,!1),tt.dispose(),et.dispose(),q.dispose(),J.dispose(),at.dispose(),ut.dispose(),yt.stop()},this.renderBufferImmediate=function(t,e){at.initAttributes();const n=q.get(t);t.hasPositions&&!n.position&&(n.position=ct.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=ct.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=ct.createBuffer()),t.hasColors&&!n.color&&(n.color=ct.createBuffer());const i=e.getAttributes();t.hasPositions&&(ct.bindBuffer(34962,n.position),ct.bufferData(34962,t.positionArray,35048),at.enableAttribute(i.position),ct.vertexAttribPointer(i.position,3,5126,!1,0,0)),t.hasNormals&&(ct.bindBuffer(34962,n.normal),ct.bufferData(34962,t.normalArray,35048),at.enableAttribute(i.normal),ct.vertexAttribPointer(i.normal,3,5126,!1,0,0)),t.hasUvs&&(ct.bindBuffer(34962,n.uv),ct.bufferData(34962,t.uvArray,35048),at.enableAttribute(i.uv),ct.vertexAttribPointer(i.uv,2,5126,!1,0,0)),t.hasColors&&(ct.bindBuffer(34962,n.color),ct.bufferData(34962,t.colorArray,35048),at.enableAttribute(i.color),ct.vertexAttribPointer(i.color,3,5126,!1,0,0)),at.disableUnusedAttributes(),ct.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,i,r,o){null===e&&(e=z);const s=r.isMesh&&r.matrixWorld.determinant()<0,a=wt(t,e,i,r);j.setMaterial(i,s);let c=n.index;const l=n.attributes.position;if(null===c){if(void 0===l||0===l.count)return}else if(0===c.count)return;let h,u=1;!0===i.wireframe&&(c=Z.getWireframeAttribute(n),u=2),(i.morphTargets||i.morphNormals)&&it.update(r,n,i,a),at.setup(r,i,a,n,c);let p=rt;null!==c&&(h=Y.get(c),(p=ot).setIndex(h));const d=null!==c?c.count:l.count,f=n.drawRange.start*u,m=n.drawRange.count*u,g=null!==o?o.start*u:0,v=null!==o?o.count*u:1/0,y=Math.max(f,g),x=Math.min(d,f+m,g+v)-1,_=Math.max(0,x-y+1);if(0!==_){if(r.isMesh)!0===i.wireframe?(j.setLineWidth(i.wireframeLinewidth*H()),p.setMode(1)):p.setMode(4);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),j.setLineWidth(t*H()),r.isLineSegments?p.setMode(1):r.isLineLoop?p.setMode(2):p.setMode(3)}else r.isPoints?p.setMode(0):r.isSprite&&p.setMode(4);if(r.isInstancedMesh)p.renderInstances(n,y,_,r.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);p.renderInstances(n,y,_,t)}else p.render(y,_)}},this.compile=function(t,e){(p=et.get(t,e)).init(),t.traverse(function(t){t.isLight&&(p.pushLight(t),t.castShadow&&p.pushShadow(t))}),p.setupLights(e);const n=new WeakMap;t.traverse(function(e){let i=e.material;if(i)if(Array.isArray(i))for(let r=0;r<i.length;r++){let o=i[r];!1===n.has(o)&&(bt(o,t,e),n.set(o))}else!1===n.has(i)&&(bt(i,t,e),n.set(i))})};let vt=null;const yt=new Oo;function xt(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let r=0,o=t.length;r<o;r++){const o=t[r],s=o.object,a=o.geometry,c=null===i?o.material:i,l=o.group;if(n.isArrayCamera){w=n;const t=n.cameras;for(let n=0,i=t.length;n<i;n++){const i=t[n];s.layers.test(i.layers)&&(j.viewport(M.copy(i.viewport)),p.setupLights(i),_t(s,e,i,a,c,l))}}else w=null,_t(s,e,n,a,c,l)}}function _t(t,e,n,i,r,o){if(t.onBeforeRender(d,e,n,i,r,o),p=et.get(e,w||n),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){const i=wt(n,e,r,t);j.setMaterial(r),at.reset(),function(t,e){t.render(function(t){d.renderBufferImmediate(t,e)})}(t,i)}else d.renderBufferDirect(n,e,i,r,t,o);t.onAfterRender(d,e,n,i,r,o),p=et.get(e,w||n)}function bt(t,e,n){!0!==e.isScene&&(e=z);const i=q.get(t),r=p.state.lights,o=p.state.shadowsArray,s=r.state.version,a=K.getParameters(t,r.state,o,e,I.numPlanes,I.numIntersection,n),c=K.getProgramCacheKey(a);let l=i.program,h=!0;if(void 0===l)t.addEventListener("dispose",mt);else if(l.cacheKey!==c)gt(t);else if(i.lightsStateVersion!==s)i.lightsStateVersion=s,h=!1;else{if(void 0!==a.shaderID)return;h=!1}h&&(l=K.acquireProgram(a,c),i.program=l,i.uniforms=a.uniforms,i.outputEncoding=a.outputEncoding,t.program=l);const u=l.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(let e=0;e<d.maxMorphTargets;e++)u["morphTarget"+e]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(let e=0;e<d.maxMorphNormals;e++)u["morphNormal"+e]>=0&&t.numSupportedMorphNormals++}const f=i.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(i.numClippingPlanes=I.numPlanes,i.numIntersection=I.numIntersection,f.clippingPlanes=I.uniform),i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=s,i.needsLights&&(f.ambientLightColor.value=r.state.ambient,f.lightProbe.value=r.state.probe,f.directionalLights.value=r.state.directional,f.directionalLightShadows.value=r.state.directionalShadow,f.spotLights.value=r.state.spot,f.spotLightShadows.value=r.state.spotShadow,f.rectAreaLights.value=r.state.rectArea,f.pointLights.value=r.state.point,f.pointLightShadows.value=r.state.pointShadow,f.hemisphereLights.value=r.state.hemi,f.directionalShadowMap.value=r.state.directionalShadowMap,f.directionalShadowMatrix.value=r.state.directionalShadowMatrix,f.spotShadowMap.value=r.state.spotShadowMap,f.spotShadowMatrix.value=r.state.spotShadowMatrix,f.pointShadowMap.value=r.state.pointShadowMap,f.pointShadowMatrix.value=r.state.pointShadowMatrix);const m=i.program.getUniforms(),g=ml.seqWithValue(m.seq,f);i.uniformsList=g}function wt(t,e,n,i){!0!==e.isScene&&(e=z),X.resetTextureUnits();const r=e.fog,o=n.isMeshStandardMaterial?e.environment:null,s=null===y?d.outputEncoding:y.texture.encoding,a=q.get(n),c=p.state.lights;if(!0===B&&(!0===F||t!==b)){const e=t===b&&n.id===_;I.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,t,a,e)}n.version===a.__version?void 0===a.program?bt(n,e,i):n.fog&&a.fog!==r?bt(n,e,i):a.environment!==o?bt(n,e,i):a.needsLights&&a.lightsStateVersion!==c.state.version?bt(n,e,i):void 0===a.numClippingPlanes||a.numClippingPlanes===I.numPlanes&&a.numIntersection===I.numIntersection?a.outputEncoding!==s&&bt(n,e,i):bt(n,e,i):(bt(n,e,i),a.__version=n.version);let l=!1,h=!1,u=!1;const f=a.program,m=f.getUniforms(),g=a.uniforms;if(j.useProgram(f.program)&&(l=!0,h=!0,u=!0),n.id!==_&&(_=n.id,h=!0),l||b!==t){if(m.setValue(ct,"projectionMatrix",t.projectionMatrix),V.logarithmicDepthBuffer&&m.setValue(ct,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),b!==t&&(b=t,h=!0,u=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=m.map.cameraPosition;void 0!==e&&e.setValue(ct,U.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&m.setValue(ct,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&m.setValue(ct,"viewMatrix",t.matrixWorldInverse)}if(n.skinning){m.setOptional(ct,i,"bindMatrix"),m.setOptional(ct,i,"bindMatrixInverse");const t=i.skeleton;if(t){const e=t.bones;if(V.floatVertexTextures){if(void 0===t.boneTexture){let n=Math.sqrt(4*e.length);n=In.ceilPowerOfTwo(n),n=Math.max(n,4);const i=new Float32Array(n*n*4);i.set(t.boneMatrices);const r=new Ao(i,n,n,Ft,Rt);t.boneMatrices=i,t.boneTexture=r,t.boneTextureSize=n}m.setValue(ct,"boneTexture",t.boneTexture,X),m.setValue(ct,"boneTextureSize",t.boneTextureSize)}else m.setOptional(ct,t,"boneMatrices")}}var v,x;return(h||a.receiveShadow!==i.receiveShadow)&&(a.receiveShadow=i.receiveShadow,m.setValue(ct,"receiveShadow",i.receiveShadow)),h&&(m.setValue(ct,"toneMappingExposure",d.toneMappingExposure),a.needsLights&&(x=u,(v=g).ambientLightColor.needsUpdate=x,v.lightProbe.needsUpdate=x,v.directionalLights.needsUpdate=x,v.directionalLightShadows.needsUpdate=x,v.pointLights.needsUpdate=x,v.pointLightShadows.needsUpdate=x,v.spotLights.needsUpdate=x,v.spotLightShadows.needsUpdate=x,v.rectAreaLights.needsUpdate=x,v.hemisphereLights.needsUpdate=x),r&&n.fog&&$.refreshFogUniforms(g,r),$.refreshMaterialUniforms(g,n,o,L,A),void 0!==g.ltc_1&&(g.ltc_1.value=Po.LTC_1),void 0!==g.ltc_2&&(g.ltc_2.value=Po.LTC_2),ml.upload(ct,a.uniformsList,g,X)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(ml.upload(ct,a.uniformsList,g,X),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&m.setValue(ct,"center",i.center),m.setValue(ct,"modelViewMatrix",i.modelViewMatrix),m.setValue(ct,"normalMatrix",i.normalMatrix),m.setValue(ct,"modelMatrix",i.matrixWorld),f}yt.setAnimationLoop(function(t){ut.isPresenting||vt&&vt(t)}),"undefined"!=typeof window&&yt.setContext(window),this.setAnimationLoop=function(t){vt=t,ut.setAnimationLoop(t),null===t?yt.stop():yt.start()},this.render=function(t,e){let n,i;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===f)return;at.resetDefaultState(),_=-1,b=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===ut.enabled&&!0===ut.isPresenting&&(e=ut.getCamera(e)),!0===t.isScene&&t.onBeforeRender(d,t,e,n||y),(p=et.get(t,e)).init(),G.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),N.setFromProjectionMatrix(G),F=this.localClippingEnabled,B=I.init(this.clippingPlanes,F,e),(u=tt.get(t,e)).init(),function t(e,n,i,r){if(!1===e.visible)return;const o=e.layers.test(n.layers);if(o)if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(n);else if(e.isLight)p.pushLight(e),e.castShadow&&p.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||N.intersectsSprite(e)){r&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(G);const t=J.update(e),n=e.material;n.visible&&u.push(e,t,n,i,U.z,null)}}else if(e.isImmediateRenderObject)r&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(G),u.push(e,null,e.material,i,U.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==W.render.frame&&(e.skeleton.update(),e.skeleton.frame=W.render.frame),!e.frustumCulled||N.intersectsObject(e))){r&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(G);const t=J.update(e),n=e.material;if(Array.isArray(n)){const r=t.groups;for(let o=0,s=r.length;o<s;o++){const s=r[o],a=n[s.materialIndex];a&&a.visible&&u.push(e,t,a,i,U.z,s)}}else n.visible&&u.push(e,t,n,i,U.z,null)}const s=e.children;for(let a=0,c=s.length;a<c;a++)t(s[a],n,i,r)}(t,e,0,d.sortObjects),u.finish(),!0===d.sortObjects&&u.sort(R,C),!0===B&&I.beginShadows();const r=p.state.shadowsArray;pt.render(r,t,e),p.setupLights(e),!0===B&&I.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),nt.render(u,t,e,i);const o=u.opaque,s=u.transparent;o.length>0&&xt(o,t,e),s.length>0&&xt(s,t,e),!0===t.isScene&&t.onAfterRender(d,t,e),null!==y&&(X.updateRenderTargetMipmap(y),X.updateMultisampleRenderTarget(y)),j.buffers.depth.setTest(!0),j.buffers.depth.setMask(!0),j.buffers.color.setMask(!0),j.setPolygonOffset(!1),u=null,p=null},this.setFramebuffer=function(t){m!==t&&null===y&&ct.bindFramebuffer(36160,t),m=t},this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return v},this.getRenderTarget=function(){return y},this.setRenderTarget=function(t,e,n){y=t,g=e,v=n,t&&void 0===q.get(t).__webglFramebuffer&&X.setupRenderTarget(t);let i=m,r=!1;if(t){const n=q.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(i=n[e||0],r=!0):i=t.isWebGLMultisampleRenderTarget?q.get(t).__webglMultisampledFramebuffer:n,M.copy(t.viewport),S.copy(t.scissor),T=t.scissorTest}else M.copy(P).multiplyScalar(L).floor(),S.copy(O).multiplyScalar(L).floor(),T=D;if(x!==i&&(ct.bindFramebuffer(36160,i),x=i),j.viewport(M),j.scissor(S),j.setScissorTest(T),r){const i=q.get(t.texture);ct.framebufferTexture2D(36160,36064,34069+(e||0),i.__webglTexture,n||0)}},this.readRenderTargetPixels=function(t,e,n,i,r,o,s){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=q.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){let s=!1;a!==x&&(ct.bindFramebuffer(36160,a),s=!0);try{const a=t.texture,c=a.format,l=a.type;if(c!==Ft&&st.convert(c)!==ct.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(l===Mt||st.convert(l)===ct.getParameter(35738)||l===Rt&&(V.isWebGL2||k.get("OES_texture_float")||k.get("WEBGL_color_buffer_float"))||l===Ct&&(V.isWebGL2?k.get("EXT_color_buffer_float"):k.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ct.checkFramebufferStatus(36160)?e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&ct.readPixels(e,n,i,r,st.convert(c),st.convert(l),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&ct.bindFramebuffer(36160,x)}}},this.copyFramebufferToTexture=function(t,e,n){void 0===n&&(n=0);const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),o=Math.floor(e.image.height*i),s=st.convert(e.format);X.setTexture2D(e,0),ct.copyTexImage2D(3553,n,s,t.x,t.y,r,o,0),j.unbindTexture()},this.copyTextureToTexture=function(t,e,n,i){void 0===i&&(i=0);const r=e.image.width,o=e.image.height,s=st.convert(n.format),a=st.convert(n.type);X.setTexture2D(n,0),ct.pixelStorei(37440,n.flipY),ct.pixelStorei(37441,n.premultiplyAlpha),ct.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?ct.texSubImage2D(3553,i,t.x,t.y,r,o,s,a,e.image.data):e.isCompressedTexture?ct.compressedTexSubImage2D(3553,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,s,e.mipmaps[0].data):ct.texSubImage2D(3553,i,t.x,t.y,s,a,e.image),0===i&&n.generateMipmaps&&ct.generateMipmap(3553),j.unbindTexture()},this.initTexture=function(t){X.setTexture2D(t,0),j.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function vh(t){gh.call(this,t)}function yh(t,e){this.name="",this.color=new ur(t),this.density=void 0!==e?e:25e-5}function xh(t,e,n){this.name="",this.color=new ur(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3}function _h(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Sn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=In.generateUUID()}uh.prototype=Object.assign(Object.create(wo.prototype),{constructor:uh,isArrayCamera:!0}),ph.prototype=Object.assign(Object.create(_i.prototype),{constructor:ph,isGroup:!0}),Object.assign(dh.prototype,{constructor:dh,getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new ph,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new ph,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),this},update:function(t,e,n){let i=null,r=null;const o=this._targetRay,s=this._grip;return t&&(null!==o&&null!==(i=e.getPose(t.targetRaySpace,n))&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale)),null!==s&&t.gripSpace&&null!==(r=e.getPose(t.gripSpace,n))&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale))),null!==o&&(o.visible=null!==i),null!==s&&(s.visible=null!==r),this}}),Object.assign(fh.prototype,Dn.prototype),vh.prototype=Object.assign(Object.create(gh.prototype),{constructor:vh,isWebGL1Renderer:!0}),Object.assign(yh.prototype,{isFogExp2:!0,clone:function(){return new yh(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(xh.prototype,{isFog:!0,clone:function(){return new xh(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(_h.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(_h.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=In.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new _h(new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),this.stride);return e.setUsage(this.usage),e},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=In.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const bh=new Yn;function wh(t,e,n,i){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===i}function Mh(t){vr.call(this),this.type="SpriteMaterial",this.color=new ur(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}let Sh;Object.defineProperties(wh.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(wh.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(let e=0,n=this.data.count;e<n;e++)bh.x=this.getX(e),bh.y=this.getY(e),bh.z=this.getZ(e),bh.applyMatrix4(t),this.setXYZ(e,bh.x,bh.y,bh.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this},setXYZW:function(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this},clone:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new br(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new wh(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),Mh.prototype=Object.create(vr.prototype),Mh.prototype.constructor=Mh,Mh.prototype.isSpriteMaterial=!0,Mh.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};const Th=new Yn,Eh=new Yn,Ah=new Yn,Lh=new Bn,Rh=new Bn,Ch=new ni,Ph=new Yn,Oh=new Yn,Dh=new Yn,Nh=new Bn,Ih=new Bn,Bh=new Bn;function Fh(t){if(_i.call(this),this.type="Sprite",void 0===Sh){Sh=new zr;const t=new _h(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Sh.setIndex([0,1,2,0,2,3]),Sh.setAttribute("position",new wh(t,3,0,!1)),Sh.setAttribute("uv",new wh(t,2,3,!1))}this.geometry=Sh,this.material=void 0!==t?t:new Mh,this.center=new Bn(.5,.5)}function Gh(t,e,n,i,r,o){Lh.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(Rh.x=o*Lh.x-r*Lh.y,Rh.y=r*Lh.x+o*Lh.y):Rh.copy(Lh),t.copy(e),t.x+=Rh.x,t.y+=Rh.y,t.applyMatrix4(Ch)}Fh.prototype=Object.assign(Object.create(_i.prototype),{constructor:Fh,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Eh.setFromMatrixScale(this.matrixWorld),Ch.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Ah.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Eh.multiplyScalar(-Ah.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const o=this.center;Gh(Ph.set(-.5,-.5,0),Ah,o,Eh,i,r),Gh(Oh.set(.5,-.5,0),Ah,o,Eh,i,r),Gh(Dh.set(.5,.5,0),Ah,o,Eh,i,r),Nh.set(0,0),Ih.set(1,0),Bh.set(1,1);let s=t.ray.intersectTriangle(Ph,Oh,Dh,!1,Th);if(null===s&&(Gh(Oh.set(-.5,.5,0),Ah,o,Eh,i,r),Ih.set(0,1),null===(s=t.ray.intersectTriangle(Ph,Dh,Oh,!1,Th))))return;const a=t.ray.origin.distanceTo(Th);a<t.near||a>t.far||e.push({distance:a,point:Th.clone(),uv:ar.getUV(Th,Ph,Oh,Dh,Nh,Ih,Bh,new Bn),face:null,object:this})},copy:function(t){return _i.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}});const Uh=new Yn,zh=new Yn;function Hh(){_i.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function kh(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),ro.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ni,this.bindMatrixInverse=new ni}Hh.prototype=Object.assign(Object.create(_i.prototype),{constructor:Hh,isLOD:!0,copy:function(t){_i.prototype.copy.call(this,t,!1);const e=t.levels;for(let n=0,i=e.length;n<i;n++){const t=e[n];this.addLevel(t.object.clone(),t.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);const n=this.levels;let i;for(i=0;i<n.length&&!(e<n[i].distance);i++);return n.splice(i,0,{distance:e,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){const e=this.levels;if(e.length>0){let n,i;for(n=1,i=e.length;n<i&&!(t<e[n].distance);n++);return e[n-1].object}return null},raycast:function(t,e){if(this.levels.length>0){Uh.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(Uh);this.getObjectForDistance(n).raycast(t,e)}},update:function(t){const e=this.levels;if(e.length>1){Uh.setFromMatrixPosition(t.matrixWorld),zh.setFromMatrixPosition(this.matrixWorld);const n=Uh.distanceTo(zh)/t.zoom;let i,r;for(e[0].object.visible=!0,i=1,r=e.length;i<r&&n>=e[i].distance;i++)e[i-1].object.visible=!1,e[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)e[i].object.visible=!1}},toJSON:function(t){const e=_i.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const t=n[i];e.object.levels.push({object:t.object.uuid,distance:t.distance})}return e}}),kh.prototype=Object.assign(Object.create(ro.prototype),{constructor:kh,isSkinnedMesh:!0,copy:function(t){return ro.prototype.copy.call(this,t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const t=new kn,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){ro.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(){const t=new Yn,e=new kn,n=new kn,i=new Yn,r=new ni;return function(o,s){const a=this.skeleton,c=this.geometry;e.fromBufferAttribute(c.attributes.skinIndex,o),n.fromBufferAttribute(c.attributes.skinWeight,o),t.fromBufferAttribute(c.attributes.position,o).applyMatrix4(this.bindMatrix),s.set(0,0,0);for(let l=0;l<4;l++){const o=n.getComponent(l);if(0!==o){const n=e.getComponent(l);r.multiplyMatrices(a.bones[n].matrixWorld,a.boneInverses[n]),s.addScaledVector(i.copy(t).applyMatrix4(r),o)}}return s.applyMatrix4(this.bindMatrixInverse)}}()});const Vh=new ni,jh=new ni;function Wh(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new ni)}}function qh(){_i.call(this),this.type="Bone"}Object.assign(Wh.prototype,{calculateInverses:function(){this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++){const e=new ni;this.bones[t]&&e.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(e)}},pose:function(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.getInverse(this.boneInverses[t])}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}},update:function(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,o=t.length;r<o;r++){const i=t[r]?t[r].matrixWorld:jh;Vh.multiplyMatrices(i,e[r]),Vh.toArray(n,16*r)}void 0!==i&&(i.needsUpdate=!0)},clone:function(){return new Wh(this.bones,this.boneInverses)},getBoneByName:function(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),qh.prototype=Object.assign(Object.create(_i.prototype),{constructor:qh,isBone:!0});const Xh=new ni,Yh=new ni,Zh=[],Jh=new ro;function Qh(t,e,n){ro.call(this,t,e),this.instanceMatrix=new br(new Float32Array(16*n),16),this.count=n,this.frustumCulled=!1}function Kh(t){vr.call(this),this.type="LineBasicMaterial",this.color=new ur(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}Qh.prototype=Object.assign(Object.create(ro.prototype),{constructor:Qh,isInstancedMesh:!0,copy:function(t){return ro.prototype.copy.call(this,t),this.instanceMatrix.copy(t.instanceMatrix),this.count=t.count,this},getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){const n=this.matrixWorld,i=this.count;if(Jh.geometry=this.geometry,Jh.material=this.material,void 0!==Jh.material)for(let r=0;r<i;r++){this.getMatrixAt(r,Xh),Yh.multiplyMatrices(n,Xh),Jh.matrixWorld=Yh,Jh.raycast(t,Zh);for(let t=0,n=Zh.length;t<n;t++){const n=Zh[t];n.instanceId=r,n.object=this,e.push(n)}Zh.length=0}},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),Kh.prototype=Object.create(vr.prototype),Kh.prototype.constructor=Kh,Kh.prototype.isLineBasicMaterial=!0,Kh.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};const $h=new Yn,tu=new Yn,eu=new ni,nu=new qi,iu=new Gi;function ru(t,e,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),_i.call(this),this.type="Line",this.geometry=void 0!==t?t:new zr,this.material=void 0!==e?e:new Kh,this.updateMorphTargets()}ru.prototype=Object.assign(Object.create(_i.prototype),{constructor:ru,isLine:!0,copy:function(t){return _i.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)$h.fromBufferAttribute(e,t-1),tu.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=$h.distanceTo(tu);t.setAttribute("lineDistance",new Rr(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,n=t.lineDistances;n[0]=0;for(let t=1,i=e.length;t<i;t++)n[t]=n[t-1],n[t]+=e[t-1].distanceTo(e[t])}return this},raycast:function(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),iu.copy(n.boundingSphere),iu.applyMatrix4(i),iu.radius+=r,!1===t.ray.intersectsSphere(iu))return;eu.getInverse(i),nu.copy(t.ray).applyMatrix4(eu);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,a=new Yn,c=new Yn,l=new Yn,h=new Yn,u=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,r=n.attributes.position.array;if(null!==i){const n=i.array;for(let i=0,o=n.length-1;i<o;i+=u){const o=n[i],u=n[i+1];if(a.fromArray(r,3*o),c.fromArray(r,3*u),nu.distanceSqToSegment(a,c,h,l)>s)continue;h.applyMatrix4(this.matrixWorld);const p=t.ray.origin.distanceTo(h);p<t.near||p>t.far||e.push({distance:p,point:l.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else for(let n=0,o=r.length/3-1;n<o;n+=u){if(a.fromArray(r,3*n),c.fromArray(r,3*n+3),nu.distanceSqToSegment(a,c,h,l)>s)continue;h.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(h);i<t.near||i>t.far||e.push({distance:i,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else if(n.isGeometry){const i=n.vertices,r=i.length;for(let n=0;n<r-1;n+=u){if(nu.distanceSqToSegment(i[n],i[n+1],h,l)>s)continue;h.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(h);r<t.near||r>t.far||e.push({distance:r,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const ou=new Yn,su=new Yn;function au(t,e){ru.call(this,t,e),this.type="LineSegments"}function cu(t,e){ru.call(this,t,e),this.type="LineLoop"}function lu(t){vr.call(this),this.type="PointsMaterial",this.color=new ur(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}au.prototype=Object.assign(Object.create(ru.prototype),{constructor:au,isLineSegments:!0,computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)ou.fromBufferAttribute(e,t),su.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+ou.distanceTo(su);t.setAttribute("lineDistance",new Rr(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,n=t.lineDistances;for(let t=0,i=e.length;t<i;t+=2)ou.copy(e[t]),su.copy(e[t+1]),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+ou.distanceTo(su)}return this}}),cu.prototype=Object.assign(Object.create(ru.prototype),{constructor:cu,isLineLoop:!0}),lu.prototype=Object.create(vr.prototype),lu.prototype.constructor=lu,lu.prototype.isPointsMaterial=!0,lu.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};const hu=new ni,uu=new qi,pu=new Gi,du=new Yn;function fu(t,e){_i.call(this),this.type="Points",this.geometry=void 0!==t?t:new zr,this.material=void 0!==e?e:new lu,this.updateMorphTargets()}function mu(t,e,n,i,r,o,s){const a=uu.distanceSqToPoint(t);if(a<n){const n=new Yn;uu.closestPointToPoint(t,n),n.applyMatrix4(i);const c=r.ray.origin.distanceTo(n);if(c<r.near||c>r.far)return;o.push({distance:c,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:s})}}function gu(t,e,n,i,r,o,s,a,c){Hn.call(this,t,e,n,i,r,o,s,a,c),this.format=void 0!==s?s:Bt,this.minFilter=void 0!==o?o:yt,this.magFilter=void 0!==r?r:yt,this.generateMipmaps=!1}function vu(t,e,n,i,r,o,s,a,c,l,h,u){Hn.call(this,null,o,s,a,c,l,i,r,h,u),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function yu(t,e,n,i,r,o,s,a,c){Hn.call(this,t,e,n,i,r,o,s,a,c),this.needsUpdate=!0}function xu(t,e,n,i,r,o,s,a,c,l){if((l=void 0!==l?l:Ht)!==Ht&&l!==kt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&l===Ht&&(n=Et),void 0===n&&l===kt&&(n=Nt),Hn.call(this,null,i,r,o,s,a,l,n,c),this.image={width:t,height:e},this.magFilter=void 0!==s?s:dt,this.minFilter=void 0!==a?a:dt,this.flipY=!1,this.generateMipmaps=!1}function _u(t){zr.call(this),this.type="WireframeGeometry";const e=[],n=[0,0],i={},r=["a","b","c"];if(t&&t.isGeometry){const o=t.faces;for(let t=0,e=o.length;t<e;t++){const e=o[t];for(let t=0;t<3;t++){const o=e[r[t]],s=e[r[(t+1)%3]];n[0]=Math.min(o,s),n[1]=Math.max(o,s);const a=n[0]+","+n[1];void 0===i[a]&&(i[a]={index1:n[0],index2:n[1]})}}for(const n in i){const r=i[n];let o=t.vertices[r.index1];e.push(o.x,o.y,o.z),o=t.vertices[r.index2],e.push(o.x,o.y,o.z)}}else if(t&&t.isBufferGeometry){let r=new Yn;if(null!==t.index){const o=t.attributes.position,s=t.index;let a=t.groups;0===a.length&&(a=[{start:0,count:s.count,materialIndex:0}]);for(let t=0,e=a.length;t<e;++t){const e=a[t],r=e.start;for(let t=r,o=r+e.count;t<o;t+=3)for(let e=0;e<3;e++){const r=s.getX(t+e),o=s.getX(t+(e+1)%3);n[0]=Math.min(r,o),n[1]=Math.max(r,o);const a=n[0]+","+n[1];void 0===i[a]&&(i[a]={index1:n[0],index2:n[1]})}}for(const t in i){const n=i[t];r.fromBufferAttribute(o,n.index1),e.push(r.x,r.y,r.z),r.fromBufferAttribute(o,n.index2),e.push(r.x,r.y,r.z)}}else{const n=t.attributes.position;for(let t=0,i=n.count/3;t<i;t++)for(let o=0;o<3;o++){const i=3*t+o;r.fromBufferAttribute(n,i),e.push(r.x,r.y,r.z);const s=3*t+(o+1)%3;r.fromBufferAttribute(n,s),e.push(r.x,r.y,r.z)}}}this.setAttribute("position",new Rr(e,3))}function bu(t,e,n){uo.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n},this.fromBufferGeometry(new wu(t,e,n)),this.mergeVertices()}function wu(t,e,n){zr.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:n};const i=[],r=[],o=[],s=[],a=new Yn,c=new Yn,l=new Yn,h=new Yn,u=new Yn;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=e+1;for(let d=0;d<=n;d++){const i=d/n;for(let n=0;n<=e;n++){const p=n/e;t(p,i,c),r.push(c.x,c.y,c.z),p-1e-5>=0?(t(p-1e-5,i,l),h.subVectors(c,l)):(t(p+1e-5,i,l),h.subVectors(l,c)),i-1e-5>=0?(t(p,i-1e-5,l),u.subVectors(c,l)):(t(p,i+1e-5,l),u.subVectors(l,c)),a.crossVectors(h,u).normalize(),o.push(a.x,a.y,a.z),s.push(p,i)}}for(let d=0;d<n;d++)for(let t=0;t<e;t++){const e=d*p+t,n=d*p+t+1,r=(d+1)*p+t+1,o=(d+1)*p+t;i.push(e,n,o),i.push(n,r,o)}this.setIndex(i),this.setAttribute("position",new Rr(r,3)),this.setAttribute("normal",new Rr(o,3)),this.setAttribute("uv",new Rr(s,2))}function Mu(t,e,n,i){uo.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i},this.fromBufferGeometry(new Su(t,e,n,i)),this.mergeVertices()}function Su(t,e,n,i){zr.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i},n=n||1;const r=[],o=[];function s(t,e,n,i){const r=Math.pow(2,i),o=[];for(let s=0;s<=r;s++){o[s]=[];const i=t.clone().lerp(n,s/r),a=e.clone().lerp(n,s/r),c=r-s;for(let t=0;t<=c;t++)o[s][t]=0===t&&s===r?i:i.clone().lerp(a,t/c)}for(let s=0;s<r;s++)for(let t=0;t<2*(r-s)-1;t++){const e=Math.floor(t/2);t%2==0?(a(o[s][e+1]),a(o[s+1][e]),a(o[s][e])):(a(o[s][e+1]),a(o[s+1][e+1]),a(o[s+1][e]))}}function a(t){r.push(t.x,t.y,t.z)}function c(e,n){const i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2]}function l(t,e,n,i){i<0&&1===t.x&&(o[e]=t.x-1),0===n.x&&0===n.z&&(o[e]=i/2/Math.PI+.5)}function h(t){return Math.atan2(t.z,-t.x)}!function(t){const n=new Yn,i=new Yn,r=new Yn;for(let o=0;o<e.length;o+=3)c(e[o+0],n),c(e[o+1],i),c(e[o+2],r),s(n,i,r,t)}(i=i||0),function(t){const e=new Yn;for(let n=0;n<r.length;n+=3)e.x=r[n+0],e.y=r[n+1],e.z=r[n+2],e.normalize().multiplyScalar(t),r[n+0]=e.x,r[n+1]=e.y,r[n+2]=e.z}(n),function(){const t=new Yn;for(let n=0;n<r.length;n+=3){t.x=r[n+0],t.y=r[n+1],t.z=r[n+2];const i=h(t)/2/Math.PI+.5,s=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);o.push(i,1-s)}var e;(function(){const t=new Yn,e=new Yn,n=new Yn,i=new Yn,s=new Bn,a=new Bn,c=new Bn;for(let u=0,p=0;u<r.length;u+=9,p+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),n.set(r[u+6],r[u+7],r[u+8]),s.set(o[p+0],o[p+1]),a.set(o[p+2],o[p+3]),c.set(o[p+4],o[p+5]),i.copy(t).add(e).add(n).divideScalar(3);const d=h(i);l(s,p+0,t,d),l(a,p+2,e,d),l(c,p+4,n,d)}})(),function(){for(let t=0;t<o.length;t+=6){const e=o[t+0],n=o[t+2],i=o[t+4],r=Math.max(e,n,i),s=Math.min(e,n,i);r>.9&&s<.1&&(e<.2&&(o[t+0]+=1),n<.2&&(o[t+2]+=1),i<.2&&(o[t+4]+=1))}}()}(),this.setAttribute("position",new Rr(r,3)),this.setAttribute("normal",new Rr(r.slice(),3)),this.setAttribute("uv",new Rr(o,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}function Tu(t,e){uo.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Eu(t,e)),this.mergeVertices()}function Eu(t,e){Su.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Au(t,e){uo.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Lu(t,e)),this.mergeVertices()}function Lu(t,e){Su.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Ru(t,e){uo.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Cu(t,e)),this.mergeVertices()}function Cu(t,e){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];Su.call(this,i,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Pu(t,e){uo.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ou(t,e)),this.mergeVertices()}function Ou(t,e){const n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i];Su.call(this,r,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Du(t,e,n,i,r,o){uo.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");const s=new Nu(t,e,n,i,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}function Nu(t,e,n,i,r){zr.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r},e=e||64,n=n||1,i=i||8,r=r||!1;const o=t.computeFrenetFrames(e,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const s=new Yn,a=new Yn,c=new Bn;let l=new Yn;const h=[],u=[],p=[],d=[];function f(r){l=t.getPointAt(r/e,l);const c=o.normals[r],p=o.binormals[r];for(let t=0;t<=i;t++){const e=t/i*Math.PI*2,r=Math.sin(e),o=-Math.cos(e);a.x=o*c.x+r*p.x,a.y=o*c.y+r*p.y,a.z=o*c.z+r*p.z,a.normalize(),u.push(a.x,a.y,a.z),s.x=l.x+n*a.x,s.y=l.y+n*a.y,s.z=l.z+n*a.z,h.push(s.x,s.y,s.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=i;n++)c.x=t/e,c.y=n/i,p.push(c.x,c.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),o=(i+1)*t+e,s=(i+1)*(t-1)+e;d.push(n,r,s),d.push(r,o,s)}}()}(),this.setIndex(d),this.setAttribute("position",new Rr(h,3)),this.setAttribute("normal",new Rr(u,3)),this.setAttribute("uv",new Rr(p,2))}function Iu(t,e,n,i,r,o,s){uo.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:o},void 0!==s&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Bu(t,e,n,i,r,o)),this.mergeVertices()}function Bu(t,e,n,i,r,o){zr.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:o},t=t||1,e=e||.4,n=Math.floor(n)||64,i=Math.floor(i)||8,r=r||2,o=o||3;const s=[],a=[],c=[],l=[],h=new Yn,u=new Yn,p=new Yn,d=new Yn,f=new Yn,m=new Yn,g=new Yn;for(let y=0;y<=n;++y){const s=y/n*r*Math.PI*2;v(s,r,o,t,p),v(s+.01,r,o,t,d),m.subVectors(d,p),g.addVectors(d,p),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=i;++t){const r=t/i*Math.PI*2,o=-e*Math.cos(r),s=e*Math.sin(r);h.x=p.x+(o*g.x+s*f.x),h.y=p.y+(o*g.y+s*f.y),h.z=p.z+(o*g.z+s*f.z),a.push(h.x,h.y,h.z),u.subVectors(h,p).normalize(),c.push(u.x,u.y,u.z),l.push(y/n),l.push(t/i)}}for(let y=1;y<=n;y++)for(let t=1;t<=i;t++){const e=(i+1)*(y-1)+(t-1),n=(i+1)*y+(t-1),r=(i+1)*y+t,o=(i+1)*(y-1)+t;s.push(e,n,o),s.push(n,r,o)}function v(t,e,n,i,r){const o=Math.cos(t),s=Math.sin(t),a=n/e*t,c=Math.cos(a);r.x=i*(2+c)*.5*o,r.y=i*(2+c)*s*.5,r.z=i*Math.sin(a)*.5}this.setIndex(s),this.setAttribute("position",new Rr(a,3)),this.setAttribute("normal",new Rr(c,3)),this.setAttribute("uv",new Rr(l,2))}function Fu(t,e,n,i,r){uo.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},this.fromBufferGeometry(new Gu(t,e,n,i,r)),this.mergeVertices()}function Gu(t,e,n,i,r){zr.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},t=t||1,e=e||.4,n=Math.floor(n)||8,i=Math.floor(i)||6,r=r||2*Math.PI;const o=[],s=[],a=[],c=[],l=new Yn,h=new Yn,u=new Yn;for(let p=0;p<=n;p++)for(let o=0;o<=i;o++){const d=o/i*r,f=p/n*Math.PI*2;h.x=(t+e*Math.cos(f))*Math.cos(d),h.y=(t+e*Math.cos(f))*Math.sin(d),h.z=e*Math.sin(f),s.push(h.x,h.y,h.z),l.x=t*Math.cos(d),l.y=t*Math.sin(d),u.subVectors(h,l).normalize(),a.push(u.x,u.y,u.z),c.push(o/i),c.push(p/n)}for(let p=1;p<=n;p++)for(let t=1;t<=i;t++){const e=(i+1)*p+t-1,n=(i+1)*(p-1)+t-1,r=(i+1)*(p-1)+t,s=(i+1)*p+t;o.push(e,n,s),o.push(n,r,s)}this.setIndex(o),this.setAttribute("position",new Rr(s,3)),this.setAttribute("normal",new Rr(a,3)),this.setAttribute("uv",new Rr(c,2))}fu.prototype=Object.assign(Object.create(_i.prototype),{constructor:fu,isPoints:!0,copy:function(t){return _i.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),pu.copy(n.boundingSphere),pu.applyMatrix4(i),pu.radius+=r,!1===t.ray.intersectsSphere(pu))return;hu.getInverse(i),uu.copy(t.ray).applyMatrix4(hu);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(n.isBufferGeometry){const r=n.index,o=n.attributes.position.array;if(null!==r){const n=r.array;for(let r=0,a=n.length;r<a;r++){const a=n[r];du.fromArray(o,3*a),mu(du,a,s,i,t,e,this)}}else for(let n=0,a=o.length/3;n<a;n++)du.fromArray(o,3*n),mu(du,n,s,i,t,e,this)}else{const r=n.vertices;for(let n=0,o=r.length;n<o;n++)mu(r[n],n,s,i,t,e,this)}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),gu.prototype=Object.assign(Object.create(Hn.prototype),{constructor:gu,isVideoTexture:!0,update:function(){const t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),vu.prototype=Object.create(Hn.prototype),vu.prototype.constructor=vu,vu.prototype.isCompressedTexture=!0,yu.prototype=Object.create(Hn.prototype),yu.prototype.constructor=yu,yu.prototype.isCanvasTexture=!0,xu.prototype=Object.create(Hn.prototype),xu.prototype.constructor=xu,xu.prototype.isDepthTexture=!0,_u.prototype=Object.create(zr.prototype),_u.prototype.constructor=_u,bu.prototype=Object.create(uo.prototype),bu.prototype.constructor=bu,wu.prototype=Object.create(zr.prototype),wu.prototype.constructor=wu,Mu.prototype=Object.create(uo.prototype),Mu.prototype.constructor=Mu,Su.prototype=Object.create(zr.prototype),Su.prototype.constructor=Su,Tu.prototype=Object.create(uo.prototype),Tu.prototype.constructor=Tu,Eu.prototype=Object.create(Su.prototype),Eu.prototype.constructor=Eu,Au.prototype=Object.create(uo.prototype),Au.prototype.constructor=Au,Lu.prototype=Object.create(Su.prototype),Lu.prototype.constructor=Lu,Ru.prototype=Object.create(uo.prototype),Ru.prototype.constructor=Ru,Cu.prototype=Object.create(Su.prototype),Cu.prototype.constructor=Cu,Pu.prototype=Object.create(uo.prototype),Pu.prototype.constructor=Pu,Ou.prototype=Object.create(Su.prototype),Ou.prototype.constructor=Ou,Du.prototype=Object.create(uo.prototype),Du.prototype.constructor=Du,Nu.prototype=Object.create(zr.prototype),Nu.prototype.constructor=Nu,Nu.prototype.toJSON=function(){const t=zr.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},Iu.prototype=Object.create(uo.prototype),Iu.prototype.constructor=Iu,Bu.prototype=Object.create(zr.prototype),Bu.prototype.constructor=Bu,Fu.prototype=Object.create(uo.prototype),Fu.prototype.constructor=Fu,Gu.prototype=Object.create(zr.prototype),Gu.prototype.constructor=Gu;const Uu={triangulate:function(t,e,n){n=n||2;let i,r,o,s,a,c,l,h=e&&e.length,u=h?e[0]*n:t.length,p=zu(t,0,u,n,!0),d=[];if(!p||p.next===p.prev)return d;if(h&&(p=Xu(t,e,p,n)),t.length>80*n){i=o=t[0],r=s=t[1];for(let e=n;e<u;e+=n)(a=t[e])<i&&(i=a),(c=t[e+1])<r&&(r=c),a>o&&(o=a),c>s&&(s=c);l=0!==(l=Math.max(o-i,s-r))?1/l:0}return ku(p,d,n,i,r,l),d}};function zu(t,e,n,i,r){let o,s;if(r===gp(t,e,n,i)>0)for(o=e;o<n;o+=i)s=dp(o,t[o],t[o+1],s);else for(o=n-i;o>=e;o-=i)s=dp(o,t[o],t[o+1],s);return s&&op(s,s.next)&&(fp(s),s=s.next),s}function Hu(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!op(i,i.next)&&0!==rp(i.prev,i,i.next))i=i.next;else{if(fp(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function ku(t,e,n,i,r,o,s){if(!t)return;!s&&o&&Ku(t,i,r,o);let a,c,l=t;for(;t.prev!==t.next;)if(a=t.prev,c=t.next,o?ju(t,i,r,o):Vu(t))e.push(a.i/n),e.push(t.i/n),e.push(c.i/n),fp(t),t=c.next,l=c.next;else if((t=c)===l){s?1===s?ku(t=Wu(Hu(t),e,n),e,n,i,r,o,2):2===s&&qu(t,e,n,i,r,o):ku(Hu(t),e,n,i,r,o,1);break}}function Vu(t){let e=t.prev,n=t,i=t.next;if(rp(e,n,i)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(np(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&rp(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function ju(t,e,n,i){let r=t.prev,o=t,s=t.next;if(rp(r,o,s)>=0)return!1;let a=r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,c=r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,l=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,h=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,u=tp(a,c,e,n,i),p=tp(l,h,e,n,i),d=t.prevZ,f=t.nextZ;for(;d&&d.z>=u&&f&&f.z<=p;){if(d!==t.prev&&d!==t.next&&np(r.x,r.y,o.x,o.y,s.x,s.y,d.x,d.y)&&rp(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==t.prev&&f!==t.next&&np(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&rp(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&np(r.x,r.y,o.x,o.y,s.x,s.y,d.x,d.y)&&rp(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&np(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&rp(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Wu(t,e,n){let i=t;do{let r=i.prev,o=i.next.next;!op(r,o)&&sp(r,i,i.next,o)&&hp(r,o)&&hp(o,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(o.i/n),fp(i),fp(i.next),i=t=o),i=i.next}while(i!==t);return Hu(i)}function qu(t,e,n,i,r,o){let s=t;do{let t=s.next.next;for(;t!==s.prev;){if(s.i!==t.i&&ip(s,t)){let a=pp(s,t);return s=Hu(s,s.next),a=Hu(a,a.next),ku(s,e,n,i,r,o),void ku(a,e,n,i,r,o)}t=t.next}s=s.next}while(s!==t)}function Xu(t,e,n,i){let r,o,s,a,c,l=[];for(r=0,o=e.length;r<o;r++)(c=zu(t,s=e[r]*i,a=r<o-1?e[r+1]*i:t.length,i,!1))===c.next&&(c.steiner=!0),l.push(ep(c));for(l.sort(Yu),r=0;r<l.length;r++)Zu(l[r],n),n=Hu(n,n.next);return n}function Yu(t,e){return t.x-e.x}function Zu(t,e){if(e=Ju(t,e)){const n=pp(e,t);Hu(e,e.next),Hu(n,n.next)}}function Ju(t,e){let n,i=e,r=t.x,o=t.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){let t=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=r&&t>s){if(s=t,t===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===s)return n;let a,c=n,l=n.x,h=n.y,u=1/0;i=n;do{r>=i.x&&i.x>=l&&r!==i.x&&np(o<h?r:s,o,l,h,o<h?s:r,o,i.x,i.y)&&(a=Math.abs(o-i.y)/(r-i.x),hp(i,t)&&(a<u||a===u&&(i.x>n.x||i.x===n.x&&Qu(n,i)))&&(n=i,u=a)),i=i.next}while(i!==c);return n}function Qu(t,e){return rp(t.prev,t,e.prev)<0&&rp(e.next,t,t.next)<0}function Ku(t,e,n,i){let r=t;do{null===r.z&&(r.z=tp(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,$u(r)}function $u(t){let e,n,i,r,o,s,a,c,l=1;do{for(n=t,t=null,o=null,s=0;n;){for(s++,i=n,a=0,e=0;e<l&&(a++,i=i.nextZ);e++);for(c=l;a>0||c>0&&i;)0!==a&&(0===c||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,c--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=i}o.nextZ=null,l*=2}while(s>1);return t}function tp(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ep(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function np(t,e,n,i,r,o,s,a){return(r-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(i-a)-(n-s)*(e-a)>=0&&(n-s)*(o-a)-(r-s)*(i-a)>=0}function ip(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!lp(t,e)&&(hp(t,e)&&hp(e,t)&&up(t,e)&&(rp(t.prev,t,e.prev)||rp(t,e.prev,e))||op(t,e)&&rp(t.prev,t,t.next)>0&&rp(e.prev,e,e.next)>0)}function rp(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function op(t,e){return t.x===e.x&&t.y===e.y}function sp(t,e,n,i){const r=cp(rp(t,e,n)),o=cp(rp(t,e,i)),s=cp(rp(n,i,t)),a=cp(rp(n,i,e));return r!==o&&s!==a||(!(0!==r||!ap(t,n,e))||(!(0!==o||!ap(t,i,e))||(!(0!==s||!ap(n,t,i))||!(0!==a||!ap(n,e,i)))))}function ap(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function cp(t){return t>0?1:t<0?-1:0}function lp(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&sp(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function hp(t,e){return rp(t.prev,t,t.next)<0?rp(t,e,t.next)>=0&&rp(t,t.prev,e)>=0:rp(t,e,t.prev)<0||rp(t,t.next,e)<0}function up(t,e){let n=t,i=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}function pp(t,e){let n=new mp(t.i,t.x,t.y),i=new mp(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function dp(t,e,n,i){const r=new mp(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function fp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function mp(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gp(t,e,n,i){let r=0;for(let o=e,s=n-i;o<n;o+=i)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}const vp={area:function(t){const e=t.length;let n=0;for(let i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n},isClockWise:function(t){return vp.area(t)<0},triangulateShape:function(t,e){const n=[],i=[],r=[];yp(t),xp(n,t);let o=t.length;e.forEach(yp);for(let a=0;a<e.length;a++)i.push(o),o+=e[a].length,xp(n,e[a]);const s=Uu.triangulate(n,i);for(let a=0;a<s.length;a+=3)r.push(s.slice(a,a+3));return r}};function yp(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function xp(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}function _p(t,e){uo.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new bp(t,e)),this.mergeVertices()}function bp(t,e){zr.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],r=[];for(let s=0,a=t.length;s<a;s++){o(t[s])}function o(t){const o=[],s=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let c=void 0!==e.depth?e.depth:100,l=void 0===e.bevelEnabled||e.bevelEnabled,h=void 0!==e.bevelThickness?e.bevelThickness:6,u=void 0!==e.bevelSize?e.bevelSize:h-2,p=void 0!==e.bevelOffset?e.bevelOffset:0,d=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:wp;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),c=e.amount);let g,v,y,x,_,b=!1;f&&(g=f.getSpacedPoints(a),b=!0,l=!1,v=f.computeFrenetFrames(a,!1),y=new Yn,x=new Yn,_=new Yn),l||(d=0,h=0,u=0,p=0);const w=t.extractPoints(s);let M=w.shape;const S=w.holes;if(!vp.isClockWise(M)){M=M.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];vp.isClockWise(e)&&(S[t]=e.reverse())}}const T=vp.triangulateShape(M,S),E=M;for(let e=0,n=S.length;e<n;e++){const t=S[e];M=M.concat(t)}function A(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const L=M.length,R=T.length;function C(t,e,n){let i,r,o;const s=t.x-e.x,a=t.y-e.y,c=n.x-t.x,l=n.y-t.y,h=s*s+a*a,u=s*l-a*c;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),p=Math.sqrt(c*c+l*l),d=e.x-a/u,f=e.y+s/u,m=((n.x-l/p-d)*l-(n.y+c/p-f)*c)/(s*l-a*c),g=(i=d+s*m-t.x)*i+(r=f+a*m-t.y)*r;if(g<=2)return new Bn(i,r);o=Math.sqrt(g/2)}else{let t=!1;s>Number.EPSILON?c>Number.EPSILON&&(t=!0):s<-Number.EPSILON?c<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(l)&&(t=!0),t?(i=-a,r=s,o=Math.sqrt(h)):(i=s,r=a,o=Math.sqrt(h/2))}return new Bn(i/o,r/o)}const P=[];for(let e=0,n=E.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),P[e]=C(E[e],E[i],E[r]);const O=[];let D,N=P.concat();for(let e=0,n=S.length;e<n;e++){const t=S[e];D=[];for(let e=0,n=t.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),D[e]=C(t[e],t[i],t[r]);O.push(D),N=N.concat(D)}for(let e=0;e<d;e++){const t=e/d,n=h*Math.cos(t*Math.PI/2),i=u*Math.sin(t*Math.PI/2)+p;for(let e=0,r=E.length;e<r;e++){const t=A(E[e],P[e],i);F(t.x,t.y,-n)}for(let e=0,r=S.length;e<r;e++){const t=S[e];D=O[e];for(let e=0,r=t.length;e<r;e++){const r=A(t[e],D[e],i);F(r.x,r.y,-n)}}}const I=u+p;for(let e=0;e<L;e++){const t=l?A(M[e],N[e],I):M[e];b?(x.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),_.copy(g[0]).add(x).add(y),F(_.x,_.y,_.z)):F(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<L;t++){const n=l?A(M[t],N[t],I):M[t];b?(x.copy(v.normals[e]).multiplyScalar(n.x),y.copy(v.binormals[e]).multiplyScalar(n.y),_.copy(g[e]).add(x).add(y),F(_.x,_.y,_.z)):F(n.x,n.y,c/a*e)}for(let e=d-1;e>=0;e--){const t=e/d,n=h*Math.cos(t*Math.PI/2),i=u*Math.sin(t*Math.PI/2)+p;for(let e=0,r=E.length;e<r;e++){const t=A(E[e],P[e],i);F(t.x,t.y,c+n)}for(let e=0,r=S.length;e<r;e++){const t=S[e];D=O[e];for(let e=0,r=t.length;e<r;e++){const r=A(t[e],D[e],i);b?F(r.x,r.y+g[a-1].y,g[a-1].x+n):F(r.x,r.y,c+n)}}}function B(t,e){let n=t.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=t.length-1);for(let t=0,n=a+2*d;t<n;t++){const n=L*t,o=L*(t+1);U(e+i+n,e+r+n,e+r+o,e+i+o)}}}function F(t,e,n){o.push(t),o.push(e),o.push(n)}function G(t,e,r){z(t),z(e),z(r);const o=i.length/3,s=m.generateTopUV(n,i,o-3,o-2,o-1);H(s[0]),H(s[1]),H(s[2])}function U(t,e,r,o){z(t),z(e),z(o),z(e),z(r),z(o);const s=i.length/3,a=m.generateSideWallUV(n,i,s-6,s-3,s-2,s-1);H(a[0]),H(a[1]),H(a[3]),H(a[1]),H(a[2]),H(a[3])}function z(t){i.push(o[3*t+0]),i.push(o[3*t+1]),i.push(o[3*t+2])}function H(t){r.push(t.x),r.push(t.y)}!function(){const t=i.length/3;if(l){let t=0,e=L*t;for(let n=0;n<R;n++){const t=T[n];G(t[2]+e,t[1]+e,t[0]+e)}e=L*(t=a+2*d);for(let n=0;n<R;n++){const t=T[n];G(t[0]+e,t[1]+e,t[2]+e)}}else{for(let t=0;t<R;t++){const e=T[t];G(e[2],e[1],e[0])}for(let t=0;t<R;t++){const e=T[t];G(e[0]+L*a,e[1]+L*a,e[2]+L*a)}}n.addGroup(t,i.length/3-t,0)}(),function(){const t=i.length/3;let e=0;B(E,e),e+=E.length;for(let n=0,i=S.length;n<i;n++){const t=S[n];B(t,e),e+=t.length}n.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new Rr(i,3)),this.setAttribute("uv",new Rr(r,2)),this.computeVertexNormals()}exports.ShapeUtils=vp,_p.prototype=Object.create(uo.prototype),_p.prototype.constructor=_p,_p.prototype.toJSON=function(){const t=uo.prototype.toJSON.call(this);return Mp(this.parameters.shapes,this.parameters.options,t)},bp.prototype=Object.create(zr.prototype),bp.prototype.constructor=bp,bp.prototype.toJSON=function(){const t=zr.prototype.toJSON.call(this);return Mp(this.parameters.shapes,this.parameters.options,t)};const wp={generateTopUV:function(t,e,n,i,r){const o=e[3*n],s=e[3*n+1],a=e[3*i],c=e[3*i+1],l=e[3*r],h=e[3*r+1];return[new Bn(o,s),new Bn(a,c),new Bn(l,h)]},generateSideWallUV:function(t,e,n,i,r,o){const s=e[3*n],a=e[3*n+1],c=e[3*n+2],l=e[3*i],h=e[3*i+1],u=e[3*i+2],p=e[3*r],d=e[3*r+1],f=e[3*r+2],m=e[3*o],g=e[3*o+1],v=e[3*o+2];return Math.abs(a-h)<.01?[new Bn(s,1-c),new Bn(l,1-u),new Bn(p,1-f),new Bn(m,1-v)]:[new Bn(a,1-c),new Bn(h,1-u),new Bn(d,1-f),new Bn(g,1-v)]}};function Mp(t,e,n){if(n.shapes=[],Array.isArray(t))for(let i=0,r=t.length;i<r;i++){const e=t[i];n.shapes.push(e.uuid)}else n.shapes.push(t.uuid);return void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}function Sp(t,e){uo.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new Tp(t,e)),this.mergeVertices()}function Tp(t,e){const n=(e=e||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new uo;const i=n.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),bp.call(this,i,e),this.type="TextBufferGeometry"}function Ep(t,e,n,i,r,o,s){uo.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Ap(t,e,n,i,r,o,s)),this.mergeVertices()}function Ap(t,e,n,i,r,o,s){zr.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:s},t=t||1,e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6),i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI,o=void 0!==o?o:0,s=void 0!==s?s:Math.PI;const a=Math.min(o+s,Math.PI);let c=0;const l=[],h=new Yn,u=new Yn,p=[],d=[],f=[],m=[];for(let g=0;g<=n;g++){const p=[],v=g/n;let y=0;0==g&&0==o?y=.5/e:g==n&&a==Math.PI&&(y=-.5/e);for(let n=0;n<=e;n++){const a=n/e;h.x=-t*Math.cos(i+a*r)*Math.sin(o+v*s),h.y=t*Math.cos(o+v*s),h.z=t*Math.sin(i+a*r)*Math.sin(o+v*s),d.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(a+y,1-v),p.push(c++)}l.push(p)}for(let g=0;g<n;g++)for(let t=0;t<e;t++){const e=l[g][t+1],i=l[g][t],r=l[g+1][t],s=l[g+1][t+1];(0!==g||o>0)&&p.push(e,i,s),(g!==n-1||a<Math.PI)&&p.push(i,r,s)}this.setIndex(p),this.setAttribute("position",new Rr(d,3)),this.setAttribute("normal",new Rr(f,3)),this.setAttribute("uv",new Rr(m,2))}function Lp(t,e,n,i,r,o){uo.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new Rp(t,e,n,i,r,o)),this.mergeVertices()}function Rp(t,e,n,i,r,o){zr.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},t=t||.5,e=e||1,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8;const s=[],a=[],c=[],l=[];let h=t;const u=(e-t)/(i=void 0!==i?Math.max(1,i):1),p=new Yn,d=new Bn;for(let f=0;f<=i;f++){for(let t=0;t<=n;t++){const i=r+t/n*o;p.x=h*Math.cos(i),p.y=h*Math.sin(i),a.push(p.x,p.y,p.z),c.push(0,0,1),d.x=(p.x/e+1)/2,d.y=(p.y/e+1)/2,l.push(d.x,d.y)}h+=u}for(let f=0;f<i;f++){const t=f*(n+1);for(let e=0;e<n;e++){const i=e+t,r=i,o=i+n+1,a=i+n+2,c=i+1;s.push(r,o,c),s.push(o,a,c)}}this.setIndex(s),this.setAttribute("position",new Rr(a,3)),this.setAttribute("normal",new Rr(c,3)),this.setAttribute("uv",new Rr(l,2))}function Cp(t,e,n,i){uo.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},this.fromBufferGeometry(new Pp(t,e,n,i)),this.mergeVertices()}function Pp(t,e,n,i){zr.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},e=Math.floor(e)||12,n=n||0,i=i||2*Math.PI,i=In.clamp(i,0,2*Math.PI);const r=[],o=[],s=[],a=1/e,c=new Yn,l=new Bn;for(let h=0;h<=e;h++){const r=n+h*a*i,u=Math.sin(r),p=Math.cos(r);for(let n=0;n<=t.length-1;n++)c.x=t[n].x*u,c.y=t[n].y,c.z=t[n].x*p,o.push(c.x,c.y,c.z),l.x=h/e,l.y=n/(t.length-1),s.push(l.x,l.y)}for(let h=0;h<e;h++)for(let e=0;e<t.length-1;e++){const n=e+h*t.length,i=n,o=n+t.length,s=n+t.length+1,a=n+1;r.push(i,o,a),r.push(o,s,a)}if(this.setIndex(r),this.setAttribute("position",new Rr(o,3)),this.setAttribute("uv",new Rr(s,2)),this.computeVertexNormals(),i===2*Math.PI){const n=this.attributes.normal.array,i=new Yn,r=new Yn,o=new Yn,s=e*t.length*3;for(let e=0,a=0;e<t.length;e++,a+=3)i.x=n[a+0],i.y=n[a+1],i.z=n[a+2],r.x=n[s+a+0],r.y=n[s+a+1],r.z=n[s+a+2],o.addVectors(i,r).normalize(),n[a+0]=n[s+a+0]=o.x,n[a+1]=n[s+a+1]=o.y,n[a+2]=n[s+a+2]=o.z}}function Op(t,e){uo.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Dp(t,e)),this.mergeVertices()}function Dp(t,e){zr.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;const n=[],i=[],r=[],o=[];let s=0,a=0;if(!1===Array.isArray(t))c(t);else for(let l=0;l<t.length;l++)c(t[l]),this.addGroup(s,a,l),s+=a,a=0;function c(t){const s=i.length/3,c=t.extractPoints(e);let l=c.shape;const h=c.holes;!1===vp.isClockWise(l)&&(l=l.reverse());for(let e=0,n=h.length;e<n;e++){const t=h[e];!0===vp.isClockWise(t)&&(h[e]=t.reverse())}const u=vp.triangulateShape(l,h);for(let e=0,n=h.length;e<n;e++){const t=h[e];l=l.concat(t)}for(let e=0,n=l.length;e<n;e++){const t=l[e];i.push(t.x,t.y,0),r.push(0,0,1),o.push(t.x,t.y)}for(let e=0,i=u.length;e<i;e++){const t=u[e],i=t[0]+s,r=t[1]+s,o=t[2]+s;n.push(i,r,o),a+=3}}this.setIndex(n),this.setAttribute("position",new Rr(i,3)),this.setAttribute("normal",new Rr(r,3)),this.setAttribute("uv",new Rr(o,2))}function Np(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}function Ip(t,e){zr.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;const n=[],i=Math.cos(In.DEG2RAD*e),r=[0,0],o={};let s,a,c;const l=["a","b","c"];let h;t.isBufferGeometry?(h=new uo).fromBufferGeometry(t):h=t.clone(),h.mergeVertices(),h.computeFaceNormals();const u=h.vertices,p=h.faces;for(let d=0,f=p.length;d<f;d++){const t=p[d];for(let e=0;e<3;e++)s=t[l[e]],a=t[l[(e+1)%3]],r[0]=Math.min(s,a),r[1]=Math.max(s,a),void 0===o[c=r[0]+","+r[1]]?o[c]={index1:r[0],index2:r[1],face1:d,face2:void 0}:o[c].face2=d}for(c in o){const t=o[c];if(void 0===t.face2||p[t.face1].normal.dot(p[t.face2].normal)<=i){let e=u[t.index1];n.push(e.x,e.y,e.z),e=u[t.index2],n.push(e.x,e.y,e.z)}}this.setAttribute("position",new Rr(n,3))}function Bp(t,e,n,i,r,o,s,a){uo.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new Fp(t,e,n,i,r,o,s,a)),this.mergeVertices()}function Fp(t,e,n,i,r,o,s,a){zr.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a};const c=this;t=void 0!==t?t:1,e=void 0!==e?e:1,n=n||1,i=Math.floor(i)||8,r=Math.floor(r)||1,o=void 0!==o&&o,s=void 0!==s?s:0,a=void 0!==a?a:2*Math.PI;const l=[],h=[],u=[],p=[];let d=0;const f=[],m=n/2;let g=0;function v(n){let r,o;const f=new Bn,v=new Yn;let y=0;const x=!0===n?t:e,_=!0===n?1:-1;r=d;for(let t=1;t<=i;t++)h.push(0,m*_,0),u.push(0,_,0),p.push(.5,.5),d++;o=d;for(let t=0;t<=i;t++){const e=t/i*a+s,n=Math.cos(e),r=Math.sin(e);v.x=x*r,v.y=m*_,v.z=x*n,h.push(v.x,v.y,v.z),u.push(0,_,0),f.x=.5*n+.5,f.y=.5*r*_+.5,p.push(f.x,f.y),d++}for(let t=0;t<i;t++){const e=r+t,i=o+t;!0===n?l.push(i,i+1,e):l.push(i+1,i,e),y+=3}c.addGroup(g,y,!0===n?1:2),g+=y}!function(){const o=new Yn,v=new Yn;let y=0;const x=(e-t)/n;for(let c=0;c<=r;c++){const l=[],g=c/r,y=g*(e-t)+t;for(let t=0;t<=i;t++){const e=t/i,r=e*a+s,c=Math.sin(r),f=Math.cos(r);v.x=y*c,v.y=-g*n+m,v.z=y*f,h.push(v.x,v.y,v.z),o.set(c,x,f).normalize(),u.push(o.x,o.y,o.z),p.push(e,1-g),l.push(d++)}f.push(l)}for(let t=0;t<i;t++)for(let e=0;e<r;e++){const n=f[e][t],i=f[e+1][t],r=f[e+1][t+1],o=f[e][t+1];l.push(n,i,o),l.push(i,r,o),y+=6}c.addGroup(g,y,0),g+=y}(),!1===o&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(l),this.setAttribute("position",new Rr(h,3)),this.setAttribute("normal",new Rr(u,3)),this.setAttribute("uv",new Rr(p,2))}function Gp(t,e,n,i,r,o,s){Bp.call(this,0,t,e,n,i,r,o,s),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:s}}function Up(t,e,n,i,r,o,s){Fp.call(this,0,t,e,n,i,r,o,s),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:s}}function zp(t,e,n,i){uo.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},this.fromBufferGeometry(new Hp(t,e,n,i)),this.mergeVertices()}function Hp(t,e,n,i){zr.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},t=t||1,e=void 0!==e?Math.max(3,e):8,n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;const r=[],o=[],s=[],a=[],c=new Yn,l=new Bn;o.push(0,0,0),s.push(0,0,1),a.push(.5,.5);for(let h=0,u=3;h<=e;h++,u+=3){const r=n+h/e*i;c.x=t*Math.cos(r),c.y=t*Math.sin(r),o.push(c.x,c.y,c.z),s.push(0,0,1),l.x=(o[u]/t+1)/2,l.y=(o[u+1]/t+1)/2,a.push(l.x,l.y)}for(let h=1;h<=e;h++)r.push(h,h+1,0);this.setIndex(r),this.setAttribute("position",new Rr(o,3)),this.setAttribute("normal",new Rr(s,3)),this.setAttribute("uv",new Rr(a,2))}Sp.prototype=Object.create(uo.prototype),Sp.prototype.constructor=Sp,Tp.prototype=Object.create(bp.prototype),Tp.prototype.constructor=Tp,Ep.prototype=Object.create(uo.prototype),Ep.prototype.constructor=Ep,Ap.prototype=Object.create(zr.prototype),Ap.prototype.constructor=Ap,Lp.prototype=Object.create(uo.prototype),Lp.prototype.constructor=Lp,Rp.prototype=Object.create(zr.prototype),Rp.prototype.constructor=Rp,Cp.prototype=Object.create(uo.prototype),Cp.prototype.constructor=Cp,Pp.prototype=Object.create(zr.prototype),Pp.prototype.constructor=Pp,Op.prototype=Object.create(uo.prototype),Op.prototype.constructor=Op,Op.prototype.toJSON=function(){const t=uo.prototype.toJSON.call(this);return Np(this.parameters.shapes,t)},Dp.prototype=Object.create(zr.prototype),Dp.prototype.constructor=Dp,Dp.prototype.toJSON=function(){const t=zr.prototype.toJSON.call(this);return Np(this.parameters.shapes,t)},Ip.prototype=Object.create(zr.prototype),Ip.prototype.constructor=Ip,Bp.prototype=Object.create(uo.prototype),Bp.prototype.constructor=Bp,Fp.prototype=Object.create(zr.prototype),Fp.prototype.constructor=Fp,Gp.prototype=Object.create(Bp.prototype),Gp.prototype.constructor=Gp,Up.prototype=Object.create(Fp.prototype),Up.prototype.constructor=Up,zp.prototype=Object.create(uo.prototype),zp.prototype.constructor=zp,Hp.prototype=Object.create(zr.prototype),Hp.prototype.constructor=Hp;var kp=Object.freeze({__proto__:null,WireframeGeometry:_u,ParametricGeometry:bu,ParametricBufferGeometry:wu,TetrahedronGeometry:Tu,TetrahedronBufferGeometry:Eu,OctahedronGeometry:Au,OctahedronBufferGeometry:Lu,IcosahedronGeometry:Ru,IcosahedronBufferGeometry:Cu,DodecahedronGeometry:Pu,DodecahedronBufferGeometry:Ou,PolyhedronGeometry:Mu,PolyhedronBufferGeometry:Su,TubeGeometry:Du,TubeBufferGeometry:Nu,TorusKnotGeometry:Iu,TorusKnotBufferGeometry:Bu,TorusGeometry:Fu,TorusBufferGeometry:Gu,TextGeometry:Sp,TextBufferGeometry:Tp,SphereGeometry:Ep,SphereBufferGeometry:Ap,RingGeometry:Lp,RingBufferGeometry:Rp,PlaneGeometry:No,PlaneBufferGeometry:Io,LatheGeometry:Cp,LatheBufferGeometry:Pp,ShapeGeometry:Op,ShapeBufferGeometry:Dp,ExtrudeGeometry:_p,ExtrudeBufferGeometry:bp,EdgesGeometry:Ip,ConeGeometry:Gp,ConeBufferGeometry:Up,CylinderGeometry:Bp,CylinderBufferGeometry:Fp,CircleGeometry:zp,CircleBufferGeometry:Hp,BoxGeometry:po,BoxBufferGeometry:fo});function Vp(t){vr.call(this),this.type="ShadowMaterial",this.color=new ur(0),this.transparent=!0,this.setValues(t)}function jp(t){_o.call(this,t),this.type="RawShaderMaterial"}function Wp(t){vr.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ur(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ur(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function qp(t){Wp.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Bn(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transparency=0,this.setValues(t)}function Xp(t){vr.call(this),this.type="MeshPhongMaterial",this.color=new ur(16777215),this.specular=new ur(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ur(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Yp(t){vr.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ur(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ur(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Zp(t){vr.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Jp(t){vr.call(this),this.type="MeshLambertMaterial",this.color=new ur(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ur(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Qp(t){vr.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ur(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Kp(t){Kh.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}Vp.prototype=Object.create(vr.prototype),Vp.prototype.constructor=Vp,Vp.prototype.isShadowMaterial=!0,Vp.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.color.copy(t.color),this},jp.prototype=Object.create(_o.prototype),jp.prototype.constructor=jp,jp.prototype.isRawShaderMaterial=!0,Wp.prototype=Object.create(vr.prototype),Wp.prototype.constructor=Wp,Wp.prototype.isMeshStandardMaterial=!0,Wp.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},qp.prototype=Object.create(Wp.prototype),qp.prototype.constructor=qp,qp.prototype.isMeshPhysicalMaterial=!0,qp.prototype.copy=function(t){return Wp.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new ur).copy(t.sheen):this.sheen=null,this.transparency=t.transparency,this},Xp.prototype=Object.create(vr.prototype),Xp.prototype.constructor=Xp,Xp.prototype.isMeshPhongMaterial=!0,Xp.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Yp.prototype=Object.create(vr.prototype),Yp.prototype.constructor=Yp,Yp.prototype.isMeshToonMaterial=!0,Yp.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Zp.prototype=Object.create(vr.prototype),Zp.prototype.constructor=Zp,Zp.prototype.isMeshNormalMaterial=!0,Zp.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Jp.prototype=Object.create(vr.prototype),Jp.prototype.constructor=Jp,Jp.prototype.isMeshLambertMaterial=!0,Jp.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Qp.prototype=Object.create(vr.prototype),Qp.prototype.constructor=Qp,Qp.prototype.isMeshMatcapMaterial=!0,Qp.prototype.copy=function(t){return vr.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Kp.prototype=Object.create(Kh.prototype),Kp.prototype.constructor=Kp,Kp.prototype.isLineDashedMaterial=!0,Kp.prototype.copy=function(t){return Kh.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var $p=Object.freeze({__proto__:null,ShadowMaterial:Vp,SpriteMaterial:Mh,RawShaderMaterial:jp,ShaderMaterial:_o,PointsMaterial:lu,MeshPhysicalMaterial:qp,MeshStandardMaterial:Wp,MeshPhongMaterial:Xp,MeshToonMaterial:Yp,MeshNormalMaterial:Zp,MeshLambertMaterial:Jp,MeshDepthMaterial:ih,MeshDistanceMaterial:rh,MeshBasicMaterial:yr,MeshMatcapMaterial:Qp,LineDashedMaterial:Kp,LineBasicMaterial:Kh,Material:vr});const td={arraySlice:function(t,e,n){return td.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,n=new Array(e);for(let i=0;i!==e;++i)n[i]=i;return n.sort(function(e,n){return t[e]-t[n]}),n},sortedArray:function(t,e,n){const i=t.length,r=new t.constructor(i);for(let o=0,s=0;s!==i;++o){const i=n[o]*e;for(let n=0;n!==e;++n)r[s++]=t[i+n]}return r},flattenJSON:function(t,e,n,i){let r=1,o=t[0];for(;void 0!==o&&void 0===o[i];)o=t[r++];if(void 0===o)return;let s=o[i];if(void 0!==s)if(Array.isArray(s))do{void 0!==(s=o[i])&&(e.push(o.time),n.push.apply(n,s)),o=t[r++]}while(void 0!==o);else if(void 0!==s.toArray)do{void 0!==(s=o[i])&&(e.push(o.time),s.toArray(n,n.length)),o=t[r++]}while(void 0!==o);else do{void 0!==(s=o[i])&&(e.push(o.time),n.push(s)),o=t[r++]}while(void 0!==o)},subclip:function(t,e,n,i,r){r=r||30;const o=t.clone();o.name=e;const s=[];for(let c=0;c<o.tracks.length;++c){const t=o.tracks[c],e=t.getValueSize(),a=[],l=[];for(let o=0;o<t.times.length;++o){const s=t.times[o]*r;if(!(s<n||s>=i)){a.push(t.times[o]);for(let n=0;n<e;++n)l.push(t.values[o*e+n])}}0!==a.length&&(t.times=td.convertArray(a,t.times.constructor),t.values=td.convertArray(l,t.values.constructor),s.push(t))}o.tracks=s;let a=1/0;for(let c=0;c<o.tracks.length;++c)a>o.tracks[c].times[0]&&(a=o.tracks[c].times[0]);for(let c=0;c<o.tracks.length;++c)o.tracks[c].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(t,e,n,i){void 0===e&&(e=0),void 0===n&&(n=t),(void 0===i||i<=0)&&(i=30);const r=t.tracks.length,o=e/i;for(let s=0;s<r;++s){const e=n.tracks[s],i=e.ValueTypeName;if("bool"===i||"string"===i)continue;const r=t.tracks.find(function(t){return t.name===e.name&&t.ValueTypeName===i});if(void 0===r)continue;const a=e.getValueSize(),c=e.times.length-1;let l;if(o<=e.times[0])l=td.arraySlice(e.values,0,e.valueSize);else if(o>=e.times[c]){const t=c*a;l=td.arraySlice(e.values,t)}else{const t=e.createInterpolant();t.evaluate(o),l=t.resultBuffer}if("quaternion"===i){new Wn(l[0],l[1],l[2],l[3]).normalize().conjugate().toArray(l)}const h=r.times.length;for(let t=0;t<h;++t){const e=t*a;if("quaternion"===i)Wn.multiplyQuaternionsFlat(r.values,e,l,0,r.values,e);else for(let t=0;t<a;++t)r.values[e+t]-=l[t]}}return t.blendMode=2501,t}};function ed(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function nd(t,e,n,i){ed.call(this,t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function id(t,e,n,i){ed.call(this,t,e,n,i)}function rd(t,e,n,i){ed.call(this,t,e,n,i)}function od(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=td.convertArray(e,this.TimeBufferType),this.values=td.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function sd(t,e,n){od.call(this,t,e,n)}function ad(t,e,n,i){od.call(this,t,e,n,i)}function cd(t,e,n,i){od.call(this,t,e,n,i)}function ld(t,e,n,i){ed.call(this,t,e,n,i)}function hd(t,e,n,i){od.call(this,t,e,n,i)}function ud(t,e,n,i){od.call(this,t,e,n,i)}function pd(t,e,n,i){od.call(this,t,e,n,i)}function dd(t,e,n,i){this.name=t,this.tracks=n,this.duration=void 0!==e?e:-1,this.blendMode=void 0!==i?i:je,this.uuid=In.generateUUID(),this.duration<0&&this.resetDuration()}function fd(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return cd;case"vector":case"vector2":case"vector3":case"vector4":return pd;case"color":return ad;case"quaternion":return hd;case"bool":case"boolean":return sd;case"string":return ud}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function md(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=fd(t.type);if(void 0===t.times){const e=[],n=[];td.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}exports.AnimationUtils=td,Object.assign(ed.prototype,{evaluate:function(t){let e=this.parameterPositions,n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let o;n:{i:if(!(t<i)){for(let o=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,r)}if(n===o)break;if(r=i,t<(i=e[++n]))break e}o=e.length;break n}if(t>=r)break t;{const s=e[1];t<s&&(n=2,r=s);for(let o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(n===o)break;if(i=r,t>=(r=e[--n-1]))break e}o=n,n=0}}for(;n<o;){const i=n+o>>>1;t<e[i]?o=i:n=i+1}if(i=e[n],void 0===(r=e[n-1]))return this._cachedIndex=0,this.beforeStart_(0,t,i);if(void 0===i)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,r,t)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let o=0;o!==i;++o)e[o]=n[r+o];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(ed.prototype,{beforeStart_:ed.prototype.copySampleValue_,afterEnd_:ed.prototype.copySampleValue_}),nd.prototype=Object.assign(Object.create(ed.prototype),{constructor:nd,DefaultSettings_:{endingStart:He,endingEnd:He},intervalChanged_:function(t,e,n){let i=this.parameterPositions,r=t-2,o=t+1,s=i[r],a=i[o];if(void 0===s)switch(this.getSettings_().endingStart){case 2401:r=t,s=2*e-n;break;case 2402:s=e+i[r=i.length-2]-i[r+1];break;default:r=t,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:o=t,a=2*n-e;break;case 2402:o=1,a=n+i[1]-i[0];break;default:o=t-1,a=e}const c=.5*(n-e),l=this.valueSize;this._weightPrev=c/(e-s),this._weightNext=c/(a-n),this._offsetPrev=r*l,this._offsetNext=o*l},interpolate_:function(t,e,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,c=a-s,l=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,p=this._weightNext,d=(n-e)/(i-e),f=d*d,m=f*d,g=-u*m+2*u*f-u*d,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,x=p*m-p*f;for(let _=0;_!==s;++_)r[_]=g*o[l+_]+v*o[c+_]+y*o[a+_]+x*o[h+_];return r}}),id.prototype=Object.assign(Object.create(ed.prototype),{constructor:id,interpolate_:function(t,e,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,c=a-s,l=(n-e)/(i-e),h=1-l;for(let u=0;u!==s;++u)r[u]=o[c+u]*h+o[a+u]*l;return r}}),rd.prototype=Object.assign(Object.create(ed.prototype),{constructor:rd,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(od,{toJSON:function(t){const e=t.constructor;let n;if(void 0!==e.toJSON)n=e.toJSON(t);else{n={name:t.name,times:td.convertArray(t.times,Array),values:td.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}}),Object.assign(od.prototype,{constructor:od,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new rd(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new id(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new nd(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){let e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this},scale:function(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this},trim:function(t,e){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<t;)++r;for(;-1!==o&&n[o]>e;)--o;if(++o,0!==r||o!==i){r>=o&&(r=(o=Math.max(o,1))-1);const t=this.getValueSize();this.times=td.arraySlice(n,r,o),this.values=td.arraySlice(this.values,r*t,o*t)}return this},validate:function(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let s=0;s!==r;s++){const e=n[s];if("number"==typeof e&&isNaN(e)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,e),t=!1;break}if(null!==o&&o>e){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,e,o),t=!1;break}o=e}if(void 0!==i&&td.isTypedArray(i))for(let s=0,a=i.length;s!==a;++s){const e=i[s];if(isNaN(e)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,e),t=!1;break}}return t},optimize:function(){const t=td.arraySlice(this.times),e=td.arraySlice(this.values),n=this.getValueSize(),i=2302===this.getInterpolation(),r=t.length-1;let o=1;for(let s=1;s<r;++s){let r=!1;const a=t[s];if(a!==t[s+1]&&(1!==s||a!==a[0]))if(i)r=!0;else{const t=s*n,i=t-n,o=t+n;for(let s=0;s!==n;++s){const n=e[t+s];if(n!==e[i+s]||n!==e[o+s]){r=!0;break}}}if(r){if(s!==o){t[o]=t[s];const i=s*n,r=o*n;for(let t=0;t!==n;++t)e[r+t]=e[i+t]}++o}}if(r>0){t[o]=t[r];for(let t=r*n,i=o*n,s=0;s!==n;++s)e[i+s]=e[t+s];++o}return o!==t.length?(this.times=td.arraySlice(t,0,o),this.values=td.arraySlice(e,0,o*n)):(this.times=t,this.values=e),this},clone:function(){const t=td.arraySlice(this.times,0),e=td.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}),sd.prototype=Object.assign(Object.create(od.prototype),{constructor:sd,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ad.prototype=Object.assign(Object.create(od.prototype),{constructor:ad,ValueTypeName:"color"}),cd.prototype=Object.assign(Object.create(od.prototype),{constructor:cd,ValueTypeName:"number"}),ld.prototype=Object.assign(Object.create(ed.prototype),{constructor:ld,interpolate_:function(t,e,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-e)/(i-e);let c=t*s;for(let l=c+s;c!==l;c+=4)Wn.slerpFlat(r,0,o,c-s,o,c,a);return r}}),hd.prototype=Object.assign(Object.create(od.prototype),{constructor:hd,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new ld(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),ud.prototype=Object.assign(Object.create(od.prototype),{constructor:ud,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),pd.prototype=Object.assign(Object.create(od.prototype),{constructor:pd,ValueTypeName:"vector"}),Object.assign(dd,{parse:function(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let r=0,o=n.length;r!==o;++r)e.push(md(n[r]).scale(i));return new dd(t.name,t.duration,e,t.blendMode)},toJSON:function(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let r=0,o=n.length;r!==o;++r)e.push(od.toJSON(n[r]));return i},CreateFromMorphTargetSequence:function(t,e,n,i){const r=e.length,o=[];for(let s=0;s<r;s++){let t=[],a=[];t.push((s+r-1)%r,s,(s+1)%r),a.push(0,1,0);const c=td.getKeyframeOrder(t);t=td.sortedArray(t,1,c),a=td.sortedArray(a,1,c),i||0!==t[0]||(t.push(r),a.push(a[0])),o.push(new cd(".morphTargetInfluences["+e[s].name+"]",t,a).scale(1/n))}return new dd(t,-1,o)},findByName:function(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let i=0;i<n.length;i++)if(n[i].name===e)return n[i];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let s=0,a=t.length;s<a;s++){const e=t[s],n=e.name.match(r);if(n&&n.length>1){const t=n[1];let r=i[t];r||(i[t]=r=[]),r.push(e)}}const o=[];for(const s in i)o.push(dd.CreateFromMorphTargetSequence(s,i[s],e,n));return o},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,i,r){if(0!==n.length){const o=[],s=[];td.flattenJSON(n,o,s,i),0!==o.length&&r.push(new t(e,o,s))}},i=[],r=t.name||"default",o=t.fps||30,s=t.blendMode;let a=t.length||-1;const c=t.hierarchy||[];for(let l=0;l<c.length;l++){const t=c[l].keys;if(t&&0!==t.length)if(t[0].morphTargets){const e={};let n;for(n=0;n<t.length;n++)if(t[n].morphTargets)for(let i=0;i<t[n].morphTargets.length;i++)e[t[n].morphTargets[i]]=-1;for(const r in e){const e=[],o=[];for(let i=0;i!==t[n].morphTargets.length;++i){const i=t[n];e.push(i.time),o.push(i.morphTarget===r?1:0)}i.push(new cd(".morphTargetInfluence["+r+"]",e,o))}a=e.length*(o||1)}else{const r=".bones["+e[l].name+"]";n(pd,r+".position",t,"pos",i),n(hd,r+".quaternion",t,"rot",i),n(pd,r+".scale",t,"scl",i)}}return 0===i.length?null:new dd(r,a,i,s)}}),Object.assign(dd.prototype,{resetDuration:function(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this},trim:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new dd(this.name,this.duration,t,this.blendMode)}});const gd={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function vd(t,e,n){const i=this;let r=!1,o=0,s=0,a=void 0;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){s++,!1===r&&void 0!==i.onStart&&i.onStart(t,o,s),r=!0},this.itemEnd=function(t){o++,void 0!==i.onProgress&&i.onProgress(t,o,s),o===s&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return a?a(t):t},this.setURLModifier=function(t){return a=t,this},this.addHandler=function(t,e){return c.push(t,e),this},this.removeHandler=function(t){const e=c.indexOf(t);return-1!==e&&c.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=c.length;e<n;e+=2){const n=c[e],i=c[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}exports.Cache=gd;const yd=new vd;function xd(t){this.manager=void 0!==t?t:yd,this.crossOrigin="anonymous",this.path="",this.resourcePath="",this.requestHeader={}}exports.DefaultLoadingManager=yd,Object.assign(xd.prototype,{load:function(){},loadAsync:function(t,e){const n=this;return new Promise(function(i,r){n.load(t,i,e,r)})},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});const _d={};function bd(t){xd.call(this,t)}function wd(t){xd.call(this,t)}function Md(t){xd.call(this,t)}function Sd(t){xd.call(this,t)}function Td(t){xd.call(this,t)}function Ed(t){xd.call(this,t)}function Ad(t){xd.call(this,t)}function Ld(){this.type="Curve",this.arcLengthDivisions=200}function Rd(t,e,n,i,r,o,s,a){Ld.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=i||1,this.aStartAngle=r||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}function Cd(t,e,n,i,r,o){Rd.call(this,t,e,n,n,i,r,o),this.type="ArcCurve"}function Pd(){let t=0,e=0,n=0,i=0;function r(r,o,s,a){t=r,e=s,n=-3*r+3*o-2*s-a,i=2*r-2*o+s+a}return{initCatmullRom:function(t,e,n,i,o){r(e,n,o*(n-t),o*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,o,s,a){let c=(e-t)/o-(n-t)/(o+s)+(n-e)/s,l=(n-e)/s-(i-e)/(s+a)+(i-n)/a;r(e,n,c*=s,l*=s)},calc:function(r){const o=r*r;return t+e*r+n*o+i*(o*r)}}}bd.prototype=Object.assign(Object.create(xd.prototype),{constructor:bd,load:function(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=gd.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;if(void 0!==_d[t])return void _d[t].push({onLoad:e,onProgress:n,onError:i});const s=t.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(s){const n=s[1],o=!!s[2];let a=s[3];a=decodeURIComponent(a),o&&(a=atob(a));try{let o;const s=(this.responseType||"").toLowerCase();switch(s){case"arraybuffer":case"blob":const t=new Uint8Array(a.length);for(let n=0;n<a.length;n++)t[n]=a.charCodeAt(n);o="blob"===s?new Blob([t.buffer],{type:n}):t.buffer;break;case"document":const e=new DOMParser;o=e.parseFromString(a,n);break;case"json":o=JSON.parse(a);break;default:o=a}setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0)}catch(c){setTimeout(function(){i&&i(c),r.manager.itemError(t),r.manager.itemEnd(t)},0)}}else{_d[t]=[],_d[t].push({onLoad:e,onProgress:n,onError:i}),(a=new XMLHttpRequest).open("GET",t,!0),a.addEventListener("load",function(e){const n=this.response,i=_d[t];if(delete _d[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),gd.add(t,n);for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onLoad&&e.onLoad(n)}r.manager.itemEnd(t)}else{for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}},!1),a.addEventListener("progress",function(e){const n=_d[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onProgress&&i.onProgress(e)}},!1),a.addEventListener("error",function(e){const n=_d[t];delete _d[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)},!1),a.addEventListener("abort",function(e){const n=_d[t];delete _d[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)},!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)a.setRequestHeader(t,this.requestHeader[t]);a.send(null)}return r.manager.itemStart(t),a},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this}}),wd.prototype=Object.assign(Object.create(xd.prototype),{constructor:wd,load:function(t,e,n,i){const r=this,o=new bd(r.manager);o.setPath(r.path),o.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(o){i?i(o):console.error(o),r.manager.itemError(t)}},n,i)},parse:function(t){const e=[];for(let n=0;n<t.length;n++){const i=dd.parse(t[n]);e.push(i)}return e}}),Md.prototype=Object.assign(Object.create(xd.prototype),{constructor:Md,load:function(t,e,n,i){const r=this,o=[],s=new vu;s.image=o;const a=new bd(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer");let c=0;function l(l){a.load(t[l],function(t){const n=r.parse(t,!0);o[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(c+=1)&&(1===n.mipmapCount&&(s.minFilter=yt),s.format=n.format,s.needsUpdate=!0,e&&e(s))},n,i)}if(Array.isArray(t))for(let h=0,u=t.length;h<u;++h)l(h);else a.load(t,function(t){const n=r.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){o[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)o[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),o[e].format=n.format,o[e].width=n.width,o[e].height=n.height}}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=yt),s.format=n.format,s.needsUpdate=!0,e&&e(s)},n,i);return s}}),Sd.prototype=Object.assign(Object.create(xd.prototype),{constructor:Sd,load:function(t,e,n,i){const r=this,o=new Ao,s=new bd(this.manager);return s.setResponseType("arraybuffer"),s.setPath(this.path),s.load(t,function(t){const n=r.parse(t);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:ut,o.wrapT=void 0!==n.wrapT?n.wrapT:ut,o.magFilter=void 0!==n.magFilter?n.magFilter:yt,o.minFilter=void 0!==n.minFilter?n.minFilter:yt,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=bt),1===n.mipmapCount&&(o.minFilter=yt),o.needsUpdate=!0,e&&e(o,n))},n,i),o}}),Td.prototype=Object.assign(Object.create(xd.prototype),{constructor:Td,load:function(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=gd.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;const s=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){s.removeEventListener("load",a,!1),s.removeEventListener("error",c,!1),gd.add(t,this),e&&e(this),r.manager.itemEnd(t)}function c(e){s.removeEventListener("load",a,!1),s.removeEventListener("error",c,!1),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}return s.addEventListener("load",a,!1),s.addEventListener("error",c,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(t),s.src=t,s}}),Ed.prototype=Object.assign(Object.create(xd.prototype),{constructor:Ed,load:function(t,e,n,i){const r=new gc,o=new Td(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(n){o.load(t[n],function(t){r.images[n]=t,6===++s&&(r.needsUpdate=!0,e&&e(r))},void 0,i)}for(let c=0;c<t.length;++c)a(c);return r}}),Ad.prototype=Object.assign(Object.create(xd.prototype),{constructor:Ad,load:function(t,e,n,i){const r=new Hn,o=new Td(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(n){r.image=n;const i=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);r.format=i?Bt:Ft,r.needsUpdate=!0,void 0!==e&&e(r)},n,i),r}}),Object.assign(Ld.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)},getPoints:function(t){void 0===t&&(t=5);const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){const t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),r=0;e.push(0);for(let o=1;o<=t;o++)r+=(n=this.getPoint(o/t)).distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){const n=this.getLengths();let i,r=0,o=n.length;i=e||t*n[o-1];let s,a=0,c=o-1;for(;a<=c;)if((s=n[r=Math.floor(a+(c-a)/2)]-i)<0)a=r+1;else{if(!(s>0)){c=r;break}c=r-1}if(n[r=c]===i)return r/(o-1);const l=n[r];return(r+(i-l)/(n[r+1]-l))/(o-1)},getTangent:function(t,e){let n=t-1e-4,i=t+1e-4;n<0&&(n=0),i>1&&(i=1);const r=this.getPoint(n),o=this.getPoint(i),s=e||(r.isVector2?new Bn:new Yn);return s.copy(o).sub(r).normalize(),s},getTangentAt:function(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)},computeFrenetFrames:function(t,e){const n=new Yn,i=[],r=[],o=[],s=new Yn,a=new ni;for(let p=0;p<=t;p++){const e=p/t;i[p]=this.getTangentAt(e,new Yn),i[p].normalize()}r[0]=new Yn,o[0]=new Yn;let c=Number.MAX_VALUE;const l=Math.abs(i[0].x),h=Math.abs(i[0].y),u=Math.abs(i[0].z);l<=c&&(c=l,n.set(1,0,0)),h<=c&&(c=h,n.set(0,1,0)),u<=c&&n.set(0,0,1),s.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],s),o[0].crossVectors(i[0],r[0]);for(let p=1;p<=t;p++){if(r[p]=r[p-1].clone(),o[p]=o[p-1].clone(),s.crossVectors(i[p-1],i[p]),s.length()>Number.EPSILON){s.normalize();const t=Math.acos(In.clamp(i[p-1].dot(i[p]),-1,1));r[p].applyMatrix4(a.makeRotationAxis(s,t))}o[p].crossVectors(i[p],r[p])}if(!0===e){let e=Math.acos(In.clamp(r[0].dot(r[t]),-1,1));e/=t,i[0].dot(s.crossVectors(r[0],r[t]))>0&&(e=-e);for(let n=1;n<=t;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],e*n)),o[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),Rd.prototype=Object.create(Ld.prototype),Rd.prototype.constructor=Rd,Rd.prototype.isEllipseCurve=!0,Rd.prototype.getPoint=function(t,e){const n=e||new Bn,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=o?0:i),!0!==this.aClockwise||o||(r===i?r=-i:r-=i);const s=this.aStartAngle+t*r;let a=this.aX+this.xRadius*Math.cos(s),c=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,i=c-this.aY;a=n*t-i*e+this.aX,c=n*e+i*t+this.aY}return n.set(a,c)},Rd.prototype.copy=function(t){return Ld.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Rd.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},Rd.prototype.fromJSON=function(t){return Ld.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Cd.prototype=Object.create(Rd.prototype),Cd.prototype.constructor=Cd,Cd.prototype.isArcCurve=!0;const Od=new Yn,Dd=new Pd,Nd=new Pd,Id=new Pd;function Bd(t,e,n,i){Ld.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=n||"centripetal",this.tension=i||.5}function Fd(t,e,n,i,r){const o=.5*(i-e),s=.5*(r-n),a=t*t;return(2*n-2*i+o+s)*(t*a)+(-3*n+3*i-2*o-s)*a+o*t+n}function Gd(t,e){const n=1-t;return n*n*e}function Ud(t,e){return 2*(1-t)*t*e}function zd(t,e){return t*t*e}function Hd(t,e,n,i){return Gd(t,e)+Ud(t,n)+zd(t,i)}function kd(t,e){const n=1-t;return n*n*n*e}function Vd(t,e){const n=1-t;return 3*n*n*t*e}function jd(t,e){return 3*(1-t)*t*t*e}function Wd(t,e){return t*t*t*e}function qd(t,e,n,i,r){return kd(t,e)+Vd(t,n)+jd(t,i)+Wd(t,r)}function Xd(t,e,n,i){Ld.call(this),this.type="CubicBezierCurve",this.v0=t||new Bn,this.v1=e||new Bn,this.v2=n||new Bn,this.v3=i||new Bn}function Yd(t,e,n,i){Ld.call(this),this.type="CubicBezierCurve3",this.v0=t||new Yn,this.v1=e||new Yn,this.v2=n||new Yn,this.v3=i||new Yn}function Zd(t,e){Ld.call(this),this.type="LineCurve",this.v1=t||new Bn,this.v2=e||new Bn}function Jd(t,e){Ld.call(this),this.type="LineCurve3",this.v1=t||new Yn,this.v2=e||new Yn}function Qd(t,e,n){Ld.call(this),this.type="QuadraticBezierCurve",this.v0=t||new Bn,this.v1=e||new Bn,this.v2=n||new Bn}function Kd(t,e,n){Ld.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Yn,this.v1=e||new Yn,this.v2=n||new Yn}function $d(t){Ld.call(this),this.type="SplineCurve",this.points=t||[]}Bd.prototype=Object.create(Ld.prototype),Bd.prototype.constructor=Bd,Bd.prototype.isCatmullRomCurve3=!0,Bd.prototype.getPoint=function(t,e){const n=e||new Yn,i=this.points,r=i.length,o=(r-(this.closed?0:1))*t;let s,a,c,l,h=Math.floor(o),u=o-h;if(this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/r)+1)*r:0===u&&h===r-1&&(h=r-2,u=1),this.closed||h>0?s=i[(h-1)%r]:(Od.subVectors(i[0],i[1]).add(i[0]),s=Od),a=i[h%r],c=i[(h+1)%r],this.closed||h+2<r?l=i[(h+2)%r]:(Od.subVectors(i[r-1],i[r-2]).add(i[r-1]),l=Od),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(s.distanceToSquared(a),t),n=Math.pow(a.distanceToSquared(c),t),i=Math.pow(c.distanceToSquared(l),t);n<1e-4&&(n=1),e<1e-4&&(e=n),i<1e-4&&(i=n),Dd.initNonuniformCatmullRom(s.x,a.x,c.x,l.x,e,n,i),Nd.initNonuniformCatmullRom(s.y,a.y,c.y,l.y,e,n,i),Id.initNonuniformCatmullRom(s.z,a.z,c.z,l.z,e,n,i)}else"catmullrom"===this.curveType&&(Dd.initCatmullRom(s.x,a.x,c.x,l.x,this.tension),Nd.initCatmullRom(s.y,a.y,c.y,l.y,this.tension),Id.initCatmullRom(s.z,a.z,c.z,l.z,this.tension));return n.set(Dd.calc(u),Nd.calc(u),Id.calc(u)),n},Bd.prototype.copy=function(t){Ld.prototype.copy.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Bd.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Bd.prototype.fromJSON=function(t){Ld.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Yn).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Xd.prototype=Object.create(Ld.prototype),Xd.prototype.constructor=Xd,Xd.prototype.isCubicBezierCurve=!0,Xd.prototype.getPoint=function(t,e){const n=e||new Bn,i=this.v0,r=this.v1,o=this.v2,s=this.v3;return n.set(qd(t,i.x,r.x,o.x,s.x),qd(t,i.y,r.y,o.y,s.y)),n},Xd.prototype.copy=function(t){return Ld.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Xd.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Xd.prototype.fromJSON=function(t){return Ld.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Yd.prototype=Object.create(Ld.prototype),Yd.prototype.constructor=Yd,Yd.prototype.isCubicBezierCurve3=!0,Yd.prototype.getPoint=function(t,e){const n=e||new Yn,i=this.v0,r=this.v1,o=this.v2,s=this.v3;return n.set(qd(t,i.x,r.x,o.x,s.x),qd(t,i.y,r.y,o.y,s.y),qd(t,i.z,r.z,o.z,s.z)),n},Yd.prototype.copy=function(t){return Ld.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Yd.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Yd.prototype.fromJSON=function(t){return Ld.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Zd.prototype=Object.create(Ld.prototype),Zd.prototype.constructor=Zd,Zd.prototype.isLineCurve=!0,Zd.prototype.getPoint=function(t,e){const n=e||new Bn;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},Zd.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Zd.prototype.getTangent=function(t,e){const n=e||new Bn;return n.copy(this.v2).sub(this.v1).normalize(),n},Zd.prototype.copy=function(t){return Ld.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Zd.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Zd.prototype.fromJSON=function(t){return Ld.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Jd.prototype=Object.create(Ld.prototype),Jd.prototype.constructor=Jd,Jd.prototype.isLineCurve3=!0,Jd.prototype.getPoint=function(t,e){const n=e||new Yn;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},Jd.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Jd.prototype.copy=function(t){return Ld.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Jd.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Jd.prototype.fromJSON=function(t){return Ld.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Qd.prototype=Object.create(Ld.prototype),Qd.prototype.constructor=Qd,Qd.prototype.isQuadraticBezierCurve=!0,Qd.prototype.getPoint=function(t,e){const n=e||new Bn,i=this.v0,r=this.v1,o=this.v2;return n.set(Hd(t,i.x,r.x,o.x),Hd(t,i.y,r.y,o.y)),n},Qd.prototype.copy=function(t){return Ld.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Qd.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Qd.prototype.fromJSON=function(t){return Ld.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Kd.prototype=Object.create(Ld.prototype),Kd.prototype.constructor=Kd,Kd.prototype.isQuadraticBezierCurve3=!0,Kd.prototype.getPoint=function(t,e){const n=e||new Yn,i=this.v0,r=this.v1,o=this.v2;return n.set(Hd(t,i.x,r.x,o.x),Hd(t,i.y,r.y,o.y),Hd(t,i.z,r.z,o.z)),n},Kd.prototype.copy=function(t){return Ld.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Kd.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Kd.prototype.fromJSON=function(t){return Ld.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},$d.prototype=Object.create(Ld.prototype),$d.prototype.constructor=$d,$d.prototype.isSplineCurve=!0,$d.prototype.getPoint=function(t,e){const n=e||new Bn,i=this.points,r=(i.length-1)*t,o=Math.floor(r),s=r-o,a=i[0===o?o:o-1],c=i[o],l=i[o>i.length-2?i.length-1:o+1],h=i[o>i.length-3?i.length-1:o+2];return n.set(Fd(s,a.x,c.x,l.x,h.x),Fd(s,a.y,c.y,l.y,h.y)),n},$d.prototype.copy=function(t){Ld.prototype.copy.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this},$d.prototype.toJSON=function(){const t=Ld.prototype.toJSON.call(this);t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t},$d.prototype.fromJSON=function(t){Ld.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Bn).fromArray(n))}return this};var tf=Object.freeze({__proto__:null,ArcCurve:Cd,CatmullRomCurve3:Bd,CubicBezierCurve:Xd,CubicBezierCurve3:Yd,EllipseCurve:Rd,LineCurve:Zd,LineCurve3:Jd,QuadraticBezierCurve:Qd,QuadraticBezierCurve3:Kd,SplineCurve:$d});function ef(){Ld.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function nf(t){ef.call(this),this.type="Path",this.currentPoint=new Bn,t&&this.setFromPoints(t)}function rf(t){nf.call(this,t),this.uuid=In.generateUUID(),this.type="Shape",this.holes=[]}function of(t,e){_i.call(this),this.type="Light",this.color=new ur(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function sf(t,e,n){of.call(this,t,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(_i.DefaultUp),this.updateMatrix(),this.groundColor=new ur(e)}function af(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Bn(512,512),this.map=null,this.mapPass=null,this.matrix=new ni,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Co,this._frameExtents=new Bn(1,1),this._viewportCount=1,this._viewports=[new kn(0,0,1,1)]}function cf(){af.call(this,new wo(50,1,.5,500))}function lf(t,e,n,i,r,o){of.call(this,t,e),this.type="SpotLight",this.position.copy(_i.DefaultUp),this.updateMatrix(),this.target=new _i,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new cf}function hf(){af.call(this,new wo(90,1,.5,500)),this._frameExtents=new Bn(4,2),this._viewportCount=6,this._viewports=[new kn(2,1,1,1),new kn(0,1,1,1),new kn(3,1,1,1),new kn(1,1,1,1),new kn(3,0,1,1),new kn(1,0,1,1)],this._cubeDirections=[new Yn(1,0,0),new Yn(-1,0,0),new Yn(0,0,1),new Yn(0,0,-1),new Yn(0,1,0),new Yn(0,-1,0)],this._cubeUps=[new Yn(0,1,0),new Yn(0,1,0),new Yn(0,1,0),new Yn(0,1,0),new Yn(0,0,1),new Yn(0,0,-1)]}function uf(t,e,n,i){of.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==i?i:1,this.shadow=new hf}function pf(t,e,n,i,r,o){bo.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==n?n:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function df(){af.call(this,new pf(-5,5,5,-5,.5,500))}function ff(t,e){of.call(this,t,e),this.type="DirectionalLight",this.position.copy(_i.DefaultUp),this.updateMatrix(),this.target=new _i,this.shadow=new df}function mf(t,e){of.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function gf(t,e,n,i){of.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==i?i:10}function vf(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Yn)}function yf(t,e){of.call(this,void 0,e),this.type="LightProbe",this.sh=void 0!==t?t:new vf}function xf(t){xd.call(this,t),this.textures={}}ef.prototype=Object.assign(Object.create(Ld.prototype),{constructor:ef,add:function(t){this.curves.push(t)},closePath:function(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Zd(e,t))},getPoint:function(t){const e=t*this.getLength(),n=this.getCurveLengths();let i=0;for(;i<n.length;){if(n[i]>=e){const t=n[i]-e,r=this.curves[i],o=r.getLength(),s=0===o?0:1-t/o;return r.getPointAt(s)}i++}return null},getLength:function(){const t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],s=o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t,a=o.getPoints(s);for(let t=0;t<a.length;t++){const i=a[t];n&&n.equals(i)||(e.push(i),n=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(t){Ld.prototype.copy.call(this,t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){const t=Ld.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t},fromJSON:function(t){Ld.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new tf[n.type]).fromJSON(n))}return this}}),nf.prototype=Object.assign(Object.create(ef.prototype),{constructor:nf,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){const n=new Zd(this.currentPoint.clone(),new Bn(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,n,i){const r=new Qd(this.currentPoint.clone(),new Bn(t,e),new Bn(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this},bezierCurveTo:function(t,e,n,i,r,o){const s=new Xd(this.currentPoint.clone(),new Bn(t,e),new Bn(n,i),new Bn(r,o));return this.curves.push(s),this.currentPoint.set(r,o),this},splineThru:function(t){const e=new $d([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,n,i,r,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+s,e+a,n,i,r,o),this},absarc:function(t,e,n,i,r,o){return this.absellipse(t,e,n,n,i,r,o),this},ellipse:function(t,e,n,i,r,o,s,a){const c=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+c,e+l,n,i,r,o,s,a),this},absellipse:function(t,e,n,i,r,o,s,a){const c=new Rd(t,e,n,i,r,o,s,a);if(this.curves.length>0){const t=c.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(c);const l=c.getPoint(1);return this.currentPoint.copy(l),this},copy:function(t){return ef.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){const t=ef.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return ef.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),rf.prototype=Object.assign(Object.create(nf.prototype),{constructor:rf,getPointsHoles:function(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){nf.prototype.copy.call(this,t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this},toJSON:function(){const t=nf.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t},fromJSON:function(t){nf.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new nf).fromJSON(n))}return this}}),of.prototype=Object.assign(Object.create(_i.prototype),{constructor:of,isLight:!0,copy:function(t){return _i.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){const e=_i.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),sf.prototype=Object.assign(Object.create(of.prototype),{constructor:sf,isHemisphereLight:!0,copy:function(t){return of.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(af.prototype,{_projScreenMatrix:new ni,_lightPositionWorld:new Yn,_lookTarget:new Yn,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){const e=this.camera,n=this.matrix,i=this._projScreenMatrix,r=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(t.matrixWorld),e.position.copy(o),r.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(r),e.updateMatrixWorld(),i.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(i),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),cf.prototype=Object.assign(Object.create(af.prototype),{constructor:cf,isSpotLightShadow:!0,updateMatrices:function(t){const e=this.camera,n=2*In.RAD2DEG*t.angle,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),af.prototype.updateMatrices.call(this,t)}}),lf.prototype=Object.assign(Object.create(of.prototype),{constructor:lf,isSpotLight:!0,copy:function(t){return of.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),hf.prototype=Object.assign(Object.create(af.prototype),{constructor:hf,isPointLightShadow:!0,updateMatrices:function(t,e){void 0===e&&(e=0);const n=this.camera,i=this.matrix,r=this._lightPositionWorld,o=this._lookTarget,s=this._projScreenMatrix;r.setFromMatrixPosition(t.matrixWorld),n.position.copy(r),o.copy(n.position),o.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(o),n.updateMatrixWorld(),i.makeTranslation(-r.x,-r.y,-r.z),s.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(s)}}),uf.prototype=Object.assign(Object.create(of.prototype),{constructor:uf,isPointLight:!0,copy:function(t){return of.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),pf.prototype=Object.assign(Object.create(bo.prototype),{constructor:pf,isOrthographicCamera:!0,copy:function(t,e){return bo.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,o=n+t,s=i+e,a=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o=(r+=t*this.view.offsetX)+t*this.view.width,a=(s-=e*this.view.offsetY)-e*this.view.height}this.projectionMatrix.makeOrthographic(r,o,s,a,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){const e=_i.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),df.prototype=Object.assign(Object.create(af.prototype),{constructor:df,isDirectionalLightShadow:!0,updateMatrices:function(t){af.prototype.updateMatrices.call(this,t)}}),ff.prototype=Object.assign(Object.create(of.prototype),{constructor:ff,isDirectionalLight:!0,copy:function(t){return of.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),mf.prototype=Object.assign(Object.create(of.prototype),{constructor:mf,isAmbientLight:!0}),gf.prototype=Object.assign(Object.create(of.prototype),{constructor:gf,isRectAreaLight:!0,copy:function(t){return of.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){const e=of.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),Object.assign(vf.prototype,{isSphericalHarmonics3:!0,set:function(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},zero:function(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,e){const n=t.x,i=t.y,r=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*i),e.addScaledVector(o[2],.488603*r),e.addScaledVector(o[3],.488603*n),e.addScaledVector(o[4],n*i*1.092548),e.addScaledVector(o[5],i*r*1.092548),e.addScaledVector(o[6],.315392*(3*r*r-1)),e.addScaledVector(o[7],n*r*1.092548),e.addScaledVector(o[8],.546274*(n*n-i*i)),e},getIrradianceAt:function(t,e){const n=t.x,i=t.y,r=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],1.023328*i),e.addScaledVector(o[2],1.023328*r),e.addScaledVector(o[3],1.023328*n),e.addScaledVector(o[4],.858086*n*i),e.addScaledVector(o[5],.858086*i*r),e.addScaledVector(o[6],.743125*r*r-.247708),e.addScaledVector(o[7],.858086*n*r),e.addScaledVector(o[8],.429043*(n*n-i*i)),e},add:function(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},addScaledSH:function(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this},scale:function(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},lerp:function(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this},equals:function(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(t,e){void 0===e&&(e=0);const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(t,e+3*i);return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(t,e+3*i);return t}}),Object.assign(vf,{getBasisAt:function(t,e){const n=t.x,i=t.y,r=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-i*i)}}),yf.prototype=Object.assign(Object.create(of.prototype),{constructor:yf,isLightProbe:!0,copy:function(t){return of.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){const e=of.prototype.toJSON.call(this,t);return e.object.sh=this.sh.toArray(),e}}),xf.prototype=Object.assign(Object.create(xd.prototype),{constructor:xf,load:function(t,e,n,i){const r=this,o=new bd(r.manager);o.setPath(r.path),o.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(o){i?i(o):console.error(o),r.manager.itemError(t)}},n,i)},parse:function(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const i=new $p[t.type];if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=(new ur).setHex(t.sheen)),void 0!==t.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&i.specular.setHex(t.specular),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(i.skinning=t.skinning),void 0!==t.morphTargets&&(i.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(i.morphNormals=t.morphNormals),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.vertexTangents&&(i.vertexTangents=t.vertexTangents),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const r in t.uniforms){const e=t.uniforms[r];switch(i.uniforms[r]={},e.type){case"t":i.uniforms[r].value=n(e.value);break;case"c":i.uniforms[r].value=(new ur).setHex(e.value);break;case"v2":i.uniforms[r].value=(new Bn).fromArray(e.value);break;case"v3":i.uniforms[r].value=(new Yn).fromArray(e.value);break;case"v4":i.uniforms[r].value=(new kn).fromArray(e.value);break;case"m3":i.uniforms[r].value=(new Fn).fromArray(e.value);case"m4":i.uniforms[r].value=(new ni).fromArray(e.value);break;default:i.uniforms[r].value=e.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const r in t.extensions)i.extensions[r]=t.extensions[r];if(void 0!==t.shading&&(i.flatShading=1===t.shading),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=n(t.map)),void 0!==t.matcap&&(i.matcap=n(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),i.normalScale=(new Bn).fromArray(e)}return void 0!==t.displacementMap&&(i.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=n(t.specularMap)),void 0!==t.envMap&&(i.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Bn).fromArray(t.clearcoatNormalScale)),i},setTextures:function(t){return this.textures=t,this}});const _f={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,r=t.length;i<r;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(n){return e}},extractUrlBase:function(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};function bf(){zr.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function wf(t,e,n,i){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),br.call(this,t,e,n),this.meshPerAttribute=i||1}function Mf(t){xd.call(this,t)}exports.LoaderUtils=_f,bf.prototype=Object.assign(Object.create(zr.prototype),{constructor:bf,isInstancedBufferGeometry:!0,copy:function(t){return zr.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t=zr.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),wf.prototype=Object.assign(Object.create(br.prototype),{constructor:wf,isInstancedBufferAttribute:!0,copy:function(t){return br.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){const t=br.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),Mf.prototype=Object.assign(Object.create(xd.prototype),{constructor:Mf,load:function(t,e,n,i){const r=this,o=new bd(r.manager);o.setPath(r.path),o.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(o){i?i(o):console.error(o),r.manager.itemError(t)}},n,i)},parse:function(t){const e={},n={};function i(t,i){if(void 0!==e[i])return e[i];const r=t.interleavedBuffers[i],o=function(t,e){if(void 0!==n[e])return n[e];const i=t.arrayBuffers[e],r=new Uint32Array(i).buffer;return n[e]=r,r}(t,r.buffer),s=new _h(new Sf[r.type](o),r.stride);return s.uuid=r.uuid,e[i]=s,s}const r=t.isInstancedBufferGeometry?new bf:new zr,o=t.data.index;if(void 0!==o){const t=new Sf[o.type](o.array);r.setIndex(new br(t,1))}const s=t.data.attributes;for(const h in s){const e=s[h];let n;if(e.isInterleavedBufferAttribute){n=new wh(i(t.data,e.data),e.itemSize,e.offset,e.normalized)}else{const t=new Sf[e.type](e.array);n=new(e.isInstancedBufferAttribute?wf:br)(t,e.itemSize,e.normalized)}void 0!==e.name&&(n.name=e.name),r.setAttribute(h,n)}const a=t.data.morphAttributes;if(a)for(const h in a){const e=a[h],n=[];for(let r=0,o=e.length;r<o;r++){const o=e[r];let s;if(o.isInterleavedBufferAttribute){s=new wh(i(t.data,o.data),o.itemSize,o.offset,o.normalized)}else{s=new br(new Sf[o.type](o.array),o.itemSize,o.normalized)}void 0!==o.name&&(s.name=o.name),n.push(s)}r.morphAttributes[h]=n}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const c=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==c)for(let h=0,u=c.length;h!==u;++h){const t=c[h];r.addGroup(t.start,t.count,t.materialIndex)}const l=t.data.boundingSphere;if(void 0!==l){const t=new Yn;void 0!==l.center&&t.fromArray(l.center),r.boundingSphere=new Gi(t,l.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}});const Sf={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Tf(t){xd.call(this,t)}Tf.prototype=Object.assign(Object.create(xd.prototype),{constructor:Tf,load:function(t,e,n,i){const r=this,o=""===this.path?_f.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||o;const s=new bd(r.manager);s.setPath(this.path),s.load(t,function(n){let o=null;try{o=JSON.parse(n)}catch(a){return void 0!==i&&i(a),void console.error("THREE:ObjectLoader: Can't parse "+t+".",a.message)}const s=o.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?r.parse(o,e):console.error("THREE.ObjectLoader: Can't load "+t)},n,i)},parse:function(t,e){const n=this.parseShape(t.shapes),i=this.parseGeometries(t.geometries,n),r=this.parseImages(t.images,function(){void 0!==e&&e(a)}),o=this.parseTextures(t.textures,r),s=this.parseMaterials(t.materials,o),a=this.parseObject(t.object,i,s);return t.animations&&(a.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(a),a},parseShape:function(t){const e={};if(void 0!==t)for(let n=0,i=t.length;n<i;n++){const i=(new rf).fromJSON(t[n]);e[i.uuid]=i}return e},parseGeometries:function(t,e){const n={};let i;if(void 0!==t){const r=new Mf;for(let o=0,s=t.length;o<s;o++){let s;const a=t[o];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new kp[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new kp[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new kp[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new kp[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new kp[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new kp[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new kp[a.type](a.radius,a.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new kp[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new kp[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new kp[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case"TubeGeometry":case"TubeBufferGeometry":s=new kp[a.type]((new tf[a.path.type]).fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed);break;case"LatheGeometry":case"LatheBufferGeometry":s=new kp[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new kp[a.type](a.vertices,a.indices,a.radius,a.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":i=[];for(let n=0,r=a.shapes.length;n<r;n++){const t=e[a.shapes[n]];i.push(t)}s=new kp[a.type](i,a.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":i=[];for(let n=0,r=a.shapes.length;n<r;n++){const t=e[a.shapes[n]];i.push(t)}const t=a.options.extrudePath;void 0!==t&&(a.options.extrudePath=(new tf[t.type]).fromJSON(t)),s=new kp[a.type](i,a.options);break;case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(a);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+a.type+'"');continue}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),!0===s.isBufferGeometry&&void 0!==a.userData&&(s.userData=a.userData),n[a.uuid]=s}}return n},parseMaterials:function(t,e){const n={},i={};if(void 0!==t){const r=new xf;r.setTextures(e);for(let e=0,o=t.length;e<o;e++){const o=t[e];if("MultiMaterial"===o.type){const t=[];for(let e=0;e<o.materials.length;e++){const i=o.materials[e];void 0===n[i.uuid]&&(n[i.uuid]=r.parse(i)),t.push(n[i.uuid])}i[o.uuid]=t}else void 0===n[o.uuid]&&(n[o.uuid]=r.parse(o)),i[o.uuid]=n[o.uuid]}}return i},parseAnimations:function(t){const e=[];for(let n=0;n<t.length;n++){const i=t[n],r=dd.parse(i);void 0!==i.uuid&&(r.uuid=i.uuid),e.push(r)}return e},parseImages:function(t,e){const n=this,i={};let r;function o(t){return n.manager.itemStart(t),r.load(t,function(){n.manager.itemEnd(t)},void 0,function(){n.manager.itemError(t),n.manager.itemEnd(t)})}if(void 0!==t&&t.length>0){const s=new vd(e);(r=new Td(s)).setCrossOrigin(this.crossOrigin);for(let e=0,r=t.length;e<r;e++){const r=t[e],s=r.url;if(Array.isArray(s)){i[r.uuid]=[];for(let t=0,e=s.length;t<e;t++){const e=s[t],a=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e;i[r.uuid].push(o(a))}}else{const t=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r.url)?r.url:n.resourcePath+r.url;i[r.uuid]=o(t)}}}return i},parseTextures:function(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const i={};if(void 0!==t)for(let r=0,o=t.length;r<o;r++){const o=t[r];let s;void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===e[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image),(s=Array.isArray(e[o.image])?new gc(e[o.image]):new Hn(e[o.image])).needsUpdate=!0,s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.mapping&&(s.mapping=n(o.mapping,Ef)),void 0!==o.offset&&s.offset.fromArray(o.offset),void 0!==o.repeat&&s.repeat.fromArray(o.repeat),void 0!==o.center&&s.center.fromArray(o.center),void 0!==o.rotation&&(s.rotation=o.rotation),void 0!==o.wrap&&(s.wrapS=n(o.wrap[0],Af),s.wrapT=n(o.wrap[1],Af)),void 0!==o.format&&(s.format=o.format),void 0!==o.type&&(s.type=o.type),void 0!==o.encoding&&(s.encoding=o.encoding),void 0!==o.minFilter&&(s.minFilter=n(o.minFilter,Lf)),void 0!==o.magFilter&&(s.magFilter=n(o.magFilter,Lf)),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),void 0!==o.flipY&&(s.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(s.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(s.unpackAlignment=o.unpackAlignment),i[o.uuid]=s}return i},parseObject:function(t,e,n){let i,r,o;function s(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function a(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(n[r])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}switch(t.type){case"Scene":i=new bi,void 0!==t.background&&Number.isInteger(t.background)&&(i.background=new ur(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?i.fog=new xh(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(i.fog=new yh(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":i=new wo(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(i.focus=t.focus),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.filmGauge&&(i.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(i.filmOffset=t.filmOffset),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"OrthographicCamera":i=new pf(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"AmbientLight":i=new mf(t.color,t.intensity);break;case"DirectionalLight":i=new ff(t.color,t.intensity);break;case"PointLight":i=new uf(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":i=new gf(t.color,t.intensity,t.width,t.height);break;case"SpotLight":i=new lf(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":i=new sf(t.color,t.groundColor,t.intensity);break;case"LightProbe":i=(new yf).fromJSON(t);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":i=new ro(r=s(t.geometry),o=a(t.material));break;case"InstancedMesh":r=s(t.geometry),o=a(t.material);const e=t.count,n=t.instanceMatrix;(i=new Qh(r,o,e)).instanceMatrix=new br(new Float32Array(n.array),16);break;case"LOD":i=new Hh;break;case"Line":i=new ru(s(t.geometry),a(t.material),t.mode);break;case"LineLoop":i=new cu(s(t.geometry),a(t.material));break;case"LineSegments":i=new au(s(t.geometry),a(t.material));break;case"PointCloud":case"Points":i=new fu(s(t.geometry),a(t.material));break;case"Sprite":i=new Fh(a(t.material));break;case"Group":i=new ph;break;default:i=new _i}if(i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(i.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(i.matrixAutoUpdate=t.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.rotation&&i.rotation.fromArray(t.rotation),void 0!==t.quaternion&&i.quaternion.fromArray(t.quaternion),void 0!==t.scale&&i.scale.fromArray(t.scale)),void 0!==t.castShadow&&(i.castShadow=t.castShadow),void 0!==t.receiveShadow&&(i.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(i.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(i.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(i.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&i.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(i.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.frustumCulled&&(i.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(i.renderOrder=t.renderOrder),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.layers&&(i.layers.mask=t.layers),void 0!==t.children){const r=t.children;for(let t=0;t<r.length;t++)i.add(this.parseObject(r[t],e,n))}if("LOD"===t.type){void 0!==t.autoUpdate&&(i.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],r=i.getObjectByProperty("uuid",n.object);void 0!==r&&i.addLevel(r,n.distance)}}return i}});const Ef={UVMapping:300,CubeReflectionMapping:rt,CubeRefractionMapping:ot,EquirectangularReflectionMapping:st,EquirectangularRefractionMapping:at,CubeUVReflectionMapping:ct,CubeUVRefractionMapping:lt},Af={RepeatWrapping:ht,ClampToEdgeWrapping:ut,MirroredRepeatWrapping:pt},Lf={NearestFilter:dt,NearestMipmapNearestFilter:ft,NearestMipmapLinearFilter:gt,LinearFilter:yt,LinearMipmapNearestFilter:xt,LinearMipmapLinearFilter:bt};function Rf(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),xd.call(this,t),this.options={premultiplyAlpha:"none"}}function Cf(){this.type="ShapePath",this.color=new ur,this.subPaths=[],this.currentPath=null}function Pf(t){this.type="Font",this.data=t}function Of(t,e,n){const i=Array.from?Array.from(t):String(t).split(""),r=e/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,s=[];let a=0,c=0;for(let l=0;l<i.length;l++){const t=i[l];if("\n"===t)a=0,c-=o;else{const e=Df(t,r,a,c,n);a+=e.offsetX,s.push(e.path)}}return s}function Df(t,e,n,i,r){const o=r.glyphs[t]||r.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+r.familyName+".");const s=new Cf;let a,c,l,h,u,p,d,f;if(o.o){const t=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let r=0,o=t.length;r<o;){switch(t[r++]){case"m":a=t[r++]*e+n,c=t[r++]*e+i,s.moveTo(a,c);break;case"l":a=t[r++]*e+n,c=t[r++]*e+i,s.lineTo(a,c);break;case"q":l=t[r++]*e+n,h=t[r++]*e+i,u=t[r++]*e+n,p=t[r++]*e+i,s.quadraticCurveTo(u,p,l,h);break;case"b":l=t[r++]*e+n,h=t[r++]*e+i,u=t[r++]*e+n,p=t[r++]*e+i,d=t[r++]*e+n,f=t[r++]*e+i,s.bezierCurveTo(u,p,d,f,l,h)}}}return{offsetX:o.ha*e,path:s}}function Nf(t){xd.call(this,t)}let If;Rf.prototype=Object.assign(Object.create(xd.prototype),{constructor:Rf,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=gd.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;fetch(t).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,r.options)}).then(function(n){gd.add(t,n),e&&e(n),r.manager.itemEnd(t)}).catch(function(e){i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}),r.manager.itemStart(t)}}),Object.assign(Cf.prototype,{moveTo:function(t,e){return this.currentPath=new nf,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this},bezierCurveTo:function(t,e,n,i,r,o){return this.currentPath.bezierCurveTo(t,e,n,i,r,o),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function n(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n],r=new rf;r.curves=i.curves,e.push(r)}return e}function i(t,e){const n=e.length;let i=!1;for(let r=n-1,o=0;o<n;r=o++){let n=e[r],s=e[o],a=s.x-n.x,c=s.y-n.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(n=e[o],a=-a,s=e[r],c=-c),t.y<n.y||t.y>s.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=c*(t.x-n.x)-a*(t.y-n.y);if(0===e)return!0;if(e<0)continue;i=!i}}else{if(t.y!==n.y)continue;if(s.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=s.x)return!0}}return i}const r=vp.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return n(o);let s,a,c,l=[];if(1===o.length)return a=o[0],(c=new rf).curves=a.curves,l.push(c),l;let h=!r(o[0].getPoints());h=t?!h:h;const u=[],p=[];let d,f,m=[],g=0;p[g]=void 0,m[g]=[];for(let v=0,y=o.length;v<y;v++)s=r(d=(a=o[v]).getPoints()),(s=t?!s:s)?(!h&&p[g]&&g++,p[g]={s:new rf,p:d},p[g].s.curves=a.curves,h&&g++,m[g]=[]):m[g].push({h:a,p:d[0]});if(!p[0])return n(o);if(p.length>1){let t=!1;const e=[];for(let n=0,i=p.length;n<i;n++)u[n]=[];for(let n=0,r=p.length;n<r;n++){const r=m[n];for(let o=0;o<r.length;o++){const s=r[o];let a=!0;for(let r=0;r<p.length;r++)i(s.p,p[r].p)&&(n!==r&&e.push({froms:n,tos:r,hole:o}),a?(a=!1,u[r].push(s)):t=!0);a&&u[n].push(s)}}e.length>0&&(t||(m=u))}for(let v=0,y=p.length;v<y;v++){c=p[v].s,l.push(c);for(let t=0,e=(f=m[v]).length;t<e;t++)c.holes.push(f[t].h)}return l}}),Object.assign(Pf.prototype,{isFont:!0,generateShapes:function(t,e){void 0===e&&(e=100);const n=[],i=Of(t,e,this.data);for(let r=0,o=i.length;r<o;r++)Array.prototype.push.apply(n,i[r].toShapes());return n}}),Nf.prototype=Object.assign(Object.create(xd.prototype),{constructor:Nf,load:function(t,e,n,i){const r=this,o=new bd(this.manager);o.setPath(this.path),o.load(t,function(t){let n;try{n=JSON.parse(t)}catch(o){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}const i=r.parse(n);e&&e(i)},n,i)},parse:function(t){return new Pf(t)}});const Bf={getContext:function(){return void 0===If&&(If=new(window.AudioContext||window.webkitAudioContext)),If},setContext:function(t){If=t}};function Ff(t){xd.call(this,t)}function Gf(t,e,n){yf.call(this,void 0,n);const i=(new ur).set(t),r=(new ur).set(e),o=new Yn(i.r,i.g,i.b),s=new Yn(r.r,r.g,r.b),a=Math.sqrt(Math.PI),c=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(s).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(s).multiplyScalar(c)}function Uf(t,e){yf.call(this,void 0,e);const n=(new ur).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}exports.AudioContext=Bf,Ff.prototype=Object.assign(Object.create(xd.prototype),{constructor:Ff,load:function(t,e,n,i){const r=this,o=new bd(r.manager);o.setResponseType("arraybuffer"),o.setPath(r.path),o.load(t,function(n){try{const s=n.slice(0);Bf.getContext().decodeAudioData(s,function(t){e(t)})}catch(o){i?i(o):console.error(o),r.manager.itemError(t)}},n,i)}}),Gf.prototype=Object.assign(Object.create(yf.prototype),{constructor:Gf,isHemisphereLightProbe:!0,copy:function(t){return yf.prototype.copy.call(this,t),this},toJSON:function(t){return yf.prototype.toJSON.call(this,t)}}),Uf.prototype=Object.assign(Object.create(yf.prototype),{constructor:Uf,isAmbientLightProbe:!0,copy:function(t){return yf.prototype.copy.call(this,t),this},toJSON:function(t){return yf.prototype.toJSON.call(this,t)}});const zf=new ni,Hf=new ni;function kf(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new wo,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new wo,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Vf(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(kf.prototype,{update:function(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const n=t.projectionMatrix.clone(),i=e.eyeSep/2,r=i*e.near/e.focus,o=e.near*Math.tan(In.DEG2RAD*e.fov*.5)/e.zoom;let s,a;Hf.elements[12]=-i,zf.elements[12]=i,s=-o*e.aspect+r,a=o*e.aspect+r,n.elements[0]=2*e.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(n),s=-o*e.aspect-r,a=o*e.aspect-r,n.elements[0]=2*e.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Hf),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(zf)}}),Object.assign(Vf.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}});const jf=new Yn,Wf=new Wn,qf=new Yn,Xf=new Yn;function Yf(){_i.call(this),this.type="AudioListener",this.context=Bf.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Vf}function Zf(t){_i.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._progress=0,this.filters=[]}Yf.prototype=Object.assign(Object.create(_i.prototype),{constructor:Yf,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(t){_i.prototype.updateMatrixWorld.call(this,t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(jf,Wf,qf),Xf.set(0,0,-1).applyQuaternion(Wf),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(jf.x,t),e.positionY.linearRampToValueAtTime(jf.y,t),e.positionZ.linearRampToValueAtTime(jf.z,t),e.forwardX.linearRampToValueAtTime(Xf.x,t),e.forwardY.linearRampToValueAtTime(Xf.y,t),e.forwardZ.linearRampToValueAtTime(Xf.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition(jf.x,jf.y,jf.z),e.setOrientation(Xf.x,Xf.y,Xf.z,n.x,n.y,n.z)}}),Zf.prototype=Object.assign(Object.create(_i.prototype),{constructor:Zf,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setMediaStreamSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(t){if(void 0===t&&(t=0),!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}});const Jf=new Yn,Qf=new Wn,Kf=new Yn,$f=new Yn;function tm(t){Zf.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function em(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function nm(t,e,n){let i,r,o;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}tm.prototype=Object.assign(Object.create(Zf.prototype),{constructor:tm,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(t){if(_i.prototype.updateMatrixWorld.call(this,t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Jf,Qf,Kf),$f.set(0,0,1).applyQuaternion(Qf);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Jf.x,t),e.positionY.linearRampToValueAtTime(Jf.y,t),e.positionZ.linearRampToValueAtTime(Jf.z,t),e.orientationX.linearRampToValueAtTime($f.x,t),e.orientationY.linearRampToValueAtTime($f.y,t),e.orientationZ.linearRampToValueAtTime($f.z,t)}else e.setPosition(Jf.x,Jf.y,Jf.z),e.setOrientation($f.x,$f.y,$f.z)}}),Object.assign(em.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}),Object.assign(nm.prototype,{accumulate:function(t,e){const n=this.buffer,i=this.valueSize,r=t*i+i;let o=this.cumulativeWeight;if(0===o){for(let t=0;t!==i;++t)n[r+t]=n[t];o=e}else{const t=e/(o+=e);this._mixBufferRegion(n,r,0,t,i)}this.cumulativeWeight=o},accumulateAdditive:function(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t},apply:function(t){const e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(n,i,t,1-r,e)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let a=e,c=e+e;a!==c;++a)if(n[a]!==n[a+e]){s.setValue(n,i);break}},saveOriginalState:function(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let r=n,o=i;r!==o;++r)e[r]=e[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[4*this._addIndex+3]=1},_setAdditiveIdentityOther:function(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]},_select:function(t,e,n,i,r){if(i>=.5)for(let o=0;o!==r;++o)t[e+o]=t[n+o]},_slerp:function(t,e,n,i){Wn.slerpFlat(t,e,t,e,t,n,i)},_slerpAdditive:function(t,e,n,i,r){const o=this._workIndex*r;Wn.multiplyQuaternionsFlat(t,o,t,e,t,n),Wn.slerpFlat(t,e,t,e,t,o,i)},_lerp:function(t,e,n,i,r){const o=1-i;for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]*o+t[n+s]*i}},_lerpAdditive:function(t,e,n,i,r){for(let o=0;o!==r;++o){const r=e+o;t[r]=t[r]+t[n+o]*i}}});const im="\\[\\]\\.:\\/",rm=new RegExp("[\\[\\]\\.:\\/]","g"),om="[^\\[\\]\\.:\\/]",sm="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",am=/((?:WC+[\/:])*)/.source.replace("WC",om),cm=/(WCOD+)?/.source.replace("WCOD",sm),lm=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",om),hm=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",om),um=new RegExp("^"+am+cm+lm+hm+"$"),pm=["material","materials","bones"];function dm(t,e,n){const i=n||fm.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}function fm(t,e,n){this.path=e,this.parsedPath=n||fm.parseTrackName(e),this.node=fm.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function mm(){this.uuid=In.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let n=0,i=arguments.length;n!==i;++n)t[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}function gm(t,e,n,i){this._mixer=t,this._clip=e,this._localRoot=n||null,this.blendMode=i||e.blendMode;const r=e.tracks,o=r.length,s=new Array(o),a={endingStart:He,endingEnd:He};for(let c=0;c!==o;++c){const t=r[c].createInterpolant(null);s[c]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Be,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function vm(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function ym(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function xm(t,e,n){_h.call(this,t,e),this.meshPerAttribute=n||1}function _m(t,e,n,i){this.ray=new qi(t,e),this.near=n||0,this.far=i||1/0,this.camera=null,this.layers=new si,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function bm(t,e){return t.distance-e.distance}function wm(t,e,n,i){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===i){const i=t.children;for(let t=0,r=i.length;t<r;t++)wm(i[t],e,n,!0)}}function Mm(t,e,n){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==n?n:0,this}function Sm(t,e,n){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==n?n:0,this}Object.assign(dm.prototype,{getValue:function(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)},setValue:function(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)},bind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}),Object.assign(fm,{Composite:dm,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new fm.Composite(t,e,n):new fm(t,e,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(rm,"")},parseTrackName:function(t){const e=um.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==pm.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const o=n(r.children);if(o)return o}return null},i=n(t.children);if(i)return i}return null}}),Object.assign(fm.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]},function(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){let t=this.node,e=this.parsedPath,n=e.objectName,i=e.propertyName,r=e.propertyIndex;if(t||(t=fm.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const o=t[i];if(void 0===o){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",t)}let s=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(fm.prototype,{_getValue_unbound:fm.prototype.getValue,_setValue_unbound:fm.prototype.setValue}),Object.assign(mm.prototype,{isAnimationObjectGroup:!0,add:function(){const t=this._objects,e=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,o=r.length;let s=void 0,a=t.length,c=this.nCachedObjects_;for(let l=0,h=arguments.length;l!==h;++l){const h=arguments[l],u=h.uuid;let p=e[u];if(void 0===p){p=a++,e[u]=p,t.push(h);for(let t=0,e=o;t!==e;++t)r[t].push(new fm(h,n[t],i[t]))}else if(p<c){s=t[p];const a=--c,l=t[a];e[l.uuid]=p,t[p]=l,e[u]=a,t[a]=h;for(let t=0,e=o;t!==e;++t){const e=r[t],o=e[a];let s=e[p];e[p]=o,void 0===s&&(s=new fm(h,n[t],i[t])),e[a]=s}}else t[p]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c},remove:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o],a=s.uuid,c=e[a];if(void 0!==c&&c>=r){const o=r++,l=t[o];e[l.uuid]=c,t[c]=l,e[a]=o,t[o]=s;for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[o],r=e[c];e[c]=i,e[o]=r}}}this.nCachedObjects_=r},uncache:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,o=t.length;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s].uuid,c=e[a];if(void 0!==c)if(delete e[a],c<r){const s=--r,a=t[s],l=--o,h=t[l];e[a.uuid]=c,t[c]=a,e[h.uuid]=s,t[s]=h,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[s],r=e[l];e[c]=i,e[s]=r,e.pop()}}else{const r=--o,s=t[r];e[s.uuid]=c,t[c]=s,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t];e[c]=e[r],e.pop()}}}this.nCachedObjects_=r},subscribe_:function(t,e){let n=this._bindingsIndicesByPath,i=n[t],r=this._bindings;if(void 0!==i)return r[i];const o=this._paths,s=this._parsedPaths,a=this._objects,c=a.length,l=this.nCachedObjects_,h=new Array(c);i=r.length,n[t]=i,o.push(t),s.push(e),r.push(h);for(let u=l,p=a.length;u!==p;++u){const n=a[u];h[u]=new fm(n,t,e)}return h},unsubscribe_:function(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const i=this._paths,r=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];e[t[s]]=n,o[n]=a,o.pop(),r[n]=r[s],r.pop(),i[n]=i[s],i.pop()}}}),Object.assign(gm.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,i=t._clip.duration,r=i/n,o=n/i;t.warp(1,r,e),this.warp(o,1,e)}return this},crossFadeTo:function(t,e,n){return t.crossFadeFrom(this,e,n)},stopFading:function(){let t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,n){const i=this._mixer,r=i.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=i._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,c=s.sampleValues;return a[0]=r,a[1]=r+n,c[0]=t/o,c[1]=e/o,this},stopWarping:function(){let t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,n,i){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const i=(t-r)*n;if(i<0||0===n)return;this._startTime=null,e=n*i}e*=this._updateTimeScale(t);const o=this._updateTime(e),s=this._updateWeight(t);if(s>0){const t=this._interpolants,e=this._propertyBindings;switch(this.blendMode){case 2501:for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(o),e[n].accumulateAdditive(s);break;case je:default:for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(o),e[n].accumulate(i,s)}}},_updateWeight:function(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e},_updateTime:function(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,r=this._loopCount;const o=2202===n;if(0===t)return-1===r?i:o&&1==(1&r)?e-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i>=e||i<0){const n=Math.floor(i/e);i-=e*n,r+=Math.abs(n);const s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){const e=t<0;this._setEndings(e,!e,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(o&&1==(1&r))return e-i}return i},_setEndings:function(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=2401,i.endingEnd=2401):(i.endingStart=t?this.zeroSlopeAtStart?2401:He:2402,i.endingEnd=e?this.zeroSlopeAtEnd?2401:He:2402)},_scheduleFading:function(t,e,n){const i=this._mixer,r=i.time;let o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=r,a[0]=e,s[1]=r+t,a[1]=n,this}}),vm.prototype=Object.assign(Object.create(Dn.prototype),{constructor:vm,_bindAction:function(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,o=t._propertyBindings,s=t._interpolants,a=n.uuid,c=this._bindingsByRootAndName;let l=c[a];void 0===l&&(l={},c[a]=l);for(let h=0;h!==r;++h){const t=i[h],r=t.name;let c=l[r];if(void 0!==c)o[h]=c;else{if(void 0!==(c=o[h])){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,a,r));continue}const i=e&&e._propertyBindings[h].binding.parsedPath;++(c=new nm(fm.create(n,r,i),t.ValueTypeName,t.getValueSize())).referenceCount,this._addInactiveBinding(c,a,r),o[h]=c}s[h].resultBuffer=c.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,n){const i=this._actions,r=this._actionsByClip;let o=r[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=o;else{const e=o.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),o.actionByRoot[n]=t},_removeInactiveAction:function(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,o=this._actionsByClip,s=o[r],a=s.knownActions,c=a[a.length-1],l=t._byClipCacheIndex;c._byClipCacheIndex=l,a[l]=c,a.pop(),t._byClipCacheIndex=null,delete s.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete o[r],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){const e=t._propertyBindings;for(let n=0,i=e.length;n!==i;++n){const t=e[n];0==--t.referenceCount&&this._removeInactiveBinding(t)}},_lendAction:function(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_takeBackAction:function(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_addInactiveBinding:function(t,e,n){const i=this._bindingsByRootAndName,r=this._bindings;let o=i[e];void 0===o&&(o={},i[e]=o),o[n]=t,t._cacheIndex=r.length,r.push(t)},_removeInactiveBinding:function(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,s=o[i],a=e[e.length-1],c=t._cacheIndex;a._cacheIndex=c,e[c]=a,e.pop(),delete s[r],0===Object.keys(s).length&&delete o[i]},_lendBinding:function(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_takeBackBinding:function(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_lendControlInterpolant:function(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&((n=new id(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,n){const i=e||this._root,r=i.uuid;let o="string"==typeof t?dd.findByName(i,t):t;const s=null!==o?o.uuid:t;let a=this._actionsByClip[s],c=null;if(void 0===n&&(n=null!==o?o.blendMode:je),void 0!==a){const t=a.actionByRoot[r];if(void 0!==t&&t.blendMode===n)return t;c=a.knownActions[0],null===o&&(o=c._clip)}if(null===o)return null;const l=new gm(this,o,e,n);return this._bindAction(l,c),this._addInactiveAction(l,s,r),l},existingAction:function(t,e){const n=e||this._root,i=n.uuid,r="string"==typeof t?dd.findByName(n,t):t,o=r?r.uuid:t,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[i]||null},stopAllAction:function(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this},update:function(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),o=this._accuIndex^=1;for(let c=0;c!==n;++c){e[c]._update(i,t,r,o)}const s=this._bindings,a=this._nActiveBindings;for(let c=0;c!==a;++c)s[c].apply(o);return this},setTime:function(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const t=r.knownActions;for(let n=0,i=t.length;n!==i;++n){const i=t[n];this._deactivateAction(i);const r=i._cacheIndex,o=e[e.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,o._cacheIndex=r,e[r]=o,e.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}},uncacheRoot:function(t){const e=t.uuid,n=this._actionsByClip;for(const r in n){const t=n[r].actionByRoot[e];void 0!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}const i=this._bindingsByRootAndName[e];if(void 0!==i)for(const r in i){const t=i[r];t.restoreOriginalState(),this._removeInactiveBinding(t)}},uncacheAction:function(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),ym.prototype.clone=function(){return new ym(void 0===this.value.clone?this.value:this.value.clone())},xm.prototype=Object.assign(Object.create(_h.prototype),{constructor:xm,isInstancedInterleavedBuffer:!0,copy:function(t){return _h.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},clone:function(t){const e=_h.prototype.clone.call(this,t);return e.meshPerAttribute=this.meshPerAttribute,e},toJSON:function(t){const e=_h.prototype.toJSON.call(this,t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}),Object.assign(_m.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,n){const i=n||[];return wm(t,this,i,e),i.sort(bm),i},intersectObjects:function(t,e,n){const i=n||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(let r=0,o=t.length;r<o;r++)wm(t[r],this,i,e);return i.sort(bm),i}}),Object.assign(Mm.prototype,{set:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(In.clamp(e/this.radius,-1,1))),this}}),Object.assign(Sm.prototype,{set:function(t,e,n){return this.radius=t,this.theta=e,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}});const Tm=new Bn;function Em(t,e){this.min=void 0!==t?t:new Bn(1/0,1/0),this.max=void 0!==e?e:new Bn(-1/0,-1/0)}Object.assign(Em.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){const n=Tm.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Bn),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Bn),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Bn),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Bn),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return Tm.copy(t).clamp(this.min,this.max).sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});const Am=new Yn,Lm=new Yn;function Rm(t,e){this.start=void 0!==t?t:new Yn,this.end=void 0!==e?e:new Yn}function Cm(t){_i.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}Object.assign(Rm.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Yn),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Yn),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Yn),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,e){Am.subVectors(t,this.start),Lm.subVectors(this.end,this.start);const n=Lm.dot(Lm);let i=Lm.dot(Am)/n;return e&&(i=In.clamp(i,0,1)),i},closestPointToPoint:function(t,e,n){const i=this.closestPointToPointParameter(t,e);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Yn),this.delta(n).multiplyScalar(i).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),Cm.prototype=Object.create(_i.prototype),Cm.prototype.constructor=Cm,Cm.prototype.isImmediateRenderObject=!0;const Pm=new Yn;function Om(t,e){_i.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const n=new zr,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,s=1,a=32;o<a;o++,s++){const t=o/a*Math.PI*2,e=s/a*Math.PI*2;i.push(Math.cos(t),Math.sin(t),1,Math.cos(e),Math.sin(e),1)}n.setAttribute("position",new Rr(i,3));const r=new Kh({fog:!1,toneMapped:!1});this.cone=new au(n,r),this.add(this.cone),this.update()}Om.prototype=Object.create(_i.prototype),Om.prototype.constructor=Om,Om.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Om.prototype.update=function(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Pm.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Pm),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};const Dm=new Yn,Nm=new ni,Im=new ni;function Bm(t){const e=[];t&&t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,Bm(t.children[n]));return e}function Fm(t){const e=Bm(t),n=new zr,i=[],r=[],o=new ur(0,0,1),s=new ur(0,1,0);for(let c=0;c<e.length;c++){const t=e[c];t.parent&&t.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(o.r,o.g,o.b),r.push(s.r,s.g,s.b))}n.setAttribute("position",new Rr(i,3)),n.setAttribute("color",new Rr(r,3));const a=new Kh({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});au.call(this,n,a),this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function Gm(t,e,n){this.light=t,this.light.updateMatrixWorld(),this.color=n;const i=new Ap(e,4,2),r=new yr({wireframe:!0,fog:!1,toneMapped:!1});ro.call(this,i,r),this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}Fm.prototype=Object.create(au.prototype),Fm.prototype.constructor=Fm,Fm.prototype.isSkeletonHelper=!0,Fm.prototype.updateMatrixWorld=function(t){const e=this.bones,n=this.geometry,i=n.getAttribute("position");Im.getInverse(this.root.matrixWorld);for(let r=0,o=0;r<e.length;r++){const t=e[r];t.parent&&t.parent.isBone&&(Nm.multiplyMatrices(Im,t.matrixWorld),Dm.setFromMatrixPosition(Nm),i.setXYZ(o,Dm.x,Dm.y,Dm.z),Nm.multiplyMatrices(Im,t.parent.matrixWorld),Dm.setFromMatrixPosition(Nm),i.setXYZ(o+1,Dm.x,Dm.y,Dm.z),o+=2)}n.getAttribute("position").needsUpdate=!0,_i.prototype.updateMatrixWorld.call(this,t)},Gm.prototype=Object.create(ro.prototype),Gm.prototype.constructor=Gm,Gm.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Gm.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};const Um=new Yn,zm=new ur,Hm=new ur;function km(t,e,n){_i.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new Lu(e);i.rotateY(.5*Math.PI),this.material=new yr({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),o=new Float32Array(3*r.count);i.setAttribute("color",new br(o,3)),this.add(new ro(i,this.material)),this.update()}function Vm(t,e,n,i){t=t||10,e=e||10,n=new ur(void 0!==n?n:4473924),i=new ur(void 0!==i?i:8947848);const r=e/2,o=t/e,s=t/2,a=[],c=[];for(let u=0,p=0,d=-s;u<=e;u++,d+=o){a.push(-s,0,d,s,0,d),a.push(d,0,-s,d,0,s);const t=u===r?n:i;t.toArray(c,p),p+=3,t.toArray(c,p),p+=3,t.toArray(c,p),p+=3,t.toArray(c,p),p+=3}const l=new zr;l.setAttribute("position",new Rr(a,3)),l.setAttribute("color",new Rr(c,3));const h=new Kh({vertexColors:!0,toneMapped:!1});au.call(this,l,h),this.type="GridHelper"}function jm(t,e,n,i,r,o){t=t||10,e=e||16,n=n||8,i=i||64,r=new ur(void 0!==r?r:4473924),o=new ur(void 0!==o?o:8947848);const s=[],a=[];for(let h=0;h<=e;h++){const n=h/e*(2*Math.PI),i=Math.sin(n)*t,c=Math.cos(n)*t;s.push(0,0,0),s.push(i,0,c);const l=1&h?r:o;a.push(l.r,l.g,l.b),a.push(l.r,l.g,l.b)}for(let h=0;h<=n;h++){const e=1&h?r:o,c=t-t/n*h;for(let t=0;t<i;t++){let n=t/i*(2*Math.PI),r=Math.sin(n)*c,o=Math.cos(n)*c;s.push(r,0,o),a.push(e.r,e.g,e.b),n=(t+1)/i*(2*Math.PI),r=Math.sin(n)*c,o=Math.cos(n)*c,s.push(r,0,o),a.push(e.r,e.g,e.b)}}const c=new zr;c.setAttribute("position",new Rr(s,3)),c.setAttribute("color",new Rr(a,3));const l=new Kh({vertexColors:!0,toneMapped:!1});au.call(this,c,l),this.type="PolarGridHelper"}km.prototype=Object.create(_i.prototype),km.prototype.constructor=km,km.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},km.prototype.update=function(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");zm.copy(this.light.color),Hm.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const i=t<n/2?zm:Hm;e.setXYZ(t,i.r,i.g,i.b)}e.needsUpdate=!0}t.lookAt(Um.setFromMatrixPosition(this.light.matrixWorld).negate())},Vm.prototype=Object.assign(Object.create(au.prototype),{constructor:Vm,copy:function(t){return au.prototype.copy.call(this,t),this.geometry.copy(t.geometry),this.material.copy(t.material),this},clone:function(){return(new this.constructor).copy(this)}}),jm.prototype=Object.create(au.prototype),jm.prototype.constructor=jm;const Wm=new Yn,qm=new Yn,Xm=new Yn;function Ym(t,e,n){_i.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);let i=new zr;i.setAttribute("position",new Rr([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new Kh({fog:!1,toneMapped:!1});this.lightPlane=new ru(i,r),this.add(this.lightPlane),(i=new zr).setAttribute("position",new Rr([0,0,0,0,0,1],3)),this.targetLine=new ru(i,r),this.add(this.targetLine),this.update()}Ym.prototype=Object.create(_i.prototype),Ym.prototype.constructor=Ym,Ym.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Ym.prototype.update=function(){Wm.setFromMatrixPosition(this.light.matrixWorld),qm.setFromMatrixPosition(this.light.target.matrixWorld),Xm.subVectors(qm,Wm),this.lightPlane.lookAt(qm),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(qm),this.targetLine.scale.z=Xm.length()};const Zm=new Yn,Jm=new bo;function Qm(t){const e=new zr,n=new Kh({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],o={},s=new ur(16755200),a=new ur(16711680),c=new ur(43775),l=new ur(16777215),h=new ur(3355443);function u(t,e,n){p(t,n),p(e,n)}function p(t,e){i.push(0,0,0),r.push(e.r,e.g,e.b),void 0===o[t]&&(o[t]=[]),o[t].push(i.length/3-1)}u("n1","n2",s),u("n2","n4",s),u("n4","n3",s),u("n3","n1",s),u("f1","f2",s),u("f2","f4",s),u("f4","f3",s),u("f3","f1",s),u("n1","f1",s),u("n2","f2",s),u("n3","f3",s),u("n4","f4",s),u("p","n1",a),u("p","n2",a),u("p","n3",a),u("p","n4",a),u("u1","u2",c),u("u2","u3",c),u("u3","u1",c),u("c","t",l),u("p","c",h),u("cn1","cn2",h),u("cn3","cn4",h),u("cf1","cf2",h),u("cf3","cf4",h),e.setAttribute("position",new Rr(i,3)),e.setAttribute("color",new Rr(r,3)),au.call(this,e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function Km(t,e,n,i,r,o,s){Zm.set(r,o,s).unproject(i);const a=e[t];if(void 0!==a){const t=n.getAttribute("position");for(let e=0,n=a.length;e<n;e++)t.setXYZ(a[e],Zm.x,Zm.y,Zm.z)}}Qm.prototype=Object.create(au.prototype),Qm.prototype.constructor=Qm,Qm.prototype.update=function(){const t=this.geometry,e=this.pointMap;Jm.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Km("c",e,t,Jm,0,0,-1),Km("t",e,t,Jm,0,0,1),Km("n1",e,t,Jm,-1,-1,-1),Km("n2",e,t,Jm,1,-1,-1),Km("n3",e,t,Jm,-1,1,-1),Km("n4",e,t,Jm,1,1,-1),Km("f1",e,t,Jm,-1,-1,1),Km("f2",e,t,Jm,1,-1,1),Km("f3",e,t,Jm,-1,1,1),Km("f4",e,t,Jm,1,1,1),Km("u1",e,t,Jm,.7,1.1,-1),Km("u2",e,t,Jm,-.7,1.1,-1),Km("u3",e,t,Jm,0,2,-1),Km("cf1",e,t,Jm,-1,0,1),Km("cf2",e,t,Jm,1,0,1),Km("cf3",e,t,Jm,0,-1,1),Km("cf4",e,t,Jm,0,1,1),Km("cn1",e,t,Jm,-1,0,-1),Km("cn2",e,t,Jm,1,0,-1),Km("cn3",e,t,Jm,0,-1,-1),Km("cn4",e,t,Jm,0,1,-1),t.getAttribute("position").needsUpdate=!0};const $m=new Ii;function tg(t,e){this.object=t,void 0===e&&(e=16776960);const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new zr;r.setIndex(new br(n,1)),r.setAttribute("position",new br(i,3)),au.call(this,r,new Kh({color:e,toneMapped:!1})),this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}function eg(t,e){this.type="Box3Helper",this.box=t,e=e||16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new zr;i.setIndex(new br(n,1)),i.setAttribute("position",new Rr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),au.call(this,i,new Kh({color:e,toneMapped:!1})),this.type="Box3Helper",this.geometry.computeBoundingSphere()}function ng(t,e,n){this.plane=t,this.size=void 0===e?1:e;const i=void 0!==n?n:16776960,r=new zr;r.setAttribute("position",new Rr([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),ru.call(this,r,new Kh({color:i,toneMapped:!1})),this.type="PlaneHelper";const o=new zr;o.setAttribute("position",new Rr([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new ro(o,new yr({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}tg.prototype=Object.create(au.prototype),tg.prototype.constructor=tg,tg.prototype.update=function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&$m.setFromObject(this.object),$m.isEmpty())return;const e=$m.min,n=$m.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=e.x,r[4]=n.y,r[5]=n.z,r[6]=e.x,r[7]=e.y,r[8]=n.z,r[9]=n.x,r[10]=e.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=e.z,r[15]=e.x,r[16]=n.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=n.x,r[22]=e.y,r[23]=e.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()},tg.prototype.setFromObject=function(t){return this.object=t,this.update(),this},tg.prototype.copy=function(t){return au.prototype.copy.call(this,t),this.object=t.object,this},tg.prototype.clone=function(){return(new this.constructor).copy(this)},eg.prototype=Object.create(au.prototype),eg.prototype.constructor=eg,eg.prototype.updateMatrixWorld=function(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),_i.prototype.updateMatrixWorld.call(this,t))},ng.prototype=Object.create(ru.prototype),ng.prototype.constructor=ng,ng.prototype.updateMatrixWorld=function(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?f:d,this.lookAt(this.plane.normal),_i.prototype.updateMatrixWorld.call(this,t)};const ig=new Yn;let rg,og;function sg(t,e,n,i,r,o){_i.call(this),this.type="ArrowHelper",void 0===t&&(t=new Yn(0,0,1)),void 0===e&&(e=new Yn(0,0,0)),void 0===n&&(n=1),void 0===i&&(i=16776960),void 0===r&&(r=.2*n),void 0===o&&(o=.2*r),void 0===rg&&((rg=new zr).setAttribute("position",new Rr([0,0,0,0,1,0],3)),(og=new Fp(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new ru(rg,new Kh({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ro(og,new yr({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,r,o)}function ag(t){const e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new zr;n.setAttribute("position",new Rr(e,3)),n.setAttribute("color",new Rr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));const i=new Kh({vertexColors:!0,toneMapped:!1});au.call(this,n,i),this.type="AxesHelper"}sg.prototype=Object.create(_i.prototype),sg.prototype.constructor=sg,sg.prototype.setDirection=function(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{ig.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(ig,e)}},sg.prototype.setLength=function(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()},sg.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},sg.prototype.copy=function(t){return _i.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},sg.prototype.clone=function(){return(new this.constructor).copy(this)},ag.prototype=Object.create(au.prototype),ag.prototype.constructor=ag;const cg=4,lg=8,hg=Math.pow(2,lg),ug=[.125,.215,.35,.446,.526,.582],pg=lg-cg+1+ug.length,dg=20,fg={[Ze]:0,[Je]:1,[Ke]:2,[tn]:3,[en]:4,[nn]:5,[Qe]:6},mg=new pf,{_lodPlanes:gg,_sizeLods:vg,_sigmas:yg}=Tg();let xg=null;const _g=(1+Math.sqrt(5))/2,bg=1/_g,wg=[new Yn(1,1,1),new Yn(-1,1,1),new Yn(1,1,-1),new Yn(-1,1,-1),new Yn(0,_g,bg),new Yn(0,_g,-bg),new Yn(bg,0,_g),new Yn(-bg,0,_g),new Yn(_g,bg,0),new Yn(-_g,bg,0)];function Mg(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=Lg(dg),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}function Sg(t){return void 0!==t&&t.type===Mt&&(t.encoding===Ze||t.encoding===Je||t.encoding===Qe)}function Tg(){const t=[],e=[],n=[];let i=lg;for(let r=0;r<pg;r++){const o=Math.pow(2,i);e.push(o);let s=1/o;r>lg-cg?s=ug[r-lg+cg-1]:0==r&&(s=0),n.push(s);const a=1/(o-1),c=-a/2,l=1+a/2,h=[c,c,l,c,l,l,c,c,l,l,c,l],u=6,p=6,d=3,f=2,m=1,g=new Float32Array(d*p*u),v=new Float32Array(f*p*u),y=new Float32Array(m*p*u);for(let t=0;t<u;t++){const e=t%3*2/3-1,n=t>2?0:-1,i=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];g.set(i,d*p*t),v.set(h,f*p*t);const r=[t,t,t,t,t,t];y.set(r,m*p*t)}const x=new zr;x.setAttribute("position",new br(g,d)),x.setAttribute("uv",new br(v,f)),x.setAttribute("faceIndex",new br(y,m)),t.push(x),i>cg&&i--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}function Eg(t){const e=new Vn(3*hg,3*hg,t);return e.texture.mapping=ct,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Ag(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function Lg(t){return new jp({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(t)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new Yn(0,1,0)},inputEncoding:{value:fg[Ze]},outputEncoding:{value:fg[Ze]}},vertexShader:Pg(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n${Og()}\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvec3 getSample(float theta, vec3 axis) {\n\tfloat cosTheta = cos(theta);\n\t// Rodrigues' axis-angle rotation\n\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\treturn bilinearCubeUV(envMap, sampleDirection, mipInt);\n}\n\nvoid main() {\n\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\tif (all(equal(axis, vec3(0.0))))\n\t\taxis = vec3(vOutputDirection.z, 0.0, - vOutputDirection.x);\n\taxis = normalize(axis);\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb += weights[0] * getSample(0.0, axis);\n\tfor (int i = 1; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfloat theta = dTheta * float(i);\n\t\tgl_FragColor.rgb += weights[i] * getSample(-1.0 * theta, axis);\n\t\tgl_FragColor.rgb += weights[i] * getSample(theta, axis);\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:y,depthTest:!1,depthWrite:!1})}function Rg(){return new jp({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new Bn(1,1)},inputEncoding:{value:fg[Ze]},outputEncoding:{value:fg[Ze]}},vertexShader:Pg(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n${Og()}\n\n#include <common>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv = equirectUv( outputDirection );\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:y,depthTest:!1,depthWrite:!1})}function Cg(){return new jp({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:fg[Ze]},outputEncoding:{value:fg[Ze]}},vertexShader:Pg(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n${Og()}\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:y,depthTest:!1,depthWrite:!1})}function Pg(){return"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\n\n// RH coordinate system; PMREM face-indexing convention\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\t} else if (face == 2.0) {\n\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\t} else if (face == 5.0) {\n\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\t}\n\treturn direction;\n}\n\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t"}function Og(){return"\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t"}function Dg(t,e,n,i,r,o,s){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new mr(t,e,n,r,o,s)}Mg.prototype={constructor:Mg,fromScene:function(t,e=0,n=.1,i=100){xg=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r},fromEquirectangular:function(t){return this._fromTexture(t)},fromCubemap:function(t){return this._fromTexture(t)},compileCubemapShader:function(){null===this._cubemapShader&&(this._cubemapShader=Cg(),this._compileMaterial(this._cubemapShader))},compileEquirectangularShader:function(){null===this._equirectShader&&(this._equirectShader=Rg(),this._compileMaterial(this._equirectShader))},dispose:function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<gg.length;t++)gg[t].dispose()},_cleanup:function(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(xg),t.scissorTest=!1,Ag(t,0,0,t.width,t.height)},_fromTexture:function(t){xg=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e},_allocateTargets:function(t){const e={magFilter:dt,minFilter:dt,generateMipmaps:!1,type:Mt,format:zt,encoding:Sg(t)?t.encoding:Ke,depthBuffer:!1,stencilBuffer:!1},n=Eg(e);return n.depthBuffer=!t,this._pingPongRenderTarget=Eg(e),n},_compileMaterial:function(t){const e=new ro(gg[0],t);this._renderer.compile(e,mg)},_sceneToCubeUV:function(t,e,n,i){const r=new wo(90,1,e,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],a=this._renderer,c=a.outputEncoding,l=a.toneMapping,h=a.getClearColor(),u=a.getClearAlpha();a.toneMapping=Q,a.outputEncoding=Ze;let p=t.background;if(p&&p.isColor){p.convertSRGBToLinear();const e=Math.max(p.r,p.g,p.b),n=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);p=p.multiplyScalar(Math.pow(2,-n));const i=(n+128)/255;a.setClearColor(p,i),t.background=null}for(let d=0;d<6;d++){const e=d%3;0==e?(r.up.set(0,o[d],0),r.lookAt(s[d],0,0)):1==e?(r.up.set(0,0,o[d]),r.lookAt(0,s[d],0)):(r.up.set(0,o[d],0),r.lookAt(0,0,s[d])),Ag(i,e*hg,d>2?hg:0,hg,hg),a.setRenderTarget(i),a.render(t,r)}a.toneMapping=l,a.outputEncoding=c,a.setClearColor(h,u)},_textureToCubeUV:function(t,e){const n=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=Cg()):null==this._equirectShader&&(this._equirectShader=Rg());const i=t.isCubeTexture?this._cubemapShader:this._equirectShader,r=new ro(gg[0],i),o=i.uniforms;o.envMap.value=t,t.isCubeTexture||o.texelSize.value.set(1/t.image.width,1/t.image.height),o.inputEncoding.value=fg[t.encoding],o.outputEncoding.value=fg[e.texture.encoding],Ag(e,0,0,3*hg,2*hg),n.setRenderTarget(e),n.render(r,mg)},_applyPMREM:function(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let i=1;i<pg;i++){const e=Math.sqrt(yg[i]*yg[i]-yg[i-1]*yg[i-1]),n=wg[(i-1)%wg.length];this._blur(t,i-1,i,e,n)}e.autoClear=n},_blur:function(t,e,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,i,"latitudinal",r),this._halfBlur(o,t,n,n,i,"longitudinal",r)},_halfBlur:function(t,e,n,i,r,o,s){const a=this._renderer,c=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const l=new ro(gg[i],c),h=c.uniforms,u=vg[n]-1,p=isFinite(r)?Math.PI/(2*u):2*Math.PI/(2*dg-1),d=r/p,f=isFinite(r)?1+Math.floor(3*d):dg;f>dg&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to ${dg}`);const m=[];let g=0;for(let y=0;y<dg;++y){const t=y/d,e=Math.exp(-t*t/2);m.push(e),0==y?g+=e:y<f&&(g+=2*e)}for(let y=0;y<m.length;y++)m[y]=m[y]/g;h.envMap.value=t.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===o,s&&(h.poleAxis.value=s),h.dTheta.value=p,h.mipInt.value=lg-n,h.inputEncoding.value=fg[t.texture.encoding],h.outputEncoding.value=fg[t.texture.encoding];const v=vg[i];Ag(e,3*Math.max(0,hg-2*v),(0===i?0:2*hg)+2*v*(i>lg-cg?i-lg+cg:0),3*v,2*v),a.setRenderTarget(e),a.render(l,mg)}};const Ng=0;exports.LineStrip=0;const Ig=1;exports.LinePieces=1;const Bg=0;exports.NoColors=0;const Fg=1;exports.FaceColors=1;const Gg=2;function Ug(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function zg(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function Hg(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new fu(t,e)}function kg(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Fh(t)}function Vg(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new fu(t,e)}function jg(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new lu(t)}function Wg(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new lu(t)}function qg(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new lu(t)}function Xg(t,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Yn(t,e,n)}function Yg(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new br(t,e).setUsage(Tn)}function Zg(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new wr(t,e)}function Jg(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Mr(t,e)}function Qg(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Sr(t,e)}function Kg(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Tr(t,e)}function $g(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Er(t,e)}function tv(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Ar(t,e)}function ev(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Lr(t,e)}function nv(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Rr(t,e)}function iv(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Cr(t,e)}function rv(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Bd.call(this,t),this.type="catmullrom",this.closed=!0}function ov(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Bd.call(this,t),this.type="catmullrom"}function sv(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Bd.call(this,t),this.type="catmullrom"}function av(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new ag(t)}function cv(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new tg(t,e)}function lv(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new au(new Ip(t.geometry),new Kh({color:void 0!==e?e:16777215}))}function hv(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new au(new _u(t.geometry),new Kh({color:void 0!==e?e:16777215}))}function uv(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new bd(t)}function pv(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Sd(t)}function dv(t,e,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Eo(t,n)}exports.VertexColors=2,Ld.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Ld.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(ef.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=new uo;for(let n=0,i=t.length;n<i;n++){const i=t[n];e.vertices.push(new Yn(i.x,i.y,i.z||0))}return e}}),Object.assign(nf.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),rv.prototype=Object.create(Bd.prototype),ov.prototype=Object.create(Bd.prototype),sv.prototype=Object.create(Bd.prototype),Object.assign(sv.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Vm.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Fm.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(xd.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),_f.extractUrlBase(t)}}),xd.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Tf.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}),Object.assign(Em.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Ii.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Gi.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Co.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Rm.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(In,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),In.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),In.ceilPowerOfTwo(t)}}),Object.assign(Fn.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(ni.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Yn).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,n,i,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,i,n,r,o)}}),Ji.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Wn.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(qi.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(ar.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(ar,{barycoordFromPoint:function(t,e,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),ar.getBarycoord(t,e,n,i,r)},normal:function(t,e,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),ar.getNormal(t,e,n,i)}}),Object.assign(rf.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new _p(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Op(this,t)}}),Object.assign(Bn.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Yn.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(kn.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(uo.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(_i.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(_i.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(ro.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(ro.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Hh.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Wh.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),kh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Ld.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),wo.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(of.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(br.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Tn},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Tn)}}}),Object.assign(br.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Tn:Sn),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(zr.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new br(arguments[1],arguments[2])))},addDrawCall:function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(zr.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(bf.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(_m.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(_h.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Tn},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(_h.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Tn:Sn),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(bp.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(ym.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(vr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ur}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(Xp.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(_o.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(gh.prototype,{clearTarget:function(t,e,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,i)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(gh.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?Je:Ze}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(ah.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Vn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(Zf.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new Ff).load(t,function(t){e.setBuffer(t)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),em.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},To.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};const fv={merge:function(t,e,n){let i;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),i=e.matrix,e=e.geometry),t.merge(e,i,n)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};function mv(){console.error("THREE.CanvasRenderer has been removed")}function gv(){console.error("THREE.JSONLoader has been removed.")}exports.GeometryUtils=fv,Un.crossOrigin=void 0,Un.loadTexture=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new Ad;r.setCrossOrigin(this.crossOrigin);const o=r.load(t,n,void 0,i);return e&&(o.mapping=e),o},Un.loadTextureCube=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new Ed;r.setCrossOrigin(this.crossOrigin);const o=r.load(t,n,void 0,i);return e&&(o.mapping=e),o},Un.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Un.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const vv={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function yv(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}exports.SceneUtils=vv,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"118"}}));
},{}],"vuvU":[function(require,module,exports) {
"use strict";var t=require("three");t.Object3D.prototype.copy=function(t,e){void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder;for(let i in this.userData)this.userData[i]=null;for(let i in t.userData)this.userData[i]=t.userData[i];if(!0===e)for(let i=0;i<t.children.length;i++){const e=t.children[i];this.add(e.clone())}return this};
},{"three":"IV0r"}],"lDF4":[function(require,module,exports) {
"use strict";require("array-flat-polyfill"),require("./util/patch-threejs-copy");
},{"array-flat-polyfill":"R8wO","./util/patch-threejs-copy":"vuvU"}],"ibDZ":[function(require,module,exports) {
"use strict";function e(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function t(e,t=0){const n=new Array(e);for(let r=0;r<e;r++)n[r]=t;return n}function n(t,n){const r=t.indexOf(n);r>=0&&e(t,r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.spliceOne=e,exports.newArray=t,exports.spliceObject=n;
},{}],"iiAR":[function(require,module,exports) {
"use strict";function t(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const e=t=>t,o=()=>void 0,i=!1,s=!1,a=s?new Set:null;class l{constructor(t={}){const{renew:i=e,create:l=o,release:n=e,dispose:h=e,initialCapacity:c,name:r,maxCapacity:p=1/0}=t;this.name=r,s&&a.add(this),this._renew=i.bind(this),this._create=l.bind(this),this._release=n.bind(this),this._dispose=h.bind(this),this.pool=[],this.capacity=0,this.maxCapacity=p,void 0!==c&&this.expand(c)}next(){if(this.pool.length<=0&&this.expand(Math.round(.2*this.capacity)+1),0===this.pool.length)return;const t=this.pool.pop();return this._renew(t),t}release(t){this._release(t),this.pool.push(t)}expand(t=0){t=Math.max(0,Math.min(t,this.maxCapacity-this.capacity));for(let e=0;e<t;e++){const t=this._create();this.pool.push(t)}this.capacity+=t}dispose(){for(let t=0;t<this.pool.length;t++)this._dispose(this.pool[t]);this.pool.length=0,this.capacity=0}log(){const t=this.name?`${this.name} - `:"";console.log(`${t}Capacity: %d, Free: %d, Used: %d`,this.totalCapacity(),this.totalFree(),this.totalUsed())}totalCapacity(){return this.capacity}totalFree(){return this.pool.length}totalUsed(){return this.capacity-this.pool.length}}exports.default=l,t(l,"isObjectPool",!0),s&&(window.logPools=(t=>{a.forEach(e=>{(!t||e.name&&e.name.toLowerCase().includes(t.toLowerCase()))&&(console.log(`Pool ${e.name||"(Untitled)"}:`),console.log("  Total Capacity:",e.totalCapacity()),console.log("  Total Free:",e.totalFree()),console.log("  Total Used:",e.totalUsed()))})}));
},{}],"aOaw":[function(require,module,exports) {
"use strict";function e(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function t(e,t){if(!e)return e;if(!t)return e.slice();t.length=e.length;for(let o=0;o<e.length;o++)t[o]=e[o];return t}function o(e,t){if(!e)return e;if(t)for(let o in t)t.hasOwnProperty(o)&&delete t[o];else t={};for(let o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t}function r(e){return e}function n(e,t){return e?t?t.copy(e):e.clone():e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.copyArray=t,exports.copyObject=o,exports.copyRef=r,exports.copyInstance=n,exports.Data=exports.Value=exports.Tag=exports.Types=exports.cloneObject=exports.cloneArray=exports.cloneRef=exports.cloneInstance=void 0;const s=e=>e&&e.clone();exports.cloneInstance=s;const c=e=>e;exports.cloneRef=c;const i=e=>e&&e.slice();exports.cloneArray=i;const a=e=>Object.assign({},e);exports.cloneObject=a;const l={Object:(e={})=>({initial:e,clone:a,copy:o}),Array:(e=[])=>({initial:e,clone:i,copy:t}),Ref:e=>({initial:e,clone:c,copy:r})};exports.Types=l;class p{}exports.Tag=p,e(p,"isTag",!0);class u extends p{constructor(){super(),y(this.constructor,"value");const e=this.constructor.value;this.value=e.clone(e.initial)}reset(){const e=this.constructor.value;this.value=e.copy(e.initial,this.value)}}exports.Value=u,e(u,"value",l.Ref(null)),e(u,"isValue",!0);class f extends p{constructor(){super();const e=this.constructor.data;for(let t in e)if(e.hasOwnProperty(t)){y(e,t);const o=e[t];this[t]=o.clone(o.initial)}}reset(){const e=this.constructor.data;for(let t in e)if(e.hasOwnProperty(t)){const o=e[t];this[t]=o.copy(o.initial,this[t])}}}function y(e,t){const o=e[t];if(Array.isArray(o))e[t]=l.Array(e[t]);else if("object"==typeof o&&o){if("function"!=typeof o.copy||"function"!=typeof o.clone)throw new Error("The static schema must be a Types value, or a primitive (number, boolean, string, shallow array, null/undefined)")}else e[t]=l.Ref(e[t])}exports.Data=f,e(f,"data",{}),e(f,"isData",!0);
},{}],"ISfH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const t=!1;class e{constructor(t){this.entity=t}get alive(){return!!this.entity&&this.entity.alive}kill(){this.entity&&this.entity.kill()}}class s{constructor(t){this._alive=!1,this._enabled=!0,this._entityManager=t,this.system=null,this.name=null,this.Tags=new Map,this._queuedEvents=0,this._refs=null,this._removeTagInstance=((t,e)=>{(e.isData||e.isValue)&&this._entityManager.releaseTag(e,t)})}ref(){const t=new e(this);return this._refs||(this._refs=[]),this._refs.push(t),t}reset(){this.removeAll(),this.system=null,this._alive=!1,this._enabled=!0,this.name=void 0,this._queuedEvents=0}add(e,s){if(!e)throw new Error("Must specify a Tag");if("function"!=typeof e)throw new Error("Tags must be functions or classes");let i;if(this.has(e)&&this._directRemoveTag(e),e.isData){i=this._entityManager.createTag(e);for(let a in s)if(s.hasOwnProperty(a))if(e.data.hasOwnProperty(a)){const t=e.data[a];i[a]=t.copy(s[a],i[a])}else t&&console.warn(`No property "${a}" found on the Data tag ${e.name}`)}else if(e.isValue){if(i=this._entityManager.createTag(e),void 0!==s){const t=e.value;i.value=t.copy(s,i.value)}}else i=e;return this.Tags.set(e,i),this._tagAdded(e),this}set(e,s){if(this.has(e)){if(e.isData){const i=this.getTag(e);for(let a in s)if(s.hasOwnProperty(a))if(e.data.hasOwnProperty(a)){const t=e.data[a];i[a]=t.copy(s[a],i[a])}else t&&console.warn(`No property "${a}" found on the Data tag ${e.name}`)}else if(e.isValue&&void 0!==s){const t=this.getTag(e),i=e.value;t.value=i.copy(s,t.value)}}else this.add(e,s);return this}_directRemoveTag(t){if(t.isData||t.isValue){const e=this.Tags.get(t);this._entityManager.releaseTag(t,e)}this.Tags.delete(t)}remove(t){return this.has(t)&&(this._directRemoveTag(t),this._tagRemoved(t)),this}removeAll(t){return this.Tags.size>0&&(this.Tags.forEach(this._removeTagInstance),this.Tags.clear(),this._update()),this}get(t){const e=this.getTag(t);return t.isValue?e.value:e}getTag(t){if(!this.has(t))throw new Error(`The Tag ${t.name} is not part of this Entity`);return this.Tags.get(t)}getTagEntries(){return Array.from(this.Tags.entries())}has(t){return this.Tags.has(t)}hasAll(t){for(let e=0;e<t.length;e++){const s=t[e];if(!this.has(s))return!1}return!0}hasAny(t){for(let e=0;e<t.length;e++){const s=t[e];if(this.has(s))return!0}return!1}get alive(){return this._alive}get enabled(){return this._enabled}get processed(){return 0===this._queuedEvents}tagOn(t,e){return this.has(t)||this.add(t,e),this}tagOff(t){return this.remove(t),this}enable(){return this._enabled||(this._enabled=!0,this._update()),this}disable(){return this._enabled&&(this._enabled=!1,this._update()),this}unmanage(){this.system&&(this.system._unmanage(this),this.system=null)}kill(){if(this.system&&this.unmanage(),this._alive&&(this._alive=!1,this._entityManager._markEntityForRemoval(this)),this._refs){for(let t=0;t<this._refs.length;t++)this._refs[t].entity=null;this._refs=null}return this}_tagAdded(t){this._update()}_tagRemoved(t){this._update()}_update(){this._entityManager._onEntityUpdated(this)}}exports.default=s;
},{}],"AXbx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("../util/array");const e=(()=>{const t=new WeakMap;let e=0;return function(s){return t.has(s)||t.set(s,e++),t.get(s)}})();class s{constructor(t,e){this.Tags=t,this.id=e,this._entities=[],this._listeners=null}equals(t){return this.id===t.id}get entities(){return this._entities}get names(){return this.Tags.map(t=>t.name)}_addEntity(t){this._entities.push(t),this._listeners&&this._listeners.forEach(e=>e(t,!0))}_removeEntity(e){const s=this._entities.indexOf(e);s>=0&&((0,t.spliceOne)(this._entities,s),this._listeners&&this._listeners.forEach(t=>t(e,!1)))}_addListener(t){this._listeners||(this._listeners=[]),this._listeners.push(t)}_removeListener(e){this._listeners&&(0,t.spliceObject)(this._listeners,e)}}s.prototype.isQuery=!0;class i{constructor(t){this._entityManager=t,this.queries={}}_buildQueryKey(t){if(Array.isArray(t)){const s=[];for(let i=0;i<t.length;i++)s.push(e(t[i]));return s.sort(),s.join(":")}return String(e(t))}_onEntityUpdated(t){for(let e in this.queries){const s=this.queries[e];this._updateQueryEntity(s,t)}}query(t){if(!t)throw new Error("You must pass a Tag, multiple Tags, or Query object to query()");if(t.isQuery)return t;const e=this._buildQueryKey(t);let i=this.queries[e];if(i)return i;const r=(Array.isArray(t)?t:[t]).filter(Boolean);if(0===r.length)throw new Error("Must specify at least one Tag for query()");const n=new s(r,e);return this._populateQuery(n),this.queries[e]=n,n}_populateQuery(t){for(let e=0;e<this._entityManager.entities.length;e++){const s=this._entityManager.entities[e];this._updateQueryEntity(t,s)}}_shouldEntityExistInQuery(t,e){return e.alive&&e.enabled&&e.hasAll(t.Tags)}_updateQueryEntity(t,e){const s=t.entities.indexOf(e)>=0;let i=this._shouldEntityExistInQuery(t,e);s!==i&&(i?t._addEntity(e):t._removeEntity(e))}}exports.default=i;
},{"../util/array":"ibDZ"}],"GuvG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("../util/ObjectPool")),t=r(require("./Entity")),s=r(require("./QueryManager")),i=require("../util/array");function r(e){return e&&e.__esModule?e:{default:e}}class n extends e.default{constructor(e,t={}){super({...t,initialCapacity:50,name:`TagPool-${e.name}`,create:()=>new e,release(e){"function"==typeof e.reset&&e.reset()}})}}class a extends e.default{constructor(e,s={}){super({...s,name:"Entities",create:()=>new t.default(e),release(e){e.reset()}})}}class o{constructor({initialCapacity:e=0}={}){this._entities=[],this._entitiesToRemove=[],this._tagPools=new Map,this._entityPool=new a(this,{initialCapacity:e}),this._queryManager=new s.default(this)}query(e){return this._queryManager.query(e)}get entities(){return this._entities}entity(e,t){const s=this._entityPool.next();return s.reset(),s._alive=!0,s.name=e,s.system=t||null,this._entities.push(s),s}flush(){const e=this._entitiesToRemove;for(let t=e.length-1;t>=0;t--){const s=e[t];s.processed&&((0,i.spliceObject)(this._entities,s),s.removeAll(),this._entityPool.release(s),(0,i.spliceOne)(e,t))}}createTag(e){return this.getTagPool(e).next()}getTagPool(e){let t=this._tagPools.get(e);return t||(t=new n(e),this._tagPools.set(e,t)),t}releaseTag(e,t){const s=this._tagPools.get(e);s&&s.release(t)}_onEntityUpdated(e){this._queryManager._onEntityUpdated(e)}_markEntityForRemoval(e){this._entitiesToRemove.push(e),this._onEntityUpdated(e)}}exports.default=o;
},{"../util/ObjectPool":"iiAR","./Entity":"ISfH","./QueryManager":"AXbx","../util/array":"ibDZ"}],"kjG6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=s(require("../util/ObjectPool")),t=require("../util/array");function s(e){return e&&e.__esModule?e:{default:e}}class i{constructor(){this.entity=null,this.active=!0,this.added=!1}reset(e,t){this.entity=e,this.added=t,this.active=!0}prepare(){this.entity._queuedEvents++}process(){this.active&&(this.active=!1,this.entity._queuedEvents--)}}class h extends e.default{constructor(e={}){super({...e,name:"QueryEvent",create:()=>new i})}}class r{constructor(e){this.added=[],this.removing=[],this.changed=!1,this.query=e}dispose(){}}class n{constructor(e){this._eventPool=new h,this._unprocessed_queue=[],this.state=new r(e),this._attach()}_nextQueuedMatching(e){for(let t=0;t<this._unprocessed_queue.length;t++){const s=this._unprocessed_queue[t];if(s.active&&s.entity===e)return s}return null}_attach(){if(!this._handler){this._handler=((e,t)=>{const s=this._eventPool.next();s.reset(e,t),s.prepare(),this._unprocessed_queue.push(s)}),this.state.query._addListener(this._handler);for(let e=0;e<this.state.query.entities.length;e++){const t=this.state.query.entities[e];this._handler(t,!0)}}}detach(){this.poll(),this.flush(),this._handler&&(this.state.query._removeListener(this._handler),this._handler=null)}flush(){return this.state.added.length=0,this.state.removing.length=0,this.state.changed=!1,this}poll(){for(let e=0;e<this._unprocessed_queue.length;e++){const t=this._unprocessed_queue[e];t.active&&(t.process(),t.added?this.state.added.push(t.entity):this.state.removing.push(t.entity),this._eventPool.release(t),this.state.changed=!0)}return this._unprocessed_queue.length=0,this}}exports.default=n;
},{"../util/ObjectPool":"iiAR","../util/array":"ibDZ"}],"YyoG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=f,exports.Config=void 0;var t=require("../util/array"),e=r(require("../util/ObjectPool")),s=require("./tag"),i=r(require("./EntityManager")),n=r(require("./QueryListener"));function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const h=!1,l=!1;function a(t){t()}function u(t){t.forEach(a)}function c(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then}function f(t={}){return new b(t)}function g(t){return`[${t.names.join(",")}]`}function y(t,e){if(0===e.length)throw new Error(`No singleton by the query ${g(t)}`);if(e.length>1)throw new Error(`Expected singleton, but found multiple entities by the query "${g(t)}`)}function m(t){const e=t.entities;return 1!==e.length&&y(t,e),e[0]}class _ extends s.Data{}exports.Config=_,o(_,"data",{props:s.Types.Ref(),component:s.Types.Ref(),system:s.Types.Ref(),instance:s.Types.Ref()});class d{constructor(t){this.query=t,this.view=t.entities.slice()}}function p(t,e){for(let s=0;s<t.length;s++)e[s]=t[s];e.length=t.length}class w{constructor(t,e){this.world=t,this.loading=!0,this.loaded=!1,this.promise=void 0,this.enabled=!0,this._info={name:void 0},this.System=e,this.instance=null,this._children=null,this._listeners=null,this._views=null}get name(){return this.info().name||this.System.name||"UntitledSystem"}info(){return 0===arguments.length?this._info:(Object.assign(this._info,arguments[0]),this)}_manage(t){this._children||(this._children=[]),this._children.push(t)}_unmanage(e){this._children&&(0,t.spliceObject)(this._children,e)}_dispose(){const t=this._listeners;if(t){for(let e=0;e<t.length;e++)t[e].detach();t.length=0}if(this._children)for(let e=this._children.length-1;e>=0;e--){const t=this._children[e];t.system=null,t.kill()}this._listeners=null,this._views=null,this._children=null}_poll(){if(this._views)for(let t=0;t<this._views.length;t++){const e=this._views[t];p(e.query.entities,e.view)}if(this._listeners)for(let t=0;t<this._listeners.length;t++)this._listeners[t].poll()}_flush(){if(this._listeners)for(let t=0;t<this._listeners.length;t++)this._listeners[t].flush()}}class S{constructor(t,e){this.root=t,this._system=e}subscribe(e){const s=this.root._subscribers;let i=()=>e(this._getSystemList());return s.push(i),i(),function(){i&&(0,t.spliceObject)(s,i),i=null}}get system(){return this._system}_fragment(t){return new S(this.root,t)}_getSystemList(){return this.root._systemList}_getSystemMap(){return this.root._systemMap}_getEntityManager(){return this.root._entityManager}_getConfigurations(){return this.root._configurations}view(t){if(!this.system)throw new Error("Must call world.view() from a world fragment passed into a System");const e=this.root.query(t),s=new d(e),i=this.system;return i._views||(i._views=[]),i._views.push(s),s.view}listen(e){if(!this.system)throw new Error("Must call world.view() from a world fragment passed into a System");if(!e)throw new Error("Must specify Tag, Tags, or Query object to world.listen()");let s=this.root.query(e),i=new n.default(s);const r=this.system;r._listeners||(r._listeners=[]);const o=r._listeners;o.push(i);const h=i.state;return h.dispose=(()=>{i.detach(),o&&(0,t.spliceObject)(o,i),s=i=null}),h}tag(t,e){const s=this.system;if(!s)throw new Error("Must call world.tag() from a world fragment passed into a System");let i=null;return this.entity(i,!0).add(t,e).get(t)}entity(t,e){if(this.system&&!1!==e){const e=this._getEntityManager().entity(t,this.system);return this.system._manage(e),e}return this._getEntityManager().entity(t)}query(t){return this._getEntityManager().query(t)}matching(t){return this.query(t).entities.slice()}findEntity(t){const e=this.query(t);return e.entities.length>0?e.entities[0]:null}findTag(t){const e=this.query(t);if(1!==e.Tags.length)throw new Error("find() only accepts a query with one Tag, use findEntity() to match against multiple Tags");return e.entities.length>0?e.entities[0].get(e.Tags[0]):null}get entities(){return this._getEntityManager().entities}hasSystem(t){return this._getSystemMap().has(t)}getSystem(t){return this._getSystemMap().get(t)}getAllSystems(){return this._getSystemList()}removeAllSystems(){const t=this._getSystemList();for(let e=t.length-1;e>=0;e--){const s=t[e].System;this.removeSystem(s)}}setConfig(t,e={}){this._getConfigurations().set(t,e)}hasConfig(t){return this._getConfigurations().has(t)}getConfig(t){return this._getConfigurations().get(t)}removeConfig(t){this.hasConfig(t)&&this._getConfigurations().delete(t)}addSystem(t,e={}){if("function"!=typeof t)throw new Error("The first parameter of addSystem() must be a function");if(this.hasSystem(t))throw new Error(`The World already registered the System "${t.name}"`);const s=this._getSystemList(),i=this._getSystemMap();l&&s.some(e=>e.System.name===t.name)&&console.warn(`⚠️ You already have a different System registered by the name "${t.name}", maybe you forgot to rename it?`);const n=new w(this,t);s.push(n),i.set(t,n);const r=this._fragment(n);let o=t(r,e);return c(o)?(o=o.then(t=>(n.instance=t,n.loading=!1,n.loaded=!0,n)),n.promise=o):(n.instance=o,n.promise=Promise.resolve(n),n.loading=!1,n.loaded=!0),u(this.root._subscribers),n.promise}removeSystem(e){if("function"!=typeof e)throw new Error("The first parameter of removeSystem() must be a function");if(!this.hasSystem(e))return void console.warn(`Trying to unregister the System "${e.name}" that is no longer in this World`);const s=this._getSystemList(),i=this._getSystemMap(),n=i.get(e);i.delete(e),(0,t.spliceObject)(s,n),n.instance&&"function"==typeof n.instance.dispose&&n.instance.dispose(),n._dispose(),u(this.root._subscribers)}process(t){const e=this._getSystemList();for(let s=0;s<e.length;s++){const i=e[s],n=i.instance;i.loaded&&(i._poll(),n&&i.enabled&&("function"==typeof n?n(t):"function"==typeof n.process&&n.process(t)),i._flush())}this._getEntityManager().flush()}}class b extends S{constructor({initialCapacity:t=0}={}){super(),this.root=this,this._configurations=new Map,this._entityManager=new i.default({initialCapacity:t}),this._systemMap=new Map,this._systemList=[],this._subscribers=[]}}
},{"../util/array":"ibDZ","../util/ObjectPool":"iiAR","./tag":"aOaw","./EntityManager":"GuvG","./QueryListener":"kjG6"}],"beHZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"createWorld",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(exports,"Tag",{enumerable:!0,get:function(){return r.Tag}}),Object.defineProperty(exports,"Data",{enumerable:!0,get:function(){return r.Data}}),Object.defineProperty(exports,"Value",{enumerable:!0,get:function(){return r.Value}}),Object.defineProperty(exports,"Types",{enumerable:!0,get:function(){return r.Types}}),Object.defineProperty(exports,"copyArray",{enumerable:!0,get:function(){return r.copyArray}}),Object.defineProperty(exports,"copyInstance",{enumerable:!0,get:function(){return r.copyInstance}}),Object.defineProperty(exports,"copyRef",{enumerable:!0,get:function(){return r.copyRef}}),Object.defineProperty(exports,"copyObject",{enumerable:!0,get:function(){return r.copyObject}}),Object.defineProperty(exports,"cloneArray",{enumerable:!0,get:function(){return r.cloneArray}}),Object.defineProperty(exports,"cloneInstance",{enumerable:!0,get:function(){return r.cloneInstance}}),Object.defineProperty(exports,"cloneRef",{enumerable:!0,get:function(){return r.cloneRef}}),Object.defineProperty(exports,"cloneObject",{enumerable:!0,get:function(){return r.cloneObject}});var e=t(require("./World")),r=require("./tag");function t(e){return e&&e.__esModule?e:{default:e}}
},{"./World":"YyoG","./tag":"aOaw"}],"xeIE":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];function e(){}Object.defineProperty(exports,"__esModule",{value:!0}),exports.action_destroyer=O,exports.add_attribute=Ye,exports.add_classes=Je,exports.add_flush_callback=ie,exports.add_location=s,exports.add_render_callback=se,exports.add_resize_listener=vt,exports.add_transform=Pt,exports.afterUpdate=Ht,exports.append=L,exports.append_dev=on,exports.assign=o,exports.attr=tt,exports.attr_dev=pn,exports.attribute_to_object=St,exports.beforeUpdate=Bt,exports.bind=Ge,exports.blank_object=c,exports.bubble=Kt,exports.check_outros=me,exports.children=ut,exports.claim_component=Qe,exports.claim_element=lt,exports.claim_space=pt,exports.claim_text=at,exports.clear_loops=N,exports.component_subscribe=x,exports.compute_rest_props=F,exports.compute_slots=w,exports.createEventDispatcher=Ut,exports.create_animation=Rt,exports.create_bidirectional_transition=Fe,exports.create_component=Ke,exports.create_in_transition=$e,exports.create_out_transition=ve,exports.create_slot=m,exports.create_ssr_component=Ue,exports.custom_event=wt,exports.dataset_dev=dn,exports.debug=Ie,exports.destroy_block=Ee,exports.destroy_component=Xe,exports.destroy_each=I,exports.detach=B,exports.detach_after_dev=ln,exports.detach_before_dev=un,exports.detach_between_dev=cn,exports.detach_dev=sn,exports.dispatch_dev=nn,exports.each=Le,exports.element=H,exports.element_is=W,exports.empty=K,exports.escape=Pe,exports.exclude_internal_props=v,exports.fix_and_destroy_block=Ce,exports.fix_and_outro_and_destroy_block=Oe,exports.fix_position=Nt,exports.flush=le,exports.getContext=Jt,exports.get_binding_group_value=st,exports.get_current_component=zt,exports.get_custom_elements_slots=Ct,exports.get_slot_changes=g,exports.get_slot_context=b,exports.get_spread_object=Me,exports.get_spread_update=Ae,exports.get_store_value=h,exports.group_outros=xe,exports.handle_promise=we,exports.hasContext=Gt,exports.init=tn,exports.insert=z,exports.insert_dev=rn,exports.is_crossorigin=$t,exports.is_empty=f,exports.is_function=l,exports.is_promise=r,exports.listen=Q,exports.listen_dev=an,exports.loop=P,exports.loop_guard=gn,exports.mount_component=Ve,exports.noop=e,exports.not_equal=p,exports.null_to_empty=E,exports.object_without_properties=U,exports.onDestroy=Wt,exports.onMount=It,exports.once=k,exports.outro_and_destroy_block=Se,exports.prevent_default=V,exports.prop_dev=fn,exports.query_selector_all=kt,exports.run=i,exports.run_all=u,exports.safe_not_equal=a,exports.schedule_update=oe,exports.select_multiple_value=gt,exports.select_option=xt,exports.select_options=mt,exports.select_value=bt,exports.self=Z,exports.setContext=Yt,exports.set_attributes=et,exports.set_current_component=Lt,exports.set_custom_element_data=ot,exports.set_data=ft,exports.set_data_dev=_n,exports.set_input_type=_t,exports.set_input_value=dt,exports.set_now=M,exports.set_raf=T,exports.set_store_value=S,exports.set_style=ht,exports.set_svg_attributes=nt,exports.space=G,exports.spread=Re,exports.stop_propagation=X,exports.subscribe=_,exports.svg_element=Y,exports.text=J,exports.tick=re,exports.time_ranges_to_array=ct,exports.to_number=it,exports.toggle_class=Ft,exports.transition_in=be,exports.transition_out=ge,exports.update_keyed_each=De,exports.update_slot=y,exports.update_slot_spread=$,exports.validate_component=Be,exports.validate_each_argument=hn,exports.validate_each_keys=je,exports.validate_slots=xn,exports.validate_store=d,exports.xlink_attr=rt,exports.raf=exports.now=exports.missing_component=exports.is_client=exports.invalid_attribute_name_character=exports.intros=exports.identity=exports.has_prop=exports.globals=exports.escaped=exports.dirty_components=exports.current_component=exports.binding_callbacks=exports.SvelteElement=exports.SvelteComponentTyped=exports.SvelteComponentDev=exports.SvelteComponent=exports.HtmlTag=void 0;const n=t=>t;function o(t,e){for(const n in e)t[n]=e[n];return t}function r(t){return t&&"object"==typeof t&&"function"==typeof t.then}function s(t,e,n,o,r){t.__svelte_meta={loc:{file:e,line:n,column:o,char:r}}}function i(t){return t()}function c(){return Object.create(null)}function u(t){t.forEach(i)}function l(t){return"function"==typeof t}function a(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function p(t,e){return t!=t?e==e:t!==e}function f(t){return 0===Object.keys(t).length}function d(t,e){if(null!=t&&"function"!=typeof t.subscribe)throw new Error(`'${e}' is not a store with a 'subscribe' method`)}function _(t,...n){if(null==t)return e;const o=t.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function h(t){let e;return _(t,t=>e=t)(),e}function x(t,e,n){t.$$.on_destroy.push(_(e,n))}function m(t,e,n,o){if(t){const r=b(t,e,n,o);return t[0](r)}}function b(t,e,n,r){return t[1]&&r?o(n.ctx.slice(),t[1](r(e))):n.ctx}function g(t,e,n,o){if(t[2]&&o){const r=t[2](o(n));if(void 0===e.dirty)return r;if("object"==typeof r){const t=[],n=Math.max(e.dirty.length,r.length);for(let o=0;o<n;o+=1)t[o]=e.dirty[o]|r[o];return t}return e.dirty|r}return e.dirty}function y(t,e,n,o,r,s,i){const c=g(e,o,r,s);if(c){const r=b(e,n,o,i);t.p(r,c)}}function $(t,e,n,o,r,s,i,c){const u=i(r)|g(e,o,r,s);if(u){const r=b(e,n,o,c);t.p(r,u)}}function v(t){const e={};for(const n in t)"$"!==n[0]&&(e[n]=t[n]);return e}function F(t,e){const n={};e=new Set(e);for(const o in t)e.has(o)||"$"===o[0]||(n[o]=t[o]);return n}function w(t){const e={};for(const n in t)e[n]=!0;return e}function k(t){let e=!1;return function(...n){e||(e=!0,t.call(this,...n))}}function E(t){return null==t?"":t}function S(t,e,n=e){return t.set(n),e}exports.identity=n;const C=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);function O(t){return t&&l(t.destroy)?t.destroy:e}exports.has_prop=C;const D="undefined"!=typeof window;exports.is_client=D;let j=D?()=>window.performance.now():()=>Date.now();exports.now=j;let A=D?t=>requestAnimationFrame(t):e;function M(t){exports.now=j=t}function T(t){exports.raf=A=t}exports.raf=A;const q=new Set;function R(t){q.forEach(e=>{e.c(t)||(q.delete(e),e.f())}),0!==q.size&&A(R)}function N(){q.clear()}function P(t){let e;return 0===q.size&&A(R),{promise:new Promise(n=>{q.add(e={c:t,f:n})}),abort(){q.delete(e)}}}function L(t,e){t.appendChild(e)}function z(t,e,n){t.insertBefore(e,n||null)}function B(t){t.parentNode.removeChild(t)}function I(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function H(t){return document.createElement(t)}function W(t,e){return document.createElement(t,{is:e})}function U(t,e){const n={};for(const o in t)C(t,o)&&-1===e.indexOf(o)&&(n[o]=t[o]);return n}function Y(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function J(t){return document.createTextNode(t)}function G(){return J(" ")}function K(){return J("")}function Q(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function V(t){return function(e){return e.preventDefault(),t.call(this,e)}}function X(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function Z(t){return function(e){e.target===this&&t.call(this,e)}}function tt(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function et(t,e){const n=Object.getOwnPropertyDescriptors(t.__proto__);for(const o in e)null==e[o]?t.removeAttribute(o):"style"===o?t.style.cssText=e[o]:"__value"===o?t.value=t[o]=e[o]:n[o]&&n[o].set?t[o]=e[o]:tt(t,o,e[o])}function nt(t,e){for(const n in e)tt(t,n,e[n])}function ot(t,e,n){e in t?t[e]=n:tt(t,e,n)}function rt(t,e,n){t.setAttributeNS("http://www.w3.org/1999/xlink",e,n)}function st(t,e,n){const o=new Set;for(let r=0;r<t.length;r+=1)t[r].checked&&o.add(t[r].__value);return n||o.delete(e),Array.from(o)}function it(t){return""===t?null:+t}function ct(t){const e=[];for(let n=0;n<t.length;n+=1)e.push({start:t.start(n),end:t.end(n)});return e}function ut(t){return Array.from(t.childNodes)}function lt(t,e,n,o){for(let r=0;r<t.length;r+=1){const o=t[r];if(o.nodeName===e){let e=0;const s=[];for(;e<o.attributes.length;){const t=o.attributes[e++];n[t.name]||s.push(t.name)}for(let t=0;t<s.length;t++)o.removeAttribute(s[t]);return t.splice(r,1)[0]}}return o?Y(e):H(e)}function at(t,e){for(let n=0;n<t.length;n+=1){const o=t[n];if(3===o.nodeType)return o.data=""+e,t.splice(n,1)[0]}return J(e)}function pt(t){return at(t," ")}function ft(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function dt(t,e){t.value=null==e?"":e}function _t(t,e){try{t.type=e}catch(n){}}function ht(t,e,n,o){t.style.setProperty(e,n,o?"important":"")}function xt(t,e){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];if(o.__value===e)return void(o.selected=!0)}}function mt(t,e){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];o.selected=~e.indexOf(o.__value)}}function bt(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function gt(t){return[].map.call(t.querySelectorAll(":checked"),t=>t.__value)}let yt;function $t(){if(void 0===yt){yt=!1;try{"undefined"!=typeof window&&window.parent&&window.parent.document}catch(t){yt=!0}}return yt}function vt(t,e){const n=getComputedStyle(t),o=(parseInt(n.zIndex)||0)-1;"static"===n.position&&(t.style.position="relative");const r=H("iframe");r.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; "+`overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: ${o};`),r.setAttribute("aria-hidden","true"),r.tabIndex=-1;const s=$t();let i;return s?(r.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",i=Q(window,"message",t=>{t.source===r.contentWindow&&e()})):(r.src="about:blank",r.onload=(()=>{i=Q(r.contentWindow,"resize",e)})),L(t,r),()=>{s?i():i&&r.contentWindow&&i(),B(r)}}function Ft(t,e,n){t.classList[n?"add":"remove"](e)}function wt(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}function kt(t,e=document.body){return Array.from(e.querySelectorAll(t))}class Et{constructor(t=null){this.a=t,this.e=this.n=null}m(t,e,n=null){this.e||(this.e=H(e.nodeName),this.t=e,this.h(t)),this.i(n)}h(t){this.e.innerHTML=t,this.n=Array.from(this.e.childNodes)}i(t){for(let e=0;e<this.n.length;e+=1)z(this.t,this.n[e],t)}p(t){this.d(),this.h(t),this.i(this.a)}d(){this.n.forEach(B)}}function St(t){const e={};for(const n of t)e[n.name]=n.value;return e}function Ct(t){const e={};return t.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}exports.HtmlTag=Et;const Ot=new Set;let Dt,jt=0;function At(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function Mt(t,e,n,o,r,s,i,c=0){const u=16.666/o;let l="{\n";for(let x=0;x<=1;x+=u){const t=e+(n-e)*s(x);l+=100*x+`%{${i(t,1-t)}}\n`}const a=l+`100% {${i(n,1-n)}}\n}`,p=`__svelte_${At(a)}_${c}`,f=t.ownerDocument;Ot.add(f);const d=f.__svelte_stylesheet||(f.__svelte_stylesheet=f.head.appendChild(H("style")).sheet),_=f.__svelte_rules||(f.__svelte_rules={});_[p]||(_[p]=!0,d.insertRule(`@keyframes ${p} ${a}`,d.cssRules.length));const h=t.style.animation||"";return t.style.animation=`${h?`${h}, `:""}${p} ${o}ms linear ${r}ms 1 both`,jt+=1,p}function Tt(t,e){const n=(t.style.animation||"").split(", "),o=n.filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")),r=n.length-o.length;r&&(t.style.animation=o.join(", "),(jt-=r)||qt())}function qt(){A(()=>{jt||(Ot.forEach(t=>{const e=t.__svelte_stylesheet;let n=e.cssRules.length;for(;n--;)e.deleteRule(n);t.__svelte_rules={}}),Ot.clear())})}function Rt(t,o,r,s){if(!o)return e;const i=t.getBoundingClientRect();if(o.left===i.left&&o.right===i.right&&o.top===i.top&&o.bottom===i.bottom)return e;const{delay:c=0,duration:u=300,easing:l=n,start:a=j()+c,end:p=a+u,tick:f=e,css:d}=r(t,{from:o,to:i},s);let _,h=!0,x=!1;function m(){d&&Tt(t,_),h=!1}return P(t=>{if(!x&&t>=a&&(x=!0),x&&t>=p&&(f(1,0),m()),!h)return!1;if(x){const e=0+1*l((t-a)/u);f(e,1-e)}return!0}),d&&(_=Mt(t,0,1,u,c,l,d)),c||(x=!0),f(0,1),m}function Nt(t){const e=getComputedStyle(t);if("absolute"!==e.position&&"fixed"!==e.position){const{width:n,height:o}=e,r=t.getBoundingClientRect();t.style.position="absolute",t.style.width=n,t.style.height=o,Pt(t,r)}}function Pt(t,e){const n=t.getBoundingClientRect();if(e.left!==n.left||e.top!==n.top){const o=getComputedStyle(t),r="none"===o.transform?"":o.transform;t.style.transform=`${r} translate(${e.left-n.left}px, ${e.top-n.top}px)`}}function Lt(t){exports.current_component=Dt=t}function zt(){if(!Dt)throw new Error("Function called outside component initialization");return Dt}function Bt(t){zt().$$.before_update.push(t)}function It(t){zt().$$.on_mount.push(t)}function Ht(t){zt().$$.after_update.push(t)}function Wt(t){zt().$$.on_destroy.push(t)}function Ut(){const t=zt();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const r=wt(e,n);o.slice().forEach(e=>{e.call(t,r)})}}}function Yt(t,e){zt().$$.context.set(t,e)}function Jt(t){return zt().$$.context.get(t)}function Gt(t){return zt().$$.context.has(t)}function Kt(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(t=>t(e))}exports.current_component=Dt;const Qt=[];exports.dirty_components=Qt;const Vt={enabled:!1};exports.intros=Vt;const Xt=[];exports.binding_callbacks=Xt;const Zt=[],te=[],ee=Promise.resolve();let ne=!1;function oe(){ne||(ne=!0,ee.then(le))}function re(){return oe(),ee}function se(t){Zt.push(t)}function ie(t){te.push(t)}let ce=!1;const ue=new Set;function le(){if(!ce){ce=!0;do{for(let t=0;t<Qt.length;t+=1){const e=Qt[t];Lt(e),ae(e.$$)}for(Lt(null),Qt.length=0;Xt.length;)Xt.pop()();for(let t=0;t<Zt.length;t+=1){const e=Zt[t];ue.has(e)||(ue.add(e),e())}Zt.length=0}while(Qt.length);for(;te.length;)te.pop()();ne=!1,ce=!1,ue.clear()}}function ae(t){if(null!==t.fragment){t.update(),u(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(se)}}let pe;function fe(){return pe||(pe=Promise.resolve()).then(()=>{pe=null}),pe}function de(t,e,n){t.dispatchEvent(wt(`${e?"intro":"outro"}${n}`))}const _e=new Set;let he;function xe(){he={r:0,c:[],p:he}}function me(){he.r||u(he.c),he=he.p}function be(t,e){t&&t.i&&(_e.delete(t),t.i(e))}function ge(t,e,n,o){if(t&&t.o){if(_e.has(t))return;_e.add(t),he.c.push(()=>{_e.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}}const ye={duration:0};function $e(t,o,r){let s,i,c=o(t,r),u=!1,a=0;function p(){s&&Tt(t,s)}function f(){const{delay:o=0,duration:r=300,easing:l=n,tick:f=e,css:d}=c||ye;d&&(s=Mt(t,0,1,r,o,l,d,a++)),f(0,1);const _=j()+o,h=_+r;i&&i.abort(),u=!0,se(()=>de(t,!0,"start")),i=P(e=>{if(u){if(e>=h)return f(1,0),de(t,!0,"end"),p(),u=!1;if(e>=_){const t=l((e-_)/r);f(t,1-t)}}return u})}let d=!1;return{start(){d||(Tt(t),l(c)?(c=c(),fe().then(f)):f())},invalidate(){d=!1},end(){u&&(p(),u=!1)}}}function ve(t,o,r){let s,i=o(t,r),c=!0;const a=he;function p(){const{delay:o=0,duration:r=300,easing:l=n,tick:p=e,css:f}=i||ye;f&&(s=Mt(t,1,0,r,o,l,f));const d=j()+o,_=d+r;se(()=>de(t,!1,"start")),P(e=>{if(c){if(e>=_)return p(0,1),de(t,!1,"end"),--a.r||u(a.c),!1;if(e>=d){const t=l((e-d)/r);p(1-t,t)}}return c})}return a.r+=1,l(i)?fe().then(()=>{i=i(),p()}):p(),{end(e){e&&i.tick&&i.tick(1,0),c&&(s&&Tt(t,s),c=!1)}}}function Fe(t,o,r,s){let i=o(t,r),c=s?0:1,a=null,p=null,f=null;function d(){f&&Tt(t,f)}function _(t,e){const n=t.b-c;return e*=Math.abs(n),{a:c,b:t.b,d:n,duration:e,start:t.start,end:t.start+e,group:t.group}}function h(o){const{delay:r=0,duration:s=300,easing:l=n,tick:h=e,css:x}=i||ye,m={start:j()+r,b:o};o||(m.group=he,he.r+=1),a||p?p=m:(x&&(d(),f=Mt(t,c,o,s,r,l,x)),o&&h(0,1),a=_(m,s),se(()=>de(t,o,"start")),P(e=>{if(p&&e>p.start&&(a=_(p,s),p=null,de(t,a.b,"start"),x&&(d(),f=Mt(t,c,a.b,a.duration,0,l,i.css))),a)if(e>=a.end)h(c=a.b,1-c),de(t,a.b,"end"),p||(a.b?d():--a.group.r||u(a.group.c)),a=null;else if(e>=a.start){const t=e-a.start;c=a.a+a.d*l(t/a.duration),h(c,1-c)}return!(!a&&!p)}))}return{run(t){l(i)?fe().then(()=>{i=i(),h(t)}):h(t)},end(){d(),a=p=null}}}function we(t,e){const n=e.token={};function o(t,o,r,s){if(e.token!==n)return;e.resolved=s;let i=e.ctx;void 0!==r&&((i=i.slice())[r]=s);const c=t&&(e.current=t)(i);let u=!1;e.block&&(e.blocks?e.blocks.forEach((t,n)=>{n!==o&&t&&(xe(),ge(t,1,1,()=>{e.blocks[n]=null}),me())}):e.block.d(1),c.c(),be(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[o]=c),u&&le()}if(r(t)){const n=zt();if(t.then(t=>{Lt(n),o(e.then,1,e.value,t),Lt(null)},t=>{if(Lt(n),o(e.catch,2,e.error,t),Lt(null),!e.hasCatch)throw t}),e.current!==e.pending)return o(e.pending,0),!0}else{if(e.current!==e.then)return o(e.then,1,e.value,t),!0;e.resolved=t}}const ke="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:t;function Ee(t,e){t.d(1),e.delete(t.key)}function Se(t,e){ge(t,1,1,()=>{e.delete(t.key)})}function Ce(t,e){t.f(),Ee(t,e)}function Oe(t,e){t.f(),Se(t,e)}function De(t,e,n,o,r,s,i,c,u,l,a,p){let f=t.length,d=s.length,_=f;const h={};for(;_--;)h[t[_].key]=_;const x=[],m=new Map,b=new Map;for(_=d;_--;){const t=p(r,s,_),c=n(t);let u=i.get(c);u?o&&u.p(t,e):(u=l(c,t)).c(),m.set(c,x[_]=u),c in h&&b.set(c,Math.abs(_-h[c]))}const g=new Set,y=new Set;function $(t){be(t,1),t.m(c,a),i.set(t.key,t),a=t.first,d--}for(;f&&d;){const e=x[d-1],n=t[f-1],o=e.key,r=n.key;e===n?(a=e.first,f--,d--):m.has(r)?!i.has(o)||g.has(o)?$(e):y.has(r)?f--:b.get(o)>b.get(r)?(y.add(o),$(e)):(g.add(r),f--):(u(n,i),f--)}for(;f--;){const e=t[f];m.has(e.key)||u(e,i)}for(;d;)$(x[d-1]);return x}function je(t,e,n,o){const r=new Set;for(let s=0;s<e.length;s++){const i=o(n(t,e,s));if(r.has(i))throw new Error("Cannot have duplicate keys in a keyed each");r.add(i)}}function Ae(t,e){const n={},o={},r={$$scope:1};let s=t.length;for(;s--;){const i=t[s],c=e[s];if(c){for(const t in i)t in c||(o[t]=1);for(const t in c)r[t]||(n[t]=c[t],r[t]=1);t[s]=c}else for(const t in i)r[t]=1}for(const i in o)i in n||(n[i]=void 0);return n}function Me(t){return"object"==typeof t&&null!==t?t:{}}exports.globals=ke;const Te=new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),qe=/[\s'">\/=\u{FDD0}-\u{FDEF}\u{FFFE}\u{FFFF}\u{1FFFE}\u{1FFFF}\u{2FFFE}\u{2FFFF}\u{3FFFE}\u{3FFFF}\u{4FFFE}\u{4FFFF}\u{5FFFE}\u{5FFFF}\u{6FFFE}\u{6FFFF}\u{7FFFE}\u{7FFFF}\u{8FFFE}\u{8FFFF}\u{9FFFE}\u{9FFFF}\u{AFFFE}\u{AFFFF}\u{BFFFE}\u{BFFFF}\u{CFFFE}\u{CFFFF}\u{DFFFE}\u{DFFFF}\u{EFFFE}\u{EFFFF}\u{FFFFE}\u{FFFFF}\u{10FFFE}\u{10FFFF}]/u;function Re(t,e){const n=Object.assign({},...t);e&&(null==n.class?n.class=e:n.class+=" "+e);let o="";return Object.keys(n).forEach(t=>{if(qe.test(t))return;const e=n[t];!0===e?o+=" "+t:Te.has(t.toLowerCase())?e&&(o+=" "+t):null!=e&&(o+=` ${t}="${String(e).replace(/"/g,"&#34;").replace(/'/g,"&#39;")}"`)}),o}exports.invalid_attribute_name_character=qe;const Ne={'"':"&quot;","'":"&#39;","&":"&amp;","<":"&lt;",">":"&gt;"};function Pe(t){return String(t).replace(/["'&<>]/g,t=>Ne[t])}function Le(t,e){let n="";for(let o=0;o<t.length;o+=1)n+=e(t[o],o);return n}exports.escaped=Ne;const ze={$$render:()=>""};function Be(t,e){if(!t||!t.$$render)throw"svelte:component"===e&&(e+=" this={...}"),new Error(`<${e}> is not a valid SSR component. You may need to review your build config to ensure that dependencies are compiled, rather than imported as pre-compiled modules`);return t}function Ie(t,e,n,o){return console.log(`{@debug} ${t?t+" ":""}(${e}:${n})`),console.log(o),""}let He,We;function Ue(t){function e(e,n,o,r){const s=Dt;Lt({$$:{on_destroy:He,context:new Map(s?s.$$.context:[]),on_mount:[],before_update:[],after_update:[],callbacks:c()}});const i=t(e,n,o,r);return Lt(s),i}return{render:(t={},n={})=>{He=[];const o={title:"",head:"",css:new Set},r=e(o,t,{},n);return u(He),{html:r,css:{code:Array.from(o.css).map(t=>t.code).join("\n"),map:null},head:o.title+o.head}},$$render:e}}function Ye(t,e,n){return null==e||n&&!e?"":` ${t}${!0===e?"":`=${"string"==typeof e?JSON.stringify(Pe(e)):`"${e}"`}`}`}function Je(t){return t?` class="${t}"`:""}function Ge(t,e,n){const o=t.$$.props[e];void 0!==o&&(t.$$.bound[o]=n,n(t.$$.ctx[o]))}function Ke(t){t&&t.c()}function Qe(t,e){t&&t.l(e)}function Ve(t,e,n){const{fragment:o,on_mount:r,on_destroy:s,after_update:c}=t.$$;o&&o.m(e,n),se(()=>{const e=r.map(i).filter(l);s?s.push(...e):u(e),t.$$.on_mount=[]}),c.forEach(se)}function Xe(t,e){const n=t.$$;null!==n.fragment&&(u(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Ze(t,e){-1===t.$$.dirty[0]&&(Qt.push(t),oe(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function tn(t,n,o,r,s,i,l=[-1]){const a=Dt;Lt(t);const p=n.props||{},f=t.$$={fragment:null,ctx:null,props:i,update:e,not_equal:s,bound:c(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(a?a.$$.context:[]),callbacks:c(),dirty:l,skip_bound:!1};let d=!1;if(f.ctx=o?o(t,p,(e,n,...o)=>{const r=o.length?o[0]:n;return f.ctx&&s(f.ctx[e],f.ctx[e]=r)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](r),d&&Ze(t,e)),n}):[],f.update(),d=!0,u(f.before_update),f.fragment=!!r&&r(f.ctx),n.target){if(n.hydrate){const t=ut(n.target);f.fragment&&f.fragment.l(t),t.forEach(B)}else f.fragment&&f.fragment.c();n.intro&&be(t.$$.fragment),Ve(t,n.target,n.anchor),le()}Lt(a)}exports.missing_component=ze,exports.SvelteElement=We,"function"==typeof HTMLElement&&(exports.SvelteElement=We=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}$destroy(){Xe(this,1),this.$destroy=e}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!f(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});class en{$destroy(){Xe(this,1),this.$destroy=e}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!f(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function nn(t,e){document.dispatchEvent(wt(t,Object.assign({version:"3.31.0"},e)))}function on(t,e){nn("SvelteDOMInsert",{target:t,node:e}),L(t,e)}function rn(t,e,n){nn("SvelteDOMInsert",{target:t,node:e,anchor:n}),z(t,e,n)}function sn(t){nn("SvelteDOMRemove",{node:t}),B(t)}function cn(t,e){for(;t.nextSibling&&t.nextSibling!==e;)sn(t.nextSibling)}function un(t){for(;t.previousSibling;)sn(t.previousSibling)}function ln(t){for(;t.nextSibling;)sn(t.nextSibling)}function an(t,e,n,o,r,s){const i=!0===o?["capture"]:o?Array.from(Object.keys(o)):[];r&&i.push("preventDefault"),s&&i.push("stopPropagation"),nn("SvelteDOMAddEventListener",{node:t,event:e,handler:n,modifiers:i});const c=Q(t,e,n,o);return()=>{nn("SvelteDOMRemoveEventListener",{node:t,event:e,handler:n,modifiers:i}),c()}}function pn(t,e,n){tt(t,e,n),null==n?nn("SvelteDOMRemoveAttribute",{node:t,attribute:e}):nn("SvelteDOMSetAttribute",{node:t,attribute:e,value:n})}function fn(t,e,n){t[e]=n,nn("SvelteDOMSetProperty",{node:t,property:e,value:n})}function dn(t,e,n){t.dataset[e]=n,nn("SvelteDOMSetDataset",{node:t,property:e,value:n})}function _n(t,e){e=""+e,t.wholeText!==e&&(nn("SvelteDOMSetData",{node:t,data:e}),t.data=e)}function hn(t){if("string"!=typeof t&&!(t&&"object"==typeof t&&"length"in t)){let e="{#each} only iterates over array-like objects.";throw"function"==typeof Symbol&&t&&Symbol.iterator in t&&(e+=" You can use a spread to convert this iterable into an array."),new Error(e)}}function xn(t,e,n){for(const o of Object.keys(e))~n.indexOf(o)||console.warn(`<${t}> received an unexpected slot "${o}".`)}exports.SvelteComponent=en;class mn extends en{constructor(t){if(!t||!t.target&&!t.$$inline)throw new Error("'target' is a required option");super()}$destroy(){super.$destroy(),this.$destroy=(()=>{console.warn("Component was already destroyed")})}$capture_state(){}$inject_state(){}}exports.SvelteComponentDev=mn;class bn extends mn{constructor(t){super(t)}}function gn(t){const e=Date.now();return()=>{if(Date.now()-e>t)throw new Error("Infinite loop detected")}}exports.SvelteComponentTyped=bn;
},{}],"nBdo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.derived=o,exports.readable=n,exports.writable=r,Object.defineProperty(exports,"get",{enumerable:!0,get:function(){return e.get_store_value}});var e=require("../internal/index.mjs");const t=[];function n(e,t){return{subscribe:r(e,t).subscribe}}function r(n,r=e.noop){let o;const s=[];function u(r){if((0,e.safe_not_equal)(n,r)&&(n=r,o)){const e=!t.length;for(let r=0;r<s.length;r+=1){const e=s[r];e[1](),t.push(e,n)}if(e){for(let e=0;e<t.length;e+=2)t[e][0](t[e+1]);t.length=0}}}return{set:u,update:function(e){u(e(n))},subscribe:function(t,i=e.noop){const c=[t,i];return s.push(c),1===s.length&&(o=r(u)||e.noop),t(n),()=>{const e=s.indexOf(c);-1!==e&&s.splice(e,1),0===s.length&&(o(),o=null)}}}}function o(t,r,o){const s=!Array.isArray(t),u=s?[t]:t,i=r.length<2;return n(o,t=>{let n=!1;const o=[];let c=0,l=e.noop;const f=()=>{if(c)return;l();const n=r(s?o[0]:o,t);i?t(n):l=(0,e.is_function)(n)?n:e.noop},p=u.map((t,r)=>(0,e.subscribe)(t,e=>{o[r]=e,c&=~(1<<r),n&&f()},()=>{c|=1<<r}));return n=!0,f(),function(){(0,e.run_all)(p),l()}})}
},{"../internal/index.mjs":"xeIE"}],"XHT5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"SvelteComponent",{enumerable:!0,get:function(){return e.SvelteComponentDev}}),Object.defineProperty(exports,"SvelteComponentTyped",{enumerable:!0,get:function(){return e.SvelteComponentTyped}}),Object.defineProperty(exports,"afterUpdate",{enumerable:!0,get:function(){return e.afterUpdate}}),Object.defineProperty(exports,"beforeUpdate",{enumerable:!0,get:function(){return e.beforeUpdate}}),Object.defineProperty(exports,"createEventDispatcher",{enumerable:!0,get:function(){return e.createEventDispatcher}}),Object.defineProperty(exports,"getContext",{enumerable:!0,get:function(){return e.getContext}}),Object.defineProperty(exports,"hasContext",{enumerable:!0,get:function(){return e.hasContext}}),Object.defineProperty(exports,"onDestroy",{enumerable:!0,get:function(){return e.onDestroy}}),Object.defineProperty(exports,"onMount",{enumerable:!0,get:function(){return e.onMount}}),Object.defineProperty(exports,"setContext",{enumerable:!0,get:function(){return e.setContext}}),Object.defineProperty(exports,"tick",{enumerable:!0,get:function(){return e.tick}});var e=require("./internal/index.mjs");
},{"./internal/index.mjs":"xeIE"}],"ksES":[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3];module.exports=e.performance&&e.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date};
},{}],"YOvR":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"M3eo":[function(require,module,exports) {
var process = require("process");
var e=require("process");Object.defineProperty(exports,"__esModule",{value:!0}),exports.createRootWorld=x,exports.context=h,exports.AutoReleasingTrigger=exports.TagPropUpdate=exports.MarkConfigChanged=exports.Config=exports.ViewLayerNeedsUpdate=exports.ViewLayer=exports.CONTEXT_KEY_NODE=void 0;var t=require("../alec"),s=require("svelte/store"),r=require("svelte"),o=n(require("right-now"));function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const i={};exports.CONTEXT_KEY_NODE=i;class c extends t.Data{}exports.ViewLayer=c,a(c,"data",{id:t.Types.Ref(""),component:t.Types.Ref(),props:t.Types.Object()});class d extends t.Tag{}exports.ViewLayerNeedsUpdate=d;class p extends t.Data{update(){this.changed=!0,this.sync=!0}}exports.Config=p,a(p,"data",{name:t.Types.Ref(""),component:t.Types.Ref(),props:t.Types.Object(),triggers:t.Types.Object(),changed:t.Types.Ref(!1),sync:t.Types.Ref(!1),instance:t.Types.Ref()});class l extends t.Tag{}exports.MarkConfigChanged=l;class f extends t.Value{}exports.TagPropUpdate=f;class g extends t.Data{}function u(e,{store:t}){e.system.info({hidden:!0});const s=e.view(c),r=e.listen(c),o=e.view([c,d]);return()=>{let e=!1,n=!1;if(r.changed){const e=s.slice();t&&t.update(()=>e),n=!0}if(o.forEach(t=>{t.remove(d),e=!0}),!n&&e&&t){const e=s.slice();t.update(()=>e)}}}function y(e,{store:t}){e.system.info({hidden:!0});const s=e.view(p),r=e.listen(p),n=e.view(g),a=e.listen(g),i=e.view(f);let c=.1,d=0,u=(0,o.default)();return{process:function(e){if(r.changed){if(t){const e=s.slice();t.update(t=>e)}r.added.forEach(e=>{e.add(l)}),r.removing.forEach(e=>{e.has(l)&&e.remove(l)})}if(s.forEach(e=>{const t=e.get(p),s=e.has(l);t.changed=s,s&&e.remove(l),t.instance&&t.sync&&(t.instance.sync(),t.sync=!1)}),a.removing.forEach(e=>{const t=e.get(g);delete t.target.triggers[t.key]}),n.forEach(e=>{const t=e.get(g);t.target.triggers[t.key]=t.value,e.kill()}),(d+=e)>=c){d%=c;const e=(0,o.default)();i.forEach(e=>{const t=e.get(f);"function"==typeof t&&t()}),u=e}}}}function x(e={}){const{useEditorConfig:r=!1}=e,o=(0,t.createWorld)({initialCapacity:400}),n=(0,s.writable)([]);o.addSystem(u,{store:n});const a=r?(0,s.writable)([]):null;return o.addSystem(y,{store:a}),{configEntityStore:a,viewLayerStore:n,world:o}}function h(){const e=(0,r.getContext)(i);if(null==e)throw new Error("Must call context() from within a Svelte component");return e}exports.AutoReleasingTrigger=g,a(g,"data",{target:t.Types.Ref(),key:t.Types.Ref(),value:t.Types.Ref()});
},{"../alec":"beHZ","svelte/store":"nBdo","svelte":"XHT5","right-now":"ksES","process":"YOvR"}],"UVYK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"ViewLayer",{enumerable:!0,get:function(){return t.ViewLayer}}),Object.defineProperty(exports,"ViewLayerNeedsUpdate",{enumerable:!0,get:function(){return t.ViewLayerNeedsUpdate}}),Object.defineProperty(exports,"Config",{enumerable:!0,get:function(){return t.Config}}),Object.defineProperty(exports,"MarkConfigChanged",{enumerable:!0,get:function(){return t.MarkConfigChanged}}),Object.defineProperty(exports,"Data",{enumerable:!0,get:function(){return s.Data}}),Object.defineProperty(exports,"Value",{enumerable:!0,get:function(){return s.Value}}),Object.defineProperty(exports,"Tag",{enumerable:!0,get:function(){return s.Tag}}),exports.DebugRenderTarget=exports.UserFirstVisitedWorldIndex=exports.GroundDataRenderTarget=exports.GroundFogRenderTarget=exports.AudioMeta=exports.SolvingDecayArea=exports.HasVisitedFinalPortal=exports.WaitingToVisitFinalPortal=exports.WorldDecayTweens=exports.WorldTweens=exports.ActiveWorldIndex=exports.WaitingForTokenPaper=exports.HaikuInInventory=exports.HaikuAddingToInventory=exports.FinishedPoem=exports.CollectedToken=exports.GroundToken=exports.UserLine=exports.KillWritingIgnore=exports.UserWritingState=exports.GroundSpawnDecayTag=exports.GroundSpawnTokenTag=exports.GroundSpawnPosition2D=exports.PoemLineVertex=exports.PoemFinishing=exports.PoemLineText=exports.PoemInProgress=exports.PoemWriting=exports.IntroLayer=exports.HasLoaded=exports.HasShownElementalOverlay=exports.NearestEnvironmentCell=exports.CanShowCompass=exports.PoemRemaining=exports.PoemTextFragment=exports.GroundPoemFragmentSprite=exports.PoemLineMesh=exports.TickerTimeline=exports.PoemLineWithinRange=exports.GroundMeshWithPoem=exports.PoemLineTrigger=exports.PoemLine=exports.SpriteBlobShadowView=exports.SpriteBlobShadow=exports.GroundAssetSpriteType=exports.GroundAssetCellSampleToHide=exports.GroundAssetCellSampleToGrow=exports.GroundAssetCellSampleWithFeature=exports.GroundAssetCellSampleInstance=exports.GroundAssetCellSample=exports.GroundPlaneLayer=exports.GrassPlaneView=exports.GroundPlaneView=exports.GroundSpawningDot=exports.GroundSpawningGrass=exports.GroundSpawningLeaf=exports.GroundPatchInstance=exports.EnvironmentCell=exports.ActiveEnvironmentState=exports.EnvironmentState=exports.GroundPhysicsBody=exports.EnvironmentUnderPlayerState=exports.TextSprite3D=exports.MoveUserTo=exports.CinematicCameraMoment=exports.UserCompletingPoem=exports.UserInPoemArea=exports.PoemLineActivated=exports.PoemLineTriggerActivated=exports.TriggerDelayedPoemOverlay=exports.TriggerPoemComplete=exports.TweenCopyTargetKeyToVectorScalar=exports.TargetKeyTween=exports.Sequence=exports.MovementBoost=exports.ShaderUniformUserCharacterPosition=exports.ShaderUniformUserTargetPosition=exports.ShaderUniformResolution=exports.ShaderUniformTime=exports.EnvironmentMap=exports.IsGameUIActive=exports.ModalStoppingUserMovement=exports.CameraStopUserMovement=exports.UserFollow=exports.UserZoom=exports.DebugState=exports.UserTarget=exports.UserCharacter=exports.AppState=exports.UserInitiatedGesture=exports.InputState=exports.TriggerMovementGesture=exports.InputGestureEmitter=exports.Renderer=exports.Canvas=exports.MainScene=exports.MainCamera=exports.Object3DKeepAlive=exports.Object3D=exports.Types=void 0,exports.UserHasHit=exports.WaterFishPlaceholderTag=exports.FoxHm=exports.FoxPurring=exports.FoxSpriteTag=exports.GameFinished=exports.TutorialMessage=exports.FloatingEndLine=exports.TokenForCompass=exports.AnimateOutCharacter=exports.AnimateInCharacter=exports.Animal=exports.AnimalSpawn=exports.LastWalkedLake=exports.Raining=exports.RainDropSplatter=exports.RainDrop=exports.WindLine=exports.HintOrb=exports.ObjectiveText=exports.CanSetIntroTags=exports.BlockTokenCollection=exports.UserForceApplied=exports.TutorialBarrenGround=exports.TutorialTextHint=exports.TutorialState=exports.HideHUD=exports.HideCharacter=exports.BlockUserMove=exports.HaikuCardSaved=exports.HaikuCardShown=exports.KillTextHint=exports.TextHint=exports.ScreenFade=exports.LetterboxBars=exports.CameraZoomOut=exports.GameLandingCameraDrift=exports.OriginTreeIntroSequenceStarted=exports.OriginTreeIntroSequence=exports.MoveUserToOrigin=exports.HatTipWindLineSound=exports.HatTipWindLineTag=exports.HatTipPoint=exports.WaterFollowParticle=exports.UserCarryingTokenCollectionFeature=exports.GLTFSpawnItemsMap=exports.FloatingTokenShouldTargetTree=exports.FloatingTokenTargetUser=exports.FloatingToken=exports.GlowingHaikuCard=exports.CameraFocusOnTarget=exports.SpriteAnimationOriginTreeTag=exports.GameStarted=exports.ButtonClick=exports.ButtonHover=exports.PauseOpen=exports.JournalOpen=exports.SpriteAnimationLazyLoadSheet=exports.SpriteAnimation=exports.SpawnedFlora=exports.StanzaLineSpawningAsset=exports.WrittenStanzaLineActive=exports.WrittenStanzaLine=exports.TokensDiscoveredSet=exports.GroundAssetToken=exports.BoxHelper=exports.SafeToSwapBiomes=exports.TransitionToNextBiome=exports.EndGameState=exports.FinalBiomeResolutionLines=exports.FinalBiomeResolution=exports.ShowBiomeResolution=exports.WaitingForBiomeResolution=exports.DirectUserToOrigin=exports.GameUIStore=exports.TestLoadRef=exports.IsInFrustum=exports.GLTFRefAssetLoaded=exports.GLTFRefAsset=exports.AssetCache=exports.BloomObject=exports.ShadowCaster=exports.RenderLayers=exports.GrassEditableData=exports.GroundMeshEditableData=exports.Atmospherics=exports.PostProcessEnabled=exports.GroundAsset3DAsync=exports.GroundAssetInsideFrustum=exports.MainCameraFrustum=exports.GroundAssetData=exports.GroundAsset=exports.WillTriggerAudio=exports.UserHitAudioTrigger=exports.ShowUserTokenInventory=exports.ShowUserCollectHint=exports.ShowUserWriteHint=exports.WaitingForUserWrite=exports.BlockUserWrite=exports.GroundDataParticle=void 0,exports.TriggerTreeTransitionAudio=exports.OutroFinished=exports.MusicalOrb=exports.ParticleEmit=exports.AutoRemoveCapeMagicalEffect=exports.CapeMagicalEffect=exports.FlashSound=exports.AnimalSound=exports.ClearInputPress=exports.GIFRecord=exports.CollectTokenOrb=exports.TokenChildren=exports.TriggerTokenLine=exports.TokenIsCollecting=exports.ResetToCameraDrift=exports.Snowflake=exports.CompassVisible=void 0;var e=r(require("three")),t=require("../alec-svelte"),s=require("../alec");function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,s=new WeakMap;return(a=function(e){return e?s:t})(e)}function r(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var s=a(t);if(s&&s.has(e))return s.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var l=o?Object.getOwnPropertyDescriptor(e,n):null;l&&(l.get||l.set)?Object.defineProperty(r,n,l):r[n]=e[n]}return r.default=e,s&&s.set(e,r),r}function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const n={...s.Types,Vector2:(t=0,a=0)=>({initial:new e.Vector2(t,a),copy:s.copyInstance,clone:s.cloneInstance}),Vector3:(t=0,a=0,r=0)=>({initial:new e.Vector3(t,a,r),copy:s.copyInstance,clone:s.cloneInstance}),Vector4:(t=0,a=0,r=0,o=0)=>({initial:new e.Vector4(t,a,r,o),copy:s.copyInstance,clone:s.cloneInstance}),Quaternion:(t=0,a=0,r=0,o=0)=>({initial:new e.Quaternion(t,a,r,o),copy:s.copyInstance,clone:s.cloneInstance}),Euler:(t=0,a=0,r=0,o="XYZ")=>({initial:new e.Euler(t,a,r,o),copy:s.copyInstance,clone:s.cloneInstance}),Color:(t=0,a=0,r=0)=>({initial:new e.Color(t,a,r),copy:s.copyInstance,clone:s.cloneInstance})};exports.Types=n;class l extends s.Value{}exports.Object3D=l,o(l,"edit",{visible:!1});class i extends s.Tag{}exports.Object3DKeepAlive=i;class p extends s.Value{}exports.MainCamera=p;class x extends s.Value{}exports.MainScene=x;class d extends s.Value{}exports.Canvas=d;class c extends s.Value{}exports.Renderer=c;class f extends s.Value{}exports.InputGestureEmitter=f;class u extends s.Value{}exports.TriggerMovementGesture=u;class R extends s.Data{}exports.InputState=R,o(R,"data",{multitouch:n.Ref(null),position:n.Vector2(),positionNormalized:n.Vector2(),interacted:!1,pressed:!1,metaKey:!1,ctrlKey:!1,shiftKey:!1});class g extends s.Tag{}exports.UserInitiatedGesture=g;class m extends s.Data{}exports.AppState=m,o(m,"data",{ready:n.Ref(!1),running:n.Ref(!0),rendering:n.Ref(!0),pixelRatio:n.Ref(1),width:n.Ref(1),height:n.Ref(1),canvasWidth:n.Ref(1),canvasHeight:n.Ref(1)});class T extends s.Data{}exports.UserCharacter=T,o(T,"data",{direction:n.Vector3(),position:n.Vector3(),target:n.Vector3(),velocity:n.Vector3(),yOffset:n.Ref(0),magicalEffect:n.Ref(0),glowIntensity:n.Ref(1),glowIntensity2:n.Ref(1),capeSpeed:n.Ref(1)});class S extends s.Data{}exports.UserTarget=S,o(S,"data",{direction:n.Vector3(),position:n.Vector3(),forceApplied:!1,speedAlpha:0,totalBoost:0,boostAlpha:0,totalSpeedAlpha:0,inputPositionOnPlane:n.Vector3(),inputHitPlane:!1});class y extends s.Data{}exports.DebugState=y,o(y,"data",{mouseOnPlaneHitPoint:n.Vector3()});class D extends s.Data{}exports.UserZoom=D,o(D,"data",{allowMouseZoom:!1,distance:15,defaultDistance:15,minDistance:2,maxDistance:50,currentWheelOffset:0,zoomPowFactor:1.25,zoomPowTarget:5,zoomPixelsToWorld:.001});class h extends s.Data{}exports.UserFollow=h,o(h,"data",{currentTarget:n.Vector3(),currentPosition:n.Vector3(),currentDistance:12,distanceSpring:5,minSpeedZoomDistance:0,maxSpeedZoomDistance:1,speedZoomDistance:0,speedZoomSpringIn:.25,speedZoomSpringOut:4,shake:0,shakeSpeed:1,shakeTime:0});class v extends s.Tag{}exports.CameraStopUserMovement=v;class A extends s.Tag{}exports.ModalStoppingUserMovement=A;class C extends s.Tag{}exports.IsGameUIActive=C;class P extends s.Data{}exports.EnvironmentMap=P,o(P,"data",{image:null});class w extends s.Data{}exports.ShaderUniformTime=w,o(w,"data",{uniform:n.Ref(),elapsed:n.Ref(0)}),o(w,"edit",{visible:!1});class V extends s.Data{}exports.ShaderUniformResolution=V,o(V,"data",{uniform:n.Ref()}),o(V,"edit",{visible:!1});class G extends s.Data{}exports.ShaderUniformUserTargetPosition=G,o(G,"data",{uniform:n.Ref()}),o(G,"edit",{visible:!1});class F extends s.Data{}exports.ShaderUniformUserCharacterPosition=F,o(F,"data",{uniform:n.Ref()}),o(F,"edit",{visible:!1});class k extends s.Data{}exports.MovementBoost=k,o(k,"data",{frictionPower:n.Ref(1),value:n.Ref(2),duration:n.Ref(4),elapsed:n.Ref(0)});class b{}exports.Sequence=b,o(b,"data",{curve:n.Ref(),stanza:n.Ref(0)});class L extends s.Data{}exports.TargetKeyTween=L,o(L,"data",{pauseOnModal:n.Ref(!1),started:n.Ref(!1),duration:n.Ref(1),elapsed:n.Ref(0),ease:n.Ref("linear"),delay:n.Ref(0),from:n.Ref(0),to:n.Ref(1),active:n.Ref(!0),finished:n.Ref(!1),killEntityOnFinish:n.Ref(!1),assignFromOnStart:n.Ref(!1),target:n.Ref(null),key:n.Ref(""),callbackOnStart:n.Ref(null),callbackOnFinish:n.Ref(null)});class O extends s.Value{}exports.TweenCopyTargetKeyToVectorScalar=O;class I extends s.Value{}exports.TriggerPoemComplete=I,o(I,"value",n.Ref(null));class U extends s.Data{}exports.TriggerDelayedPoemOverlay=U,o(U,"data",{root:n.Ref(null),delay:n.Ref(1),elapsed:n.Ref(0),spawned:n.Ref(!1)});class M extends s.Tag{}exports.PoemLineTriggerActivated=M;class W extends s.Data{}exports.PoemLineActivated=W,o(W,"data",{root:n.Ref(null),node:n.Ref(null)});class H extends s.Tag{}exports.UserInPoemArea=H;class B extends s.Tag{}exports.UserCompletingPoem=B;class E extends s.Data{}exports.CinematicCameraMoment=E,o(E,"data",{copyStart:n.Ref(!1),target:n.Vector3()});class j extends s.Data{}exports.MoveUserTo=j,o(j,"data",{target:n.Vector3()});class z extends s.Data{}exports.TextSprite3D=z,o(z,"data",{text:n.Ref(""),color:n.Color(1,1,1),culling:n.Ref(!0),depth:n.Ref(!0),x:n.Ref(0),y:n.Ref(0),sprite:n.Ref(null),opacity:n.Ref(1),fontStyle:n.Ref("normal"),fontSize:n.Ref(14),parent:n.Ref(null)});class K extends s.Data{}exports.EnvironmentUnderPlayerState=K,o(K,"data",{lake:n.Ref(null),water:n.Ref(!1)});class q extends s.Data{}exports.GroundPhysicsBody=q,o(q,"data",{position:n.Vector3(0,0,0),velocity:n.Vector3(0,0,0),speed:n.Ref(1),scale:n.Ref(1),timeScale:n.Ref(1),currentRotation:n.Quaternion(0,0,0,0),spinRotation:n.Quaternion(0,0,0,0),targetRotation:n.Quaternion(0,0,0,0),flatRotation:n.Quaternion(0,0,0,0),rotationAxis:n.Vector3(0,0,0),rotationSpeed:n.Ref(1),rotationAngleOffset:n.Ref(0)});class Z extends s.Data{}exports.EnvironmentState=Z,o(Z,"data",{name:n.Ref(""),grassInstanceCount:n.Ref(1),grassScale:n.Ref(1),grassTipFactor:n.Ref(1),haikusTotal:n.Ref(5),waterMeshes:n.Array([]),tokens:n.Array([]),solved:n.Ref(0),group:n.Ref(null),lakes:n.Ref(null),data:n.Ref(null),grid:n.Ref(null),samples:n.Ref(null),waterSamples:n.Ref(null),waterColors:n.Ref(null),seed:n.Ref(null),waterId:n.Ref(null),hasLakes:n.Ref(null),idleViewPoint:n.Vector3(),cells:n.Ref(null),colors:n.Ref(null),textures:n.Array([]),patches:n.Array([]),waterMap:n.Ref(null),overlayOpacity:n.Ref(1)}),o(Z,"edit",{});class N extends s.Tag{}exports.ActiveEnvironmentState=N;class Q extends s.Data{}exports.EnvironmentCell=Q,o(Q,"data",{environmentState:n.Ref(null),cell:n.Ref(null),random:n.Ref(null),children:n.Array([])});class _ extends s.Value{}exports.GroundPatchInstance=_,o(_,"value",null);class Y extends s.Tag{}exports.GroundSpawningLeaf=Y;class J extends s.Tag{}exports.GroundSpawningGrass=J;class X extends s.Tag{}exports.GroundSpawningDot=X;class $ extends s.Data{}exports.GroundPlaneView=$,o($,"data",{camera:null,target:null,projectionMatrix:null,layer:5});class ee extends s.Data{}exports.GrassPlaneView=ee,o(ee,"data",{layer:n.Ref(7)});class te extends s.Value{}exports.GroundPlaneLayer=te,o(te,"value",null);class se extends s.Data{}exports.GroundAssetCellSample=se,o(se,"data",{x:n.Ref(0),y:n.Ref(0),random:n.Ref(null),cell:n.Ref(null),type:n.Ref(null),children:n.Array([])});class ae extends s.Data{}exports.GroundAssetCellSampleInstance=ae,o(ae,"data",{worldIndex:n.Ref(0),feature:n.Ref(!1),data:n.Ref(null)});class re extends s.Value{}exports.GroundAssetCellSampleWithFeature=re;class oe extends s.Tag{}exports.GroundAssetCellSampleToGrow=oe;class ne extends s.Tag{}exports.GroundAssetCellSampleToHide=ne;class le extends s.Value{}exports.GroundAssetSpriteType=le;class ie extends s.Data{}exports.SpriteBlobShadow=ie,o(ie,"data",{size:n.Ref(1),scale:n.Ref(1),offsetX:n.Ref(0),offsetY:n.Ref(0),mesh:n.Ref(null)});class pe extends s.Data{}exports.SpriteBlobShadowView=pe,o(pe,"data",{target:n.Ref(null),layer:n.Ref(6)});class xe extends s.Data{}exports.PoemLine=xe,o(xe,"data",{node:n.Ref(null),root:n.Ref(null),nearby:n.Ref(!1),boundingCenter:n.Array([]),boundingRadius:n.Ref(1),curve:n.Ref(null),triggers:n.Array([]),activated:n.Ref(!1),yOffset:n.Ref(.5)});class de extends s.Data{}exports.PoemLineTrigger=de,o(de,"data",{root:n.Ref(null),ready:n.Ref(!1),activated:n.Ref(!1),progress:n.Ref(0),fragment:n.Ref(""),previous:n.Ref(null),next:n.Ref(null),parent:n.Ref(null),position:n.Vector3()});class ce extends s.Data{}exports.GroundMeshWithPoem=ce,o(ce,"data",{mesh:n.Ref(null),id:n.Ref("")});class fe extends s.Tag{}exports.PoemLineWithinRange=fe;class ue extends s.Value{}exports.TickerTimeline=ue;class Re extends s.Data{}exports.PoemLineMesh=Re,o(Re,"data",{mesh:n.Ref(null),timeline:n.Ref(null),parent:n.Ref(null)});class ge extends s.Tag{}exports.GroundPoemFragmentSprite=ge;class me extends s.Data{}exports.PoemTextFragment=me,o(me,"data",{root:n.Ref(null),mesh:n.Ref(null)});class Te extends s.Value{}exports.PoemRemaining=Te;class Se extends s.Tag{}exports.CanShowCompass=Se;class ye extends s.Value{}exports.NearestEnvironmentCell=ye;class De extends s.Tag{}exports.HasShownElementalOverlay=De;class he extends s.Tag{}exports.HasLoaded=he;class ve extends s.Tag{}exports.IntroLayer=ve;class Ae extends s.Tag{}exports.PoemWriting=Ae;class Ce extends s.Tag{}exports.PoemInProgress=Ce;class Pe extends s.Tag{}exports.PoemLineText=Pe;class we extends s.Data{}exports.PoemFinishing=we,o(we,"data",{elapsed:n.Ref(0),delay:n.Ref(3)});class Ve extends s.Data{}exports.PoemLineVertex=Ve,o(Ve,"data",{position:n.Vector3()});class Ge extends s.Value{}exports.GroundSpawnPosition2D=Ge,o(Ge,"value",n.Array([]));class Fe extends s.Tag{}exports.GroundSpawnTokenTag=Fe;class ke extends s.Tag{}exports.GroundSpawnDecayTag=ke;class be extends s.Data{}exports.UserWritingState=be,o(be,"data",{writing:n.Ref(!1),force:n.Ref(!1),ignore:n.Ref(!1)});class Le extends s.Data{}exports.KillWritingIgnore=Le,o(Le,"data",{elapsed:n.Ref(0),duration:n.Ref(.5)});class Oe extends s.Data{}exports.UserLine=Oe,o(Oe,"data",{distance:n.Ref(0),writing:n.Ref(!1),changed:n.Ref(!1),active:n.Ref(!1),line:n.Ref(null),elapsed:n.Ref(0),duration:n.Ref(1)});class Ie extends s.Data{}exports.GroundToken=Ie,o(Ie,"data",{type:n.Ref(""),position:n.Vector3(0,0,0),collected:n.Ref(!1)});class Ue extends s.Data{}exports.CollectedToken=Ue,o(Ue,"data",{type:n.Ref(""),stanza:n.Ref(null),stanzaIndex:n.Ref(0),x:n.Ref(0),z:n.Ref(0)});class Me extends s.Data{}exports.FinishedPoem=Me,o(Me,"data",{tokens:n.Array([]),lines:n.Array([])});class We extends s.Data{}exports.HaikuAddingToInventory=We,o(We,"data",{time:n.Ref(0),delay:n.Ref(.25)});class He extends s.Tag{}exports.HaikuInInventory=He;class Be extends s.Tag{}exports.WaitingForTokenPaper=Be;class Ee extends s.Value{}exports.ActiveWorldIndex=Ee,o(Ee,"value",n.Ref(0));class je extends s.Value{}exports.WorldTweens=je,o(je,"value",n.Array([]));class ze extends s.Value{}exports.WorldDecayTweens=ze,o(ze,"value",n.Array([]));class Ke extends s.Tag{}exports.WaitingToVisitFinalPortal=Ke;class qe extends s.Tag{}exports.HasVisitedFinalPortal=qe;class Ze extends s.Data{}exports.SolvingDecayArea=Ze,o(Ze,"data",{index:n.Ref(0),tween:n.Ref(0)});class Ne extends s.Data{}exports.AudioMeta=Ne,o(Ne,"data",{names:n.Array([]),paths:n.Array([])});class Qe extends s.Data{}exports.GroundFogRenderTarget=Qe,o(Qe,"data",{projection:n.Ref(null),target:n.Ref(null)});class _e extends s.Data{}exports.GroundDataRenderTarget=_e,o(_e,"data",{projection:n.Ref(null),view:n.Ref(null),target:n.Ref(null)});class Ye extends s.Value{}exports.UserFirstVisitedWorldIndex=Ye,o(Ye,"value",n.Ref(0));class Je extends s.Data{}exports.DebugRenderTarget=Je,o(Je,"data",{visible:n.Ref(!0),target:n.Ref(null)});class Xe extends s.Data{}exports.GroundDataParticle=Xe,o(Xe,"value",n.Ref(null));class $e extends s.Tag{}exports.BlockUserWrite=$e;class et extends s.Tag{}exports.WaitingForUserWrite=et;class tt extends s.Tag{}exports.ShowUserWriteHint=tt;class st extends s.Tag{}exports.ShowUserCollectHint=st;class at extends s.Tag{}exports.ShowUserTokenInventory=at;class rt extends s.Data{}exports.UserHitAudioTrigger=rt,o(rt,"data",{type:n.Ref("")});class ot extends s.Tag{}exports.WillTriggerAudio=ot;class nt extends s.Data{}exports.GroundAsset=nt,o(nt,"data",{x:n.Ref(0),z:n.Ref(0),cellEntity:n.Ref(null)});class lt extends s.Data{}exports.GroundAssetData=lt,o(lt,"data",{instance:n.Ref(null),key:n.Ref(""),audio:n.Ref(!1),type:n.Ref("sprite"),useMapDiscard:n.Ref(!1),ignoreFlip:n.Ref(!1),rotation:n.Ref(0),flip:n.Ref(!1),scale:n.Vector3(1,1,1),sizeFactor:n.Ref(1),variance:n.Ref(0)});class it extends s.Value{}exports.MainCameraFrustum=it;class pt extends s.Data{}exports.GroundAssetInsideFrustum=pt;class xt extends s.Data{}exports.GroundAsset3DAsync=xt,o(xt,"data",{url:n.Ref("")});class dt extends s.Value{}exports.PostProcessEnabled=dt,o(dt,"value",n.Ref(!0));class ct extends s.Data{}exports.Atmospherics=ct,o(ct,"data",{camera:n.Ref(null),scene:n.Ref(null)});class ft extends s.Data{}exports.GroundMeshEditableData=ft,o(ft,"data",{uvRepeatScale:n.Ref(1),overrideMap:n.Ref(null),overrideColor:n.Ref("#ffffff"),useOverrideMap:n.Ref(!1),useOverrideColor:n.Ref(!1),useOverrideWater:n.Ref(!1),overrideWater:n.Ref(null),useOverrideWaterColor:n.Ref(!1),overrideWaterColorA:n.Ref("#0000ff"),overrideWaterColorB:n.Ref("#0000ff"),useCustomLUT:n.Ref(!1),lutMap:n.Ref(null)});class ut extends s.Data{}exports.GrassEditableData=ut,o(ut,"data",{useCustomGrass:n.Ref(!1),customGrassMap:n.Ref(null),grassScale:n.Ref(1)});class Rt extends s.Data{}exports.RenderLayers=Rt,o(Rt,"data",{groundDepth:n.Ref(4),ground:n.Ref(5),groundNormalElement:n.Ref(6),water:n.Ref(7),grass:n.Ref(10),animal:n.Ref(11),shadow:n.Ref(15),atmospherics:n.Ref(25)});class gt extends s.Data{}exports.ShadowCaster=gt,o(gt,"data",{sprite:n.Ref(!1)});class mt extends s.Data{}exports.BloomObject=mt,o(mt,"data",{color:n.Color(1,1,1)});class Tt extends s.Value{}exports.AssetCache=Tt;class St extends s.Data{}exports.GLTFRefAsset=St,o(St,"data",{position:n.Array(),boundsMin:n.Vector3(),boundsMax:n.Vector3(),boundsSet:n.Ref(!1),name:n.Ref(""),biome:n.Ref(""),group:n.Ref(null),promise:n.Ref(null)});class yt extends s.Data{}exports.GLTFRefAssetLoaded=yt,o(yt,"data",{mesh:n.Ref(null)});class Dt extends s.Tag{}exports.IsInFrustum=Dt;class ht extends s.Data{}exports.TestLoadRef=ht,o(ht,"data",{position:n.Array(),name:n.Ref("")});class vt extends s.Value{}exports.GameUIStore=vt;class At extends s.Tag{}exports.DirectUserToOrigin=At;class Ct extends s.Tag{}exports.WaitingForBiomeResolution=Ct;class Pt extends s.Tag{}exports.ShowBiomeResolution=Pt;class wt extends s.Tag{}exports.FinalBiomeResolution=wt;class Vt extends s.Tag{}exports.FinalBiomeResolutionLines=Vt;class Gt extends s.Tag{}exports.EndGameState=Gt;class Ft extends s.Tag{}exports.TransitionToNextBiome=Ft;class kt extends s.Tag{}exports.SafeToSwapBiomes=kt;class bt extends s.Data{}exports.BoxHelper=bt,o(bt,"data",{entity:n.Ref(null),box:n.Ref(null)});class Lt extends s.Data{}exports.GroundAssetToken=Lt,o(Lt,"data",{type:n.Ref("")});class Ot extends s.Value{}exports.TokensDiscoveredSet=Ot;class It extends s.Data{}exports.WrittenStanzaLine=It,o(It,"data",{started:n.Ref(!1),elapsed:n.Ref(0),startDelay:n.Ref(.33),text:n.Ref(""),line:n.Array([]),type:n.Ref(""),inputs:n.Array([]),fragments:n.Array([]),originPosition2D:n.Vector2(),lastPosition2D:n.Vector2(),active:n.Ref(!1),initial:n.Ref(!0),distance:n.Ref(0),changed:n.Ref(!1),children:n.Array([])});class Ut extends s.Tag{}exports.WrittenStanzaLineActive=Ut;class Mt extends s.Data{}exports.StanzaLineSpawningAsset=Mt,o(Mt,"data",{x:n.Ref(0),z:n.Ref(0),biome:n.Ref("")});class Wt extends s.Data{}exports.SpawnedFlora=Wt,o(Wt,"data",{height:n.Ref(1),time:n.Ref(0),aspect:n.Ref(1),spawnTime:n.Ref(0),delay:n.Ref(0),duration:n.Ref(5),animateDuration:n.Ref(.75)});class Ht extends s.Data{reset(){super.reset(),this.playing=!1,this.delay=0,this.elapsed=0,this.finished=!1,this.frame=0,this.dirty=!0,this.lastFrame=null,this.currentLoop=0,null!=this.loopStart&&this.looping&&(this.frame=this.loopStart)}start(){this.playing=!0,this.elapsed=0,this.frame=0,this.finished=!1,this.delay=0,this.dirty=!0,this.lastFrame=null,this.currentLoop=0,null!=this.loopStart&&this.looping&&(this.frame=this.loopStart)}}exports.SpriteAnimation=Ht,o(Ht,"data",{key:n.Ref(""),delay:n.Ref(0),playing:n.Ref(!1),finished:n.Ref(!1),currentLoop:n.Ref(0),looping:n.Ref(!1),elapsed:n.Ref(0),frame:n.Ref(0),sheet:n.Ref(null),lastFrame:n.Ref(null),dirty:n.Ref(!0),fixSpriteAspect:n.Ref(!0),speed:n.Ref(1),loopStart:n.Ref(null),loopEnd:n.Ref(null),onLoopEnd:n.Ref(null)});class Bt extends s.Data{}exports.SpriteAnimationLazyLoadSheet=Bt,o(Bt,"data",{id:n.Ref(""),playOnLoad:n.Ref(!0),fixSpriteAspectOnLoad:n.Ref(!0)});class Et extends s.Tag{}exports.JournalOpen=Et;class jt extends s.Tag{}exports.PauseOpen=jt;class zt extends s.Tag{}exports.ButtonHover=zt;class Kt extends s.Tag{}exports.ButtonClick=Kt;class qt extends s.Tag{}exports.GameStarted=qt;class Zt extends s.Tag{}exports.SpriteAnimationOriginTreeTag=Zt;class Nt extends s.Data{}exports.CameraFocusOnTarget=Nt,o(Nt,"data",{target:n.Vector3()});class Qt extends s.Data{}exports.GlowingHaikuCard=Qt,o(Qt,"data",{angle:n.Ref(0),radius:n.Ref(1),y:n.Ref(0),speed:n.Ref(1),driftPhase:n.Ref(0),driftAmplitude:n.Ref(1),driftFrequency:n.Ref(1),time:n.Ref(0),opacity:n.Ref(1),rgbOpaque:n.Color(),rgbTransparent:n.Color()});class _t extends s.Data{}exports.FloatingToken=_t,o(_t,"data",{type:n.Ref(""),map:n.Ref(null),velocity2D:n.Vector2(0,0),position2D:n.Vector2(0,0),offset3D:n.Vector3(0,0,0),offsetHeight:n.Ref(2),offsetY:n.Ref(0),animateToTreeTime:n.Ref(0),animateToTreeDelay:n.Ref(0),animateToTreeDuration:n.Ref(2),rotationSpeed:n.Ref(1),rotationAngleOffset:n.Ref(1),rotationAxis:n.Vector3(0,0,0),scale:n.Ref(1),time:n.Ref(0),started:n.Ref(!1),speed:n.Ref(1)});class Yt extends s.Tag{}exports.FloatingTokenTargetUser=Yt;class Jt extends s.Tag{}exports.FloatingTokenShouldTargetTree=Jt;class Xt extends s.Value{}exports.GLTFSpawnItemsMap=Xt;class $t extends s.Tag{}exports.UserCarryingTokenCollectionFeature=$t;class es extends s.Tag{}exports.WaterFollowParticle=es;class ts extends s.Value{}exports.HatTipPoint=ts,o(ts,"value",n.Vector3(0,0,0));class ss extends s.Tag{}exports.HatTipWindLineTag=ss;class as extends s.Value{}exports.HatTipWindLineSound=as,o(as,"value",n.Ref(""));class rs extends s.Tag{}exports.MoveUserToOrigin=rs;class os extends s.Tag{}exports.OriginTreeIntroSequence=os;class ns extends s.Tag{}exports.OriginTreeIntroSequenceStarted=ns;class ls extends s.Data{}exports.GameLandingCameraDrift=ls,o(ls,"data",{fixed:n.Ref(null)});class is extends s.Tag{}exports.CameraZoomOut=is;class ps extends s.Tag{}exports.LetterboxBars=ps;class xs extends s.Data{}exports.ScreenFade=xs,o(xs,"data",{from:n.Ref(0),to:n.Ref(1),duration:n.Ref(1),delay:n.Ref(0),ease:n.Ref("sineIn"),callbackOnStart:n.Ref(null),callbackOnFinish:n.Ref(null)});class ds extends s.Data{}exports.TextHint=ds,o(ds,"data",{text:n.Ref(""),delay:n.Ref(0),position:n.Vector3(0,0,0),fontSize:n.Ref(32),time:n.Ref(0),duration:n.Ref(2),killing:n.Ref(!1)});class cs extends s.Tag{}exports.KillTextHint=cs;class fs extends s.Tag{}exports.HaikuCardShown=fs;class us extends s.Tag{}exports.HaikuCardSaved=us;class Rs extends s.Tag{}exports.BlockUserMove=Rs;class gs extends s.Tag{}exports.HideCharacter=gs;class ms extends s.Tag{}exports.HideHUD=ms;class Ts extends s.Tag{}exports.TutorialState=Ts;class Ss extends s.Tag{}exports.TutorialTextHint=Ss;class ys extends s.Tag{}exports.TutorialBarrenGround=ys;class Ds extends s.Tag{}exports.UserForceApplied=Ds;class hs extends s.Tag{}exports.BlockTokenCollection=hs;class vs extends s.Tag{}exports.CanSetIntroTags=vs;class As extends s.Data{}exports.ObjectiveText=As,o(As,"data",{text:n.Ref(""),delay:n.Ref(0)});class Cs extends s.Data{}exports.HintOrb=Cs,o(Cs,"data",{origin:n.Vector3(),scale:n.Ref(1),time:n.Ref(0),triggered:n.Ref(!1),trigger:n.Ref(null),scaleFactor:n.Ref(1),line:n.Ref(null)});class Ps extends s.Data{}exports.WindLine=Ps,o(Ps,"data",{time:n.Ref(0),animateDuration:n.Ref(.25),duration:n.Ref(4)});class ws extends s.Data{}exports.RainDrop=ws,o(ws,"data",{splat:n.Ref(!1),time:n.Ref(0),speed:n.Ref(5),animateDuration:n.Ref(.25),splatterSpawnPosition:n.Vector3(0,0,0)});class Vs extends s.Data{}exports.RainDropSplatter=Vs,o(Vs,"data",{time:n.Ref(0),animateDuration:n.Ref(.25),duration:n.Ref(1)});class Gs extends s.Tag{}exports.Raining=Gs;class Fs extends s.Tag{}exports.LastWalkedLake=Fs;class ks extends s.Data{}exports.AnimalSpawn=ks,o(ks,"data",{biome:n.Ref(""),animal:n.Ref(""),position:n.Vector3(0,0,0),lake:n.Ref(!1),time:n.Ref(0),duration:n.Ref(1)});class bs extends s.Tag{}exports.Animal=bs;class Ls extends s.Tag{}exports.AnimateInCharacter=Ls;class Os extends s.Tag{}exports.AnimateOutCharacter=Os;class Is extends s.Data{}exports.TokenForCompass=Is,o(Is,"data",{distanceSq:n.Ref(0)});class Us extends s.Data{}exports.FloatingEndLine=Us,o(Us,"data",{time:n.Ref(0),speed:n.Ref(.5),animateDuration:n.Ref(.25),duration:n.Ref(1),delay:n.Ref(0)});class Ms extends s.Data{}exports.TutorialMessage=Ms,o(Ms,"data",{id:n.Ref(""),iconMode:n.Ref(!1),token:n.Ref(""),message:n.Ref(""),duration:n.Ref(4),time:n.Ref(0),delay:n.Ref(0)});class Ws extends s.Tag{}exports.GameFinished=Ws;class Hs extends s.Tag{}exports.FoxSpriteTag=Hs;class Bs extends s.Tag{}exports.FoxPurring=Bs;class Es extends s.Tag{}exports.FoxHm=Es;class js extends s.Tag{}exports.WaterFishPlaceholderTag=js;class zs extends s.Tag{}exports.UserHasHit=zs;class Ks extends s.Data{}exports.CompassVisible=Ks,o(Ks,"data",{position:n.Vector3(0,0,0)});class qs extends s.Data{}exports.Snowflake=qs,o(qs,"data",{position:n.Vector3(0,0,0),velocity:n.Vector3(0,0,0),size:n.Ref(.1),time:n.Ref(0),duration:n.Ref(5),animateDuration:n.Ref(.2),delay:n.Ref(0)});class Zs extends s.Tag{}exports.ResetToCameraDrift=Zs;class Ns extends s.Tag{}exports.TokenIsCollecting=Ns;class Qs extends s.Tag{}exports.TriggerTokenLine=Qs;class _s extends s.Data{}exports.TokenChildren=_s,o(_s,"data",{complete:n.Ref(!1),line:n.Ref(null),radius:n.Ref(null),center:n.Ref(null),markers:n.Array([]),group:n.Ref(null),removing:n.Ref(!1),removeTime:n.Ref(0),removeDelay:n.Ref(1),killing:n.Ref(!1),stanza:n.Ref(null),type:n.Ref(""),shadow:n.Ref(null),x:n.Ref(0),z:n.Ref(0),stanzaIndex:n.Ref(0)});class Ys extends s.Tag{}exports.CollectTokenOrb=Ys;class Js extends s.Data{}exports.GIFRecord=Js,o(Js,"data",{encoder:n.Ref(null),frame:n.Ref(0),started:n.Ref(!1),duration:n.Ref(5),width:n.Ref(512),height:n.Ref(512),maxColors:n.Ref(256),format:n.Ref("rgb565")});class Xs extends s.Tag{}exports.ClearInputPress=Xs;class $s extends s.Value{}exports.AnimalSound=$s,o($s,"value",n.Ref(""));class ea extends s.Value{}exports.FlashSound=ea,o(ea,"value",n.Ref(""));class ta extends s.Tag{}exports.CapeMagicalEffect=ta;class sa extends s.Data{}exports.AutoRemoveCapeMagicalEffect=sa,o(sa,"data",{elapsed:n.Ref(0),delay:n.Ref(2)});class aa extends s.Data{}exports.ParticleEmit=aa,o(aa,"data",{position:n.Vector3(0,0,0),elapsed:n.Ref(0),duration:n.Ref(1)});class ra extends s.Data{}exports.MusicalOrb=ra,o(ra,"data",{elapsed:n.Ref(0),duration:n.Ref(4),killing:n.Ref(!1),hit:n.Ref(!1)});class oa extends s.Tag{}exports.OutroFinished=oa;class na extends s.Tag{}exports.TriggerTreeTransitionAudio=na;
},{"three":"IV0r","../alec-svelte":"M3eo","../alec":"beHZ"}],"injP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./tags");Object.keys(e).forEach(function(t){"default"!==t&&"__esModule"!==t&&(t in exports&&exports[t]===e[t]||Object.defineProperty(exports,t,{enumerable:!0,get:function(){return e[t]}}))});
},{"./tags":"UVYK"}],"tgmD":[function(require,module,exports) {
"use strict";module.exports=(e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`));
},{}],"YtoU":[function(require,module,exports) {
"use strict";var e="%[a-f0-9]{2}",t=new RegExp(e,"gi"),r=new RegExp("("+e+")+","gi");function n(e,t){try{return decodeURIComponent(e.join(""))}catch(c){}if(1===e.length)return e;t=t||1;var r=e.slice(0,t),o=e.slice(t);return Array.prototype.concat.call([],n(r),n(o))}function o(e){try{return decodeURIComponent(e)}catch(c){for(var r=e.match(t),o=1;o<r.length;o++)r=(e=n(r,o).join("")).match(t);return e}}function c(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},n=r.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(u){var c=o(n[0]);c!==n[0]&&(t[n[0]]=c)}n=r.exec(e)}t["%C2"]="�";for(var a=Object.keys(t),p=0;p<a.length;p++){var i=a[p];e=e.replace(new RegExp(i,"g"),t[i])}return e}module.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return c(e)}};
},{}],"SVkH":[function(require,module,exports) {
"use strict";module.exports=((e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const r=e.indexOf(t);return-1===r?[e]:[e.slice(0,r),e.slice(r+t.length)]});
},{}],"EONo":[function(require,module,exports) {
"use strict";module.exports=function(r,e){for(var t={},n=Object.keys(r),s=Array.isArray(e),a=0;a<n.length;a++){var i=n[a],o=r[i];(s?-1!==e.indexOf(i):e(i,o,r))&&(t[i]=o)}return t};
},{}],"TuMS":[function(require,module,exports) {
"use strict";const r=require("strict-uri-encode"),e=require("decode-uri-component"),t=require("split-on-first"),n=require("filter-obj"),o=r=>null==r,a=Symbol("encodeFragmentIdentifier");function s(r){switch(r.arrayFormat){case"index":return e=>(t,n)=>{const o=t.length;return void 0===n||r.skipNull&&null===n||r.skipEmptyString&&""===n?t:null===n?[...t,[u(e,r),"[",o,"]"].join("")]:[...t,[u(e,r),"[",u(o,r),"]=",u(n,r)].join("")]};case"bracket":return e=>(t,n)=>void 0===n||r.skipNull&&null===n||r.skipEmptyString&&""===n?t:null===n?[...t,[u(e,r),"[]"].join("")]:[...t,[u(e,r),"[]=",u(n,r)].join("")];case"comma":case"separator":case"bracket-separator":{const e="bracket-separator"===r.arrayFormat?"[]=":"=";return t=>(n,o)=>void 0===o||r.skipNull&&null===o||r.skipEmptyString&&""===o?n:(o=null===o?"":o,0===n.length?[[u(t,r),e,u(o,r)].join("")]:[[n,u(o,r)].join(r.arrayFormatSeparator)])}default:return e=>(t,n)=>void 0===n||r.skipNull&&null===n||r.skipEmptyString&&""===n?t:null===n?[...t,u(e,r)]:[...t,[u(e,r),"=",u(n,r)].join("")]}}function i(r){let e;switch(r.arrayFormat){case"index":return(r,t,n)=>{e=/\[(\d*)\]$/.exec(r),r=r.replace(/\[\d*\]$/,""),e?(void 0===n[r]&&(n[r]={}),n[r][e[1]]=t):n[r]=t};case"bracket":return(r,t,n)=>{e=/(\[\])$/.exec(r),r=r.replace(/\[\]$/,""),e?void 0!==n[r]?n[r]=[].concat(n[r],t):n[r]=[t]:n[r]=t};case"comma":case"separator":return(e,t,n)=>{const o="string"==typeof t&&t.includes(r.arrayFormatSeparator),a="string"==typeof t&&!o&&l(t,r).includes(r.arrayFormatSeparator);t=a?l(t,r):t;const s=o||a?t.split(r.arrayFormatSeparator).map(e=>l(e,r)):null===t?t:l(t,r);n[e]=s};case"bracket-separator":return(e,t,n)=>{const o=/(\[\])$/.test(e);if(e=e.replace(/\[\]$/,""),!o)return void(n[e]=t?l(t,r):t);const a=null===t?[]:t.split(r.arrayFormatSeparator).map(e=>l(e,r));void 0!==n[e]?n[e]=[].concat(n[e],a):n[e]=a};default:return(r,e,t)=>{void 0!==t[r]?t[r]=[].concat(t[r],e):t[r]=e}}}function c(r){if("string"!=typeof r||1!==r.length)throw new TypeError("arrayFormatSeparator must be single character string")}function u(e,t){return t.encode?t.strict?r(e):encodeURIComponent(e):e}function l(r,t){return t.decode?e(r):r}function p(r){return Array.isArray(r)?r.sort():"object"==typeof r?p(Object.keys(r)).sort((r,e)=>Number(r)-Number(e)).map(e=>r[e]):r}function f(r){const e=r.indexOf("#");return-1!==e&&(r=r.slice(0,e)),r}function y(r){let e="";const t=r.indexOf("#");return-1!==t&&(e=r.slice(t)),e}function m(r){const e=(r=f(r)).indexOf("?");return-1===e?"":r.slice(e+1)}function d(r,e){return e.parseNumbers&&!Number.isNaN(Number(r))&&"string"==typeof r&&""!==r.trim()?r=Number(r):!e.parseBooleans||null===r||"true"!==r.toLowerCase()&&"false"!==r.toLowerCase()||(r="true"===r.toLowerCase()),r}function g(r,e){c((e=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},e)).arrayFormatSeparator);const n=i(e),o=Object.create(null);if("string"!=typeof r)return o;if(!(r=r.trim().replace(/^[?#&]/,"")))return o;for(const a of r.split("&")){if(""===a)continue;let[r,s]=t(e.decode?a.replace(/\+/g," "):a,"=");s=void 0===s?null:["comma","separator","bracket-separator"].includes(e.arrayFormat)?s:l(s,e),n(l(r,e),s,o)}for(const t of Object.keys(o)){const r=o[t];if("object"==typeof r&&null!==r)for(const t of Object.keys(r))r[t]=d(r[t],e);else o[t]=d(r,e)}return!1===e.sort?o:(!0===e.sort?Object.keys(o).sort():Object.keys(o).sort(e.sort)).reduce((r,e)=>{const t=o[e];return Boolean(t)&&"object"==typeof t&&!Array.isArray(t)?r[e]=p(t):r[e]=t,r},Object.create(null))}exports.extract=m,exports.parse=g,exports.stringify=((r,e)=>{if(!r)return"";c((e=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},e)).arrayFormatSeparator);const t=t=>e.skipNull&&o(r[t])||e.skipEmptyString&&""===r[t],n=s(e),a={};for(const o of Object.keys(r))t(o)||(a[o]=r[o]);const i=Object.keys(a);return!1!==e.sort&&i.sort(e.sort),i.map(t=>{const o=r[t];return void 0===o?"":null===o?u(t,e):Array.isArray(o)?0===o.length&&"bracket-separator"===e.arrayFormat?u(t,e)+"[]":o.reduce(n(t),[]).join("&"):u(t,e)+"="+u(o,e)}).filter(r=>r.length>0).join("&")}),exports.parseUrl=((r,e)=>{e=Object.assign({decode:!0},e);const[n,o]=t(r,"#");return Object.assign({url:n.split("?")[0]||"",query:g(m(r),e)},e&&e.parseFragmentIdentifier&&o?{fragmentIdentifier:l(o,e)}:{})}),exports.stringifyUrl=((r,e)=>{e=Object.assign({encode:!0,strict:!0,[a]:!0},e);const t=f(r.url).split("?")[0]||"",n=exports.extract(r.url),o=exports.parse(n,{sort:!1}),s=Object.assign(o,r.query);let i=exports.stringify(s,e);i&&(i=`?${i}`);let c=y(r.url);return r.fragmentIdentifier&&(c=`#${e[a]?u(r.fragmentIdentifier,e):r.fragmentIdentifier}`),`${t}${i}${c}`}),exports.pick=((r,e,t)=>{t=Object.assign({parseFragmentIdentifier:!0,[a]:!1},t);const{url:o,query:s,fragmentIdentifier:i}=exports.parseUrl(r,t);return exports.stringifyUrl({url:o,query:n(s,e),fragmentIdentifier:i},t)}),exports.exclude=((r,e,t)=>{const n=Array.isArray(e)?r=>!e.includes(r):(r,t)=>!e(r,t);return exports.pick(r,n,t)});
},{"strict-uri-encode":"tgmD","decode-uri-component":"YtoU","split-on-first":"SVkH","filter-obj":"EONo"}],"Bj6B":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseQuery=r,exports.default=void 0;var e=t(require("query-string"));function t(e){return e&&e.__esModule?e:{default:e}}function r(){if("undefined"==typeof window)return{};const t=e.default.parse(window.location.search);return Object.keys(t).forEach(e=>{null===t[e]&&(t[e]=!0),"false"===t[e]&&(t[e]=!1),"true"===t[e]&&(t[e]=!0),u(t[e])&&(t[e]=Number(t[e]))}),t}function u(e){return"number"==typeof e||(!!/^0x[0-9a-f]+$/i.test(e)||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(e))}var n=r();exports.default=n;
},{"query-string":"TuMS"}],"nZps":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t,exports.hideLoader=n;const e=!0;function t(){const e=Symbol.for("wayfinder.config");let t;return e in window?t=window[e]:(window[e]={},t=window[e]),t.context||t.contextLoaded||(t.contextLoaded=!0,t.context=o(),t.context.canvas.style.display="none"),t.embed=!1,t.haikusPerBiome=2,t}function n(){const e=document.querySelector(".loader");e&&(e.style.display="none")}function o(){return function(e,t,n){const o=[];"webgl2"===t&&o.push("webgl2");let r;o.push("webgl","experimental-webgl");for(let a=0;a<o.length;a++)try{if(null!=(r=e.getContext(o[a],n)))return r}catch(l){}return null}(t().canvas||document.createElement("canvas"),e?"webgl2":"webgl",{alpha:!1,antialias:!1,stencil:!1,depth:!0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1})}
},{}],"FOUO":[function(require,module,exports) {
"use strict";function e(e,t){return void 0===e?t:e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"piS6":[function(require,module,exports) {
"use strict";function t(){const t=new Uint16Array(4);for(let e=0;e<t.length;e++)t[e]=65536*Math.random();return t}function e(e){const n=Math.pow(2,-32),r=32557;let o=new Uint16Array(4);return s(e),{seed:s,next(){const t=o[0],e=o[1],s=o[2],u=o[3],a=33103+r*t|0,c=63335+r*e+(19605*t+(a>>>16))|0,l=31614+r*s+19605*e+(62509*t+(c>>>16))|0,f=5125+r*u+(19605*s+62509*e)+(22609*t+(l>>>16));o[0]=a,o[1]=c,o[2]=l,o[3]=f;const i=(u<<21)+((u>>2^s)<<5)+((s>>2^e)>>11);return n*((i>>>(u>>11)|i<<(31&-(u>>11)))>>>0)}};function s(e){e||(e=t());for(let t=0;t<o.length;t++)o[t]=e[t]}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getRandomState=t,exports.default=e;
},{}],"LMfK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=h;var e=a(require("../config")),t=a(require("./defined")),r=o(require("./prng-pcg")),n=a(require("./query-string"));function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function a(e){return e&&e.__esModule?e:{default:e}}const i=(0,e.default)().embed,f=!i&&!n.default.deterministic,l=new Uint16Array(i?[39783,27946,21768,27541]:[9697,37140,38490,15272]);console.log("Random Seed:",[...l]);const c=(0,r.default)(l);function h(){let e=null;null==e&&(e=h.nextSeed());const n=(0,r.default)(e);let u=null,o=!1;return{seed(e){n.seed(e),u=null,o=!1},value:a,valueNonZero:function(){var e=0;for(;0===e;)e=a();return e},sign:function(){return i()?1:-1},boolean:i,chance:function(e){if("number"!=typeof(e=(0,t.default)(e,.5)))throw new TypeError("expected n to be a number");return a()<e},range:f,rangeFloor:l,pick:function(e){return 0===e.length?void 0:e[l(0,e.length)]},shuffle:c,onCircle:s,insideCircle:function(e,r){e=(0,t.default)(e,1),s(1,r=r||[]);var n=e*Math.sqrt(a());return r[0]*=n,r[1]*=n,r},onSphere:function(e,r){e=(0,t.default)(e,1),r=r||[];var n=a()*Math.PI*2,u=2*a()-1,o=n,i=Math.acos(u);return r[0]=e*Math.sin(i)*Math.cos(o),r[1]=e*Math.sin(i)*Math.sin(o),r[2]=e*Math.cos(i),r},insideSphere:function(e,r){e=(0,t.default)(e,1),r=r||[];var n=a()*Math.PI*2,u=2*a()-1,o=a(),i=n,f=Math.acos(u),l=e*Math.cbrt(o);return r[0]=l*Math.sin(f)*Math.cos(i),r[1]=l*Math.sin(f)*Math.sin(i),r[2]=l*Math.cos(f),r},quaternion:function(e){e=e||[];var t=a(),r=a(),n=a(),u=Math.sqrt(1-t),o=Math.sqrt(t),i=2*Math.PI*r,f=2*Math.PI*n,l=Math.sin(i)*u,c=Math.cos(i)*u,h=Math.sin(f)*o,s=Math.cos(f)*o;return e[0]=l,e[1]=c,e[2]=h,e[3]=s,e},weighted:p,weightedSet:function(e){return 0===(e=e||[]).length?null:e[d(e)].value},weightedSetIndex:d,deck:function(e){e=c(e);let t=0;return{get array(){return e},get index(){return t},get current(){return e[t]},reset(){this.shuffle(),t=0},next(){let r=this.current;return++t>e.length-1&&(this.shuffle(),t=0),r},nextIndex(){let r=t;return++t>e.length-1&&(this.shuffle(),t=0),r},shuffle(){e=c(e)}}},gaussian:function(e,r){if(e=(0,t.default)(e,0),r=(0,t.default)(r,1),o){o=!1;var n=u;return u=null,e+r*n}var i=0,f=0,l=0;do{i=2*a()-1,f=2*a()-1,l=i*i+f*f}while(l>=1||0===l);var c=Math.sqrt(-2*Math.log(l)/l);return u=f*c,o=!0,e+r*(i*c)}};function a(){return n.next()}function i(){return a()>.5}function f(e,t){if(void 0===t&&(t=e,e=0),"number"!=typeof e||"number"!=typeof t)throw new TypeError("Expected all arguments to be numbers");return a()*(t-e)+e}function l(e,t){if(void 0===t&&(t=e,e=0),"number"!=typeof e||"number"!=typeof t)throw new TypeError("Expected all arguments to be numbers");return Math.floor(f(e,t))}function c(e){if(!Array.isArray(e))throw new TypeError("Expected Array, got "+typeof e);for(var t,r,n=e.length,u=e.slice();n;)t=Math.floor(a()*n--),r=u[n],u[n]=u[t],u[t]=r;return u}function s(e,r){e=(0,t.default)(e,1),r=r||[];var n=2*a()*Math.PI;return r[0]=e*Math.cos(n),r[1]=e*Math.sin(n),r}function d(e){return 0===(e=e||[]).length?-1:p(e.map(function(e){return e.weight}))}function p(e){if(0===(e=e||[]).length)return-1;var t,r=0;for(t=0;t<e.length;t++)r+=e[t];if(r<=0)throw new Error("Weights must sum to > 0");var n=a()*r;for(t=0;t<e.length;t++){if(n<e[t])return t;n-=e[t]}return 0}}h.nextSeed=function(e=new Uint16Array(4)){for(let t=0;t<4;t++)e[t]=f?65536*Math.random():65536*c.next();return e},h.getRandomState=r.getRandomState;
},{"../config":"nZps","./defined":"FOUO","./prng-pcg":"piS6","./query-string":"Bj6B"}],"cE2j":[function(require,module,exports) {
module.exports=function(){for(var o=0;o<arguments.length;o++)if(void 0!==arguments[o])return arguments[o]};
},{}],"sQb4":[function(require,module,exports) {
function r(r,e,o){if("number"!=typeof e||"number"!=typeof o)throw new TypeError('Must specify "to" and "from" arguments as numbers');if(e>o){var t=e;e=o,o=t}var n=o-e;return 0===n?o:r-n*Math.floor((r-e)/n)}module.exports=r;
},{}],"RN3r":[function(require,module,exports) {
var r=require("defined"),n=require("./lib/wrap"),e=Number.EPSILON;function t(r,n,e){return n<e?r<n?n:r>e?e:r:r<e?e:r>n?n:r}function o(r){return t(r,0,1)}function u(r,n,e){return r*(1-e)+n*e}function a(r,n,t){return Math.abs(r-n)<e?0:(t-r)/(n-r)}function i(r,n,e){var o=t(a(r,n,e),0,1);return o*o*(3-2*o)}function f(n,e){return e=r(e,0),"number"==typeof n&&isFinite(n)?n:e}function p(n){if("number"!=typeof n)throw new TypeError("Expected dims argument");return function(e,t){var o;t=r(t,0),null==e?o=t:"number"==typeof e&&isFinite(e)&&(o=e);var u,a=[];if(null==o)for(u=0;u<n;u++)a[u]=f(e[u],t);else for(u=0;u<n;u++)a[u]=o;return a}}function c(r,n,e,t){if(t=t||[],r.length!==n.length)throw new TypeError("min and max array are expected to have the same length");for(var o=0;o<r.length;o++)t[o]=u(r[o],n[o],e);return t}function m(n,e){if("number"!=typeof(n=r(n,0)))throw new TypeError("Expected n argument to be a number");for(var t=[],o=0;o<n;o++)t.push(e);return t}function h(n,e){if("number"!=typeof(n=r(n,0)))throw new TypeError("Expected n argument to be a number");"boolean"==typeof(e=e||{})&&(e={endpoint:!0});var t=r(e.offset,0);return e.endpoint?m(n).map(function(r,e){return n<=1?0:(e+t)/(n-1)}):m(n).map(function(r,e){return(e+t)/n})}function l(r,n,e){n=t(n,0,1);var o=r.length-1,a=n*o,i=Math.floor(a),f=a-i,p=Math.min(i+1,o),m=r[i%r.length],h=r[p%r.length];if("number"==typeof m&&"number"==typeof h)return u(m,h,f);if(Array.isArray(m)&&Array.isArray(h))return c(m,h,f,e);throw new TypeError("Mismatch in value type of two array elements: "+i+" and "+p)}function y(r,n){return(r%n+n)%n}function d(r){return r*Math.PI/180}function s(r){return 180*r/Math.PI}function b(r){return r-Math.floor(r)}function g(r){return r>0?1:r<0?-1:0}function v(r,n){return r=y(r,2*n),n-Math.abs(r-n)}function w(r,n,e,t){return u(r,n,1-Math.exp(-e*t))}function x(r,n,e,t,o){o=o||[];for(var u=0;u<r.length;u++)o[u]=w(r[u],n[u],e,t);return o}function M(r,n,t,o,u,a){if(Math.abs(n-t)<e)return o;var i=(r-n)/(t-n)*(u-o)+o;return a&&(u<o?i<u?i=u:i>o&&(i=o):i>u?i=u:i<o&&(i=o)),i}module.exports={mod:y,fract:b,sign:g,degToRad:d,radToDeg:s,wrap:n,pingPong:v,linspace:h,lerp:u,lerpArray:c,inverseLerp:a,lerpFrames:l,clamp:t,clamp01:o,smoothstep:i,damp:w,dampArray:x,mapRange:M,expand2D:p(2),expand3D:p(3),expand4D:p(4)};
},{"defined":"cE2j","./lib/wrap":"sQb4"}],"Ov1X":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e={dampVector:!0,sign:!0,moveTowardVector:!0,moveToward:!0,repeat:!0,deltaAngle:!0,wrapAngle:!0,lerpAngle:!0,dampAngle:!0,getDistSq2D:!0,quaternionFromNormal:!0,sphericalToCartesian:!0,getScreenSpaceCameraUp:!0,getScreenSpaceCameraRight:!0,addScreenSpaceUV:!0,map:!0};exports.dampVector=i,exports.sign=u,exports.moveTowardVector=l,exports.moveToward=d,exports.repeat=f,exports.deltaAngle=m,exports.wrapAngle=x,exports.lerpAngle=h,exports.dampAngle=g,exports.getDistSq2D=M,exports.quaternionFromNormal=v,exports.sphericalToCartesian=y,exports.getScreenSpaceCameraUp=w,exports.getScreenSpaceCameraRight=P,exports.addScreenSpaceUV=S,exports.map=I;var t=require("canvas-sketch-util/math");Object.keys(t).forEach(function(r){"default"!==r&&"__esModule"!==r&&(Object.prototype.hasOwnProperty.call(e,r)||r in exports&&exports[r]===t[r]||Object.defineProperty(exports,r,{enumerable:!0,get:function(){return t[r]}}))});var r=o(require("three"));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var s=a?Object.getOwnPropertyDescriptor(e,c):null;s&&(s.get||s.set)?Object.defineProperty(o,c,s):o[c]=e[c]}return o.default=e,r&&r.set(e,o),o}const a=new r.Vector3,c=new r.Vector3,s=new r.Vector3,p=new r.Vector3;function i(e,r,n,o,a=e){return a.x=(0,t.damp)(e.x,r.x,n,o),a.y=(0,t.damp)(e.y,r.y,n,o),a.z=(0,t.damp)(e.z,r.z,n,o),a}function u(e){return e>=0?1:-1}function l(e,t,r,n,o=e){p.copy(t).sub(e);const a=p.length();0!==a&&p.divideScalar(a);const c=r*n;return a<=c?o.copy(t):(o.addScaledVector(p,c),o)}function d(e,t,r,n){const o=r*n;return Math.abs(t-e)<=o?t:e+u(t-e)*o}function f(e,t){return e-Math.floor(e/t)*t}function m(e,t){let r=f(t-e,2*Math.PI);return r>Math.PI&&(r-=2*Math.PI),r}function x(e){let t=f(e,2*Math.PI);return t>Math.PI&&(t-=2*Math.PI),t}function h(e,r,n){let o=f(r-e,2*Math.PI);return o>Math.PI&&(o-=2*Math.PI),e+o*(0,t.clamp01)(n)}function g(e,t,r,n){return e+m(e,t)*(1-Math.exp(-r*n))}function M(e,t){const r=t.x-e.x,n=t.z-e.z;return r*r+n*n}function v(e,t){if(t=t||new r.Quaternion,e.y>.99999)t.set(0,0,0,1);else if(e.y<-.99999)t.set(1,0,0,0);else{s.set(e.z,0,-e.x).normalize();var n=Math.acos(e.y);t.setFromAxisAngle(s,n)}return t}function y(e,t,n=new r.Vector3){return e=Math.PI/2-e,n.set(Math.sin(e)*Math.sin(t),Math.cos(e),Math.sin(e)*Math.cos(t)),n}function w(e,t=new r.Vector3){const n=e.matrixWorldInverse.elements[4],o=e.matrixWorldInverse.elements[5],a=e.matrixWorldInverse.elements[6];return t.set(n,o,a),t}function P(e,t=new r.Vector3){const n=e.matrixWorldInverse.elements[0],o=e.matrixWorldInverse.elements[1],a=e.matrixWorldInverse.elements[2];return t.set(n,o,a),t}function S(e,t,r,n){const o=w(e,a),s=P(e,c);return t.addScaledVector(s,r),t.addScaledVector(o,n),t}function I(e,t,r,n,o){return n+(o-n)*(e-t)/(r-t)}
},{"canvas-sketch-util/math":"RN3r","three":"IV0r"}],"PRCQ":[function(require,module,exports) {
function r(r){var e=2.5949095;return(r*=2)<1?r*r*((e+1)*r-e)*.5:.5*((r-=2)*r*((e+1)*r+e)+2)}module.exports=r;
},{}],"zIMB":[function(require,module,exports) {
function r(r){var e=1.70158;return r*r*((e+1)*r-e)}module.exports=r;
},{}],"p5ib":[function(require,module,exports) {
function r(r){var e=1.70158;return--r*r*((e+1)*r+e)+1}module.exports=r;
},{}],"Neu6":[function(require,module,exports) {
function r(r){var e=r*r;return r<4/11?7.5625*e:r<8/11?9.075*e-9.9*r+3.4:r<.9?4356/361*e-35442/1805*r+16061/1805:10.8*r*r-20.52*r+10.72}module.exports=r;
},{}],"T8wt":[function(require,module,exports) {
var e=require("./bounce-out");function r(r){return r<.5?.5*(1-e(1-2*r)):.5*e(2*r-1)+.5}module.exports=r;
},{"./bounce-out":"Neu6"}],"UYy4":[function(require,module,exports) {
var e=require("./bounce-out");function r(r){return 1-e(1-r)}module.exports=r;
},{"./bounce-out":"Neu6"}],"V8jc":[function(require,module,exports) {
function t(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}module.exports=t;
},{}],"ehrO":[function(require,module,exports) {
function t(t){return 1-Math.sqrt(1-t*t)}module.exports=t;
},{}],"w51Y":[function(require,module,exports) {
function t(t){return Math.sqrt(1- --t*t)}module.exports=t;
},{}],"vclg":[function(require,module,exports) {
function o(o){return o<.5?4*o*o*o:.5*Math.pow(2*o-2,3)+1}module.exports=o;
},{}],"gVmS":[function(require,module,exports) {
function e(e){return e*e*e}module.exports=e;
},{}],"MmvL":[function(require,module,exports) {
function r(r){var e=r-1;return e*e*e+1}module.exports=r;
},{}],"ddOc":[function(require,module,exports) {
function t(t){return t<.5?.5*Math.sin(13*Math.PI/2*2*t)*Math.pow(2,10*(2*t-1)):.5*Math.sin(-13*Math.PI/2*(2*t-1+1))*Math.pow(2,-10*(2*t-1))+1}module.exports=t;
},{}],"wEBC":[function(require,module,exports) {
function t(t){return Math.sin(13*t*Math.PI/2)*Math.pow(2,10*(t-1))}module.exports=t;
},{}],"reQF":[function(require,module,exports) {
function t(t){return Math.sin(-13*(t+1)*Math.PI/2)*Math.pow(2,-10*t)+1}module.exports=t;
},{}],"kcF4":[function(require,module,exports) {
function o(o){return 0===o||1===o?o:o<.5?.5*Math.pow(2,20*o-10):-.5*Math.pow(2,10-20*o)+1}module.exports=o;
},{}],"qiZq":[function(require,module,exports) {
function o(o){return 0===o?o:Math.pow(2,10*(o-1))}module.exports=o;
},{}],"A8oK":[function(require,module,exports) {
function o(o){return 1===o?o:1-Math.pow(2,-10*o)}module.exports=o;
},{}],"VPfo":[function(require,module,exports) {
function e(e){return e}module.exports=e;
},{}],"RyhL":[function(require,module,exports) {
function e(e){return(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1)}module.exports=e;
},{}],"g0GT":[function(require,module,exports) {
function e(e){return e*e}module.exports=e;
},{}],"jDSy":[function(require,module,exports) {
function e(e){return-e*(e-2)}module.exports=e;
},{}],"lAMl":[function(require,module,exports) {
function o(o){return o<.5?8*Math.pow(o,4):-8*Math.pow(o-1,4)+1}module.exports=o;
},{}],"YTnM":[function(require,module,exports) {
function o(o){return Math.pow(o,4)}module.exports=o;
},{}],"adZE":[function(require,module,exports) {
function o(o){return Math.pow(o-1,3)*(1-o)+1}module.exports=o;
},{}],"P873":[function(require,module,exports) {
function e(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}module.exports=e;
},{}],"l6e8":[function(require,module,exports) {
function e(e){return e*e*e*e*e}module.exports=e;
},{}],"gzrT":[function(require,module,exports) {
function e(e){return--e*e*e*e*e+1}module.exports=e;
},{}],"t4Hf":[function(require,module,exports) {
function t(t){return-.5*(Math.cos(Math.PI*t)-1)}module.exports=t;
},{}],"YFBx":[function(require,module,exports) {
function t(t){var a=Math.cos(t*Math.PI*.5);return Math.abs(a)<1e-14?1:1-a}module.exports=t;
},{}],"X6St":[function(require,module,exports) {
function t(t){return Math.sin(t*Math.PI/2)}module.exports=t;
},{}],"uiPX":[function(require,module,exports) {
module.exports={backInOut:require("./back-in-out"),backIn:require("./back-in"),backOut:require("./back-out"),bounceInOut:require("./bounce-in-out"),bounceIn:require("./bounce-in"),bounceOut:require("./bounce-out"),circInOut:require("./circ-in-out"),circIn:require("./circ-in"),circOut:require("./circ-out"),cubicInOut:require("./cubic-in-out"),cubicIn:require("./cubic-in"),cubicOut:require("./cubic-out"),elasticInOut:require("./elastic-in-out"),elasticIn:require("./elastic-in"),elasticOut:require("./elastic-out"),expoInOut:require("./expo-in-out"),expoIn:require("./expo-in"),expoOut:require("./expo-out"),linear:require("./linear"),quadInOut:require("./quad-in-out"),quadIn:require("./quad-in"),quadOut:require("./quad-out"),quartInOut:require("./quart-in-out"),quartIn:require("./quart-in"),quartOut:require("./quart-out"),quintInOut:require("./quint-in-out"),quintIn:require("./quint-in"),quintOut:require("./quint-out"),sineInOut:require("./sine-in-out"),sineIn:require("./sine-in"),sineOut:require("./sine-out")};
},{"./back-in-out":"PRCQ","./back-in":"zIMB","./back-out":"p5ib","./bounce-in-out":"T8wt","./bounce-in":"UYy4","./bounce-out":"Neu6","./circ-in-out":"V8jc","./circ-in":"ehrO","./circ-out":"w51Y","./cubic-in-out":"vclg","./cubic-in":"gVmS","./cubic-out":"MmvL","./elastic-in-out":"ddOc","./elastic-in":"wEBC","./elastic-out":"reQF","./expo-in-out":"kcF4","./expo-in":"qiZq","./expo-out":"A8oK","./linear":"VPfo","./quad-in-out":"RyhL","./quad-in":"g0GT","./quad-out":"jDSy","./quart-in-out":"lAMl","./quart-in":"YTnM","./quart-out":"adZE","./quint-in-out":"P873","./quint-in":"l6e8","./quint-out":"gzrT","./sine-in-out":"t4Hf","./sine-in":"YFBx","./sine-out":"X6St"}],"cUmx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.tweenTo=i,exports.createTimerTween=s,exports.tweenFromTo=l,exports.setEntityTweenFromTo=c,exports.default=u;var e=o(require("../tags")),t=o(require("three")),n=o(require("../util/math")),r=o(require("eases"));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(r,i,s):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}function i(t,n,r,a,o,i,s){const l=t.entity();return c(l,n,r,n[r],a,o,i,s),l.get(e.TargetKeyTween).assignFromOnStart=!0,l}function s(e,t,n,r,a){const o=e.entity();return c(o,null,null,0,1,t,null,n),o}function l(e,t,n,r,a,o,i,s){const l=e.entity();return c(l,t,n,r,a,o,i,s),l}function c(t,n,r,a,o,i,s,l){t.add(e.TargetKeyTween);const c=t.get(e.TargetKeyTween);c.duration=null!=i?i:1,c.ease=s||"linear",c.target=n,c.key=r,c.from=a,c.to=o,c.delay=l||0,c.elapsed=0,c.finished=!1,c.active=!0,c.started=!1,c.killEntityOnFinish=!0,c.assignFromOnStart=!1}function u(t){const a=t.view(e.TargetKeyTween),o=t.view([e.TargetKeyTween,e.TweenCopyTargetKeyToVectorScalar]);return function(i){const s=Boolean(t.findTag(e.ModalStoppingUserMovement));a.forEach(t=>{const a=t.get(e.TargetKeyTween);if(a.active&&(!a.pauseOnModal||!s)){if(!a.finished){if(a.elapsed>=a.delay){let e=Math.min(1,Math.max(0,a.elapsed-a.delay)/a.duration);"string"==typeof a.ease&&a.ease&&a.ease in r?e=r[a.ease](e):"function"==typeof a.ease&&(e=a.ease(e)),a.started||(a.assignFromOnStart&&a.target&&(a.from=a.target[a.key]),a.started=!0,a.callbackOnStart&&"function"==typeof a.callbackOnStart&&a.callbackOnStart(t)),a.target&&(a.target[a.key]=n.lerp(a.from,a.to,e))}a.elapsed+=i,a.elapsed-a.delay>a.duration&&(a.finished=!0,a.target&&(a.target[a.key]=a.to),a.callbackOnFinish&&"function"==typeof a.callbackOnFinish&&a.callbackOnFinish(t))}a.finished&&a.killEntityOnFinish&&t.kill()}}),o.forEach(t=>{const n=t.get(e.TargetKeyTween);if(!n.active)return;const r=t.get(e.TweenCopyTargetKeyToVectorScalar);if(n.started&&n.target&&n.key){const e=n.target[n.key];r&&r.setScalar(e)}})}}
},{"../tags":"injP","three":"IV0r","../util/math":"Ov1X","eases":"uiPX"}],"SXfE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=l(require("../tags")),t=l(require("three")),n=r(require("../util/Random")),i=r(require("../util/ObjectPool")),a=require("./AnimationSystem");function r(e){return e&&e.__esModule?e:{default:e}}function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var l=a?Object.getOwnPropertyDescriptor(e,r):null;l&&(l.get||l.set)?Object.defineProperty(i,r,l):i[r]=e[r]}return i.default=e,n&&n.set(e,i),i}function u(r){const o=new t.IcosahedronGeometry(1,0),l=new i.default({maxCapacity:50,initialCapacity:50,create(){const e=new t.Mesh(o,new t.MeshBasicMaterial({name:"snow"}));return e.userData._entity=null,e.frustumCulled=!1,e.visible=!1,e},release(e){}});let u=0;const s=(0,n.default)(),c=new t.Vector3,f=[0,0],d=r.findTag(e.UserTarget),p=r.view([e.Snowflake,e.Object3D]),y=r.view([e.EnvironmentState,e.ActiveEnvironmentState]);let v={value:1};const m=r.listen(e.FinalBiomeResolution);return function(t){"tundra"===(y.length?y[0].get(e.EnvironmentState).name:null)&&(m.changed&&m.added.length>0?(0,a.tweenTo)(r,v,"value",0,2,"sineOut"):m.changed&&m.removing.length>0&&(0,a.tweenTo)(r,v,"value",1,2,"sineOut"),(u+=t)>=.1&&(u%=.1,c.copy(d.position),s.insideCircle(20,f),c.x+=f[0],c.z+=f[1],c.y+=s.range(4,20),v.value>0&&function(t){const n=l.next();if(!n)return;n.userData._entity=r.entity().add(e.Snowflake).add(e.Object3D,n);const i=n.userData._entity.get(e.Snowflake);n.scale.setScalar(.05),i.size=.05,i.position.copy(t),i.velocity.set(0,-1,0),n.visible=!1}(c)),p.forEach(n=>{const i=n.get(e.Snowflake);i.velocity.x=.5*Math.sin(2*i.time),i.velocity.z=.25*Math.sin(1*i.time),i.position.addScaledVector(i.velocity,1*t);const a=n.get(e.Object3D);a.visible=!0,a.position.copy(i.position),i.time+=t;const r=function(e,t,n,i=linear){let a=0;if(e<=n)a=e/n;else if(e>=t-n){const i=Math.max(0,e-(t-n)),r=i/n;a=1-r}else a=1;return a}(i.time,i.duration,i.animateDuration,i.delay),o=i.size*r*v.value;a.scale.setScalar(o);a.material.color.setRGB(1.75,1.75,1.75),(i.time>=i.duration||i.position.y<0)&&(l.release(a),a.userData._entity=null,n.kill())}))}}
},{"../tags":"injP","three":"IV0r","../util/Random":"LMfK","../util/ObjectPool":"iiAR","./AnimationSystem":"cUmx"}],"w7pf":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/silkamono-regularitalic-webfont.7965181e.woff2";
},{}],"igLh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.create=f,exports.push=p,exports.initialize=h;var e=a(require("three")),t=r(require("./ObjectPool"));function r(e){return e&&e.__esModule?e:{default:e}}function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function a(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var l=o?Object.getOwnPropertyDescriptor(e,u):null;l&&(l.get||l.set)?Object.defineProperty(a,u,l):a[u]=e[u]}return a.default=e,r&&r.set(e,a),a}const o=[],u=new e.Mesh(new e.BoxGeometry(1,1,1),new e.MeshBasicMaterial);u.name="shader-manager-box";const l=new e.Scene,i=new e.OrthographicCamera(-1,1,-1,1,-10,10),c=[],s=new t.default({create(){const e=u.clone();return l.add(e),e},release(e){e.parent&&e.parent.remove(e)}});function f(t){const r=new e.ShaderMaterial(t);return o.push(r),t.name||console.error("Must specify name for ShaderMaterial"),r}function p(e){o.push(e)}function h(e,t=1/0){if(o.length<=0)return;const r=Math.min(t,o.length);c.length=r;for(let n=0;n<r;n++)c[n]=s.next(),c[n].material=o[n];e.render(l,i);for(let n=0;n<r;n++){const e=c[n];e.material=null,s.release(e)}c.length=0,o.length=o.length-r}
},{"three":"IV0r","./ObjectPool":"iiAR"}],"Jend":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=a;var e=o(require("three")),r=o(require("./ShaderManager"));function n(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,o=new WeakMap;return(n=function(e){return e?o:r})(e)}function o(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var o=n(r);if(o&&o.has(e))return o.get(e);var t={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var i=a?Object.getOwnPropertyDescriptor(e,l):null;i&&(i.get||i.set)?Object.defineProperty(t,l,i):t[l]=e[l]}return t.default=e,o&&o.set(e,t),t}let t;function a(n={}){const{map:o=new e.Texture,scale:t=1,opacity:a=1,color:l="white"}=n;let i=n.geometry;i||(i=new e.PlaneGeometry(1,1,1,1)).translate(0,.5,0);const c=n.blending===e.MultiplyBlending,v=n.rgba,d=null!=n.groundMap&&null!=n.groundProjectionMatrix,u={...n};delete u.geometry,delete u.groundMap,delete u.groundProjectionMatrix,delete u.color,delete u.rgba,delete u.opacity,delete u.map,delete u.scale;const g=r.create({name:"createPlaneSprite",...u,defines:{IS_RGBA:v,IS_MULTIPLY:c,IS_GROUND_MAP:d},fragmentShader:"\n      varying vec2 vUv;\n      uniform sampler2D map;\n      uniform vec3 color;\n      uniform float opacity;\n      #ifdef IS_GROUND_MAP\n      uniform sampler2D groundMap;\n      varying vec3 vGroundColor;\n      varying vec2 vGroundUv;\n      varying float vGroundY;\n      #endif\n      void main () {\n        vec4 tcol = texture2D(map, vUv);\n        #if defined(IS_RGBA)\n        gl_FragColor.rgba = tcol;\n        gl_FragColor.rgb *= color;\n        gl_FragColor.a *= opacity;\n        #elif defined(IS_MULTIPLY)\n        gl_FragColor.rgb = mix(vec3(1.0), tcol.rgb * color, tcol.a * opacity);\n        gl_FragColor.a = 1.0;\n        #else\n        gl_FragColor.rgba = tcol;\n        gl_FragColor.rgb *= color;\n        gl_FragColor.a *= opacity;\n        #endif\n        #ifdef IS_GROUND_MAP\n        // vec3 vGroundColor = texture2D(groundMap, vGroundUv).rgb;\n        gl_FragColor.rgb = mix(vGroundColor, gl_FragColor.rgb, vGroundY);\n        gl_FragColor.a = tcol.a * opacity;\n        #endif\n\n      }\n    ",vertexShader:"\n      #include <common>\n      uniform float rotation;\n      uniform vec2 repeat;\n      uniform vec2 offset;\n      uniform float globalScale;\n      uniform float flip;\n      uniform vec2 translate;\n      varying vec3 vObjectCoord;\n      varying vec2 vScreenScale;\n      varying vec2 vUv;\n      #ifdef IS_GROUND_MAP\n      varying float vGroundY;\n      uniform mat4 groundProjectionMatrix;\n      uniform sampler2D groundMap;\n      varying vec3 vGroundColor;\n      varying vec2 vGroundUv;\n      uniform float groundYDistance;\n      #endif\n      void main () {\n        vUv = uv;\n        vUv *= repeat;\n        vUv += offset;\n        \n        vec3 centerWorldPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n        vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n        vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n        vec2 scale;\n        scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n        scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n        scale.x *= flip;\n        scale *= globalScale;\n        vScreenScale = scale.xy;\n\n        vec3 vertexWorldPos = centerWorldPos\n          + camRightWorld * position.x * scale.x\n          + camUpWorld * position.y * scale.y;\n\n        #ifdef IS_GROUND_MAP\n          vec3 vertexCenterWorldPos = centerWorldPos;\n          vec4 baseClipPos = groundProjectionMatrix * viewMatrix * vec4(vertexCenterWorldPos, 1.0);\n          vGroundUv = baseClipPos.xy / baseClipPos.w * 0.5 + 0.5;\n          vGroundColor = texture2D(groundMap, vGroundUv).rgb;\n          vGroundY = vertexWorldPos.y / groundYDistance;\n        #endif\n\n        vertexWorldPos += camRightWorld * translate.x * scale.x;\n        vertexWorldPos += camUpWorld * translate.y * scale.y;\n\n        gl_Position = projectionMatrix * viewMatrix * vec4(vertexWorldPos, 1.0);\n        vObjectCoord = vec3(position.xy, 0.0);\n      }\n    ",uniforms:{map:{value:o||new e.Texture},groundMap:{value:n.groundMap||new e.Texture},groundProjectionMatrix:{value:n.groundProjectionMatrix||new e.Matrix4},groundYDistance:{value:.5},flip:{value:1},globalScale:{value:t},color:{value:new e.Color(l)},translate:{value:new e.Vector2(0,0)},repeat:{value:new e.Vector2(1,1)},offset:{value:new e.Vector2(0,0)},opacity:{value:a}}});return new e.Mesh(i,g)}
},{"three":"IV0r","./ShaderManager":"igLh"}],"bI4v":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.detachObject=i,exports.addObject=n,exports.removeFromObject=u,exports.clearGroup=c,exports.copyTextureHandle=l,exports.pruneUserData=f,exports.disposeTree=p,exports.setPointsToBufferPosition=d,exports.shareAtlasTexture=m,exports.fastCopyCameraData=y,exports.cloneMaterial=x;var e=a(require("three")),t=require("./array");function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(r=function(e){return e?a:t})(e)}function a(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=r(t);if(a&&a.has(e))return a.get(e);var s={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var n=o?Object.getOwnPropertyDescriptor(e,i):null;n&&(n.get||n.set)?Object.defineProperty(s,i,n):s[i]=e[i]}return s.default=e,a&&a.set(e,s),s}const s={type:"added"},o={type:"removed"};function i(e){e.parent&&u(e.parent,e)}function n(e,t){i(t),t.parent=e,e.children.push(t),e.dispatchEvent(s)}function u(e,r){const a=e.children.indexOf(r);a>=0&&((0,t.spliceOne)(e.children,a),r.parent=null,r.dispatchEvent(o))}function c(e){for(let t=0;t<e.children.length;t++){const r=e.children[t];r.parent=null,r.dispatchEvent(o)}e.children.length=0}function l(e,t,r){if(r.image&&!t.__hasFixedTexture){const a=e.properties.get(r);a.__webglTexture||(console.warn("Re-uploading texture data"),e.initTexture(r));const s=e.properties.get(t);Object.assign(s,a),t.__hasFixedTexture=!0}}function f(e){const t=e.userData;Object.keys(t).forEach(r=>{r.startsWith("_")?delete t[r]:"name"===r&&t.name===e.name&&delete t[r]})}function p(e,{textures:t=!1}={}){e.traverse(e=>{if(!e.__hasDisposedAlready&&("function"==typeof e.dispose&&(e.dispose(),e.__hasDisposedAlready=!0),e.geometry&&"function"==typeof e.geometry.dispose&&!e.geometry.__hasDisposedAlready&&(e.geometry.dispose(),e.geometry.__hasDisposedAlready=!0),e.material&&"function"==typeof e.material.dispose&&!e.material.__hasDisposedAlready&&(e.material.dispose(),e.material.__hasDisposedAlready=!0),e.material&&t)){const t=e.material;Object.keys(t).forEach(e=>{t[e]&&t[e].isTexture&&t[e].dispose()}),t.uniforms&&Object.keys(t.uniforms).forEach(e=>{t[e]&&t[e].value&&t[e].value.isTexture&&t[e].value.dispose()})}}),c(e)}function d(t,r){const a=r.map(e=>Array.isArray(e)?e:e.toArray()).flat();t.setAttribute("position",new e.Float32BufferAttribute(a,3))}function m(e,t,r){if(t.image&&r.__hasFixedTexture!==t){r.__hasFixedTexture=t;const a=e.properties.get(t);a.__webglTexture||e.initTexture(t);const s=e.properties.get(r);Object.assign(s,a)}}function y(t,r){e.Camera.prototype.copy.call(r,t),r.fov=t.fov,r.zoom=t.zoom,r.near=t.near,r.far=t.far,r.focus=t.focus,r.aspect=t.aspect,r.filmGauge=t.filmGauge,r.filmOffset=t.filmOffset}function x(e){const t=e.material;e.material=t.clone(),e.material.uniforms=Object.assign({},t.uniforms);for(let r in t.uniforms){const a=t.uniforms[r].value;a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4?e.material.uniforms[r]=Object.assign({},e.material.uniforms[r],{value:a.clone()}):Array.isArray(a)?e.material.uniforms[r]=Object.assign({},e.material.uniforms[r],{value:a.slice()}):e.material.uniforms[r]=Object.assign({},e.material.uniforms[r],{value:a})}}
},{"three":"IV0r","./array":"ibDZ"}],"mQ7E":[function(require,module,exports) {
function r(r,e,n){var o=e[0],t=e[1],u=e[2],a=e[3];return r[0]=n[0]*o+n[4]*t+n[8]*u+n[12]*a,r[1]=n[1]*o+n[5]*t+n[9]*u+n[13]*a,r[2]=n[2]*o+n[6]*t+n[10]*u+n[14]*a,r[3]=n[3]*o+n[7]*t+n[11]*u+n[15]*a,r}module.exports=r;
},{}],"xB81":[function(require,module,exports) {
function e(e,n,o,r,t){return e[0]=n,e[1]=o,e[2]=r,e[3]=t,e}module.exports=e;
},{}],"lJtm":[function(require,module,exports) {
var r=require("gl-vec4/transformMat4"),e=require("gl-vec4/set"),t=0,a=1,u=[0,0,0,0];function v(v,n,o,c){var i=o[0],l=o[1],s=o[2],f=o[3],g=t,m=a;e(u,n[0],n[1],n[2],1),r(u,u,c);var q=u[3];return 0!==q&&(u[0]=u[0]/q,u[1]=u[1]/q,u[2]=u[2]/q),v[0]=i+s/2*u[0]+(0+s/2),v[1]=l+f/2*u[1]+(0+f/2),v[2]=(m-g)/2*u[2]+(m+g)/2,v[3]=0===q?0:1/q,v}module.exports=v;
},{"gl-vec4/transformMat4":"mQ7E","gl-vec4/set":"xB81"}],"l7a6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.addFrameTask=r,exports.nextFrameTask=o,exports.addPostRenderCallback=s,exports.addPreRenderCallback=a,exports.preRender=u,exports.postRender=c;const e=[],t=[],n=[];function r(t){e.push(t)}function o(){return e.length?e.shift():null}function s(e){t.push(e)}function a(e){n.push(e)}function u(){n.forEach(e=>e())}function c(){t.forEach(e=>e())}
},{}],"FcRR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=u(require("three")),n=u(require("../tags")),i=require("svelte"),s=h(require("../util/ObjectPool")),l=h(require("camera-project")),r=require("../util/addFrameTasks"),o=u(require("../util/math")),a=h(require("eases"));function h(e){return e&&e.__esModule?e:{default:e}}function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var r=s?Object.getOwnPropertyDescriptor(e,l):null;r&&(r.get||r.set)?Object.defineProperty(i,l,r):i[l]=e[l]}return i.default=e,n&&n.set(e,i),i}function f(t){let n;return{c(){n=(0,e.element)("div"),(0,e.attr)(n,"class","container svelte-1bz0ho2")},m(i,s){(0,e.insert)(i,n,s),t[3](n)},p:e.noop,i:e.noop,o:e.noop,d(i){i&&(0,e.detach)(n),t[3](null)}}}function p(e,t){t.split("").forEach(t=>{const n=document.createElement("span");n.textContent=t,e.appendChild(n)})}function d(e){for(;e.lastElementChild;)e.removeChild(e.lastElementChild)}function m(i,o,h){let{world:c}=o,{state:u}=o;const f=[0,0,0,0],p=new t.Vector3(0,1,0),d=new t.Vector3,m=[0,0,0,0],y=[0,0,0];class _{constructor(){this.inner=document.createElement("div"),this.inner.className="text-sprite-3d",this.element=document.createElement("div"),this.element.appendChild(this.inner),this.element.className="text-sprite-3d-container",this.reset()}reset(){this._splitText=!1,this._visible=!1,this._text="",this._x=null,this._y=null,this._scale=null,this._opacity=null,this._fontSize=null,this._fontStyle=null,this.element.style.opacity="1",this.element.style.display="none",this.setTransform(0,0,1),this.setOpacity(1),this.setFont(16,"normal")}setFont(e,t){let n=this._fontSize,i=this._fontStyle;this._fontSize=e,this._fontStyle=t,i!==this._fontStyle&&(this.element.style.fontStyle=this._fontStyle),n!==this._fontSize&&(this.element.style.fontSize=`${this._fontSize}px`,this.element.style.top=`${-this._fontSize}px`)}appendTo(e){this.element&&e.appendChild(this.element)}detach(){this.element&&this.element.parentElement&&this.element.parentElement.removeChild(this.element)}dispose(){this.detach(),this.element=null,this.container=null}setOpacity(e){if((Math.abs(this._opacity-e)>=.01||e>=1||e<=0)&&(this._opacity=e,this.element&&(this.element.style.opacity=e),this.inner)){a.default.quadInOut(e)}}setVisible(e){this._visible!==e&&(this._visible=e,this.element&&(this.element.style.display=this._visible?"":"none"))}setTransform(e,t,n=1){(Math.abs(this._x-e)>=.001||Math.abs(this._y-t)>=.001||Math.abs(this._scale-n)>=.001)&&(this._x=e,this._y=t,this._scale=n,this.element&&(this.element.style.transform=`translate(${e}px, ${t}px)`),this.inner&&(this.inner.style.transform=`scale(${n}, ${n})`))}setText(e){this._text!==e&&(this._text=e,this.inner&&(this.inner.textContent=e))}}const x=new s.default({create:()=>new _,release(e){e.reset()}}),b=new t.Matrix4;let v,g=[],S=null,w=[];return(0,r.addPostRenderCallback)(()=>{if(!g)return;const e=c.findTag(n.MainCamera),t=c.findTag(n.AppState);f[2]=t.width,f[3]=t.height,b.copy(e.projectionMatrix).multiply(e.matrixWorldInverse),function(e,t){if(!e)return;if(w.length!==t.length){for(let n=0;n<t.length;n++)w[n]||(w[n]=x.next(),w[n].appendTo(e));if(w.length>t.length)for(let e=t.length;e<w.length;e++)if(w[e]){const t=w[e];t.detach(),x.release(t),w[e]=null}w.length=t.length}let i=!1;for(let r=0;r<w.length;r++){const e=w[r],s=t[r],o=s.get(n.TextSprite3D);let a=!1;if(o&&o.parent){a=!0,o.parent.getWorldPosition(d),d.toArray(y),(0,l.default)(m,y,f,b.elements);const t=m[0],n=f[3]-m[1],s=80,r=20,h=t>=-s&&n>=-r&&t<=f[2]+s&&n<=f[3]+r;if(h||!o.culling){const s=1;d.addScaledVector(p,s),d.toArray(y),(0,l.default)(m,y,f,b.elements);const r=f[3]-m[1],o=f[3]/534,a=23.31024;let h=Math.abs(r-n)/o/a;h=f[3]/500,e.setTransform(t,n,h),i=!0}else a=!1;a&&(e.setText(o.text),e.setOpacity(o.opacity),e.setFont(o.fontSize,o.fontStyle))}e.setVisible(a)}const s=S;S=i,s!==i&&(e.style.display=i?"":"none")}(v,g)}),u.subscribe(e=>{g=e}),i.$$set=(e=>{"world"in e&&h(1,c=e.world),"state"in e&&h(2,u=e.state)}),[v,c,u,function(t){e.binding_callbacks[t?"unshift":"push"](()=>{h(0,v=t)})}]}class y extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,m,f,e.safe_not_equal,{world:1,state:2})}}var _=y;exports.default=_;
},{"svelte/internal":"xeIE","three":"IV0r","../tags":"injP","svelte":"XHT5","../util/ObjectPool":"iiAR","camera-project":"lJtm","../util/addFrameTasks":"l7a6","../util/math":"Ov1X","eases":"uiPX"}],"hoeu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=d;var e=p(require("../assets/font/SilkaMono/silkamono-regularitalic-webfont.woff2")),t=c(require("../tags")),i=c(require("three")),n=p(require("../util/createPlaneSprite")),o=require("../util/three-util"),r=p(require("../overlays/Text3DOverlay.svelte")),a=require("svelte/store"),s=p(require("../util/ObjectPool")),l=require("./AnimationSystem");function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(u=function(e){return e?i:t})(e)}function c(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var i=u(t);if(i&&i.has(e))return i.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var a=o?Object.getOwnPropertyDescriptor(e,r):null;a&&(a.get||a.set)?Object.defineProperty(n,r,a):n[r]=e[r]}return n.default=e,i&&i.set(e,n),n}function p(e){return e&&e.__esModule?e:{default:e}}function d(e){e.system.info({hidden:!0});e.listen(t.TextSprite3D);const n=e.view(t.TextSprite3D),u=e.listen(t.TextHint),c=e.listen([t.KillTextHint,t.TextHint,t.Object3D]),p=e.view(t.TextHint),d=(0,a.writable)(n);e.entity().add(t.ViewLayer,{id:"text-3d-overlay",component:r.default,props:{world:e,state:d}});const f=new s.default({create:()=>new i.Group});return function(i){u.added.forEach(i=>{const n=f.next();i.add(t.Object3D,n);const o=i.get(t.TextHint),r=o.position.y-.5,a=o.position.y,s=o.position.z,u=o.position.z-1;n.position.copy(o.position),n.position.y=r,n.position.z=u,i.add(t.TextSprite3D);const c=i.get(t.TextSprite3D);c.text=o.text,c.depth=!1,c.fontStyle="italic",c.fontSize=14,c.parent=n,c.opacity=0,c.culling=!1;const p=o.delay;(0,l.tweenTo)(e,n.position,"y",a,1.5,"sineOut",p),(0,l.tweenTo)(e,n.position,"z",s,1.5,"sineOut",p),(0,l.tweenTo)(e,c,"opacity",1,2,"linear",p)}),c.added.forEach(i=>{const n=i.get(t.TextHint),o=i.get(t.TextSprite3D),r=n.position.y-.5,a=(n.position.y,i.get(t.Object3D));(0,l.tweenTo)(e,a.position,"y",r,1,"sineOut",0),(0,l.setEntityTweenFromTo)(i,o,"opacity",1,0,1,"quadOut",0);const s=i.get(t.TargetKeyTween);s.killEntityOnFinish=!0,s.assignFromOnStart=!0}),p.forEach(e=>{const n=e.get(t.TextHint);n.killing&&!e.has(t.KillTextHint)&&(n.time+=i,n.time-n.delay>=n.duration&&e.add(t.KillTextHint))}),u.removing.forEach(e=>{const i=e.get(t.Object3D);(0,o.detachObject)(i),e.remove(t.Object3D),f.release(i)})}}
},{"../assets/font/SilkaMono/silkamono-regularitalic-webfont.woff2":"w7pf","../tags":"injP","three":"IV0r","../util/createPlaneSprite":"Jend","../util/three-util":"bI4v","../overlays/Text3DOverlay.svelte":"FcRR","svelte/store":"nBdo","../util/ObjectPool":"iiAR","./AnimationSystem":"cUmx"}],"Mxzs":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_resume.6f45d3f1.png";
},{}],"aoiu":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_restart.38cc8503.png";
},{}],"aFIn":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_about.3b5b7b88.png";
},{}],"w3fl":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_about_long.4ffa0a9a.png";
},{}],"xlQO":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_start.8303afe7.png";
},{}],"bvJy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.transition=o,exports.emptyTransition=a,exports.fadeOpacityTransition=i,exports.fadeInTransition=u,exports.fadeTransition=s,exports.fadeOutTransition=p;var e=n(require("eases")),t=require("../util/math");function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function n(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var u=a?Object.getOwnPropertyDescriptor(e,i):null;u&&(u.get||u.set)?Object.defineProperty(o,i,u):o[i]=e[i]}return o.default=e,n&&n.set(e,o),o}function o(e,t={}){return(r,n={})=>e(r,{...n,...t})}function a(e,t={}){return{delay:0,duration:0,css:e=>""}}function i(r,{index:n=0,opacity:o=0,stagger:a=200,delay:i=0,duration:u=350,reverse:s=!1}={}){const p=+getComputedStyle(r).opacity;return{delay:i+=a*n,duration:u,tick(n){let a=e.sineIn(n);s&&(a=1-a),r.style.opacity=(0,t.lerp)(o,p,a)}}}function u(r,{x:n=0,y:o=-10,endX:a=0,endY:i=0,endAngle:u=0,angle:s=0,opacity:p=0,index:l=0,stagger:c=200,delay:f=0,duration:d=1e3,reverse:y=!1}={}){const g=+getComputedStyle(r).opacity;return{delay:f+=c*l,duration:d,tick(l){let c=e.quartOut(l),f=e.sineIn(l);y&&(c=1-c,f=1-f);const d=(0,t.lerp)(n,a,c),O=(0,t.lerp)(o,i,c),x=(0,t.lerpAngle)(s,u,f);r.style.transformOrigin="50% 50%",r.style.transform=`translate(${d}px, ${O}px) rotateZ(${x}rad)`,r.style.opacity=(0,t.lerp)(p,g,f)}}}function s(e,t={}){return u(e,t)}function p(e,t={}){return u(e,t)}
},{"eases":"uiPX","../util/math":"Ov1X"}],"HO9o":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=i(require("../assets/image/ui/btn_restart.png")),n=i(require("../assets/image/ui/btn_about.png")),a=i(require("../assets/image/ui/btn_about_long.png")),l=i(require("../assets/image/ui/btn_start.png")),r=require("svelte"),s=require("../animations/transitions");function i(e){return e&&e.__esModule?e:{default:e}}function o(t){let n,a;return{c(){n=(0,e.element)("img"),(0,e.attr)(n,"class","icon svelte-1j4vnox"),n.src!==(a=t[0])&&(0,e.attr)(n,"src",a),(0,e.attr)(n,"alt","")},m(t,a){(0,e.insert)(t,n,a)},p(t,l){1&l&&n.src!==(a=t[0])&&(0,e.attr)(n,"src",a)},d(t){t&&(0,e.detach)(n)}}}function u(t){let n,a;return{c(){n=(0,e.element)("div"),a=(0,e.text)(t[2]),(0,e.attr)(n,"class","text svelte-1j4vnox")},m(t,l){(0,e.insert)(t,n,l),(0,e.append)(n,a)},p(t,n){4&n&&(0,e.set_data)(a,t[2])},d(t){t&&(0,e.detach)(n)}}}function c(t){let n,a,l,r,s,i,c,d,m,f,g,v,p,_=t[0]&&o(t),b=t[2]&&u(t);return{c(){n=(0,e.element)("div"),a=(0,e.element)("div"),l=(0,e.element)("img"),i=(0,e.space)(),c=(0,e.element)("div"),_&&_.c(),d=(0,e.space)(),b&&b.c(),l.src!==(r=t[7])&&(0,e.attr)(l,"src",r),(0,e.attr)(l,"alt",s=t[3]||t[2]),(0,e.attr)(l,"class","svelte-1j4vnox"),(0,e.attr)(a,"class","image-container svelte-1j4vnox"),(0,e.attr)(c,"class","content-container svelte-1j4vnox"),(0,e.toggle_class)(c,"offset",t[8]),(0,e.attr)(n,"class","container svelte-1j4vnox"),(0,e.toggle_class)(n,"invert","dark"===t[1]||"dark_long"===t[1]),(0,e.toggle_class)(n,"smaller",t[9]),(0,e.toggle_class)(n,"longer",t[10])},m(r,s){(0,e.insert)(r,n,s),(0,e.append)(n,a),(0,e.append)(a,l),(0,e.append)(n,i),(0,e.append)(n,c),_&&_.m(c,null),(0,e.append)(c,d),b&&b.m(c,null),g=!0,v||(p=[(0,e.listen)(n,"introend",t[12]),(0,e.listen)(n,"introstart",t[13]),(0,e.listen)(n,"outroend",t[14]),(0,e.listen)(n,"outrostart",t[15]),(0,e.listen)(n,"click",t[16]),(0,e.listen)(n,"mouseenter",t[17]),(0,e.listen)(n,"mouseleave",t[18])],v=!0)},p(t,[a]){(!g||128&a&&l.src!==(r=t[7]))&&(0,e.attr)(l,"src",r),(!g||12&a&&s!==(s=t[3]||t[2]))&&(0,e.attr)(l,"alt",s),t[0]?_?_.p(t,a):((_=o(t)).c(),_.m(c,d)):_&&(_.d(1),_=null),t[2]?b?b.p(t,a):((b=u(t)).c(),b.m(c,null)):b&&(b.d(1),b=null),256&a&&(0,e.toggle_class)(c,"offset",t[8]),2&a&&(0,e.toggle_class)(n,"invert","dark"===t[1]||"dark_long"===t[1]),512&a&&(0,e.toggle_class)(n,"smaller",t[9]),1024&a&&(0,e.toggle_class)(n,"longer",t[10])},i(a){g||((0,e.add_render_callback)(()=>{f&&f.end(1),m||(m=(0,e.create_in_transition)(n,t[4],{})),m.start()}),g=!0)},o(a){m&&m.invalidate(),f=(0,e.create_out_transition)(n,t[5],{}),g=!1},d(t){t&&(0,e.detach)(n),_&&_.d(),b&&b.d(),t&&f&&f.end(),v=!1,(0,e.run_all)(p)}}}function d(i,o,u){(0,r.createEventDispatcher)();const c={normal:{idle:l.default,hover:l.default,offset:!0},normal_small:{idle:l.default,hover:l.default,offset:!0,smaller:!0},alert:{idle:t.default,hover:t.default,offset:!0},dark:{idle:n.default,hover:n.default,smaller:!0},dark_long:{idle:a.default,hover:a.default,smaller:!0,longer:!0}};let d,m,{icon:f=""}=o,{mode:g="normal"}=o,{text:v=""}=o,{alt:p=""}=o,{inTransition:_=s.emptyTransition}=o,{outTransition:b=s.emptyTransition}=o,x=!1,h=!1,T=!1,k=!1;return i.$$set=(e=>{"icon"in e&&u(0,f=e.icon),"mode"in e&&u(1,g=e.mode),"text"in e&&u(2,v=e.text),"alt"in e&&u(3,p=e.alt),"inTransition"in e&&u(4,_=e.inTransition),"outTransition"in e&&u(5,b=e.outTransition)}),i.$$.update=(()=>{2114&i.$$.dirty&&(u(11,d=c[g]),u(8,x=Boolean(d.offset)),u(9,T=Boolean(d.smaller)),u(10,k=Boolean(d.longer)),u(7,m=h?d.hover:d.idle))}),[f,g,v,p,_,b,h,m,x,T,k,d,function(t){(0,e.bubble)(i,t)},function(t){(0,e.bubble)(i,t)},function(t){(0,e.bubble)(i,t)},function(t){(0,e.bubble)(i,t)},function(t){(0,e.bubble)(i,t)},()=>{u(6,h=!0)},()=>{u(6,h=!1)}]}class m extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,d,c,e.safe_not_equal,{icon:0,mode:1,text:2,alt:3,inTransition:4,outTransition:5})}}var f=m;exports.default=f;
},{"svelte/internal":"xeIE","../assets/image/ui/btn_restart.png":"aoiu","../assets/image/ui/btn_about.png":"aFIn","../assets/image/ui/btn_about_long.png":"w3fl","../assets/image/ui/btn_start.png":"xlQO","svelte":"XHT5","../animations/transitions":"bvJy"}],"GVmT":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bluenoise-0.f4099f62.png";
},{}],"jrN0":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bluenoise-1.21eda81d.png";
},{}],"DzgS":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bluenoise-2.c1535a16.png";
},{}],"IlER":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bluenoise-3.7b11ea00.png";
},{}],"naQY":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/cape-texture-landscape-1024.1db485a4.png";
},{}],"wEn9":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass-arrow.e4bdd13e.png";
},{}],"z0Tq":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass-arrow2.1b1884c5.png";
},{}],"tdGr":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass-arrow3.2694f682.png";
},{}],"EBDM":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass-dot.4699f9f4.png";
},{}],"eT1t":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass-ring.7917f3f4.png";
},{}],"wkf5":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/floating-paper.de5b876a.png";
},{}],"eFwN":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/floating-paper-lines.2bd54e7e.png";
},{}],"AdBa":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass-1.fad893fb.png";
},{}],"JxKI":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass-temp.5463bf27.png";
},{}],"fm23":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass-temp2.5d975b23.png";
},{}],"xgsY":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass-thin.e19b283d.png";
},{}],"xncP":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ground-spawn-forest.6164d712.png";
},{}],"qYXM":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ground-spawn-grasslands.f1f33814.png";
},{}],"g7M8":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ground-spawn-tundra.dcb48772.png";
},{}],"NxAf":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/hard-circle.b594a48b.png";
},{}],"bVum":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_about.08aa15f7.png";
},{}],"xTF4":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/lightray.7b423ea5.png";
},{}],"d25V":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/lut-forest.4bd004a8.png";
},{}],"cALu":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/lut-grasslands.055f8a58.png";
},{}],"DDiA":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/lut-raw-no-post.fe1b3128.png";
},{}],"hisk":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/lut-tundra.f1c9b7ae.png";
},{}],"PAMp":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/lut-tundra5.2f6a7a98.png";
},{}],"Arad":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/lut-tundra6.723ae04a.png";
},{}],"bi38":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/soft-circle.c84f7049.png";
},{}],"Dufo":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/water-distort.98441f71.png";
},{}],"lW7P":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/water-noise.37b29a07.png";
},{}],"uCMc":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/floor-overlay.3dceead9.jpg";
},{}],"vZCG":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/floor-path.4418f0c8.jpg";
},{}],"RMQb":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/floor-tundra.0a3ea563.jpg";
},{}],"GeMq":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/floor.32f66327.jpg";
},{}],"DYno":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ice.693ffcde.jpg";
},{}],"xDjG":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/MAP.57b30363.svg";
},{}],"j2uP":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/back.8aa2e40a.svg";
},{}],"urpI":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/circle-24px.76b77c44.svg";
},{}],"G09W":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/code-24px.0df688dd.svg";
},{}],"G6SM":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass.e1c9847f.svg";
},{}],"KVTr":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/create-24px.05270df9.svg";
},{}],"RcpU":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/down-arrow.01924e0a.svg";
},{}],"a0c8":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/exit.5e6a50e6.svg";
},{}],"ioXA":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/eye-24px.c9b25040.svg";
},{}],"Zg4p":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/eye-off-24px.c7518a2c.svg";
},{}],"QYoa":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_NFBONF.e49de5c7.svg";
},{}],"Q5nA":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-audio.3cfa6202.svg";
},{}],"IZwW":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-biome-forest.ebf4d734.svg";
},{}],"CvKS":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-biome-grasslands.765914be.svg";
},{}],"HY7a":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-biome-group.028d55a2.svg";
},{}],"pkjV":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-biome-tundra.2078a465.svg";
},{}],"id23":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-compass.3f114ed2.svg";
},{}],"WgsT":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-leaf-menu.2c2d0aae.svg";
},{}],"UvCT":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-leaf.3caba3d1.svg";
},{}],"uF9M":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/icon-touch.7951b0cd.svg";
},{}],"ph0B":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/journal.98b67389.svg";
},{}],"HpBi":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/keyboard_arrow_down-24px.b2f82965.svg";
},{}],"hMN5":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/keyboard_arrow_right-24px.f7297ef2.svg";
},{}],"M6qB":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/loupe-24px.fc417846.svg";
},{}],"eYPz":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-trail.1d1ad4a9.svg";
},{}],"R2fM":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/menu.2e0c218b.svg";
},{}],"KanJ":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nfblogo.e49de5c7.svg";
},{}],"RQK2":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/rotate-smartphone.79bffc1e.svg";
},{}],"NX3U":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/sound.c5c7beda.svg";
},{}],"iIaS":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/title.f9fa00a5.svg";
},{}],"uNAB":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_animal.cff77fd5.png";
},{}],"NNzs":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_feather.4ed1453d.png";
},{}],"hzRD":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_fish.17450812.png";
},{}],"vqDE":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_flower.de9b5a5a.png";
},{}],"adun":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_grass.06b0c11e.png";
},{}],"dR05":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_insect.62de3916.png";
},{}],"sLF1":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_leaf.16d96f56.png";
},{}],"A8Sr":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_mist.902c1fd3.png";
},{}],"VG6S":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_moon.350d18cc.png";
},{}],"y1Ec":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_rain..d9d73aec.png";
},{}],"Kn32":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_snow.9a57c72c.png";
},{}],"WgMA":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_stars.3413ea59.png";
},{}],"K8Sy":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_storm.6533f47d.png";
},{}],"N66i":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_sun.64618601.png";
},{}],"jckH":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_tree.53f6ba5f.png";
},{}],"uCap":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_wind.04386795.png";
},{}],"W9m0":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/animal.12830698.png";
},{}],"O0Vi":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/feather.6b6bfd7d.png";
},{}],"oi8p":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fish.dfb36d1b.png";
},{}],"Qp75":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/flower.4f9e5e32.png";
},{}],"MewA":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass.ccdd5651.png";
},{}],"L9ak":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/insect.2b692573.png";
},{}],"EHAn":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaf.aacedab4.png";
},{}],"Utvt":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/mist.c1fe6571.png";
},{}],"rqfx":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/moon.dfe8d51b.png";
},{}],"eH37":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/rain.03e1d881.png";
},{}],"Zbd3":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/snow.41267b8e.png";
},{}],"UFXH":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/stars.46820aaa.png";
},{}],"FUNJ":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/storm.76924c40.png";
},{}],"L9vw":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/sun.f2286c0b.png";
},{}],"s6Nz":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree.c8750f82.png";
},{}],"vwTS":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/wind.a0bc932f.png";
},{}],"G3HE":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/biomeforest-alt.67c565ba.png";
},{}],"Tfxi":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/biomeforest.afaac9a9.png";
},{}],"qu8B":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/biomegrass-alt.362b8936.png";
},{}],"rbaI":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/biomegrass.578fb9bc.png";
},{}],"b10x":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/biometundra-alt.d9bf4ec1.png";
},{}],"iHtC":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/biometundra.b1aca65b.png";
},{}],"vwm2":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bird.3116f418.png";
},{}],"PZVu":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_pause.99cf02d2.png";
},{}],"U65d":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_restart_shadow.3214e4d2.png";
},{}],"jn8a":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_restart_top.72f10b25.png";
},{}],"QxkW":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_start_shadow.d1737f7b.png";
},{}],"h62W":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/btn_start_top.100bc8eb.png";
},{}],"WBwJ":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/close-button.fb1d6e20.png";
},{}],"nnzn":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass1.86cf5d80.png";
},{}],"wUJk":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass2.f0eab152.png";
},{}],"qNHY":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass3.40629cc5.png";
},{}],"EXrI":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/compass4.6f9d365e.png";
},{}],"X2iv":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/empty_box.2091eea5.png";
},{}],"DFan":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/filled_box.6e93f064.png";
},{}],"TrNK":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/finger-inv.8ea62c0e.png";
},{}],"CN66":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/finger.9c32cd07.png";
},{}],"WG1w":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/hint-card-left.4c69ec40.png";
},{}],"i4hq":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/hint-card-middle.4921bfde.png";
},{}],"BYcb":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/hint-card-right.23974ff0.png";
},{}],"fPiz":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_NFBONF.405cbb5c.png";
},{}],"npTf":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_XcloseJournal.f6f63d1e.png";
},{}],"kz1C":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_about.56b312e6.png";
},{}],"DvBF":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_about_orange.a091528c.png";
},{}],"LFYC":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_closeJournal.c7bb1ce9.png";
},{}],"HGCk":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_completedHaiku.3b036918.png";
},{}],"GlCV":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_emptyHaiku.81a893d6.png";
},{}],"zEyv":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_emptytoken.b41ae91d.png";
},{}],"NEaV":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_expand.501c42c7.png";
},{}],"yK9j":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_haiku.40483087.png";
},{}],"HG4l":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_haiku_leaf.b61b31ec.png";
},{}],"O5pT":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_journal.39fc192a.png";
},{}],"SPvs":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_languageSelect.5ebd1538.png";
},{}],"G6OY":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_openjournal.fafe8d04.png";
},{}],"NF7f":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_paperJournal1-rotated.7dfd15c3.png";
},{}],"TV3U":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_paperJournal1.ae9b92e1.png";
},{}],"cuPY":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_paperJournal2-rotated.1d155e1a.png";
},{}],"AYAh":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_paperJournal2.2b433be4.png";
},{}],"DF93":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_popupHaiku-straight.e2b6c0fe.png";
},{}],"d9Pf":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_popupHaiku.3513e506.png";
},{}],"S4Wk":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_restart.c9e072e5.png";
},{}],"cXg9":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_scrollbar.a7259087.png";
},{}],"rdDl":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_toggle.3bcde542.png";
},{}],"vSKJ":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_volume.81192d29.png";
},{}],"TNCA":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_volume_bar.622c031a.png";
},{}],"SY0y":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_volume_gauge.c340cb9f.png";
},{}],"n1OG":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_volume_toggle.177d3ccf.png";
},{}],"x2CH":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/title2_en.72341f63.png";
},{}],"SjJl":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/title2_en_leaf.7e5a181c.png";
},{}],"IwBx":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/title2_fr.e1ef71c5.png";
},{}],"PZ7A":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/title2_fr_leaf.0cf61449.png";
},{}],"xMHm":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/touch-inv.29fce113.png";
},{}],"o20L":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/touch.8da35d1e.png";
},{}],"b9rk":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-inv.798b8269.png";
},{}],"hHo7":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree.91cb5058.png";
},{}],"yGeS":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/vertical-rule.6c115ca8.png";
},{}],"UB7H":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/wayfinder_placeholder.fcd73f07.png";
},{}],"VIuw":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_animal.1cafab10.png";
},{}],"qAEk":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_feather.7e3b0875.png";
},{}],"KSxB":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_fish.5b352284.png";
},{}],"CUPE":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_flower.903cd0de.png";
},{}],"EtQz":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_grass.95f7ccec.png";
},{}],"eg6e":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_insect..b41f2788.png";
},{}],"qHJQ":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_mist.8c09b763.png";
},{}],"GJwl":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_leaf.50f472ba.png";
},{}],"vkiH":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_moon.d51ca8f5.png";
},{}],"w5qk":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_snow.f47289df.png";
},{}],"wIYs":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_rain.9d12d404.png";
},{}],"MciH":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_stars.7f517997.png";
},{}],"KGMy":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_storm.96cb6ec0.png";
},{}],"C4oO":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_sun.0e53e6e2.png";
},{}],"COkh":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_tree.79849b4c.png";
},{}],"CLfC":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ico_wind.3507c7da.png";
},{}],"Godu":[function(require,module,exports) {
module.exports={data:{"bluenoise-0":{png:require("./../data/bluenoise-0.png")},"bluenoise-1":{png:require("./../data/bluenoise-1.png")},"bluenoise-2":{png:require("./../data/bluenoise-2.png")},"bluenoise-3":{png:require("./../data/bluenoise-3.png")},"cape-texture-landscape-1024":{png:require("./../data/cape-texture-landscape-1024.png")},"compass-arrow":{png:require("./../data/compass-arrow.png")},"compass-arrow2":{png:require("./../data/compass-arrow2.png")},"compass-arrow3":{png:require("./../data/compass-arrow3.png")},"compass-dot":{png:require("./../data/compass-dot.png")},"compass-ring":{png:require("./../data/compass-ring.png")},"floating-paper":{png:require("./../data/floating-paper.png")},"floating-paper-lines":{png:require("./../data/floating-paper-lines.png")},"grass-1":{png:require("./../data/grass-1.png")},"grass-temp":{png:require("./../data/grass-temp.png")},"grass-temp2":{png:require("./../data/grass-temp2.png")},"grass-thin":{png:require("./../data/grass-thin.png")},"ground-spawn-forest":{png:require("./../data/ground-spawn-forest.png")},"ground-spawn-grasslands":{png:require("./../data/ground-spawn-grasslands.png")},"ground-spawn-tundra":{png:require("./../data/ground-spawn-tundra.png")},"hard-circle":{png:require("./../data/hard-circle.png")},ico_about:{png:require("./../data/ico_about.png")},lightray:{png:require("./../data/lightray.png")},"lut-forest":{png:require("./../data/lut-forest.png")},"lut-grasslands":{png:require("./../data/lut-grasslands.png")},"lut-raw-no-post":{png:require("./../data/lut-raw-no-post.png")},"lut-tundra":{png:require("./../data/lut-tundra.png")},"lut-tundra5":{png:require("./../data/lut-tundra5.png")},"lut-tundra6":{png:require("./../data/lut-tundra6.png")},"soft-circle":{png:require("./../data/soft-circle.png")},"water-distort":{png:require("./../data/water-distort.png")},"water-noise":{png:require("./../data/water-noise.png")}},opaque:{"floor-overlay":{jpg:require("./../opaque/floor-overlay.jpg")},"floor-path":{jpg:require("./../opaque/floor-path.jpg")},"floor-tundra":{jpg:require("./../opaque/floor-tundra.jpg")},floor:{jpg:require("./../opaque/floor.jpg")},ice:{jpg:require("./../opaque/ice.jpg")}},svg:{MAP:{svg:require("./../svg/MAP.svg")},back:{svg:require("./../svg/back.svg")},"circle-24px":{svg:require("./../svg/circle-24px.svg")},"code-24px":{svg:require("./../svg/code-24px.svg")},compass:{svg:require("./../svg/compass.svg")},"create-24px":{svg:require("./../svg/create-24px.svg")},"down-arrow":{svg:require("./../svg/down-arrow.svg")},exit:{svg:require("./../svg/exit.svg")},"eye-24px":{svg:require("./../svg/eye-24px.svg")},"eye-off-24px":{svg:require("./../svg/eye-off-24px.svg")},ico_NFBONF:{svg:require("./../svg/ico_NFBONF.svg")},"icon-audio":{svg:require("./../svg/icon-audio.svg")},"icon-biome-forest":{svg:require("./../svg/icon-biome-forest.svg")},"icon-biome-grasslands":{svg:require("./../svg/icon-biome-grasslands.svg")},"icon-biome-group":{svg:require("./../svg/icon-biome-group.svg")},"icon-biome-tundra":{svg:require("./../svg/icon-biome-tundra.svg")},"icon-compass":{svg:require("./../svg/icon-compass.svg")},"icon-leaf-menu":{svg:require("./../svg/icon-leaf-menu.svg")},"icon-leaf":{svg:require("./../svg/icon-leaf.svg")},"icon-touch":{svg:require("./../svg/icon-touch.svg")},journal:{svg:require("./../svg/journal.svg")},"keyboard_arrow_down-24px":{svg:require("./../svg/keyboard_arrow_down-24px.svg")},"keyboard_arrow_right-24px":{svg:require("./../svg/keyboard_arrow_right-24px.svg")},"loupe-24px":{svg:require("./../svg/loupe-24px.svg")},"map-trail":{svg:require("./../svg/map-trail.svg")},menu:{svg:require("./../svg/menu.svg")},nfblogo:{svg:require("./../svg/nfblogo.svg")},"rotate-smartphone":{svg:require("./../svg/rotate-smartphone.svg")},sound:{svg:require("./../svg/sound.svg")},title:{svg:require("./../svg/title.svg")}},tokens:{ico_animal:{png:require("./../tokens/ico_animal.png")},ico_feather:{png:require("./../tokens/ico_feather.png")},ico_fish:{png:require("./../tokens/ico_fish.png")},ico_flower:{png:require("./../tokens/ico_flower.png")},ico_grass:{png:require("./../tokens/ico_grass.png")},ico_insect:{png:require("./../tokens/ico_insect.png")},ico_leaf:{png:require("./../tokens/ico_leaf.png")},ico_mist:{png:require("./../tokens/ico_mist.png")},ico_moon:{png:require("./../tokens/ico_moon.png")},"ico_rain.":{png:require("./../tokens/ico_rain..png")},ico_snow:{png:require("./../tokens/ico_snow.png")},ico_stars:{png:require("./../tokens/ico_stars.png")},ico_storm:{png:require("./../tokens/ico_storm.png")},ico_sun:{png:require("./../tokens/ico_sun.png")},ico_tree:{png:require("./../tokens/ico_tree.png")},ico_wind:{png:require("./../tokens/ico_wind.png")}},"tokens-collected":{animal:{png:require("./../tokens-collected/animal.png")},feather:{png:require("./../tokens-collected/feather.png")},fish:{png:require("./../tokens-collected/fish.png")},flower:{png:require("./../tokens-collected/flower.png")},grass:{png:require("./../tokens-collected/grass.png")},insect:{png:require("./../tokens-collected/insect.png")},leaf:{png:require("./../tokens-collected/leaf.png")},mist:{png:require("./../tokens-collected/mist.png")},moon:{png:require("./../tokens-collected/moon.png")},rain:{png:require("./../tokens-collected/rain.png")},snow:{png:require("./../tokens-collected/snow.png")},stars:{png:require("./../tokens-collected/stars.png")},storm:{png:require("./../tokens-collected/storm.png")},sun:{png:require("./../tokens-collected/sun.png")},tree:{png:require("./../tokens-collected/tree.png")},wind:{png:require("./../tokens-collected/wind.png")}},ui:{"biomeforest-alt":{png:require("./../ui/biomeforest-alt.png")},biomeforest:{png:require("./../ui/biomeforest.png")},"biomegrass-alt":{png:require("./../ui/biomegrass-alt.png")},biomegrass:{png:require("./../ui/biomegrass.png")},"biometundra-alt":{png:require("./../ui/biometundra-alt.png")},biometundra:{png:require("./../ui/biometundra.png")},bird:{png:require("./../ui/bird.png")},btn_about:{png:require("./../ui/btn_about.png")},btn_about_long:{png:require("./../ui/btn_about_long.png")},btn_pause:{png:require("./../ui/btn_pause.png")},btn_restart:{png:require("./../ui/btn_restart.png")},btn_restart_shadow:{png:require("./../ui/btn_restart_shadow.png")},btn_restart_top:{png:require("./../ui/btn_restart_top.png")},btn_start:{png:require("./../ui/btn_start.png")},btn_start_shadow:{png:require("./../ui/btn_start_shadow.png")},btn_start_top:{png:require("./../ui/btn_start_top.png")},"close-button":{png:require("./../ui/close-button.png")},compass1:{png:require("./../ui/compass1.png")},compass2:{png:require("./../ui/compass2.png")},compass3:{png:require("./../ui/compass3.png")},compass4:{png:require("./../ui/compass4.png")},empty_box:{png:require("./../ui/empty_box.png")},filled_box:{png:require("./../ui/filled_box.png")},"finger-inv":{png:require("./../ui/finger-inv.png")},finger:{png:require("./../ui/finger.png")},"hint-card-left":{png:require("./../ui/hint-card-left.png")},"hint-card-middle":{png:require("./../ui/hint-card-middle.png")},"hint-card-right":{png:require("./../ui/hint-card-right.png")},ico_NFBONF:{png:require("./../ui/ico_NFBONF.png")},ico_XcloseJournal:{png:require("./../ui/ico_XcloseJournal.png")},ico_about:{png:require("./../ui/ico_about.png")},ico_about_orange:{png:require("./../ui/ico_about_orange.png")},ico_closeJournal:{png:require("./../ui/ico_closeJournal.png")},ico_completedHaiku:{png:require("./../ui/ico_completedHaiku.png")},ico_emptyHaiku:{png:require("./../ui/ico_emptyHaiku.png")},ico_emptytoken:{png:require("./../ui/ico_emptytoken.png")},ico_expand:{png:require("./../ui/ico_expand.png")},ico_haiku:{png:require("./../ui/ico_haiku.png")},ico_haiku_leaf:{png:require("./../ui/ico_haiku_leaf.png")},ico_journal:{png:require("./../ui/ico_journal.png")},ico_languageSelect:{png:require("./../ui/ico_languageSelect.png")},ico_openjournal:{png:require("./../ui/ico_openjournal.png")},"ico_paperJournal1-rotated":{png:require("./../ui/ico_paperJournal1-rotated.png")},ico_paperJournal1:{png:require("./../ui/ico_paperJournal1.png")},"ico_paperJournal2-rotated":{png:require("./../ui/ico_paperJournal2-rotated.png")},ico_paperJournal2:{png:require("./../ui/ico_paperJournal2.png")},"ico_popupHaiku-straight":{png:require("./../ui/ico_popupHaiku-straight.png")},ico_popupHaiku:{png:require("./../ui/ico_popupHaiku.png")},ico_restart:{png:require("./../ui/ico_restart.png")},ico_resume:{png:require("./../ui/ico_resume.png")},ico_scrollbar:{png:require("./../ui/ico_scrollbar.png")},ico_toggle:{png:require("./../ui/ico_toggle.png")},ico_volume:{png:require("./../ui/ico_volume.png")},ico_volume_bar:{png:require("./../ui/ico_volume_bar.png")},ico_volume_gauge:{png:require("./../ui/ico_volume_gauge.png")},ico_volume_toggle:{png:require("./../ui/ico_volume_toggle.png")},title2_en:{png:require("./../ui/title2_en.png")},title2_en_leaf:{png:require("./../ui/title2_en_leaf.png")},title2_fr:{png:require("./../ui/title2_fr.png")},title2_fr_leaf:{png:require("./../ui/title2_fr_leaf.png")},"touch-inv":{png:require("./../ui/touch-inv.png")},touch:{png:require("./../ui/touch.png")},"tree-inv":{png:require("./../ui/tree-inv.png")},tree:{png:require("./../ui/tree.png")},"vertical-rule":{png:require("./../ui/vertical-rule.png")},wayfinder_placeholder:{png:require("./../ui/wayfinder_placeholder.png")}},"tokens-inverted":{ico_animal:{png:require("./../tokens-inverted/ico_animal.png")},ico_feather:{png:require("./../tokens-inverted/ico_feather.png")},ico_fish:{png:require("./../tokens-inverted/ico_fish.png")},ico_flower:{png:require("./../tokens-inverted/ico_flower.png")},ico_grass:{png:require("./../tokens-inverted/ico_grass.png")},"ico_insect.":{png:require("./../tokens-inverted/ico_insect..png")},ico_mist:{png:require("./../tokens-inverted/ico_mist.png")},ico_leaf:{png:require("./../tokens-inverted/ico_leaf.png")},ico_moon:{png:require("./../tokens-inverted/ico_moon.png")},ico_snow:{png:require("./../tokens-inverted/ico_snow.png")},ico_rain:{png:require("./../tokens-inverted/ico_rain.png")},ico_stars:{png:require("./../tokens-inverted/ico_stars.png")},ico_storm:{png:require("./../tokens-inverted/ico_storm.png")},ico_sun:{png:require("./../tokens-inverted/ico_sun.png")},ico_tree:{png:require("./../tokens-inverted/ico_tree.png")},ico_wind:{png:require("./../tokens-inverted/ico_wind.png")}}};
},{"./../data/bluenoise-0.png":"GVmT","./../data/bluenoise-1.png":"jrN0","./../data/bluenoise-2.png":"DzgS","./../data/bluenoise-3.png":"IlER","./../data/cape-texture-landscape-1024.png":"naQY","./../data/compass-arrow.png":"wEn9","./../data/compass-arrow2.png":"z0Tq","./../data/compass-arrow3.png":"tdGr","./../data/compass-dot.png":"EBDM","./../data/compass-ring.png":"eT1t","./../data/floating-paper.png":"wkf5","./../data/floating-paper-lines.png":"eFwN","./../data/grass-1.png":"AdBa","./../data/grass-temp.png":"JxKI","./../data/grass-temp2.png":"fm23","./../data/grass-thin.png":"xgsY","./../data/ground-spawn-forest.png":"xncP","./../data/ground-spawn-grasslands.png":"qYXM","./../data/ground-spawn-tundra.png":"g7M8","./../data/hard-circle.png":"NxAf","./../data/ico_about.png":"bVum","./../data/lightray.png":"xTF4","./../data/lut-forest.png":"d25V","./../data/lut-grasslands.png":"cALu","./../data/lut-raw-no-post.png":"DDiA","./../data/lut-tundra.png":"hisk","./../data/lut-tundra5.png":"PAMp","./../data/lut-tundra6.png":"Arad","./../data/soft-circle.png":"bi38","./../data/water-distort.png":"Dufo","./../data/water-noise.png":"lW7P","./../opaque/floor-overlay.jpg":"uCMc","./../opaque/floor-path.jpg":"vZCG","./../opaque/floor-tundra.jpg":"RMQb","./../opaque/floor.jpg":"GeMq","./../opaque/ice.jpg":"DYno","./../svg/MAP.svg":"xDjG","./../svg/back.svg":"j2uP","./../svg/circle-24px.svg":"urpI","./../svg/code-24px.svg":"G09W","./../svg/compass.svg":"G6SM","./../svg/create-24px.svg":"KVTr","./../svg/down-arrow.svg":"RcpU","./../svg/exit.svg":"a0c8","./../svg/eye-24px.svg":"ioXA","./../svg/eye-off-24px.svg":"Zg4p","./../svg/ico_NFBONF.svg":"QYoa","./../svg/icon-audio.svg":"Q5nA","./../svg/icon-biome-forest.svg":"IZwW","./../svg/icon-biome-grasslands.svg":"CvKS","./../svg/icon-biome-group.svg":"HY7a","./../svg/icon-biome-tundra.svg":"pkjV","./../svg/icon-compass.svg":"id23","./../svg/icon-leaf-menu.svg":"WgsT","./../svg/icon-leaf.svg":"UvCT","./../svg/icon-touch.svg":"uF9M","./../svg/journal.svg":"ph0B","./../svg/keyboard_arrow_down-24px.svg":"HpBi","./../svg/keyboard_arrow_right-24px.svg":"hMN5","./../svg/loupe-24px.svg":"M6qB","./../svg/map-trail.svg":"eYPz","./../svg/menu.svg":"R2fM","./../svg/nfblogo.svg":"KanJ","./../svg/rotate-smartphone.svg":"RQK2","./../svg/sound.svg":"NX3U","./../svg/title.svg":"iIaS","./../tokens/ico_animal.png":"uNAB","./../tokens/ico_feather.png":"NNzs","./../tokens/ico_fish.png":"hzRD","./../tokens/ico_flower.png":"vqDE","./../tokens/ico_grass.png":"adun","./../tokens/ico_insect.png":"dR05","./../tokens/ico_leaf.png":"sLF1","./../tokens/ico_mist.png":"A8Sr","./../tokens/ico_moon.png":"VG6S","./../tokens/ico_rain..png":"y1Ec","./../tokens/ico_snow.png":"Kn32","./../tokens/ico_stars.png":"WgMA","./../tokens/ico_storm.png":"K8Sy","./../tokens/ico_sun.png":"N66i","./../tokens/ico_tree.png":"jckH","./../tokens/ico_wind.png":"uCap","./../tokens-collected/animal.png":"W9m0","./../tokens-collected/feather.png":"O0Vi","./../tokens-collected/fish.png":"oi8p","./../tokens-collected/flower.png":"Qp75","./../tokens-collected/grass.png":"MewA","./../tokens-collected/insect.png":"L9ak","./../tokens-collected/leaf.png":"EHAn","./../tokens-collected/mist.png":"Utvt","./../tokens-collected/moon.png":"rqfx","./../tokens-collected/rain.png":"eH37","./../tokens-collected/snow.png":"Zbd3","./../tokens-collected/stars.png":"UFXH","./../tokens-collected/storm.png":"FUNJ","./../tokens-collected/sun.png":"L9vw","./../tokens-collected/tree.png":"s6Nz","./../tokens-collected/wind.png":"vwTS","./../ui/biomeforest-alt.png":"G3HE","./../ui/biomeforest.png":"Tfxi","./../ui/biomegrass-alt.png":"qu8B","./../ui/biomegrass.png":"rbaI","./../ui/biometundra-alt.png":"b10x","./../ui/biometundra.png":"iHtC","./../ui/bird.png":"vwm2","./../ui/btn_about.png":"aFIn","./../ui/btn_about_long.png":"w3fl","./../ui/btn_pause.png":"PZVu","./../ui/btn_restart.png":"aoiu","./../ui/btn_restart_shadow.png":"U65d","./../ui/btn_restart_top.png":"jn8a","./../ui/btn_start.png":"xlQO","./../ui/btn_start_shadow.png":"QxkW","./../ui/btn_start_top.png":"h62W","./../ui/close-button.png":"WBwJ","./../ui/compass1.png":"nnzn","./../ui/compass2.png":"wUJk","./../ui/compass3.png":"qNHY","./../ui/compass4.png":"EXrI","./../ui/empty_box.png":"X2iv","./../ui/filled_box.png":"DFan","./../ui/finger-inv.png":"TrNK","./../ui/finger.png":"CN66","./../ui/hint-card-left.png":"WG1w","./../ui/hint-card-middle.png":"i4hq","./../ui/hint-card-right.png":"BYcb","./../ui/ico_NFBONF.png":"fPiz","./../ui/ico_XcloseJournal.png":"npTf","./../ui/ico_about.png":"kz1C","./../ui/ico_about_orange.png":"DvBF","./../ui/ico_closeJournal.png":"LFYC","./../ui/ico_completedHaiku.png":"HGCk","./../ui/ico_emptyHaiku.png":"GlCV","./../ui/ico_emptytoken.png":"zEyv","./../ui/ico_expand.png":"NEaV","./../ui/ico_haiku.png":"yK9j","./../ui/ico_haiku_leaf.png":"HG4l","./../ui/ico_journal.png":"O5pT","./../ui/ico_languageSelect.png":"SPvs","./../ui/ico_openjournal.png":"G6OY","./../ui/ico_paperJournal1-rotated.png":"NF7f","./../ui/ico_paperJournal1.png":"TV3U","./../ui/ico_paperJournal2-rotated.png":"cuPY","./../ui/ico_paperJournal2.png":"AYAh","./../ui/ico_popupHaiku-straight.png":"DF93","./../ui/ico_popupHaiku.png":"d9Pf","./../ui/ico_restart.png":"S4Wk","./../ui/ico_resume.png":"Mxzs","./../ui/ico_scrollbar.png":"cXg9","./../ui/ico_toggle.png":"rdDl","./../ui/ico_volume.png":"vSKJ","./../ui/ico_volume_bar.png":"TNCA","./../ui/ico_volume_gauge.png":"SY0y","./../ui/ico_volume_toggle.png":"n1OG","./../ui/title2_en.png":"x2CH","./../ui/title2_en_leaf.png":"SjJl","./../ui/title2_fr.png":"IwBx","./../ui/title2_fr_leaf.png":"PZ7A","./../ui/touch-inv.png":"xMHm","./../ui/touch.png":"o20L","./../ui/tree-inv.png":"b9rk","./../ui/tree.png":"hHo7","./../ui/vertical-rule.png":"yGeS","./../ui/wayfinder_placeholder.png":"UB7H","./../tokens-inverted/ico_animal.png":"VIuw","./../tokens-inverted/ico_feather.png":"qAEk","./../tokens-inverted/ico_fish.png":"KSxB","./../tokens-inverted/ico_flower.png":"CUPE","./../tokens-inverted/ico_grass.png":"EtQz","./../tokens-inverted/ico_insect..png":"eg6e","./../tokens-inverted/ico_mist.png":"qHJQ","./../tokens-inverted/ico_leaf.png":"GJwl","./../tokens-inverted/ico_moon.png":"vkiH","./../tokens-inverted/ico_snow.png":"w5qk","./../tokens-inverted/ico_rain.png":"wIYs","./../tokens-inverted/ico_stars.png":"MciH","./../tokens-inverted/ico_storm.png":"KGMy","./../tokens-inverted/ico_sun.png":"C4oO","./../tokens-inverted/ico_tree.png":"COkh","./../tokens-inverted/ico_wind.png":"CLfC"}],"rmot":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bird_fly.dc1b3c0c.png";
},{}],"cq2t":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bird_still.c4db18e7.png";
},{}],"liUq":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/butterfly.3a1bf859.png";
},{}],"Ixuw":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/butterfly.14ef41a0.sheet";
},{}],"kPW1":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fish.6831251a.png";
},{}],"TDLy":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fish.ab36c60f.sheet";
},{}],"VgB7":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fox.39cb3ec8.png";
},{}],"yq8U":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fox.e69d616f.sheet";
},{}],"h0WL":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fox_sleep.0b999f75.png";
},{}],"Z5mh":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fox_sleep.a8286f65.sheet";
},{}],"aXob":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fox_wakesup.f2e8425f.png";
},{}],"L3VW":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fox_wakesup.935c3e9c.sheet";
},{}],"mmLQ":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ground-flowers.1f60e598.png";
},{}],"GxMP":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ground-flowers.181980ff.sheet";
},{}],"ybmT":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/jumpingrabbit.dcb9c5b1.png";
},{}],"mtDP":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/jumpingrabbit.db0dc07a.sheet";
},{}],"PYsg":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/owl.b178cee5.png";
},{}],"vNQX":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/owl_sleep.f1d3d875.png";
},{}],"HDAB":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/owl_wakeup.310bf9bf.png";
},{}],"iyjm":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/rabbit.12ec587e.png";
},{}],"EFLP":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/seal.1f7b0cf9.png";
},{}],"WIDz":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/temp_grass_sprites.712430f8.png";
},{}],"mapS":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/temp_grass_sprites.85d69383.sheet";
},{}],"b9ai":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/temp_sprites-0.87c5c12e.png";
},{}],"TeOO":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/temp_sprites-0.84261fe5.sheet";
},{}],"LOoq":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/temp_sprites-1.385dd61b.png";
},{}],"RKUA":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/temp_sprites-1.a93f54be.sheet";
},{}],"q1ya":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/temp_sprites-2.faaefb79.png";
},{}],"bBci":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/temp_sprites-2.5503baac.sheet";
},{}],"I7y5":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tokens.4f2b1e52.png";
},{}],"aDCv":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tokens.0f5c8af9.sheet";
},{}],"qAMX":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-anim-a.8886be70.png";
},{}],"Zfbz":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-anim-a.77f6be8a.sheet";
},{}],"vOxy":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-anim-b.3f4498c1.png";
},{}],"HF26":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-anim-b.28646923.sheet";
},{}],"x8nd":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-anim-c.d711a905.png";
},{}],"upsj":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-anim-c.74b09916.sheet";
},{}],"Zi1t":[function(require,module,exports) {
module.exports={bird_fly:{png:require("./bird_fly.png")},bird_still:{png:require("./bird_still.png")},butterfly:{png:require("./butterfly.png"),sheet:require("./butterfly.sheet")},fish:{png:require("./fish.png"),sheet:require("./fish.sheet")},fox:{png:require("./fox.png"),sheet:require("./fox.sheet")},fox_sleep:{png:require("./fox_sleep.png"),sheet:require("./fox_sleep.sheet")},fox_wakesup:{png:require("./fox_wakesup.png"),sheet:require("./fox_wakesup.sheet")},"ground-flowers":{png:require("./ground-flowers.png"),sheet:require("./ground-flowers.sheet")},jumpingrabbit:{png:require("./jumpingrabbit.png"),sheet:require("./jumpingrabbit.sheet")},owl:{png:require("./owl.png")},owl_sleep:{png:require("./owl_sleep.png")},owl_wakeup:{png:require("./owl_wakeup.png")},rabbit:{png:require("./rabbit.png")},seal:{png:require("./seal.png")},temp_grass_sprites:{png:require("./temp_grass_sprites.png"),sheet:require("./temp_grass_sprites.sheet")},"temp_sprites-0":{png:require("./temp_sprites-0.png"),sheet:require("./temp_sprites-0.sheet")},"temp_sprites-1":{png:require("./temp_sprites-1.png"),sheet:require("./temp_sprites-1.sheet")},"temp_sprites-2":{png:require("./temp_sprites-2.png"),sheet:require("./temp_sprites-2.sheet")},tokens:{png:require("./tokens.png"),sheet:require("./tokens.sheet")},"tree-anim-a":{png:require("./tree-anim-a.png"),sheet:require("./tree-anim-a.sheet")},"tree-anim-b":{png:require("./tree-anim-b.png"),sheet:require("./tree-anim-b.sheet")},"tree-anim-c":{png:require("./tree-anim-c.png"),sheet:require("./tree-anim-c.sheet")}};
},{"./bird_fly.png":"rmot","./bird_still.png":"cq2t","./butterfly.png":"liUq","./butterfly.sheet":"Ixuw","./fish.png":"kPW1","./fish.sheet":"TDLy","./fox.png":"VgB7","./fox.sheet":"yq8U","./fox_sleep.png":"h0WL","./fox_sleep.sheet":"Z5mh","./fox_wakesup.png":"aXob","./fox_wakesup.sheet":"L3VW","./ground-flowers.png":"mmLQ","./ground-flowers.sheet":"GxMP","./jumpingrabbit.png":"ybmT","./jumpingrabbit.sheet":"mtDP","./owl.png":"PYsg","./owl_sleep.png":"vNQX","./owl_wakeup.png":"HDAB","./rabbit.png":"iyjm","./seal.png":"EFLP","./temp_grass_sprites.png":"WIDz","./temp_grass_sprites.sheet":"mapS","./temp_sprites-0.png":"b9ai","./temp_sprites-0.sheet":"TeOO","./temp_sprites-1.png":"LOoq","./temp_sprites-1.sheet":"RKUA","./temp_sprites-2.png":"q1ya","./temp_sprites-2.sheet":"bBci","./tokens.png":"I7y5","./tokens.sheet":"aDCv","./tree-anim-a.png":"qAMX","./tree-anim-a.sheet":"Zfbz","./tree-anim-b.png":"vOxy","./tree-anim-b.sheet":"HF26","./tree-anim-c.png":"x8nd","./tree-anim-c.sheet":"upsj"}],"LLrD":[function(require,module,exports) {
module.exports=module.exports={animal:[["distant wolf howling","following wolf prints","horned owl hoots above","squirrels chasing by","soft squirrel chatter","otter softly sleeps","bears hunting for fish","following deer tracks","wolf calls from afar"],["a beaver's wake","a coyote howls","a deer hesitates","a squirrel climbs","a squirrel burrows","the wolf howl fades"],["above the bears den","from a moose's chin","across the wolf tracks"]],feather:[["wakened by birdsong","scuffle of feathered wings","drifting sparrow song","birds lost in flight","loons scatter away","birdsong from above","feather falls on grass","wing beats overhead","ducks paddling along","evening birdsong"],["the owl feather","a seagulls flight","the sparrows songs","sparrow-song skitters","a bird emerges","an eagles talon","birdsongs breaking","the sound of wings","goose honks echo","a swell of swallows","a faint birdsong"],["in the cidadas chirp","in a mockingbirds song","in the bird nest","between bird songs","on a blackbirds wing","by the loons call"]],fish:[["fly fishing again","fish scale shine","little fishes swim","frogs croaking at dawn","fish breaks the surface","fish swimming upstream","by the frog pond"],["a fish leaps","the frog's mouth","a frog syncopates","a fish rests","a water snake"],["as the trout rises"]],flower:[["three petals falling","spring feel in the air","yesterdays flowers","approaching spring bloom","half-blown dandelion","sunflowers in bloom","dandelion wishes","air full of pollen","picking spring flowers","lilacs in full bloom","when lavendar blooms","suddenly spring"],["a dandelion's dance","the flower falls","the first sunflower","the tomato flowers","a shower of petals","the daffodil stems","a field of dandelion fluffs","the petals fall","the wildflowers","every flower","a yellow dandelion","the scent of lilacs","sunflowers sway","the roses shift","flowers fading","a fresh bloom","iris in bloom","the silk flowers","a pear blossoms"],["amid plum blossoms","in the wildflowers","in the dandelions","through the blossoming cherries","between the sunflowers","in bloom","into the sunflowers","on the petals","between roses","into wildflowers","from the roses","between flowers","between the flowers","into blossoms","in full bloom"]],grass:[["whistling across fields","rhythmic blowing grass","swaying knee-high grass","dancing grass meadows","dancing blades of grass","wide open meadows","wide sunlit meadows","grass swaying rhythm"],["the grass trapped","the long grass","the overgrown field","grasses tiptoe","the vastness of fields","the smell of grass","a wheat field rippling"],["on a field","across the meadows","in the dry grass","in the grasses","above the sunlit meadow","over the autumn fields","above the fields","through the grass","in the field","over the field","on the meadow"]],insect:[["hornets buzzing by","bees floating above","spider's web catching","weaving spider threads","bee drifts to flower","dancing butterflies","mosquitos buzzing","on dragonfly wings","butterfly shadows","caterpillars inch","fluttering moth wind","chasing butterflies"],["a spider catches","a worm writhes","the blur of insects","a moth escapes","the flow of ants","a wasp struggles","a mosquito's buzz","a butterfly's quest","a grasshopper leaps","an ant moves","the moth's reflection","the spider shadow moves","a caterpillar reaches","the grasshopper visits","a wasp nest tumbles","a spider hangs","a bee floats","a moth stirs","a bee lands","a spiders thread","the spiders web","the firefly glow"],["inside the caterpillars tent","over butterflies","in a spider's web","on a spider's thread"]],leaf:[["leaf shadows stipple","leaves falling above","falling maple leaf","leaves drifting behind","leaves rustling away","falling leaf shadow","finding scattered leaves","leaves stirring softly","leaf-catching at dusk"],["a dry leaf","a leaf falls","a single leaf","leaf shadow weaves","the leaves fall","each leaf brimming","a leaf falling","autumn leaves","another leaf flutters","the leaf shadow spreads"],["in the leaf shadows","on every leaf","through the sunlit leaf","beyond the leaf edge"]],mist:[["through dense morning haze","lifting mist reveals","rolling skyline fog","haze over the hills","morning dew drop mist","shifting mist shadows","caught in flowing mist","autumn mist deepens","horizon fog shifts"],["one dew drop","shrouded in mist","fog climbing","patches of fog","the fog rises"],["in the mist","in the fog","through the fog","between the mist","in the autumn haze","in winter mist","through the morning fog","in the autumn mist","in river mist","into fog","through the dew","on the fog","from the fog","into mist","through the mist"]],moon:[["moonless autumn night","ambrosia moon night","fireflies light the way","moonless night again","another moon day","moonlight casts shadows","moon gazing again","dappled moon-lit floor","moonlit stillness falls"],["the moon dances","a path of moonlight","lost in the night","the moon swallows","the darkness lengthens","the silence of the moon","the moonlight lengthens","the moons reflection","moon shadows drift","the silver of the moon","moonlight reveals"],["in the clear night","against the night sky","under the moonlight","between the moon","under a waning moon","on a moonless night","across the moon","in the moonlight"]],rain:[["afternoon drizzle","caught in sudden rain","waiting for the rains","pitter-patter rain","chorus of rainfall","steady rain drumming","through sheets of rainfall","quiet rain drop sounds"],["the water falls","a tumult of rain","the river flowing","rain bubbles burst","a raindrop falls","the soft rain","the patter of raindrops","the first raindrops","another drop of rain","the sound of water","the weight of raindrops","the pelting rain"],["after the rain","through the rain","in every puddle","before the rain","under the rain","in the gentle rain","at the waters edge","under the endless rain","between raindrops","on the water's surface"]],snow:[["snow-covered mountains","footprints in the snow","cold mountain shadow","late winter morning","soundless snowflakes fall","quiet fall of snow","snowflakes whirl into","snow bent pine branches","snowflakes blend and blur"],["a fresh snow angel","the shadow of snow","a snowflake slides","snow gathers","a snowflake resting","another inch of snow","snowflakes melting","the winter sky darkens","snowflakes falling","the sound of snow","a snowflake caught","a snowflake melts","snowflakes blowing","snowflakes collecting","a hint of winter"],["after the first freeze","beneath the ice","along the ice cracks","in the winter haze","between ice floes","in the winter chill","against the snow"]],stars:[["star speckled night sky","watching shooting stars","star gazing again","distant stars sparkle","pale stars far above","twinkling starry sky","scattered star-light falls","below falling stars","between glowing stars"],["another star appears","blizzards of stars","a thread of light","the stars peering","a star falls from","a shooting star","a glimmer of light","quivers of light"],["against the light","after the stars","beyond the lights","under the stars","into the light","against the stars","between the stars"]],storm:[["sudden thunderclap!","watching summer clouds","whispering thunder","looming storm clouds drift","lightning flashes blind","approaching storm cloud","distant lightning crash","storm-washed horizon","mountain-top thunder","rolling thunder wave"],["clouds break","the space between clouds","the soft boom","a flash of lightning","a distant cloud rains","a cloud passes through","clap of thunder"],["after the storm","before the storm","above the clouds","after the hurricane","through the storm","in the clouds","in a flash","as thunder recedes","through the storm door","in the storms eye","behind a cloud"]],sun:[["lengthening shadows","warm summer morning","last rays of sunset","shadows in the sun","pale sun flickering","afternoon shadows","sun-dappled shadows","shimmering summer","sun-soaked horizon","shimmering sun lights"],["a ray of sunshine streams","the suns warmth","fleeting sun shadows","the sun mining","the suns reflections","the sun shines through","a glimmer of sun","sun shadows dance","the midday sun","the summer sky"],["into the sun","despite the days heat","in the summer heat","in the summer sunset","in the autumn sun","before the sun","into summer","toward the sun","in dappled sun shadows"]],tree:[["filtered through pine branch","between giant cedar trees ","shivering aspen","silhouette trees loom","forest silence finds","forest secrets hide","tree shadows occlude","between fallen trees"],["a solitary oak","glimpsed through trees","rises above the branches","a leafless tree","each pine needle","the leafless tree","a solitary tree","an acorn falls","the willow tree","every pine needle","a branch drips","a pine cone"],["from leafless trees","under the maple tree","between the trees","into the woods","above the pine forest","through the forest","beneath the pine","by the maple roots","from a leafless branch","on a withered branch","in the pine branch","behind the trees","under tall pines","upon a pine branch","from a tree silhouette"]],wind:[["windblown shadows reach","caterpillar breeze","blossoms in the wind","whistling wind catches","carried by the wind","gliding on the wind","hidden in the wind","gentle autumn wind"],["floating in the breeze","hanging in the air","the wind plays","carried on a breeze","the sound of the wind","caught by a breeze","a change in the wind","a soft breeze ripples","a faint breeze rises"],["before the wind","in the wind","against the winds chill","in an autumn wind","on the breeze","on the wind","into the wind","against the wind"]]};
},{}],"JeCt":[function(require,module,exports) {
module.exports=module.exports={animal:[["lointain hurlement d'un loup","sur les traces d'un loup"],["l'éveil d'un castor","un coyote hurle"],["au-dessus de la tanière de l'ours","du menton d'un orignal"]],feather:[["chant d'un oiseau","doux battement d'ailes"],["la plume du hibou","l'envol d'un goéland"],["dans le chant des cigales","dans la mélodie d'un oiseau moqueur"]],fish:[["jour de pêche à la mouche","écaille scintillante d'un poisson"],["un poisson s'élance","la bouche d'une grenouille"],["alors que la truite s'élève"]],flower:[["trois pétales tombent","printemps dans l'air"],["la danse d'un pissenlit","la fleur tombe"],["parmi les pruniers en fleurs","parmi les fleurs sauvages"]],grass:[["sifflement à travers les champs","l'herbe ondoie en rythme"],["un brin d'herbe coincé","les hautes herbes"],["dans un champ","au-delà des prairies"]],insect:[["les frelons bourdonnent","les abeilles butinent"],["une araignée capture","un ver se tortille"],["dans la tente de la chenille","au-dessus des papillons"]],leaf:[["à l'ombre du feuillage","les feuilles tombent doucement"],["une feuille sèche","une feuille tombe"],["à l'ombre du feuillage","sur chaque feuille"]],mist:[["dans l'épaisse brume du matin","le brouillard se dissipe et révèle"],["une goutte de rosée","enveloppé de brume"],["dans la brume","dans le brouillard"]],moon:[["nuit d'automne sans lune","nuit de lune d'ambroisie"],["la lune danse","un faisceau de clair de lune"],["dans la nuit claire","dans le ciel nocturne"]],rain:[["bruine d'après-midi","ondée soudaine"],["l'eau coule","un tumulte de pluie"],["après la pluie","sous la pluie"]],snow:[["montagnes enneigées","traces de pas sur la neige"],["un ange tracé dans la neige","l'ombre de la neige"],["après la première gelée","sous la glace"]],stars:[["ciel constellé d'étoiles","regarder les étoiles filantes"],["une autre étoile apparaît","blizzards d'étoiles"],["dans la lumière","après les étoiles"]],storm:[["soudain coup de tonnerre!","regarder les nuages d'été"],["percée dans les nuages","l'espace entre les nuages"],["après la tempête","avant la tempête"]],sun:[["les ombres s'allongent","doux matin d'été"],["un rayon de soleil jaillit","la chaleur du soleil"],["dans le soleil","malgré le temps chaud"]],tree:[["à travers les branches des pins","sous de gigantesques cèdres"],["un chêne solitaire","aperçu dans les arbres"],["des arbres nus","sous l'érable"]],wind:[["ombres portées par le vent","brise de chenille"],["flottant dans la brise","suspendu dans l'air"],["avant le vent","dans le vent"]]};
},{}],"KSzI":[function(require,module,exports) {
module.exports={"haiku-phrases-en":{json:require("./haiku-phrases-en.json")},"haiku-phrases-fr":{json:require("./haiku-phrases-fr.json")}};
},{"./haiku-phrases-en.json":"LLrD","./haiku-phrases-fr.json":"JeCt"}],"Wm90":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=l(require("three")),t=a(require("../assets/image/**/*.{png,jpeg,jpg,svg}")),n=a(require("../assets/spritesheets/*.{sheet,png,jpeg,jpg}")),s=a(require("../assets/json/*.{json,txtjson}")),r=require("./array"),i=a(require("right-now")),o=require("./addFrameTasks");function a(e){return e&&e.__esModule?e:{default:e}}function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var s={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(s,i,o):s[i]=e[i]}return s.default=e,n&&n.set(e,s),s}const u=null,d=!1,h=new Map;L(t.default,(e,t)=>{h.set(e,t)},["image"]),C(h,s.default,"json",{type:"json"}),C(h,n.default,"spritesheets",{type:"spritesheet-legacy"}),_(h);const f=["png","webp","jpg","jpeg"],p=[{type:"image",extensions:["svg","png","webp","jpg","jpeg"]},{type:"json",extensions:["json","sheet","txtjson"]},{type:"spritesheet-legacy"}],g=!1,y=()=>{},w=!1;let m,j;"function"==typeof window.requestIdleCallback?(m=window.requestIdleCallback.bind(window),j=window.cancelIdleCallback.bind(window)):(console.warn("[Assets] Using Request Animation Frame"),m=window.requestAnimationFrame.bind(window),j=window.cancelAnimationFrame.bind(window));const b=!1,x=["json","sheet"],v=["jpg","png"];v.unshift("svg");class O{constructor(){this._idleHandle=null,this._idleTimeout=1e3,this._loadQueuedBound=this.loadQueued.bind(this),this._ready=Promise.resolve(),this.urlMap=h,this.queue=new Set,this.cache=new Map,this.config=new Map,this.timing=new Map}urlToID(e){return this.urlMap.set(e,e),e}setConfig(e,t){this.config.set(e,t)}getConfig(e){return this.config.has(e)?this.config.get(e):{}}_processOnNextTick(){this._cancelIdle(),this._idleHandle=m(this._loadQueuedBound,{timeout:this._idleTimeout})}_cancelIdle(){null!=this._idleHandle&&(j(this._idleHandle),this._idleHandle=null)}prepare(e){(e=Array.isArray(e)?e:[e]).forEach(e=>{h.has(e)||(console.warn(`No asset by ID ${e}`),/\.[^.]+$/.test(e)&&console.warn('[Hint] Don\'t include the extension like ".png" on the asset ID')),this.queue.has(e)||this.cache.has(e)||this.queue.add(e)}),this._processOnNextTick()}loadQueued(){if(this._cancelIdle(),!this.queue.size)return Promise.resolve();y(`Loading ${this.queue.size} assets`);const e=(0,i.default)(),t=Array.from(this.queue);return this.queue.clear(),Promise.all(t.map(e=>this.load(e))).then(t=>{const n=(0,i.default)()-e;return y(`Loaded queue in ${n} ms`),t})}release(e){this.queue.has(e)&&this.queue.delete(e),this.cache.has(e)&&this.cache.delete(e),this.config.has(e)&&this.config.delete(e)}async loadGPUTexture(e,t,n,s){const r=await this.load(n);t.image=r;const i={...this.getConfig(n),...s},a=!1!==i.release,c=!1!==i.init;return i.repeat&&t.repeat.copy(i.repeat),i.offset&&t.offset.copy(i.offset),delete i.release,delete i.init,delete i.crossOrigin,delete i.repeat,delete i.offset,Object.assign(t,i),t.needsUpdate=!0,c&&(0,o.addFrameTask)(()=>{e.initTexture(t),a&&(t.image={width:r.width,height:r.height},this.release(n))}),t}async createGPUTexture(t,n,s){const r=new e.Texture;return this.loadGPUTexture(t,r,n,s)}createGPUTextureTask(t,n,s){const r=new e.Texture;return[r,this.loadGPUTexture(t,r,n,s)]}async load(e){if(this.queue.has(e)&&this.queue.delete(e),this.cache.has(e))return this.cache.get(e);const t=(0,i.default)();this.timing.set(e,t);const n=h.get(e);if(!n)return console.error(`Could not find URL for asset ID ${e}`),null;let s,r=Array.isArray(n)?"spritesheet-legacy":n.type;if(r)s=p.find(e=>e.type===r);else if("string"==typeof n){const t=$(n);if(!t)return void console.warn(`Could not extract loader type for ${e} with data: ${n}`);s=p.find(e=>e.extensions.some(e=>e===t))}else{const e=n?Object.keys(n):[];s=p.find(t=>t.extensions.some(t=>e.includes(t)))}if(!s)return void console.warn(`Could not find loader for ${e} and URL object ${n}`);const o=this.getConfig(e);let a;if("image"===s.type)a=I(e,n,o);else if("json"===s.type)a=T(e,n,o);else{if("spritesheet-legacy"!==s.type)throw new Error(`Loader type ${s.type} not yet implemented`);a=P(e,n,o)}return this.cache.set(e,a),a.then(t=>{const n=(0,i.default)(),s=this.timing.get(e),r="object"==typeof e?Object.values(e)[0]:e;return y(`Loaded ${r} in ${Math.round(n-s)} ms`),t}).catch(t=>{console.error(`Error loading Asset by ID ${e}`),console.error(t.message),this.release(e)})}}var q=new O;function k(e,t,n){if("string"==typeof t)return{ext:$(t),url:t};let s;if(!(s=n?n.find(e=>e in t):Object.keys(t)[0]))throw console.log("NO EXT",t,s,n),new Error(`Could not find a suitable extension for ${e} from: ${Object.keys(t)}`);return{ext:s,url:t[s]}}function $(e){const t=/\.([^.]+)$/.exec(e);return t&&t[1]?t[1].toLowerCase():""}function _(e){const t=Array.from(e.entries()).filter(([e,t])=>"spritesheet-legacy"===t.type),n=new Map;t.forEach(([e,t])=>{let s=e,r=0;const i=/(.*)\-([\d]+)$/.exec(s);i&&(s=i[1],r=parseInt(i[2],10)||0),n.has(s)?n.get(s).push({id:r,key:e}):n.set(s,[{id:r,key:e}])}),Array.from(n.entries()).forEach(([t,n])=>{n.sort((e,t)=>e.id-t.id);const s=n.map(t=>{const n=e.get(t.key);return e.delete(t.key),n});e.set(t,s)})}async function P(e,t,n){const s=t.map((t,s)=>{const r=e+"-"+s,i=I(r,t,n);return[T(r,t,n),i]}).flat(),r=await Promise.all(s),i=[];for(let o=0;o<r.length;o+=2){const e=r[o],t=r[o+1];i.push([e,t])}return i}async function T(e,t,n){const{ext:s,url:r}=k(e,t,x);return(await fetch(r)).json()}async function I(e,t,n){const{ext:s,url:r}=k(e,t,v);return d&&f.includes(s)?E(e,r,n):M(r,n)}async function A(e,t={}){const n=await fetch(e),s=await n.text(),r=document.createElement("canvas"),i=r.getContext("2d"),o="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(s),a=await loadImage(o,t);return r.width=a.width,r.height=a.height,i.drawImage(a,0,0),r}async function E(e,t,n={}){return new Promise((s,r)=>{u.postMessage({type:"image",id:e,url:t,config:n}),y(`Loading ${e} in worker...`),u.addEventListener("message",function t(n){if(n.data&&n.data.id===e)if(u.removeEventListener("message",t),n.data.error){let e=n.data?n.data.error:"No Data Received";console.error(`[AssetWorker] ${e}`),r(new Error(e))}else{const t=n.data.result;y(`Received ${e}`,t),s(t)}})})}function M(e,t={}){return new Promise((n,s)=>{const r=new window.Image;r.onerror=(()=>{s(new Error(`Error loading URL ${e}`))}),r.onload=(()=>{n(r)}),null!=t.crossOrigin&&(r.crossOrigin=t.crossOrigin),r.src=e})}function C(e,t,n,s={}){Object.entries(t).forEach(([t,r])=>{const i=[n,t].join("/");e.has(i)&&console.error(`WARN: Asset map already has entry by key ${i}`),r&&"object"==typeof r&&(r={...s,...r}),e.set(i,r)})}function L(e,t,n=[]){Object.entries(e).forEach(([e,s])=>{let r;if(s&&"object"==typeof s){r=!Object.values(s).some(e=>e&&"object"==typeof e)}else r="string"==typeof s;"json"===e&&(r=!0);const i=[...n,e];if(r){const e=i.join("/");t(e,s)}else L(s,t,i)})}exports.default=q;
},{"three":"IV0r","../assets/image/**/*.{png,jpeg,jpg,svg}":"Godu","../assets/spritesheets/*.{sheet,png,jpeg,jpg}":"Zi1t","../assets/json/*.{json,txtjson}":"KSzI","./array":"ibDZ","right-now":"ksES","./addFrameTasks":"l7a6"}],"noPD":[function(require,module,exports) {
module.exports={animal:require("./ico_animal.png"),feather:require("./ico_feather.png"),fish:require("./ico_fish.png"),flower:require("./ico_flower.png"),grass:require("./ico_grass.png"),insect:require("./ico_insect.png"),leaf:require("./ico_leaf.png"),mist:require("./ico_mist.png"),moon:require("./ico_moon.png"),"rain.":require("./ico_rain..png"),snow:require("./ico_snow.png"),stars:require("./ico_stars.png"),storm:require("./ico_storm.png"),sun:require("./ico_sun.png"),tree:require("./ico_tree.png"),wind:require("./ico_wind.png")};
},{"./ico_animal.png":"uNAB","./ico_feather.png":"NNzs","./ico_fish.png":"hzRD","./ico_flower.png":"vqDE","./ico_grass.png":"adun","./ico_insect.png":"dR05","./ico_leaf.png":"sLF1","./ico_mist.png":"A8Sr","./ico_moon.png":"VG6S","./ico_rain..png":"y1Ec","./ico_snow.png":"Kn32","./ico_stars.png":"WgMA","./ico_storm.png":"K8Sy","./ico_sun.png":"N66i","./ico_tree.png":"jckH","./ico_wind.png":"uCap"}],"wXX0":[function(require,module,exports) {
module.exports={animal:require("./ico_animal.png"),feather:require("./ico_feather.png"),fish:require("./ico_fish.png"),flower:require("./ico_flower.png"),grass:require("./ico_grass.png"),"insect.":require("./ico_insect..png"),leaf:require("./ico_leaf.png"),mist:require("./ico_mist.png"),moon:require("./ico_moon.png"),rain:require("./ico_rain.png"),snow:require("./ico_snow.png"),stars:require("./ico_stars.png"),storm:require("./ico_storm.png"),sun:require("./ico_sun.png"),tree:require("./ico_tree.png"),wind:require("./ico_wind.png")};
},{"./ico_animal.png":"VIuw","./ico_feather.png":"qAEk","./ico_fish.png":"KSxB","./ico_flower.png":"CUPE","./ico_grass.png":"EtQz","./ico_insect..png":"eg6e","./ico_leaf.png":"GJwl","./ico_mist.png":"qHJQ","./ico_moon.png":"vkiH","./ico_rain.png":"wIYs","./ico_snow.png":"w5qk","./ico_stars.png":"MciH","./ico_storm.png":"KGMy","./ico_sun.png":"C4oO","./ico_tree.png":"COkh","./ico_wind.png":"CLfC"}],"tnCt":[function(require,module,exports) {
module.exports={animal:require("./animal.png"),feather:require("./feather.png"),fish:require("./fish.png"),flower:require("./flower.png"),grass:require("./grass.png"),insect:require("./insect.png"),leaf:require("./leaf.png"),mist:require("./mist.png"),moon:require("./moon.png"),rain:require("./rain.png"),snow:require("./snow.png"),stars:require("./stars.png"),storm:require("./storm.png"),sun:require("./sun.png"),wind:require("./wind.png"),tree:require("./tree.png")};
},{"./animal.png":"W9m0","./feather.png":"O0Vi","./fish.png":"oi8p","./flower.png":"Qp75","./grass.png":"MewA","./insect.png":"L9ak","./leaf.png":"EHAn","./mist.png":"Utvt","./moon.png":"rqfx","./rain.png":"eH37","./snow.png":"Zbd3","./stars.png":"UFXH","./storm.png":"FUNJ","./sun.png":"L9vw","./wind.png":"vwTS","./tree.png":"s6Nz"}],"OkDW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.loadImage=n,exports.loadTexture=a;var e=r(require("three"));function t(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,n=new WeakMap;return(t=function(e){return e?n:r})(e)}function r(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=t(r);if(n&&n.has(e))return n.get(e);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var c=a?Object.getOwnPropertyDescriptor(e,i):null;c&&(c.get||c.set)?Object.defineProperty(o,i,c):o[i]=e[i]}return o.default=e,n&&n.set(e,o),o}function n(e,t={}){return new Promise(r=>{const n=new window.Image;n.onerror=(()=>{console.error(`Could not load Texture by URL ${e}`),r(n)}),n.onload=(()=>{r(n)}),null!=t.crossOrigin&&(n.crossOrigin=t.crossOrigin),n.src=e})}let o;function a(t,r={}){return(/\.svg$/i.test(t)?i(t,r):n(t,r)).then(t=>{const n=new e.Texture;n.image=t;const o={...r};return delete o.crossOrigin,Object.assign(n,o),n.needsUpdate=!0,n})}async function i(e,t={}){const r=await fetch(e),o=await r.text(),a=document.createElement("canvas"),i=a.getContext("2d"),c="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(o),s=await n(c,t);return a.width=s.width,a.height=s.height,i.drawImage(s,0,0),a}
},{"three":"IV0r"}],"Ffhm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=s;var e=o(require("three")),t=r(require("./Assets")),a=require("./load");function r(e){return e&&e.__esModule?e:{default:e}}function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(n=function(e){return e?a:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=n(t);if(a&&a.has(e))return a.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var i=o?Object.getOwnPropertyDescriptor(e,s):null;i&&(i.get||i.set)?Object.defineProperty(r,s,i):r[s]=e[s]}return r.default=e,a&&a.set(e,r),r}async function s(r,n,o={}){let s;if("string"==typeof r){const a=r;console.log("[sprites] Loading Sprite Sheet",a);const i=await t.default.load(a);r=i.map(([e])=>({data:e})),s=i.map(([t,a])=>{const r=new e.Texture;return r.image=a,r.needsUpdate=!0,n.initTexture(r),!1!==o.release&&(r.image={width:a.width,height:a.height}),r}),!1!==o.release&&t.default.release(a)}else r=await Promise.all(r.map(async e=>{if("string"==typeof e.data){const t=await fetch(e.data);let a=await t.json();e={...e,data:a}}return e})),(s=await Promise.all(r.map(({url:e})=>(0,a.loadTexture)(e)))).forEach(e=>n.initTexture(e));const i={};r.forEach(({data:t},a)=>{t.frames.forEach((r,n)=>{const o=r.frame,u=r.filename,l=new e.Texture,f=t.meta.size,{w:c,h:p}=f;l.repeat.set(o.w/c,o.h/p),l.offset.x=o.x/c,l.offset.y=1-o.h/p-o.y/p;let d="";const h=u.toLowerCase().replace(/\.(png|jpg|jpeg)$/i,"");let w=h;const m=h.lastIndexOf("/");m>=0&&(d=h.substring(0,m).toLowerCase(),w=h.substring(m+1));const g=h.match(/(^|[^\d])(\d+)$/);let y=n;g&&(y=parseInt(g[2],10));const x={atlas:s[a],sheetIndex:a,name:h,basename:w,data:o,width:o.w,height:o.h,offset:l.offset.clone(),repeat:l.repeat.clone(),texture:l,type:d,idCount:y};r.trimmed,i[h]=x})});const u=Object.values(i),l=u.slice().sort((e,t)=>e.idCount-t.idCount);return{atlases:s,map:i,frames:l,values:u}}
},{"three":"IV0r","./Assets":"Wm90","./load":"OkDW"}],"kL9I":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getTokenSheet=p,exports.loadTokenSprites=h,exports.createTokenCanvas=k,exports.BiomeFeatures=exports.AllTokens=exports.TokenURLs=exports.CollectedTokenURLs=exports.InvertedTokenURLs=void 0;var e=o(require("../assets/image/tokens/ico_*.png")),t=o(require("../assets/image/tokens-inverted/ico_*.png")),s=o(require("../assets/image/tokens-collected/*.png")),n=o(require("./SpriteManager"));function o(e){return e&&e.__esModule?e:{default:e}}const r=t.default;exports.InvertedTokenURLs=r;const a=s.default;exports.CollectedTokenURLs=a;const i=e.default;exports.TokenURLs=i;const l=["sun","moon","wind","mist","rain","storm","tree","leaf","fish","animal","feather","grass","flower","insect","snow","stars"];exports.AllTokens=l;const d={forest:{tokens:["sun","moon","mist","rain","storm","tree","leaf","fish","animal","feather","flower","insect","stars"]},grasslands:{tokens:["sun","moon","wind","mist","rain","storm","fish","animal","feather","grass","flower","insect","stars"]},tundra:{tokens:["moon","wind","mist","rain","storm","tree","fish","animal","feather","flower","insect","snow","stars"]}};exports.BiomeFeatures=d;const c=new Map;let m,u=new Promise(e=>{m=e}),f={};function p(){return u}function h(e){(0,n.default)("spritesheets/tokens",e,{release:!1}).then(e=>{m(e)})}async function k(e){const t=await u,s=document.createElement("canvas");if(e in t.map){const n=t.map[e];s.width=n.width,s.height=n.height,s.getContext("2d").drawImage(t.atlases[0].image,n.data.x,n.data.y,n.data.w,n.data.h,0,0,n.width,n.height)}else console.error("Name %s not in token sheet",e);return s}
},{"../assets/image/tokens/ico_*.png":"noPD","../assets/image/tokens-inverted/ico_*.png":"wXX0","../assets/image/tokens-collected/*.png":"tnCt","./SpriteManager":"Ffhm"}],"q18m":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("svelte/internal"),e=require("svelte"),i=require("../animations/transitions"),n=r(require("../util/Assets")),o=require("../util/tokens");function r(t){return t&&t.__esModule?t:{default:t}}function s(e){let i,n,o,r,s,a;return{c(){i=(0,t.element)("div"),(0,t.attr)(i,"class","image-container svelte-kj6g8f"),(0,t.set_style)(i,"width",e[0]),(0,t.set_style)(i,"height",e[1]),(0,t.toggle_class)(i,"ignorePointer",e[4])},m(n,o){(0,t.insert)(n,i,o),e[14](i),r=!0,s||(a=[(0,t.listen)(i,"introend",e[10]),(0,t.listen)(i,"introstart",e[11]),(0,t.listen)(i,"outroend",e[12]),(0,t.listen)(i,"outrostart",e[13])],s=!0)},p(e,[n]){(!r||1&n)&&(0,t.set_style)(i,"width",e[0]),(!r||2&n)&&(0,t.set_style)(i,"height",e[1]),16&n&&(0,t.toggle_class)(i,"ignorePointer",e[4])},i(s){r||((0,t.add_render_callback)(()=>{o&&o.end(1),n||(n=(0,t.create_in_transition)(i,e[2],{})),n.start()}),r=!0)},o(s){n&&n.invalidate(),o=(0,t.create_out_transition)(i,e[3],{}),r=!1},d(n){n&&(0,t.detach)(i),e[14](null),n&&o&&o.end(),s=!1,(0,t.run_all)(a)}}}function a(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function l(r,s,l){let u,{alt:d=""}=s,{width:c="initial"}=s,{height:h="initial"}=s,{id:g}=s,{image:f}=s,{token:_=!1}=s,{inTransition:b=i.emptyTransition}=s,{outTransition:p=i.emptyTransition}=s,{ignorePointer:m=!1}=s,v=Promise.resolve(),T=[],y=!1;return(0,e.onMount)(()=>(T.forEach(t=>t()),T.length=0,()=>{T.length=0,y=!0})),r.$$set=(t=>{"alt"in t&&l(6,d=t.alt),"width"in t&&l(0,c=t.width),"height"in t&&l(1,h=t.height),"id"in t&&l(7,g=t.id),"image"in t&&l(8,f=t.image),"token"in t&&l(9,_=t.token),"inTransition"in t&&l(2,b=t.inTransition),"outTransition"in t&&l(3,p=t.outTransition),"ignorePointer"in t&&l(4,m=t.ignorePointer)}),r.$$.update=(()=>{896&r.$$.dirty&&async function(t,e,i){T.length=0,await v,v=t?"function"==typeof t.then?t:Promise.resolve(t):e?(0,o.createTokenCanvas)(i):n.default.load(i);const r=await v;function s(){if(y)return;a(u);const i=t||e?r:r.cloneNode();i.setAttribute("draggable",!1),u.appendChild(i)}u?s():T.push(s)}(f,_,g)}),[c,h,b,p,m,u,d,g,f,_,function(e){(0,t.bubble)(r,e)},function(e){(0,t.bubble)(r,e)},function(e){(0,t.bubble)(r,e)},function(e){(0,t.bubble)(r,e)},function(e){t.binding_callbacks[e?"unshift":"push"](()=>{l(5,u=e)})}]}class u extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,l,s,t.safe_not_equal,{alt:6,width:0,height:1,id:7,image:8,token:9,inTransition:2,outTransition:3,ignorePointer:4})}}var d=u;exports.default=d;
},{"svelte/internal":"xeIE","svelte":"XHT5","../animations/transitions":"bvJy","../util/Assets":"Wm90","../util/tokens":"kL9I"}],"YEU1":[function(require,module,exports) {
function t(t,n){for(var e in n)t.setAttribute(e,n[e])}function n(t,n){t.onload=function(){this.onerror=this.onload=null,n(null,t)},t.onerror=function(){this.onerror=this.onload=null,n(new Error("Failed to load "+this.src),t)}}function e(t,n){t.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,n(null,t))}}module.exports=function(o,a,r){var c=document.head||document.getElementsByTagName("head")[0],i=document.createElement("script");"function"==typeof a&&(r=a,a={}),a=a||{},r=r||function(){},i.type=a.type||"text/javascript",i.charset=a.charset||"utf8",i.async=!("async"in a)||!!a.async,i.src=o,a.attrs&&t(i,a.attrs),a.text&&(i.text=""+a.text),("onload"in i?n:e)(i,r),i.onload||n(i,r),c.appendChild(i)};
},{}],"xXsD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=/(Android|webOS|iPod|BlackBerry|Phone|playbook|silk|iOS|iPad|iPhone)/i.test(navigator.userAgent);exports.default=e;
},{}],"dkeN":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.localize=exports.language=void 0;var e=require("svelte/store"),r=a(require("../config")),n=a(require("./query-string")),t=a(require("./isMobile"));function a(e){return e&&e.__esModule?e:{default:e}}const o={nfbInteractiveLink:{en:"https://www.nfb.ca/interactive/",fr:"https://www.onf.ca/interactif/"},introBlurbOne:{en:"an animated journey across",fr:"une excursion animée"},introBlurbTwo:{en:"the poetry of the land",fr:"à travers la poésie du paysage"},startButton:{en:"start",fr:"démarrer"},resumeButton:{en:"resume",fr:"reprendre"},aboutButton:{en:"info",fr:"à propos"},skipButton:{en:"skip",fr:"passer"},continueButton:{en:"continue",fr:"continuer"},journalTitle:{en:"poems",fr:"poèmes"},newMemory:{en:"you've collected a new memory",fr:"tu as récupéré un nouveau souvenir"},introPlaceholder:{en:"nature is losing its memories...",fr:"TBD FR translation"},tapOrClickAndHold:{en:`${t.default?"Tap":"Click"} + Hold`,fr:`${t.default?"Appuyez":"Cliquez ou"} touchez`},tutorialTapHold:{en:`${t.default?"Tap":"Click"} and hold to explore`,fr:`${t.default?"Appuyez":"Cliquez ou "} et maintenez pour explorer`},tutorialResolve:{en:"Find the tree at the centre, to return the memories to the land",fr:"Trouvez l’arbre au centre du monde pour rendre à la terre ses souvenirs"},tutorialCollect:{en:"Collect tokens to recover nature’s lost memories",fr:"Rassemblez des éléments pour reconstituer la mémoire de la nature"},introVideoLine0:{en:"Nature's balance is endangered",fr:"L'équilibre naturel est en danger"},introVideoLine1:{en:"Memories of the land are fracturing",fr:"Les souvenirs de la terre s'évanouissent"},introVideoLine2:{en:"Recover the lost fragments to restore balance",fr:"Retrouvez les fragments perdus pour rétablir l'équilibre"},nfbProduction:{en:"A game by Matt DesLauriers",fr:"Un jeu de Matt DesLauriers"},nfbSubcaption:{en:"Produced by the National Film Board of Canada",fr:"Produit par l’Office national du film du Canada"},playHeader:{en:"play",fr:"jeu"},aboutHeader:{en:"about",fr:"à propos"},creditsHeader:{en:"credits",fr:"crédits"},moveCharacterText:{en:"to move the character across the landscape, in search of tokens that reveal lyrical fragments hidden in the wind.",fr:"l'écran pour que le personnage se déplace dans son environnement à la recherche d'éléments qui révèleront des fragments lyriques cachés dans le vent."},collectText:{en:"COLLECT",fr:"AMASSEZ"},tokenStringText:{en:"tokens and string them together to form haiku-like poetry, recovering lost memories of nature.",fr:"des éléments et assemblez-les pour former des poèmes ressemblant à des haïkus, retrouvant ainsi les souvenirs perdus de la nature."},orientText:{en:"ORIENT",fr:"ORIENTEZ-VOUS"},compassStringText:{en:"yourself with the Compass if you are lost or need a hint finding the closest tokens.",fr:"à l’aide de la Boussole si vous êtes perdu ou avez besoin d’un indice pour découvrir les éléments autour de vous."},returnText:{en:"RETURN",fr:"RENDEZ"},memoriesStringText:{en:"the memories once you’ve collected enough to the Origin Tree at the centre of the world, advancing you to the next stage of the experience and bringing you closer to fully restoring nature’s balance.",fr:"à la terre ses souvenirs. Lorsque vous aurez assemblé suffisamment de poèmes, trouvez l’Arbre Originel au centre de l’univers. Vous passerez alors à la prochaine étape de l’expérience, vous rapprochant de votre but ultime: restaurer entièrement l’équilibre de la nature."},wayfinderStrongText:{en:"WAYFINDER",fr:"TRAVERSÉES"},wayfinderTextParagraph:{en:"is an expression of our connectedness to the natural world. It's an opportunity to renew a damaged ecosystem through discovery and verse. The calming, contemplative gameplay is symbolic of the cause-and-effect relationship humans have with nature. It underscores our role in both affecting, but ultimately remedying, the effects of climate change through action and a greater appreciation of the environment.",fr:"est une expression de notre connexion avec le monde naturel. C’est une occasion de renouveler, par l’entremise de la découverte et du vers, un écosystème endommagé. L’expérience de jeu, apaisante et contemplative, symbolise la relation de cause à effet que les humains entretiennent avec la nature. Elle souligne notre responsabilité face aux effets des changements climatiques et notre capacité à les entraîner, comme à y remédier, à travers nos actions et une plus grande appréciation de l’environnement."},wayfinderFurtherTextParagraph:{en:"The art is generative. The visual assets and poetry are assembled procedurally and algorithmically through code, creating different combinations for each new visitor. The textured, hand-illustrated aesthetic is delivered in real-time, and the poetic verses are created with a mix of artificial intelligence/machine learning and generative processes, providing thousands of possible combinations. As such, Wayfinder is an ever-changing, emergent artwork with infinite possibilities. Each time it runs, it produces a new and individualized world.",fr:"L’art est génératif. Les éléments visuels et la poésie sont assemblés de manière procédurale et algorithmique à l’aide de code, créant différentes combinaisons pour chaque nouveau visiteur. L’esthétique texturée et illustrée à la main est livrée en temps réel, et les vers poétiques sont créés par un mélange d’intelligence artificielle/apprentissage machine et de processus génératifs, offrant ainsi des milliers de combinaisons possibles. Par conséquent, Traversées est une œuvre d’art émergente en constante évolution, renfermant d’infinies possibilités, qui produit un monde nouveau et individualisé à chaque utilisation."},moreAt:{en:"More at ",fr:"Plus d'infos à"},moreAtLink:{en:"https://www.nfb.ca/interactive/wayfinder/",fr:"https://www.onf.ca/interactif/traversees/"},moreAtLinkText:{en:"nfb.ca/interactive/wayfinder",fr:"onf.ca/interactif/traversees"},mattRole:{en:"Concept, Design and Code",fr:"Concept, design et code"},guillaumeRole:{en:"Animation and 3D Modelling",fr:"Animation et modélisation 3D"},cedrineRole:{en:"UI Design",fr:"Conception UI"},williamRole:{en:"Creative Developer",fr:"Développeur créatif"},boombox:{en:"Music & Sound",fr:"Musique et son"},jelaniRole:{en:"Junior Developer",fr:"Développeur junior"},nicholasRole:{en:"Producer",fr:"Producteur"},robRole:{en:"Executive Producer",fr:"Producteur exécutif"},jasmineRole:{en:"Senior Production Coordinator",fr:"Coordonnatrice de production principale"},camilleJanineRole:{en:"Operation Managers",fr:"Gestionnaires des opérations"},victoriaRole:{en:"Studio Administrator",fr:"Administratrice du studio"},tammyRole:{en:"Marketing Managers",fr:"Responsable marketing"},jenniferRole:{en:"Publicist",fr:"Relationniste"},ericRole:{en:"Marketing Coordinator",fr:"Coordonnateur marketing"},sergiuRole:{en:"Information Technology",fr:"Technologie de l'information"},catherineRole:{en:"Digital Platforms",fr:"Plateformes numériques"},christianRole:{en:"Legal Services",fr:"Services juridiques"},socialRole:{en:"Social Media",fr:"Médias sociaux"},gabrielleRole:{en:"French Translation by",fr:"Traduction française par"},introPresents:{en:"The National Film Board of Canada Presents",fr:"L'Office national du film du Canada présente"},endState0:{en:"You've recovered all the lost poetic fragments.",fr:"Vous avez retrouvé tous les fragments poétiques perdus."},endState1:{en:"With your help, nature's memories have been restored.",fr:"Avec votre aide, les souvenirs de la nature ont été restaurés."},endState2:{en:'Thanks for playing. See more NFB projects at <a href="https://www.nfb.ca/interactive/">nfb.ca/interactive</a>',fr:"Merci d'avoir joué. Découvrez d'autres projets de l'ONF sur <a href=\"https://www.onf.ca/interactif/\">onf.ca/interactif</a>"},endState2A:{en:"Thanks for playing.",fr:"Merci d'avoir joué."},endState2B:{en:'See more NFB projects at <a href="https://www.nfb.ca/interactive/">nfb.ca/interactive</a>',fr:"Découvrez d'autres projets de l'ONF sur <a href=\"https://www.onf.ca/interactif/\">onf.ca/interactif</a>"},journalButton:{en:"poems",fr:"poèmes"}},i=e=>Object.entries(o).reduce((r,n)=>(r[n[0]]=n[1][e],r),{}),s={en:i("en"),fr:i("fr")},l="fr"===(0,r.default)().lang||/^fr$/i.test(n.default.lang)?"fr":"en";let u=l,c=s[u];const d=(0,e.writable)(l);exports.language=d;const f=(0,e.writable)(c);exports.localize=f,f.get=function(){return c},d.set=function(e){if("en"!==e&&"fr"!==e)throw new Error(`Invalid language ${e}`);return d.update(()=>e)},d.subscribe(e=>{c=s[u=e],f.update(()=>c)}),d.get=function(){return u};
},{"svelte/store":"nBdo","../config":"nZps","./query-string":"Bj6B","./isMobile":"xXsD"}],"so68":[function(require,module,exports) {
"use strict";function e(e){var i,d;if(void 0!==document.hidden?(i="hidden",d="visibilitychange"):void 0!==document.msHidden?(i="msHidden",d="msvisibilitychange"):void 0!==document.webkitHidden&&(i="webkitHidden",d="webkitvisibilitychange"),i){const t=()=>{document[i]?e(!1):e(!0)};document.addEventListener(d,t,!1),t()}else e(!0)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"G6DW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.audioState=void 0;var e=require("svelte/store"),t=i(require("./documentVisibility"));function i(e){return e&&e.__esModule?e:{default:e}}const r=(0,e.writable)({visible:!0,muted:!1});exports.audioState=r,(0,t.default)(e=>{r.update(t=>({...t,visible:e}))});
},{"svelte/store":"nBdo","./documentVisibility":"so68"}],"Xlf9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sendTrackingPixel=w,exports.revealHeader=p,exports.hideHeader=_,exports.sendAnalytics=y,exports.startButtonTracking=h;var e=r(require("load-script")),t=r(require("./config.js")),a=require("./util/locale.js"),n=require("./util/stores.js");function r(e){return e&&e.__esModule?e:{default:e}}const o=[],d="wayfinder",i=!0;let c,l=null,s=!1;const u=new Promise(e=>{c=e});let f;const g=new Promise(e=>{f=e});function w(){if(!(0,t.default)().nfbHeader)return;let e=new Image;e.onload=(()=>{console.log("[analytics] Tracking Pixel"),e=null}),e.onerror=(()=>{e=null,console.warn("[analytics] Tracking Pixel Ignored")}),e.src="https://ad.doubleclick.net/ddm/activity/src=10976879;type=1;cat=start0;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;tfua=;npa=;gdpr=${GDPR};gdpr_consent=${GDPR_CONSENT_755};ord=1?"}async function p(){await Promise.all([u,g]),window.ifw_header.reveal()}async function _(){await Promise.all([u,g]),window.ifw_header.hide()}async function y(e={}){if(console.log("[analytics] Sending",e),await u,"undefined"!=typeof google_analytics&&"function"==typeof google_analytics.gaTrack){const n=a.language.get();try{o.forEach(t=>{google_analytics.gaTrack({...e,language:n,name:d,ua_code:t})})}catch(t){console.warn(t)}}}function h(){}window.revealHeader=p,(0,t.default)().nfbHeader?(document.addEventListener("ifw_muteSound",e=>{n.audioState.update(e=>({...e,muted:!0}))}),document.addEventListener("ifw_unmuteSound",e=>{n.audioState.update(e=>({...e,muted:!1}))}),document.addEventListener("ifw_headerAdded",()=>{window.ifw_header.hide(),f()}),document.addEventListener("ifw_headerLoaded",()=>{window.ifw_header.init({projectId:237,baseUrl:{en:"http://wayfinder.nfb.ca/",fr:"http://traversees.onf.ca/"},analytics_name:"wayfinder",analytics_code:o[0],buttons:{shareTwitter:!1,shareFB:!1,hideOnScroll:!1},forceLocale:a.language.get()}),console.log("NFB Header Loaded"),c(),y({pageview:"index"}),y({event:"auto_begin",eventLabel:"Wayfinder"})}),(0,e.default)("https://interactive-pip.nfb.ca/v2/app.js",{async:!0,type:"text/javascript"},(e,t)=>{e&&(console.error("Could not load NFB header"),console.error(e),c())})):setTimeout(c,0);
},{"load-script":"YEU1","./config.js":"nZps","./util/locale.js":"dkeN","./util/stores.js":"G6DW"}],"IjtP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.backIn=r,exports.backInOut=n,exports.backOut=u,exports.bounceIn=c,exports.bounceInOut=o,exports.bounceOut=e,exports.circIn=s,exports.circInOut=i,exports.circOut=a,exports.cubicIn=x,exports.cubicInOut=p,exports.cubicOut=f,exports.elasticIn=h,exports.elasticInOut=M,exports.elasticOut=I,exports.expoIn=q,exports.expoInOut=O,exports.expoOut=b,exports.quadIn=P,exports.quadInOut=w,exports.quadOut=d,exports.quartIn=j,exports.quartInOut=l,exports.quartOut=k,exports.quintIn=m,exports.quintInOut=y,exports.quintOut=v,exports.sineIn=g,exports.sineInOut=_,exports.sineOut=z,Object.defineProperty(exports,"linear",{enumerable:!0,get:function(){return t.identity}});var t=require("../internal/index.mjs");function n(t){const n=2.5949095;return(t*=2)<1?t*t*((n+1)*t-n)*.5:.5*((t-=2)*t*((n+1)*t+n)+2)}function r(t){const n=1.70158;return t*t*((n+1)*t-n)}function u(t){const n=1.70158;return--t*t*((n+1)*t+n)+1}function e(t){const n=t*t;return t<4/11?7.5625*n:t<8/11?9.075*n-9.9*t+3.4:t<.9?4356/361*n-35442/1805*t+16061/1805:10.8*t*t-20.52*t+10.72}function o(t){return t<.5?.5*(1-e(1-2*t)):.5*e(2*t-1)+.5}function c(t){return 1-e(1-t)}function i(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}function s(t){return 1-Math.sqrt(1-t*t)}function a(t){return Math.sqrt(1- --t*t)}function p(t){return t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1}function x(t){return t*t*t}function f(t){const n=t-1;return n*n*n+1}function M(t){return t<.5?.5*Math.sin(13*Math.PI/2*2*t)*Math.pow(2,10*(2*t-1)):.5*Math.sin(-13*Math.PI/2*(2*t-1+1))*Math.pow(2,-10*(2*t-1))+1}function h(t){return Math.sin(13*t*Math.PI/2)*Math.pow(2,10*(t-1))}function I(t){return Math.sin(-13*(t+1)*Math.PI/2)*Math.pow(2,-10*t)+1}function O(t){return 0===t||1===t?t:t<.5?.5*Math.pow(2,20*t-10):-.5*Math.pow(2,10-20*t)+1}function q(t){return 0===t?t:Math.pow(2,10*(t-1))}function b(t){return 1===t?t:1-Math.pow(2,-10*t)}function w(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)}function P(t){return t*t}function d(t){return-t*(t-2)}function l(t){return t<.5?8*Math.pow(t,4):-8*Math.pow(t-1,4)+1}function j(t){return Math.pow(t,4)}function k(t){return Math.pow(t-1,3)*(1-t)+1}function y(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}function m(t){return t*t*t*t*t}function v(t){return--t*t*t*t*t+1}function _(t){return-.5*(Math.cos(Math.PI*t)-1)}function g(t){const n=Math.cos(t*Math.PI*.5);return Math.abs(n)<1e-14?1:1-n}function z(t){return Math.sin(t*Math.PI/2)}
},{"../internal/index.mjs":"xeIE"}],"ly0Q":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.blur=o,exports.crossfade=c,exports.draw=p,exports.fade=r,exports.fly=a,exports.scale=s,exports.slide=i;var t=require("../easing/index.mjs"),e=require("../internal/index.mjs");function n(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n}function o(e,{delay:n=0,duration:o=400,easing:r=t.cubicInOut,amount:a=5,opacity:i=0}){const s=getComputedStyle(e),p=+s.opacity,c="none"===s.filter?"":s.filter,d=p*(1-i);return{delay:n,duration:o,easing:r,css:(t,e)=>`opacity: ${p-d*e}; filter: ${c} blur(${e*a}px);`}}function r(e,{delay:n=0,duration:o=400,easing:r=t.linear}){const a=+getComputedStyle(e).opacity;return{delay:n,duration:o,easing:r,css:t=>`opacity: ${t*a}`}}function a(e,{delay:n=0,duration:o=400,easing:r=t.cubicOut,x:a=0,y:i=0,opacity:s=0}){const p=getComputedStyle(e),c=+p.opacity,d="none"===p.transform?"":p.transform,u=c*(1-s);return{delay:n,duration:o,easing:r,css:(t,e)=>`\n\t\t\ttransform: ${d} translate(${(1-t)*a}px, ${(1-t)*i}px);\n\t\t\topacity: ${c-u*e}`}}function i(e,{delay:n=0,duration:o=400,easing:r=t.cubicOut}){const a=getComputedStyle(e),i=+a.opacity,s=parseFloat(a.height),p=parseFloat(a.paddingTop),c=parseFloat(a.paddingBottom),d=parseFloat(a.marginTop),u=parseFloat(a.marginBottom),l=parseFloat(a.borderTopWidth),y=parseFloat(a.borderBottomWidth);return{delay:n,duration:o,easing:r,css:t=>"overflow: hidden;"+`opacity: ${Math.min(20*t,1)*i};`+`height: ${t*s}px;`+`padding-top: ${t*p}px;`+`padding-bottom: ${t*c}px;`+`margin-top: ${t*d}px;`+`margin-bottom: ${t*u}px;`+`border-top-width: ${t*l}px;`+`border-bottom-width: ${t*y}px;`}}function s(e,{delay:n=0,duration:o=400,easing:r=t.cubicOut,start:a=0,opacity:i=0}){const s=getComputedStyle(e),p=+s.opacity,c="none"===s.transform?"":s.transform,d=1-a,u=p*(1-i);return{delay:n,duration:o,easing:r,css:(t,e)=>`\n\t\t\ttransform: ${c} scale(${1-d*e});\n\t\t\topacity: ${p-u*e}\n\t\t`}}function p(e,{delay:n=0,speed:o,duration:r,easing:a=t.cubicInOut}){const i=e.getTotalLength();return void 0===r?r=void 0===o?800:i/o:"function"==typeof r&&(r=r(i)),{delay:n,duration:r,easing:a,css:(t,e)=>`stroke-dasharray: ${t*i} ${e*i}`}}function c(o){var{fallback:r}=o,a=n(o,["fallback"]);const i=new Map,s=new Map;function p(n,o,i){return(s,p)=>(n.set(p.key,{rect:s.getBoundingClientRect()}),()=>{if(o.has(p.key)){const{rect:n}=o.get(p.key);return o.delete(p.key),function(n,o,r){const{delay:i=0,duration:s=(t=>30*Math.sqrt(t)),easing:p=t.cubicOut}=(0,e.assign)((0,e.assign)({},a),r),c=o.getBoundingClientRect(),d=n.left-c.left,u=n.top-c.top,l=n.width/c.width,y=n.height/c.height,g=Math.sqrt(d*d+u*u),f=getComputedStyle(o),m="none"===f.transform?"":f.transform,$=+f.opacity;return{delay:i,duration:(0,e.is_function)(s)?s(g):s,easing:p,css:(t,e)=>`\n\t\t\t\topacity: ${t*$};\n\t\t\t\ttransform-origin: top left;\n\t\t\t\ttransform: ${m} translate(${e*d}px,${e*u}px) scale(${t+(1-t)*l}, ${t+(1-t)*y});\n\t\t\t`}}(n,s,p)}return n.delete(p.key),r&&r(s,p,i)})}return[p(s,i,!1),p(i,s,!0)]}
},{"../easing/index.mjs":"IjtP","../internal/index.mjs":"xeIE"}],"zEt0":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/intro.bf43cad8.mp4";
},{}],"M4mV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unmountVideo=s,exports.hasVideo=u,exports.pauseVideo=a,exports.getMetadata=l,exports.getVideo=d;var e=i(require("../assets/video/intro.mp4")),t=require("./stores");function i(e){return e&&e.__esModule?e:{default:e}}let o,n,r=new Promise(e=>{n=e});function s(){o&&(console.log("pausing video"),o.pause(),o.parentElement&&o.parentElement.removeChild(o),o=null)}function u(){return Boolean(o)}function a(){o&&o.pause()}function l(){return r}function d(){return o||((o=document.createElement("video")).className="global-intro-video",o.style.visibility="hidden",o.setAttribute("src",e.default),o.setAttribute("webkit-playsinline","webkit-playsinline"),o.setAttribute("playsinline","playsinline"),o.setAttribute("preload","auto"),o.volume=.4,o.removeAttribute("controls"),o.addEventListener("loadedmetadata",n),o.load()),o}t.audioState.subscribe(({muted:e,visible:t})=>{const i=e||!t;if(u()){d().muted=i}});
},{"../assets/video/intro.mp4":"zEt0","./stores":"G6DW"}],"p7jd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("svelte/internal"),e=require("../util/locale.js"),a=s(require("../assets/image/ui/ico_haiku.png")),n=s(require("../assets/image/ui/ico_haiku_leaf.png")),i=require("../animations/transitions.js");function s(t){return t&&t.__esModule?t:{default:t}}function r(e){let i,s,r,u,l,o,c,p,d,g,_,m,f,v,T,b=e[4].journalTitle+"";return{c(){i=(0,t.element)("div"),s=(0,t.element)("img"),u=(0,t.space)(),l=(0,t.element)("div"),o=(0,t.element)("img"),p=(0,t.space)(),d=(0,t.element)("p"),g=(0,t.text)(b),s.src!==(r=a.default)&&(0,t.attr)(s,"src",r),(0,t.attr)(s,"alt","Haiku Tag"),(0,t.attr)(s,"class","haiku-tag svelte-n0azwu"),o.src!==(c=n.default)&&(0,t.attr)(o,"src",c),(0,t.attr)(o,"alt","Haiku Tag Leaf"),(0,t.attr)(o,"class","haiku-tag-leaf svelte-n0azwu"),(0,t.attr)(d,"class","haiku-tag-text svelte-n0azwu"),(0,t.attr)(l,"class","haiku-tag-text-container svelte-n0azwu"),(0,t.attr)(i,"class","haiku-tag-container svelte-n0azwu"),(0,t.toggle_class)(i,"button",e[0]),(0,t.toggle_class)(i,"useMargin",e[3])},m(a,n){(0,t.insert)(a,i,n),(0,t.append)(i,s),(0,t.append)(i,u),(0,t.append)(i,l),(0,t.append)(l,o),(0,t.append)(l,p),(0,t.append)(l,d),(0,t.append)(d,g),f=!0,v||(T=(0,t.listen)(i,"click",e[5]),v=!0)},p(e,[a]){(!f||16&a)&&b!==(b=e[4].journalTitle+"")&&(0,t.set_data)(g,b),1&a&&(0,t.toggle_class)(i,"button",e[0]),8&a&&(0,t.toggle_class)(i,"useMargin",e[3])},i(a){f||((0,t.add_render_callback)(()=>{m&&m.end(1),_||(_=(0,t.create_in_transition)(i,e[1],{})),_.start()}),f=!0)},o(a){_&&_.invalidate(),m=(0,t.create_out_transition)(i,e[2],{}),f=!1},d(e){e&&(0,t.detach)(i),e&&m&&m.end(),v=!1,T()}}}function u(a,n,s){let r;(0,t.component_subscribe)(a,e.localize,t=>s(4,r=t));let{button:u=!0}=n,{inTransition:l=i.emptyTransition}=n,{outTransition:o=i.emptyTransition}=n,{useMargin:c=!0}=n;return a.$$set=(t=>{"button"in t&&s(0,u=t.button),"inTransition"in t&&s(1,l=t.inTransition),"outTransition"in t&&s(2,o=t.outTransition),"useMargin"in t&&s(3,c=t.useMargin)}),[u,l,o,c,r,function(e){(0,t.bubble)(a,e)}]}class l extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,u,r,t.safe_not_equal,{button:0,inTransition:1,outTransition:2,useMargin:3})}}var o=l;exports.default=o;
},{"svelte/internal":"xeIE","../util/locale.js":"dkeN","../assets/image/ui/ico_haiku.png":"yK9j","../assets/image/ui/ico_haiku_leaf.png":"HG4l","../animations/transitions.js":"bvJy"}],"V7ba":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("./array");class t{constructor(){this._events={}}dispose(){for(let e in this._events)this._events.hasOwnProperty(e)&&delete this._events;return this}on(e,t){return e in this._events?this._events[e].push(t):this._events[e]=[t],this}once(e,t){const s=(...i)=>(this.off(e,s),t(...i));return this.on(e,s)}off(t,s){return t in this._events&&(0,e.spliceObject)(this._events[t],s),this}emit(e,t){if(e in this._events){const s=this._events[e];for(let e=0;e<s.length;e++)s[e](t)}return this}}exports.default=t;
},{"./array":"ibDZ"}],"xJnI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=n;var e=t(require("./tiny-event"));function t(e){return e&&e.__esModule?e:{default:e}}function n(t){null==t&&(t=window),s(t)&&(t={target:t});const{target:n=window,parent:c=window,tapDistanceThreshold:f=10,tapDelay:l=300,preventDefault:a=!1,filtered:v=!0,passive:h=!0}=t,m=h?{passive:!0}:void 0,w=new e.default;let p,g,E,L=!1,b=!1;return _(),w.enable=_,w.disable=function(){if(!b)return;b=!1,n.removeEventListener("touchstart",y),c.removeEventListener("touchend",D),c.removeEventListener("touchmove",T),n.removeEventListener("mousedown",y),c.removeEventListener("mouseup",D),c.removeEventListener("mousemove",T),a&&(window.removeEventListener("dragstart",x),document.removeEventListener("touchmove",x))},Object.defineProperties(w,{target:{get:()=>n},parent:{get:()=>c}}),w;function y(e){L=!0;const t=j(e,M(e),n);E=t.position.slice(),g=Date.now(),console.log("down"),w.emit("down",t)}function D(e){const t=L,o=M(e);let r=!0;if(!v||!e.changedTouches||o&&o.identifier===p||(r=!1),o&&r){const r=j(e,o,n);if(p=null,(t||r.inside)&&w.emit("up",r),null!=E){const e=Date.now()-g,t=i(r.position,E);e<=l&&t<f&&w.emit("tap",r),E=null}L=!1}}function T(e){const t=M(e);if(t){if(v&&e.changedTouches&&null!=t.identifier){o(t,d(n))&&(L=!0)}const i=j(e,t,n);(L||i.inside)&&w.emit("move",i)}}function _(){b||(b=!0,n.addEventListener("touchstart",y,m),c.addEventListener("touchend",D,m),c.addEventListener("touchmove",T,m),n.addEventListener("mousedown",y,m),c.addEventListener("mouseup",D,m),c.addEventListener("mousemove",T,m),a&&(window.addEventListener("dragstart",x,{passive:!1}),document.addEventListener("touchmove",x,{passive:!1})))}function x(e){return e.preventDefault(),!1}function M(e){if(e.changedTouches){const t=e.changedTouches;if(v){if(null==p){const e=function(e){for(let t=0;t<e.length;t++){const i=e[t];if(i.target===n)return i}return null}(t)||t[0];return p=e.identifier,e}return function(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.identifier===t)return i}return null}(t,p)}return t[0]}return e}function j(e,t,n){const i=d(n),s=u(t,n,i),c=r(s,i);return{dragging:L,touch:t,inside:o(t,i),position:s,uv:c,event:e,bounds:i}}}function i(e,t){const n=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(n*n+i*i)}function o(e,t){const{clientX:n,clientY:i}=e;return n>=t.left&&n<t.right&&i>=t.top&&i<t.bottom}function r(e,t){return[e[0]/t.width,e[1]/t.height]}function u(e,t,n){const{clientX:i,clientY:o}=e;return[i-n.left,o-n.top]}function d(e){return e===window||e===document||e===document.body?{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}:e.getBoundingClientRect()}function s(e){if(!e||null==e)return!1;return e===("undefined"!=typeof window?window:null)||"number"==typeof e.nodeType&&"string"==typeof e.nodeName}
},{"./tiny-event":"V7ba"}],"b4oK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("svelte/internal"),e=n(require("./Image.svelte"));function n(t){return t&&t.__esModule?t:{default:t}}function i(e){let n,i;return{c(){n=(0,t.element)("img"),(0,t.attr)(n,"class","icon svelte-fi0yj6"),n.src!==(i=e[0])&&(0,t.attr)(n,"src",i),(0,t.attr)(n,"alt",e[4])},m(e,i){(0,t.insert)(e,n,i)},p(e,l){1&l&&n.src!==(i=e[0])&&(0,t.attr)(n,"src",i),16&l&&(0,t.attr)(n,"alt",e[4])},i:t.noop,o:t.noop,d(e){e&&(0,t.detach)(n)}}}function l(n){let i,l;return i=new e.default({props:{id:n[1],alt:n[4],image:n[2],ignorePointer:!0}}),{c(){(0,t.create_component)(i.$$.fragment)},m(e,n){(0,t.mount_component)(i,e,n),l=!0},p(t,e){const n={};2&e&&(n.id=t[1]),16&e&&(n.alt=t[4]),4&e&&(n.image=t[2]),i.$set(n)},i(e){l||((0,t.transition_in)(i.$$.fragment,e),l=!0)},o(e){(0,t.transition_out)(i.$$.fragment,e),l=!1},d(e){(0,t.destroy_component)(i,e)}}}function a(e){let n,a,o,s,r,c;const d=[l,i],u=[];function g(t,e){return t[1]||t[2]?0:t[0]?1:-1}return~(a=g(e))&&(o=u[a]=d[a](e)),{c(){n=(0,t.element)("div"),o&&o.c(),(0,t.attr)(n,"class","button svelte-fi0yj6"),(0,t.toggle_class)(n,"small",e[5]),(0,t.toggle_class)(n,"medium",e[6]),(0,t.toggle_class)(n,"large",e[7]),(0,t.toggle_class)(n,"padded",e[3])},m(i,l){(0,t.insert)(i,n,l),~a&&u[a].m(n,null),s=!0,r||(c=(0,t.listen)(n,"click",e[9]),r=!0)},p(e,[i]){let l=a;(a=g(e))===l?~a&&u[a].p(e,i):(o&&((0,t.group_outros)(),(0,t.transition_out)(u[l],1,1,()=>{u[l]=null}),(0,t.check_outros)()),~a?((o=u[a])?o.p(e,i):(o=u[a]=d[a](e)).c(),(0,t.transition_in)(o,1),o.m(n,null)):o=null),32&i&&(0,t.toggle_class)(n,"small",e[5]),64&i&&(0,t.toggle_class)(n,"medium",e[6]),128&i&&(0,t.toggle_class)(n,"large",e[7]),8&i&&(0,t.toggle_class)(n,"padded",e[3])},i(e){s||((0,t.transition_in)(o),s=!0)},o(e){(0,t.transition_out)(o),s=!1},d(e){e&&(0,t.detach)(n),~a&&u[a].d(),r=!1,c()}}}function o(e,n,i){let l,a,o,{icon:s=null}=n,{id:r=null}=n,{image:c}=n,{padded:d=!0}=n,{size:u=null}=n,{alt:g=""}=n;return e.$$set=(t=>{"icon"in t&&i(0,s=t.icon),"id"in t&&i(1,r=t.id),"image"in t&&i(2,c=t.image),"padded"in t&&i(3,d=t.padded),"size"in t&&i(8,u=t.size),"alt"in t&&i(4,g=t.alt)}),e.$$.update=(()=>{256&e.$$.dirty&&(i(5,l=i(6,a=i(7,o=!1))),"small"===u?i(5,l=!0):"large"===u?i(7,o=!0):i(6,a=!0))}),[s,r,c,d,g,l,a,o,u,function(n){(0,t.bubble)(e,n)}]}class s extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,o,a,t.safe_not_equal,{icon:0,id:1,image:2,padded:3,size:8,alt:4})}}var r=s;exports.default=r;
},{"svelte/internal":"xeIE","./Image.svelte":"q18m"}],"p6Hk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=require("../util/tokens"),n=s(require("../assets/image/ui/ico_paperJournal1-rotated.png")),a=require("../util/locale"),r=require("svelte"),i=require("../animations/transitions");function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n){const a=e.slice();return a[5]=t[n],a[7]=n,a}function o(e,t,n){const a=e.slice();return a[8]=t[n],a[7]=n,a}function c(n){let a,r,i,s,l;return{c(){a=(0,e.element)("div"),r=(0,e.element)("img"),s=(0,e.space)(),r.src!==(i=t.InvertedTokenURLs[n[8]])&&(0,e.attr)(r,"src",i),(0,e.attr)(r,"alt",""),(0,e.attr)(r,"class","token-image svelte-wamszv"),(0,e.attr)(a,"class","token svelte-wamszv")},m(t,n){(0,e.insert)(t,a,n),(0,e.append)(a,r),(0,e.append)(a,s)},p(n,a){2&a&&r.src!==(i=t.InvertedTokenURLs[n[8]])&&(0,e.attr)(r,"src",i)},i(t){l||(0,e.add_render_callback)(()=>{(l=(0,e.create_in_transition)(a,n[2],{delay:175+175*n[7]+250,duration:1e3})).start()})},o:e.noop,d(t){t&&(0,e.detach)(a)}}}function d(t){let n,a,r,i,s=t[5][t[3]]+"";return{c(){n=(0,e.element)("p"),a=(0,e.text)(s),r=(0,e.space)(),(0,e.attr)(n,"class","svelte-wamszv")},m(t,i){(0,e.insert)(t,n,i),(0,e.append)(n,a),(0,e.append)(n,r)},p(t,n){9&n&&s!==(s=t[5][t[3]]+"")&&(0,e.set_data)(a,s)},i(a){i||(0,e.add_render_callback)(()=>{(i=(0,e.create_in_transition)(n,t[2],{delay:175+175*(4+t[7])+250,duration:1e3})).start()})},o:e.noop,d(t){t&&(0,e.detach)(n)}}}function u(t){let a,r,s,u,p,m,f,_=t[1],g=[];for(let e=0;e<_.length;e+=1)g[e]=c(o(t,_,e));let v=t[0],h=[];for(let e=0;e<v.length;e+=1)h[e]=d(l(t,v,e));return{c(){a=(0,e.element)("div"),r=(0,e.element)("div");for(let e=0;e<g.length;e+=1)g[e].c();s=(0,e.space)(),u=(0,e.element)("div");for(let e=0;e<h.length;e+=1)h[e].c();(0,e.attr)(r,"class","token-container svelte-wamszv"),(0,e.attr)(u,"class","lines-container svelte-wamszv"),(0,e.attr)(a,"class","container svelte-wamszv"),(0,e.set_style)(a,"background-image","url("+n.default+")")},m(t,n){(0,e.insert)(t,a,n),(0,e.append)(a,r);for(let e=0;e<g.length;e+=1)g[e].m(r,null);(0,e.append)(a,s),(0,e.append)(a,u);for(let e=0;e<h.length;e+=1)h[e].m(u,null);f=!0},p(t,[n]){if(2&n){let a;for(_=t[1],a=0;a<_.length;a+=1){const i=o(t,_,a);g[a]?(g[a].p(i,n),(0,e.transition_in)(g[a],1)):(g[a]=c(i),g[a].c(),(0,e.transition_in)(g[a],1),g[a].m(r,null))}for(;a<g.length;a+=1)g[a].d(1);g.length=_.length}if(9&n){let a;for(v=t[0],a=0;a<v.length;a+=1){const r=l(t,v,a);h[a]?(h[a].p(r,n),(0,e.transition_in)(h[a],1)):(h[a]=d(r),h[a].c(),(0,e.transition_in)(h[a],1),h[a].m(u,null))}for(;a<h.length;a+=1)h[a].d(1);h.length=v.length}},i(t){if(!f){for(let t=0;t<_.length;t+=1)(0,e.transition_in)(g[t]);for(let t=0;t<v.length;t+=1)(0,e.transition_in)(h[t]);(0,e.add_render_callback)(()=>{m&&m.end(1),p||(p=(0,e.create_in_transition)(a,i.fadeTransition,{delay:500,duration:500})),p.start()}),f=!0}},o(t){p&&p.invalidate(),m=(0,e.create_out_transition)(a,i.fadeTransition,{duration:250}),f=!1},d(t){t&&(0,e.detach)(a),(0,e.destroy_each)(g,t),(0,e.destroy_each)(h,t),t&&m&&m.end()}}}function p(e,t,n){let s,{lines:l}=t,{tokens:o}=t,{animatePoem:c=!1}=t,d=a.language.get();return(0,r.onMount)(()=>{const e=a.language.subscribe(e=>{n(3,d=e)});return()=>{e()}}),e.$$set=(e=>{"lines"in e&&n(0,l=e.lines),"tokens"in e&&n(1,o=e.tokens),"animatePoem"in e&&n(4,c=e.animatePoem)}),e.$$.update=(()=>{16&e.$$.dirty&&n(2,s=c?i.fadeInTransition:i.emptyTransition)}),[l,o,s,d,c]}class m extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,p,u,e.safe_not_equal,{lines:0,tokens:1,animatePoem:4})}}var f=m;exports.default=f;
},{"svelte/internal":"xeIE","../util/tokens":"kL9I","../assets/image/ui/ico_paperJournal1-rotated.png":"NF7f","../util/locale":"dkeN","svelte":"XHT5","../animations/transitions":"bvJy"}],"vE4P":[function(require,module,exports) {
!function(){var e={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},t={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},i="[aeiouy]",s="[^aeiou][^aeiouy]*",n=i+"[aeiou]*",a="^("+s+")?"+n+s,l="^("+s+")?"+n+s+"("+n+")?$",o="^("+s+")?"+n+s+n+s,c="^("+s+")?"+i;function r(n){var r,u,x,p,$,g,w;if(n.length<3)return n;if("y"==(x=n.substr(0,1))&&(n=x.toUpperCase()+n.substr(1)),$=/^(.+?)([^s])s$/,(p=/^(.+?)(ss|i)es$/).test(n)?n=n.replace(p,"$1$2"):$.test(n)&&(n=n.replace($,"$1$2")),$=/^(.+?)(ed|ing)$/,(p=/^(.+?)eed$/).test(n)){var f=p.exec(n);(p=new RegExp(a)).test(f[1])&&(p=/.$/,n=n.replace(p,""))}else if($.test(n)){r=(f=$.exec(n))[1],($=new RegExp(c)).test(r)&&(n=r,$=/(at|bl|iz)$/,g=new RegExp("([^aeiouylsz])\\1$"),w=new RegExp("^"+s+i+"[^aeiouwxy]$"),$.test(n)?n+="e":g.test(n)?(p=/.$/,n=n.replace(p,"")):w.test(n)&&(n+="e"))}(p=/^(.+?)y$/).test(n)&&(r=(f=p.exec(n))[1],(p=new RegExp(c)).test(r)&&(n=r+"i"));(p=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/).test(n)&&(r=(f=p.exec(n))[1],u=f[2],(p=new RegExp(a)).test(r)&&(n=r+e[u]));(p=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/).test(n)&&(r=(f=p.exec(n))[1],u=f[2],(p=new RegExp(a)).test(r)&&(n=r+t[u]));if($=/^(.+?)(s|t)(ion)$/,(p=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/).test(n))r=(f=p.exec(n))[1],(p=new RegExp(o)).test(r)&&(n=r);else if($.test(n)){r=(f=$.exec(n))[1]+f[2],($=new RegExp(o)).test(r)&&(n=r)}(p=/^(.+?)e$/).test(n)&&(r=(f=p.exec(n))[1],p=new RegExp(o),$=new RegExp(l),g=new RegExp("^"+s+i+"[^aeiouwxy]$"),(p.test(r)||$.test(r)&&!g.test(r))&&(n=r));return p=/ll$/,$=new RegExp(o),p.test(n)&&$.test(n)&&(p=/.$/,n=n.replace(p,"")),"y"==x&&(n=x.toLowerCase()+n.substr(1)),n}var u={};"undefined"!=typeof exports&&null!=exports&&(exports.stemmer=r,exports.memoizingStemmer=function(e){return u[e]||(u[e]=r(e)),u[e]})}();
},{}],"iilj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=i;var e=s(require("../util/Random")),t=s(require("../assets/json/haiku-phrases-en.json")),n=s(require("../assets/json/haiku-phrases-fr.json")),r=require("porter-stemmer");function s(e){return e&&e.__esModule?e:{default:e}}const a=e=>e.replace(/\'[a-z]+/g,"").replace(/\-/g," ").split(/\s+/g).filter(Boolean),o="of,the,on,for,and,in,a,from,at".split(",").map(e=>(0,r.stemmer)(e));function i(){const s=t.default,i=(0,e.default)(),l=Object.keys(s);return{generate({tokens:e,ignore:t=[]}={}){e=e||this.randomTokens();let n=[];return e.forEach((e,r)=>{const s=this.generateStanza({token:e,stanza:r,state:n,ignore:t});n.push(s)}),n},randomTokens:()=>i.shuffle(l).slice(0,3),generateStanza:({stanza:e,token:t,state:n=[],ignore:r=[]})=>({en:u({lang:"en",stanza:e,token:t,state:n.map(e=>e.en),ignore:r.map(e=>e.en)}),fr:u({lang:"fr",stanza:e,token:t})})};function u({lang:e="en",stanza:s,token:l,state:u=[],ignore:c=[]}){if(null==s||s<0&&s>2)throw new Error("Must specify stanza index 0, 1 or 2 ");if(!l)throw new Error("Must specify token");const p="en"===e?t.default:n.default;if(!(l in p))throw new Error(`No haiku data for token ${l}`);const d=p[l][s].map(e=>e.trim()),g=a(u.join(" ")).map(e=>(0,r.stemmer)(e)),h=g.filter(e=>!o.includes(e));let m=d.slice();g.length&&(m=f(m,e=>!h.some(t=>e.includes(t)),2));const k=c.flat();m.slice();return m=(m=f(m,e=>!k.includes(e),2)).length>=2?m:d,i.pick(m)}function f(e,t,n=1){const r=e.filter(t);return r.length>n?r:e}}
},{"../util/Random":"LMfK","../assets/json/haiku-phrases-en.json":"LLrD","../assets/json/haiku-phrases-fr.json":"JeCt","porter-stemmer":"vE4P"}],"RyaA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=require("svelte"),n=require("../animations/transitions"),a=r(require("../components/Image.svelte"));function r(e){return e&&e.__esModule?e:{default:e}}function i(t){let r,i,o,s,l,d,u;return i=new a.default({props:{width:"100%",id:"image/ui/close-button"}}),{c(){r=(0,e.element)("div"),(0,e.create_component)(i.$$.fragment),(0,e.attr)(r,"class","close-button svelte-d162at")},m(n,a){(0,e.insert)(n,r,a),(0,e.mount_component)(i,r,null),l=!0,d||(u=(0,e.listen)(r,"click",t[1]),d=!0)},p(e,[n]){t=e},i(a){l||((0,e.transition_in)(i.$$.fragment,a),(0,e.add_render_callback)(()=>{s&&s.end(1),o||(o=(0,e.create_in_transition)(r,n.fadeInTransition,{delay:t[0],duration:100})),o.start()}),l=!0)},o(a){(0,e.transition_out)(i.$$.fragment,a),o&&o.invalidate(),s=(0,e.create_out_transition)(r,n.fadeInTransition,{delay:t[0],duration:100}),l=!1},d(t){t&&(0,e.detach)(r),(0,e.destroy_component)(i),t&&s&&s.end(),d=!1,u()}}}function o(t,n,a){let{delay:r=0}=n;return t.$$set=(e=>{"delay"in e&&a(0,r=e.delay)}),[r,function(n){(0,e.bubble)(t,n)}]}class s extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,o,i,e.safe_not_equal,{delay:0})}}var l=s;exports.default=l;
},{"svelte/internal":"xeIE","svelte":"XHT5","../animations/transitions":"bvJy","../components/Image.svelte":"q18m"}],"vNhw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=v(require("../util/math")),n=m(require("../util/tiny-input")),o=require("../util/tokens"),r=require("svelte/transition"),i=require("svelte"),l=require("../util/locale.js"),s=m(require("../components/IconButton.svelte")),a=m(require("../assets/image/ui/ico_scrollbar.png")),c=m(require("../assets/image/ui/ico_toggle.png")),u=m(require("../assets/image/ui/ico_openjournal.png")),p=m(require("../components/HaikuCard.svelte")),d=m(require("../util/haikugen")),f=m(require("../components/CloseButton.svelte")),g=m(require("../components/PoemTagButton.svelte"));function m(e){return e&&e.__esModule?e:{default:e}}function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}function v(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var l=r?Object.getOwnPropertyDescriptor(e,i):null;l&&(l.get||l.set)?Object.defineProperty(o,i,l):o[i]=e[i]}return o.default=e,n&&n.set(e,o),o}function h(e,t,n){const o=e.slice();return o[15]=t[n],o[17]=n,o}function w(t){let n,o;return n=new p.default({props:{tokens:t[15].tokens,lines:t[15].lines}}),{c(){(0,e.create_component)(n.$$.fragment)},m(t,r){(0,e.mount_component)(n,t,r),o=!0},p(e,t){const o={};2&t&&(o.tokens=e[15].tokens),2&t&&(o.lines=e[15].lines),n.$set(o)},i(t){o||((0,e.transition_in)(n.$$.fragment,t),o=!0)},o(t){(0,e.transition_out)(n.$$.fragment,t),o=!1},d(t){(0,e.destroy_component)(n,t)}}}function b(t){let n,o,i,l,s,u,p,d,m,_,v,b,$,y,k,q,P,j;i=new g.default({props:{button:!1}});let z=t[1],O=[];for(let e=0;e<z.length;e+=1)O[e]=w(h(t,z,e));const H=t=>(0,e.transition_out)(O[t],1,1,()=>{O[t]=null});return(p=new f.default({})).$on("click",t[8]),{c(){n=(0,e.element)("div"),o=(0,e.element)("div"),(0,e.create_component)(i.$$.fragment),l=(0,e.space)(),s=(0,e.element)("div");for(let e=0;e<O.length;e+=1)O[e].c();u=(0,e.space)(),(0,e.create_component)(p.$$.fragment),d=(0,e.space)(),m=(0,e.element)("div"),_=(0,e.element)("div"),v=(0,e.element)("div"),b=(0,e.element)("img"),(0,e.attr)(s,"class","poem-collection-container svelte-1iw8zw5"),(0,e.attr)(o,"class","scroller svelte-1iw8zw5"),b.src!==($=c.default)&&(0,e.attr)(b,"src",$),(0,e.attr)(b,"alt",""),(0,e.attr)(b,"draggable",y=!1),(0,e.attr)(b,"class","svelte-1iw8zw5"),(0,e.attr)(v,"class","scrollbar-trackbar-thumb svelte-1iw8zw5"),(0,e.set_style)(v,"top",t[4]),(0,e.attr)(_,"class","scrollbar-trackbar svelte-1iw8zw5"),(0,e.set_style)(_,"background-image","url("+a.default+")"),(0,e.attr)(m,"class","scrollbar-container svelte-1iw8zw5"),(0,e.toggle_class)(m,"hideScrollbar",t[2]),(0,e.attr)(n,"class","container svelte-1iw8zw5"),(0,e.toggle_class)(n,"modal",t[0]),(0,e.toggle_class)(n,"ignorePointer",t[3])},m(r,a){(0,e.insert)(r,n,a),(0,e.append)(n,o),(0,e.mount_component)(i,o,null),(0,e.append)(o,l),(0,e.append)(o,s);for(let e=0;e<O.length;e+=1)O[e].m(s,null);t[9](o),(0,e.append)(n,u),(0,e.mount_component)(p,n,null),(0,e.append)(n,d),(0,e.append)(n,m),(0,e.append)(m,_),(0,e.append)(_,v),(0,e.append)(v,b),t[10](_),q=!0,P||(j=(0,e.listen)(o,"scroll",t[7]),P=!0)},p(t,[o]){if(2&o){let n;for(z=t[1],n=0;n<z.length;n+=1){const r=h(t,z,n);O[n]?(O[n].p(r,o),(0,e.transition_in)(O[n],1)):(O[n]=w(r),O[n].c(),(0,e.transition_in)(O[n],1),O[n].m(s,null))}for((0,e.group_outros)(),n=z.length;n<O.length;n+=1)H(n);(0,e.check_outros)()}(!q||16&o)&&(0,e.set_style)(v,"top",t[4]),4&o&&(0,e.toggle_class)(m,"hideScrollbar",t[2]),1&o&&(0,e.toggle_class)(n,"modal",t[0]),8&o&&(0,e.toggle_class)(n,"ignorePointer",t[3])},i(t){if(!q){(0,e.transition_in)(i.$$.fragment,t);for(let t=0;t<z.length;t+=1)(0,e.transition_in)(O[t]);(0,e.transition_in)(p.$$.fragment,t),(0,e.add_render_callback)(()=>{k||(k=(0,e.create_bidirectional_transition)(n,r.fade,{duration:500},!0)),k.run(1)}),q=!0}},o(t){(0,e.transition_out)(i.$$.fragment,t),O=O.filter(Boolean);for(let n=0;n<O.length;n+=1)(0,e.transition_out)(O[n]);(0,e.transition_out)(p.$$.fragment,t),k||(k=(0,e.create_bidirectional_transition)(n,r.fade,{duration:500},!1)),k.run(0),q=!1},d(o){o&&(0,e.detach)(n),(0,e.destroy_component)(i),(0,e.destroy_each)(O,o),t[9](null),(0,e.destroy_component)(p),t[10](null),o&&k&&k.end(),P=!1,j()}}}let $=!1;function y(o,r,l){let{modal:s=!1}=r,{poems:a=[]}=r;const c=(0,i.createEventDispatcher)();let u,p,d=!1,f=!1,g="0%";function m(){_()}function _(){if(!u)return;const e=u.scrollTop/(u.scrollHeight-u.clientHeight);l(4,g=`${(100*e).toFixed(5)}%`),l(2,d=!(u.scrollHeight>u.clientHeight))}return(0,i.onMount)(()=>{l(3,f=!1),_(),window.addEventListener("resize",m,{passive:!0});const e=function(e){const o=(0,n.default)({target:e,parent:window});return o.on("down",r).on("up",r).on("move",r),()=>{o.disable()};function r(e){e.dragging&&u&&function(e){const n=(e=t.clamp01(e))*(u.scrollHeight-u.clientHeight);l(5,u.scrollTop=n,u)}(e.uv[1])}}(p);return()=>{e(),window.removeEventListener("resize",m)}}),o.$$set=(e=>{"modal"in e&&l(0,s=e.modal),"poems"in e&&l(1,a=e.poems)}),o.$$.update=(()=>{2&o.$$.dirty&&l(3,f=!1)}),[s,a,d,f,g,u,p,_,function(){l(3,f=!0),c("close"),console.log("Poems Collection closed")},function(t){e.binding_callbacks[t?"unshift":"push"](()=>{l(5,u=t)})},function(t){e.binding_callbacks[t?"unshift":"push"](()=>{l(6,p=t)})}]}class k extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,y,b,e.safe_not_equal,{modal:0,poems:1})}}var q=k;exports.default=q;
},{"svelte/internal":"xeIE","../util/math":"Ov1X","../util/tiny-input":"xJnI","../util/tokens":"kL9I","svelte/transition":"ly0Q","svelte":"XHT5","../util/locale.js":"dkeN","../components/IconButton.svelte":"b4oK","../assets/image/ui/ico_scrollbar.png":"cXg9","../assets/image/ui/ico_toggle.png":"rdDl","../assets/image/ui/ico_openjournal.png":"G6OY","../components/HaikuCard.svelte":"p6Hk","../util/haikugen":"iilj","../components/CloseButton.svelte":"RyaA","../components/PoemTagButton.svelte":"p7jd"}],"FIbM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("svelte/internal"),e=g(require("../assets/image/ui/ico_resume.png")),n=g(require("../components/ImageButton.svelte")),a=g(require("../components/Image.svelte")),o=require("../nfb"),i=require("svelte/store"),r=require("../animations/transitions"),s=require("svelte"),l=require("svelte/transition"),c=g(require("../util/Assets")),d=require("../util/stores"),u=require("../util/locale.js"),p=require("../util/globalIntroVideo"),m=require("../alec-svelte"),_=g(require("../components/PoemTagButton.svelte")),f=g(require("./PoemCollectionOverlay.svelte"));function g(t){return t&&t.__esModule?t:{default:t}}function v(e){let n,a,o,i,s,l,c,d=e[9].introBlurbOne+"",u=e[9].introBlurbTwo+"";return{c(){n=(0,t.element)("p"),a=(0,t.text)(d),i=(0,t.space)(),s=(0,t.element)("p"),l=(0,t.text)(u),(0,t.attr)(n,"class","svelte-h4m3ya"),(0,t.attr)(s,"class","svelte-h4m3ya")},m(e,o){(0,t.insert)(e,n,o),(0,t.append)(n,a),(0,t.insert)(e,i,o),(0,t.insert)(e,s,o),(0,t.append)(s,l)},p(n,o){e=n,512&o&&d!==(d=e[9].introBlurbOne+"")&&(0,t.set_data)(a,d),512&o&&u!==(u=e[9].introBlurbTwo+"")&&(0,t.set_data)(l,u)},i(a){o||(0,t.add_render_callback)(()=>{(o=(0,t.create_in_transition)(n,r.fadeInTransition,{delay:e[11]+e[10],index:1})).start()}),c||(0,t.add_render_callback)(()=>{(c=(0,t.create_in_transition)(s,r.fadeInTransition,{delay:e[11]+e[10],index:2})).start()})},o:t.noop,d(e){e&&(0,t.detach)(n),e&&(0,t.detach)(i),e&&(0,t.detach)(s)}}}function $(e){let n,a,o,i=e[4]&&y(e),r=e[5]&&h(e);return{c(){i&&i.c(),n=(0,t.space)(),r&&r.c(),a=(0,t.empty)()},m(e,s){i&&i.m(e,s),(0,t.insert)(e,n,s),r&&r.m(e,s),(0,t.insert)(e,a,s),o=!0},p(e,o){e[4]?i?(i.p(e,o),16&o&&(0,t.transition_in)(i,1)):((i=y(e)).c(),(0,t.transition_in)(i,1),i.m(n.parentNode,n)):i&&((0,t.group_outros)(),(0,t.transition_out)(i,1,1,()=>{i=null}),(0,t.check_outros)()),e[5]?r?(r.p(e,o),32&o&&(0,t.transition_in)(r,1)):((r=h(e)).c(),(0,t.transition_in)(r,1),r.m(a.parentNode,a)):r&&(r.d(1),r=null)},i(e){o||((0,t.transition_in)(i),(0,t.transition_in)(r),o=!0)},o(e){(0,t.transition_out)(i),o=!1},d(e){i&&i.d(e),e&&(0,t.detach)(n),r&&r.d(e),e&&(0,t.detach)(a)}}}function y(e){let n,a,o,i,s,l,c,d,u,p,m,_,f=e[9].endState0+"",g=e[9].endState1+"";return{c(){n=(0,t.element)("div"),a=(0,t.element)("p"),o=(0,t.element)("strong"),i=(0,t.text)(f),s=(0,t.space)(),l=(0,t.element)("p"),c=(0,t.text)(g),(0,t.attr)(a,"class","svelte-h4m3ya"),(0,t.attr)(l,"class","svelte-h4m3ya"),(0,t.attr)(n,"class","paper-text")},m(r,d){(0,t.insert)(r,n,d),(0,t.append)(n,a),(0,t.append)(a,o),(0,t.append)(o,i),(0,t.append)(n,s),(0,t.append)(n,l),(0,t.append)(l,c),p=!0,m||(_=[(0,t.listen)(n,"introend",e[15]),(0,t.listen)(n,"outroend",e[16])],m=!0)},p(n,a){e=n,(!p||512&a)&&f!==(f=e[9].endState0+"")&&(0,t.set_data)(i,f),(!p||512&a)&&g!==(g=e[9].endState1+"")&&(0,t.set_data)(c,g)},i(a){p||((0,t.add_render_callback)(()=>{u&&u.end(1),d||(d=(0,t.create_in_transition)(n,r.fadeInTransition,{delay:e[10],duration:500,index:1})),d.start()}),p=!0)},o(a){d&&d.invalidate(),u=(0,t.create_out_transition)(n,r.fadeInTransition,{delay:e[10]+5e3,duration:250}),p=!1},d(e){e&&(0,t.detach)(n),e&&u&&u.end(),m=!1,(0,t.run_all)(_)}}}function h(e){let n,a,o,i=e[9].endState2+"";return{c(){n=(0,t.element)("div"),a=(0,t.element)("p"),(0,t.attr)(a,"class","svelte-h4m3ya"),(0,t.attr)(n,"class","paper-text")},m(e,o){(0,t.insert)(e,n,o),(0,t.append)(n,a),a.innerHTML=i},p(t,n){e=t,512&n&&i!==(i=e[9].endState2+"")&&(a.innerHTML=i)},i(a){o||(0,t.add_render_callback)(()=>{(o=(0,t.create_in_transition)(n,r.fadeInTransition,{delay:e[10],duration:500,index:1})).start()})},o:t.noop,d(e){e&&(0,t.detach)(n)}}}function x(a){let o,i;return(o=new n.default({props:{inTransition:(0,r.transition)(r.fadeInTransition,{delay:a[11]+a[10],index:3}),icon:e.default,text:a[9].resumeButton,alt:"Resume experience"}})).$on("click",a[19]),{c(){(0,t.create_component)(o.$$.fragment)},m(e,n){(0,t.mount_component)(o,e,n),i=!0},p(t,e){const n={};512&e&&(n.text=t[9].resumeButton),o.$set(n)},i(e){i||((0,t.transition_in)(o.$$.fragment,e),i=!0)},o(e){(0,t.transition_out)(o.$$.fragment,e),i=!1},d(e){(0,t.destroy_component)(o,e)}}}function b(a){let o,i;return(o=new n.default({props:{inTransition:(0,r.transition)(r.fadeInTransition,{delay:a[11]+a[10],index:3}),icon:e.default,text:a[9].startButton,alt:"Start experience"}})).$on("click",a[18]),{c(){(0,t.create_component)(o.$$.fragment)},m(e,n){(0,t.mount_component)(o,e,n),i=!0},p(t,e){const n={};512&e&&(n.text=t[9].startButton),o.$set(n)},i(e){i||((0,t.transition_in)(o.$$.fragment,e),i=!0)},o(e){(0,t.transition_out)(o.$$.fragment,e),i=!1},d(e){(0,t.destroy_component)(o,e)}}}function T(e){let n,a;return(n=new _.default({props:{useMargin:!1,button:!0,inTransition:(0,r.transition)(r.fadeInTransition,{delay:e[11]+e[10],index:3}),alt:"Poems"}})).$on("click",e[17]),{c(){(0,t.create_component)(n.$$.fragment)},m(e,o){(0,t.mount_component)(n,e,o),a=!0},p:t.noop,i(e){a||((0,t.transition_in)(n.$$.fragment,e),a=!0)},o(e){(0,t.transition_out)(n.$$.fragment,e),a=!1},d(e){(0,t.destroy_component)(n,e)}}}function q(e){let n,a;return(n=new f.default({props:{poems:e[2],modal:!0}})).$on("close",e[23]),{c(){(0,t.create_component)(n.$$.fragment)},m(e,o){(0,t.mount_component)(n,e,o),a=!0},p(t,e){const a={};4&e&&(a.poems=t[2]),n.$set(a)},i(e){a||((0,t.transition_in)(n.$$.fragment,e),a=!0)},o(e){(0,t.transition_out)(n.$$.fragment,e),a=!1},d(e){(0,t.destroy_component)(n,e)}}}function k(e){let o,i,s,l,c,d,u,p,m,_,f,g,y,h,k,I,S,B,P,w,M,F,O,E,j,H,L;u=new a.default({props:{id:`image/ui/title2_${e[8]}`}});const A=[$,v],D=[];function N(t,e){return t[1]?0:1}f=N(e),g=D[f]=A[f](e);const C=[T,b,x],V=[];function z(t,e){return t[1]?0:t[0]?1:2}I=z(e),S=V[I]=C[I](e),(w=new n.default({props:{inTransition:(0,r.transition)(r.fadeInTransition,{delay:e[11]+e[10],index:4}),text:e[9].aboutButton,mode:"dark",alt:"About"}})).$on("click",e[20]);let R=e[6]&&q(e);return{c(){o=(0,t.element)("div"),(i=(0,t.element)("section")).innerHTML='<div class="top-buttons svelte-h4m3ya"><div class="top-left-container svelte-h4m3ya"></div> \n      <div class="top-center-container"></div> \n      <div class="top-right-container svelte-h4m3ya"></div></div>',s=(0,t.space)(),l=(0,t.element)("section"),c=(0,t.element)("div"),d=(0,t.element)("div"),(0,t.create_component)(u.$$.fragment),m=(0,t.space)(),_=(0,t.element)("div"),g.c(),y=(0,t.space)(),h=(0,t.element)("div"),k=(0,t.element)("div"),S.c(),B=(0,t.space)(),P=(0,t.element)("div"),(0,t.create_component)(w.$$.fragment),O=(0,t.space)(),R&&R.c(),E=(0,t.empty)(),(0,t.attr)(i,"class","top fake-nav svelte-h4m3ya"),(0,t.attr)(d,"class","wayfinder-placeholder svelte-h4m3ya"),(0,t.toggle_class)(d,"ignorePointer",e[7]),(0,t.attr)(_,"class","description-container svelte-h4m3ya"),(0,t.toggle_class)(_,"endState",e[1]),(0,t.attr)(k,"class","game-buttons svelte-h4m3ya"),(0,t.attr)(P,"class","about-container svelte-h4m3ya"),(0,t.attr)(h,"class","button-container svelte-h4m3ya"),(0,t.attr)(c,"class","wayfinder-container svelte-h4m3ya"),(0,t.attr)(l,"class","main-content svelte-h4m3ya"),(0,t.attr)(o,"class","container svelte-h4m3ya"),(0,t.toggle_class)(o,"ignorePointer",e[7])},m(n,a){(0,t.insert)(n,o,a),(0,t.append)(o,i),(0,t.append)(o,s),(0,t.append)(o,l),(0,t.append)(l,c),(0,t.append)(c,d),(0,t.mount_component)(u,d,null),(0,t.append)(c,m),(0,t.append)(c,_),D[f].m(_,null),(0,t.append)(c,y),(0,t.append)(c,h),(0,t.append)(h,k),V[I].m(k,null),(0,t.append)(h,B),(0,t.append)(h,P),(0,t.mount_component)(w,P,null),(0,t.insert)(n,O,a),R&&R.m(n,a),(0,t.insert)(n,E,a),j=!0,H||(L=[(0,t.listen)(o,"introstart",e[21]),(0,t.listen)(o,"outrostart",e[22])],H=!0)},p(n,[a]){e=n;const i={};256&a&&(i.id=`image/ui/title2_${e[8]}`),u.$set(i),128&a&&(0,t.toggle_class)(d,"ignorePointer",e[7]);let r=f;(f=N(e))===r?D[f].p(e,a):((0,t.group_outros)(),(0,t.transition_out)(D[r],1,1,()=>{D[r]=null}),(0,t.check_outros)(),(g=D[f])?g.p(e,a):(g=D[f]=A[f](e)).c(),(0,t.transition_in)(g,1),g.m(_,null)),2&a&&(0,t.toggle_class)(_,"endState",e[1]);let s=I;(I=z(e))===s?V[I].p(e,a):((0,t.group_outros)(),(0,t.transition_out)(V[s],1,1,()=>{V[s]=null}),(0,t.check_outros)(),(S=V[I])?S.p(e,a):(S=V[I]=C[I](e)).c(),(0,t.transition_in)(S,1),S.m(k,null));const l={};512&a&&(l.text=e[9].aboutButton),w.$set(l),128&a&&(0,t.toggle_class)(o,"ignorePointer",e[7]),e[6]?R?(R.p(e,a),64&a&&(0,t.transition_in)(R,1)):((R=q(e)).c(),(0,t.transition_in)(R,1),R.m(E.parentNode,E)):R&&((0,t.group_outros)(),(0,t.transition_out)(R,1,1,()=>{R=null}),(0,t.check_outros)())},i(n){j||((0,t.transition_in)(u.$$.fragment,n),p||(0,t.add_render_callback)(()=>{(p=(0,t.create_in_transition)(d,r.fadeInTransition,{duration:e[3]?2500:void 0,delay:e[11]})).start()}),(0,t.transition_in)(g),(0,t.transition_in)(S),(0,t.transition_in)(w.$$.fragment,n),(0,t.add_render_callback)(()=>{F&&F.end(1),M||(M=(0,t.create_in_transition)(o,r.fadeOpacityTransition,{})),M.start()}),(0,t.transition_in)(R),j=!0)},o(n){(0,t.transition_out)(u.$$.fragment,n),(0,t.transition_out)(g),(0,t.transition_out)(S),(0,t.transition_out)(w.$$.fragment,n),M&&M.invalidate(),F=(0,t.create_out_transition)(o,r.fadeOpacityTransition,{duration:e[0]?1e3:void 0,delay:0}),(0,t.transition_out)(R),j=!1},d(e){e&&(0,t.detach)(o),(0,t.destroy_component)(u),D[f].d(),V[I].d(),(0,t.destroy_component)(w),e&&F&&F.end(),e&&(0,t.detach)(O),R&&R.d(e),e&&(0,t.detach)(E),H=!1,(0,t.run_all)(L)}}}function I(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():"function"==typeof document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen(),console.log("Fullscreen requested")}function S(){console.log("restart requested")}function B(e,n,a){let r;(0,t.component_subscribe)(e,u.localize,t=>a(9,r=t));const l=(0,s.createEventDispatcher)();let c,{start:m=!0}=n,{endState:_=!1}=n,{poems:f=[]}=n,{introTitle:g=!1}=n,v=!0,$=!1,y=!1,h=!1;const x=u.language.subscribe(t=>{a(8,c=t)});(0,s.onMount)(()=>((0,o.revealHeader)(),a(7,h=!1),()=>{x()}));let b=g?1e3:0,T=_?2500:0;document.documentElement.requestFullscreen;function q(t){t&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()),l("play")}function k(t){t&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()),l("play");const e=(0,p.getVideo)(),n=(0,i.get)(d.audioState).muted;e.muted=n,e.play()}function I(){l("about")}return e.$$set=(t=>{"start"in t&&a(0,m=t.start),"endState"in t&&a(1,_=t.endState),"poems"in t&&a(2,f=t.poems),"introTitle"in t&&a(3,g=t.introTitle)}),e.$$.update=(()=>{1&e.$$.dirty&&a(7,h=!1)}),[m,_,f,g,v,$,y,h,c,r,b,T,q,k,I,()=>{a(4,v=!1)},()=>{a(5,$=!0)},t=>{(0,o.sendAnalytics)({event:"journal_open",eventLabel:"journal_open"}),a(6,y=!0)},t=>k(t),t=>q(t),()=>I(),()=>{a(7,h=!1)},()=>{a(7,h=!0)},()=>{a(6,y=!1)}]}class P extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,B,k,t.safe_not_equal,{start:0,endState:1,poems:2,introTitle:3})}}var w=P;exports.default=w;
},{"svelte/internal":"xeIE","../assets/image/ui/ico_resume.png":"Mxzs","../components/ImageButton.svelte":"HO9o","../components/Image.svelte":"q18m","../nfb":"Xlf9","svelte/store":"nBdo","../animations/transitions":"bvJy","svelte":"XHT5","svelte/transition":"ly0Q","../util/Assets":"Wm90","../util/stores":"G6DW","../util/locale.js":"dkeN","../util/globalIntroVideo":"M4mV","../alec-svelte":"M3eo","../components/PoemTagButton.svelte":"p7jd","./PoemCollectionOverlay.svelte":"vNhw"}],"LoO6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=require("svelte"),n=require("../alec-svelte"),a=require("../util/locale"),o=require("../animations/transitions"),r=d(require("../tags")),l=i(require("../components/Image.svelte")),p=i(require("../components/CloseButton.svelte"));function i(e){return e&&e.__esModule?e:{default:e}}function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(s=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=s(t);if(n&&n.has(e))return n.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var l=o?Object.getOwnPropertyDescriptor(e,r):null;l&&(l.get||l.set)?Object.defineProperty(a,r,l):a[r]=e[r]}return a.default=e,n&&n.set(e,a),a}function c(e,t,n){const a=e.slice();return a[8]=t[n],a}function u(e,t,n){const a=e.slice();return a[11]=t[n],a[13]=n,a}function m(t){let n,a=t[8],o=[];for(let e=0;e<a.length;e+=1)o[e]=g(u(t,a,e));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();n=(0,e.empty)()},m(t,a){for(let e=0;e<o.length;e+=1)o[e].m(t,a);(0,e.insert)(t,n,a)},p(e,t){if(8&t){let r;for(a=e[8],r=0;r<a.length;r+=1){const l=u(e,a,r);o[r]?o[r].p(l,t):(o[r]=g(l),o[r].c(),o[r].m(n.parentNode,n))}for(;r<o.length;r+=1)o[r].d(1);o.length=a.length}},i:e.noop,o:e.noop,d(t){(0,e.destroy_each)(o,t),t&&(0,e.detach)(n)}}}function f(t){let n,a=t[8].html+"";return{c(){n=(0,e.element)("p"),(0,e.attr)(n,"class","svelte-48fouy"),(0,e.toggle_class)(n,"isTitle",!0)},m(t,o){(0,e.insert)(t,n,o),n.innerHTML=a},p:e.noop,i:e.noop,o:e.noop,d(t){t&&(0,e.detach)(n)}}}function _(t){let n,a,o;return a=new l.default({props:{width:"100%",id:"image/ui/ico_about"}}),{c(){n=(0,e.element)("div"),(0,e.create_component)(a.$$.fragment),(0,e.attr)(n,"class","leaf credit-leaf svelte-48fouy")},m(t,r){(0,e.insert)(t,n,r),(0,e.mount_component)(a,n,null),o=!0},p:e.noop,i(t){o||((0,e.transition_in)(a.$$.fragment,t),o=!0)},o(t){(0,e.transition_out)(a.$$.fragment,t),o=!1},d(t){t&&(0,e.detach)(n),(0,e.destroy_component)(a)}}}function g(t){let n,a,o=t[11]+"";return{c(){n=(0,e.element)("p"),a=(0,e.text)(o),(0,e.attr)(n,"class","svelte-48fouy"),(0,e.toggle_class)(n,"isTitle",0===t[13])},m(t,o){(0,e.insert)(t,n,o),(0,e.append)(n,a)},p:e.noop,d(t){t&&(0,e.detach)(n)}}}function v(t){let n,a,o,r,l;const p=[_,f,m],i=[];return a=function(e,t){return"LEAF"===e[8]?0:e[8].html?1:2}(t),o=i[a]=p[a](t),{c(){n=(0,e.element)("div"),o.c(),r=(0,e.space)(),(0,e.attr)(n,"class","credit-block svelte-48fouy")},m(t,o){(0,e.insert)(t,n,o),i[a].m(n,null),(0,e.append)(n,r),l=!0},p(e,t){o.p(e,t)},i(t){l||((0,e.transition_in)(o),l=!0)},o(t){(0,e.transition_out)(o),l=!1},d(t){t&&(0,e.detach)(n),i[a].d()}}}function y(t){let n,a,r,i,s,d,u,m,f,_,g,y,$,x,b,w,T,k,R,P,S,A,L,O,M,C,H,j,q,B,F,I,D,J,N,W,E,G,z,K,Q,V,U,X,Y,Z,ee,te,ne,ae,oe,re,le,pe,ie,se,de,ce,ue,me,fe,_e,ge,ve,ye,he,$e,xe,be,we,Te,ke,Re,Pe,Se,Ae,Le,Oe,Me,Ce,He,je,qe,Be,Fe,Ie,De,Je,Ne,We,Ee,Ge,ze,Ke,Qe,Ve,Ue,Xe,Ye,Ze,et=t[0].nfbProduction+"",tt=t[0].nfbSubcaption+"",nt=t[0].playHeader+"",at=t[0].tapOrClickAndHold+"",ot=t[0].moveCharacterText+"",rt=t[0].collectText+"",lt=t[0].tokenStringText+"",pt=t[0].orientText+"",it=t[0].compassStringText+"",st=t[0].returnText+"",dt=t[0].memoriesStringText+"",ct=t[0].aboutHeader+"",ut=t[0].wayfinderStrongText+"",mt=t[0].wayfinderTextParagraph+"",ft=t[0].wayfinderFurtherTextParagraph+"",_t=t[0].moreAt+"",gt=t[0].moreAtLinkText+"",vt=t[0].creditsHeader+"";s=new l.default({props:{width:"100px",id:"image/svg/nfblogo"}}),k=new l.default({props:{width:"100%",id:"image/ui/ico_about_orange"}}),O=new l.default({props:{width:"42px",id:"image/ui/touch"}}),J=new l.default({props:{width:"42px",id:"image/tokens/ico_fish"}}),X=new l.default({props:{width:"46px",id:"image/ui/compass3"}}),pe=new l.default({props:{width:"38px",id:"image/ui/tree"}}),ve=new l.default({props:{width:"100%",id:"image/ui/ico_about_orange"}}),Ie=new l.default({props:{width:"100%",id:"image/ui/ico_about_orange"}});let yt=t[3],ht=[];for(let e=0;e<yt.length;e+=1)ht[e]=v(c(t,yt,e));const $t=t=>(0,e.transition_out)(ht[t],1,1,()=>{ht[t]=null});return ze=new l.default({props:{width:"100%",id:"image/ui/bird"}}),(Ue=new p.default({props:{delay:h}})).$on("click",t[6]),{c(){n=(0,e.element)("div"),a=(0,e.element)("div"),r=(0,e.element)("div"),i=(0,e.element)("a"),(0,e.create_component)(s.$$.fragment),u=(0,e.space)(),m=(0,e.element)("div"),f=(0,e.element)("p"),_=(0,e.text)(et),g=(0,e.space)(),y=(0,e.element)("p"),$=(0,e.text)(tt),x=(0,e.space)(),b=(0,e.element)("main"),w=(0,e.element)("h1"),T=(0,e.element)("div"),(0,e.create_component)(k.$$.fragment),R=(0,e.space)(),P=(0,e.text)(nt),S=(0,e.space)(),A=(0,e.element)("div"),L=(0,e.element)("div"),(0,e.create_component)(O.$$.fragment),M=(0,e.space)(),C=(0,e.element)("p"),H=(0,e.element)("strong"),j=(0,e.text)(at),q=(0,e.space)(),B=(0,e.text)(ot),F=(0,e.space)(),I=(0,e.element)("div"),D=(0,e.element)("div"),(0,e.create_component)(J.$$.fragment),N=(0,e.space)(),W=(0,e.element)("p"),E=(0,e.element)("strong"),G=(0,e.text)(rt),z=(0,e.space)(),K=(0,e.text)(lt),Q=(0,e.space)(),V=(0,e.element)("div"),U=(0,e.element)("div"),(0,e.create_component)(X.$$.fragment),Y=(0,e.space)(),Z=(0,e.element)("p"),ee=(0,e.element)("strong"),te=(0,e.text)(pt),ne=(0,e.space)(),ae=(0,e.text)(it),oe=(0,e.space)(),re=(0,e.element)("div"),le=(0,e.element)("div"),(0,e.create_component)(pe.$$.fragment),ie=(0,e.space)(),se=(0,e.element)("p"),de=(0,e.element)("strong"),ce=(0,e.text)(st),ue=(0,e.space)(),me=(0,e.text)(dt),fe=(0,e.space)(),_e=(0,e.element)("h1"),ge=(0,e.element)("div"),(0,e.create_component)(ve.$$.fragment),ye=(0,e.space)(),he=(0,e.text)(ct),$e=(0,e.space)(),xe=(0,e.element)("p"),be=(0,e.element)("strong"),we=(0,e.text)(ut),Te=(0,e.space)(),ke=(0,e.text)(mt),Re=(0,e.space)(),Pe=(0,e.element)("p"),Se=(0,e.text)(ft),Ae=(0,e.space)(),Le=(0,e.element)("p"),Oe=(0,e.text)(_t),Me=(0,e.space)(),Ce=(0,e.element)("a"),He=(0,e.text)(gt),qe=(0,e.space)(),Be=(0,e.element)("h1"),Fe=(0,e.element)("div"),(0,e.create_component)(Ie.$$.fragment),De=(0,e.space)(),Je=(0,e.text)(vt),Ne=(0,e.space)(),We=(0,e.element)("div");for(let e=0;e<ht.length;e+=1)ht[e].c();Ee=(0,e.space)(),Ge=(0,e.element)("div"),(0,e.create_component)(ze.$$.fragment),Ve=(0,e.space)(),(0,e.create_component)(Ue.$$.fragment),(0,e.attr)(i,"href",d=t[0].nfbInteractiveLink),(0,e.attr)(i,"target","_blank"),(0,e.attr)(i,"alt","NFB-ONF"),(0,e.attr)(r,"class","nfb-logo"),(0,e.attr)(f,"class","nfb-production svelte-48fouy"),(0,e.attr)(y,"class","nfb-subcaption svelte-48fouy"),(0,e.attr)(m,"class","nfb-caption svelte-48fouy"),(0,e.attr)(T,"class","leaf svelte-48fouy"),(0,e.attr)(w,"class","svelte-48fouy"),(0,e.attr)(L,"class","about-icon svelte-48fouy"),(0,e.attr)(H,"class","upper svelte-48fouy"),(0,e.attr)(C,"class","left svelte-48fouy"),(0,e.attr)(A,"class","left about-row svelte-48fouy"),(0,e.attr)(D,"class","about-icon svelte-48fouy"),(0,e.attr)(E,"class","svelte-48fouy"),(0,e.attr)(W,"class","left svelte-48fouy"),(0,e.attr)(I,"class","left about-row svelte-48fouy"),(0,e.attr)(U,"class","about-icon svelte-48fouy"),(0,e.attr)(ee,"class","svelte-48fouy"),(0,e.attr)(Z,"class","left svelte-48fouy"),(0,e.attr)(V,"class","left about-row svelte-48fouy"),(0,e.attr)(le,"class","about-icon left-push svelte-48fouy"),(0,e.attr)(de,"class","svelte-48fouy"),(0,e.attr)(se,"class","left svelte-48fouy"),(0,e.attr)(re,"class","left about-row svelte-48fouy"),(0,e.attr)(ge,"class","leaf svelte-48fouy"),(0,e.attr)(_e,"class","svelte-48fouy"),(0,e.attr)(be,"class","svelte-48fouy"),(0,e.attr)(xe,"class","left svelte-48fouy"),(0,e.attr)(Pe,"class","left svelte-48fouy"),(0,e.attr)(Ce,"target","_blank"),(0,e.attr)(Ce,"href",je=t[0].moreAtLink),(0,e.attr)(Ce,"class","svelte-48fouy"),(0,e.attr)(Le,"class","svelte-48fouy"),(0,e.attr)(Fe,"class","leaf svelte-48fouy"),(0,e.attr)(Be,"class","svelte-48fouy"),(0,e.attr)(We,"class","credits-list svelte-48fouy"),(0,e.attr)(Ge,"class","bird svelte-48fouy"),(0,e.attr)(b,"class","copy svelte-48fouy"),(0,e.attr)(a,"class","about-content svelte-48fouy"),(0,e.attr)(n,"class","about-container svelte-48fouy")},m(o,l){(0,e.insert)(o,n,l),(0,e.append)(n,a),(0,e.append)(a,r),(0,e.append)(r,i),(0,e.mount_component)(s,i,null),(0,e.append)(a,u),(0,e.append)(a,m),(0,e.append)(m,f),(0,e.append)(f,_),(0,e.append)(m,g),(0,e.append)(m,y),(0,e.append)(y,$),(0,e.append)(a,x),(0,e.append)(a,b),(0,e.append)(b,w),(0,e.append)(w,T),(0,e.mount_component)(k,T,null),(0,e.append)(w,R),(0,e.append)(w,P),(0,e.append)(b,S),(0,e.append)(b,A),(0,e.append)(A,L),(0,e.mount_component)(O,L,null),(0,e.append)(A,M),(0,e.append)(A,C),(0,e.append)(C,H),(0,e.append)(H,j),(0,e.append)(C,q),(0,e.append)(C,B),(0,e.append)(b,F),(0,e.append)(b,I),(0,e.append)(I,D),(0,e.mount_component)(J,D,null),(0,e.append)(I,N),(0,e.append)(I,W),(0,e.append)(W,E),(0,e.append)(E,G),(0,e.append)(W,z),(0,e.append)(W,K),(0,e.append)(b,Q),(0,e.append)(b,V),(0,e.append)(V,U),(0,e.mount_component)(X,U,null),(0,e.append)(V,Y),(0,e.append)(V,Z),(0,e.append)(Z,ee),(0,e.append)(ee,te),(0,e.append)(Z,ne),(0,e.append)(Z,ae),(0,e.append)(b,oe),(0,e.append)(b,re),(0,e.append)(re,le),(0,e.mount_component)(pe,le,null),(0,e.append)(re,ie),(0,e.append)(re,se),(0,e.append)(se,de),(0,e.append)(de,ce),(0,e.append)(se,ue),(0,e.append)(se,me),(0,e.append)(b,fe),(0,e.append)(b,_e),(0,e.append)(_e,ge),(0,e.mount_component)(ve,ge,null),(0,e.append)(_e,ye),(0,e.append)(_e,he),(0,e.append)(b,$e),(0,e.append)(b,xe),(0,e.append)(xe,be),(0,e.append)(be,we),(0,e.append)(xe,Te),(0,e.append)(xe,ke),(0,e.append)(b,Re),(0,e.append)(b,Pe),(0,e.append)(Pe,Se),(0,e.append)(b,Ae),(0,e.append)(b,Le),(0,e.append)(Le,Oe),(0,e.append)(Le,Me),(0,e.append)(Le,Ce),(0,e.append)(Ce,He),(0,e.append)(b,qe),(0,e.append)(b,Be),(0,e.append)(Be,Fe),(0,e.mount_component)(Ie,Fe,null),(0,e.append)(Be,De),(0,e.append)(Be,Je),(0,e.append)(b,Ne),(0,e.append)(b,We);for(let e=0;e<ht.length;e+=1)ht[e].m(We,null);(0,e.append)(b,Ee),(0,e.append)(b,Ge),(0,e.mount_component)(ze,Ge,null),(0,e.insert)(o,Ve,l),(0,e.mount_component)(Ue,o,l),Xe=!0,Ye||(Ze=[(0,e.listen)(n,"introend",t[4]),(0,e.listen)(n,"outrostart",t[5])],Ye=!0)},p(n,[a]){if(t=n,(!Xe||1&a&&d!==(d=t[0].nfbInteractiveLink))&&(0,e.attr)(i,"href",d),(!Xe||1&a)&&et!==(et=t[0].nfbProduction+"")&&(0,e.set_data)(_,et),(!Xe||1&a)&&tt!==(tt=t[0].nfbSubcaption+"")&&(0,e.set_data)($,tt),(!Xe||1&a)&&nt!==(nt=t[0].playHeader+"")&&(0,e.set_data)(P,nt),(!Xe||1&a)&&at!==(at=t[0].tapOrClickAndHold+"")&&(0,e.set_data)(j,at),(!Xe||1&a)&&ot!==(ot=t[0].moveCharacterText+"")&&(0,e.set_data)(B,ot),(!Xe||1&a)&&rt!==(rt=t[0].collectText+"")&&(0,e.set_data)(G,rt),(!Xe||1&a)&&lt!==(lt=t[0].tokenStringText+"")&&(0,e.set_data)(K,lt),(!Xe||1&a)&&pt!==(pt=t[0].orientText+"")&&(0,e.set_data)(te,pt),(!Xe||1&a)&&it!==(it=t[0].compassStringText+"")&&(0,e.set_data)(ae,it),(!Xe||1&a)&&st!==(st=t[0].returnText+"")&&(0,e.set_data)(ce,st),(!Xe||1&a)&&dt!==(dt=t[0].memoriesStringText+"")&&(0,e.set_data)(me,dt),(!Xe||1&a)&&ct!==(ct=t[0].aboutHeader+"")&&(0,e.set_data)(he,ct),(!Xe||1&a)&&ut!==(ut=t[0].wayfinderStrongText+"")&&(0,e.set_data)(we,ut),(!Xe||1&a)&&mt!==(mt=t[0].wayfinderTextParagraph+"")&&(0,e.set_data)(ke,mt),(!Xe||1&a)&&ft!==(ft=t[0].wayfinderFurtherTextParagraph+"")&&(0,e.set_data)(Se,ft),(!Xe||1&a)&&_t!==(_t=t[0].moreAt+"")&&(0,e.set_data)(Oe,_t),(!Xe||1&a)&&gt!==(gt=t[0].moreAtLinkText+"")&&(0,e.set_data)(He,gt),(!Xe||1&a&&je!==(je=t[0].moreAtLink))&&(0,e.attr)(Ce,"href",je),(!Xe||1&a)&&vt!==(vt=t[0].creditsHeader+"")&&(0,e.set_data)(Je,vt),8&a){let n;for(yt=t[3],n=0;n<yt.length;n+=1){const o=c(t,yt,n);ht[n]?(ht[n].p(o,a),(0,e.transition_in)(ht[n],1)):(ht[n]=v(o),ht[n].c(),(0,e.transition_in)(ht[n],1),ht[n].m(We,null))}for((0,e.group_outros)(),n=yt.length;n<ht.length;n+=1)$t(n);(0,e.check_outros)()}},i(t){if(!Xe){(0,e.transition_in)(s.$$.fragment,t),(0,e.transition_in)(k.$$.fragment,t),(0,e.transition_in)(O.$$.fragment,t),(0,e.transition_in)(J.$$.fragment,t),(0,e.transition_in)(X.$$.fragment,t),(0,e.transition_in)(pe.$$.fragment,t),(0,e.transition_in)(ve.$$.fragment,t),(0,e.transition_in)(Ie.$$.fragment,t);for(let t=0;t<yt.length;t+=1)(0,e.transition_in)(ht[t]);(0,e.transition_in)(ze.$$.fragment,t),(0,e.add_render_callback)(()=>{Qe&&Qe.end(1),Ke||(Ke=(0,e.create_in_transition)(n,o.fadeInTransition,{y:0,delay:10,duration:h})),Ke.start()}),(0,e.transition_in)(Ue.$$.fragment,t),Xe=!0}},o(t){(0,e.transition_out)(s.$$.fragment,t),(0,e.transition_out)(k.$$.fragment,t),(0,e.transition_out)(O.$$.fragment,t),(0,e.transition_out)(J.$$.fragment,t),(0,e.transition_out)(X.$$.fragment,t),(0,e.transition_out)(pe.$$.fragment,t),(0,e.transition_out)(ve.$$.fragment,t),(0,e.transition_out)(Ie.$$.fragment,t),ht=ht.filter(Boolean);for(let n=0;n<ht.length;n+=1)(0,e.transition_out)(ht[n]);(0,e.transition_out)(ze.$$.fragment,t),Ke&&Ke.invalidate(),Qe=(0,e.create_out_transition)(n,o.fadeInTransition,{y:0,delay:0,duration:h}),(0,e.transition_out)(Ue.$$.fragment,t),Xe=!1},d(t){t&&(0,e.detach)(n),(0,e.destroy_component)(s),(0,e.destroy_component)(k),(0,e.destroy_component)(O),(0,e.destroy_component)(J),(0,e.destroy_component)(X),(0,e.destroy_component)(pe),(0,e.destroy_component)(ve),(0,e.destroy_component)(Ie),(0,e.destroy_each)(ht,t),(0,e.destroy_component)(ze),t&&Qe&&Qe.end(),t&&(0,e.detach)(Ve),(0,e.destroy_component)(Ue,t),Ye=!1,(0,e.run_all)(Ze)}}}const h=250;function $(o,l,p){let i;(0,e.component_subscribe)(o,a.localize,e=>p(0,i=e));/(iOS|Android|iPhone|iPad)/i.test(navigator.userAgent);const s=(0,t.createEventDispatcher)(),{world:d}=(0,n.context)(),c=[[i.mattRole,"Matt DesLauriers"],[i.guillaumeRole,"Guillaume Le Roux"],["Illustration","Tiffany Beucher"],[i.cedrineRole,"Cédrine Pradier"],[i.williamRole,"William Mapan"],[i.boombox,"Drew Thomas & S. Quinn Hoodless — BoomBox Sound"],[i.jelaniRole,"Jelani Thompson"],"LEAF",[i.nicholasRole,"Nicholas Klassen"],[i.robRole,"Rob McLaughlin"],[i.jasmineRole,"Jasmine Pullukatt"],[i.camilleJanineRole,"Camille Fillion","Janine Steele"],[i.victoriaRole,"Victoria Angell"],[i.tammyRole,"Tammy Peddle"],[i.jenniferRole,"Jennifer Mair"],[i.ericRole,"Éric Bondo"],[i.sergiuRole,"Sergiu Raul Suciu"],[i.catherineRole,"Catherine Perreault"],[i.christianRole,"Christian Pitchen"],[i.socialRole,"Hannah Martin"],[i.gabrielleRole,"Gabrielle Lisa Collard"]];return[i,s,d,c,()=>{d.findTag(r.AppState).running=!1},()=>{d.findTag(r.AppState).running=!0},()=>s("close")]}class x extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,$,y,e.safe_not_equal,{})}}var b=x;exports.default=b;
},{"svelte/internal":"xeIE","svelte":"XHT5","../alec-svelte":"M3eo","../util/locale":"dkeN","../animations/transitions":"bvJy","../tags":"injP","../components/Image.svelte":"q18m","../components/CloseButton.svelte":"RyaA"}],"d4hs":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),n=require("svelte/transition"),t=require("../animations/transitions");function a(n){let t,a,i,r,s;const l=n[6].default,o=(0,e.create_slot)(l,n,n[5],null);return{c(){t=(0,e.element)("div"),o&&o.c(),(0,e.attr)(t,"class","svelte-r34ayh"),(0,e.toggle_class)(t,"disableInteraction",n[2]),(0,e.toggle_class)(t,"darken",n[0]),(0,e.toggle_class)(t,"darkenTransition",n[1])},m(a,l){(0,e.insert)(a,t,l),o&&o.m(t,null),i=!0,r||(s=(0,e.listen)(t,"click",n[7]),r=!0)},p(n,[a]){o&&o.p&&32&a&&(0,e.update_slot)(o,l,n,n[5],a,null,null),4&a&&(0,e.toggle_class)(t,"disableInteraction",n[2]),1&a&&(0,e.toggle_class)(t,"darken",n[0]),2&a&&(0,e.toggle_class)(t,"darkenTransition",n[1])},i(r){i||((0,e.transition_in)(o,r),(0,e.add_render_callback)(()=>{a||(a=(0,e.create_bidirectional_transition)(t,n[3],{},!0)),a.run(1)}),i=!0)},o(r){(0,e.transition_out)(o,r),a||(a=(0,e.create_bidirectional_transition)(t,n[3],{},!1)),a.run(0),i=!1},d(n){n&&(0,e.detach)(t),o&&o.d(n),n&&a&&a.end(),r=!1,s()}}}function i(n,a,i){let{$$slots:r={},$$scope:s}=a,{darken:l=!1}=a,{darkenTransition:o=!1}=a,{disableInteraction:d=!1}=a,{fade:c=!0}=a,u=c?t.fadeOpacityTransition:()=>{};return n.$$set=(e=>{"darken"in e&&i(0,l=e.darken),"darkenTransition"in e&&i(1,o=e.darkenTransition),"disableInteraction"in e&&i(2,d=e.disableInteraction),"fade"in e&&i(4,c=e.fade),"$$scope"in e&&i(5,s=e.$$scope)}),[l,o,d,u,c,s,r,function(t){(0,e.bubble)(n,t)}]}class r extends e.SvelteComponent{constructor(n){super(),(0,e.init)(this,n,i,a,e.safe_not_equal,{darken:0,darkenTransition:1,disableInteraction:2,fade:4})}}var s=r;exports.default=s;
},{"svelte/internal":"xeIE","svelte/transition":"ly0Q","../animations/transitions":"bvJy"}],"JLHF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=r(require("../assets/image/ui/ico_emptyHaiku.png")),i=r(require("../assets/image/ui/ico_completedHaiku.png")),n=r(require("../util/Assets")),o=r(require("./Image.svelte"));function r(e){return e&&e.__esModule?e:{default:e}}function s(t){let i,n,r;return n=new o.default({props:{id:t[0]?a:u}}),{c(){i=(0,e.element)("div"),(0,e.create_component)(n.$$.fragment),(0,e.attr)(i,"class","haiku-slot svelte-ohjn7u")},m(t,o){(0,e.insert)(t,i,o),(0,e.mount_component)(n,i,null),r=!0},p(e,[t]){const i={};1&t&&(i.id=e[0]?a:u),n.$set(i)},i(t){r||((0,e.transition_in)(n.$$.fragment,t),r=!0)},o(t){(0,e.transition_out)(n.$$.fragment,t),r=!1},d(t){t&&(0,e.detach)(i),(0,e.destroy_component)(n)}}}const u="image/ui/ico_emptyHaiku",a="image/ui/ico_completedHaiku";function l(e,t,i){n.default.prepare(u);let{collected:o=!1}=t;return e.$$set=(e=>{"collected"in e&&i(0,o=e.collected)}),[o]}class c extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,l,s,e.safe_not_equal,{collected:0})}}var d=c;exports.default=d;
},{"svelte/internal":"xeIE","../assets/image/ui/ico_emptyHaiku.png":"GlCV","../assets/image/ui/ico_completedHaiku.png":"HGCk","../util/Assets":"Wm90","./Image.svelte":"q18m"}],"Rk1e":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("svelte/internal"),e=a(require("./IconButton.svelte")),n=require("svelte/transition"),i=require("../animations/transitions"),o=a(require("eases"));function a(t){return t&&t.__esModule?t:{default:t}}function s(e){let n,i,a,s;return{c(){n=(0,t.element)("div"),(0,t.attr)(n,"class","notification svelte-bbjv")},m(e,i){(0,t.insert)(e,n,i),s=!0},p(t,e){t},i(e){s||((0,t.add_render_callback)(()=>{a&&a.end(1),i||(i=(0,t.create_in_transition)(n,l,{delay:500,easing:o.default.expoOut,duration:1e3})),i.start()}),s=!0)},o(e){i&&i.invalidate(),a=(0,t.create_out_transition)(n,l,{delay:0,easing:o.default.expoOut,duration:1e3}),s=!1},d(e){e&&(0,t.detach)(n),e&&a&&a.end()}}}function r(n){let o,a,r,l,u,c;(a=new e.default({props:{size:n[6],icon:n[3],image:n[4],id:n[5]}})).$on("click",n[10]),a.$on("touchstart",n[11]),a.$on("mousedown",n[12]);let d=n[8]&&s(n);return{c(){o=(0,t.element)("div"),(0,t.create_component)(a.$$.fragment),r=(0,t.space)(),d&&d.c(),(0,t.attr)(o,"class","menu-button svelte-bbjv"),(0,t.attr)(o,"style",n[7]),(0,t.toggle_class)(o,"topLeft",n[0]),(0,t.toggle_class)(o,"topRight",n[1]),(0,t.toggle_class)(o,"bottomRight",n[2])},m(e,n){(0,t.insert)(e,o,n),(0,t.mount_component)(a,o,null),(0,t.append)(o,r),d&&d.m(o,null),c=!0},p(e,[n]){const i={};64&n&&(i.size=e[6]),8&n&&(i.icon=e[3]),16&n&&(i.image=e[4]),32&n&&(i.id=e[5]),a.$set(i),e[8]?d?(d.p(e,n),256&n&&(0,t.transition_in)(d,1)):((d=s(e)).c(),(0,t.transition_in)(d,1),d.m(o,null)):d&&((0,t.group_outros)(),(0,t.transition_out)(d,1,1,()=>{d=null}),(0,t.check_outros)()),(!c||128&n)&&(0,t.attr)(o,"style",e[7]),1&n&&(0,t.toggle_class)(o,"topLeft",e[0]),2&n&&(0,t.toggle_class)(o,"topRight",e[1]),4&n&&(0,t.toggle_class)(o,"bottomRight",e[2])},i(e){c||((0,t.transition_in)(a.$$.fragment,e),(0,t.transition_in)(d),(0,t.add_render_callback)(()=>{u&&u.end(1),l||(l=(0,t.create_in_transition)(o,i.fadeOpacityTransition,{delay:250})),l.start()}),c=!0)},o(e){(0,t.transition_out)(a.$$.fragment,e),(0,t.transition_out)(d),l&&l.invalidate(),u=(0,t.create_out_transition)(o,i.fadeOpacityTransition,{}),c=!1},d(e){e&&(0,t.detach)(o),(0,t.destroy_component)(a),d&&d.d(),e&&u&&u.end()}}}function l(t,{delay:e=0,duration:n=500,easing:i=(t=>t),baseScale:o=0}){const a=getComputedStyle(t).transform.match(/scale\(([0-9.]+)\)/),s=a?a[1]:1,r=1-o;return{delay:e,duration:n,css:t=>{return`transform: scale(${i(t)*s*r+o})`}}}function u(e,n,i){let{topLeft:o=!1}=n,{topRight:a=!1}=n,{bottomRight:s=!1}=n,{icon:r}=n,{image:l}=n,{id:u}=n,{size:c=null}=n,{style:d=""}=n,g=!1,_=null;return e.$$set=(t=>{"topLeft"in t&&i(0,o=t.topLeft),"topRight"in t&&i(1,a=t.topRight),"bottomRight"in t&&i(2,s=t.bottomRight),"icon"in t&&i(3,r=t.icon),"image"in t&&i(4,l=t.image),"id"in t&&i(5,u=t.id),"size"in t&&i(6,c=t.size),"style"in t&&i(7,d=t.style)}),[o,a,s,r,l,u,c,d,g,function(){i(8,g=!0),clearTimeout(_),_=setTimeout(()=>{i(8,g=!1)},1500)},function(n){(0,t.bubble)(e,n)},function(n){(0,t.bubble)(e,n)},function(n){(0,t.bubble)(e,n)}]}class c extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,u,r,t.safe_not_equal,{topLeft:0,topRight:1,bottomRight:2,icon:3,image:4,id:5,size:6,style:7,notify:9})}get notify(){return this.$$.ctx[9]}}var d=c;exports.default=d;
},{"svelte/internal":"xeIE","./IconButton.svelte":"b4oK","svelte/transition":"ly0Q","../animations/transitions":"bvJy","eases":"uiPX"}],"mWhK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=require("svelte/transition"),n=require("svelte"),o=require("../animations/transitions"),r=u(require("./HaikuInventorySlot.svelte")),i=u(require("../assets/image/ui/ico_emptyHaiku.png")),s=u(require("../assets/image/ui/ico_completedHaiku.png")),a=u(require("../assets/image/ui/ico_journal.png")),l=u(require("./CornerMenuButton.svelte"));function u(e){return e&&e.__esModule?e:{default:e}}const{Boolean:c}=e.globals;function d(e,t,n){const o=e.slice();return o[13]=t[n],o}function f(t){let n,o;return n=new r.default({props:{collected:t[13]}}),{c(){(0,e.create_component)(n.$$.fragment)},m(t,r){(0,e.mount_component)(n,t,r),o=!0},p(e,t){const o={};1&t&&(o.collected=e[13]),n.$set(o)},i(t){o||((0,e.transition_in)(n.$$.fragment,t),o=!0)},o(t){(0,e.transition_out)(n.$$.fragment,t),o=!1},d(t){(0,e.destroy_component)(n,t)}}}function _(t){let n,r,i,s,a=t[0],l=[];for(let e=0;e<a.length;e+=1)l[e]=f(d(t,a,e));const u=t=>(0,e.transition_out)(l[t],1,1,()=>{l[t]=null});return{c(){n=(0,e.element)("div");for(let e=0;e<l.length;e+=1)l[e].c();(0,e.attr)(n,"class","haiku-container svelte-1wphodo")},m(t,o){(0,e.insert)(t,n,o);for(let e=0;e<l.length;e+=1)l[e].m(n,null);s=!0},p(t,[o]){if(1&o){let r;for(a=t[0],r=0;r<a.length;r+=1){const i=d(t,a,r);l[r]?(l[r].p(i,o),(0,e.transition_in)(l[r],1)):(l[r]=f(i),l[r].c(),(0,e.transition_in)(l[r],1),l[r].m(n,null))}for((0,e.group_outros)(),r=a.length;r<l.length;r+=1)u(r);(0,e.check_outros)()}},i(t){if(!s){for(let t=0;t<a.length;t+=1)(0,e.transition_in)(l[t]);(0,e.add_render_callback)(()=>{i&&i.end(1),r||(r=(0,e.create_in_transition)(n,o.fadeOpacityTransition,{delay:250})),r.start()}),s=!0}},o(t){l=l.filter(c);for(let n=0;n<l.length;n+=1)(0,e.transition_out)(l[n]);r&&r.invalidate(),i=(0,e.create_out_transition)(n,o.fadeOpacityTransition,{}),s=!1},d(t){t&&(0,e.detach)(n),(0,e.destroy_each)(l,t),t&&i&&i.end()}}}const p=4e3;function m(e,t,o){(0,n.createEventDispatcher)();let r,{store:i}=t,s=null,a=!1,l=[],u=0,c=!1,d=!1,f=!1;const _=i.subscribe(e=>{c=e.moving,r=e.state;const t=e.haikusTotal,n=e.haikusCollected||0;o(0,l=new Array(t).fill(!1).map((e,t)=>t<n)),u!==n&&(a=!0,clearTimeout(s),s=setTimeout(()=>{a=!1,m()},p)),u=n,m()});function m(){d=!r&&(a||!c||l.length>0&&l.every(Boolean))}return(0,n.onMount)(()=>{f=!0}),(0,n.onDestroy)(()=>{f=!1,a=!1,clearTimeout(s),_()}),e.$$set=(e=>{"store"in e&&o(1,i=e.store)}),[l,i]}class g extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,m,_,e.safe_not_equal,{store:1})}}var h=g;exports.default=h;
},{"svelte/internal":"xeIE","svelte/transition":"ly0Q","svelte":"XHT5","../animations/transitions":"bvJy","./HaikuInventorySlot.svelte":"JLHF","../assets/image/ui/ico_emptyHaiku.png":"GlCV","../assets/image/ui/ico_completedHaiku.png":"HGCk","../assets/image/ui/ico_journal.png":"O5pT","./CornerMenuButton.svelte":"Rk1e"}],"oScm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=require("../animations/transitions"),n=o(require("../config")),r=o(require("../util/Random")),a=o(require("./Image.svelte"));function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){const r=e.slice();return r[9]=t[n],r[0]=n,r}function l(e,t,n){const r=e.slice();return r[11]=t[n],r[13]=n,r}function s(n){let r,o,i,l;return o=new a.default({props:{width:"100%",height:"100%",id:"image/ui/empty_box"}}),{c(){r=(0,e.element)("div"),(0,e.create_component)(o.$$.fragment),(0,e.attr)(r,"class","haiku-card-icon svelte-rdjqne")},m(t,n){(0,e.insert)(t,r,n),(0,e.mount_component)(o,r,null),l=!0},p(e,t){n=e},i(a){l||((0,e.transition_in)(o.$$.fragment,a),i||(0,e.add_render_callback)(()=>{(i=(0,e.create_in_transition)(r,t.fadeTransition,{delay:m(4*n[0]+1+n[13])})).start()}),l=!0)},o(t){(0,e.transition_out)(o.$$.fragment,t),l=!1},d(t){t&&(0,e.detach)(r),(0,e.destroy_component)(o)}}}function c(n){let r,o,i,l;return o=new a.default({props:{width:"100%",height:"100%",id:"image/ui/filled_box"}}),{c(){r=(0,e.element)("div"),(0,e.create_component)(o.$$.fragment),(0,e.attr)(r,"class","haiku-card-icon svelte-rdjqne")},m(t,n){(0,e.insert)(t,r,n),(0,e.mount_component)(o,r,null),l=!0},p(e,t){n=e},i(a){l||((0,e.transition_in)(o.$$.fragment,a),i||(0,e.add_render_callback)(()=>{(i=(0,e.create_in_transition)(r,t.fadeTransition,{delay:m(4*n[0]+1+n[13])})).start()}),l=!0)},o(t){(0,e.transition_out)(o.$$.fragment,t),l=!1},d(t){t&&(0,e.detach)(r),(0,e.destroy_component)(o)}}}function d(t,n){let r,a,o,i,l,d;const u=[c,s],_=[];function m(e,t){return e[11].collected?0:1}return a=m(n),o=_[a]=u[a](n),{key:t,first:null,c(){r=(0,e.element)("div"),o.c(),i=(0,e.space)(),(0,e.attr)(r,"class","haiku-card svelte-rdjqne"),(0,e.attr)(r,"style",l=n[11].style),(0,e.toggle_class)(r,"locked",n[9].locked),(0,e.toggle_class)(r,"active",n[9].active),(0,e.toggle_class)(r,"collected",n[11].collected),this.first=r},m(t,n){(0,e.insert)(t,r,n),_[a].m(r,null),(0,e.append)(r,i),d=!0},p(t,n){let s=a;(a=m(t))!==s&&((0,e.group_outros)(),(0,e.transition_out)(_[s],1,1,()=>{_[s]=null}),(0,e.check_outros)(),(o=_[a])?o.p(t,n):(o=_[a]=u[a](t)).c(),(0,e.transition_in)(o,1),o.m(r,i)),(!d||2&n&&l!==(l=t[11].style))&&(0,e.attr)(r,"style",l),2&n&&(0,e.toggle_class)(r,"locked",t[9].locked),2&n&&(0,e.toggle_class)(r,"active",t[9].active),2&n&&(0,e.toggle_class)(r,"collected",t[11].collected)},i(t){d||((0,e.transition_in)(o),d=!0)},o(t){(0,e.transition_out)(o),d=!1},d(t){t&&(0,e.detach)(r),_[a].d()}}}function u(n,r){let o,i,s,c,u,_,f,g,p,h,v,$,k,b=[],y=new Map;i=new a.default({props:{width:"100%",height:"100%",id:"image/ui/vertical-rule"}});let q=r[9].cards;const w=e=>e[11];for(let e=0;e<q.length;e+=1){let t=l(r,q,e),n=w(t);y.set(n,b[e]=d(n,t))}return v=new a.default({props:{width:"100%",height:"100%",id:r[2](r[9].name,r[9].finished)}}),{key:n,first:null,c(){o=(0,e.element)("div"),(0,e.create_component)(i.$$.fragment),c=(0,e.space)(),u=(0,e.element)("div"),_=(0,e.element)("div"),f=(0,e.element)("div");for(let e=0;e<b.length;e+=1)b[e].c();g=(0,e.space)(),p=(0,e.element)("div"),h=(0,e.element)("div"),(0,e.create_component)(v.$$.fragment),(0,e.attr)(o,"class","vertical-rule svelte-rdjqne"),(0,e.attr)(f,"class","haiku-card-container svelte-rdjqne"),(0,e.toggle_class)(f,"locked",r[9].locked),(0,e.toggle_class)(f,"acitve",r[9].active),(0,e.attr)(_,"class","top-row svelte-rdjqne"),(0,e.attr)(h,"class","biome-icon svelte-rdjqne"),(0,e.toggle_class)(h,"locked",r[9].locked),(0,e.attr)(p,"class","biome-icon-container svelte-rdjqne"),(0,e.attr)(u,"class","biome-container svelte-rdjqne"),this.first=o},m(t,n){(0,e.insert)(t,o,n),(0,e.mount_component)(i,o,null),(0,e.insert)(t,c,n),(0,e.insert)(t,u,n),(0,e.append)(u,_),(0,e.append)(_,f);for(let e=0;e<b.length;e+=1)b[e].m(f,null);(0,e.append)(u,g),(0,e.append)(u,p),(0,e.append)(p,h),(0,e.mount_component)(v,h,null),k=!0},p(t,n){if(r=t,2&n){const t=r[9].cards;(0,e.group_outros)(),b=(0,e.update_keyed_each)(b,n,w,1,r,t,y,f,e.outro_and_destroy_block,d,null,l),(0,e.check_outros)()}2&n&&(0,e.toggle_class)(f,"locked",r[9].locked),2&n&&(0,e.toggle_class)(f,"acitve",r[9].active);const a={};2&n&&(a.id=r[2](r[9].name,r[9].finished)),v.$set(a),2&n&&(0,e.toggle_class)(h,"locked",r[9].locked)},i(n){if(!k){(0,e.transition_in)(i.$$.fragment,n),(0,e.add_render_callback)(()=>{s||(s=(0,e.create_bidirectional_transition)(o,t.fadeTransition,{delay:m(4*r[0])},!0)),s.run(1)});for(let t=0;t<q.length;t+=1)(0,e.transition_in)(b[t]);(0,e.transition_in)(v.$$.fragment,n),$||(0,e.add_render_callback)(()=>{($=(0,e.create_in_transition)(h,t.fadeTransition,{delay:m(4*r[0]+1)})).start()}),k=!0}},o(n){(0,e.transition_out)(i.$$.fragment,n),s||(s=(0,e.create_bidirectional_transition)(o,t.fadeTransition,{delay:m(4*r[0])},!1)),s.run(0);for(let t=0;t<b.length;t+=1)(0,e.transition_out)(b[t]);(0,e.transition_out)(v.$$.fragment,n),k=!1},d(t){t&&(0,e.detach)(o),(0,e.destroy_component)(i),t&&s&&s.end(),t&&(0,e.detach)(c),t&&(0,e.detach)(u);for(let e=0;e<b.length;e+=1)b[e].d();(0,e.destroy_component)(v)}}}function _(n){let r,o,l,s,c,d,_=[],f=new Map,g=n[1];const p=e=>e[9];for(let e=0;e<g.length;e+=1){let t=i(n,g,e),r=p(t);f.set(r,_[e]=u(r,t))}return s=new a.default({props:{width:"100%",height:"100%",id:"image/ui/vertical-rule"}}),{c(){r=(0,e.element)("div");for(let e=0;e<_.length;e+=1)_[e].c();o=(0,e.space)(),l=(0,e.element)("div"),(0,e.create_component)(s.$$.fragment),(0,e.attr)(l,"class","vertical-rule svelte-rdjqne"),(0,e.attr)(r,"class","progress-container svelte-rdjqne")},m(t,n){(0,e.insert)(t,r,n);for(let e=0;e<_.length;e+=1)_[e].m(r,null);(0,e.append)(r,o),(0,e.append)(r,l),(0,e.mount_component)(s,l,null),d=!0},p(t,[a]){if(n=t,6&a){const t=n[1];(0,e.group_outros)(),_=(0,e.update_keyed_each)(_,a,p,1,n,t,f,r,e.outro_and_destroy_block,u,o,i),(0,e.check_outros)()}},i(n){if(!d){for(let t=0;t<g.length;t+=1)(0,e.transition_in)(_[t]);(0,e.transition_in)(s.$$.fragment,n),c||(0,e.add_render_callback)(()=>{(c=(0,e.create_in_transition)(l,t.fadeTransition,{delay:m(12)})).start()}),d=!0}},o(t){for(let n=0;n<_.length;n+=1)(0,e.transition_out)(_[n]);(0,e.transition_out)(s.$$.fragment,t),d=!1},d(t){t&&(0,e.detach)(r);for(let e=0;e<_.length;e+=1)_[e].d();(0,e.destroy_component)(s)}}}function m(e){return 50+100*e}function f(e,t,a){const o=(0,r.default)();let{biome:i="forest"}=t,{biomeIndex:l=0}=t,{haikusCollected:s=0}=t;const c=(0,n.default)().haikusPerBiome,d=["forest","grasslands","tundra"],u={forest:"biomeforest",grasslands:"biomegrass",tundra:"biometundra"};let _;return e.$$set=(e=>{"biome"in e&&a(3,i=e.biome),"biomeIndex"in e&&a(0,l=e.biomeIndex),"haikusCollected"in e&&a(4,s=e.haikusCollected)}),e.$$.update=(()=>{17&e.$$.dirty&&a(1,_=d.map((e,t)=>{let n;return n=t<l?c:t>l?0:s,{name:e,finished:l>t,active:l===t,locked:t>l,cards:new Array(c).fill(null).map((e,t)=>{return{style:`transform: translate(0px, ${o.range(-.75,.75)}px) rotateZ(${o.range(-4,1.5)}deg);`,collected:t<n,mostRecent:!1}}),index:t}}))}),[l,_,function(e,t){return`image/ui/${u[e]}${t?"-alt":""}`},i,s]}class g extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,f,_,e.safe_not_equal,{biome:3,biomeIndex:0,haikusCollected:4})}}var p=g;exports.default=p;
},{"svelte/internal":"xeIE","../animations/transitions":"bvJy","../config":"nZps","../util/Random":"LMfK","./Image.svelte":"q18m"}],"orPd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=require("../util/tokens"),n=g(require("../components/ImageButton.svelte")),r=g(require("../components/AbsoluteOverlay.svelte")),o=g(require("../components/HaikuInventory.svelte")),a=_(require("../tags")),i=g(require("../assets/image/ui/ico_paperJournal1-rotated.png")),s=g(require("../components/GameProgress.svelte")),u=require("../util/locale"),l=require("svelte"),c=require("../animations/transitions"),d=require("../alec-svelte"),p=g(require("../components/HaikuCard.svelte")),f=g(require("../config"));function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(m=function(e){return e?n:t})(e)}function _(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=m(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(r,a,i):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function g(e){return e&&e.__esModule?e:{default:e}}function v(t){let r,o,a,i,u,l,d,f,m,_,g,v,$;const y=[t[5]()];let b={};for(let n=0;n<y.length;n+=1)b=(0,e.assign)(b,y[n]);return a=new s.default({props:b}),u=new p.default({props:{animatePoem:!0,lines:t[0],tokens:t[1]}}),(f=new n.default({props:{text:t[3].continueButton,mode:"normal_small"}})).$on("click",t[4]),{c(){r=(0,e.element)("div"),o=(0,e.element)("div"),(0,e.create_component)(a.$$.fragment),i=(0,e.space)(),(0,e.create_component)(u.$$.fragment),l=(0,e.space)(),d=(0,e.element)("div"),(0,e.create_component)(f.$$.fragment),(0,e.attr)(o,"class","progress-wrapper svelte-1wd0urs"),(0,e.attr)(d,"class","save-memory-container svelte-1wd0urs"),(0,e.attr)(r,"class","page-container svelte-1wd0urs"),(0,e.toggle_class)(r,"ignorePointer",t[2])},m(t,n){(0,e.insert)(t,r,n),(0,e.append)(r,o),(0,e.mount_component)(a,o,null),(0,e.append)(r,i),(0,e.mount_component)(u,r,null),(0,e.append)(r,l),(0,e.append)(r,d),(0,e.mount_component)(f,d,null),$=!0},p(t,[n]){const o=32&n?(0,e.get_spread_update)(y,[(0,e.get_spread_object)(t[5]())]):{};a.$set(o);const i={};1&n&&(i.lines=t[0]),2&n&&(i.tokens=t[1]),u.$set(i);const s={};8&n&&(s.text=t[3].continueButton),f.$set(s),4&n&&(0,e.toggle_class)(r,"ignorePointer",t[2])},i(t){$||((0,e.transition_in)(a.$$.fragment,t),(0,e.transition_in)(u.$$.fragment,t),(0,e.transition_in)(f.$$.fragment,t),(0,e.add_render_callback)(()=>{_&&_.end(1),m||(m=(0,e.create_in_transition)(d,c.fadeTransition,{delay:750,duration:500})),m.start()}),(0,e.add_render_callback)(()=>{v&&v.end(1),g||(g=(0,e.create_in_transition)(r,c.fadeOpacityTransition,{delay:0,duration:500})),g.start()}),$=!0)},o(t){(0,e.transition_out)(a.$$.fragment,t),(0,e.transition_out)(u.$$.fragment,t),(0,e.transition_out)(f.$$.fragment,t),m&&m.invalidate(),_=(0,e.create_out_transition)(d,c.fadeTransition,{duration:250}),g&&g.invalidate(),v=(0,e.create_out_transition)(r,c.fadeOpacityTransition,{delay:50,duration:500}),$=!1},d(t){t&&(0,e.detach)(r),(0,e.destroy_component)(a),(0,e.destroy_component)(u),(0,e.destroy_component)(f),t&&_&&_.end(),t&&v&&v.end()}}}function $(t,n,r){let o;(0,e.component_subscribe)(t,u.localize,e=>r(3,o=e));const i=(0,l.createEventDispatcher)(),{world:s}=(0,d.context)(),c=(0,f.default)().haikusPerBiome;let p,{lines:m}=n,{tokens:_}=n,{store:g}=n,v=!1,$=u.language.get();const y=g.subscribe(e=>{p=e}),b=["forest","grasslands","tundra"];return(0,l.onMount)(()=>{g.update(e=>({...e,playing:!1})),r(2,v=!1);const e=u.language.subscribe(e=>{$=e});return()=>{y(),e()}}),t.$$set=(e=>{"lines"in e&&r(0,m=e.lines),"tokens"in e&&r(1,_=e.tokens),"store"in e&&r(6,g=e.store)}),t.$$.update=(()=>{3&t.$$.dirty&&r(2,v=!1)}),[m,_,v,o,function(){r(2,v=!0),i("close")},function(){const e=s.query(a.HaikuInInventory),t=s.findEntity(a.ActiveEnvironmentState),n=t?t.get(a.EnvironmentState).name:"forest";return{biome:n,biomeIndex:b.includes(n)?b.indexOf(n):0,haikusCollected:Math.min(c,Math.max(0,e.entities.length))}},g]}class y extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,$,v,e.safe_not_equal,{lines:0,tokens:1,store:6})}}var b=y;exports.default=b;
},{"svelte/internal":"xeIE","../util/tokens":"kL9I","../components/ImageButton.svelte":"HO9o","../components/AbsoluteOverlay.svelte":"d4hs","../components/HaikuInventory.svelte":"mWhK","../tags":"injP","../assets/image/ui/ico_paperJournal1-rotated.png":"NF7f","../components/GameProgress.svelte":"oScm","../util/locale":"dkeN","svelte":"XHT5","../animations/transitions":"bvJy","../alec-svelte":"M3eo","../components/HaikuCard.svelte":"p6Hk","../config":"nZps"}],"uJX9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=require("svelte/transition"),n=require("svelte"),r=a(require("../assets/image/svg/icon-touch.svg"));function a(e){return e&&e.__esModule?e:{default:e}}function i(n){let a,i,s,o,l,d,u,c,p,v;return{c(){a=(0,e.element)("div"),i=(0,e.element)("div"),s=(0,e.element)("div"),o=(0,e.element)("img"),d=(0,e.space)(),(u=(0,e.element)("p")).textContent=`${n[0]?"tap + hold":"click + hold"} to explore`,o.src!==(l=r.default)&&(0,e.attr)(o,"src",l),(0,e.attr)(o,"alt",""),(0,e.attr)(s,"class","image-container svelte-1rmuk9w"),(0,e.attr)(u,"class","svelte-1rmuk9w"),(0,e.attr)(i,"class","info svelte-1rmuk9w"),(0,e.attr)(a,"class","container svelte-1rmuk9w")},m(t,n){(0,e.insert)(t,a,n),(0,e.append)(a,i),(0,e.append)(i,s),(0,e.append)(s,o),(0,e.append)(i,d),(0,e.append)(i,u),v=!0},p:e.noop,i(n){v||((0,e.add_render_callback)(()=>{p&&p.end(1),c||(c=(0,e.create_in_transition)(a,t.fade,{delay:1e3,duration:1500})),c.start()}),v=!0)},o(n){c&&c.invalidate(),p=(0,e.create_out_transition)(a,t.fade,{duration:800}),v=!1},d(t){t&&(0,e.detach)(a),t&&p&&p.end()}}}function s(e){return[/(Android|iOS|iPad|iPod|iPhone)/i.test(navigator.userAgent)]}class o extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,s,i,e.safe_not_equal,{})}}var l=o;exports.default=l;
},{"svelte/internal":"xeIE","svelte/transition":"ly0Q","svelte":"XHT5","../assets/image/svg/icon-touch.svg":"uF9M"}],"dmcf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("svelte/internal"),e=require("../util/tokens"),n=require("svelte/easing"),r=o(require("./Image.svelte")),i=o(require("../util/Assets"));function o(t){return t&&t.__esModule?t:{default:t}}function a(e){let n,i,o,a;return i=new r.default({props:{id:c}}),{c(){n=(0,t.element)("div"),(0,t.create_component)(i.$$.fragment),(0,t.attr)(n,"class","img-container svelte-1xnqt9x")},m(e,r){(0,t.insert)(e,n,r),(0,t.mount_component)(i,n,null),a=!0},p:t.noop,i(r){a||((0,t.transition_in)(i.$$.fragment,r),(0,t.add_render_callback)(()=>{o||(o=(0,t.create_bidirectional_transition)(n,e[2],{},!0)),o.run(1)}),a=!0)},o(r){(0,t.transition_out)(i.$$.fragment,r),o||(o=(0,t.create_bidirectional_transition)(n,e[2],{},!1)),o.run(0),a=!1},d(e){e&&(0,t.detach)(n),(0,t.destroy_component)(i),e&&o&&o.end()}}}function s(e){let n,r,i,o,a;return{c(){n=(0,t.element)("div"),(r=(0,t.element)("img")).src!==(i=e[0])&&(0,t.attr)(r,"src",i),(0,t.attr)(r,"alt",""),(0,t.attr)(r,"class","svelte-1xnqt9x"),(0,t.attr)(n,"class","img-container svelte-1xnqt9x")},m(e,i){(0,t.insert)(e,n,i),(0,t.append)(n,r),a=!0},p(e,n){(!a||1&n&&r.src!==(i=e[0]))&&(0,t.attr)(r,"src",i)},i(r){a||((0,t.add_render_callback)(()=>{o||(o=(0,t.create_bidirectional_transition)(n,e[2],{},!0)),o.run(1)}),a=!0)},o(r){o||(o=(0,t.create_bidirectional_transition)(n,e[2],{},!1)),o.run(0),a=!1},d(e){e&&(0,t.detach)(n),e&&o&&o.end()}}}function l(e){let n,r,i,o,l,c=!e[1]&&a(e),u=e[1]&&s(e);return{c(){n=(0,t.element)("div"),r=(0,t.element)("div"),c&&c.c(),i=(0,t.space)(),o=(0,t.element)("div"),u&&u.c(),(0,t.attr)(r,"class","outline svelte-1xnqt9x"),(0,t.attr)(o,"class","content svelte-1xnqt9x"),(0,t.attr)(n,"class","container svelte-1xnqt9x")},m(e,a){(0,t.insert)(e,n,a),(0,t.append)(n,r),c&&c.m(r,null),(0,t.append)(n,i),(0,t.append)(n,o),u&&u.m(o,null),l=!0},p(e,[n]){e[1]?c&&((0,t.group_outros)(),(0,t.transition_out)(c,1,1,()=>{c=null}),(0,t.check_outros)()):c?(c.p(e,n),2&n&&(0,t.transition_in)(c,1)):((c=a(e)).c(),(0,t.transition_in)(c,1),c.m(r,null)),e[1]?u?(u.p(e,n),2&n&&(0,t.transition_in)(u,1)):((u=s(e)).c(),(0,t.transition_in)(u,1),u.m(o,null)):u&&((0,t.group_outros)(),(0,t.transition_out)(u,1,1,()=>{u=null}),(0,t.check_outros)())},i(e){l||((0,t.transition_in)(c),(0,t.transition_in)(u),l=!0)},o(e){(0,t.transition_out)(c),(0,t.transition_out)(u),l=!1},d(e){e&&(0,t.detach)(n),c&&c.d(),u&&u.d()}}}const c="image/ui/ico_emptytoken";function u(t,{delay:e=0,duration:n=200,easing:r=(t=>t),baseScale:i=0}){const o=+getComputedStyle(t).opacity,a=getComputedStyle(t).transform.match(/scale\(([0-9.]+)\)/),s=a?a[1]:1,l=1-i;return{delay:e,duration:n,css:t=>{const e=r(t);return`opacity: ${e*o}; transform: scale(${e*s*l+i})`}}}function d(t,r,o){i.default.prepare(c);let{src:a=null}=r,{collected:s=!1}=r;return t.$$set=(t=>{"src"in t&&o(0,a=t.src),"collected"in t&&o(1,s=t.collected)}),[a,s,(t,e)=>u(t,{delay:0,duration:1e3,easing:n.cubicInOut,baseScale:.5,...e}),function(t){o(0,a=t?e.CollectedTokenURLs[t]:null),o(1,s=Boolean(t&&a))}]}class _ extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,d,l,t.safe_not_equal,{src:0,collected:1,setToken:3})}get setToken(){return this.$$.ctx[3]}}var p=_;exports.default=p;
},{"svelte/internal":"xeIE","../util/tokens":"kL9I","svelte/easing":"IjtP","./Image.svelte":"q18m","../util/Assets":"Wm90"}],"levx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("svelte/internal"),e=r(require("./TokenInventorySlot.svelte")),n=require("svelte"),o=require("../animations/transitions");function r(t){return t&&t.__esModule?t:{default:t}}function l(t,e,n){const o=t.slice();return o[3]=e[n],o[4]=e,o[5]=n,o}function s(n){let o,r,l=n[5];const s=()=>n[2](o,l),i=()=>n[2](null,l);return o=new e.default({props:{}}),s(),{c(){(0,t.create_component)(o.$$.fragment)},m(e,n){(0,t.mount_component)(o,e,n),r=!0},p(t,e){l!==t[5]&&(i(),l=t[5],s());o.$set({})},i(e){r||((0,t.transition_in)(o.$$.fragment,e),r=!0)},o(e){(0,t.transition_out)(o.$$.fragment,e),r=!1},d(e){i(),(0,t.destroy_component)(o,e)}}}function i(e){let n,o,r,i=e[0],u=[];for(let t=0;t<i.length;t+=1)u[t]=s(l(e,i,t));const a=e=>(0,t.transition_out)(u[e],1,1,()=>{u[e]=null});return{c(){n=(0,t.element)("div"),o=(0,t.element)("div");for(let t=0;t<u.length;t+=1)u[t].c();(0,t.attr)(o,"class","row svelte-l0oa72"),(0,t.attr)(n,"class","container svelte-l0oa72")},m(e,l){(0,t.insert)(e,n,l),(0,t.append)(n,o);for(let t=0;t<u.length;t+=1)u[t].m(o,null);r=!0},p(e,[n]){if(1&n){let r;for(i=e[0],r=0;r<i.length;r+=1){const a=l(e,i,r);u[r]?(u[r].p(a,n),(0,t.transition_in)(u[r],1)):(u[r]=s(a),u[r].c(),(0,t.transition_in)(u[r],1),u[r].m(o,null))}for((0,t.group_outros)(),r=i.length;r<u.length;r+=1)a(r);(0,t.check_outros)()}},i(e){if(!r){for(let e=0;e<i.length;e+=1)(0,t.transition_in)(u[e]);r=!0}},o(e){u=u.filter(Boolean);for(let n=0;n<u.length;n+=1)(0,t.transition_out)(u[n]);r=!1},d(e){e&&(0,t.detach)(n),(0,t.destroy_each)(u,e)}}}function u(e,o,r){let{store:l}=o,s=new Array(3).fill(null);return(0,n.onMount)(()=>{const t=l.subscribe(t=>{const e=t.tokensCollected||[];for(let n=0;n<s.length;n++)s[n].setToken(e[n])});return()=>{t()}}),e.$$set=(t=>{"store"in t&&r(1,l=t.store)}),[s,l,function(e,n){t.binding_callbacks[e?"unshift":"push"](()=>{s[n]=e,r(0,s)})}]}class a extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,u,i,t.safe_not_equal,{store:1})}}var c=a;exports.default=c;
},{"svelte/internal":"xeIE","./TokenInventorySlot.svelte":"dmcf","svelte":"XHT5","../animations/transitions":"bvJy"}],"VCLG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("svelte/internal"),n=l(require("../components/HaikuInventory.svelte")),e=l(require("../components/TokenInventory.svelte")),o=require("svelte"),i=l(require("../components/CornerMenuButton.svelte")),r=l(require("../util/Assets")),a=require("../alec-svelte"),s=p(require("../tags")),u=require("../nfb");function c(t){if("function"!=typeof WeakMap)return null;var n=new WeakMap,e=new WeakMap;return(c=function(t){return t?e:n})(t)}function p(t,n){if(!n&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=c(n);if(e&&e.has(t))return e.get(t);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var a=i?Object.getOwnPropertyDescriptor(t,r):null;a&&(a.get||a.set)?Object.defineProperty(o,r,a):o[r]=t[r]}return o.default=t,e&&e.set(t,o),o}function l(t){return t&&t.__esModule?t:{default:t}}function m(n){let e,o;return(e=new i.default({props:{style:"top: 8px; left: 6px",image:n[5]}})).$on("click",n[14]),{c(){(0,t.create_component)(e.$$.fragment)},m(n,i){(0,t.mount_component)(e,n,i),o=!0},p:t.noop,i(n){o||((0,t.transition_in)(e.$$.fragment,n),o=!0)},o(n){(0,t.transition_out)(e.$$.fragment,n),o=!1},d(n){(0,t.destroy_component)(e,n)}}}function f(n){let o,r,a,s;return o=new e.default({props:{store:n[0]}}),(a=new i.default({props:{size:"large",style:"top: 7px; right: 7px",image:n[7]}})).$on("click",n[15]),{c(){(0,t.create_component)(o.$$.fragment),r=(0,t.space)(),(0,t.create_component)(a.$$.fragment)},m(n,e){(0,t.mount_component)(o,n,e),(0,t.insert)(n,r,e),(0,t.mount_component)(a,n,e),s=!0},p(t,n){const e={};1&n&&(e.store=t[0]),o.$set(e)},i(n){s||((0,t.transition_in)(o.$$.fragment,n),(0,t.transition_in)(a.$$.fragment,n),s=!0)},o(n){(0,t.transition_out)(o.$$.fragment,n),(0,t.transition_out)(a.$$.fragment,n),s=!1},d(n){(0,t.destroy_component)(o,n),n&&(0,t.detach)(r),(0,t.destroy_component)(a,n)}}}function _(n){let e,o,r,a=n[1]&&d(n),s={image:n[6],style:"bottom: 12px; right: 10px",id:v};return o=new i.default({props:s}),n[17](o),o.$on("click",n[18]),{c(){a&&a.c(),e=(0,t.space)(),(0,t.create_component)(o.$$.fragment)},m(n,i){a&&a.m(n,i),(0,t.insert)(n,e,i),(0,t.mount_component)(o,n,i),r=!0},p(n,i){n[1]?a?(a.p(n,i),2&i&&(0,t.transition_in)(a,1)):((a=d(n)).c(),(0,t.transition_in)(a,1),a.m(e.parentNode,e)):a&&((0,t.group_outros)(),(0,t.transition_out)(a,1,1,()=>{a=null}),(0,t.check_outros)());o.$set({})},i(n){r||((0,t.transition_in)(a),(0,t.transition_in)(o.$$.fragment,n),r=!0)},o(n){(0,t.transition_out)(a),(0,t.transition_out)(o.$$.fragment,n),r=!1},d(i){a&&a.d(i),i&&(0,t.detach)(e),n[17](null),(0,t.destroy_component)(o,i)}}}function d(e){let o,i;return(o=new n.default({props:{store:e[0]}})).$on("journal",e[16]),{c(){(0,t.create_component)(o.$$.fragment)},m(n,e){(0,t.mount_component)(o,n,e),i=!0},p(t,n){const e={};1&n&&(e.store=t[0]),o.$set(e)},i(n){i||((0,t.transition_in)(o.$$.fragment,n),i=!0)},o(n){(0,t.transition_out)(o.$$.fragment,n),i=!1},d(n){(0,t.destroy_component)(o,n)}}}function g(n){let e,o,i,r,a=!n[2]&&m(n),s=n[1]&&f(n),u=n[3]>0&&!n[2]&&_(n);return{c(){a&&a.c(),e=(0,t.space)(),s&&s.c(),o=(0,t.space)(),u&&u.c(),i=(0,t.empty)()},m(n,c){a&&a.m(n,c),(0,t.insert)(n,e,c),s&&s.m(n,c),(0,t.insert)(n,o,c),u&&u.m(n,c),(0,t.insert)(n,i,c),r=!0},p(n,[r]){n[2]?a&&((0,t.group_outros)(),(0,t.transition_out)(a,1,1,()=>{a=null}),(0,t.check_outros)()):a?(a.p(n,r),4&r&&(0,t.transition_in)(a,1)):((a=m(n)).c(),(0,t.transition_in)(a,1),a.m(e.parentNode,e)),n[1]?s?(s.p(n,r),2&r&&(0,t.transition_in)(s,1)):((s=f(n)).c(),(0,t.transition_in)(s,1),s.m(o.parentNode,o)):s&&((0,t.group_outros)(),(0,t.transition_out)(s,1,1,()=>{s=null}),(0,t.check_outros)()),n[3]>0&&!n[2]?u?(u.p(n,r),12&r&&(0,t.transition_in)(u,1)):((u=_(n)).c(),(0,t.transition_in)(u,1),u.m(i.parentNode,i)):u&&((0,t.group_outros)(),(0,t.transition_out)(u,1,1,()=>{u=null}),(0,t.check_outros)())},i(n){r||((0,t.transition_in)(a),(0,t.transition_in)(s),(0,t.transition_in)(u),r=!0)},o(n){(0,t.transition_out)(a),(0,t.transition_out)(s),(0,t.transition_out)(u),r=!1},d(n){a&&a.d(n),n&&(0,t.detach)(e),s&&s.d(n),n&&(0,t.detach)(o),u&&u.d(n),n&&(0,t.detach)(i)}}}const $="image/ui/btn_pause",v="image/ui/ico_journal",k="image/ui/compass3";function y(n,e,i){r.default.prepare([$,v,k]);const c=r.default.load($),p=r.default.load(v),l=r.default.load(k),m=(0,o.createEventDispatcher)(),{world:f}=(0,a.context)(),_=f.entity();let d,{store:g}=e,{moving:y=!1}=e,{canCollectTokens:h=!1}=e,{finishedHaikus:b=[]}=e,{currentHaiku:T=!1}=e,w=0;const x=()=>{d&&d.notify()};function j(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const n=f.findTag(s.UserTarget).position;_.tagOn(s.CompassVisible),_.get(s.CompassVisible).position.copy(n),(0,u.sendAnalytics)({event:"compass_open",eventLabel:"compass_open"})}g.update(t=>({...t,onNotifyHaiku:x})),(0,o.onMount)(()=>{const t=g.subscribe(t=>{i(3,w=t.finishedHaikus.length)});return()=>{t()}});return n.$$set=(t=>{"store"in t&&i(0,g=t.store),"moving"in t&&i(12,y=t.moving),"canCollectTokens"in t&&i(1,h=t.canCollectTokens),"finishedHaikus"in t&&i(13,b=t.finishedHaikus),"currentHaiku"in t&&i(2,T=t.currentHaiku)}),[g,h,T,w,d,c,p,l,m,f,_,j,y,b,t=>{f.findTag(s.ShowBiomeResolution)||f.findTag(s.TransitionToNextBiome)||(t.preventDefault(),t.stopImmediatePropagation(),_.tagOff(s.ButtonClick),_.tagOn(s.ButtonClick),m("pause"),(0,u.sendAnalytics)({event:"menu_open",eventLabel:"menu_open"}))},t=>{j(t)},function(e){(0,t.bubble)(n,e)},function(n){t.binding_callbacks[n?"unshift":"push"](()=>{i(4,d=n)})},t=>{f.findTag(s.ShowBiomeResolution)||f.findTag(s.TransitionToNextBiome)||(m("journal"),(0,u.sendAnalytics)({event:"journal_open",eventLabel:"journal_open"}))}]}class h extends t.SvelteComponent{constructor(n){super(),(0,t.init)(this,n,y,g,t.safe_not_equal,{store:0,moving:12,canCollectTokens:1,finishedHaikus:13,currentHaiku:2})}}var b=h;exports.default=b;
},{"svelte/internal":"xeIE","../components/HaikuInventory.svelte":"mWhK","../components/TokenInventory.svelte":"levx","svelte":"XHT5","../components/CornerMenuButton.svelte":"Rk1e","../util/Assets":"Wm90","../alec-svelte":"M3eo","../tags":"injP","../nfb":"Xlf9"}],"ShwC":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/transition.7c94da3e.mp4";
},{}],"Z2Ty":[function(require,module,exports) {
"use strict";function e({parentWidth:e,parentHeight:t,childWidth:i,childHeight:n,fit:o="contain",scale:c=1,offsetX:s=.5,offsetY:l=.5}){const f=i/n,a=e/t;let r=i*c,d=n*c,h=0,u=0;if("scale-down"===o){const o=Math.min(e/i,t/n);r=i*c*o,d=n*c*o}else if("contain"===o||"cover"===o){r=e*c,d=t*c,("contain"===o?f>a:f<a)?d=r/f:r=d*f}else"fill"===o&&(r=e*c,d=t*c);return[h=(e-r)*s,u=(t-d)*l,r,d]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"wegv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=require("svelte"),n=d(require("../assets/video/transition.mp4")),i=require("../animations/transitions"),a=d(require("../util/objectFit"));function d(e){return e&&e.__esModule?e:{default:e}}const{window:r}=e.globals;function s(t){let a,d,s,o,l,u,p,c;return{c(){a=(0,e.element)("div"),d=(0,e.element)("video"),(0,e.attr)(d,"class","leaf-video svelte-fpz107"),d.autoplay=!0,d.muted=!0,d.playsInline=!0,d.src!==(s=n.default)&&(0,e.attr)(d,"src",s),(0,e.attr)(a,"class","leaf-video-container svelte-fpz107")},m(n,i){(0,e.insert)(n,a,i),(0,e.append)(a,d),t[4](d),u=!0,p||(c=(0,e.listen)(r,"resize",t[3],{passive:!0}),p=!0)},p(e,[n]){t=e},i(n){u||((0,e.add_render_callback)(()=>{l&&l.end(1),o||(o=(0,e.create_in_transition)(d,i.fadeInTransition,{delay:0,y:0,...t[0]})),o.start()}),u=!0)},o(n){o&&o.invalidate(),l=(0,e.create_out_transition)(d,i.fadeInTransition,{y:0,...t[1]}),u=!1},d(n){n&&(0,e.detach)(a),t[4](null),n&&l&&l.end(),p=!1,c()}}}function o(n,i,d){let r,s,{fadeInOptions:o={}}=i,{fadeOutOptions:l={}}=i,u=new Promise(e=>{s=e});function p(){r&&(r.readyState<=0?u.then(()=>c()):c())}function c(){if(r){window.innerWidth,window.innerHeight;const[e,t,n,i]=(0,a.default)({parentWidth:window.innerWidth,parentHeight:window.innerHeight,childWidth:r.videoWidth,childHeight:r.videoHeight,fit:window.innerWidth<window.innerHeight?"cover":"contain"});Object.assign(r.style,{left:`${e}px`,top:`${t}px`,width:`${n}px`,height:`${i}px`})}}return(0,t.onMount)(()=>{let e=()=>{};return r.readyState<=0?(r.addEventListener("loadedmetadata",s),e=(()=>r.removeEventListener("loadedmetadata",s))):s(),p(),d(2,r.muted=!0,r),r.play(),()=>{r&&r.pause(),e()}}),n.$$set=(e=>{"fadeInOptions"in e&&d(0,o=e.fadeInOptions),"fadeOutOptions"in e&&d(1,l=e.fadeOutOptions)}),[o,l,r,p,function(t){e.binding_callbacks[t?"unshift":"push"](()=>{d(2,r=t)})}]}class l extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,o,s,e.safe_not_equal,{fadeInOptions:0,fadeOutOptions:1})}}var u=l;exports.default=u;
},{"svelte/internal":"xeIE","svelte":"XHT5","../assets/video/transition.mp4":"ShwC","../animations/transitions":"bvJy","../util/objectFit":"Z2Ty"}],"kspl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("svelte/internal"),n=require("svelte"),e=require("../animations/transitions"),o=require("../util/locale"),i=a(require("../components/Image.svelte")),r=a(require("../components/LeafVideo.svelte"));function a(t){return t&&t.__esModule?t:{default:t}}function s(n){let e,o;return e=new r.default({props:{fadeInOptions:{delay:0,duration:2e3},fadeOutOptions:{delay:2e3,duration:500}}}),{c(){(0,t.create_component)(e.$$.fragment)},m(n,i){(0,t.mount_component)(e,n,i),o=!0},i(n){o||((0,t.transition_in)(e.$$.fragment,n),o=!0)},o(n){(0,t.transition_out)(e.$$.fragment,n),o=!1},d(n){(0,t.destroy_component)(e,n)}}}function u(n){let o,r,a,s,u,d,l,c,_,p=n[2].introPresents+"";return(o=new i.default({props:{inTransition:(0,e.transition)(e.fadeInTransition,{duration:1500}),outTransition:(0,e.transition)(e.fadeOutTransition,{delay:2e3}),width:"150px",id:"image/svg/nfblogo"}})).$on("introend",n[4]),o.$on("outroend",n[5]),o.$on("outrostart",n[6]),{c(){(0,t.create_component)(o.$$.fragment),r=(0,t.space)(),a=(0,t.element)("div"),s=(0,t.text)(p),(0,t.attr)(a,"class","presented svelte-1th3gw3")},m(e,i){(0,t.mount_component)(o,e,i),(0,t.insert)(e,r,i),(0,t.insert)(e,a,i),(0,t.append)(a,s),l=!0,c||(_=(0,t.listen)(a,"introend",n[7]),c=!0)},p(n,e){(!l||4&e)&&p!==(p=n[2].introPresents+"")&&(0,t.set_data)(s,p)},i(n){l||((0,t.transition_in)(o.$$.fragment,n),(0,t.add_render_callback)(()=>{d&&d.end(1),u||(u=(0,t.create_in_transition)(a,e.fadeInTransition,{delay:500,duration:1250})),u.start()}),l=!0)},o(n){(0,t.transition_out)(o.$$.fragment,n),u&&u.invalidate(),d=(0,t.create_out_transition)(a,e.fadeOutTransition,{delay:1750}),l=!1},d(n){(0,t.destroy_component)(o,n),n&&(0,t.detach)(r),n&&(0,t.detach)(a),n&&d&&d.end(),c=!1,_()}}}function d(n){let e,o,i,r=n[1]&&s(n),a=n[0]&&u(n);return{c(){e=(0,t.element)("main"),r&&r.c(),o=(0,t.space)(),a&&a.c(),(0,t.attr)(e,"class","svelte-1th3gw3")},m(n,s){(0,t.insert)(n,e,s),r&&r.m(e,null),(0,t.append)(e,o),a&&a.m(e,null),i=!0},p(n,[i]){n[1]?r?2&i&&(0,t.transition_in)(r,1):((r=s(n)).c(),(0,t.transition_in)(r,1),r.m(e,o)):r&&((0,t.group_outros)(),(0,t.transition_out)(r,1,1,()=>{r=null}),(0,t.check_outros)()),n[0]?a?(a.p(n,i),1&i&&(0,t.transition_in)(a,1)):((a=u(n)).c(),(0,t.transition_in)(a,1),a.m(e,null)):a&&((0,t.group_outros)(),(0,t.transition_out)(a,1,1,()=>{a=null}),(0,t.check_outros)())},i(n){i||((0,t.transition_in)(r),(0,t.transition_in)(a),i=!0)},o(n){(0,t.transition_out)(r),(0,t.transition_out)(a),i=!1},d(n){n&&(0,t.detach)(e),r&&r.d(),a&&a.d()}}}function l(e,i,r){let a;(0,t.component_subscribe)(e,o.localize,t=>r(2,a=t));const s=(0,n.createEventDispatcher)();let u=!0,d=!0;(0,n.onMount)(()=>()=>{});return[u,d,a,s,()=>{r(0,u=!1)},()=>{s("end")},()=>{r(1,d=!1)},()=>{s("inbetween")}]}class c extends t.SvelteComponent{constructor(n){super(),(0,t.init)(this,n,l,d,t.safe_not_equal,{})}}var _=c;exports.default=_;
},{"svelte/internal":"xeIE","svelte":"XHT5","../animations/transitions":"bvJy","../util/locale":"dkeN","../components/Image.svelte":"q18m","../components/LeafVideo.svelte":"wegv"}],"FmP3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=l(require("../util/math")),n=a(require("../util/Random")),r=require("../animations/transitions"),i=require("svelte");function a(e){return e&&e.__esModule?e:{default:e}}function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var l=i?Object.getOwnPropertyDescriptor(e,a):null;l&&(l.get||l.set)?Object.defineProperty(r,a,l):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function s(e,t,n){const r=e.slice();return r[10]=t[n],r}function u(t){let n,i,a,o,l,s=t[10].value+"";return{c(){n=(0,e.element)("span"),i=(0,e.text)(s),(0,e.attr)(n,"style",a=`min-width: ${t[10].whitespace?x:0}px;`),(0,e.attr)(n,"class","text-node svelte-niwj3w"),(0,e.toggle_class)(n,"whitespace",t[10].whitespace)},m(t,r){(0,e.insert)(t,n,r),(0,e.append)(n,i),l=!0},p(r,o){t=r,(!l||8&o)&&s!==(s=t[10].value+"")&&(0,e.set_data)(i,s),(!l||8&o&&a!==(a=`min-width: ${t[10].whitespace?x:0}px;`))&&(0,e.attr)(n,"style",a),8&o&&(0,e.toggle_class)(n,"whitespace",t[10].whitespace)},i(i){l||((0,e.add_render_callback)(()=>{o||(o=(0,e.create_bidirectional_transition)(n,r.fadeTransition,{...t[10],delay:t[0]+t[10].delay},!0)),o.run(1)}),l=!0)},o(i){o||(o=(0,e.create_bidirectional_transition)(n,r.fadeTransition,{...t[10],delay:t[0]+t[10].delay},!1)),o.run(0),l=!1},d(t){t&&(0,e.detach)(n),t&&o&&o.end()}}}function c(t){let n,i,a,o=t[3],l=[];for(let e=0;e<o.length;e+=1)l[e]=u(s(t,o,e));const c=t=>(0,e.transition_out)(l[t],1,1,()=>{l[t]=null});return{c(){n=(0,e.element)("p");for(let e=0;e<l.length;e+=1)l[e].c();(0,e.set_style)(n,"letter-spacing",p+"px"),(0,e.set_style)(n,"font-size",f+"px"),(0,e.set_style)(n,"font-weight",_),(0,e.set_style)(n,"font-style",y),(0,e.attr)(n,"class","svelte-niwj3w")},m(t,r){(0,e.insert)(t,n,r);for(let e=0;e<l.length;e+=1)l[e].m(n,null);a=!0},p(r,[i]){if(t=r,9&i){let r;for(o=t[3],r=0;r<o.length;r+=1){const a=s(t,o,r);l[r]?(l[r].p(a,i),(0,e.transition_in)(l[r],1)):(l[r]=u(a),l[r].c(),(0,e.transition_in)(l[r],1),l[r].m(n,null))}for((0,e.group_outros)(),r=o.length;r<l.length;r+=1)c(r);(0,e.check_outros)()}},i(s){if(!a){for(let t=0;t<o.length;t+=1)(0,e.transition_in)(l[t]);(0,e.add_render_callback)(()=>{i||(i=(0,e.create_bidirectional_transition)(n,r.fadeTransition,{opacity:1,y:t[2],endX:t[1],endY:t[2]},!0)),i.run(1)}),a=!0}},o(o){l=l.filter(Boolean);for(let t=0;t<l.length;t+=1)(0,e.transition_out)(l[t]);i||(i=(0,e.create_bidirectional_transition)(n,r.fadeTransition,{opacity:1,y:t[2],endX:t[1],endY:t[2]},!1)),i.run(0),a=!1},d(t){t&&(0,e.detach)(n),(0,e.destroy_each)(l,t),t&&i&&i.end()}}}const d=(0,n.default)(),f=18,p=.5,y="italic",_=300,h='"Enreal", sans-serif',g=5;let x=5;function w(){const e=document.createElement("canvas").getContext("2d");e.font=`${y} ${_} ${f}px ${h}`;const t=e.measureText(" ").width;null!=t&&t>0&&isFinite(t)&&(x=t+p)}function m(e,n,r){const a=(0,i.createEventDispatcher)();let{text:o=""}=n,{delay:l=0}=n,{duration:s=null}=n,{x:u=0}=n,{y:c=0}=n;const f=[];let p,y=[];return null!=s&&(p=setTimeout(()=>{a("kill")},s)),(0,i.onMount)(()=>()=>{clearTimeout(p)}),e.$$set=(e=>{"text"in e&&r(4,o=e.text),"delay"in e&&r(0,l=e.delay),"duration"in e&&r(5,s=e.duration),"x"in e&&r(1,u=e.x),"y"in e&&r(2,c=e.y)}),e.$$.update=(()=>{16&e.$$.dirty&&r(3,y=function(e=""){const n=2e3/e.length;return t.degToRad(0),e.split("").map((e,r)=>{const i=/\s/.test(e),[a,o]=d.insideCircle(10,f);return{value:i?" ":e,whitespace:i,angle:d.gaussian(0,t.degToRad(2)),delay:r*n+d.gaussian(0,1),duration:d.range(1500,2e3),x:a,y:o}})}(o))}),[l,u,c,y,o,s]}document.fonts.ready.then(()=>{w()});class v extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,m,c,e.safe_not_equal,{text:4,delay:0,duration:5,x:1,y:2})}}var b=v;exports.default=b;
},{"svelte/internal":"xeIE","../util/math":"Ov1X","../util/Random":"LMfK","../animations/transitions":"bvJy","svelte":"XHT5"}],"jSXq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=require("svelte/transition"),n=require("svelte"),r=require("../alec-svelte"),o=c(require("../tags")),a=l(require("../config")),i=l(require("../components/AnimatedTextSpan.svelte")),u=require("../animations/transitions"),s=l(require("../components/LeafVideo.svelte"));function l(e){return e&&e.__esModule?e:{default:e}}function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}function c(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(r,a,i):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function f(t){let n,r,o,a,i;return r=new s.default({props:{fadeInOptions:{delay:0,duration:500},fadeOutOptions:{delay:0,duration:500}}}),{c(){n=(0,e.element)("div"),(0,e.create_component)(r.$$.fragment),(0,e.attr)(n,"class","container svelte-xjm3ff")},m(t,o){(0,e.insert)(t,n,o),(0,e.mount_component)(r,n,null),i=!0},p:e.noop,i(t){i||((0,e.transition_in)(r.$$.fragment,t),(0,e.add_render_callback)(()=>{a&&a.end(1),o||(o=(0,e.create_in_transition)(n,u.fadeInTransition,{y:0,delay:0,duration:1e3})),o.start()}),i=!0)},o(t){(0,e.transition_out)(r.$$.fragment,t),o&&o.invalidate(),a=(0,e.create_out_transition)(n,u.fadeInTransition,{y:0,delay:0,duration:1e3}),i=!1},d(t){t&&(0,e.detach)(n),(0,e.destroy_component)(r),t&&a&&a.end()}}}const p=0;function m(e){let t;return(0,n.onMount)(()=>()=>{}),(0,n.onMount)(()=>{console.log("mount transition!"),t=setTimeout(()=>{console.log("do world swap!");const e=world.findEntity(o.TransitionToNextBiome);e&&!(0,a.default)().demo&&e.add(o.SafeToSwapBiomes)},1250)}),[]}class v extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,m,f,e.safe_not_equal,{})}}var _=v;exports.default=_;
},{"svelte/internal":"xeIE","svelte/transition":"ly0Q","svelte":"XHT5","../alec-svelte":"M3eo","../tags":"injP","../config":"nZps","../components/AnimatedTextSpan.svelte":"FmP3","../animations/transitions":"bvJy","../components/LeafVideo.svelte":"wegv"}],"qmNA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("svelte/internal"),e=g(require("./GamePageLanding.svelte")),n=g(require("./About.svelte")),o=g(require("../config")),r=g(require("./HaikuPopup.svelte")),i=g(require("./PoemCollectionOverlay.svelte")),a=g(require("./SimpleHintOverlay.svelte")),u=g(require("./GameHUD.svelte")),s=g(require("./GameUIIntro.svelte")),c=require("svelte"),l=g(require("./TransitionOverlay.svelte")),p=require("three"),m=require("../nfb"),d=require("../alec-svelte"),_=$(require("../tags"));function f(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(f=function(t){return t?n:e})(t)}function $(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=f(e);if(n&&n.has(t))return n.get(t);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if("default"!==i&&Object.prototype.hasOwnProperty.call(t,i)){var a=r?Object.getOwnPropertyDescriptor(t,i):null;a&&(a.get||a.set)?Object.defineProperty(o,i,a):o[i]=t[i]}return o.default=t,n&&n.set(t,o),o}function g(t){return t&&t.__esModule?t:{default:t}}function v(e){let n,o;return(n=new u.default({props:{moving:e[11],canCollectTokens:e[10],finishedHaikus:e[8],store:e[0],currentHaiku:e[2]}})).$on("journal",e[16]),n.$on("pause",e[17]),{c(){(0,t.create_component)(n.$$.fragment)},m(e,r){(0,t.mount_component)(n,e,r),o=!0},p(t,e){const o={};2048&e&&(o.moving=t[11]),1024&e&&(o.canCollectTokens=t[10]),256&e&&(o.finishedHaikus=t[8]),1&e&&(o.store=t[0]),4&e&&(o.currentHaiku=t[2]),n.$set(o)},i(e){o||((0,t.transition_in)(n.$$.fragment,e),o=!0)},o(e){(0,t.transition_out)(n.$$.fragment,e),o=!1},d(e){(0,t.destroy_component)(n,e)}}}function y(e){let n,o,r=e[2]&&w(e);return{c(){r&&r.c(),n=(0,t.empty)()},m(e,i){r&&r.m(e,i),(0,t.insert)(e,n,i),o=!0},p(e,o){e[2]?r?(r.p(e,o),4&o&&(0,t.transition_in)(r,1)):((r=w(e)).c(),(0,t.transition_in)(r,1),r.m(n.parentNode,n)):r&&((0,t.group_outros)(),(0,t.transition_out)(r,1,1,()=>{r=null}),(0,t.check_outros)())},i(e){o||((0,t.transition_in)(r),o=!0)},o(e){(0,t.transition_out)(r),o=!1},d(e){r&&r.d(e),e&&(0,t.detach)(n)}}}function k(e){let n,o;return(n=new i.default({props:{poems:e[8]}})).$on("close",e[22]),{c(){(0,t.create_component)(n.$$.fragment)},m(e,r){(0,t.mount_component)(n,e,r),o=!0},p(t,e){const o={};256&e&&(o.poems=t[8]),n.$set(o)},i(e){o||((0,t.transition_in)(n.$$.fragment,e),o=!0)},o(e){(0,t.transition_out)(n.$$.fragment,e),o=!1},d(e){(0,t.destroy_component)(n,e)}}}function h(e){let n,o,r,i;const a=[H,O],u=[];function s(t,e){return t[13]?0:1}return n=s(e),o=u[n]=a[n](e),{c(){o.c(),r=(0,t.empty)()},m(e,o){u[n].m(e,o),(0,t.insert)(e,r,o),i=!0},p(e,i){let c=n;(n=s(e))===c?u[n].p(e,i):((0,t.group_outros)(),(0,t.transition_out)(u[c],1,1,()=>{u[c]=null}),(0,t.check_outros)(),(o=u[n])?o.p(e,i):(o=u[n]=a[n](e)).c(),(0,t.transition_in)(o,1),o.m(r.parentNode,r))},i(e){i||((0,t.transition_in)(o),i=!0)},o(e){(0,t.transition_out)(o),i=!1},d(e){u[n].d(e),e&&(0,t.detach)(r)}}}function b(e){let n,o;return n=new l.default({}),{c(){(0,t.create_component)(n.$$.fragment)},m(e,r){(0,t.mount_component)(n,e,r),o=!0},p:t.noop,i(e){o||((0,t.transition_in)(n.$$.fragment,e),o=!0)},o(e){(0,t.transition_out)(n.$$.fragment,e),o=!1},d(e){(0,t.destroy_component)(n,e)}}}function q(e){let n;return{c(){n=(0,t.element)("div")},m(e,o){(0,t.insert)(e,n,o)},p:t.noop,i:t.noop,o:t.noop,d(e){e&&(0,t.detach)(n)}}}function w(e){let n,o;return(n=new r.default({props:{store:e[0],lines:e[2].lines,tokens:e[2].tokens}})).$on("close",e[14]),{c(){(0,t.create_component)(n.$$.fragment)},m(e,r){(0,t.mount_component)(n,e,r),o=!0},p(t,e){const o={};1&e&&(o.store=t[0]),4&e&&(o.lines=t[2].lines),4&e&&(o.tokens=t[2].tokens),n.$set(o)},i(e){o||((0,t.transition_in)(n.$$.fragment,e),o=!0)},o(e){(0,t.transition_out)(n.$$.fragment,e),o=!1},d(e){(0,t.destroy_component)(n,e)}}}function O(n){let o,r;return(o=new e.default({props:{start:!n[5],endState:n[6],introTitle:n[12],poems:n[8]}})).$on("play",n[20]),o.$on("journal",M),o.$on("about",n[21]),{c(){(0,t.create_component)(o.$$.fragment)},m(e,n){(0,t.mount_component)(o,e,n),r=!0},p(t,e){const n={};32&e&&(n.start=!t[5]),64&e&&(n.endState=t[6]),4096&e&&(n.introTitle=t[12]),256&e&&(n.poems=t[8]),o.$set(n)},i(e){r||((0,t.transition_in)(o.$$.fragment,e),r=!0)},o(e){(0,t.transition_out)(o.$$.fragment,e),r=!1},d(e){(0,t.destroy_component)(o,e)}}}function H(e){let n,o;return(n=new s.default({})).$on("inbetween",e[18]),n.$on("end",e[19]),{c(){(0,t.create_component)(n.$$.fragment)},m(e,r){(0,t.mount_component)(n,e,r),o=!0},p:t.noop,i(e){o||((0,t.transition_in)(n.$$.fragment,e),o=!0)},o(e){(0,t.transition_out)(n.$$.fragment,e),o=!1},d(e){(0,t.destroy_component)(n,e)}}}function T(e){let o,r;return(o=new n.default({})).$on("close",e[23]),{c(){(0,t.create_component)(o.$$.fragment)},m(e,n){(0,t.mount_component)(o,e,n),r=!0},p:t.noop,i(e){r||((0,t.transition_in)(o.$$.fragment,e),r=!0)},o(e){(0,t.transition_out)(o.$$.fragment,e),r=!1},d(e){(0,t.destroy_component)(o,e)}}}function j(e){let n,o,r,i,a,u,s=!e[1]&&!e[9]&&!e[3]&&!e[7]&&!e[4]&&v(e);const c=[q,b,h,k,y],l=[];function p(t,e){return t[1]?0:t[7]?1:"landing"===t[4]||"about"===t[4]?2:"journal"===t[4]?3:null==t[4]?4:-1}~(o=p(e))&&(r=l[o]=c[o](e));let m="about"===e[4]&&T(e);return{c(){s&&s.c(),n=(0,t.space)(),r&&r.c(),i=(0,t.space)(),m&&m.c(),a=(0,t.empty)()},m(e,r){s&&s.m(e,r),(0,t.insert)(e,n,r),~o&&l[o].m(e,r),(0,t.insert)(e,i,r),m&&m.m(e,r),(0,t.insert)(e,a,r),u=!0},p(e,[u]){e[1]||e[9]||e[3]||e[7]||e[4]?s&&((0,t.group_outros)(),(0,t.transition_out)(s,1,1,()=>{s=null}),(0,t.check_outros)()):s?(s.p(e,u),666&u&&(0,t.transition_in)(s,1)):((s=v(e)).c(),(0,t.transition_in)(s,1),s.m(n.parentNode,n));let d=o;(o=p(e))===d?~o&&l[o].p(e,u):(r&&((0,t.group_outros)(),(0,t.transition_out)(l[d],1,1,()=>{l[d]=null}),(0,t.check_outros)()),~o?((r=l[o])?r.p(e,u):(r=l[o]=c[o](e)).c(),(0,t.transition_in)(r,1),r.m(i.parentNode,i)):r=null),"about"===e[4]?m?(m.p(e,u),16&u&&(0,t.transition_in)(m,1)):((m=T(e)).c(),(0,t.transition_in)(m,1),m.m(a.parentNode,a)):m&&((0,t.group_outros)(),(0,t.transition_out)(m,1,1,()=>{m=null}),(0,t.check_outros)())},i(e){u||((0,t.transition_in)(s),(0,t.transition_in)(r),(0,t.transition_in)(m),u=!0)},o(e){(0,t.transition_out)(s),(0,t.transition_out)(r),(0,t.transition_out)(m),u=!1},d(e){s&&s.d(e),e&&(0,t.detach)(n),~o&&l[o].d(e),e&&(0,t.detach)(i),m&&m.d(e),e&&(0,t.detach)(a)}}}const P=1e4,C=3500,M=()=>{};function x(t,e,n){let{store:r}=e;const{entity:i}=(0,d.context)();let a,u,s,l,p,_,f,$,g,v,y,k,h,b,q=!1,w=!1;const O=r.subscribe(t=>{n(1,a=t.embed),n(13,w=t.intro),n(12,q=t.introTitle),n(4,p=t.state),n(5,_=t.pause),n(6,f=t.endState),y=t.isButtonHovered,n(3,l=t.resolving),n(8,g=t.finishedHaikus),n(10,h=t.canCollectTokens),n(9,k=t.hideHUD),n(11,b=t.moving);t.moving&&v&&r.update(t=>({...t,hint:null})),!p&&q&&r.update(t=>({...t,introTitle:!1})),v=t.hint;const e=$;n(7,$=t.transitionOverlay),e!==$&&$&&((0,o.default)().demo||(clearTimeout(s),s=setTimeout(()=>{r.update(t=>({...t,transitionOverlay:!1}))},C)));n(2,u=t.newlyCollectedHaiku),l&&n(2,u=null);const i=!p;i!==t.active&&r.update(t=>({...t,active:i}))});function H(t,e={}){r.update(n=>({...n,...e,state:t}))}(0,c.onDestroy)(()=>{O(),clearTimeout(s)});return t.$$set=(t=>{"store"in t&&n(0,r=t.store)}),[r,a,u,l,p,_,f,$,g,k,h,b,q,w,function(){(0,m.sendAnalytics)({event:"poem_collect",eventLabel:"poem_collect"}),r.update(t=>({...t,playing:!0,newlyCollectedHaiku:null}))},H,()=>{H("journal")},()=>{H("landing",{pause:!0})},()=>{r.update(t=>({...t,initGame:!0}))},()=>{r.update(t=>({...t,introTitle:!0,intro:!1}))},()=>{(0,m.hideHeader)(),H(null),r.update(t=>({...t,playing:!0}))},()=>{(0,m.sendAnalytics)({pageview:"about"}),H("about")},()=>H(null),()=>{H("landing")}]}class D extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,x,j,t.safe_not_equal,{store:0})}}var N=D;exports.default=N;
},{"svelte/internal":"xeIE","./GamePageLanding.svelte":"FIbM","./About.svelte":"LoO6","../config":"nZps","./HaikuPopup.svelte":"orPd","./PoemCollectionOverlay.svelte":"vNhw","./SimpleHintOverlay.svelte":"uJX9","./GameHUD.svelte":"VCLG","./GameUIIntro.svelte":"kspl","svelte":"XHT5","./TransitionOverlay.svelte":"jSXq","three":"IV0r","../nfb":"Xlf9","../alec-svelte":"M3eo","../tags":"injP"}],"YKgE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=s(require("../overlays/GamePages.svelte")),t=l(require("../tags")),n=require("svelte/store"),a=s(require("../util/query-string")),o=s(require("../config")),i=require("../nfb");function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var l=o?Object.getOwnPropertyDescriptor(e,i):null;l&&(l.get||l.set)?Object.defineProperty(a,i,l):a[i]=e[i]}return a.default=e,n&&n.set(e,a),a}function s(e){return e&&e.__esModule?e:{default:e}}function u(r,l={}){const{readyToInitialize:s,readyToShowEngine:u}=l,d=!a.default.nolanding,c=!a.default.nocard,f=d?"landing":null,g=(0,o.default)().embed,p=g?null:a.default.initial?a.default.initial:f,m=!a.default.nointro,v=r.view(t.LetterboxBars),k=r.listen([t.EndGameState,t.ResetToCameraDrift]);let O=null;const h=(0,n.writable)({initGame:!(m&&!g),state:p,active:!0,embed:g,pause:!1,hint:null,notifyHaiku:!1,endState:!1,moving:!1,letterboxes:!1,isButtonHovered:!1,isButtonClicked:!1,canCollectTokens:O,tokensCollected:[],finishedHaikus:[],poem:[],playing:!1,haikusCollected:0,haikusTotal:3,newlyCollectedHaiku:null,transitionOverlay:null,transitionCurrentBiome:null,resolving:!1,hideHUD:!0,intro:m&&!g});r.tag(t.GameUIStore,h),window.setUIData=(e=>{h.update(t=>({...t,...e}))}),window.toggleOpenJournal=function(){h.update(e=>("journal"!=e.state?e.state="journal":e.state=null,e))},window.setPoemText=function(e,t,n){h.update(a=>(a.poem=[e,t,n],a.tokensCollected=["sun","rain","snow"],a))};const y=r.entity().add(t.ViewLayer,{id:"game-pages",component:e.default,props:{store:h}}),C=r.entity();let w=!1,T=null,B=!1,H=null,S=!1,b=!1,P=!0,U=!1;const x=r.entity();h.subscribe(e=>{if(w=Boolean(e.active),e.state||B||(B=!0,C.has(t.GameStarted)||(C.add(t.GameStarted),C.add(t.ClearInputPress),(0,i.startButtonTracking)(),(0,i.sendAnalytics)({event:"main",eventLabel:"start"}),(0,i.sendTrackingPixel)()),h.update(e=>({...e,initGame:!0,intro:!1}))),w!==T&&(T=w,w?(y.tagOff(t.CameraStopUserMovement),y.tagOff(t.LetterboxBars),y.tagOff(t.CameraZoomOut),h.update(e=>({...e,playing:!0}))):(y.tagOn(t.CameraStopUserMovement),y.tagOn(t.LetterboxBars),y.tagOn(t.CameraZoomOut),h.update(e=>({...e,playing:!1})))),e.playing?y.tagOff(t.IsGameUIActive):y.tagOn(t.IsGameUIActive),"journal"===e.state!==C.has(t.JournalOpen)&&(C.has(t.JournalOpen)?C.remove(t.JournalOpen):C.add(t.JournalOpen)),Boolean(e.state)!==y.has(t.PauseOpen)&&(y.has(t.PauseOpen)?y.remove(t.PauseOpen):y.add(t.PauseOpen)),e.isButtonHovered?y.add(t.ButtonHover):y.remove(t.ButtonHover),e.initGame&&!S&&(S=!0,s&&s()),e.intro===H||e.intro||(H=e.intro,u&&u()),U!==e.newlyCollectedHaiku){let n=U;(U=e.newlyCollectedHaiku)?(x.tagOn(t.BlockUserMove),x.tagOn(t.LetterboxBars),x.tagOn(t.CameraZoomOut)):(x.tagOff(t.BlockUserMove),x.tagOff(t.LetterboxBars),x.tagOff(t.CameraZoomOut)),c&&(U&&!n?x.tagOn(t.HaikuCardShown):x.tagOff(t.HaikuCardShown),!U&&n?(e.onNotifyHaiku&&e.onNotifyHaiku(),x.tagOn(t.HaikuCardSaved)):x.tagOff(t.HaikuCardSaved))}b=e.letterboxes,P=e.hideHUD});const I=r.listen([t.EnvironmentState,t.ActiveEnvironmentState]),G=r.view([t.EnvironmentState,t.ActiveEnvironmentState]),M=(r.view(t.CollectedToken),r.listen(t.CollectedToken)),j=(r.view(t.FinishedPoem),r.listen([t.FinishedPoem,t.HaikuInInventory])),q=r.listen(t.FinishedPoem),D=r.view(t.FinishedPoem),E=r.view(t.HaikuInInventory);let A=null,F=!1,L=!1;return function(e){r.findTag(t.AppState).ready,k.added.length>0&&h.update(e=>({...e,pause:!0,endState:!0,state:"landing"}));const n=r.findTag(t.UserTarget),a=n&&n.forceApplied;a!==A&&(h.update(e=>({...e,moving:a})),A=a);const o=v.length>0;b!==o&&(h.update(e=>({...e,letterboxes:o})),b=o);const i=!C.has(t.GameStarted)||Boolean(r.findTag(t.HideHUD));if(P!==i&&(h.update(e=>({...e,hideHUD:i})),P=i),I.changed&&G.length>0){const e=G[0].get(t.EnvironmentState);h.update(t=>({...t,haikusTotal:e.haikusTotal}))}if(M.changed){const e=M.query.entities.map(e=>e.get(t.CollectedToken).type);h.update(t=>({...t,tokensCollected:e}))}const l=Boolean(r.findTag(t.DirectUserToOrigin)),s=Boolean(r.findTag(t.CameraStopUserMovement)),u=Boolean(r.findTag(t.BlockTokenCollection)),d=!s&&!l&&!u;d!==O&&(O=d,h.update(e=>({...e,canCollectTokens:O})));const f=Boolean(r.findTag(t.ShowBiomeResolution));f!==L&&(h.update(e=>({...e,resolving:f})),L=f);const g=Boolean(r.findTag(t.TransitionToNextBiome));if(g!==F){const e=G.length?G[0].get(t.EnvironmentState).name:null;g&&"tundra"!==e&&h.update(t=>({...t,transitionOverlay:!0,transitionCurrentBiome:e})),F=g}if(j.changed&&j.added.length>0){const e=j.added[0].get(t.FinishedPoem);j.query.entities.map(e=>{const n=e.get(t.FinishedPoem);return{tokens:n.tokens.slice(),lines:n.lines.slice()}});h.update(t=>({...t,newlyCollectedHaiku:!!c&&{tokens:e.tokens.slice(),lines:e.lines.slice()}}))}if(q.changed){const e=D.map(e=>{const n=e.get(t.FinishedPoem);return{tokens:n.tokens.slice(),lines:n.lines.slice()}});h.update(t=>({...t,finishedHaikus:e}))}j.changed&&h.update(e=>({...e,haikusCollected:E.length}))}}
},{"../overlays/GamePages.svelte":"qmNA","../tags":"injP","svelte/store":"nBdo","../util/query-string":"Bj6B","../config":"nZps","../nfb":"Xlf9"}],"HAjB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=function(){var t=0,l=document.createElement("div");function n(e){return l.appendChild(e.dom),e}function a(e){for(var n=0;n<l.children.length;n++)l.children[n].style.display=n===e?"block":"none";t=e}l.style.cssText="position:absolute;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",l.addEventListener("click",function(e){e.preventDefault(),a(++t%l.children.length)},!1);var i=(performance||Date).now(),o=i,r=0,d=n(new e.Panel("FPS","#0ff","#002")),c=n(new e.Panel("MS","#0f0","#020"));return a(0),{REVISION:16,dom:l,addPanel:n,showPanel:a,begin:function(){i=(performance||Date).now()},end:function(){r++;var e=(performance||Date).now();return c.update(e-i,200),e>=o+1e3&&(d.update(1e3*r/(e-o),100),o=e,r=0),e},update:function(){i=this.end()},domElement:l,setMode:a}};e.Panel=function(e,t,l){var n=1/0,a=0,i=Math.round,o=i(window.devicePixelRatio||1),r=80*o,d=48*o,c=3*o,f=2*o,u=3*o,p=15*o,s=74*o,h=30*o,v=document.createElement("canvas");v.width=r,v.height=d,v.style.cssText="width:80px;height:48px";var m=v.getContext("2d");return m.font="bold "+9*o+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=l,m.fillRect(0,0,r,d),m.fillStyle=t,m.fillText(e,c,f),m.fillRect(u,p,s,h),m.fillStyle=l,m.globalAlpha=.9,m.fillRect(u,p,s,h),{dom:v,update:function(d,x){n=Math.min(n,d),a=Math.max(a,d),m.fillStyle=l,m.globalAlpha=1,m.fillRect(0,0,r,p),m.fillStyle=t,m.fillText(i(d)+" "+e+" ("+i(n)+"-"+i(a)+")",c,f),m.drawImage(v,u+o,p,s-o,h,u,p,s-o,h),m.fillRect(u+s-o,p,o,h),m.fillStyle=l,m.globalAlpha=.9,m.fillRect(u+s-o,p,o,i((1-d/x)*h))}}};var t=e;exports.default=t;
},{}],"jfyy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),n=require("svelte");function t(n){let t;return{c(){(t=(0,e.element)("div")).innerHTML='<div class="test"></div>',(0,e.attr)(t,"class","canvas-container svelte-146xou4")},m(i,o){(0,e.insert)(i,t,o),n[6](t)},p:e.noop,d(i){i&&(0,e.detach)(t),n[6](null)}}}function i(n){let i,o=!n[0]&&t(n);return{c(){o&&o.c(),i=(0,e.empty)()},m(n,t){o&&o.m(n,t),(0,e.insert)(n,i,t)},p(e,[n]){e[0]?o&&(o.d(1),o=null):o?o.p(e,n):((o=t(e)).c(),o.m(i.parentNode,i))},i:e.noop,o:e.noop,d(n){o&&o.d(n),n&&(0,e.detach)(i)}}}function o(t,i,o){let s,r,{canvas:a}=i,{resize:d}=i,{stats:c}=i,{parent:u}=i,{embed:l=!1}=i;u&&(s=u),void 0!==window.ResizeObserver&&(r=new window.ResizeObserver(e=>{h()}));const v=/(iOS|iPhone|iPad|iPod)/i.test(navigator.userAgent);function p(){v&&setTimeout(()=>{window.scrollTo(0,0),document.documentElement.style.height=`${window.innerHeight}px`,h(),setTimeout(()=>{document.documentElement.style.height="100%",h()},500)},500),h()}function m(){document.documentElement.style.height=`${window.innerHeight}px`,window.scrollTo(0,0),h()}function h(){if("function"==typeof d){const e=l?s.getBoundingClientRect():null,n=l?e.width:window.innerWidth,t=l?e.height:window.innerHeight;d(Math.round(n),Math.round(t))}}return v&&(document.onselectstart=function(){return!1},document.addEventListener("touchmove",function(e){1!==e.scale&&e.preventDefault()},{passive:!1})),(0,n.afterUpdate)(()=>{}),(0,n.onMount)(()=>(a&&(l&&a.parentElement||s.appendChild(a)),c&&s.appendChild(c),v&&(p(),setTimeout(()=>{p()},500)),h(),r&&r.observe(s),window.addEventListener("resize",m,{passive:!0}),window.addEventListener("orientationchange",p,{passive:!0}),()=>{a&&a.parentElement===s&&a.parentElement.removeChild(a),r&&r.unobserve(s),window.removeEventListener("resize",h),window.removeEventListener("orientationchange",p)})),t.$$set=(e=>{"canvas"in e&&o(2,a=e.canvas),"resize"in e&&o(3,d=e.resize),"stats"in e&&o(4,c=e.stats),"parent"in e&&o(0,u=e.parent),"embed"in e&&o(5,l=e.embed)}),[u,s,a,d,c,l,function(n){e.binding_callbacks[n?"unshift":"push"](()=>{o(1,s=n)})}]}class s extends e.SvelteComponent{constructor(n){super(),(0,e.init)(this,n,o,i,e.safe_not_equal,{canvas:2,resize:3,stats:4,parent:0,embed:5})}}var r=s;exports.default=r;
},{"svelte/internal":"xeIE","svelte":"XHT5"}],"krcB":[function(require,module,exports) {
"use strict";async function e(){let e;try{e=await window.showDirectoryPicker()}catch(r){if(console.error(r),20===r.code||"AbortError"===r.name)return null;throw r}return async(r,a,n)=>{const o=r.toDataURL("image/png"),i=String(n).length,c=`${String(a).padStart(i,"0")}.png`,l=await e.getFileHandle(c,{create:!0}),s=await l.createWritable();let w=t(o);await s.write(w),await s.close()}}function t(e){const t=e.indexOf(",");if(-1===t)return new Blob;const r=e.slice(t+1),a=atob(r),n=e.slice(0,t),o=/data:([^;]+)/.exec(n),i=(o?o[1]:"")||void 0,c=new ArrayBuffer(a.length),l=new Uint8Array(c);for(var s=0;s<a.length;s++)l[s]=a.charCodeAt(s);return new Blob([c],{type:i})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"YlL4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=m;var e=f(require("../tags")),t=f(require("three")),n=u(require("../util/Stats.js")),a=u(require("../util/documentVisibility")),o=u(require("../components/Canvas.svelte")),r=u(require("../config")),i=u(require("right-now")),l=u(require("../util/frame-sequence")),s=require("../util/addFrameTasks"),c=u(require("../util/query-string"));function u(e){return e&&e.__esModule?e:{default:e}}function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var i=o?Object.getOwnPropertyDescriptor(e,r):null;i&&(i.get||i.set)?Object.defineProperty(a,r,i):a[r]=e[r]}return a.default=e,n&&n.set(e,a),a}function p(e){t.Texture.prototype.clone=function(t){const n=(new this.constructor).copy(this),a=e.properties.get(this),o=e.properties.get(n);return Object.assign(o,a),n}}function m(n,{context:u}){n.system.info({hidden:!0}),u||console.error("Could not load context"),console.log("[renderer] Creating WebGL");const d=new t.WebGLRenderer({canvas:u?u.canvas:void 0,context:u}),f=(0,r.default)(),m=d.domElement;c.default.fps;d.setClearColor("#130904");const g=c.default.debug;let w;d.debug.checkShaderErrors=g,p(d);const h=new t.Scene;h.name="MainScene";const v=new t.PerspectiveCamera(30,1,.1,500);v.name="MainCamera",v.position.set(2,2,-2),v.lookAt(new t.Vector3);let y=!1;const M=e=>{const t=e.toDataURL("image/png"),n=document.createElement("a");n.download=Date.now()+".png",n.href=t,n.click()};if(c.default.promo){const t=async()=>{const e=Math.ceil(120);let t=await(0,l.default)();const n=Array(e).fill().map((e,t)=>t);for(let a of n)oe(1/24),console.log("Frame %d / %d",a+1,e),await t(m,a,e),await new Promise(e=>requestAnimationFrame(e));console.log("Done"),te()};window.drift=function(){const t=n.entity();t.tagOn(e.GameLandingCameraDrift),t.tagOn(e.BlockTokenCollection),t.tagOn(e.HideCharacter),t.tagOn(e.HideHUD),t.tagOn(e.BlockUserMove),t.tagOn(e.CameraStopUserMovement),t.tagOn(e.ModalStoppingUserMovement)},window.addEventListener("keydown",e=>{"s"===e.key.toLowerCase()&&(e.metaKey||e.ctrlKey)?(e.preventDefault(),y=!0):"k"===e.key.toLowerCase()&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),ne(),t())})}let C=(0,i.default)(),b=(0,i.default)(),O=0;const k=n.listen(e.IsGameUIActive),x=n.view(e.TransitionToNextBiome),q=n.view(e.ShowBiomeResolution),S=n.view(e.GameStarted),D=n.listen(e.TransitionToNextBiome),P=n.view(e.GameLandingCameraDrift),j=n.listen(e.GameLandingCameraDrift),A=n.listen(e.ActiveEnvironmentState),L=n.listen(e.GameStarted);let T=2.5;const R=c.default.lowbattery?1:2,G=Math.min(R,window.devicePixelRatio),F=[...new Set(G<=1?[G]:[G,.75*G,G*(2/3),G*(5/8),1].filter(e=>e>=1))];let B=0;h.add(v);const U=n.entity("CanvasComponent").add(e.ViewLayer,{id:"canvas",component:o.default,props:{embed:f.embed,parent:f.container,canvas:m,resize:ee,stats:w?w.dom:null}}).add(e.Canvas,m).add(e.Renderer,d).add(e.MainScene,h).add(e.MainCamera,v).add(e.AppState),W=U.get(e.AppState);let _,E,H,K,z,N,V=!0,I=!0,J=2,Q=!1,X=!1,Y=(Boolean(c.default.lowbattery),null),Z=!1;const $=(e=T)=>{Z=!0,null!=Y&&clearTimeout(Y),Y=setTimeout(()=>{Z=!1,O=0,b=(0,i.default)()},1e3*T)};return(0,a.default)(e=>{e?te():ne()}),{get running(){return X},set running(e){X=e},process(e){A.changed&&(B>0&&B>F.length/2&&(B--,ee(_,E)),$()),(k.changed||j.changed||D.changed)&&$(),L.changed&&(B=0,ee(_,E),$())},show:function(){m.style.display="",I=!1,W.ready=!0},step:oe,dispose(){ne(),U.kill()}};function ee(e,t){const n=e!==_||t!==E;if(n){const n=_*E,a=e*t;a<=.5*(J=Math.max(J,a))?B=0:a<n&&B>F.length/2&&B--,$()}const a=null!=c.default.pixelRatio?c.default.pixelRatio:F[B],o=a!==H;o&&!n&&$(.5),o&&console.log("[resize] New density",a),(n||o)&&(_=e,E=t,H=a,K=Math.floor(_*H),z=Math.floor(E*H),X&&!I?V=!0:ae())}function te(){Q||(Q=!0,C=(0,i.default)(),N=window.requestAnimationFrame(re))}function ne(){null!=N&&(window.cancelAnimationFrame(N),N=null),Q&&(Q=!1)}function ae(){d.setPixelRatio(H),d.setSize(_,E),v.aspect=_/E,v.updateProjectionMatrix(),V=!1}function oe(e){let t=V;if(V&&ae(),W.width=_,W.height=E,W.pixelRatio=H,W.canvasWidth=K,W.canvasHeight=z,W.running||t){c.default.promo||(e=Math.min(e,.1));const t=(0,s.nextFrameTask)();t&&t(e),X&&(n.root.process(e),w&&w.update(),y&&(y=!1,M(m)))}}function re(e){if(!Q)return;N=window.requestAnimationFrame(re);let t=(e-C)/1e3;if(!Z&&(O++,(e-b)/1e3>=T)){const t=60*T-O,n=O/T;b=e,O=0;const a=S.length>0||P.length>0,o=x.length>0||q.length>0;if((n<=55||t>=10)&&a&&!o){const e=F[B];++B>F.length-1&&(B=F.length-1),e!==F[B]&&ee(_,E)}}C=e,oe(t)}}
},{"../tags":"injP","three":"IV0r","../util/Stats.js":"HAjB","../util/documentVisibility":"so68","../components/Canvas.svelte":"jfyy","../config":"nZps","right-now":"ksES","../util/frame-sequence":"krcB","../util/addFrameTasks":"l7a6","../util/query-string":"Bj6B"}],"KFJE":[function(require,module,exports) {
var define;
var r;!function(){"use strict";var t=.5*(Math.sqrt(3)-1),e=(3-Math.sqrt(3))/6,a=1/6,o=(Math.sqrt(5)-1)/4,i=(5-Math.sqrt(5))/20;function n(r){var t;t="function"==typeof r?r:r?function(){var r=0,t=0,e=0,a=1,o=(i=4022871197,function(r){r=r.toString();for(var t=0;t<r.length;t++){var e=.02519603282416938*(i+=r.charCodeAt(t));e-=i=e>>>0,i=(e*=i)>>>0,i+=4294967296*(e-=i)}return 2.3283064365386963e-10*(i>>>0)});var i;r=o(" "),t=o(" "),e=o(" ");for(var n=0;n<arguments.length;n++)(r-=o(arguments[n]))<0&&(r+=1),(t-=o(arguments[n]))<0&&(t+=1),(e-=o(arguments[n]))<0&&(e+=1);return o=null,function(){var o=2091639*r+2.3283064365386963e-10*a;return r=t,t=e,e=o-(a=0|o)}}(r):Math.random,this.p=f(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var e=0;e<512;e++)this.perm[e]=this.p[255&e],this.permMod12[e]=this.perm[e]%12}function f(r){var t,e=new Uint8Array(256);for(t=0;t<256;t++)e[t]=t;for(t=0;t<255;t++){var a=t+~~(r()*(256-t)),o=e[t];e[t]=e[a],e[a]=o}return e}n.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(r,a){var o,i,n=this.permMod12,f=this.perm,v=this.grad3,s=0,h=0,l=0,u=(r+a)*t,d=Math.floor(r+u),p=Math.floor(a+u),M=(d+p)*e,m=r-(d-M),c=a-(p-M);m>c?(o=1,i=0):(o=0,i=1);var y=m-o+e,w=c-i+e,g=m-1+2*e,A=c-1+2*e,x=255&d,q=255&p,D=.5-m*m-c*c;if(D>=0){var S=3*n[x+f[q]];s=(D*=D)*D*(v[S]*m+v[S+1]*c)}var U=.5-y*y-w*w;if(U>=0){var b=3*n[x+o+f[q+i]];h=(U*=U)*U*(v[b]*y+v[b+1]*w)}var F=.5-g*g-A*A;if(F>=0){var N=3*n[x+1+f[q+1]];l=(F*=F)*F*(v[N]*g+v[N+1]*A)}return 70*(s+h+l)},noise3D:function(r,t,e){var o,i,n,f,v,s,h,l,u,d,p=this.permMod12,M=this.perm,m=this.grad3,c=(r+t+e)*(1/3),y=Math.floor(r+c),w=Math.floor(t+c),g=Math.floor(e+c),A=(y+w+g)*a,x=r-(y-A),q=t-(w-A),D=e-(g-A);x>=q?q>=D?(v=1,s=0,h=0,l=1,u=1,d=0):x>=D?(v=1,s=0,h=0,l=1,u=0,d=1):(v=0,s=0,h=1,l=1,u=0,d=1):q<D?(v=0,s=0,h=1,l=0,u=1,d=1):x<D?(v=0,s=1,h=0,l=0,u=1,d=1):(v=0,s=1,h=0,l=1,u=1,d=0);var S=x-v+a,U=q-s+a,b=D-h+a,F=x-l+2*a,N=q-u+2*a,C=D-d+2*a,P=x-1+.5,T=q-1+.5,_=D-1+.5,j=255&y,k=255&w,z=255&g,B=.6-x*x-q*q-D*D;if(B<0)o=0;else{var E=3*p[j+M[k+M[z]]];o=(B*=B)*B*(m[E]*x+m[E+1]*q+m[E+2]*D)}var G=.6-S*S-U*U-b*b;if(G<0)i=0;else{var H=3*p[j+v+M[k+s+M[z+h]]];i=(G*=G)*G*(m[H]*S+m[H+1]*U+m[H+2]*b)}var I=.6-F*F-N*N-C*C;if(I<0)n=0;else{var J=3*p[j+l+M[k+u+M[z+d]]];n=(I*=I)*I*(m[J]*F+m[J+1]*N+m[J+2]*C)}var K=.6-P*P-T*T-_*_;if(K<0)f=0;else{var L=3*p[j+1+M[k+1+M[z+1]]];f=(K*=K)*K*(m[L]*P+m[L+1]*T+m[L+2]*_)}return 32*(o+i+n+f)},noise4D:function(r,t,e,a){var n,f,v,s,h,l,u,d,p,M,m,c,y,w,g,A,x,q=this.perm,D=this.grad4,S=(r+t+e+a)*o,U=Math.floor(r+S),b=Math.floor(t+S),F=Math.floor(e+S),N=Math.floor(a+S),C=(U+b+F+N)*i,P=r-(U-C),T=t-(b-C),_=e-(F-C),j=a-(N-C),k=0,z=0,B=0,E=0;P>T?k++:z++,P>_?k++:B++,P>j?k++:E++,T>_?z++:B++,T>j?z++:E++,_>j?B++:E++;var G=P-(l=k>=3?1:0)+i,H=T-(u=z>=3?1:0)+i,I=_-(d=B>=3?1:0)+i,J=j-(p=E>=3?1:0)+i,K=P-(M=k>=2?1:0)+2*i,L=T-(m=z>=2?1:0)+2*i,O=_-(c=B>=2?1:0)+2*i,Q=j-(y=E>=2?1:0)+2*i,R=P-(w=k>=1?1:0)+3*i,V=T-(g=z>=1?1:0)+3*i,W=_-(A=B>=1?1:0)+3*i,X=j-(x=E>=1?1:0)+3*i,Y=P-1+4*i,Z=T-1+4*i,$=_-1+4*i,rr=j-1+4*i,tr=255&U,er=255&b,ar=255&F,or=255&N,ir=.6-P*P-T*T-_*_-j*j;if(ir<0)n=0;else{var nr=q[tr+q[er+q[ar+q[or]]]]%32*4;n=(ir*=ir)*ir*(D[nr]*P+D[nr+1]*T+D[nr+2]*_+D[nr+3]*j)}var fr=.6-G*G-H*H-I*I-J*J;if(fr<0)f=0;else{var vr=q[tr+l+q[er+u+q[ar+d+q[or+p]]]]%32*4;f=(fr*=fr)*fr*(D[vr]*G+D[vr+1]*H+D[vr+2]*I+D[vr+3]*J)}var sr=.6-K*K-L*L-O*O-Q*Q;if(sr<0)v=0;else{var hr=q[tr+M+q[er+m+q[ar+c+q[or+y]]]]%32*4;v=(sr*=sr)*sr*(D[hr]*K+D[hr+1]*L+D[hr+2]*O+D[hr+3]*Q)}var lr=.6-R*R-V*V-W*W-X*X;if(lr<0)s=0;else{var ur=q[tr+w+q[er+g+q[ar+A+q[or+x]]]]%32*4;s=(lr*=lr)*lr*(D[ur]*R+D[ur+1]*V+D[ur+2]*W+D[ur+3]*X)}var dr=.6-Y*Y-Z*Z-$*$-rr*rr;if(dr<0)h=0;else{var pr=q[tr+1+q[er+1+q[ar+1+q[or+1]]]]%32*4;h=(dr*=dr)*dr*(D[pr]*Y+D[pr+1]*Z+D[pr+2]*$+D[pr+3]*rr)}return 27*(n+f+v+s+h)}},n._buildPermutationTable=f,void 0!==r&&r.amd&&r(function(){return n}),"undefined"!=typeof exports?exports.SimplexNoise=n:"undefined"!=typeof window&&(window.SimplexNoise=n),"undefined"!=typeof module&&(module.exports=n)}();
},{}],"KTkA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=d;var e=f(require("../tags")),t=f(require("three")),o=require("../util/tokens"),n=c(require("../util/Assets")),a=f(require("../util/math")),i=c(require("../util/Random")),r=c(require("simplex-noise")),l=f(require("../util/ShaderManager")),s=require("./AnimationSystem");function c(e){return e&&e.__esModule?e:{default:e}}function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(u=function(e){return e?o:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var o=u(t);if(o&&o.has(e))return o.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var r=a?Object.getOwnPropertyDescriptor(e,i):null;r&&(r.get||r.set)?Object.defineProperty(n,i,r):n[i]=e[i]}return n.default=e,o&&o.set(e,n),n}function d(c){const u=c.listen(e.HaikuCardSaved),f=c.listen(e.HaikuInInventory),d=c.view(e.WaitingForTokenPaper),p=c.view([e.Object3D,e.FloatingToken]),g=c.findTag(e.Renderer),v=new t.PlaneGeometry(1,1,4,4),m=new t.Vector3,y=new t.Vector2,D=new t.Vector2,T=[0,0,0],h=(0,i.default)(),x=new r.default(h.value),S=n.default.createGPUTexture(g,"image/data/floating-paper"),b=n.default.createGPUTexture(g,"image/data/floating-paper-lines"),k=new t.Vector2(0,0),O=c.listen([e.EnvironmentState,e.ActiveEnvironmentState]);let M={value:1};const F=c.listen(e.FinalBiomeResolution),w=c.listen([e.EndGameState,e.ResetToCameraDrift]);return function(i){c.findTag(e.UserTarget);const r=c.findTag(e.UserCharacter).position;y.set(r.x,r.z),F.added.length>0&&(0,s.tweenTo)(c,M,"value",0,1,"sineOut",2),w.added.length>0&&p.forEach(e=>e.kill()),O.changed&&p.forEach(t=>{t.has(e.FloatingTokenShouldTargetTree)&&(t.tagOff(e.FloatingTokenShouldTargetTree),t.tagOff(e.FloatingTokenTargetUser))}),f.added.forEach(t=>{c.entity().add(e.WaitingForTokenPaper)}),u.added.forEach(()=>{Promise.all([S,b]).then(([a,i])=>{d.forEach(s=>{s.remove(e.WaitingForTokenPaper);const c=o.InvertedTokenURLs[""],u=(n.default.urlToID(c),s.add(e.FloatingToken)),f=u.get(e.FloatingToken);u.tagOn(e.FloatingTokenTargetUser),f.type="",f.map=i;const d=function(o,n,a){const i=l.create({name:"TokenPaper",uniforms:{color:{value:new t.Color(1.1,1.1,1.1)},map:{value:a.map},backgroundMap:{value:n},mapScale:{value:1.25},time:{value:0},opacity:{value:1},timeOffset:{value:1}},side:t.DoubleSide,blending:t.CustomBlending,blendEquation:t.AddEquation,blendSrc:t.OneFactor,blendDst:t.OneMinusSrcAlphaFactor,transparent:!0,vertexShader:"\n        varying vec2 vUv;\n        uniform float mapScale;\n        uniform float timeOffset;\n        uniform float time;\n\n        mat3 rotation3dY(float angle) {\n        \tfloat s = sin(angle);\n        \tfloat c = cos(angle);\n\n        \treturn mat3(\n        \t\tc, 0.0, -s,\n        \t\t0.0, 1.0, 0.0,\n        \t\ts, 0.0, c\n        \t);\n        }\n\n        void main () {\n          vec2 nuv = uv * 2.0 - 1.0;\n          nuv *= mapScale;\n          vUv = nuv * 0.5 + 0.5;\n          vec3 transformed = position.xyz;\n          float angle = sin(time + timeOffset + position.x);\n          transformed *= rotation3dY(angle);\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(transformed, 1.0);\n        }\n      ",fragmentShader:"\n        varying vec2 vUv;\n        uniform sampler2D map;\n        uniform sampler2D backgroundMap;\n        uniform float opacity;\n        uniform vec3 color;\n\n        vec4 blend(vec4 background, vec4 foreground) {\n            return (foreground.rgba * foreground.a) + background.rgba * (1.0 - foreground.a);\n        }\n\n        void main () {\n          vec3 curColor = vec3(color);\n\n          vec4 outColor = texture2D(backgroundMap, vUv) * vec4(color, 1.0);\n          // vec4 outColor = vec4(color, 1.0);\n          vec4 fgColor = texture2D(map, vUv);\n          \n          // outColor.rgb *= 1.0 - fgColor.a;\n          // outColor = blend(outColor, fgColor);\n          gl_FragColor = vec4(outColor);\n          gl_FragColor.a *= opacity;\n          // if (gl_FragColor.a <= 0.1) discard;\n        }\n      "}),r=new t.Mesh(v,i);return r.scale.setScalar(1),o.add(e.Object3D,r),r}(u,a,f);d.position.copy(r),f.position2D.set(d.position.x,d.position.z),f.offsetHeight=h.range(1,3),f.offset3D.fromArray(h.insideSphere(.1,T)),f.rotationAxis.fromArray(h.insideSphere(1,T)),f.rotationSpeed=1,f.scale=.45,f.speed=h.range(.5,1.5),f.rotationAngleOffset=h.range(-1,1)*Math.PI*2})})});var g=15*Math.PI*15/1e4;const C=c.findTag(e.WaitingForBiomeResolution)||c.findTag(e.ShowBiomeResolution);p.forEach(t=>{const o=t.get(e.FloatingToken);let n=t.has(e.FloatingTokenTargetUser)&&!t.has(e.FloatingTokenShouldTargetTree);const r=t.get(e.Object3D);if(o.time+=i,n&&o.started&&C&&!t.has(e.FloatingTokenShouldTargetTree)){y.lengthSq()<=400&&t.tagOn(e.FloatingTokenShouldTargetTree)}k.set(0,0);const l=n?y:k,s=o.position2D.distanceToSquared(l),c=x.noise4D(o.position2D.x,o.position2D.y,o.time,o.rotationAngleOffset);D.copy(l).sub(o.position2D);const u=Math.sqrt(D.dot(D)),f=Math.sqrt(s),d=a.clamp(f,1,2),v=0===u?d:(d-u)/u,T=.075+.01*c;o.velocity2D.addScaledVector(D,-T*v*(n?o.speed:1));const h=.1*o.time,S=.1*x.noise3D(.25*o.position2D.x,.25*o.position2D.y,.5*o.time);o.velocity2D.x+=Math.cos(h)*S,o.velocity2D.y+=Math.sin(h)*S,p.forEach(n=>{if(n===t)return;const i=n.get(e.FloatingToken),r=o.position2D.distanceToSquared(i.position2D);if(r<=4){const e=Math.sqrt(r),t=1-a.clamp01(e/2);D.copy(i.position2D).sub(o.position2D).normalize().multiplyScalar(t),o.velocity2D.addScaledVector(D,-.2)}});const b=n?7:14;o.velocity2D.x=a.clamp(o.velocity2D.x,-b,b),o.velocity2D.y=a.clamp(o.velocity2D.y,-b,b);var O=o.velocity2D.x,F=o.velocity2D.y,w=-.235*g*1.22*O*O*O/Math.abs(O),q=-.235*g*1.22*F*F*F/Math.abs(F),P=(w=isNaN(w)?0:w)/.1,A=(q=isNaN(q)?0:q)/.1;o.velocity2D.x+=P*i,o.velocity2D.y+=A*i;o.position2D.x+=o.velocity2D.x*i*.75,o.position2D.y+=o.velocity2D.y*i*.75;const U=1+a.clamp01(o.velocity2D.length()/(7/4));if(n)o.offsetY=0;else{o.animateToTreeTime+=i;const e=Math.max(0,o.animateToTreeTime-o.animateToTreeDelay),t=a.clamp01(e/o.animateToTreeDuration);o.offsetY=2*t}r.position.set(o.position2D.x,o.offsetHeight+o.offsetY,o.position2D.y),r.material.uniforms.time.value+=i*U,r.material.uniforms.timeOffset.value=o.rotationAngleOffset,r.position.addScaledVector(o.offset3D,1),D.copy(o.velocity2D).normalize(),D.set(-D.y,D.x),r.rotateOnWorldAxis(o.rotationAxis,U*o.rotationSpeed*i);const E=.1,j=(x.noise4D(r.position.x*E,r.position.y*E,r.position.z*E,1),1*x.noise4D(r.position.x*E,r.position.y*E,r.position.z*E,o.rotationAngleOffset));m.set(D.x,0,D.y);const _=Math.max(0,o.time-0);_>=0&&!o.started&&(o.started=!0,o.position2D.copy(y),o.velocity2D.set(0,0));const V=a.clamp01(_/2);r.scale.setScalar(Math.max(1e-5,o.scale*V*M.value)),r.visible=V>1e-5,r.position.y+=j})}}
},{"../tags":"injP","three":"IV0r","../util/tokens":"kL9I","../util/Assets":"Wm90","../util/math":"Ov1X","../util/Random":"LMfK","simplex-noise":"KFJE","../util/ShaderManager":"igLh","./AnimationSystem":"cUmx"}],"MT5l":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=o;var e=a(require("../tags")),t=a(require("three")),r=require("../util/three-util");function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function a(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var c=o?Object.getOwnPropertyDescriptor(e,u):null;c&&(c.get||c.set)?Object.defineProperty(a,u,c):a[u]=e[u]}return a.default=e,r&&r.set(e,a),a}function o(t){t.system.info({hidden:!0});const n=t.listen(e.Object3D),a=t.query(e.MainScene);return function(){const o=t.findTag(a);o&&n.changed&&(n.added.forEach(t=>{if(!t.has(e.Object3D))return;const r=t.get(e.Object3D);r&&!r.parent&&(o.add(r),r.updateMatrixWorld())}),n.removing.forEach(t=>{if(!t.has(e.Object3D))return;const n=t.get(e.Object3D);n&&!t.has(e.Object3DKeepAlive)&&(0,r.detachObject)(n)}))}}
},{"../tags":"injP","three":"IV0r","../util/three-util":"bI4v"}],"HsE3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=s(require("../tags")),t=s(require("three")),n=require("../util/array"),i=r(require("../util/tiny-event"));function r(e){return e&&e.__esModule?e:{default:e}}function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var u=r?Object.getOwnPropertyDescriptor(e,s):null;u&&(u.get||u.set)?Object.defineProperty(i,s,u):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}function u(t,n={}){const r=t.findTag(e.Canvas);let o=null,s=!1;const u=new i.default,d=t.entity("InputEntity").add(e.InputState),c=t.findTag(e.AppState),a=d.get(e.InputState),l={x:window.innerWidth/2,y:window.innerHeight/2,multitouch:null,interacted:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,pressed:!1},f=e=>x(e,l),h=e=>x(e,l),v={passive:!0};window.addEventListener("keydown",f,v),window.addEventListener("keyup",h,v),window.addEventListener("mousemove",k,v),window.addEventListener("mouseup",function(e){if(0!==e.button)return;0;I(e,l),T(e,l),l.pressed=!1},v),r.addEventListener("mousedown",b,v),r.addEventListener("touchstart",E,{passive:!1}),window.addEventListener("touchend",L,v),window.addEventListener("touchmove",K),r.addEventListener("contextmenu",m),t.entity().add(e.InputGestureEmitter,u);const p=e=>u.emit("tap",e);window.addEventListener("touchend",p,v),window.addEventListener("click",p,v),r.addEventListener("mousedown",p,v);const w=t.entity(),y=t.view(e.ClearInputPress);return{process(n){a.position.x=l.x,a.position.y=l.y,a.positionNormalized.x=l.x/c.width,a.positionNormalized.y=l.y/c.height,a.pressed=l.pressed,a.metaKey=l.metaKey,a.ctrlKey=l.ctrlKey,a.shiftKey=l.shiftKey,a.interacted=l.interacted,a.multitouch=l.multitouch,!w.has(e.UserInitiatedGesture)&&a.pressed&&w.add(e.UserInitiatedGesture);const i=t.findTag(e.IsGameUIActive),r=y.length>0;(i||r)&&(a.pressed=!1,l.pressed=!1,a.interacted=!1,l.interacted=!1,y.forEach(t=>{t.tagOff(e.ClearInputPress)}))},dispose(){r.removeEventListener("contextmenu",m),window.removeEventListener("mousedown",b),window.removeEventListener("mousemove",k),r.removeEventListener("touchstart",E),window.removeEventListener("touchend",L),window.removeEventListener("touchmove",K),window.removeEventListener("keydown",f),window.removeEventListener("keyup",h),window.removeEventListener("touchend",p),window.removeEventListener("click",p),window.removeEventListener("mousedown",p)}};function m(e){return e.preventDefault(),!1}function g(e,t){if(null!=t)for(let n=0;n<e.touches.length;n++)if(e.touches[n].identifier===t)return e.touches[n];return null}function E(e){s=!0;let t;null==o&&(t=e.changedTouches[0],o=t.identifier,e.preventDefault(),l.pressed=!0,I(e,l),T(t,l)),l.multitouch=e.touches.length>1}function L(e){const t=o;if(o){g(o)||(o=null)}if(null!=o)for(let n=0;n<e.changedTouches.length;n++){const t=e.changedTouches[n];if(t.identifier===o){T(t,l),o=null;break}}if(!o)for(let n=0;n<e.touches.length;n++){const i=e.touches[n];if(i.identifier!==t){o=i.identifier,l.pressed=!0,T(i,l);break}}if(!o&&e.touches.length>=1){const t=e.touches[0];o=t.identifier,l.pressed=!0,T(t,l)}o||(l.pressed=!1),I(e,l),l.multitouch=e.touches.length>1}function K(e){null==o&&(o=e.changedTouches[0].identifier);for(let t=0;t<e.changedTouches.length;t++){const n=e.changedTouches[t];if(n.identifier===o){l.pressed=!0,T(n,l),I(e,l);break}}l.multitouch=e.touches.length>1}function b(t){0===t.button&&(I(t,l),T(t,l),l.pressed=!0,w.add(e.TriggerMovementGesture),w.remove(e.TriggerMovementGesture))}function k(e){0===e.button&&(I(e,l),T(e,l))}function x(e,t){null!=e.shiftKey&&(t.shiftKey=e.shiftKey),null!=e.metaKey&&(t.metaKey=e.metaKey),null!=e.ctrlKey&&(t.ctrlKey=e.ctrlKey)}function T(e,t){t.x=e.clientX,t.y=e.clientY,a.x=t.x,a.y=t.y}function I(e,t){t.interacted=!0,x(e,t)}}
},{"../tags":"injP","three":"IV0r","../util/array":"ibDZ","../util/tiny-event":"V7ba"}],"ppeB":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n#define GLSLIFY 1\nvarying vec2 originalUv;\nvarying vec2 vUv;\nvarying float vYGradient;\nvarying vec2 vGroundUv;\nuniform sampler2D map;\nuniform sampler2D noiseMap;\nuniform float time;\nuniform bool useMapDiscard;\nvarying vec3 vObjectCoord;\nvarying vec2 vScreenScale;\nuniform vec3 color;\nuniform float aspect;\nuniform float spriteHeight;\nvarying vec3 vWorldPosition;\nvarying vec3 vGroundColor;\nvarying float vDataScale;\nvarying vec3 vBaseWorldPosition;\nvarying vec3 vCenterWorldPos;\nuniform sampler2D groundMap;\nuniform bool silhouette;\nuniform vec3 tintColor;\nuniform vec3 shadowColor;\n// varying float vSpin;\n// void main () {\n  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n//   gl_FragColor += texture2D(map, vUv);\n// }\nvoid main () {\n    gl_FragColor = texture2D(map, vUv);\n  gl_FragColor.rgb *= tintColor;\n  // gl_FragColor.a = 1.0;\n  float alphaMap = gl_FragColor.a;\n  if (alphaMap < 0.5) discard;\n  if (silhouette) {\n      // float vYGrad0 = 1.0 - pow(clamp(vYGradient / 1.0, 0.0, 1.0), 1.0);\n    // gl_FragColor.a *= 1.0 - clamp(distance(vCenterWorldPos, vWorldPosition) / 1.0, 0.0, 0.5);\n\n    float falloff = 1.0 - clamp(pow(vWorldPosition.y / 1.0, 1.0), 0.0, 1.0);\n    // float falloff = 1.0 - clamp(pow(distance(vCenterWorldPos, vWorldPosition) / 2.75, 1.0), 0.0, 1.0);\n    float shadowOpacity = 0.25;\n    gl_FragColor.rgb = mix(vec3(1.0), shadowColor, alphaMap * falloff * shadowOpacity);\n    gl_FragColor.a = 1.0;\n    // gl_FragColor.rgb = vec3(shadowColor);\n    // gl_FragColor.a *= ;\n    // gl_FragColor.rgb *= gl_FragColor.a;\n    // gl_FragColor.a = 1.0;\n    // gl_FragColor.a *= vUv.y;\n  }\n  // else {\n      // vec3 fogColor = texture2D(groundMap, vGroundUv).rgb;\n    // vec3 fogColor = vGroundColor;\n    // gl_FragColor.rgb *= color;\n    // gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, 0.2);\n    // gl_FragColor.rgb = gl_FragColor.rgb + fogColor * 0.1;\n    // gl_FragColor.rgb = mix(gl_FragColor.rgb, gl_FragColor.rgb + fogColor, 0.2);\n    // float vFog0 = 1.0 - pow(clamp(vWorldPosition.y / 0.5, 0.0, 1.0), 0.25);\n    // float yoff = sin(time + fract(vCenterWorldPos.x * 100.0 + vCenterWorldPos.z * 100.0));\n    // float ypos = max(0.0, vWorldPosition.y + yoff * 0.0);\n    // float vFog1 = 1.0 - pow(clamp(ypos / 4.0, 0.0, 1.0), 0.5);\n    // gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, vFog0);\n    // float vStr = 0.33;\n    // gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor + 0.1, vFog1 * vStr);\n  // }\n  // TODO: Screen door\n  // Will have to be done with another render target perhaps? render character\n  // and other key features (tokens) to it as black/white mask, then texture fetch\n  // the mask in this shader to see if we need to do transparency or not\n  // screenDoor(0.65);\n}\n";
},{}],"veYI":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n#define GLSLIFY 1\n#define PI 3.1415926538\nuniform float rotation;\nuniform vec2 repeat;\nuniform vec2 offset;\nuniform float flip;\nuniform float time;\nuniform sampler2D worldDataMap;\nuniform mat4 worldDataProjection;\nuniform mat4 worldDataView;\nuniform float spriteHeight;\nuniform bool silhouette;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvoid main () {\n    vUv = uv;\n  vUv *= repeat;\n  vUv += offset;\n  vec3 centerWorldPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n  vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n  vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n  vec2 scale;\n  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n  scale.x *= flip;\n  vec4 vDataUvPos4 = worldDataProjection * worldDataView * vec4(centerWorldPos.xz, 0.0, 1.0);\n  vec2 vDataScreen = vDataUvPos4.xy / vDataUvPos4.w;\n  vec2 vDataUv = vDataScreen.xy * 0.5 + 0.5;\n  vec3 dCol = texture2D(worldDataMap, vDataUv).rgb;\n  vec3 offsetPos = position.xyz;\n  vec3 vertexWorldPos = centerWorldPos\n    + camRightWorld * offsetPos.x * scale.x\n    + camUpWorld * offsetPos.y * scale.y;\n  vec3 realVertexWorldPos = vertexWorldPos;\n  vec3 vertexWorldBasePos = centerWorldPos;\n  vec2 curDirection2D = vec2(dCol.gb) * 2.0 - 1.0;\n  vec3 curDirection = vec3(curDirection2D.x, 0.0, curDirection2D.y);\n  float gradientY = clamp(vertexWorldPos.y / 0.25, 0.0, 1.0);\n  // vertexWorldPos += 0.05 * scale.y * camRightWorld * sin(time*7.0) * pow(dCol.r, 2.0) * gradientY;\n  vertexWorldPos += 0.05 * position.y * spriteHeight * camRightWorld * sin(time*7.0) * curDirection * pow(dCol.r, 2.0) * gradientY;\n  if (silhouette) {\n      float xSkew = -60.0 * (PI/180.0);\n    float ySkew = 0.0;\n    // Create a transform that will skew our texture coords\n    // mat3 trans = mat3(\n      //   1.0       , tan(xSkew), 0.0,\n    //   tan(ySkew), 1.0,        0.0,\n    //   0.0       , 0.0,        1.0\n    // );\n    vertexWorldPos.y *= 0.25;\n    vertexWorldPos.xyz -= camRightWorld * realVertexWorldPos.y * 0.5;\n    vertexWorldPos.z += -0.15;\n    // vertexWorldPos.x += -0.05;\n    // vertexWorldPos.xyz += vYGradient * camRightWorld * -0.5;\n    // vertexWorldPos.y *= 1.0;\n    // vertexWorldPos.xyz -= centerWorldPos;\n    // // vertexWorldPos.xyz *= rotation3dX(PI / -4.0);\n    // vertexWorldPos *= rotationMatrix(camRightWorld, PI / 2.0);\n    // vertexWorldPos.xyz += centerWorldPos;\n    // vertexWorldPos += vYGradient * camRightWorld * -0.5;\n    // vertexWorldPos *= offsetPos.y * camRightWorld * -2.0;\n    // vertexWorldPos.z *= 0.5;\n  }\n  vWorldPosition = vertexWorldPos;\n  gl_Position = projectionMatrix * viewMatrix * vec4(vertexWorldPos, 1.0);\n}\n";
},{}],"HqM0":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n#define GLSLIFY 1\n#ifdef HAS_INTENSITY\nvarying float vIntensity;\n#endif\n#ifdef HAS_VERTEX_COLORS\nvarying vec3 vVertexColor;\n#endif\nuniform bool ignoreGround;\nvarying vec2 vUv;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying vec2 vBillboardUV;\nuniform float alphaTest;\nuniform vec3 cameraDirection;\nuniform vec3 lightDirection;\nuniform vec3 lightPosition;\nuniform mat3 normalMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform sampler2D map;\nuniform sampler2D overlayMap;\nuniform vec3 color;\nuniform vec3 colorA;\nuniform vec3 colorB;\nuniform vec3 minBounds;\nuniform vec3 maxBounds;\nuniform vec3 overlayColor;\nuniform vec2 resolution;\nuniform float groundBounceStrength;\nuniform float groundBounceLow;\nuniform float groundBounceHigh;\nuniform bool groundBounce;\nvarying vec2 vGroundUv;\nuniform sampler2D groundTexture;\nuniform bool groundTextureEnabled;\n// uniform sampler2D noiseMap;\nuniform sampler2D normalMap;\nuniform bool flipNormalY;\nuniform bool debugNormals;\nuniform bool useNormalMap;\nuniform bool diffuseShading;\nuniform bool celShading;\nuniform bool darkShading;\nuniform bool vertexColors;\nuniform bool useOverlayMap;\nuniform bool useDiffuseMap;\nfloat range(float vmin, float vmax, float value) {\n    return (value - vmin) / (vmax - vmin);\n}\nvec2 range(vec2 vmin, vec2 vmax, vec2 value) {\n    return (value - vmin) / (vmax - vmin);\n}\nvec3 range(vec3 vmin, vec3 vmax, vec3 value) {\n    return (value - vmin) / (vmax - vmin);\n}\nvec4 range(vec4 vmin, vec4 vmax, vec4 value) {\n    return (value - vmin) / (vmax - vmin);\n}\nfloat blendSoftLight(float base, float blend) {\n  return (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n}\nvec3 blendSoftLight(vec3 base, vec3 blend) {\n  return vec3(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b));\n}\nvec3 blendSoftLight(vec3 base, vec3 blend, float opacity) {\n  return (blendSoftLight(base, blend) * opacity + base * (1.0 - opacity));\n}\nfloat blendOverlay(float base, float blend) {\n  return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n}\nvec3 blendOverlay(vec3 base, vec3 blend) {\n  return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n}\nvec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n  return (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n}\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\nvec3 mod289(vec3 x) {\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 mod289(vec4 x) {\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 permute(vec4 x) {\n       return mod289(((x*34.0)+1.0)*x);\n}\nvec4 taylorInvSqrt(vec4 r)\n{\n    return 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat snoise(vec3 v)\n  {\n    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n// Other corners\n  vec3 g_0 = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g_0;\n  vec3 i1 = min( g_0.xyz, l.zxy );\n  vec3 i2 = max( g_0.xyz, l.zxy );\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n// Permutations\n  i = mod289(i);\n  vec4 p = permute( permute( permute(\n               i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\nfloat luma(vec3 color) {\n    return dot(color, vec3(0.299, 0.587, 0.114));\n}\nfloat luma(vec4 color) {\n    return dot(color.rgb, vec3(0.299, 0.587, 0.114));\n}\nfloat dither4x4_0(vec2 position, float brightness) {\n    int x = int(mod(position.x, 4.0));\n  int y = int(mod(position.y, 4.0));\n  int index = x + y * 4;\n  float limit = 0.0;\n  if (x < 8) {\n      if (index == 0) limit = 0.0625;\n    if (index == 1) limit = 0.5625;\n    if (index == 2) limit = 0.1875;\n    if (index == 3) limit = 0.6875;\n    if (index == 4) limit = 0.8125;\n    if (index == 5) limit = 0.3125;\n    if (index == 6) limit = 0.9375;\n    if (index == 7) limit = 0.4375;\n    if (index == 8) limit = 0.25;\n    if (index == 9) limit = 0.75;\n    if (index == 10) limit = 0.125;\n    if (index == 11) limit = 0.625;\n    if (index == 12) limit = 1.0;\n    if (index == 13) limit = 0.5;\n    if (index == 14) limit = 0.875;\n    if (index == 15) limit = 0.375;\n  }\n  return brightness < limit ? 0.0 : 1.0;\n}\nvec3 dither4x4_0(vec2 position, vec3 color) {\n    return color * dither4x4_0(position, luma(color));\n}\nvec4 dither4x4_0(vec2 position, vec4 color) {\n    return vec4(color.rgb * dither4x4_0(position, luma(color)), 1.0);\n}\nvec3 faceNormals(vec3 pos) {\n    vec3 fdx = dFdx(pos);\n  vec3 fdy = dFdy(pos);\n  return normalize(cross(fdx, fdy));\n}\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n    // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n  vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n  vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n  vec2 st0 = dFdx( vUv.st );\n  vec2 st1 = dFdy( vUv.st );\n  float scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n  vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n  vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n  vec3 N = normalize( surf_norm );\n  mat3 tsn = mat3( S, T, N );\n  mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n  return normalize( tsn * mapN );\n}\nfloat aastep(float threshold, float value) {\n    float change = fwidth(value) * 0.5;\n  float lo = threshold - change;\n  float hi = threshold + change;\n  return smoothstep(threshold - change, threshold + change, value);\n}\nfloat aastep1(float threshold, float value) {\n    float change = fwidth(value) * 0.5;\n  float lo = threshold - change;\n  float hi = threshold + change;\n  return clamp((value - lo) / (hi - lo), 0.0, 1.0);\n}\n// float aastep(float threshold, float value) {\n  //   float change = fwidth(value) * 0.5;\n//   // float change = fwidth(value) * 0.5;\n//   // float change = fwidth(value) * 0.5;\n//   // float change = 0.1;\n//   float lo = threshold - change;\n//   float hi = threshold + change;\n//   return clamp((value - lo) / (hi - lo), 0.0, 1.0);\n// }\nvec4 blend(vec4 background, vec4 foreground) {\n      return (foreground.rgba * foreground.a) + background.rgba * (1.0 - foreground.a);\n}\nfloat roundf (float f) {\n    return floor(f + 0.5);\n}\n// float fastnoise3D(vec3 p)\n// {\n  //   p.z = fract(p.z)*256.0;\n//   float iz = floor(p.z);\n//   float fz = fract(p.z);\n//   vec2 a_off = vec2(23.0, 29.0)*(iz)/256.0;\n//   vec2 b_off = vec2(23.0, 29.0)*(iz+1.0)/256.0;\n//   float a = texture2D(noiseMap, p.xy + a_off).r;\n//   float b = texture2D(noiseMap, p.xy + b_off).r;\n//   return mix(a, b, fz);\n// }\nfloat dither4x4(vec2 position, float brightness) {\n    int x = int(mod(position.x, 4.0));\n  int y = int(mod(position.y, 4.0));\n  int index = x + y * 4;\n  float limit = 0.0;\n  if (x < 8) {\n      if (index == 0) limit = 0.0625;\n    if (index == 1) limit = 0.5625;\n    if (index == 2) limit = 0.1875;\n    if (index == 3) limit = 0.6875;\n    if (index == 4) limit = 0.8125;\n    if (index == 5) limit = 0.3125;\n    if (index == 6) limit = 0.9375;\n    if (index == 7) limit = 0.4375;\n    if (index == 8) limit = 0.25;\n    if (index == 9) limit = 0.75;\n    if (index == 10) limit = 0.125;\n    if (index == 11) limit = 0.625;\n    if (index == 12) limit = 1.0;\n    if (index == 13) limit = 0.5;\n    if (index == 14) limit = 0.875;\n    if (index == 15) limit = 0.375;\n  }\n  return brightness < limit ? 0.0 : 1.0;\n}\nfloat fcos( float x )\n{\n    float w = fwidth(x);\n  // return cos(x) * smoothstep( 3.14*2.0, 0.0, w );\n  return cos(x) * smoothstep(3.14*2.0, 0.0, w);\n}\nfloat hash(vec3 p) {\n    // return fract(sin(p.x * 1e2 + p.y) * 1e5 + sin(p.y * 1e3) * 1e3 + sin(p.x * 735. + p.y * 11.1) * 1.5e2);\n  float a = 0.0;\n  a += 0.25 * cos(p.x * 10.0 + 20.0);\n  a += 0.5 * cos(p.y * 10.0 + 40.0);\n  // a += 0.33 * cos(p.z * 10.0 + 60.0);\n  return a;\n}\n// GLSL smootherstep [smthrstp] from http://graphicscodex.com for reference\nfloat smootherstep(float start, float end, float t) {\n     t = max(0.0, min(1.0, (t - start) / (end - start)));\n   return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\nfloat Value3D( vec3 P )\n{\n    //  https://github.com/BrianSharpe/Wombat/blob/master/Value3D.glsl\n  // establish our grid cell and unit position\n  vec3 Pi = floor(P);\n  vec3 Pf = P - Pi;\n  vec3 Pf_min1 = Pf - 1.0;\n  // clamp the domain\n  Pi.xyz = Pi.xyz - floor(Pi.xyz * ( 1.0 / 69.0 )) * 69.0;\n  vec3 Pi_inc1 = step( Pi, vec3( 69.0 - 1.5 ) ) * ( Pi + 1.0 );\n  // calculate the hash\n  vec4 Pt = vec4( Pi.xy, Pi_inc1.xy ) + vec2( 50.0, 161.0 ).xyxy;\n  Pt *= Pt;\n  Pt = Pt.xzxz * Pt.yyww;\n  vec2 hash_mod = vec2( 1.0 / ( 635.298681 + vec2( Pi.z, Pi_inc1.z ) * 48.500388 ) );\n  vec4 hash_lowz = fract( Pt * hash_mod.xxxx );\n  vec4 hash_highz = fract( Pt * hash_mod.yyyy );\n  // blend the results and return\n  vec3 blend = Pf * Pf * Pf * (Pf * (Pf * 6.0 - 15.0) + 10.0);\n  vec4 res0 = mix( hash_lowz, hash_highz, blend.z );\n  vec4 blend2 = vec4( blend.xy, vec2( 1.0 - blend.xy ) );\n  return dot( res0, blend2.zxzx * blend2.wwyy ) * 2.0 - 1.0;\n}\n// void main () {\n  //   gl_FragColor = vec4(1.0);\n// }\nvoid main () {\n    #ifdef HAS_INTENSITY\n  float intensity = vIntensity;\n  #else\n  float intensity = 1.0;\n  #endif\n  vec3 vLightDir = -lightDirection;\n  vec3 L = normalize(vLightDir);\n  vec3 V = normalize(vViewPosition);\n  vec3 N = vNormal;\n  vec4 diffuseColorRGBA = texture2D(map, vUv).rgba;\n  vec3 diffuseColor = diffuseColorRGBA.rgb;\n  float H = hash(vWorldPosition.xyz);\n  vec3 mapN = texture2D(normalMap, vUv).xyz;\n  if (flipNormalY) mapN.y = 1.0 - mapN.y;\n  mapN = mapN * 2.0 - 1.0;\n  vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\nvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n// N = normalize( cross( fdx, fdy ) );\n  if (useNormalMap) {\n      N = normalize(perturbNormal2Arb( -vViewPosition, N, mapN ));\n  }\n  // vec3 normalized = range(minBounds, maxBounds, vWorldPosition);\n  vec3 minGrounded = minBounds;\n  minGrounded.y = max(0.0, minGrounded.y);\n  vec3 maxGrounded = maxBounds;\n  maxGrounded.y = max(0.0, maxGrounded.y);\n  vec3 normalized = range(minGrounded, maxGrounded, vWorldPosition);\n  float diffuse = (0.5 * dot(N, L)) + 0.5;\n\n  // vec3 randomNoise3 = vec3(texture2D(noiseMap, vBillboardUV)).xyz * 2.0 - 1.0;\n  vec3 randomNoise3 = vec3(0.0);\n  float randomNoise = randomNoise3.x * 0.01;\n\n  float hNoise = Value3D(vWorldPosition.xyz * 30.0);\n  float diffuseStep = 0.0;\n  // diffuseStep *= aastep(0.25, diffuse);\n  // diffuseStep = mix(diffuseStep, 0.5, aastep(0.5, diffuse));\n  // diffuseStep = aastep(0.75, diffuse + diffuseColor.r * 0.02);\n  // diffuseStep += aastep(0.25, diffuse + diffuseColor.g * 0.02) * 0.5;\n  // diffuseStep = min(diffuseStep, 1.0);\n  // diffuseStep = aastep(0.25, diffuse);\n  // diffuseStep *= dither(vPosition.xz * 10.0, diffuse);\n  // if (diffuse <= 0.2) {\n    //   diffuseStep = 0.0;\n  // } else if (diffuse <= 0.25) {\n    //   diffuseStep = 1.0;\n  // }\n  // float highlightLow = 0.5;\n  // float highlightHigh = 0.75;\n  // float diffuseStepHigh = aastep(0.5, smoothstep(\n    //   0.5, 0.75, diffuse\n  // ));\n  // float diffuseStepLow = aastep(0.5, smoothstep(\n    //   0.0, 0.25, diffuse\n  // ));\n  vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n  vec3 VC = normalize(camUpWorld);\n  // vec3 VC = normalize(cross(camRightWorld, camUpWorld));\n  // vec3 VC = normalize(cameraDirection);\n  float vDotN = 1.0 - clamp(dot(V, N), 0.0, 1.0);\n  float rim = aastep(0.5, vDotN + hNoise * 0.05);\n  // float gradient = pow(clamp(vWorldPosition.y / 2.0, 0.0, 1.0), 1.0);\n  // float ramp = intensity;\n  // if (diffuseShading) {\n    //   ramp = diffuse;\n  // } else {\n    //   ramp = diffuseStep;\n  //   // if (celShading) ramp = mix(intensity * 0.75, 1.0, diffuseStep);\n  //   // if (darkShading) ramp = mix(0.0, ramp, rim);\n  // }\n  vec3 gtex = texture2D(groundTexture, vGroundUv).rgb;\n// gl_FragColor.rgb = mix(gl_FragColor.rgb, gl_FragColor.rgb * diffuse, 0.5);\n  float highCut = 0.75;\n  float lowCut = 0.15;\n  // float midRangeOpacity = 0.33;\n  // float lowRangeOpacity = 0.5;\n  // gl_FragColor.rgb = mix(gl_FragColor.rgb, gl_FragColor.rgb * (aastep(highCut, diffuse)), midRangeOpacity);\n  // gl_FragColor.rgb = mix(gl_FragColor.rgb, gl_FragColor.rgb * rim, lowRangeOpacity);\n  // gl_FragColor.rgb = mix(gl_FragColor.rgb, gl_FragColor.rgb * (aastep(lowCut, diffuse)), lowRangeOpacity);\n  gl_FragColor.rgb = vec3(1.0);\n  // gl_FragColor.rgb = diffuseShading ? vec3(diffuse) : vec3(1.0);\n  // gl_FragColor.rgb = diffuseShading ? vec3(diffuse) : vec3(1.0);\n  if (useDiffuseMap) gl_FragColor.rgb *= diffuseColor.rgb;\n  // float highCutStep = smoothstep(0.75, 1.0, diffuse);\n  float bounce = 0.75;\n  float bounceCut = smoothstep(0.5, 0.25, diffuse);\n  // float lowCutStep = 1.0 - rim;\n  float lowCutStep = 1.0 - smoothstep(groundBounceLow, groundBounceHigh, diffuse + hNoise * 0.01);\n  // float lowCutStep = 1.0 - aastep(0.1, diffuse + hNoise * 0.01);\n  // float highCutStep = aastep(0.75, diffuse + hNoise * 0.01);\n  // float bounceCut = 1.0-aastep(0.25, diffuse);\n  // if (groundBounce) gl_FragColor.rgb = mix(gl_FragColor.rgb, gl_FragColor.rgb * gtex.rgb, lowCutStep * groundBounceStrength);\n  // gl_FragColor.rgb = mix(gl_FragColor.rgb, gl_FragColor.rgb * gtex.rgb * 0.35, (1.0 - rim) * 1.0);\n  // float overlay = texture2D(overlayMap, vUv).r;\n  // if (useDiffuseMap) {\n    //   gl_FragColor.rgb *= diffuseColor;\n  // }\n  // if (diffuseShading) gl_FragColor.rgb *= diffuse;\n  // else gl_FragColor.rgb = blendOverlay(gl_FragColor.rgb, mix(colorA, colorB, diffuseStep));\n  // if (useOverlayMap) {\n    //   vec4 overlayColor4 = vec4(vec3(overlayColor), (1.0 - overlay) * rim);\n  //   gl_FragColor = blend(gl_FragColor, overlayColor4);\n  // }\n  if (groundTextureEnabled && !ignoreGround) {\n      // float ny = normalized.y;\n    float ny = vWorldPosition.y / 0.75 + hNoise * 0.1;\n    // float ny = normalized.y + (useDiffuseMap ? -0.01*(diffuseColor.r) : 0.0);\n    float pv = smootherstep(0.0, 0.35, ny);\n    // float pv = aastep(0.5, smootherstep(0.05, 0.5, ny));\n    // gl_FragColor.rgb = vec3(pv);\n    gl_FragColor.rgb = mix(gtex, gl_FragColor.rgb, pv);\n  }\n  // gl_FragColor.rgb = vec3(hNoise);\n  if (debugNormals) gl_FragColor.rgb = N * 0.5 + 0.5;\n\n  gl_FragColor.a = 1.0;\n  if (diffuseColorRGBA.a < alphaTest) discard;\n  // gl_FragColor.rgb = vec3(randomNoise3.x * 0.5 + 0.5);\n}\n// void mai2n () {\n  //   float noff = 0.0;//noise(vec3(vPosition * 12.0));\n//   // float noff = noise(vec3(vPosition * 12.0));\n//   vec3 col = texture2D(map, vUv).rgb;\n//   // vec3 col = texture2D(map, vUv + vec2(0.0, noff * 0.03)).rgb;\n//   float y0, y1;\n//   // if (vUv.y <= (550.0/1024.0)) {\n  //   //   y0 = 576.0/1024.0;\n//   //   y1 = 1.0;\n//   // } else {\n  //   //   y0 = 64.0/1024.0;\n//   //   y1 = 512.0/1024.0;\n//   // }\n//   float py = vUv.y * 1024.0;\n//   float intensity = range(\n  //     576.0,\n//     1024.0,\n//     py\n//   );\n//   // float intensity = vUv.y >= 0.5 ? 1.0 : 0.0;\n//   // intensity = 1.0;\n\n//   #ifdef HAS_INTENSITY\n//     intensity = vIntensity;\n//   #endif\n//   intensity = pow(intensity, 1.0 / 2.2);\n//   vec3 vLightDir = -lightDirection;\n//   // vec3 vLightDir = (viewMatrix * vec4(lightDirection, 1.0)).xyz;\n//   // vec3 vLightDir = (viewMatrix * vec4(normalize(vec3(-2.0, 1.0, 2.0)), 1.0)).xyz;\n//   vec3 L = normalize(vLightDir);\n//   vec3 V = normalize(vViewPosition);\n//   vec3 normalized = range(minBounds, maxBounds, vWorldPosition);\n//   float cylindricalHeight = normalized.y;\n//   float theta = atan(normalized.z, normalized.x);\n//   float angle01 = range(-3.14, 3.14, theta);\n\n//   // float n = normalized.y;\n//   // float n = texture2D(noise1DMap, vec2(0.0, normalized.y * 0.005 + sin(vWorldPosition.x) * 0.5)).r;\n//   // n = smoothstep(0.4, 0.45, n);\n//   // n = texture2D(noise1DMap, vec2(0.5, col.r + 1.0 / 512.0 * n)).r;\n//   vec3 N = vNormal;\n//   // vec3 N = normalize(colnorm * 2.0 - 1.0);\n//   // float n0 = texture2D(noise1DMap, vec2(0.5, normalized.y + vWorldPosition.y)).r;\n//   // float n1 = texture2D(noise1DMap, vec2(0.5, normalized.y + vWorldPosition.y + vWorldPosition.x)).r;\n//   float diffuse = (0.5 * dot(N, L)) + 0.5;\n//   float ndotl = diffuse;\n//   float i = 1.0;\n//   // if (diffuse >= 0.5) {\n  //   //   i = 0.75;\n//   // } else {\n  //   //   i = 0.25;\n//   // }\n//   // float doff = (n0 * 2.0 - 1.0) * 0.05;\n\n//   // i = mix(0.25, 0.75, clamp(step(0.65, diffuse + doff), 0.0, 1.0));\n//   // diffuse = i;\n//   float ux = 0.5;\n\n//   float dstep = aastep(0.5, smoothstep(0.5, 0.75, diffuse + noff * 0.025));\n//   // float dstep = aastep(0.5, diffuse + noff * 0.1);\n//   diffuse = mix(0.0, 1.0, dstep);\n//   // if (diffuse >= 0.66) {\n  //   //   diffuse = 0.85;\n//   // } else {\n  //   //   diffuse = 0.2;\n//   // }\n//   // if (diffuse >= 0.75) {\n  //   //   diffuse = 0.8;\n//   // } else if (diffuse >= 0.5) {\n  //   //   diffuse = 0.5;\n//   // } else {\n  //   //   diffuse = 0.2;\n//   // }\n//   // diffuse += (n0 * 2.0 - 1.0) * 0.025 / 4.0;\n//   // diffuse += (n1 * 2.0 - 1.0) * 0.025 / 4.0;\n//   // if (diffuse >= 0.5) {\n  //   //   // i = 1.0;\n//   //   i = step(0.75, diffuse + (n0 * 2.0 - 1.0) * 0.1);\n//   // } else if (diffuse >= 0.25) {\n  //   //   i = step(0.5, diffuse + (n1 * 2.0 - 1.0) * 0.1);\n//   // } else {\n  //   //   i = 0.25;\n//   // }\n//   // diffuse = i;\n//   // intensity += (n * 2.0 - 1.0) * 0.025;\n//   // if (intensity >= 0.5) {\n  //   //   i = 1.0;\n//   // } else if (intensity >= 0.25) {\n  //   //   i = 0.5;\n//   // } else {\n  //   //   i = 0.25;\n//   // }\n//   // intensity = i;\n  // vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n  // vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n  // vec3 VC = normalize(camUpWorld);\n//   // vec3 VC = normalize(cross(camRightWorld, camUpWorld));\n//   // vec3 VC = normalize(cameraDirection);\n  // float vDotN = 1.0 - clamp(dot(VC, vNormal), 0.0, 1.0);\n//   float rim = aastep(0.5, vDotN + noff * 0.025);\n//   // float ink01 = 0.0;\n//   // ink01 += 0.5 * clamp(step(0.5, vDotN + (n0 * 2.0 - 1.0) * 0.05), 0.0, 1.0);\n//   // ink01 += 0.5 * clamp(step(0.5, vDotN + (n1 * 2.0 - 1.0) * 0.05), 0.0, 1.0);\n//   // ink01 += 0.33 * clamp(step(0.5, vDotN), 0.0, 1.0);\n//   // VC = normalize(camUpWorld);\n//   // vDotN = 1.0 - clamp(dot(VC, N), 0.0, 1.0);\n//   // float ink02 = step(0.5, vDotN);\n//   // diffuse += 1.0-n;\n//   // vec3 styleColor = blendSoftLight(vec3(intensity), vec3(diffuse), 1.0);\n//   float intensityAmount = 0.75;\n//   // vec3 styleColor = vec3(mix(diffuse, intensity, intensityAmount));\n//   vec3 solidColor = vec3(intensity);\n//   // vec3 styleColor = vec3(mix(intensity, 0.5, 0.5) + diffuse * 0.5);\n//   float gradient = pow(clamp(vWorldPosition.y / 2.0, 0.0, 1.0), 1.0);\n//   float dsteprim = aastep(0.5, smoothstep(0.1, 0.25, ndotl + noff * 0.025));\n//   // float dstep = aastep(0.5, diffuse + noff * 0.1);\n//   float drim = mix(0.0, 1.0, dsteprim);\n\n//   float ramp = mix(intensity * 0.75, 1.0, diffuse);\n//   ramp = mix(0.0, ramp, rim);\n//   gl_FragColor.rgb = vec3(ramp);\n//   vec2 nuv = vec2(0.0);\n\n//   float py2 = (576.0 / 1024.0) * 1024.0;\n//   // float nv = clamp(range(\n  //   //   576.0,\n//   //   1024.0,\n//   //   py2 + 448.0 * ramp\n//   // ), 0.0, 1.0);\n//   // nuv.x = vUv.x;\n//   // nuv.y = nv;\n//   y1 = ((579.0 + 439.0) / 1024.0);\n//   y0 = 579.0 / 1024.0;\n//   vec3 color0 = texture2D(map, vec2(vUv.x, y0)).rgb;\n//   vec3 color1 = texture2D(map, vec2(vUv.x, y1)).rgb;\n//   gl_FragColor.rgb = mix(color0, color1, ramp);\n//   // gl_FragColor.rgb = color1;\n//   // vec3 solidFlat = color * 1.0;\n//   // gl_FragColor.rgb = mix(color * solidColor, solidFlat, diffuse);\n//   // gl_FragColor.rgb = mix(color * 0.5, gl_FragColor.rgb, gradient);\n//   // gl_FragColor.rgb = mix(\n  //   //   vec3(22.0,29.0,40.0)/255.0,\n//   //   vec3(132.0,165.0,164.0)/255.0,\n//   //   gl_FragColor.r\n//   // );\n//   // gl_FragColor.rgb = mix(vec3(0.0), gl_FragColor.rgb, drim);\n\n//   gl_FragColor.a = 1.0;\n//   // vec3 lineColor = vec3(1.0) * (1.0 - n);\n\n//   // gl_FragColor.rgb = blendSoftLight(gl_FragColor.rgb, lineColor, 0.2);\n//   // gl_FragColor.rgba = blend(gl_FragColor.rgba, vec4(vec3(1.0), n));\n//   gl_FragColor.a = 1.0;\n//   gl_FragColor.rgb = vec3(vIntensity);\n//   // gl_FragColor.rgb = vec3(intensity);\n// }\n";
},{}],"iahN":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n#define GLSLIFY 1\n#ifdef HAS_INTENSITY\nattribute float intensity;\nvarying float vIntensity;\n#endif\n#ifdef HAS_VERTEX_COLORS\nattribute vec3 vertexColor;\nvarying vec3 vVertexColor;\n#endif\nvarying vec2 vGroundUv;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying vec2 vBillboardUV;\nuniform vec3 minBounds;\nuniform mat4 groundProjectionMatrix;\nuniform vec3 maxBounds;\nuniform vec2 resolution;\nfloat range(float vmin, float vmax, float value) {\n    return (value - vmin) / (vmax - vmin);\n}\nvec2 range(vec2 vmin, vec2 vmax, vec2 value) {\n    return (value - vmin) / (vmax - vmin);\n}\nvec3 range(vec3 vmin, vec3 vmax, vec3 value) {\n    return (value - vmin) / (vmax - vmin);\n}\nvec4 range(vec4 vmin, vec4 vmax, vec4 value) {\n    return (value - vmin) / (vmax - vmin);\n}\n// modified from http://graphics.cs.williams.edu/papers/HashedAlphaI3D17/\n// fixed4 tex2DConstScale(sampler2D tex, float texSize, float2 uv)\n// {\n  //   // Find the discretized derivatives of our coordinates\n//   float maxDeriv = max( length(ddx(uv)), length(ddy(uv)) );\n//   float pixScale = 1.0 / (texSize * maxDeriv);\n//   // Find two nearest log-discretized noise scales\n//   float2 pixScales = float2(\n  //       exp2(floor(log2(pixScale))),\n//       exp2( ceil(log2(pixScale)))\n//       );\n//   // Factor to interpolate lerp with\n//   float lerpFactor = frac( log2(pixScale) );\n//   return lerp(\n  //       tex2D(tex, pixScales.x * uv),\n//       tex2D(tex, pixScales.y * uv),\n//       lerpFactor\n//       );\n// }\n//\nvec2 getScreenUV (vec2 clipPos, float uvScale) {\n    // vec3 boxCenter = (minBounds + maxBounds) * 0.5;\n  // vec4 SSobjectPosition = projectionMatrix * viewMatrix * vec4(boxCenter, 1.0);\n  vec4 SSobjectPosition = projectionMatrix * modelViewMatrix * vec4(vec3(0.0), 1.0);\n  vec2 screenUV = vec2(clipPos.xy);\n  float screenRatio = resolution.y/resolution.x;\n  screenUV.x -= SSobjectPosition.x/(SSobjectPosition.w);\n  screenUV.y -= SSobjectPosition.y/(SSobjectPosition.w);\n  screenUV.y *= screenRatio;\n  screenUV *= 1.0/uvScale;\n  screenUV *= SSobjectPosition.z; // or z\n  return screenUV;\n}\nvoid main () {\n    vUv = uv;\n  vec3 objectNormal = normal;\n  vec3 transformedNormal = objectNormal;\n  transformedNormal = normalMatrix * transformedNormal;\n  transformedNormal = normalize(transformedNormal);\n  vNormal = transformedNormal;\n  vec3 transformed = position.xyz;\n  // transformed += normal.xyz * 0.1;\n  vPosition = transformed.xyz;\n  vec4 worldPos = modelMatrix * vec4(transformed, 1.0);\n  vec4 mvPosition = viewMatrix * worldPos;\n  gl_Position = projectionMatrix * mvPosition;\n\n  vViewPosition = -mvPosition.xyz;\n  vWorldPosition = worldPos.xyz;\n  #ifdef HAS_INTENSITY\n  vIntensity = intensity;\n  #endif\n  #ifdef HAS_VERTEX_COLORS\n  vVertexColor = vertexColor;\n  #endif\n  vec3 gPos = worldPos.xyz;\n  gPos.y *= 0.0;\n  vec4 baseClipPos = groundProjectionMatrix * viewMatrix * vec4(gPos, 1.0);\n  vGroundUv = baseClipPos.xy / baseClipPos.w * 0.5 + 0.5;\n  // vec3 bpoint = range()\n  // vec4 vpos = projectionMatrix * modelMatrix * vec4(transformed.xyz, 1.0);\n  // vec3 boxCenter = (minBounds + maxBounds) * 0.5;\n  // vec3 centerWorldPos = (modelMatrix * vec4(boxCenter, 1.0)).xyz;\n  // vec3 npos = transformed.xyz;\n  // vec4 clipCur = projectionMatrix * modelMatrix * vec4(npos, 1.0);\n  // vec4 clipCur = projectionMatrix * modelMatrix * vec4(position.xyz, 1.0);\n  // vec4 clipMin = projectionMatrix * modelViewMatrix * vec4(minBounds.xyz, 1.0);\n  // vec4 clipMax = projectionMatrix * modelViewMatrix * vec4(maxBounds.xyz, 1.0);\n  // vec4 clipCenter = (projectionMatrix * viewMatrix * vec4(centerWorldPos, 1.0));\n  // clipCur.xy -= clipCenter.xy / clipCenter.w;\n  // vec2 clipCur2D = clipCur.xy / clipCur.w * 0.5 + 0.5;\n  // clipCur2D.xy -= clipCenter.xy / clipCenter.w * 0.5 + 0.5;\n  // vec2 clipMin2D = clipMin.xy / clipMin.w;\n  // vec2 clipMax2D = clipMax.xy / clipMax.w;\n  // vBillboardUV = getScreenUV(gl_Position.xy / gl_Position.w, 40.0);\n  // vBillboardUV = mix(clipMin2D, clipMax2D, range(minBounds, maxBounds, position.xyz));\n  // vec3 bWorldPos = worldPos.xyz + boxCenter.xyz;\n  // vec4 bClipPos = projectionMatrix * viewMatrix * vec4(bWorldPos, 1.0);\n  // vBillboardUV = bClipPos.xy / bClipPos.w * 0.5 + 0.5;\n\n  // vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n  // vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n  // float billboardSize = 1.0 * globalSpriteScale * absScale;\n  // vec3 vertexWorldPos = boxCenter\n  //   + camRightWorld * position.x * billboardSize\n  //   + camUpWorld * position.y * billboardSize;\n}\n";
},{}],"phuP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getEmptyTexture=m,exports.getSpriteGeometry=g,exports.setSpriteToken=w,exports.createTokenMaterial=y,exports.createSpriteMaterial=M,exports.createMeshMaterial=h;var e=d(require("three")),t=c(require("../shaders/sprite.frag")),r=c(require("../shaders/sprite.vert")),a=d(require("../tags")),o=c(require("../shaders/toon.frag")),n=c(require("../shaders/toon.vert")),i=d(require("./ShaderManager")),l=require("../util/tokens"),u=c(require("./SpriteManager")),v=c(require("./Assets")),s=require("./three-util");function c(e){return e&&e.__esModule?e:{default:e}}function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=o?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(a,n,i):a[n]=e[n]}return a.default=e,r&&r.set(e,a),a}const f=new e.PlaneGeometry(1,1,4,4);let x;function m(){if(!x){const t=new Uint8Array(12);(x=new e.DataTexture(t,2,2,e.RGBFormat)).needsUpdate=!0}return x}function g(){return f}function w(e,t,r,a=null){(0,l.getTokenSheet)().then(o=>{const n=o.map[`tokens/${r}`];if(n&&((0,s.shareAtlasTexture)(e,n.atlas,n.texture),t.material.uniforms.map.value=n.texture,t.material.uniforms.repeat.value.copy(n.repeat),t.material.uniforms.offset.value.copy(n.offset),null!=a)){const e=n.width/n.height,r=a*e;t.scale.set(r,a,1)}})}function y(t=.666,r=!0){return i.create({transparent:!0,name:"token-material",uniforms:{repeat:{value:new e.Vector2(1,1)},offset:{value:new e.Vector2(0,0)},map:{value:m()},color:{value:new e.Color(1+t,1+t,1+t)},opacity:{value:1},time:{value:0}},depthTest:r,depthWrite:r,vertexShader:"\n    varying vec2 vUv;\n    uniform vec2 repeat;\n    uniform vec2 offset;\n    void main () {\n      vUv = uv;\n      vUv *= repeat;\n      vUv += offset;\n\n      vec3 centerWorldPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n      vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n      vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n      vec2 scale;\n      scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n      scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n      vec3 offsetPos = position.xyz;\n      vec3 vertexWorldPos = centerWorldPos\n        + camRightWorld * offsetPos.x * scale.x\n        + camUpWorld * offsetPos.y * scale.y;\n\n      // gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n      gl_Position = projectionMatrix * viewMatrix * vec4(vertexWorldPos, 1.0);\n    }\n    ",side:e.DoubleSide,fragmentShader:"\n    varying vec2 vUv;\n    uniform sampler2D map;\n    // uniform sampler2D noiseMap;\n    uniform vec3 color;\n    uniform float time;\n    uniform float opacity;\n    // uniform float effect;\n    void main () {\n      vec2 uv = vUv;\n\n      // vec4 noiseLow = texture2D(noiseMap, vUv * 0.075 + vec2(time * 0.075, 0.0)) * 2.0 - 1.0;\n      // vec4 noiseHigh = texture2D(noiseMap, (vUv * 0.25 + vec2(0.0, time * 0.075))) * 2.0 - 1.0;\n\n      vec4 tcol = texture2D(map, vUv);\n      // vec4 ecol = vec4(0.0);\n      // ecol += texture2D(map, vUv + noiseLow.rg * 0.2) * 0.2;\n      // ecol += texture2D(map, vUv + noiseLow.rg * 0.1) * 0.33;\n      // ecol += texture2D(map, vUv + noiseHigh.rg * 0.05) * 0.33;\n      // vec4 fcol = mix(tcol, ecol, effect);\n      vec4 outColor = vec4(color, opacity) * tcol;\n      gl_FragColor = vec4(outColor);\n    }\n    "})}function M(o){const n=o.findTag(a.GroundPlaneView),l=m(),u=o.findTag(a.GroundDataRenderTarget);return i.create({name:"WayfinderSpriteShader",extensions:{derivatives:!0},transparent:!0,side:e.DoubleSide,fragmentShader:t.default,vertexShader:r.default,uniforms:{shadowColor:{value:new e.Color("#280422")},groundMap:{value:n.target.texture},groundProjectionMatrix:{value:n.projectionMatrix},worldDataMap:{value:u?u.target.texture:new e.Texture},worldDataProjection:{value:u?u.projection:new e.Matrix4},worldDataView:{value:u?u.view:new e.Matrix4},map:{value:l},flip:{value:1},silhouette:{value:!1,type:"b"},useMapDiscard:{value:!1,type:"b"},color:{value:new e.Color("white")},time:{value:0},spin:{value:0},spriteHeight:{value:1},aspect:{value:1},repeat:{value:new e.Vector2(1,1)},offset:{value:new e.Vector2(0,0)},tintColor:{value:new e.Color("#ffffff")}}})}function h(t,r,{map:l,ignoreGround:u=!1}){const v=t.findTag(a.GroundPlaneView),s=v.target.texture,c=v.projectionMatrix;r.updateMatrix(),r.updateMatrixWorld();const p=t.findTag(a.RenderLayers);r.layers.set(p.groundNormalElement);const d=(new e.Box3).setFromObject(r),f=r.material,x=f.alphaTest||0;return i.create({transparent:Boolean(f.transparent),name:"WayfinderMeshShader",defines:{HAS_INTENSITY:Boolean(!1),HAS_VERTEX_COLORS:Boolean(!1)},vertexShader:n.default,fragmentShader:o.default,side:e.FrontSide,extensions:{derivatives:!0},uniforms:{alphaTest:{value:x},ignoreGround:{value:Boolean(u),type:"i"},normalMap:{value:new e.Texture},groundTexture:{value:s||new e.Texture},groundTextureEnabled:{type:"b",value:Boolean(s)},groundBounce:{type:"b",value:!0},groundBounceLow:{value:.06},groundBounceHigh:{value:.25},groundBounceStrength:{value:.5},groundProjectionMatrix:{value:c||new e.Matrix4},useNormalMap:{type:"b",value:!1},flipNormalY:{type:"b",value:!1},diffuseShading:{type:"b",value:!1},debugNormals:{type:"b",value:!1},resolution:{value:new e.Vector2},celShading:{type:"b",value:!1},darkShading:{type:"b",value:!1},vertexColors:{type:"b",value:!1},useOverlayMap:{type:"b",value:!1},useNoiseMap:{type:"b",value:!1},useDiffuseMap:{type:"b",value:!0},overlayColor:{value:new e.Color},colorA:{value:new e.Color},colorB:{value:new e.Color},cameraDirection:{value:new e.Vector3},minBounds:{value:d.min},maxBounds:{value:d.max},lightDirection:{value:new e.Vector3},map:{value:l||new e.Texture},noiseMap:{value:new e.Texture},overlayMap:{value:new e.Texture}}})}f.translate(0,.5,0);
},{"three":"IV0r","../shaders/sprite.frag":"ppeB","../shaders/sprite.vert":"veYI","../tags":"injP","../shaders/toon.frag":"HqM0","../shaders/toon.vert":"iahN","./ShaderManager":"igLh","../util/tokens":"kL9I","./SpriteManager":"Ffhm","./Assets":"Wm90","./three-util":"bI4v"}],"ryhr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=p;var e=d(require("../tags")),t=d(require("three")),n=d(require("../util/math")),a=d(require("eases")),o=require("../util/locale"),r=require("./AnimationSystem"),i=require("../util/materials"),s=u(require("../util/Assets")),l=d(require("../util/ShaderManager"));function u(e){return e&&e.__esModule?e:{default:e}}function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var i=o?Object.getOwnPropertyDescriptor(e,r):null;i&&(i.get||i.set)?Object.defineProperty(a,r,i):a[r]=e[r]}return a.default=e,n&&n.set(e,a),a}function p(u){const c=new t.Group;c.name="compass",u.entity().add(e.Object3D,c);const d=u.findTag(e.Renderer),p=new t.Color(1,1,1),g=new t.Color("#280422").lerp(p,.9),f=p,v=new t.TorusGeometry(1.25,.025,6,24);v.rotateX(-Math.PI/2),v.translate(0,.0125,0);const[m]=s.default.createGPUTextureTask(d,"image/data/compass-ring"),y=new t.PlaneBufferGeometry(1,1,1,1);y.rotateX(-Math.PI/2);const T=l.create({name:"CompassRingShader",vertexShader:"\n      varying vec2 vUv;\n      void main () {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n        vUv = uv;\n      }\n    ",fragmentShader:"\n      varying vec2 vUv;\n      uniform sampler2D map;\n      uniform vec3 color;\n      uniform float opacity;\n\n      void main () {\n        vec4 tColor = texture2D(map, vUv);\n        if (tColor.a <= 0.5) discard;\n        gl_FragColor = vec4(color * tColor.rgb, tColor.a * opacity);\n        // gl_FragColor = vec3(vec3(0.5), tColor.a);\n      }\n    ",uniforms:{color:{value:new t.Color(1.5,1.5,1.5)},opacity:{value:1},map:{value:m}},transparent:!0}),h=T,D=new t.Mesh(y,h);c.add(D);const k=T.clone();k.uniforms.color.value=g.clone(),k.uniforms.map.value=m,k.blending=t.MultiplyBlending,k.needsUpdate=!0;const w=new t.Mesh(y,k),M=u.findTag(e.RenderLayers);c.add(w),w.layers.set(M.shadow);const S=new t.MeshBasicMaterial({transparent:!0,color:new t.Color(1.5,1.5,1.5)}),b=new t.Group;c.add(b);const A=new Array(3).fill(null).map(()=>{const e=new t.Mesh((0,i.getSpriteGeometry)(),(0,i.createTokenMaterial)());return e.renderOrder=10,e.name="dot",e.userData.currentAngle=null,e.userData.currentSize=0,e.userData.lastToken=null,e.userData.lastTokenType=null,b.add(e),e}),C=new Array(4).fill().map((e,n)=>{const a=new t.Mesh(y,S);return c.add(a),a.renderOrder=1,a.scale.setScalar(n<=2?.5:1),a.userData.currentAngle=null,a.visible=!1,a});let q=!1,O=!1;const P=()=>{O=!0,s.default.createGPUTexture(d,"image/data/compass-arrow3").then(e=>{q=!0,S.map=e,S.needsUpdate=!0,C.forEach(e=>{})})},x=(u.view([e.GroundAsset,e.GroundAssetToken]),u.view(e.EnvironmentCell),u.findTag(e.TokensDiscoveredSet)),U=u.view([e.EnvironmentState,e.ActiveEnvironmentState]),z=A.map(()=>({distanceSq:1/0,token:null,consumed:!1})),E=u.entity(),j={value:0},G=u.findTag(e.UserTarget),V=u.findTag(e.UserCharacter),_=u.view([e.WrittenStanzaLine,e.WrittenStanzaLineActive]);let B=!1;const I=u.view(e.CompassVisible),F=new t.Vector3,W=u.view(e.TutorialMessage),R=u.listen(e.CompassVisible);return t=>{if(!U.length)return;const s=U[0];let l=!1;if(G&&G.forceApplied&&I.forEach(t=>{t.get(e.CompassVisible).position.distanceToSquared(G.position)>=100&&t.tagOff(e.CompassVisible)}),I.length>0){const t=I[0];t.has(e.CompassVisible)&&(l=!0,F.copy(t.get(e.CompassVisible).position))}const p=u.findTag(e.OriginTreeIntroSequence),v=!u.findTag(e.HideCharacter),m=Boolean(u.findTag(e.DirectUserToOrigin)),y=u.findTag(e.TutorialState),T=u.findTag(e.HaikuCardShown),h=u.findTag(e.ShowBiomeResolution),k=(V.position.lengthSq(),I.length>0),M=v&&(m&&!h||k&&0===_.length&&!T&&!y&&!p&&!h);if(c.visible=j.value>=1e-5,R.changed&&!m&&(W.forEach(t=>{t.get(e.TutorialMessage);t.kill()}),R.added.length)){const t=u.entity().add(e.TutorialMessage).get(e.TutorialMessage);t.id="comapss",t.message=o.localize.get().tutorialCollect,t.iconMode="token-random",t.delay=0,t.duration=6}if(B!==M){E.tagOff(e.TargetKeyTween),(0,r.setEntityTweenFromTo)(E,j,"value",j.value,M?1:0,M?2:.5,"sineOut",0);const t=E.get(e.TargetKeyTween);t.killEntityOnFinish=!1,t.assignFromOnStart=!0,B=M}c.position.distanceToSquared(V.position)>=100?c.position.copy(V.position):n.dampVector(c.position,V.position,10,t,c.position),w.material.uniforms.color.value.copy(f).lerp(g,j.value),D.material.uniforms.opacity.value=j.value;const b=2.8125*n.lerp(1.15,1,a.sineInOut(j.value));D.scale.x=b,D.scale.z=b,S.opacity=j.value,A.forEach(e=>e.material.uniforms.opacity.value=j.value),D.position.y=.3,w.position.y=.01,w.scale.copy(D.scale),D.rotation.y+=.5*t,w.rotation.y=D.rotation.y;const H=V.position.x,K=V.position.z,X=s.get(e.EnvironmentState).tokens,J=Boolean(u.findTag(e.DirectUserToOrigin)),N=Boolean(u.findTag(e.BlockTokenCollection)),Q=!p&&!J&&!N;if(l){for(let e=0;e<z.length;e++)z[e].distanceSq=1/0,z[e].token=null,z[e].consumed=!1;l=!1;for(let e=0;e<X.length;e++){const t=X[e],n=!x.has(t.type);if(!(Q&&n))continue;const a=t.position[0],o=t.position[1],r=a-F.x,i=o-F.z,s=r*r+i*i;s<=z[0].distanceSq?(z[0].distanceSq=s,z[0].token=t):s<=z[1].distanceSq?(z[1].distanceSq=s,z[1].token=t):s<=z[2].distanceSq&&(z[2].distanceSq=s,z[2].token=t)}}const Y=C[C.length-1];let Z=Y.userData.currentAngle;if(m){const e=0-H,t=0-K;Z=Math.atan2(t,e),O||P(),Y.material.opacity=j.value}if(Y.visible=q&&m,D.visible=j.value>=1e-5,w.visible=D.visible,null!=Z){null==Y.userData.currentAngle&&(Y.userData.currentAngle=Z),Y.userData.currentAngle=n.dampAngle(Y.userData.currentAngle,Z,10,t);const e=Y.userData.currentAngle,a=2.25+.1*.5,o=Math.cos(e)*a,r=Math.sin(e)*a;Y.position.set(o,D.position.y,r),Y.rotation.y=Math.PI+Math.PI/2+-e}for(let e=0;e<A.length;e++){const a=A[e],o=C[e];a.visible=!1,o.visible=!1;let r=0,s=a.userData.currentAngle;const l=L(a);if(l){l.consumed=!0;const e=l.token;a.userData.lastToken=e;const t=e.position[0]-H,n=e.position[1]-K;Math.sqrt(t*t+n*n);s=Math.atan2(n,t),r=1,null==a.userData.currentAngle&&(a.userData.currentAngle=s)}else a.userData.lastToken=null;a.userData.currentAngle=n.dampAngle(a.userData.currentAngle,s,10,t),a.userData.currentSize=n.dampAngle(a.userData.currentSize,r,5,t);const u=a.userData.currentAngle;if(null!=u){const e=a.userData.currentSize,t=Math.cos(u),n=Math.sin(u),r=.7,s=2+.1*r,l=t*s,c=n*s;a.position.set(l,D.position.y-.25,c),a.scale.setScalar(r),a.visible=e>=1e-5&&!m,a.visible&&a.userData.lastToken&&a.userData.lastTokenType!==a.userData.lastToken.type&&(a.userData.lastTokenType=a.userData.lastToken.type,(0,i.setSpriteToken)(d,a,a.userData.lastTokenType));const p=s+.75;h||m?o.visible=!1:(o.visible=!0,o.position.set(t*p,D.position.y,n*p),o.rotation.y=Math.PI+Math.PI/2+-u,O||P())}else a.visible=!1,o.visible=!1}};function L(e){const t=e.userData.lastToken;if(t){const e=z.find(e=>e.token===t);if(e&&!e.consumed&&e.token)return e}return z.find(e=>e.token&&!e.consumed)}}
},{"../tags":"injP","three":"IV0r","../util/math":"Ov1X","eases":"uiPX","../util/locale":"dkeN","./AnimationSystem":"cUmx","../util/materials":"phuP","../util/Assets":"Wm90","../util/ShaderManager":"igLh"}],"lpwT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=a(require("../tags")),t=a(require("three")),r=a(require("../util/math")),n=require("./AnimationSystem"),o=require("../util/materials");function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function a(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var u=o?Object.getOwnPropertyDescriptor(e,a):null;u&&(u.get||u.set)?Object.defineProperty(n,a,u):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function u(r){const n=new t.Group;n.name="compass",r.entity().add(e.Object3D,n);r.view([e.GroundAsset,e.GroundAssetToken]),r.view(e.EnvironmentCell);const i=r.findTag(e.TokensDiscoveredSet),a=r.view([e.EnvironmentState,e.ActiveEnvironmentState]),u=r.findTag(e.UserTarget);r.findTag(e.UserCharacter),new Array(3).fill(null).map(()=>{const e=new t.Mesh((0,o.getSpriteGeometry)(),(0,o.createTokenMaterial)());return e.renderOrder=10,e.name="dot",e.userData.currentAngle=null,e.userData.currentSize=0,e.userData.lastToken=null,e.userData.lastTokenType=null,n.add(e),e});return t=>{if(!a.length)return;const n=a[0].get(e.EnvironmentState).tokens,o=Boolean(r.findTag(e.DirectUserToOrigin)),s=Boolean(r.findTag(e.BlockTokenCollection)),l=!o&&!s,c=n.filter(e=>{const t=!i.has(e.type);return l&&t}).map(e=>{const t=e.position[0],r=e.position[1],n=t-u.position.x,o=r-u.position.z;return[n*n+o*o,e]});c.sort((e,t)=>e[0]-t[0]);c.slice(0,3).map(e=>e[1])}}
},{"../tags":"injP","three":"IV0r","../util/math":"Ov1X","./AnimationSystem":"cUmx","../util/materials":"phuP"}],"quSS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=a,exports.setPlayerPos=i,exports.playerStart=exports.standingNextToOriginTree=void 0;var e=r(require("three"));function t(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,n=new WeakMap;return(t=function(e){return e?n:r})(e)}function r(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=t(r);if(n&&n.has(e))return n.get(e);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(o,i,s):o[i]=e[i]}return o.default=e,n&&n.set(e,o),o}const n=new e.Vector3(7,0,3);exports.standingNextToOriginTree=n;const o=new e.Vector3(7,0,3);function a(e){i(e,o),e.findTag(Tags.UserTarget).position.set(0,0,0)}function i(e,t){e.findTag(Tags.UserTarget).position.copy(t);const r=e.findTag(Tags.UserCharacter);r&&r.position.copy(t)}exports.playerStart=o;
},{"three":"IV0r"}],"e7jH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=s;var e=l(require("three")),t=l(require("../tags")),n=l(require("../util/math")),o=r(require("../util/Random")),a=require("../util/resetPlayerPos");function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var l=a?Object.getOwnPropertyDescriptor(e,r):null;l&&(l.get||l.set)?Object.defineProperty(o,r,l):o[r]=e[r]}return o.default=e,n&&n.set(e,o),o}function s(a){const r=new e.Vector2,i=new e.Raycaster,l=new e.Plane(new e.Vector3(-0,-1,-0),-0),s=new e.Vector3,p=new e.Vector3,c=(0,o.default)(),d=new e.Vector3,u=new e.Vector3;let f=0,g=0;let m,y,v=.5,h=n.degToRad(45*c.pick([1,3,5,7]));const M=a.entity("UserTargetEntity").add(t.UserTarget),w=a.query(t.InputState),T=a.query(t.MainCamera),O=a.query(t.UserTarget),P=a.view(t.MovementBoost),B=a.view(t.ClearInputPress);let b=null;return function(e){let o=Boolean(a.findTag(t.BlockUserMove)),c=Boolean(a.findTag(t.CameraStopUserMovement)),x=Boolean(a.findTag(t.TransitionToNextBiome))||Boolean(a.findTag(t.ShowBiomeResolution));const U=a.findTag(w),q=a.findTag(T),A=a.findEntity(O),j=A.get(t.UserTarget),S=j.position;r.set(2*U.positionNormalized.x-1,2*-U.positionNormalized.y+1),i.setFromCamera(r,q);const z=B.length>0,V=!z&&i.ray.intersectPlane(l,s);let k=1,C=x||U.interacted&&!o;if(V&&C){p.set(S.x,0,S.z);a.findTag(t.UserCharacter);d.copy(s).sub(p);const e=d.length();0!==e&&d.divideScalar(e),k*=n.clamp01(Math.pow(e/4,.04)),m=Math.atan2(d.z,d.x),null==y&&(y=m)}null!=y&&null!=m&&(y=n.dampAngle(y,m,7,e),u.set(Math.cos(y),0,Math.sin(y)));const _=Boolean(a.findTag(t.IsGameUIActive)),D=!z&&!c&&C&&!_&&!Boolean(a.findTag(t.OriginTreeIntroSequence))&&!Boolean(a.findTag(t.ModalStoppingUserMovement));let I=!1;(U.pressed||x)&&D?(I=!0,f=n.damp(f,3,5,e),g=n.damp(g,4.5,2,e)):(f=n.damp(f,0,2,e),g=n.damp(g,0,5,e)),I!==b&&(I?M.tagOn(t.UserForceApplied):M.tagOff(t.UserForceApplied),b=I);let N=(f*=k)+(g*=k),L=0;P.forEach(o=>{const a=o.get(t.MovementBoost);L+=a.value,a.value=n.damp(a.value,1e-4,a.frictionPower,e),a.elapsed+=e,a.elapsed>=a.duration&&o.kill()});let R=e*N*1+1*L*e;D&&S.addScaledVector(u,R);const E=a.findTag(t.GameLandingCameraDrift);let F=v;if(U.interacted&&C){const e=2*U.positionNormalized.x-1,t=2*U.positionNormalized.y-1,o=n.clamp01(Math.sqrt(e*e+t*t));F=n.lerp(.1,.75,Math.pow(o,.5))}E&&null!=E.fixed&&(F=E.fixed);const W=null!=y?y:h;if(h=n.dampAngle(h,W,3,e),v=n.dampAngle(v,F,5,e),E&&(p.set(Math.cos(h),0,Math.sin(h)),S.addScaledVector(p,e*v)),S.x=n.clamp(-243.2,243.2,S.x),S.z=n.clamp(-243.2,243.2,S.z),j.forceApplied=I,j.direction.copy(u),j.totalBoost=L,j.speedAlpha=n.inverseLerp(0,3,f),j.boostAlpha=n.inverseLerp(0,4.5,g),j.totalSpeedAlpha=n.inverseLerp(0,7.5,N),j.inputHitPlane=V,V&&j.inputPositionOnPlane.copy(s),A.has(t.Object3D)){A.get(t.Object3D).position.copy(S)}}}
},{"three":"IV0r","../tags":"injP","../util/math":"Ov1X","../util/Random":"LMfK","../util/resetPlayerPos":"quSS"}],"AoHq":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n#define GLSLIFY 1\n// #define IS_CLOSED\nattribute float direction;\nattribute vec2 vertexDistance;\nattribute vec3 nextPosition;\nattribute vec3 previousPosition;\nattribute float vertexHasToken;\nuniform bool taper;\nuniform bool miter;\nuniform float time;\nuniform float totalDistance;\nuniform float miterLimit;\nuniform float thickness;\nuniform float draw;\nuniform bool drawing;\nuniform bool filling;\nuniform vec2 resolution;\nvarying float vToken;\nvarying vec2 vDist;\nvec4 screenSpaceLine (vec3 offset, float computedThickness) {\n    float aspect = resolution.x / resolution.y;\n  vec2 aspectVec = vec2(aspect, 1.0);\n  mat4 projViewModel = projectionMatrix * modelViewMatrix;\n  vec4 previousProjected = projViewModel * vec4(vec3(previousPosition.xyz) + offset, 1.0);\n  vec4 currentProjected = projViewModel * vec4(vec3(position.xyz) + offset, 1.0);\n  vec4 nextProjected = projViewModel * vec4(vec3(nextPosition.xyz) + offset, 1.0);\n  //get 2D screen space with W divide and aspect correction\n  vec2 currentScreen = currentProjected.xy / currentProjected.w * aspectVec;\n  vec2 previousScreen = previousProjected.xy / previousProjected.w * aspectVec;\n  vec2 nextScreen = nextProjected.xy / nextProjected.w * aspectVec;\n\n  float len = computedThickness;\n  float orientation = direction;\n  vec2 dirA = normalize(currentScreen - previousScreen);\n  //starting point uses (next - current)\n  vec2 dir = vec2(0.0);\n  #ifndef IS_CLOSED\n  if (currentScreen == previousScreen) {\n      dir = normalize(nextScreen - currentScreen);\n  }\n  //ending point uses (current - previous)\n  else if (currentScreen == nextScreen) {\n      dir = normalize(currentScreen - previousScreen);\n  }\n  //somewhere in middle, needs a join\n  else {\n    #endif\n    //get directions from (C - B) and (B - A)\n    vec2 dirB = normalize(nextScreen - currentScreen);\n    if (miter) {\n        //now compute the miter join normal and length\n      vec2 tangent = normalize(dirA + dirB);\n      vec2 perp = vec2(-dirA.y, dirA.x);\n      vec2 miter = vec2(-tangent.y, tangent.x);\n      float miterDot = dot(miter, perp);\n      len = miterDot == 0.0 ? 0.0 : (computedThickness / miterDot);\n      len = clamp(len, 0.0, computedThickness * miterLimit);\n      dir = tangent;\n    } else {\n        dir = normalize(dirA + dirB);\n    }\n  #ifndef IS_CLOSED\n  }\n  #endif\n  vec2 normal = vec2(-dir.y, dir.x);\n  // convert pixel thickness to NDC space\n  vec2 normalLength = vec2(len / 2.0);\n  normalLength = normalLength * 2.0;\n  // scale normal to line thickness\n  normal *= normalLength;\n  normal.x /= aspect;\n  vec4 finalOffset = vec4(normal * orientation, 0.0, 0.0);\n  return currentProjected + finalOffset;\n}\nfloat cubicPulse( float c, float w, float x )\n{\n    x = abs(x - c);\n  if( x>w ) return 0.0;\n  x /= w;\n  return 1.0 - x*x*(3.0-2.0*x);\n}\nfloat parabola( float x, float k )\n{\n      return pow( 4.0*x*(1.0-x), k );\n}\nvoid main () {\n    float computedThickness = thickness;\n  // computedThickness *= mix(0.5, 1.0, vertexHasToken);\n  if (taper) computedThickness *= sin(3.14 * vertexDistance.x);\n  if (drawing) {\n      computedThickness *= smoothstep(1.0, 1.0-0.05, vertexDistance.x);\n    computedThickness *= smoothstep(0.0, 0.05, vertexDistance.x);\n    // computedThickness *= smoothstep(draw - smoothness, draw + smoothness, vertexDistance.x);\n    float e = 0.25;\n    float t = draw;\n    // computedThickness *= parabola(vertexDistance.x, 1.0);\n    float m = mix(-e, 1.0 + e, t);\n    float d = 1.0 - min(1.0, abs(vertexDistance.x - m) / e);\n    // computedThickness *= step(t, vertexDistance.x);\n    // float d = smoothstep(m + e, m - e, vertexDistance.x);\n    computedThickness *= cubicPulse(m, e, vertexDistance.x);\n    // computedThickness *= smoothstep(totalDistance, totalDistance / 2.0, vertexDistance.y);\n  } else if (filling) {\n      computedThickness *= step(vertexDistance.x, draw);\n  }\n  // computedThickness *= abs(vertexDistance.y / )\n  float yoff = sin(time + vertexDistance.x * 4.0) * 0.1;\n  vec3 offset = vec3(0.0, 0.0, 0.0);\n  // offset.y += 2.0 + sin(position.y * 4.0) * 2.0;\n  gl_Position = screenSpaceLine(offset, computedThickness);\n  vDist = vertexDistance;\n  vToken = vertexHasToken;\n}\n";
},{}],"zXs4":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n#define GLSLIFY 1\nuniform vec3 color;\nuniform float opacity;\nuniform float time;\nuniform float totalDistance;\nuniform float dottedFill;\nuniform bool dotted;\nvarying vec2 vDist;\nvarying float vToken;\nfloat aastep(float threshold, float value) {\n    #ifdef GL_OES_standard_derivatives\n    float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;\n    return smoothstep(threshold-afwidth, threshold+afwidth, value);\n  #else\n    return step(threshold, value);\n  #endif\n}\nvoid main() {\n    float d = vDist.y / totalDistance;\n  gl_FragColor = vec4(color, opacity);\n  if (dotted) {\n      // float dotted = vToken > 0.5 ? 1.0 : step(0.5, fract(-time * 0.2 + vDist.y / 1.0));\n    float dotted = fract(-time * 0.2 + vDist.y / 0.5);\n    dotted = mix(dotted, 1.0, step(vDist.x, dottedFill));\n    gl_FragColor.a *= aastep(0.5, dotted);\n  }\n  // if (gl_FragColor.a < 0.5) discard;\n  // gl_FragColor = vec4(mix(vec3(1.0), vec3(1.0,0.0,0.0), vToken) * vec3(d), opacity);\n}\n";
},{}],"LVel":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n#define GLSLIFY 1\nuniform highp sampler2D map;\nuniform sampler2D noiseMap;\nuniform sampler2D lutMap;\nuniform sampler2D glowMap;\nuniform float fadeToBlack;\nuniform vec3 fadeToBlackColor;\nuniform vec2 resolution;\nuniform vec3 rampColor0;\nuniform vec3 rampColor1;\nuniform float time;\nuniform float rampStrength;\nuniform float lightColor;\nvarying vec2 vUv;\n// uniform vec3 colorGradientA;\n// vec3 texGlowMap(vec2 uv);\n// #pragma glslify: blur = require('glsl-hash-blur', sample=texGlowMap, iterations=20)\n// vec3 texGlowMap(vec2 uv) {\n  //   return texture2D(glowMap, uv).rgb;\n// }\nfloat blendOverlay(float base, float blend) {\n  return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n}\nvec3 blendOverlay(vec3 base, vec3 blend) {\n  return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n}\nvec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n  return (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n}\nfloat blendSoftLight(float base, float blend) {\n  return (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n}\nvec3 blendSoftLight(vec3 base, vec3 blend) {\n  return vec3(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b));\n}\nvec3 blendSoftLight(vec3 base, vec3 blend, float opacity) {\n  return (blendSoftLight(base, blend) * opacity + base * (1.0 - opacity));\n}\n// #define LUT_FLIP_Y\nhighp vec3 colorLUT(in highp vec3 textureColor, in highp sampler2D lookupTable) {\n    textureColor = clamp(textureColor, 0.0, 1.0);\n  highp float blueColor = textureColor.b * 63.0;\n  highp vec2 quad1;\n  quad1.y = floor(floor(blueColor) / 8.0);\n  quad1.x = floor(blueColor) - (quad1.y * 8.0);\n  highp vec2 quad2;\n  quad2.y = floor(ceil(blueColor) / 8.0);\n  quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n  highp vec2 texPos1;\n  texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n  texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g);\n  // #ifdef LUT_FLIP_Y\n  texPos1.y = 1.0-texPos1.y;\n  // #endif\n  highp vec2 texPos2;\n  texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n  texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g);\n  // #ifdef LUT_FLIP_Y\n  texPos2.y = 1.0-texPos2.y;\n  // #endif\n  highp vec3 newColor1 = texture2D(lookupTable, texPos1).rgb;\n  highp vec3 newColor2 = texture2D(lookupTable, texPos2).rgb;\n  highp vec3 newColor = mix(newColor1, newColor2, fract(blueColor));\n  return newColor;\n}\n/**\nBasic FXAA implementation based on the code on geeks3d.com with the\nmodification that the texture2DLod stuff was removed since it's\nunsupported by WebGL.\n--\nFrom:\nhttps://github.com/mitsuhiko/webgl-meincraft\nCopyright (c) 2011 by Armin Ronacher.\nSome rights reserved.\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are\nmet:\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n    * The names of the contributors may not be used to endorse or\n      promote products derived from this software without specific\n      prior written permission.\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n\\\"AS IS\\\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n#ifndef FXAA_REDUCE_MIN\n    #define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n    #define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n    #define FXAA_SPAN_MAX     8.0\n#endif\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n            vec2 v_rgbNW, vec2 v_rgbNE,\n            vec2 v_rgbSW, vec2 v_rgbSE,\n            vec2 v_rgbM) {\n      vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n              dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n          texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n          texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n//To save 9 dependent texture reads, you can compute\n//these in the vertex shader and use the optimized\n//frag.glsl function in your frag shader.\n//This is best suited for mobile devices, like iOS.\nvoid texcoords(vec2 fragCoord, vec2 resolution,\nout vec2 v_rgbNW, out vec2 v_rgbNE,\nout vec2 v_rgbSW, out vec2 v_rgbSE,\nout vec2 v_rgbM) {\n  vec2 inverseVP = 1.0 / resolution.xy;\nv_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\nv_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\nv_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\nv_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\nv_rgbM = vec2(fragCoord * inverseVP);\n}\nvec4 apply(sampler2D tex, vec2 fragCoord, vec2 resolution) {\n  mediump vec2 v_rgbNW;\nmediump vec2 v_rgbNE;\nmediump vec2 v_rgbSW;\nmediump vec2 v_rgbSE;\nmediump vec2 v_rgbM;\n//compute the texture coords\ntexcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n//compute FXAA\nreturn fxaa(tex, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n#define gamma 2.2\nvec2 rotateAround (vec2 vec, vec2 center, float angle) {\n    float c = cos( angle );\n  float s = sin( angle );\n  float x = vec.x - center.x;\n  float y = vec.y - center.y;\n  vec2 outVec;\n  outVec.x = x * c - y * s + center.x;\n  outVec.y = x * s + y * c + center.y;\n  return outVec;\n}\nfloat linearGradient (vec2 uv, vec2 start, vec2 end) {\n    vec2 gradientDirection = end - start;\n  float gradientLenSq = dot(gradientDirection, gradientDirection);\n  vec2 relCoords = uv - start;\n  float t = dot(relCoords, gradientDirection);\n  if (gradientLenSq != 0.0) t /= gradientLenSq;\n  return t;\n}\nvec4 texLinear (sampler2D image, vec2 uv) {\n    return texture2D(image, uv);\n  // return GammaToLinear(texture2D(image, uv), gamma);\n}\nvec4 chromatic (sampler2D image, vec2 uv, vec2 direction) {\n    vec4 col = vec4( 0.0 );\n  vec2 off = vec2( 1.3333333333333333 ) * direction;\n  col.a = 1.0;\n  col.r = texture2D( image, uv ).r;\n  col.g = texture2D( image, uv - ( off / resolution ) ).g;\n  col.b = texture2D( image, uv - 2.0 * ( off / resolution ) ).b;\n  return col;\n}\nvec3 linearToneMapping(vec3 color)\n{\n    float exposure = 1.;\n  color = clamp(exposure * color, 0., 1.);\n  color = pow(color, vec3(1. / gamma));\n  return color;\n}\nvec3 simpleReinhardToneMapping(vec3 color)\n{\n    float exposure = 1.5;\n  color *= exposure/(1. + color / exposure);\n  color = pow(color, vec3(1. / gamma));\n  return color;\n}\nvec3 lumaBasedReinhardToneMapping(vec3 color)\n{\n  float luma = dot(color, vec3(0.2126, 0.7152, 0.0722));\nfloat toneMappedLuma = luma / (1. + luma);\ncolor *= toneMappedLuma / luma;\ncolor = pow(color, vec3(1. / gamma));\nreturn color;\n}\nvec3 whitePreservingLumaBasedReinhardToneMapping(vec3 color)\n{\n  float white = 2.;\nfloat luma = dot(color, vec3(0.2126, 0.7152, 0.0722));\nfloat toneMappedLuma = luma * (1. + luma / (white*white)) / (1. + luma);\ncolor *= toneMappedLuma / luma;\ncolor = pow(color, vec3(1. / gamma));\nreturn color;\n}\nvec3 RomBinDaHouseToneMapping(vec3 color)\n{\n      color = exp( -1.0 / ( 2.72*color + 0.15 ) );\ncolor = pow(color, vec3(1. / gamma));\nreturn color;\n}\nvec3 filmicToneMapping(vec3 color)\n{\n  color = max(vec3(0.), color - vec3(0.004));\ncolor = (color * (6.2 * color + .5)) / (color * (6.2 * color + 1.7) + 0.06);\nreturn color;\n}\nvec4 sharpen(in sampler2D tex, in vec2 coords, in vec2 renderSize) {\n    float dx = 1.0 / renderSize.x;\n  float dy = 1.0 / renderSize.y;\n  vec4 sum = vec4(0.0);\n  sum += -1. * texture2D(tex, coords + vec2( -1.0 * dx , 0.0 * dy));\n  sum += -1. * texture2D(tex, coords + vec2( 0.0 * dx , -1.0 * dy));\n  sum += 5. * texture2D(tex, coords + vec2( 0.0 * dx , 0.0 * dy));\n  sum += -1. * texture2D(tex, coords + vec2( 0.0 * dx , 1.0 * dy));\n  sum += -1. * texture2D(tex, coords + vec2( 1.0 * dx , 0.0 * dy));\n  return sum;\n}\nvoid main2 () {\n    gl_FragColor = texture2D(map, vUv);\n}\nvoid main () {\n    vec2 nq = vUv / (20.0 / resolution.xy);\n  float aspect = resolution.x / resolution.y;\n  // if (aspect > 1.0) nq.x *= aspect;\n  // else nq.y /= aspect;\n  vec4 noise = texture2D(noiseMap, nq);\n  vec2 q = vUv - 0.5;\n  float d = length(q);\n  float caVig = smoothstep(0.3, 0.75, d);\n  vec2 direction = ( vUv - 0.5 ) * mix(0.5, 4.0, caVig) * noise.r * 1.0;\n  // vec2 direction = ( vUv - 0.5 ) * caVig * noise.r * 4.0;\n  // vec2 direction = ( vUv - 0.5 ) * 2.0 * noise.r;\n  // vec3 colorTex = mix(\n    //   chromatic(map, vUv, direction).rgb,\n  //   sharpen(map, vUv, resolution).rgb,\n  //   0.25\n  // );\nvec2 fragCoord = vUv * resolution;\n// vec3 colorTex = mix(\n    //   fxaa(map, fragCoord, resolution).rgb,\n  //   sharpen(map, vUv, resolution).rgb,\n  //   0.25\n  // );\n  // vec3 colorTex = fxaa(map, fragCoord, resolution).rgb;\n  vec3 colorTex = clamp(chromatic(map, vUv, direction).rgb, 0.0, 1.0);\n  // vec3 colorTex = texture2D(map, vUv).rgb;\n  // vec3 colorTex = mix(\n    //   chromatic(map, vUv, direction).rgb,\n  //   fxaa(map, fragCoord, resolution).rgb,\n  //   1.0-caVig\n  // );\n  // vec3 raw = colorTex;\n  vec2 corner = vec2(1.0, 1.0);\n  vec2 delta = vUv - corner;\n  if (aspect < 1.0) delta.x *= aspect;\n  else delta.y /= aspect;\n  float gradDist = clamp(1.0 - length(delta), 0.0, 1.0);\n  // colorTex.rgb += mix(rampColor0, rampColor1, vUv.y) * 0.1;\n  // colorTex.rgb = blendSoftLight(colorTex, colorTex + mix(rampColor0, rampColor1, vUv.y), 0.25);\n  // colorTex += gradDist * 0.1;\n  // colorTex = blendOverlay(colorTex, colorTex + gradDist , 0.05);\n  // colorTex += mix(rampColor0, rampColor1, vUv.y) * 0.05;\n  // colorTex.rgb = blendSoftLight(colorTex, mix(rampColor0, rampColor1, vUv.y), 0.1);\n  float vignetteStrength = 1.0;\n  float vignetteDarken = 0.2;\n  colorTex = blendSoftLight(colorTex, (noise.rgb*2.0-1.0), 0.05);\n  // colorTex.rgb = colorLUT(colorTex.rgb, lutMap);\n  colorTex = mix(colorTex, colorTex * smoothstep(1.0, 0.35, d), vignetteStrength * vignetteDarken);\n  colorTex = blendOverlay(colorTex, colorTex * 1.0, smoothstep(0.3, 1.0, d) * vignetteStrength);\n  colorTex = blendOverlay(colorTex, colorTex * 0.5, smoothstep(0.4, 0.9, d) * vignetteStrength);\n  gl_FragColor = vec4(vec3(colorTex), 1.0);\n  // color ramp\n  // vec3 colorRamp = mix(rampColor0, rampColor1, linearGradient(\n    //   vUv + noise.rg * 0.05,\n  //   vec2(1.0, 0.0),\n  //   vec2(0.0, 1.0)\n  // ));\n  // gl_FragColor.rgb = blendOverlay(gl_FragColor.rgb, colorRamp, rampStrength);\n  gl_FragColor.rgb = colorLUT(gl_FragColor.rgb, lutMap);\n\n  // float lightRamp = linearGradient(\n    //   vUv + noise.ba * 0.05,\n  //   vec2(0.0, 0.0),\n  //   vec2(1.0, 1.0)\n  // );\n  // lightRamp = pow(lightRamp, 3.5);\n  // float sa = sin(vUv.x * 10.0 + vUv.y * -5.0 + 0.5);\n  // float sb = sin(vUv.x * 7.0 + vUv.y * -7.0 + time * 0.0);\n  // float str = 1.0;//. mix(0.0, 1.0, sin(time * 0.25 + vUv.x * 3.5)*0.5+0.5);\n  // float lightStr = lightRamp;\n  // float lightStr = step(0.5, ((sa * sb) * 0.5 + 0.5));\n  // lightRamp = smoothstep(0.5, 1.0, lightRamp);\n  // gl_FragColor.rgb = blendSoftLight(gl_FragColor.rgb, vec3(1.5), rampStrength * lightStr);\n  // gl_FragColor.rgb = blendSoftLight(gl_FragColor.rgb, vec3(1.0), rampStrength * lightStr * 0.1 * lightRamp);\n  #ifdef HAS_FLOAT\n  gl_FragColor.rgb += clamp(texture2D(glowMap, vUv).rgb, 0.0, 1.0);\n  #endif\n  // gl_FragColor.rgb += vec3(lightStr);\n  gl_FragColor.rgb = clamp(gl_FragColor.rgb, 0.0, 1.0);\n  gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(fadeToBlackColor), fadeToBlack);\n  // gl_FragColor.rgb = texture2D(glowMap, vUv).rgb;\n  // gl_FragColor.rgb += blur(vUv,10.0/resolution.x, 1.0);\n}\n//524b19\n// 47411A\";\n";
},{}],"y2ec":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n#define GLSLIFY 1\nuniform vec2 resolution;\nuniform sampler2D map;\nuniform vec2 direction;\nvarying vec2 vUv;\nvec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n    vec4 color = vec4(0.0);\n    vec2 off1 = vec2(1.411764705882353) * direction;\n    vec2 off2 = vec2(3.2941176470588234) * direction;\n    vec2 off3 = vec2(5.176470588235294) * direction;\n    color += texture2D(image, uv) * 0.1964825501511404;\n    color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n    color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n    color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n    color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n    color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n    color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n    return color;\n}\nvoid main() {\n    // gl_FragColor = texture2D(map, gl_FragCoord.xy /resolution.xy);\n    gl_FragColor = blur13(map, vUv, resolution.xy, direction);\n}\n";
},{}],"olzJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=h,exports.GLOW_LAYER=void 0;var e=g(require("../tags")),t=g(require("three")),a=d(require("../shaders/post-process.frag")),r=d(require("../util/query-string")),n=require("../util/load"),i=d(require("../shaders/post-process-bloom-glow.frag")),l=require("./AnimationSystem"),o=g(require("../util/ShaderManager")),s=d(require("../util/Assets")),u=require("../util/addFrameTasks");function d(e){return e&&e.__esModule?e:{default:e}}function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(m=function(e){return e?a:t})(e)}function g(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=m(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var l=n?Object.getOwnPropertyDescriptor(e,i):null;l&&(l.get||l.set)?Object.defineProperty(r,i,l):r[i]=e[i]}return r.default=e,a&&a.set(e,r),r}const c="image/data/lut-forest",f="image/data/bluenoise-0",p=12;function h(n,d={}){const{fade:m=0}=d,g=n.findTag(e.Renderer),c=g.capabilities.isWebGL2||Boolean(g.extensions.get("OES_texture_half_float")),p=g.capabilities.isWebGL2||Boolean(g.extensions.get("OES_texture_float"));let h,v,b,w;const T=512,_=512,x=!1!==r.default.ground,y=!1!==r.default.groundNormalElement,M=!1!==r.default.float,S=!1!==r.default.post,F=M&&(c||p);let D=null;const O=new t.Texture;O.minFilter=O.magFilter=t.LinearFilter,O.generateMipmaps=!1;const[L]=s.default.createGPUTextureTask(g,f,{wrapS:t.RepeatWrapping,wrapT:t.RepeatWrapping}),W=n.view([e.ShadowCaster,e.Object3D]),C=new t.Scene,P=new t.OrthographicCamera(-1,1,1,-1,0,1),A=new t.BufferGeometry;A.setAttribute("position",new t.Float32BufferAttribute([-1,-1,-1,4,4,-1],2));const R="\n    varying vec2 vUv;\n    void main () {\n      vUv = position.xy * 0.5 + 0.5;\n      gl_Position = vec4(position.xy, 0.0, 1.0);\n    }\n  ",k=(new t.ShaderMaterial({name:"GlowPass1Material",depthWrite:!0,depthTest:!1,uniforms:{map:{value:new t.Texture}},side:t.BackSide,vertexShader:R,fragmentShader:"\n      varying vec2 vUv;\n      uniform sampler2D map;\n      void main () {\n        gl_FragColor = texture2D(map, vUv);\n      }\n    "}),new t.ShaderMaterial({name:"GlowPass0Material",depthWrite:!1,depthTest:!1,uniforms:{resolution:{value:new t.Vector2(0,0)},map:{value:new t.Texture}},defines:{HAS_FLOAT:F},side:t.BackSide,vertexShader:R,fragmentShader:"\n      uniform highp sampler2D map;\n      varying vec2 vUv;\n      float luma(vec3 color) {\n        return dot(color, vec3(0.299, 0.587, 0.114));\n      }\n      void main () {\n        vec3 rgb = texture2D(map, vUv).rgb;\n\n        #ifdef HAS_FLOAT\n          vec3 col;\n          col.r = rgb.r > 1.0 ? rgb.r : 0.0;\n          col.g = rgb.g > 1.0 ? rgb.g : 0.0;\n          col.b = rgb.b > 1.0 ? rgb.b : 0.0;\n          col -= 1.0;\n          col = max(col, 0.0);\n          gl_FragColor = vec4(col, 1.0);\n        #else\n          float L = luma(rgb);\n          gl_FragColor = vec4(vec3(smoothstep(0.75, 1.0, L)), 1.0);\n        #endif\n      }\n    "})),B=new t.ShaderMaterial({name:"GlowPass1Material",depthWrite:!1,depthTest:!1,uniforms:{direction:{value:new t.Vector2(1,0)},resolution:{value:new t.Vector2(0,0)},map:{value:new t.Texture}},side:t.BackSide,vertexShader:R,fragmentShader:i.default}),E=new t.ShaderMaterial({name:"PostMaterial",depthWrite:!1,depthTest:!1,defines:{HAS_FLOAT:F},uniforms:{resolution:{value:new t.Vector2(0,0)},noiseMap:{value:L},glowMap:{value:new t.Texture},lutMap:{value:O},rampColor0:{value:new t.Color("#57738f")},rampColor1:{value:new t.Color("#172a46")},rampStrength:{value:1},time:{value:0},map:{value:new t.Texture},fadeToBlackColor:{value:new t.Color("#130904")},fadeToBlack:{value:m}},side:t.BackSide,vertexShader:R,fragmentShader:a.default}),G=new t.Mesh(A,E);G.name="post-process-quad",G.frustumCulled=!1,C.add(G);const q=n.findTag(e.RenderLayers),U=n.entity().add(e.PostProcessEnabled,S),j=n.listen(e.ScreenFade),z=(n.view(e.ScreenFade),n.findTag(e.AppState)),H=n.view(e.ActiveEnvironmentState),V=n.findTag(e.GroundMeshEditableData);let N=!1;const Y={forest:"forest",tundra:"tundra6",grasslands:"grasslands"};return window.printStats=function(){let t=0;n.findTag(e.MainScene).traverse(e=>{e.isMesh&&t++}),console.log("Total Meshes",t),console.log("Geometries",g.info.memory.geometries),console.log("Textures",g.info.memory.textures),console.log("Calls",g.info.render.calls),console.log("Triangles",g.info.render.triangles),console.log("Points",g.info.render.points),console.log("Programs",g.info.programs.map(e=>e.name))},function(a){if(H.length>0){const t=H[0].get(e.EnvironmentState);let a=Y[t.name];D!==a&&(D=a,s.default.loadGPUTexture(g,O,`image/data/lut-${D}`))}z.rendering&&(E.uniforms.time.value+=a,function(a=0){const r=U.get(e.PostProcessEnabled),i=n.findTag(e.MainScene),s=n.findTag(e.MainCamera),d=(g.domElement,z.canvasWidth),m=z.canvasHeight;if(!d||!m)return;const f=d/m;n.findTag(e.Atmospherics);h||((h=new t.WebGLRenderTarget(d,m)).texture.generateMipmaps=!1,h.texture.minFilter=t.LinearFilter,h.texture.magFilter=t.LinearFilter,F&&(h.texture.type=c?t.HalfFloatType:t.FloatType),E.uniforms.map.value=h.texture,E.uniforms.resolution.value.set(d,m));d===h.width&&m===h.height||(h.setSize(d,m),E.uniforms.resolution.value.set(d,m));const p=Math.min(T,d),M=Math.round(p/f);v&&v.width===p&&v.height===M||(v?v.setSize(p,M):((v=new t.WebGLRenderTarget(p,M)).depthBuffer=!1,v.texture.generateMipmaps=!1,v.texture.minFilter=t.LinearFilter,v.texture.magFilter=t.LinearFilter));const S=Math.min(d,_),D=Math.round(S/f);b&&b.width===S&&b.height===D||(b?(b.setSize(S,D),w.setSize(S,D)):((b=new t.WebGLRenderTarget(S,D)).depthBuffer=!1,b.texture.generateMipmaps=!1,b.texture.minFilter=t.LinearFilter,b.texture.magFilter=t.LinearFilter,w=b.clone()),B.uniforms.resolution.value.set(S,D));j.changed&&j.added.forEach(t=>{const a=t.get(e.ScreenFade);(0,l.setEntityTweenFromTo)(t,E.uniforms.fadeToBlack,"value",a.from,a.to,a.duration,a.ease,a.delay);const r=t.get(e.TargetKeyTween);r.assignFromOnStart=!0,r.callbackOnStart=a.callbackOnStart,r.callbackOnFinish=a.callbackOnFinish});const L=g.autoClear;g.autoClear=!1,g.info.autoReset=!1,i.autoUpdate=!1,i.matrixAutoUpdate=!1,i.updateMatrix(),i.updateMatrixWorld(),g.info.reset(),o.initialize(g,15),N||(N=!0,console.log("Compiling scene"),g.compile(i,s));(0,u.preRender)(),r?g.setRenderTarget(h):g.setRenderTarget(null);g.clear(),s.layers.disableAll(),x&&(s.layers.enable(q.grass),s.layers.enable(q.ground));s.layers.enable(q.groundDepth),y&&(s.layers.enable(q.groundNormalElement),s.layers.enable(q.shadow));s.layers.enable(q.water),function(a,r){for(let n=0;n<W.length;n++){const a=W[n],r=a.get(e.Object3D);r.visible&&r.isMesh&&r.userData.__shadowMaterial&&r.userData.__shadowEnabled&&(r.userData.__material=r.material,r.userData.__materialDepthTest=r.material.depthTest,r.userData.__materialDepthWrite=r.material.depthWrite,r.userData.__materialBlending=r.material.blending,r.userData.__materialTransparent=r.material.transparent,r.material=r.userData.__shadowMaterial,r.material.depthTest=!0,r.material.depthWrite=!1,r.material.transparent=!0,r.material.blending=t.MultiplyBlending,r.material.uniforms&&r.material.uniforms.silhouette&&(r.material.uniforms.silhouette.value=!0))}g.render(a,r);for(let t=0;t<W.length;t++){const a=W[t],r=a.get(e.Object3D);r.visible&&r.isMesh&&r.userData.__material&&(r.material=r.userData.__material,r.material.depthWrite=r.userData.__materialDepthTest,r.material.depthTest=r.userData.__materialDepthWrite,r.material.transparent=r.userData.__materialTransparent,r.material.blending=r.userData.__materialBlending,r.material.uniforms&&r.material.uniforms.silhouette&&(r.material.uniforms.silhouette.value=!1))}}(i,s),s.layers.enableAll(),y||s.layers.disable(q.groundNormalElement);s.layers.disable(q.water),s.layers.disable(q.shadow),s.layers.disable(q.ground),s.layers.disable(q.groundDepth),s.layers.disable(q.atmospherics),s.layers.disable(q.grass),g.render(i,s),r&&(F&&(g.setRenderTarget(v),G.material=k,k.uniforms.map.value=h.texture,k.uniforms.resolution.value.set(p,M),g.render(C,P),g.setRenderTarget(b),G.material=B,B.uniforms.map.value=v.texture,B.uniforms.resolution.value.set(p,M),B.uniforms.direction.value.set(1,0),g.render(C,P),g.setRenderTarget(w),G.material=B,B.uniforms.map.value=b.texture,B.uniforms.resolution.value.set(S,D),B.uniforms.direction.value.set(0,1),g.render(C,P)),g.setRenderTarget(null),G.material=E,F&&(E.uniforms.glowMap.value=w.texture),E.uniforms.lutMap.value=V.useCustomLUT?V.lutMap:O,g.render(C,P));g.autoClear=L,(0,u.postRender)()}(a))}}exports.GLOW_LAYER=12;
},{"../tags":"injP","three":"IV0r","../shaders/post-process.frag":"LVel","../util/query-string":"Bj6B","../util/load":"OkDW","../shaders/post-process-bloom-glow.frag":"y2ec","./AnimationSystem":"cUmx","../util/ShaderManager":"igLh","../util/Assets":"Wm90","../util/addFrameTasks":"l7a6"}],"OoyW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=l(require("../../tags")),t=l(require("three")),i=l(require("../../util/math")),r=u(require("../../shaders/line-3d.vert")),n=u(require("../../shaders/line-3d.frag")),o=require("../SubmitFrameSystem"),s=l(require("../../util/ShaderManager"));function u(e){return e&&e.__esModule?e:{default:e}}function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(a=function(e){return e?i:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var i=a(t);if(i&&i.has(e))return i.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,i&&i.set(e,r),r}const h=new t.Vector3,d=new t.Vector3,f=[0,0,0];function p(e,t,i){return e=t?e.position:e,i?(f[0]=e.x,f[1]=e.y,f[2]=e.z,f):e}class c extends t.BufferGeometry{updatePath(e,i,r){const n=e.length,o=[],s=[],u=[],a=[],l=[],f=[];let c=0;for(let t=0;t<n;t++){let m=p(e[t],i,r);const b=1,g=m[0],y=m[1],v=m[2];o.push(g,y,v,g,y,v);const w=p(t<1?e[t]:e[t-1],i,r),x=w[0],B=w[1],A=w[2];s.push(x,B,A,x,B,A);let S=0;t>0&&(h.set(g,y,v),S=c+=h.distanceTo(d)),d.set(g,y,v);const P=p(t<e.length-1?e[t+1]:e[e.length-1],i,r),O=P[0],k=P[1],F=P[2];u.push(O,k,F,O,k,F),l.push(b,b),a.push(-1,1);const M=n<=1?.5:t/(n-1);f.push(M,S,M,S)}this.setAttribute("position",new t.Float32BufferAttribute(o,3)),this.setAttribute("nextPosition",new t.Float32BufferAttribute(u,3)),this.setAttribute("previousPosition",new t.Float32BufferAttribute(s,3)),this.setAttribute("direction",new t.Float32BufferAttribute(a,1)),this.setAttribute("vertexHasToken",new t.Float32BufferAttribute(l,1)),this.setAttribute("vertexDistance",new t.Float32BufferAttribute(f,2));const m=n>=2?b(n-1):new Uint16Array(0);return this.setIndex(new t.BufferAttribute(m,1)),this.updateBounds(),c}updateBounds(){const e=this.attributes.position;this.boundingBox||(this.boundingBox=new t.Box3),this.boundingSphere||(this.boundingSphere=new t.Sphere),this.boundingBox.makeEmpty();for(let t=0;t<e.count;t+=2){const i=e.getX(t),r=e.getY(t),n=e.getZ(t);h.set(i,r,n),this.boundingBox.expandByPoint(h)}const i=Math.max(this.boundingBox.min.y,this.boundingBox.max.y);this.boundingBox.min.y=0,this.boundingBox.max.y=i,this.boundingBox.getBoundingSphere(this.boundingSphere)}}class m extends t.Group{constructor(i,o={}){super();const{blending:u=t.NormalBlending,thickness:a=.5,opacity:l=1,bloom:h=1.5,draw:d=1,geometry:f,depthWrite:p=!0,depthTest:m=!0}=o,b=new t.Color(o.color||"white");b.r+=h,b.g+=h,b.b+=h,this.thickness=a,this.geometry=f||new c,this.material=s.create({name:"Line3D",side:t.DoubleSide,transparent:!0,blending:u,depthTest:m,depthWrite:p,vertexShader:r.default,fragmentShader:n.default,extensions:{derivatives:!0},uniforms:{dottedFill:{value:o.dottedFill||0},dotted:{value:Boolean(o.dotted),type:"b"},opacity:{value:l},time:{value:0},color:{value:b},resolution:{value:new t.Vector2},thickness:{value:this.thickness},miterLimit:{value:8},totalDistance:{value:0},taper:{value:!1!==o.taper,type:"b"},draw:{value:d},drawing:{value:Boolean(o.false),type:"b"},filling:{value:Boolean(o.filling),type:"b"},miter:{value:!0,type:"b"}}});const g=i.entity();g.add(e.ShaderUniformResolution,{uniform:this.material.uniforms.resolution}),g.add(e.ShaderUniformTime,{uniform:this.material.uniforms.time}),this.mesh=new t.Mesh(this.geometry,this.material),this.mesh.frustumCulled=!0,this.mesh.renderOrder=10,this.add(this.mesh),this.userData={entity:g}}setAlpha(e){this.material.uniforms.opacity.value=e}step(e=0){}updatePath(e,t,i){const r=this.geometry.updatePath(e,t,i);this.mesh.material.uniforms.totalDistance.value=r}}function b(e){let t=new Uint16Array(6*e),i=0,r=0;for(let n=0;n<e;n++){let e=r;t[i++]=e+0,t[i++]=e+1,t[i++]=e+2,t[i++]=e+2,t[i++]=e+1,t[i++]=e+3,r+=2}return t}exports.default=m;
},{"../../tags":"injP","three":"IV0r","../../util/math":"Ov1X","../../shaders/line-3d.vert":"AoHq","../../shaders/line-3d.frag":"zXs4","../SubmitFrameSystem":"olzJ","../../util/ShaderManager":"igLh"}],"Ii4d":[function(require,module,exports) {
module.exports=a;var r={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},t=/([astvzqmhlc])([^astvzqmhlc]*)/gi;function a(a){var e=[];return a.replace(t,function(t,a,c){var h=a.toLowerCase();for(c=n(c),"m"==h&&c.length>2&&(e.push([a].concat(c.splice(0,2))),h="l",a="m"==a?"l":"L");;){if(c.length==r[h])return c.unshift(a),e.push(c);if(c.length<r[h])throw new Error("malformed path data");e.push([a].concat(c.splice(0,r[h])))}}),e}var e=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;function n(r){var t=r.match(e);return t?t.map(Number):[]}
},{}],"Xqho":[function(require,module,exports) {
function r(r){return[r[0],r[1]]}function a(r,a){return[r,a]}module.exports=function(n){var t="number"==typeof(n=n||{}).recursion?n.recursion:8,i="number"==typeof n.epsilon?n.epsilon:1.1920929e-7,u="number"==typeof n.pathEpsilon?n.pathEpsilon:1,e="number"==typeof n.angleEpsilon?n.angleEpsilon:.01,s=n.angleTolerance||0,o=n.cuspLimit||0;return function(n,f,h,p,v,l){l||(l=[]);var M=u/(v="number"==typeof v?v:1);return function(n,u,f,h,p,v){p.push(r(n));var l=n[0],M=n[1],d=u[0],b=u[1],c=f[0],m=f[1],y=h[0],E=h[1];(function r(n,u,f,h,p,v,l,M,d,b,c){if(c>t)return;var m=Math.PI;var y=(n+f)/2;var E=(u+h)/2;var g=(f+p)/2;var x=(h+v)/2;var I=(p+l)/2;var L=(v+M)/2;var P=(y+g)/2;var T=(E+x)/2;var j=(g+I)/2;var k=(x+L)/2;var q=(P+j)/2;var w=(T+k)/2;if(c>0){var z,A,B=l-n,C=M-u,D=Math.abs((f-l)*C-(h-M)*B),F=Math.abs((p-l)*C-(v-M)*B);if(D>i&&F>i){if((D+F)*(D+F)<=b*(B*B+C*C)){if(s<e)return void d.push(a(q,w));var G=Math.atan2(v-h,p-f);if(z=Math.abs(G-Math.atan2(h-u,f-n)),A=Math.abs(Math.atan2(M-v,l-p)-G),z>=m&&(z=2*m-z),A>=m&&(A=2*m-A),z+A<s)return void d.push(a(q,w));if(0!==o){if(z>o)return void d.push(a(f,h));if(A>o)return void d.push(a(p,v))}}}else if(D>i){if(D*D<=b*(B*B+C*C)){if(s<e)return void d.push(a(q,w));if((z=Math.abs(Math.atan2(v-h,p-f)-Math.atan2(h-u,f-n)))>=m&&(z=2*m-z),z<s)return d.push(a(f,h)),void d.push(a(p,v));if(0!==o&&z>o)return void d.push(a(f,h))}}else if(F>i){if(F*F<=b*(B*B+C*C)){if(s<e)return void d.push(a(q,w));if((z=Math.abs(Math.atan2(M-v,l-p)-Math.atan2(v-h,p-f)))>=m&&(z=2*m-z),z<s)return d.push(a(f,h)),void d.push(a(p,v));if(0!==o&&z>o)return void d.push(a(p,v))}}else if((B=q-(n+l)/2)*B+(C=w-(u+M)/2)*C<=b)return void d.push(a(q,w))}r(n,u,y,E,P,T,q,w,d,b,c+1);r(q,w,j,k,I,L,l,M,d,b,c+1)})(l,M,d,b,c,m,y,E,p,v,0),p.push(r(h))}(n,f,h,p,l,M*=M),l}};
},{}],"zLIm":[function(require,module,exports) {
module.exports=require("./function")();
},{"./function":"Xqho"}],"U8Rt":[function(require,module,exports) {
function e(e){var a=0,r=0,t=0,c=0;return e.map(function(e){var s=(e=e.slice())[0],n=s.toUpperCase();if(s!=n)switch(e[0]=n,s){case"a":e[6]+=t,e[7]+=c;break;case"v":e[1]+=c;break;case"h":e[1]+=t;break;default:for(var b=1;b<e.length;)e[b++]+=t,e[b++]+=c}switch(n){case"Z":t=a,c=r;break;case"H":t=e[1];break;case"V":c=e[1];break;case"M":t=a=e[1],c=r=e[2];break;default:t=e[e.length-2],c=e[e.length-1]}return e})}module.exports=e;
},{}],"XkO8":[function(require,module,exports) {
var a=Math.PI,t=c(120);function n(a){for(var t,n=[],h=0,i=0,u=0,M=0,o=null,l=null,f=0,v=0,b=0,g=a.length;b<g;b++){var k=a[b],x=k[0];switch(x){case"M":u=k[1],M=k[2];break;case"A":(k=s(f,v,k[1],k[2],c(k[3]),k[4],k[5],k[6],k[7])).unshift("C"),k.length>7&&(n.push(k.splice(0,7)),k.unshift("C"));break;case"S":var C=f,p=v;"C"!=t&&"S"!=t||(C+=C-h,p+=p-i),k=["C",C,p,k[1],k[2],k[3],k[4]];break;case"T":"Q"==t||"T"==t?(o=2*f-o,l=2*v-l):(o=f,l=v),k=e(f,v,o,l,k[1],k[2]);break;case"Q":o=k[1],l=k[2],k=e(f,v,k[1],k[2],k[3],k[4]);break;case"L":k=r(f,v,k[1],k[2]);break;case"H":k=r(f,v,k[1],v);break;case"V":k=r(f,v,f,k[1]);break;case"Z":k=r(f,v,u,M)}t=x,f=k[k.length-2],v=k[k.length-1],k.length>4?(h=k[k.length-4],i=k[k.length-3]):(h=f,i=v),n.push(k)}return n}function r(a,t,n,r){return["C",a,t,n,r,n,r]}function e(a,t,n,r,e,s){return["C",a/3+2/3*n,t/3+2/3*r,e/3+2/3*n,s/3+2/3*r,e,s]}function s(n,r,e,c,i,u,M,o,l,f){if(f)q=f[0],F=f[1],y=f[2],d=f[3];else{var v=h(n,r,-i);n=v.x,r=v.y;var b=(n-(o=(v=h(o,l,-i)).x))/2,g=(r-(l=v.y))/2,k=b*b/(e*e)+g*g/(c*c);k>1&&(e*=k=Math.sqrt(k),c*=k);var x=e*e,C=c*c,p=(u==M?-1:1)*Math.sqrt(Math.abs((x*C-x*g*g-C*b*b)/(x*g*g+C*b*b)));p==1/0&&(p=1);var y=p*e*g/c+(n+o)/2,d=p*-c*b/e+(r+l)/2,q=Math.asin(((r-d)/c).toFixed(9)),F=Math.asin(((l-d)/c).toFixed(9));(q=n<y?a-q:q)<0&&(q=2*a+q),(F=o<y?a-F:F)<0&&(F=2*a+F),M&&q>F&&(q-=2*a),!M&&F>q&&(F-=2*a)}if(Math.abs(F-q)>t){var Q=F,S=o,T=l;F=q+t*(M&&F>q?1:-1);var m=s(o=y+e*Math.cos(F),l=d+c*Math.sin(F),e,c,i,0,M,S,T,[F,Q,y,d])}var w=Math.tan((F-q)/4),A=4/3*e*w,H=4/3*c*w,I=[2*n-(n+A*Math.sin(q)),2*r-(r-H*Math.cos(q)),o+A*Math.sin(F),l-H*Math.cos(F),o,l];if(f)return I;m&&(I=I.concat(m));for(var L=0;L<I.length;){var P=h(I[L],I[L+1],i);I[L++]=P.x,I[L++]=P.y}return I}function h(a,t,n){return{x:a*Math.cos(n)-t*Math.sin(n),y:a*Math.sin(n)+t*Math.cos(n)}}function c(t){return t*(a/180)}module.exports=n;
},{}],"aX9K":[function(require,module,exports) {
module.exports=function(e,n){return e[0]=n[0],e[1]=n[1],e};
},{}],"aF4B":[function(require,module,exports) {
var e=require("adaptive-bezier-curve"),r=require("abs-svg-path"),i=require("normalize-svg-path"),n=require("vec2-copy");function t(e,r,i){return e[0]=r,e[1]=i,e}var u=[0,0],a=[0,0],o=[0,0];function c(r,i,n,c){e(n,t(u,c[1],c[2]),t(a,c[3],c[4]),t(o,c[5],c[6]),i,r)}module.exports=function(e,u){var a=[],o=[],l=[0,0];return i(r(e)).forEach(function(e,r,i){if("M"===e[0])n(l,e.slice(1)),o.length>0&&(a.push(o),o=[]);else{if("C"!==e[0])throw new Error("illegal type in SVG: "+e[0]);c(o,u,l,e),t(l,e[5],e[6])}}),o.length>0&&a.push(o),a};
},{"adaptive-bezier-curve":"zLIm","abs-svg-path":"U8Rt","normalize-svg-path":"XkO8","vec2-copy":"aX9K"}],"GrX2":[function(require,module,exports) {
function r(r,n){var e=r[0]-n[0],t=r[1]-n[1];return e*e+t*t}module.exports=function(n,e){if(n.length<=1)return n;for(var t,u=(e="number"==typeof e?e:1)*e,o=n[0],f=[o],h=1,p=n.length;h<p;h++)r(t=n[h],o)>u&&(f.push(t),o=t);return o!==t&&f.push(t),f};
},{}],"hUHj":[function(require,module,exports) {
function r(r,n,t){var u=n[0],e=n[1],f=t[0]-u,o=t[1]-e;if(0!==f||0!==o){var a=((r[0]-u)*f+(r[1]-e)*o)/(f*f+o*o);a>1?(u=t[0],e=t[1]):a>0&&(u+=f*a,e+=o*a)}return(f=r[0]-u)*f+(o=r[1]-e)*o}function n(t,u,e,f,o){for(var a,i=f,v=u+1;v<e;v++){var h=r(t[v],t[u],t[e]);h>i&&(a=v,i=h)}i>f&&(a-u>1&&n(t,u,a,f,o),o.push(t[a]),e-a>1&&n(t,a,e,f,o))}module.exports=function(r,t){if(r.length<=1)return r;var u=(t="number"==typeof t?t:1)*t,e=r.length-1,f=[r[0]];return n(r,0,e,u,f),f.push(r[e]),f};
},{}],"AUVL":[function(require,module,exports) {
var e=require("./radial-distance"),r=require("./douglas-peucker");module.exports=function(u,a){return u=e(u,a),u=r(u,a)},module.exports.radialDistance=e,module.exports.douglasPeucker=r;
},{"./radial-distance":"GrX2","./douglas-peucker":"hUHj"}],"T2x6":[function(require,module,exports) {
"use strict";function r(r){var t=r.length;if(0===t)return[[],[]];for(var e=r[0].length,a=r[0].slice(),n=r[0].slice(),i=1;i<t;++i)for(var l=r[i],o=0;o<e;++o){var s=l[o];a[o]=Math.min(a[o],s),n[o]=Math.max(n[o],s)}return[a,n]}module.exports=r;
},{}],"dYKo":[function(require,module,exports) {
module.exports=function(e,n,o){return(o-e)/(n-e)};
},{}],"zGjU":[function(require,module,exports) {
var r=require("bound-points"),e=require("unlerp");function i(i,n){if(!Array.isArray(i))throw new TypeError("must specify positions as first argument");Array.isArray(n)||(n=r(i));var t=n[0],a=n[1],o=a[0]-t[0],s=a[1]-t[1],u=o>s?1:s/o,f=o>s?o/s:1;if(a[0]-t[0]==0||a[1]-t[1]==0)return i;for(var p=0;p<i.length;p++){var y=i[p];y[0]=(2*e(t[0],a[0],y[0])-1)/u,y[1]=(2*e(t[1],a[1],y[1])-1)/f}return i}module.exports=i;
},{"bound-points":"T2x6","unlerp":"dYKo"}],"fTqK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=l;var e=s(require("parse-svg-path")),t=s(require("svg-path-contours")),r=s(require("abs-svg-path")),u=s(require("simplify-path")),a=s(require("normalize-path-scale"));function s(e){return e&&e.__esModule?e:{default:e}}function l(r){const s=(0,t.default)((0,e.default)(r),1);let l=(0,a.default)(s[0]);return l=(0,u.default)(l,.01)}
},{"parse-svg-path":"Ii4d","svg-path-contours":"aF4B","abs-svg-path":"U8Rt","simplify-path":"AUVL","normalize-path-scale":"zGjU"}],"kzPg":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=c;var e=s(require("../tags")),t=s(require("three")),n=s(require("../util/math")),r=o(require("../util/ObjectPool")),a=o(require("../util/Random")),i=o(require("./writing/Line3D")),u=o(require("../util/getPathFromSVG"));function o(e){return e&&e.__esModule?e:{default:e}}function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var u=a?Object.getOwnPropertyDescriptor(e,i):null;u&&(u.get||u.set)?Object.defineProperty(r,i,u):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}function c(n){const r=n.view(e.ActiveEnvironmentState),o=(0,a.default)(),l=f().map(e=>{const n=(0,u.default)(e).map(e=>new t.Vector3(e[0],0,e[1]));return new t.CatmullRomCurve3(n,!1,"catmullrom",.5).getSpacedPoints(100).map(e=>e.toArray())}).map(e=>{const t=new i.default(n,{thickness:.2,bloom:0,taper:!1});return t.updatePath(e),t.userData._entity=null,t.userData._lineThickness=1,t});let s=0;const c=()=>o.range(1,2);let m=c();const d=[0,0],g=n.view(e.WindLine);return function(a){const i=r.length?r[0].get(e.EnvironmentState).name:null;if(i&&"grasslands"===i){if((s+=a)>=m){s%=m,m=c(),function(r){const a=function(){const e=o.rangeFloor(0,l.length);for(let t=0;t<l.length;t++){const n=(t+e)%l.length;if(!l[n].userData._entity)return l[n]}return null}();if(!a)return;o.onCircle(o.range(5,10),d);const i=r.x+d[0],u=r.z+d[1];a.userData._entity=n.entity().add(e.Object3D,a),a.position.set(i,o.range(2,4),u),a.scale.setScalar(o.range(1,6)),a.rotation.y=t.MathUtils.degToRad(45),a.material.uniforms.drawing.value=!0,a.material.uniforms.opacity.value=.5,a.userData._lineThickness=o.range(.2,.2),a.userData._entity.add(e.WindLine),a.userData._entity.get(e.WindLine).duration=o.range(3,3)}(n.findTag(e.UserTarget).position)}g.forEach(t=>{const n=t.get(e.WindLine);n.time+=a;let r=0;if(n.time<=n.animateDuration)r=n.time/n.animateDuration;else if(n.time>=n.duration-n.animateDuration){r=1-Math.max(0,n.time-(n.duration-n.animateDuration))/n.animateDuration}else r=1;const i=t.get(e.Object3D);i.material.uniforms.thickness.value=i.userData._lineThickness*r,i.material.uniforms.time.value+=a,i.material.uniforms.draw.value=n.time/n.duration;const u=n.duration;n.time>=u&&(t.kill(),i.userData._entity=null)})}else g.length>0&&g.forEach(t=>{t.get(e.Object3D).userData._entity=null,t.kill()})}}function f(){return["M1 73C48 80 154.8 89.8 206 73C270 52 259 19 238 7C217 -5 173 -1.90735e-06 176 26C179 52 191 76 277 80C363 84 421 67 444 65C467 63 530 73 561 73","M1 13C50 16.3333 101 23 178 18C255 13 268 -0.999999 338 1C408 3 444 18 508 18","M1 18C40.3333 12 129 0.199994 169 0.999994C219 1.99999 346 18 399 18C452 18 512 0.999994 526 0.999994","M1 5.99999C69.3333 2.33332 217.8 -2.80001 265 5.99999C324 17 421 -2.00003 462 5.99999"]}
},{"../tags":"injP","three":"IV0r","../util/math":"Ov1X","../util/ObjectPool":"iiAR","../util/Random":"LMfK","./writing/Line3D":"OoyW","../util/getPathFromSVG":"fTqK"}],"RVT0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=r(require("three"));function e(t){if("function"!=typeof WeakMap)return null;var r=new WeakMap,o=new WeakMap;return(e=function(t){return t?o:r})(t)}function r(t,r){if(!r&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var o=e(r);if(o&&o.has(t))return o.get(t);var a={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var i=s?Object.getOwnPropertyDescriptor(t,n):null;i&&(i.get||i.set)?Object.defineProperty(a,n,i):a[n]=t[n]}return a.default=t,o&&o.set(t,a),a}function o(e,r,o,a,s,n,i,u,f){t.BufferGeometry.call(this),this.type="CapsuleBufferGeometry",this.parameters={radiusTop:e,radiusBottom:r,height:o,radialSegments:a,heightSegments:s,thetaStart:u,thetaLength:f};e=void 0!==e?e:1,r=void 0!==r?r:1,o=void 0!==o?o:2,a=Math.floor(a)||8,s=Math.floor(s)||1,n=Math.floor(n)||2,i=Math.floor(i)||2,u=void 0!==u?u:0,f=void 0!==f?f:2*Math.PI;var h=Math.acos((r-e)/o),p=(a+1)*(s+1+i+n),c=a*(s+i+n)*2*3,y=new t.BufferAttribute(new(c>65535?Uint32Array:Uint16Array)(c),1),l=new t.BufferAttribute(new Float32Array(3*p),3),v=new t.BufferAttribute(new Float32Array(3*p),3),M=new t.BufferAttribute(new Float32Array(2*p),2),d=0,w=0,b=[],X=o/2;!function(){var p,c,x=new t.Vector3,A=new t.Vector3,P=Math.cos(h),g=Math.sin(h),z=new t.Vector2(e*g,X+e*P).sub(new t.Vector2(r*g,r*P-X)).length(),O=e*h+z+r*(Math.PI/2-h),m=0;for(c=0;c<=n;c++){var Y=[],j=Math.PI/2-h*(c/n);m+=e*h/n;var B=Math.cos(j),I=Math.sin(j),Z=B*e;for(p=0;p<=a;p++){var V=p/a,_=V*f+u,k=Math.sin(_),F=Math.cos(_);A.x=Z*k,A.y=X+I*e,A.z=Z*F,l.setXYZ(d,A.x,A.y,A.z),x.set(B*k,I,B*F),v.setXYZ(d,x.x,x.y,x.z),M.setXY(d,V,1-m/O),Y.push(d),d++}b.push(Y)}var G=o+P*e-P*r,S=g*(r-e)/G;for(c=1;c<=s;c++){var Y=[];m+=z/s;var Z=g*(c*(r-e)/s+e);for(p=0;p<=a;p++){var V=p/a,_=V*f+u,k=Math.sin(_),F=Math.cos(_);A.x=Z*k,A.y=X+P*e-c*G/s,A.z=Z*F,l.setXYZ(d,A.x,A.y,A.z),x.set(k,S,F).normalize(),v.setXYZ(d,x.x,x.y,x.z),M.setXY(d,V,1-m/O),Y.push(d),d++}b.push(Y)}for(c=1;c<=i;c++){var Y=[],j=Math.PI/2-h-(Math.PI-h)*(c/i);m+=r*h/i;var B=Math.cos(j),I=Math.sin(j),Z=B*r;for(p=0;p<=a;p++){var V=p/a,_=V*f+u,k=Math.sin(_),F=Math.cos(_);A.x=Z*k,A.y=I*r-X,A.z=Z*F,l.setXYZ(d,A.x,A.y,A.z),x.set(B*k,I,B*F),v.setXYZ(d,x.x,x.y,x.z),M.setXY(d,V,1-m/O),Y.push(d),d++}b.push(Y)}for(p=0;p<a;p++)for(c=0;c<n+s+i;c++){var W=b[c][p],D=b[c+1][p],U=b[c+1][p+1],q=b[c][p+1];y.setX(w,W),w++,y.setX(w,D),w++,y.setX(w,q),w++,y.setX(w,D),w++,y.setX(w,U),w++,y.setX(w,q),w++}}(),this.setIndex(y),this.setAttribute("position",l),this.setAttribute("normal",v),this.setAttribute("uv",M)}o.prototype=Object.create(t.BufferGeometry.prototype),o.prototype.constructor=o;var a=o;exports.default=a;
},{"three":"IV0r"}],"hVXC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=f;var e=d(require("../tags")),t=d(require("three")),a=d(require("../util/math")),n=d(require("eases")),r=c(require("../util/ObjectPool")),i=c(require("../util/Random")),o=c(require("./writing/Line3D")),l=c(require("../util/getPathFromSVG")),u=c(require("../util/CapsuleBufferGeometry")),s=require("../util/three-util");function c(e){return e&&e.__esModule?e:{default:e}}function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(p=function(e){return e?a:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=p(t);if(a&&a.has(e))return a.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,a&&a.set(e,n),n}function f(o){const l=(0,i.default)(),c=new t.Group;c.name="rainparticles";const p=new t.Group,d=new t.Group;c.add(p),c.add(d),o.entity().add(e.Object3D,c);const f=.25,m=new t.BufferGeometry,y=[f,2*f].map(e=>{const t=new u.default(.02,.02,e,5,1,2,2);return t.userData.length=e,t.translate(0,-e/2,0),t}),g=(new t.Color(1,1,1),a.linspace(10).map(e=>{return new t.Color("#7dcdf2").offsetHSL(l.range(-1,1)*(5/360),.1*l.range(-1,1),.1*l.range(-1,1))})),D=new r.default({maxCapacity:50,initialCapacity:50,create(){const e=new t.Mesh(m,new t.MeshBasicMaterial({name:"rain"}));return e.matrixAutoUpdate=!1,e.userData._entity=null,e.frustumCulled=!1,e.visible=!1,e},release(e){}}),w=new t.RingGeometry(.12,.21,12,1);w.rotateX(-Math.PI/2);const b=new r.default({maxCapacity:50,initialCapacity:50,create(){const e=new t.Mesh(w,new t.MeshBasicMaterial({name:"splatter",transparent:!0,opacity:.5}));return e.renderOrder=5,e.matrixAutoUpdate=!1,e.userData._entity=null,e.frustumCulled=!1,e.visible=!1,e}}),v=new t.Vector3(.5,-1,0).normalize(),O=[0,0],h=new t.Vector3,M=new t.Plane(new t.Vector3(-0,-1,-0),-0),x=new t.Ray,j=new t.Vector3;x.direction.copy(v);const R=o.view([e.RainDrop,e.Object3D]),_=o.view([e.RainDropSplatter,e.Object3D]),P=()=>l.range(.075,.2);let S=0,q=P();const C=o.findTag(e.UserTarget),k=o.view(e.ActiveEnvironmentState),G=o.findTag(e.EnvironmentUnderPlayerState),V=o.entity();let W=null,B=0;const U=()=>l.range(5,10);let z=U(),A=!1;return function(t){const a=k.length?k[0].get(e.EnvironmentState).name:null;let r=a&&"grasslands"===a;if(r&&G.water&&G.lake&&(V.has(e.Raining)||(null==W?W=G.lake:G.lake!==W&&(V.tagOn(e.Raining),z=U(),A=!0,B=0,W=null))),!G.water&&A&&(A=!1,W=null),r&&V.has(e.Raining)&&(B+=t)>=z&&V.tagOff(e.Raining),r&&V.has(e.Raining)&&(S+=t)>=q){S%=q,q=P();const e=l.rangeFloor(1,6);for(let t=0;t<e&&F(C.position);t++);}for(let n=0;n<R.length;n++){const a=R[n],r=a.get(e.RainDrop),i=a.get(e.Object3D);i.position.addScaledVector(v,t*r.speed),i.visible=!0,r.time+=t;let o=0;o=r.time<=r.animateDuration?r.time/r.animateDuration:1,i.scale.setScalar(1*o),i.updateMatrix(),h.set(0,0,0),h.applyMatrix4(i.matrixWorld),h.y<=0&&!r.splat&&(r.splat=!0,E(r.splatterSpawnPosition,i.material.color)),h.y<=-1*i.geometry.userData.length&&(D.release(i),i.userData._entity=null,i.visible=!1,(0,s.detachObject)(i),a.remove(e.RainDrop))}for(let i=0;i<_.length;i++){const a=_[i],r=a.get(e.RainDropSplatter),o=a.get(e.Object3D);o.visible=!0,r.time+=t;let l=0;if(r.time<=r.animateDuration)l=r.time/r.animateDuration;else if(r.time>=r.duration-r.animateDuration){l=1-Math.max(0,r.time-(r.duration-r.animateDuration))/r.animateDuration}else l=1;l=n.sineInOut(l),o.scale.setScalar(1*l),r.time>=r.duration?(b.release(o),o.userData._entity=null,o.visible=!1,(0,s.detachObject)(o),a.kill()):o.updateMatrix()}};function E(t,a){const n=b.next();if(!n)return!1;d.add(n),n.material.color.copy(a),n.position.copy(t),n.position.y=.1,n.visible=!1,n.userData._entity=o.entity().add(e.Object3D,n),n.userData._entity.add(e.RainDropSplatter);n.userData._entity.get(e.RainDropSplatter)}function F(t){const n=D.next();if(!n)return!1;l.onCircle(l.range(0,20),O);const r=t.x+O[0]-10*v.x,i=t.z+O[1]-0*v.z;p.add(n),n.geometry=l.pick(y),n.position.set(r,l.range(7.5,15),i),n.material.color.copy(l.pick(g)),n.visible=!1,n.userData._entity=o.entity().add(e.Object3D,n),n.userData._entity.add(e.RainDrop),a.quaternionFromNormal(v,n.quaternion);const u=n.userData._entity.get(e.RainDrop);return u.speed=l.range(10,10),n.updateMatrix(),n.updateMatrixWorld(),h.set(0,f,0),h.applyMatrix4(n.matrixWorld),x.origin.copy(h),x.intersectPlane(M,j)?u.splatterSpawnPosition.copy(j):u.splat=!0,!0}}
},{"../tags":"injP","three":"IV0r","../util/math":"Ov1X","eases":"uiPX","../util/ObjectPool":"iiAR","../util/Random":"LMfK","./writing/Line3D":"OoyW","../util/getPathFromSVG":"fTqK","../util/CapsuleBufferGeometry":"RVT0","../util/three-util":"bI4v"}],"HvyF":[function(require,module,exports) {
var e=require("three"),r=new e.Vector3;function t(t,n){if(n=n||new e.Quaternion,t.y>.99999)n.set(0,0,0,1);else if(t.y<-.99999)n.set(1,0,0,0);else{r.set(t.z,0,-t.x).normalize();var s=Math.acos(t.y);n.setFromAxisAngle(r,s)}return n}module.exports=t;
},{"three":"IV0r"}],"oxwV":[function(require,module,exports) {
"function"==typeof Object.create?module.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:module.exports=function(t,e){if(e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t}};
},{}],"Sa0M":[function(require,module,exports) {
function e(e,n,o){return e*(1-o)+n*o}module.exports=e;
},{}],"O9DC":[function(require,module,exports) {
var r=require("lerp");module.exports=function(e,n,t,u){if("number"==typeof e&&"number"==typeof n)return r(e,n,t);var o=Math.min(e.length,n.length);u=u||new Array(o);for(var a=0;a<o;a++)u[a]=r(e[a],n[a],t);return u};
},{"lerp":"Sa0M"}],"SbQi":[function(require,module,exports) {
"use strict";var e,t="object"==typeof Reflect?Reflect:null,n=t&&"function"==typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};function r(e){console&&console.warn&&console.warn(e)}e=t&&"function"==typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}module.exports=o,module.exports.once=m,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function f(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var o,s,c;if(u(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),c=s[t]),void 0===c)c=s[t]=n,++e._eventsCount;else if("function"==typeof c?c=s[t]=i?[n,c]:[c,n]:i?c.unshift(n):c.push(n),(o=f(e))>0&&c.length>o&&!c.warned){c.warned=!0;var v=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");v.name="MaxListenersExceededWarning",v.emitter=e,v.type=t,v.count=c.length,r(v)}return e}function v(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=v.bind(r);return i.listener=n,r.wrapFn=i,i}function p(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?d(i):h(i,i.length)}function a(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function h(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function y(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function d(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function m(e,t){return new Promise(function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&L(e,i,{once:!0})})}function L(e,t,n){"function"==typeof e.on&&g(e,"error",t,n)}function g(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function i(o){r.once&&e.removeEventListener(t,i),n(o)})}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return f(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var u=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw u.context=s,u}var f=o[e];if(void 0===f)return!1;if("function"==typeof f)n(f,this,t);else{var c=f.length,v=h(f,c);for(r=0;r<c;++r)n(v[r],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return u(t),this.on(e,l(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,l(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,s;if(u(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():y(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return p(this,e,!0)},o.prototype.rawListeners=function(e){return p(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):a.call(e,t)},o.prototype.listenerCount=a,o.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};
},{}],"lzDf":[function(require,module,exports) {
var t=function(){},i=require("eases/linear"),e=require("events").EventEmitter,s=require("inherits");function h(t){e.call(this),this.duration=t&&t.duration||0,this.delay=t&&t.delay||0,this.time=0,this.ease=t&&t.ease,this.active=!0,this.enabled=!0,this.cancelling=!1,this._started=!1}function a(t,e){return"function"==typeof t.ease?t.ease(e):i(e)}s(h,e),h.prototype.lerp=t,h.prototype.ready=t,h.prototype.cancel=function(){return this.cancelling=!0,this},h.prototype.tick=function(t,i){if(i="function"==typeof i?i:a,this.cancelling&&this.active&&(this.active=!1,this.emit("cancelling",this),this.emit("complete",this)),this.active&&this.enabled){this.time;this.time+=t;var e=(this.time-this.delay)/this.duration;this.time-this.delay>0&&(this._started||(this._started=!0,this.ready(),this.emit("start",this)),e<0?e=0:e>1&&(e=1),e=i(this,e),this.lerp(e),this.emit("update",this)),this.time>=this.duration+this.delay&&(this.active=!1,this.emit("complete",this))}},module.exports=h;
},{"eases/linear":"VPfo","events":"SbQi","inherits":"oxwV"}],"iS1y":[function(require,module,exports) {
var r=Object.prototype.toString;function t(t){return t.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===r.call(t.buffer)||Array.isArray(t)}module.exports=t;
},{}],"szlC":[function(require,module,exports) {
var e=Object.prototype.propertyIsEnumerable;function t(t){var r=Object.getOwnPropertyNames(t);return Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t))),r.filter(function(r){return e.call(t,r)})}module.exports=t;
},{}],"iHb0":[function(require,module,exports) {
var e=require("tween-base"),r=require("an-array"),n=require("own-enumerable-keys"),a=n(new e);module.exports=function(e,i){var u=[],t=n(i);for(var s in i)if(t.indexOf(s)>=0&&s in e&&-1===a.indexOf(s)){var f=e[s],o=i[s];"number"==typeof f&&"number"==typeof o?u.push({key:s,start:f,end:o}):r(f)&&r(o)&&u.push({key:s,start:f.slice(),end:o.slice()})}return u};
},{"tween-base":"lzDf","an-array":"iS1y","own-enumerable-keys":"szlC"}],"soof":[function(require,module,exports) {
var t=require("inherits"),e=require("lerp-array"),i=require("tween-base"),r=require("./end-target");function n(t,e){i.call(this,e),this.target=t,this.endings=void 0,this._options=e}t(n,i),n.prototype.ready=function(){this.endings=r(this.target,this._options)},n.prototype.lerp=function(t){for(var i=0;i<this.endings.length;i++){var r=this.endings[i],n=r.key;this.target[n]=e(r.start,r.end,t,this.target[n])}},module.exports=n;
},{"inherits":"oxwV","lerp-array":"O9DC","tween-base":"lzDf","./end-target":"iHb0"}],"qjae":[function(require,module,exports) {
var t=require("inherits"),e=require("lerp-array"),r=require("tween-base"),i=require("./end-target");function n(t,e){r.call(this,e),this.target=t,this.end=[],this._options=e}t(n,r),n.prototype.ready=function(){this.end=this.target.map(function(t){return i(t,this._options)},this)},n.prototype.lerp=function(t){for(var r=0;r<this.end.length;r++)for(var i=this.end[r],n=this.target[r],s=0;s<i.length;s++){var o=i[s],a=o.key;n[a]=e(o.start,o.end,t,n[a])}},module.exports=n;
},{"inherits":"oxwV","lerp-array":"O9DC","tween-base":"lzDf","./end-target":"iHb0"}],"MhjP":[function(require,module,exports) {
var r=require("./lib/object"),e=require("./lib/group");module.exports=function(i,u){return Array.isArray(i)?new e(i,u):new r(i,u)};
},{"./lib/object":"soof","./lib/group":"qjae"}],"k6Q8":[function(require,module,exports) {
var t=require("eases/linear"),e=require("tween-objects"),s=require("tween-base");function n(e){if(!(this instanceof n))return new n(e);e=e||{},this.stack=[],this.defaultEase=e.defaultEase||t,this.eases=e.eases||{},this._applyEase=this.ease.bind(this)}function i(t){return"function"==typeof t.tick&&"function"==typeof t.cancel}function o(t){for(var e=0;e<t.length;e++){var s=t[e];"function"==typeof s.sync&&s.sync()}}n.prototype.cancel=function(){for(var t=0;t<this.stack.length;t++){var e=this.stack[t];e.cancel(),e.tick(0)}return this.stack.length=0,this},n.prototype.clear=n.prototype.cancel,n.prototype.to=function(t,n){var o=t;if(n&&"object"==typeof n)o=e(t,n);else if(t||n){if(!i(o))throw new Error("must provide options or a tween object")}else o=new s;return this.push(o)},n.prototype.push=function(t){return this.stack.push(t),t},n.prototype.tick=function(t,e){e="function"==typeof e?e:this._applyEase,t="number"==typeof t?t:1/60;for(var s=0;s<this.stack.length;s++)this.stack[s].tick(t,e);for(o(this.stack),s=this.stack.length-1;s>=0;s--)this.stack[s].active||this.stack.splice(s,1)},n.prototype.ease=function(e,s){var n=e.ease||this.defaultEase;return"string"==typeof n&&(n=this.eases[n]),"function"!=typeof n&&(n=t),n(s)},module.exports=n;
},{"eases/linear":"VPfo","tween-objects":"MhjP","tween-base":"lzDf"}],"KgTk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=s;var e=r(require("eases")),t=r(require("tween-ticker"));function r(e){return e&&e.__esModule?e:{default:e}}const u={eases:e.default};function s(e={}){return(0,t.default)({...u,...e})}
},{"eases":"uiPX","tween-ticker":"k6Q8"}],"zBU2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FetchFileLoader=i;var e=r(require("three"));function t(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,n=new WeakMap;return(t=function(e){return e?n:r})(e)}function r(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=t(r);if(n&&n.has(e))return n.get(e);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var a=i?Object.getOwnPropertyDescriptor(e,u):null;a&&(a.get||a.set)?Object.defineProperty(o,u,a):o[u]=e[u]}return o.default=e,n&&n.set(e,o),o}const n=e.Loader,o={};function i(e){n.call(this,e)}i.prototype=Object.assign(Object.create(n.prototype),{constructor:i,load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);window.fetch(e).then(e=>e.arrayBuffer()).then(e=>{t(e)},e=>{n(e)})},setResponseType:function(e){return this},setWithCredentials:function(e){return this},setMimeType:function(e){return this}});
},{"three":"IV0r"}],"IGrR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GLTFLoader=void 0;var e=require("./FetchFileLoader"),t=require("three"),r=require("./addFrameTasks"),a=function(){function e(e){t.Loader.call(this,e),this.dracoLoader=null,this.ddsLoader=null,this.pluginCallbacks=[],this.register(function(e){return new l(e)})}function a(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(t.Loader.prototype),{constructor:e,load:function(e,a,s,n){var i,o=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:t.LoaderUtils.extractUrlBase(e),o.manager.itemStart(e);var l=function(t){n?n(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)};const c=o.manager.resolveURL(this.path+e);new Promise(e=>{(0,r.addFrameTask)(e)}).then(()=>window.fetch(c)).then(e=>e.arrayBuffer()).then(t=>{try{o.parse(t,i,function(t){a(t),o.manager.itemEnd(e)},l,!1)}catch(r){l(r)}},l)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,r,a,l,u){var p,f={},T={};if("string"==typeof e||u)p=e;else if(!u){if(t.LoaderUtils.decodeText(new Uint8Array(e,0,4))===c){try{f[s.KHR_BINARY_GLTF]=new h(e)}catch(_){return void(l&&l(_))}p=f[s.KHR_BINARY_GLTF].content}else p=t.LoaderUtils.decodeText(new Uint8Array(e))}var M=u?p:JSON.parse(p);if(void 0===M.asset||M.asset.version[0]<2)l&&l(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var y=new j(M,{path:r||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});y.fileLoader.setRequestHeader(this.requestHeader);for(var S=0;S<this.pluginCallbacks.length;S++){var x=this.pluginCallbacks[S](y);T[x.name]=x,f[x.name]=!0}if(M.extensionsUsed)for(S=0;S<M.extensionsUsed.length;++S){var R=M.extensionsUsed[S],L=M.extensionsRequired||[];switch(R){case s.KHR_LIGHTS_PUNCTUAL:f[R]=new i(M);break;case s.KHR_MATERIALS_UNLIT:f[R]=new o;break;case s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:f[R]=new g;break;case s.KHR_DRACO_MESH_COMPRESSION:f[R]=new d(M,this.dracoLoader);break;case s.MSFT_TEXTURE_DDS:f[R]=new n(this.ddsLoader);break;case s.KHR_TEXTURE_TRANSFORM:f[R]=new m;break;case s.KHR_MESH_QUANTIZATION:f[R]=new v;break;default:L.indexOf(R)>=0&&void 0===T[R]&&console.warn('THREE.GLTFLoader: Unknown extension "'+R+'".')}}y.setExtensions(f),y.setPlugins(T),y.parse(a,l)}}});var s={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function n(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=s.MSFT_TEXTURE_DDS,this.ddsLoader=e}function i(e){this.name=s.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[s.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function o(){this.name=s.KHR_MATERIALS_UNLIT}function l(e){this.parser=e,this.name=s.KHR_MATERIALS_CLEARCOAT}i.prototype.loadLight=function(e){var r,a=this.lightDefs[e],s=new t.Color(16777215);void 0!==a.color&&s.fromArray(a.color);var n=void 0!==a.range?a.range:0;switch(a.type){case"directional":(r=new t.DirectionalLight(s)).target.position.set(0,0,-1),r.add(r.target);break;case"point":(r=new t.PointLight(s)).distance=n;break;case"spot":(r=new t.SpotLight(s)).distance=n,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,r.angle=a.spot.outerConeAngle,r.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,r.target.position.set(0,0,-1),r.add(r.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+a.type+'".')}return r.position.set(0,0,0),r.decay=2,void 0!==a.intensity&&(r.intensity=a.intensity),r.name=a.name||"light_"+e,Promise.resolve(r)},o.prototype.getMaterialType=function(){return t.MeshBasicMaterial},o.prototype.extendParams=function(e,r,a){var s=[];e.color=new t.Color(1,1,1),e.opacity=1;var n=r.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var i=n.baseColorFactor;e.color.fromArray(i),e.opacity=i[3]}void 0!==n.baseColorTexture&&s.push(a.assignTexture(e,"map",n.baseColorTexture))}return Promise.all(s)},l.prototype.getMaterialType=function(){return t.MeshPhysicalMaterial},l.prototype.extendMaterialParams=function(e,r){var a=this.parser,s=a.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();var n=[],i=s.extensions[this.name];if(void 0!==i.clearcoatFactor&&(r.clearcoat=i.clearcoatFactor),void 0!==i.clearcoatTexture&&n.push(a.assignTexture(r,"clearcoatMap",i.clearcoatTexture)),void 0!==i.clearcoatRoughnessFactor&&(r.clearcoatRoughness=i.clearcoatRoughnessFactor),void 0!==i.clearcoatRoughnessTexture&&n.push(a.assignTexture(r,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),void 0!==i.clearcoatNormalTexture&&(n.push(a.assignTexture(r,"clearcoatNormalMap",i.clearcoatNormalTexture)),void 0!==i.clearcoatNormalTexture.scale)){var o=i.clearcoatNormalTexture.scale;r.clearcoatNormalScale=new t.Vector2(o,o)}return Promise.all(n)};var c="glTF",u=12,p={JSON:1313821514,BIN:5130562};function h(e){this.name=s.KHR_BINARY_GLTF,this.content=null,this.body=null;var r=new DataView(e,0,u);if(this.header={magic:t.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==c)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var a=new DataView(e,u),n=0;n<a.byteLength;){var i=a.getUint32(n,!0);n+=4;var o=a.getUint32(n,!0);if(n+=4,o===p.JSON){var l=new Uint8Array(e,u+n,i);this.content=t.LoaderUtils.decodeText(l)}else if(o===p.BIN){var h=u+n;this.body=e.slice(h,h+i)}n+=i}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function d(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=s.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function m(){this.name=s.KHR_TEXTURE_TRANSFORM}function f(e){t.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var r=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),a=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),s=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),n=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),i=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),o={specular:{value:(new t.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(var t in o)e.uniforms[t]=o[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),e.fragmentShader=e.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_pars_fragment>",r),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_pars_fragment>",a),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_fragment>",s),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_fragment>",n),e.fragmentShader=e.fragmentShader.replace("#include <lights_physical_fragment>",i)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function g(){return{name:s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return f},extendParams:function(e,r,a){var s=r.extensions[this.name];e.color=new t.Color(1,1,1),e.opacity=1;var n=[];if(Array.isArray(s.diffuseFactor)){var i=s.diffuseFactor;e.color.fromArray(i),e.opacity=i[3]}if(void 0!==s.diffuseTexture&&n.push(a.assignTexture(e,"map",s.diffuseTexture)),e.emissive=new t.Color(0,0,0),e.glossiness=void 0!==s.glossinessFactor?s.glossinessFactor:1,e.specular=new t.Color(1,1,1),Array.isArray(s.specularFactor)&&e.specular.fromArray(s.specularFactor),void 0!==s.specularGlossinessTexture){var o=s.specularGlossinessTexture;n.push(a.assignTexture(e,"glossinessMap",o)),n.push(a.assignTexture(e,"specularMap",o))}return Promise.all(n)},createMaterial:function(e){var r=new f(e);return r.fog=!0,r.color=e.color,r.map=void 0===e.map?null:e.map,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=void 0===e.aoMap?null:e.aoMap,r.aoMapIntensity=1,r.emissive=e.emissive,r.emissiveIntensity=1,r.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,r.bumpMap=void 0===e.bumpMap?null:e.bumpMap,r.bumpScale=1,r.normalMap=void 0===e.normalMap?null:e.normalMap,r.normalMapType=t.TangentSpaceNormalMap,e.normalScale&&(r.normalScale=e.normalScale),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=void 0===e.specularMap?null:e.specularMap,r.specular=e.specular,r.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,r.glossiness=e.glossiness,r.alphaMap=null,r.envMap=void 0===e.envMap?null:e.envMap,r.envMapIntensity=1,r.refractionRatio=.98,r}}}function v(){this.name=s.KHR_MESH_QUANTIZATION}function T(e,r,a,s){t.Interpolant.call(this,e,r,a,s)}d.prototype.decodePrimitive=function(e,t){var r=this.json,a=this.dracoLoader,s=e.extensions[this.name].bufferView,n=e.extensions[this.name].attributes,i={},o={},l={};for(var c in n){var u=I[c]||c.toLowerCase();i[u]=n[c]}for(c in e.attributes){u=I[c]||c.toLowerCase();if(void 0!==n[c]){var p=r.accessors[e.attributes[c]],h=w[p.componentType];l[u]=h,o[u]=!0===p.normalized}}return t.getDependency("bufferView",s).then(function(e){return new Promise(function(t){a.decodeDracoFile(e,function(e){for(var r in e.attributes){var a=e.attributes[r],s=o[r];void 0!==s&&(a.normalized=s)}t(e)},i,l)})})},m.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},f.prototype=Object.create(t.MeshStandardMaterial.prototype),f.prototype.constructor=f,f.prototype.copy=function(e){return t.MeshStandardMaterial.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},T.prototype=Object.create(t.Interpolant.prototype),T.prototype.constructor=T,T.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,a=this.valueSize,s=e*a*3+a,n=0;n!==a;n++)t[n]=r[s+n];return t},T.prototype.beforeStart_=T.prototype.copySampleValue_,T.prototype.afterEnd_=T.prototype.copySampleValue_,T.prototype.interpolate_=function(e,t,r,a){for(var s=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=2*i,l=3*i,c=a-t,u=(r-t)/c,p=u*u,h=p*u,d=e*l,m=d-l,f=-2*h+3*p,g=h-p,v=1-f,T=g-p+u,M=0;M!==i;M++){var y=n[m+M+i],S=n[m+M+o]*c,x=n[d+M+i],R=n[d+M]*c;s[M]=v*y+T*S+f*x+g*R}return s};var M=0,y=1,S=2,x=3,R=4,L=5,_=6,w={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},A={9728:t.NearestFilter,9729:t.LinearFilter,9984:t.NearestMipmapNearestFilter,9985:t.LinearMipmapNearestFilter,9986:t.NearestMipmapLinearFilter,9987:t.LinearMipmapLinearFilter},E={33071:t.ClampToEdgeWrapping,33648:t.MirroredRepeatWrapping,10497:t.RepeatWrapping},b={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},I={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},P={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},O={CUBICSPLINE:void 0,LINEAR:t.InterpolateLinear,STEP:t.InterpolateDiscrete},C="OPAQUE",F="MASK",U="BLEND",N={"image/png":t.RGBAFormat,"image/jpeg":t.RGBFormat};function H(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e)}function D(e,t,r){for(var a in r.extensions)void 0===e[a]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[a]=r.extensions[a])}function G(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function k(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,a=t.weights.length;r<a;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(r=0,a=s.length;r<a;r++)e.morphTargetDictionary[s[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function B(e){for(var t="",r=Object.keys(e).sort(),a=0,s=r.length;a<s;a++)t+=r[a]+":"+e[r[a]]+";";return t}function j(e,r){this.json=e||{},this.extensions={},this.plugins={},this.options=r||{},this.cache=new a,this.associations=new Map,this.primitiveCache={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new t.ImageBitmapLoader(this.options.manager):this.textureLoader=new t.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new t.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function K(e,r,a){var s=r.attributes,n=[];function i(t,r){return a.getDependency("accessor",t).then(function(t){e.setAttribute(r,t)})}for(var o in s){var l=I[o]||o.toLowerCase();l in e.attributes||n.push(i(s[o],l))}if(void 0!==r.indices&&!e.index){var c=a.getDependency("accessor",r.indices).then(function(t){e.setIndex(t)});n.push(c)}return G(e,r),function(e,r,a){var s=r.attributes,n=new t.Box3;if(void 0!==s.POSITION){var i=(d=a.json.accessors[s.POSITION]).min,o=d.max;if(void 0!==i&&void 0!==o){n.set(new t.Vector3(i[0],i[1],i[2]),new t.Vector3(o[0],o[1],o[2]));var l=r.targets;if(void 0!==l){for(var c=new t.Vector3,u=new t.Vector3,p=0,h=l.length;p<h;p++){var d,m=l[p];if(void 0!==m.POSITION)i=(d=a.json.accessors[m.POSITION]).min,o=d.max,void 0!==i&&void 0!==o?(u.setX(Math.max(Math.abs(i[0]),Math.abs(o[0]))),u.setY(Math.max(Math.abs(i[1]),Math.abs(o[1]))),u.setZ(Math.max(Math.abs(i[2]),Math.abs(o[2]))),c.max(u)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}n.expandByVector(c)}e.boundingBox=n;var f=new t.Sphere;n.getCenter(f.center),f.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=f}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,r,a),Promise.all(n).then(function(){return void 0!==r.targets?function(e,t,r){for(var a=!1,s=!1,n=0,i=t.length;n<i&&(void 0!==(c=t[n]).POSITION&&(a=!0),void 0!==c.NORMAL&&(s=!0),!a||!s);n++);if(!a&&!s)return Promise.resolve(e);var o=[],l=[];for(n=0,i=t.length;n<i;n++){var c=t[n];if(a){var u=void 0!==c.POSITION?r.getDependency("accessor",c.POSITION):e.attributes.position;o.push(u)}s&&(u=void 0!==c.NORMAL?r.getDependency("accessor",c.NORMAL):e.attributes.normal,l.push(u))}return Promise.all([Promise.all(o),Promise.all(l)]).then(function(t){var r=t[0],n=t[1];return a&&(e.morphAttributes.position=r),s&&(e.morphAttributes.normal=n),e.morphTargetsRelative=!0,e})}(e,r.targets,a):e})}function V(e,r){var a=e.getIndex();if(null===a){var s=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var i=0;i<n.count;i++)s.push(i);e.setIndex(s),a=e.getIndex()}var o=a.count-2,l=[];if(r===t.TriangleFanDrawMode)for(i=1;i<=o;i++)l.push(a.getX(0)),l.push(a.getX(i)),l.push(a.getX(i+1));else for(i=0;i<o;i++)i%2==0?(l.push(a.getX(i)),l.push(a.getX(i+1)),l.push(a.getX(i+2))):(l.push(a.getX(i+2)),l.push(a.getX(i+1)),l.push(a.getX(i)));l.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var c=e.clone();return c.setIndex(l),c}return j.prototype.setExtensions=function(e){this.extensions=e},j.prototype.setPlugins=function(e){this.plugins=e},j.prototype.parse=function(e,t){var r=this,a=this.json,s=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(t){var n={scene:t[0][a.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:a.asset,parser:r,userData:{}};D(s,n,a),G(n,a),e(n)}).catch(t)},j.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],a={},s={},n=0,i=t.length;n<i;n++)for(var o=t[n].joints,l=0,c=o.length;l<c;l++)e[o[l]].isBone=!0;for(var u=0,p=e.length;u<p;u++){var h=e[u];void 0!==h.mesh&&(void 0===a[h.mesh]&&(a[h.mesh]=s[h.mesh]=0),a[h.mesh]++,void 0!==h.skin&&(r[h.mesh].isSkinnedMesh=!0))}this.json.meshReferences=a,this.json.meshUses=s},j.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var r=0;r<t.length;r++){var a=e(t[r]);if(a)return a}},j.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var r=[],a=0;a<t.length;a++)r.push(e(t[a]));return Promise.all(r)},j.prototype.getDependency=function(e,t){var r=e+":"+t,a=this.cache.get(r);if(!a){switch(e){case"scene":a=this.loadScene(t);break;case"node":a=this.loadNode(t);break;case"mesh":a=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":a=this.loadAccessor(t);break;case"bufferView":a=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":a=this.loadBuffer(t);break;case"material":a=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":a=this.loadTexture(t);break;case"skin":a=this.loadSkin(t);break;case"animation":a=this.loadAnimation(t);break;case"camera":a=this.loadCamera(t);break;case"light":a=this.extensions[s.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,a)}return a},j.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,a=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(a.map(function(t,a){return r.getDependency(e,a)})),this.cache.add(e,t)}return t},j.prototype.loadBuffer=function(e){var t=this.json.buffers[e];if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[s.KHR_BINARY_GLTF].body);var a=this.options;return new Promise(e=>{(0,r.addFrameTask)(e)}).then(()=>window.fetch(H(t.uri,a.path))).then(e=>e.arrayBuffer())},j.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0,a=t.byteOffset||0;return e.slice(a,a+r)})},j.prototype.loadAccessor=function(e){var r=this,a=this.json,s=this.json.accessors[e];if(void 0===s.bufferView&&void 0===s.sparse)return Promise.resolve(null);var n=[];return void 0!==s.bufferView?n.push(this.getDependency("bufferView",s.bufferView)):n.push(null),void 0!==s.sparse&&(n.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(n).then(function(e){var n,i,o=e[0],l=b[s.type],c=w[s.componentType],u=c.BYTES_PER_ELEMENT,p=u*l,h=s.byteOffset||0,d=void 0!==s.bufferView?a.bufferViews[s.bufferView].byteStride:void 0,m=!0===s.normalized;if(d&&d!==p){var f=Math.floor(h/d),g="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+f+":"+s.count,v=r.cache.get(g);v||(n=new c(o,f*d,s.count*d/u),v=new t.InterleavedBuffer(n,d/u),r.cache.add(g,v)),i=new t.InterleavedBufferAttribute(v,l,h%d/u,m)}else n=null===o?new c(s.count*l):new c(o,h,s.count*l),i=new t.BufferAttribute(n,l,m);if(void 0!==s.sparse){var T=b.SCALAR,M=w[s.sparse.indices.componentType],y=s.sparse.indices.byteOffset||0,S=s.sparse.values.byteOffset||0,x=new M(e[1],y,s.sparse.count*T),R=new c(e[2],S,s.sparse.count*l);null!==o&&(i=new t.BufferAttribute(i.array.slice(),i.itemSize,i.normalized));for(var L=0,_=x.length;L<_;L++){var A=x[L];if(i.setX(A,R[L*l]),l>=2&&i.setY(A,R[L*l+1]),l>=3&&i.setZ(A,R[L*l+2]),l>=4&&i.setW(A,R[L*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i})},j.prototype.loadTexture=function(e){var r,a=this,n=this.json,i=this.options,o=this.textureLoader,l=self.URL||self.webkitURL,c=n.textures[e],u=c.extensions||{},p=(r=u[s.MSFT_TEXTURE_DDS]?n.images[u[s.MSFT_TEXTURE_DDS].source]:n.images[c.source]).uri,h=!1;return void 0!==r.bufferView&&(p=a.getDependency("bufferView",r.bufferView).then(function(e){h=!0;var t=new Blob([e],{type:r.mimeType});return p=l.createObjectURL(t)})),Promise.resolve(p).then(function(e){var r=i.manager.getHandler(e);return r||(r=u[s.MSFT_TEXTURE_DDS]?a.extensions[s.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise(function(a,s){var n=a;!0===r.isImageBitmapLoader&&(n=function(e){a(new t.CanvasTexture(e))}),r.load(H(e,i.path),n,void 0,s)})}).then(function(s){!0===h&&l.revokeObjectURL(p),s.flipY=!1,c.name&&(s.name=c.name),r.mimeType in N&&(s.format=N[r.mimeType]);var i=(n.samplers||{})[c.sampler]||{};return s.magFilter=A[i.magFilter]||t.LinearFilter,s.minFilter=A[i.minFilter]||t.LinearMipmapLinearFilter,s.wrapS=E[i.wrapS]||t.RepeatWrapping,s.wrapT=E[i.wrapT]||t.RepeatWrapping,a.associations.set(s,{type:"textures",index:e}),s})},j.prototype.assignTexture=function(e,r,a){var n=this;return this.getDependency("texture",a.index).then(function(i){if(!i.isCompressedTexture)switch(r){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":i.format=t.RGBFormat}if(void 0===a.texCoord||0==a.texCoord||"aoMap"===r&&1==a.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+a.texCoord+" for texture "+r+" not yet supported."),n.extensions[s.KHR_TEXTURE_TRANSFORM]){var o=void 0!==a.extensions?a.extensions[s.KHR_TEXTURE_TRANSFORM]:void 0;if(o){var l=n.associations.get(i);i=n.extensions[s.KHR_TEXTURE_TRANSFORM].extendTexture(i,o),n.associations.set(i,l)}}e[r]=i})},j.prototype.assignFinalMaterial=function(e){var r=e.geometry,a=e.material,s=void 0!==r.attributes.tangent,n=void 0!==r.attributes.color,i=void 0===r.attributes.normal,o=!0===e.isSkinnedMesh,l=Object.keys(r.morphAttributes).length>0,c=l&&void 0!==r.morphAttributes.normal;if(e.isPoints){var u="PointsMaterial:"+a.uuid,p=this.cache.get(u);p||(p=new t.PointsMaterial,t.Material.prototype.copy.call(p,a),p.color.copy(a.color),p.map=a.map,p.sizeAttenuation=!1,this.cache.add(u,p)),a=p}else if(e.isLine){u="LineBasicMaterial:"+a.uuid;var h=this.cache.get(u);h||(h=new t.LineBasicMaterial,t.Material.prototype.copy.call(h,a),h.color.copy(a.color),this.cache.add(u,h)),a=h}if(s||n||i||o||l){u="ClonedMaterial:"+a.uuid+":";a.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),o&&(u+="skinning:"),s&&(u+="vertex-tangents:"),n&&(u+="vertex-colors:"),i&&(u+="flat-shading:"),l&&(u+="morph-targets:"),c&&(u+="morph-normals:");var d=this.cache.get(u);d||(d=a.clone(),o&&(d.skinning=!0),s&&(d.vertexTangents=!0),n&&(d.vertexColors=!0),i&&(d.flatShading=!0),l&&(d.morphTargets=!0),c&&(d.morphNormals=!0),this.cache.add(u,d),this.associations.set(d,this.associations.get(a))),a=d}a.aoMap&&void 0===r.attributes.uv2&&void 0!==r.attributes.uv&&r.setAttribute("uv2",r.attributes.uv),a.normalScale&&!s&&(a.normalScale.y=-a.normalScale.y),a.clearcoatNormalScale&&!s&&(a.clearcoatNormalScale.y=-a.clearcoatNormalScale.y),e.material=a},j.prototype.getMaterialType=function(){return t.MeshStandardMaterial},j.prototype.loadMaterial=function(e){var r,a=this,n=this.json,i=this.extensions,o=n.materials[e],l={},c=o.extensions||{},u=[];if(c[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var p=i[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=p.getMaterialType(),u.push(p.extendParams(l,o,a))}else if(c[s.KHR_MATERIALS_UNLIT]){var h=i[s.KHR_MATERIALS_UNLIT];r=h.getMaterialType(),u.push(h.extendParams(l,o,a))}else{var d=o.pbrMetallicRoughness||{};if(l.color=new t.Color(1,1,1),l.opacity=1,Array.isArray(d.baseColorFactor)){var m=d.baseColorFactor;l.color.fromArray(m),l.opacity=m[3]}void 0!==d.baseColorTexture&&u.push(a.assignTexture(l,"map",d.baseColorTexture)),l.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,l.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(u.push(a.assignTexture(l,"metalnessMap",d.metallicRoughnessTexture)),u.push(a.assignTexture(l,"roughnessMap",d.metallicRoughnessTexture))),r=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),u.push(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)}))}!0===o.doubleSided&&(l.side=t.DoubleSide);var g=o.alphaMode||C;return g===U?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,g===F&&(l.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&r!==t.MeshBasicMaterial&&(u.push(a.assignTexture(l,"normalMap",o.normalTexture)),l.normalScale=new t.Vector2(1,1),void 0!==o.normalTexture.scale&&l.normalScale.set(o.normalTexture.scale,o.normalTexture.scale)),void 0!==o.occlusionTexture&&r!==t.MeshBasicMaterial&&(u.push(a.assignTexture(l,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(l.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&r!==t.MeshBasicMaterial&&(l.emissive=(new t.Color).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&r!==t.MeshBasicMaterial&&u.push(a.assignTexture(l,"emissiveMap",o.emissiveTexture)),Promise.all(u).then(function(){var n;return n=r===f?i[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new r(l),o.name&&(n.name=o.name),n.map&&(n.map.encoding=t.sRGBEncoding),n.emissiveMap&&(n.emissiveMap.encoding=t.sRGBEncoding),G(n,o),a.associations.set(n,{type:"materials",index:e}),o.extensions&&D(i,n,o),n})},j.prototype.loadGeometries=function(e){var r=this,a=this.extensions,n=this.primitiveCache;function i(e){return a[s.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,r).then(function(t){return K(t,e,r)})}for(var o,l,c=[],u=0,p=e.length;u<p;u++){var h,d=e[u],m=(l=void 0,(l=(o=d).extensions&&o.extensions[s.KHR_DRACO_MESH_COMPRESSION])?"draco:"+l.bufferView+":"+l.indices+":"+B(l.attributes):o.indices+":"+B(o.attributes)+":"+o.mode),f=n[m];if(f)c.push(f.promise);else h=d.extensions&&d.extensions[s.KHR_DRACO_MESH_COMPRESSION]?i(d):K(new t.BufferGeometry,d,r),n[m]={primitive:d,promise:h},c.push(h)}return Promise.all(c)},j.prototype.loadMesh=function(e){for(var r,a=this,s=this.json.meshes[e],n=s.primitives,i=[],o=0,l=n.length;o<l;o++){var c=void 0===n[o].material?(void 0===(r=this.cache).DefaultMaterial&&(r.DefaultMaterial=new t.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:t.FrontSide})),r.DefaultMaterial):this.getDependency("material",n[o].material);i.push(c)}return i.push(a.loadGeometries(n)),Promise.all(i).then(function(r){for(var i=r.slice(0,r.length-1),o=r[r.length-1],l=[],c=0,u=o.length;c<u;c++){var p,h=o[c],d=n[c],m=i[c];if(d.mode===R||d.mode===L||d.mode===_||void 0===d.mode)!0!==(p=!0===s.isSkinnedMesh?new t.SkinnedMesh(h,m):new t.Mesh(h,m)).isSkinnedMesh||p.geometry.attributes.skinWeight.normalized||p.normalizeSkinWeights(),d.mode===L?p.geometry=V(p.geometry,t.TriangleStripDrawMode):d.mode===_&&(p.geometry=V(p.geometry,t.TriangleFanDrawMode));else if(d.mode===y)p=new t.LineSegments(h,m);else if(d.mode===x)p=new t.Line(h,m);else if(d.mode===S)p=new t.LineLoop(h,m);else{if(d.mode!==M)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);p=new t.Points(h,m)}Object.keys(p.geometry.morphAttributes).length>0&&k(p,s),p.name=s.name||"mesh_"+e,o.length>1&&(p.name+="_"+c),G(p,s),a.assignFinalMaterial(p),l.push(p)}if(1===l.length)return l[0];var f=new t.Group;for(c=0,u=l.length;c<u;c++)f.add(l[c]);return f})},j.prototype.loadCamera=function(e){var r,a=this.json.cameras[e],s=a[a.type];if(s)return"perspective"===a.type?r=new t.PerspectiveCamera(t.MathUtils.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):"orthographic"===a.type&&(r=new t.OrthographicCamera(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),a.name&&(r.name=a.name),G(r,a),Promise.resolve(r);console.warn("THREE.GLTFLoader: Missing camera parameters.")},j.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},j.prototype.loadAnimation=function(e){for(var r=this.json.animations[e],a=[],s=[],n=[],i=[],o=[],l=0,c=r.channels.length;l<c;l++){var u=r.channels[l],p=r.samplers[u.sampler],h=u.target,d=void 0!==h.node?h.node:h.id,m=void 0!==r.parameters?r.parameters[p.input]:p.input,f=void 0!==r.parameters?r.parameters[p.output]:p.output;a.push(this.getDependency("node",d)),s.push(this.getDependency("accessor",m)),n.push(this.getDependency("accessor",f)),i.push(p),o.push(h)}return Promise.all([Promise.all(a),Promise.all(s),Promise.all(n),Promise.all(i),Promise.all(o)]).then(function(a){for(var s=a[0],n=a[1],i=a[2],o=a[3],l=a[4],c=[],u=0,p=s.length;u<p;u++){var h=s[u],d=n[u],m=i[u],f=o[u],g=l[u];if(void 0!==h){var v;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,P[g.path]){case P.weights:v=t.NumberKeyframeTrack;break;case P.rotation:v=t.QuaternionKeyframeTrack;break;case P.position:case P.scale:default:v=t.VectorKeyframeTrack}var M=h.name?h.name:h.uuid,y=void 0!==f.interpolation?O[f.interpolation]:t.InterpolateLinear,S=[];P[g.path]===P.weights?h.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&S.push(e.name?e.name:e.uuid)}):S.push(M);var x=m.array;if(m.normalized){var R;if(x.constructor===Int8Array)R=1/127;else if(x.constructor===Uint8Array)R=1/255;else if(x.constructor==Int16Array)R=1/32767;else{if(x.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");R=1/65535}for(var L=new Float32Array(x.length),_=0,w=x.length;_<w;_++)L[_]=x[_]*R;x=L}for(_=0,w=S.length;_<w;_++){var A=new v(S[_]+"."+P[g.path],d.array,x,y);"CUBICSPLINE"===f.interpolation&&(A.createInterpolant=function(e){return new T(this.times,this.values,this.getValueSize()/3,e)},A.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(A)}}}var E=r.name?r.name:"animation_"+e;return new t.AnimationClip(E,void 0,c)})},j.prototype.loadNode=function(e){var r,a=this.json,n=this.extensions,i=this,o=a.meshReferences,l=a.meshUses,c=a.nodes[e];return(r=[],void 0!==c.mesh&&r.push(i.getDependency("mesh",c.mesh).then(function(e){var t;if(o[c.mesh]>1){var r=l[c.mesh]++;(t=e.clone()).name+="_instance_"+r}else t=e;return void 0!==c.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,r=c.weights.length;t<r;t++)e.morphTargetInfluences[t]=c.weights[t]}),t})),void 0!==c.camera&&r.push(i.getDependency("camera",c.camera)),c.extensions&&c.extensions[s.KHR_LIGHTS_PUNCTUAL]&&void 0!==c.extensions[s.KHR_LIGHTS_PUNCTUAL].light&&r.push(i.getDependency("light",c.extensions[s.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(r)).then(function(r){var a;if((a=!0===c.isBone?new t.Bone:r.length>1?new t.Group:1===r.length?r[0]:new t.Object3D)!==r[0])for(var s=0,o=r.length;s<o;s++)a.add(r[s]);if(c.name&&(a.userData.name=c.name,a.name=t.PropertyBinding.sanitizeNodeName(c.name)),G(a,c),c.extensions&&D(n,a,c),void 0!==c.matrix){var l=new t.Matrix4;l.fromArray(c.matrix),a.applyMatrix4(l)}else void 0!==c.translation&&a.position.fromArray(c.translation),void 0!==c.rotation&&a.quaternion.fromArray(c.rotation),void 0!==c.scale&&a.scale.fromArray(c.scale);return i.associations.set(a,{type:"nodes",index:e}),a})},j.prototype.loadScene=function(){function e(r,a,s,n){var i=s.nodes[r];return n.getDependency("node",r).then(function(e){return void 0===i.skin?e:n.getDependency("skin",i.skin).then(function(e){for(var t=[],a=0,s=(r=e).joints.length;a<s;a++)t.push(n.getDependency("node",r.joints[a]));return Promise.all(t)}).then(function(a){return e.traverse(function(e){if(e.isMesh){for(var s=[],n=[],i=0,o=a.length;i<o;i++){var l=a[i];if(l){s.push(l);var c=new t.Matrix4;void 0!==r.inverseBindMatrices&&c.fromArray(r.inverseBindMatrices.array,16*i),n.push(c)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[i])}e.bind(new t.Skeleton(s,n),e.matrixWorld)}}),e});var r}).then(function(t){a.add(t);var r=[];if(i.children)for(var o=i.children,l=0,c=o.length;l<c;l++){var u=o[l];r.push(e(u,t,s,n))}return Promise.all(r)})}return function(r){var a=this.json,s=this.extensions,n=this.json.scenes[r],i=new t.Group;n.name&&(i.name=n.name),G(i,n),n.extensions&&D(s,i,n);for(var o=n.nodes||[],l=[],c=0,u=o.length;c<u;c++)l.push(e(o[c],i,a,this));return Promise.all(l).then(function(){return i})}}(),e}();function s(e){}exports.GLTFLoader=a;
},{"./FetchFileLoader":"zBU2","three":"IV0r","./addFrameTasks":"l7a6"}],"l4Ze":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=d;var e=s(require("three")),t=s(require("../../tags")),r=c(require("../../util/CapsuleBufferGeometry")),n=s(require("../../util/math")),o=s(require("../../util/ShaderManager")),a=require("../../util/GLTFLoader"),i=require("canvas-sketch-util/math");function c(e){return e&&e.__esModule?e:{default:e}}function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}const u=()=>{},v=new e.TextureLoader;function p(e){return new Promise((t,r)=>{v.load(e,e=>{t(e)},u,e=>{r(e)})})}function d(){const t=new e.Group,a=(new e.Geometry).fromBufferGeometry(new r.default(.5,.5,1,5,5,5,5));a.mergeVertices(),a.rotateX(Math.PI/2),a.rotateY(Math.PI/2),a.scale(.1/.24,.1/.24,.1/.24),a.translate(.875,0,-.5);const i=new e.MeshBasicMaterial({color:"black"}),c=new e.CircleGeometry(1,16);c.merge(a,new e.Matrix4,1);const l=o.create({vertexShader:"\n      varying vec2 vUv;\n      void main () {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n      }\n    ",name:"character-face",fragmentShader:"\n      varying vec2 vUv;\n      void main () {\n        vec2 q = vec2(vUv - 0.5);\n        float d = length(q);\n        float circ = 1.0 - step(0.25, d);\n        vec2 q2 = q - vec2(0.25, 0.0);\n        float d2 = length(q2);\n        circ *= step(0.25, d2);\n        gl_FragColor = vec4(vec3(circ), 1.0);\n      }\n    "}),s=new e.MeshBasicMaterial({color:"black"}),u=new e.Mesh(c,[l,s]),v=new e.Mesh(c,new e.MeshBasicMaterial({color:"white",transparent:!0})),p=new e.Mesh(c,new e.MeshBasicMaterial({color:"black",transparent:!0}));u.scale.setScalar(.24),v.scale.setScalar(.132),p.scale.setScalar(.132),t.add(u),t.position.y=1.44;const d=new e.Vector3,m=(new e.Mesh(a,i),new e.Group,new e.CylinderBufferGeometry(.025,.24*1.15,.75,16,1));m.translate(0,.375,0);const f=new e.Group,y=o.create({name:"character-hat",uniforms:{color:{value:new e.Color("#de4d26")},tMap:{value:new e.Texture}},vertexShader:"\n    varying vec2 vUv;\n    varying vec3 vNormal;\n    varying vec3 vViewPoisition;\n    void main () {\n      vUv = uv;\n      vNormal = normalMatrix * normal;\n      vec4 worldPos = modelMatrix * vec4(position.xyz, 1.0);\n      vec4 vpos = viewMatrix * vec4(worldPos.xyz, 1.0);\n      vViewPoisition = -vpos.xyz;\n      gl_Position = projectionMatrix * vpos;\n    }\n  ",fragmentShader:"\n    varying vec2 vUv;\n    varying vec3 vViewPoisition;\n    varying vec3 vNormal;\n    uniform vec3 color;\n    uniform sampler2D tMap;\n    void main () {\n      float rim = clamp(dot(normalize(vViewPoisition), vNormal), 0.0, 1.0);\n      // rim = step(0.5, rim);\n\n      vec3 cMap = texture2D(tMap, vUv).rgb;\n\n      vec3 outColor = color;\n      // outColor = mix(color * 0.85, color, rim);\n      gl_FragColor = vec4(outColor, 1.0);\n    }\n  "}),w=new e.Mesh(m,y);t.add(f),f.add(w);const M=new e.Matrix4,g=new e.Matrix4;return{group:t,getScarfAnchor:e=>(t.localToWorld(e.set(0,-.24,0)),e),getHatTipPoint:e=>w?(w.localToWorld(e.set(0,.75,0)),e):f.position,update(e,t,r,o,a,i,c){d.set(Math.cos(r),0,Math.sin(r)),u.position.set(0,0,0).addScaledVector(d,.1*o),v.position.copy(u.position),v.position.addScaledVector(c,-.066),p.position.copy(v.position),p.position.addScaledVector(c,-.132);const l=d.dot(i)<0?-1:1;p.position.addScaledVector(i,.132*l),u.quaternion.copy(t.quaternion),u.scale.x=.24*l,v.quaternion.copy(u.quaternion),p.quaternion.copy(u.quaternion);const s=n.lerp(5,70,o),m=M.identity();m.multiply(g.makeTranslation(u.position.x,u.position.y+0,u.position.z)),m.multiply(g.makeRotationY(r)),m.multiply(g.makeRotationZ(n.degToRad(s))),m.multiply(g.makeTranslation(0,.075,0)),f.matrixAutoUpdate=!1,f.matrix.identity(),f.applyMatrix4(m),f.matrixAutoUpdate=!0}}}
},{"three":"IV0r","../../tags":"injP","../../util/CapsuleBufferGeometry":"RVT0","../../util/math":"Ov1X","../../util/ShaderManager":"igLh","../../util/GLTFLoader":"IGrR","canvas-sketch-util/math":"RN3r"}],"QL7E":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CylinderGeometry=e,exports.CylinderBufferGeometry=o;var t=require("three");function e({radiusTop:e,radiusBottom:r,height:s,radialSegments:h,heightSegments:i,openBottom:n,openTop:p,thetaStart:u,thetaLength:a}){t.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:r,height:s,radialSegments:h,heightSegments:i,openTop:p,openBottom:n,thetaStart:u,thetaLength:a},this.fromBufferGeometry(new o({radiusTop:e,radiusBottom:r,height:s,radialSegments:h,heightSegments:i,openTop:p,openBottom:n,thetaStart:u,thetaLength:a})),this.mergeVertices()}function o({radiusTop:e,radiusBottom:o,height:r,radialSegments:s,heightSegments:h,openTop:i,openBottom:n,thetaStart:p,thetaLength:u}){t.BufferGeometry.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:o,height:r,radialSegments:s,heightSegments:h,openBottom:n,openTop:i,thetaStart:p,thetaLength:u};const a=this;e=void 0!==e?e:1,o=void 0!==o?o:1,r=r||1,s=Math.floor(s)||8,h=Math.floor(h)||1,i=void 0!==i&&i,n=void 0!==n&&n,p=void 0!==p?p:0,u=void 0!==u?u:2*Math.PI;const l=[],c=[],f=[],m=[],d=[],y=[];let g=0;const B=[],S=r/2;let b=0;function x(r){let h,i;const n=new t.Vector2,B=new t.Vector3;let x=0;const A=!0===r?e:o,G=!0===r?1:-1;h=g;for(let t=1;t<=s;t++)f.push(0,S*G,0),m.push(0,G,0),d.push(.5,.5),y.push(G),c.push(t/(s+1)*u+p),g++;i=g;for(let t=0;t<=s;t++){const e=t/s*u+p,o=Math.cos(e),r=Math.sin(e);B.x=A*r,B.y=S*G,B.z=A*o,f.push(B.x,B.y,B.z),m.push(0,G,0),n.x=.5*o+.5,n.y=.5*r*G+.5,d.push(n.x,n.y),y.push(G),c.push(t/(s+1)*u+p),g++}for(let t=0;t<s;t++){const e=h+t,o=i+t;!0===r?l.push(o,o+1,e):l.push(o+1,o,e),x+=3}a.addGroup(b,x,!0===r?1:2),b+=x}!function(){const i=new t.Vector3,n=new t.Vector3;let x=0;const A=(o-e)/r;for(let t=0;t<=h;t++){const a=[],l=t/h,b=l*(o-e)+e;for(let t=0;t<=s;t++){const e=t/s,o=e*u+p,h=Math.sin(o),B=Math.cos(o);n.x=b*h,n.y=-l*r+S,n.z=b*B,f.push(n.x,n.y,n.z),c.push(t/(s+1)*u+p),i.set(h,A,B).normalize(),m.push(i.x,i.y,i.z),d.push(e,1-l),y.push(0),a.push(g++)}B.push(a)}for(let t=0;t<s;t++)for(let e=0;e<h;e++){const o=B[e][t],r=B[e+1][t],s=B[e+1][t+1],h=B[e][t+1];l.push(o,r,h),l.push(r,s,h),x+=6}a.addGroup(b,x,0),b+=x}(),!1===i&&e>0&&x(!0),!1===n&&o>0&&x(!1),this.setIndex(l),this.setAttribute("position",new t.Float32BufferAttribute(f,3)),this.setAttribute("normal",new t.Float32BufferAttribute(m,3)),this.setAttribute("uv",new t.Float32BufferAttribute(d,2)),this.setAttribute("capState",new t.Float32BufferAttribute(y,1)),this.setAttribute("vertexAngle",new t.Float32BufferAttribute(c,1))}e.prototype=Object.create(t.Geometry.prototype),e.prototype.constructor=e,o.prototype=Object.create(t.BufferGeometry.prototype),o.prototype.constructor=o;
},{"three":"IV0r"}],"oeoa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=c;var e=v(require("three")),n=v(require("../../util/math")),o=v(require("../../util/ShaderManager")),t=require("../AnimationSystem"),r=i(require("../../util/tween-ticker")),a=require("../../util/ModCylinderGeometry");function i(e){return e&&e.__esModule?e:{default:e}}function l(e){if("function"!=typeof WeakMap)return null;var n=new WeakMap,o=new WeakMap;return(l=function(e){return e?o:n})(e)}function v(e,n){if(!n&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var o=l(n);if(o&&o.has(e))return o.get(e);var t={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var i=r?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(t,a,i):t[a]=e[a]}return t.default=e,o&&o.set(e,t),t}function c(t,{map:i}){const l=t.findTag(Tags.UserCharacter),v=new a.CylinderBufferGeometry({radiusTop:.15,radiusBottom:.8,height:1,radialSegments:32,heightSegments:8,openTop:!1,openBottom:!1});v.translate(0,.5,0);const c=o.create({uniforms:{cap:{value:!0,type:"b"},color:{value:new e.Color("#de4d26")},overlayColor:{value:new e.Color("#f7eaaf")},opacity:{value:1},ripple:{value:0},rotationAngle:{value:0},map:{value:i},mapScale:{value:(new e.Vector2).setScalar(.75)},mapOffset:{value:new e.Vector2(.45,.5)},coneHeight:{value:1},tilt:{value:0},magicalEffect:{value:0},stroke:{value:!1,type:"b"},elapsed:{value:0},glowIntensity:{value:1},glowIntensity2:{value:1}},name:"cape-mesh",extensions:{derivatives:!0},side:e.DoubleSide,fragmentShader:"\n      #include <common>\n      uniform vec3 color;\n      uniform vec3 overlayColor;\n      uniform float opacity;\n      uniform sampler2D map;\n      uniform float magicalEffect;\n      uniform float glowIntensity;\n      uniform float glowIntensity2;\n      varying float vConeY;\n      varying vec2 vUv;\n      varying vec3 vNormal;\n      varying float vAngle;\n      varying float vCap;\n      varying vec2 vScreenUv;\n      uniform bool stroke;\n      varying vec3 vViewPoisition;\n\n      vec4 tex2DConstScale(sampler2D tex, float texSize, vec2 uv)\n      {\n        // uv.x *= aspect;\n        // uv.xy *= spriteHeight;\n        vec2 offset = vec2(0.0, 0.0);\n        // Find the discretized derivatives of our coordinates\n        float maxDeriv = max(length(dFdx(uv)), length(dFdy(uv)));\n        float pixScale = 1.0 / (texSize * maxDeriv);\n        // Find two nearest log-discretized noise scales\n        vec2 pixScales = vec2(\n          exp2(floor(log2(pixScale))),\n          exp2(ceil(log2(pixScale)))\n        );\n        // Factor to interpolate lerp with\n        float lerpFactor = fract(log2(pixScale));\n\n        float scale = 0.1;\n        return mix(\n          texture2D(tex, pixScales.x * scale * uv + offset),\n          texture2D(tex, pixScales.y * scale * uv + offset),\n          lerpFactor\n        );\n      }\n\n      void main () {\n        float L = texture2D(map, vUv).r * glowIntensity;\n\n        float rim = clamp(dot(normalize(vViewPoisition), vNormal), 0.0, 1.0);\n        rim = step(0.5, rim);\n        vec3 curOverlay = overlayColor + 0.75;\n        \n        // float L = tex2DConstScale(map, 256.0, vUv).r;\n        if (vCap > 0.5) {\n          gl_FragColor = vec4(color, opacity);\n        } else {\n          float edges = step(0.045, vConeY);\n          // float edges = clamp(step(0.05, vConeY) * step(vConeY, 1.0 - 0.05), 0.0, 1.0);\n\n          vec3 outColor = mix(color, overlayColor, L) * glowIntensity2;\n          outColor = mix(vec3(magicalEffect), outColor, edges);\n          // outColor.rgb = mix(outColor * 0.85, outColor, vec3(rim));\n\n          // outColor = mix(outColor, outColor * 0.75, pow(1.0 - vConeY, 1.5));\n\n\n          // gl_FragColor = vec4(vec3(edges), 1.0);\n          gl_FragColor = vec4(outColor, opacity);\n        }\n        if (stroke) {\n          gl_FragColor.rgb = vec3(0.0);\n        }\n        // gl_FragColor.rgb += vCap;\n        // gl_FragColor.a = 1.0;\n      }\n    ",vertexShader:"\n      #include <common>\n      attribute float capState;\n      attribute float vertexAngle;\n      uniform float tilt;\n      uniform float ripple;\n      uniform bool stroke;\n      uniform float elapsed;\n      uniform float coneHeight;\n      varying float vAngle;\n      uniform vec2 mapScale;\n      uniform vec2 mapOffset;\n      uniform float rotationAngle;\n      varying vec2 vScreenUv;\n      varying vec2 vUv;\n      varying vec3 vNormal;\n      varying float vCap;\n      varying float vConeY;\n      varying vec3 vViewPoisition;\n\n      void main () {\n        vUv = mapOffset + uv * mapScale;\n        vCap = capState;\n        vec3 transformed = position.xyz;\n\n        \n        float rippleTime = 0.0;\n\n        vec3 centerWorldPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n        vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n        vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n        vec2 scale;\n        scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n        scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n        vec3 vertexWorldPos = centerWorldPos;\n\n        float coneYAlpha = position.y / coneHeight;\n        vec2 norm = normalize(transformed.xz);\n        float coneAngle = atan(norm.y, norm.x);\n        float tAngle = (coneAngle + PI) / (PI * 2.0);\n        vAngle = coneAngle;\n        float coneYStrength = smoothstep(0.5, 0.0, coneYAlpha);\n\n        vConeY = coneYAlpha;\n\n        if (capState < 0.5) {\n          vec3 targetPoint = vec3(0.0, coneHeight, 0.0);\n          vec3 targetDir = normalize(position.xyz - targetPoint);\n\n          float time = ripple * PI * 2.0;\n          float rippleFreq = PI * 2.0 * 0.5;\n          float rippleAmp = 0.1;\n          transformed.xz += norm * cos(coneAngle * 5.0 + elapsed) * 0.1 * pow(1.0 - coneYAlpha, 5.0);\n          transformed.xyz += targetDir * (sin(coneAngle * rippleFreq + time)) * rippleAmp * coneYStrength;\n        }\n        transformed.xyz += tilt * vec3(-1.0, 0.0, 0.0) * (1.0 - pow(coneYAlpha, 0.85));\n\n\n        if (stroke) {\n          // transformed.xyz *= 1.1;\n          // transformed.xyz += normal.xyz * 0.2;\n          // transformed.y -= 0.1;\n        }\n        \n        // if (capState < -0.5) {\n        //   transformed.y -= 0.1;\n        // }\n        vNormal = normalMatrix * normal;\n        vec3 worldPos = (modelMatrix * vec4(transformed.xyz, 1.0)).xyz;\n        // vec3 moveDir = vec3(cos(rotationAngle), 0.0, sin(rotationAngle));\n        // worldPos -= moveDir * tilt * 4.0;\n        vec4 vpos = viewMatrix * vec4(worldPos, 1.0);\n        vViewPoisition = -vpos.xyz;\n\n        gl_Position = projectionMatrix * vpos;\n        vec4 spritePos = projectionMatrix * viewMatrix * vec4(vertexWorldPos, 1.0);\n        vScreenUv = (gl_Position.xy / gl_Position.w * 0.5 + 0.5);\n        vScreenUv.x -= spritePos.x / spritePos.w * 0.5 + 0.5;\n        vScreenUv.y -= spritePos.y / spritePos.w * 0.5 + 0.5;\n        vScreenUv = vScreenUv * 12.0;\n        // vScreenUv.x -= rotationAngle;\n      }\n    "}),s=new e.Mesh(v,c),f=new e.Group;f.add(s);const p=t.view(Tags.CapeMagicalEffect),u=t.view(Tags.AutoRemoveCapeMagicalEffect),m=(0,r.default)();let g={enabled:!1,value:0};const d=t.view(Tags.FinalBiomeResolution);return{group:f,update(e,o,r,a){m.tick(e),u.forEach(n=>{const o=n.get(Tags.AutoRemoveCapeMagicalEffect);o.elapsed+=e,o.elapsed>=o.delay&&(n.tagOff(Tags.CapeMagicalEffect),n.tagOff(Tags.AutoRemoveCapeMagicalEffect))}),s.rotation.y=r,c.uniforms.tilt.value=1.15*a,c.uniforms.rotationAngle.value=r,c.uniforms.elapsed.value+=e,c.uniforms.glowIntensity.value=l.glowIntensity,c.uniforms.glowIntensity2.value=l.glowIntensity2,l.capeSpeed>0?c.uniforms.ripple.value+=e*l.capeSpeed:c.uniforms.ripple.value+=e*n.lerp(.2,2,a);const i=d.length>0||p.length>0||t.findTag(Tags.DirectUserToOrigin);g.enabled!==i&&(m.cancel().to(g,{value:i?4:0,duration:i?1:2,ease:"sineOut"}),g.enabled=i),c.uniforms.magicalEffect.value=g.value}}}
},{"three":"IV0r","../../util/math":"Ov1X","../../util/ShaderManager":"igLh","../AnimationSystem":"cUmx","../../util/tween-ticker":"KgTk","../../util/ModCylinderGeometry":"QL7E"}],"fgI9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=l;var e=i(require("three")),n=i(require("../../util/math")),t=i(require("../../util/ShaderManager")),o=require("../../util/ModCylinderGeometry"),a=require("canvas-sketch-util/math");function r(e){if("function"!=typeof WeakMap)return null;var n=new WeakMap,t=new WeakMap;return(r=function(e){return e?t:n})(e)}function i(e,n){if(!n&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=r(n);if(t&&t.has(e))return t.get(e);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var l=a?Object.getOwnPropertyDescriptor(e,i):null;l&&(l.get||l.set)?Object.defineProperty(o,i,l):o[i]=e[i]}return o.default=e,t&&t.set(e,o),o}function l(){const n=new o.CylinderBufferGeometry({radiusTop:.15*.75,radiusBottom:.0225,height:1,radialSegments:4,heightSegments:16,openTop:!1,openBottom:!1});n.translate(0,.5,0);const r=t.create({name:"legsShader",uniforms:{uTime:{value:0},uTiltAngle:{value:0},noiseScale:{value:0},uBendScale:{value:0}},vertexShader:"\n      uniform float uTime;\n      uniform float uBendScale;\n      uniform float uTiltAngle;\n      uniform float noiseScale;\n      varying vec2 vUv;\n      mat3 rotation3dX(float angle) {\n      \tfloat s = sin(angle);\n      \tfloat c = cos(angle);\n\n      \treturn mat3(\n      \t\t1.0, 0.0, 0.0,\n      \t\t0.0, c, s,\n      \t\t0.0, -s, c\n      \t);\n      }\n      mat3 rotation3dZ(float angle) {\n      \tfloat s = sin(angle);\n      \tfloat c = cos(angle);\n\n      \treturn mat3(\n      \t\tc, s, 0.0,\n      \t\t-s, c, 0.0,\n      \t\t0.0, 0.0, 1.0\n      \t);\n      }\n\n      void main() {\n\n        vec4 worldPos = modelViewMatrix * vec4(position, 1.0);\n\n        float p = sin( uTime * 0.5 + worldPos.x * 1. ) * noiseScale;\n        float bendScale = sin(uTime) * 0.5 + 0.5;\n        float bendTgt = .3 + p;\n        float bendInfluence = 1. - pow(1.0 - position.y, 4.);\n        float bending = bendTgt * bendInfluence * uBendScale;\n\n\n        vec3 bendPos = position.xyz;\n        bendPos.y -= 1.0;\n        bendPos.x -= bending;\n        bendPos = rotation3dZ(uTiltAngle) * bendPos;\n        bendPos.y += 1.0;\n\n        // vec3 bendPos = vec3(position.x - bending, position.y, position.z);\n\n\n\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(bendPos, 1.0);\n\n        vUv = uv;\n      }\n    ",fragmentShader:"\n      varying vec2 vUv;\n      void main() {\n        gl_FragColor = vec4(0., 0.,0.,1.);\n      }\n    "}),i=new e.Mesh(n,r);i.rotateY(Math.PI),i.rotateZ(0),i.position.z-=.2;const l=new e.Mesh(n,r);l.rotateY(Math.PI),l.rotateZ(0),l.position.z+=.2;const u=new e.Group,s=new e.Group;s.add(i),s.add(l),u.add(s),u.scale.setScalar(1);const c=new e.Vector3(0,1,0),d=(new e.Vector3(1,0,0),[i,l]);return{group:u,update(e,n,t,o){d.forEach((n,t)=>{r.uniforms.uTime.value+=e,r.uniforms.noiseScale.value=(0,a.mapRange)(o,0,.7,0,.2),r.uniforms.uTiltAngle.value=(0,a.mapRange)(o,0,.7,0,30*Math.PI/180),n.position.x=(0,a.mapRange)(o,0,.7,-.2,-.5),r.uniforms.uBendScale.value=(0,a.mapRange)(o,0,.7,.1,.5)}),u.setRotationFromAxisAngle(c,t)}}}
},{"three":"IV0r","../../util/math":"Ov1X","../../util/ShaderManager":"igLh","../../util/ModCylinderGeometry":"QL7E","canvas-sketch-util/math":"RN3r"}],"JPTZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=c;var e=u(require("three")),t=u(require("../../tags")),r=l(require("../../util/CapsuleBufferGeometry")),o=u(require("../../util/math")),a=u(require("../../util/ShaderManager")),n=l(require("./CharacterHead")),i=l(require("./CapeMesh")),s=l(require("./CharacterLegs"));function l(e){return e&&e.__esModule?e:{default:e}}function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=a?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(o,n,i):o[n]=e[n]}return o.default=e,r&&r.set(e,o),o}function c(r,{capeMap:a,blobShadowMap:l}){const p=r.findTag(t.RenderLayers),u=(r.findTag(t.UserCharacter),new e.Group),c=new e.Group;u.add(c);new e.Vector3;const d=new e.ArrowHelper(new e.Vector3,new e.Vector3),f=new e.Vector3(0,0,1),g=(0,i.default)(r,{map:a}),y=(0,n.default)(),h=(0,s.default)(),m=new e.Sprite(new e.SpriteMaterial({map:l,depthTest:!1,depthWrite:!1,color:"hsl(0, 0%, 0%)",opacity:.15,transparent:!0}));m.scale.set(2,1,1).multiplyScalar(1),m.layers.disableAll(),m.layers.enable(p.shadow);const w=new e.Group;w.add(m),u.add(w),c.add(g.group),c.add(y.group),c.add(h.group),d.setDirection(f);g.group.position.y+=.8,y.group.position.y+=.8,h.group.position.y=.155;const M=g.group.position.y,v=y.group.position.y,S=h.group.position.y;c.scale.multiplyScalar(.8);const O=new e.Vector3,b=new e.Vector3,W=new e.Vector3,q=r.findTag(t.MainCamera);let x=.5,P=1,V=0,j=0,T=null,C=null;return{scale:1,getHatTipPoint:e=>y.getHatTipPoint(e),getScarfAnchor:e=>y.getScarfAnchor(e),group:u,update(e,t,r,a,n){V+=e;const i=t.position,s=t.velocity,l=t.direction,p=s.length(),m=o.clamp01(p/.2);let I=Math.atan2(l.z,l.x);null==T&&(C=I,T=I);if(n&&i.lengthSq()<=225){const e=-i.x,t=-i.z;I=Math.atan2(t,e)}const _=i.distanceToSquared(a.target);let A=C;_>=.25&&(A=I,C=I),T=o.dampAngle(T,A,n?10:50,e),f.set(Math.cos(T),0,Math.sin(T)),w.position.set(0,0,0).addScaledVector(f,-1*m);const D=q.matrixWorldInverse.elements[4],G=q.matrixWorldInverse.elements[5],H=q.matrixWorldInverse.elements[6],k=q.matrixWorldInverse.elements[0],z=q.matrixWorldInverse.elements[1],L=q.matrixWorldInverse.elements[2];O.set(D,G,H),b.set(k,z,L),q.getWorldDirection(W),g.update(e,q,-T,m,O,b,W),y.update(e,q,-T,m,O,b,W),h.update(e,q,-T,m,O,b,W),u.position.copy(i),d.setDirection(f),P=o.lerp(.1,.75,m),x=o.damp(x,P,3,e),j=.05*Math.sin(2*V);const B=x+j;c.position.y=B;const R=.9*o.lerp(1,1.1,m);w.scale.setScalar(R),u.scale.setScalar(1.25*this.scale),g.group.position.y=M+t.yOffset,y.group.position.y=v+t.yOffset,h.group.position.y=S+t.yOffset}}}
},{"three":"IV0r","../../tags":"injP","../../util/CapsuleBufferGeometry":"RVT0","../../util/math":"Ov1X","../../util/ShaderManager":"igLh","./CharacterHead":"l4Ze","./CapeMesh":"oeoa","./CharacterLegs":"fgI9"}],"R0fa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=o;var e=a(require("three")),t=a(require("../../util/math"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(r=function(e){return e?a:t})(e)}function a(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=r(t);if(a&&a.has(e))return a.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var i=n?Object.getOwnPropertyDescriptor(e,c):null;i&&(i.get||i.set)?Object.defineProperty(o,c,i):o[c]=e[c]}return o.default=e,a&&a.set(e,o),o}function o(){var r=20*Math.PI*20/1e4;const a=new e.Vector3,o=new e.Vector3,n=(new e.Vector3,new e.Vector3),c=new e.Vector3,i=new e.Vector3;let u=!1;return{maxVelocity:15,lerpToTarget:!1,get moveToTarget(){return u},set moveToTarget(e){u=e},target:c,position:i,velocity:o,direction:n,update(e){const p=c.distanceToSquared(i),l=Math.sqrt(p);if(u&&l>=1){a.copy(c).sub(i);const e=l,r=t.clamp01(Math.pow(e/2.5,.2)),n=.1;o.addScaledVector(a,r*n)}o.x=t.clamp(o.x,-15,15),o.y=t.clamp(o.y,-15,15),o.z=t.clamp(o.z,-15,15);var s=o.x,f=o.y,y=o.z,d=-.235*r*1.22*s*s*s/Math.abs(s),v=-.235*r*1.22*f*f*f/Math.abs(f),w=-.235*r*1.22*y*y*y/Math.abs(y),b=(d=isNaN(d)?0:d)/.05,h=(v=isNaN(v)?0:v)/.05,M=(w=isNaN(w)?0:w)/.05;o.x+=b*e,o.y+=h*e,o.z+=M*e,this.lerpToTarget?t.dampVector(i,c,.75,e,i):(i.x+=o.x*e*1,i.y+=o.y*e*1,i.z+=o.z*e*1),n.copy(o).normalize()}}}
},{"three":"IV0r","../../util/math":"Ov1X"}],"i4nA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=h;var e=l(require("three")),t=l(require("../../tags")),n=u(require("../../util/CapsuleBufferGeometry")),r=l(require("../../util/math")),i=l(require("../../util/ShaderManager")),o=u(require("../../systems/writing/Line3D")),s=u(require("../../util/Random")),a=u(require("simplex-noise"));function u(e){return e&&e.__esModule?e:{default:e}}function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}const p=new e.Vector3;function f(e={}){const{gravity:t=.1*-9.81,mass:n=.05}=e;return{update(e,t){for(let n=0;n<t.length;n++)i(e,t[n])},updatePoint:i};function i(e,t){const i=t.velocity,o=t.position,s=t.maxVelocity,a=t.speed,u=t.radius,c=Math.PI*u*u/1e4;if(i.x=r.clamp(i.x,-s,s),i.y=r.clamp(i.y,-s,s),i.z=r.clamp(i.z,-s,s),!t.pinned){var l=i.x,p=i.y,f=i.z,d=-.235*c*1.22*l*l*l/Math.abs(l),y=-.235*c*1.22*p*p*p/Math.abs(p),h=-.235*c*1.22*f*f*f/Math.abs(f);d=isNaN(d)?0:d,y=isNaN(y)?0:y,h=isNaN(h)?0:h;var m=d/n,v=y/n,g=h/n;i.x+=m*e,i.y+=v*e,i.z+=g*e,o.x+=i.x*e*a,o.y+=i.y*e*a,o.z+=i.z*e*a}}}function d(e,t,n={}){const{restingDistance:i=1,stiffness:o=1,strengths:s=[1,1]}=n;return{solve(n=1){p.copy(e.position).sub(t.position);const a=p.length();var u=0===a?i:(i-a)/a;let c,l,f=s[0],d=s[1];if(0==f&&0==d)c=0,l=0;else if(0==f&&d>0)c=0,l=o;else if(f>0&&0==d)c=o,l=0;else{var y=1/f;l=o-(c=y/(y+1/d)*o)}r.dampVector(t.position,e.position,1+15*(1-r.clamp01(a/u)),n,t.position)}}}function y(t,n={}){const{radius:r=20,maxVelocity:i=15,speed:o=1}=n,s=new e.Vector3(0,0,0);let a=Boolean(n.pinned);return{get pinned(){return a},set pinned(e){a=e},radius:r,maxVelocity:i,speed:o,position:t,velocity:s}}function h(){const t=new e.Group,n=new e.Vector3(0,1.35,0),i=f({mass:.05}),u=r.linspace(6).map((t,r)=>{const i=t;return y(new e.Vector3(i,0,0).add(n),{radius:50,maxVelocity:40,pinned:0===r})}),c=[];for(let e=0;e<u.length-1;e++){const t=u[e],n=u[e+1],r=(u.length,t.position.distanceTo(n.position));c.push(d(t,n,{stiffness:.5,restingDistance:r}))}const l=(0,s.default)(),p=new a.default(l.value),h=new o.default(world,{taper:!1,thickness:.75});h.material.uniforms.color.value.set("#f6eaae"),t.add(h);let m=0,v=0;return{group:t,update(e,t){if(v+=e,u[0].position.copy(t),(m+=e)>=1/30){m%=1/30;for(let e=0;e<1;e++)c.forEach(e=>e.solve(1/30))}u.forEach(e=>{const t=1*p.noise3D(1*e.position.x,v,1*e.position.z);e.velocity.y+=t}),i.update(e,u),h.updatePath(u,!0,!0)}}}
},{"three":"IV0r","../../tags":"injP","../../util/CapsuleBufferGeometry":"RVT0","../../util/math":"Ov1X","../../util/ShaderManager":"igLh","../../systems/writing/Line3D":"OoyW","../../util/Random":"LMfK","simplex-noise":"KFJE"}],"i2kq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=m;var e=y(require("three")),t=y(require("../tags")),r=f(require("../util/CapsuleBufferGeometry")),a=y(require("../util/math")),i=y(require("../util/ShaderManager")),o=f(require("three-quaternion-from-normal")),n=f(require("../util/tween-ticker")),c=f(require("../util/Assets")),u=require("../util/materials"),l=require("../util/resetPlayerPos"),p=f(require("./character/CharacterModel")),s=f(require("./character/PhysicsSpring")),d=f(require("./character/ScarfMesh")),g=require("./AnimationSystem");function f(e){return e&&e.__esModule?e:{default:e}}function T(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(T=function(e){return e?r:t})(e)}function y(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=T(t);if(r&&r.has(e))return r.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var n=i?Object.getOwnPropertyDescriptor(e,o):null;n&&(n.get||n.set)?Object.defineProperty(a,o,n):a[o]=e[o]}return a.default=e,r&&r.set(e,a),a}function m(r){const i=r.findTag(t.Renderer),o=r.entity("CharacterEntity").add(t.UserCharacter),[n]=c.default.createGPUTextureTask(i,"image/data/soft-circle"),[u]=c.default.createGPUTextureTask(i,"image/data/cape-texture-landscape-1024",{generateMipmaps:!1,minFilter:e.NearestFilter,wrapS:e.RepeatWrapping,wrapT:e.RepeatWrapping}),d=new e.Group,f=(0,p.default)(r,{capeMap:u,blobShadowMap:n});f.group.name="character-model",d.name="character-container",d.add(f.group),o.add(t.Object3D,d);const T=(0,s.default)(),y=new e.Vector3;let m=!1;const v=r.tag(t.HatTipPoint),h=new e.Vector3,q=r.listen(t.AnimateInCharacter),M=r.listen(t.AnimateOutCharacter),O={value:1};return function(e){const i=r.findTag(t.HideCharacter),n=r.findTag(t.OriginTreeIntroSequence),c=r.findTag(t.UserTarget),u=r.findTag(t.InputState),p=o.get(t.UserCharacter),s=Boolean(r.findTag(t.CameraStopUserMovement)),P=!Boolean(r.findTag(t.BlockUserMove)),S=!n&&!s&&!Boolean(r.findTag(t.ModalStoppingUserMovement));let w=Boolean(r.findTag(t.MoveUserToOrigin));const b=c.position.distanceToSquared(p.position);let C=i;if(q.added.forEach(e=>{w=!0,C=!0,O.value=0,T.target.copy(l.standingNextToOriginTree),T.position.copy(T.target),p.position.copy(T.target),e.remove(t.AnimateInCharacter),(0,g.tweenTo)(r,O,"value",1,1,"quadOut",0).add(t.BlockUserMove)}),M.added.forEach(e=>{e.remove(t.AnimateOutCharacter),(0,g.tweenTo)(r,O,"value",0,.01,"quadIn",11).add(t.BlockUserMove)}),b>=576&&!w&&(p.position.copy(c.position),T.target.copy(c.position),T.position.copy(c.position),C=!0),C&&(p.velocity.set(0,0),T.velocity.set(0,0,0),T.direction.set(1,0,0)),T.lerpToTarget=!1,w)T.target.copy(l.standingNextToOriginTree),T.moveToTarget=!0,T.lerpToTarget=!0;else if(u.interacted&&c.inputHitPlane&&S&&P){if(T.moveToTarget=!0,m){y.distanceToSquared(c.inputPositionOnPlane)>=625&&(m=!1)}m?a.dampVector(y,c.inputPositionOnPlane,50,e,y):(m=!0,y.copy(c.inputPositionOnPlane)),T.target.copy(y).sub(c.position);const t=T.target.lengthSq();if(t>=144){const e=Math.sqrt(t);0!==e&&T.target.divideScalar(e),T.target.multiplyScalar(12).add(c.position)}else T.target.copy(y)}else T.moveToTarget=!1;T.update(e);p.velocity.copy(T.velocity).multiplyScalar(.2/T.maxVelocity),p.position.copy(T.position),p.direction.copy(T.direction),f.scale=O.value,f.update(e,p,c,T,w),f.getScarfAnchor(h),f.getHatTipPoint(v),d.visible=!n&&!i}}
},{"three":"IV0r","../tags":"injP","../util/CapsuleBufferGeometry":"RVT0","../util/math":"Ov1X","../util/ShaderManager":"igLh","three-quaternion-from-normal":"HvyF","../util/tween-ticker":"KgTk","../util/Assets":"Wm90","../util/materials":"phuP","../util/resetPlayerPos":"quSS","./character/CharacterModel":"JPTZ","./character/PhysicsSpring":"R0fa","./character/ScarfMesh":"i4nA","./AnimationSystem":"cUmx"}],"ELXm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=c;var t=l(require("../tags")),e=l(require("three")),a=l(require("../util/math")),i=o(require("./writing/Line3D")),n=o(require("../util/ObjectPool")),r=o(require("../util/Random"));function o(t){return t&&t.__esModule?t:{default:t}}function s(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,a=new WeakMap;return(s=function(t){return t?a:e})(t)}function l(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var a=s(e);if(a&&a.has(t))return a.get(t);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var o=n?Object.getOwnPropertyDescriptor(t,r):null;o&&(o.get||o.set)?Object.defineProperty(i,r,o):i[r]=t[r]}return i.default=t,a&&a.set(t,i),i}class u{constructor(){this.position=[0,0,0],this.velocity=[0,0,0],this.index=0}reset(){this.index=0,this.position[0]=0,this.position[1]=0,this.position[2]=0,this.velocity[0]=0,this.velocity[1]=0,this.velocity[2]=0}}function c(o){const s=new n.default({name:"HatWindLineSamples",initialCapacity:120,create:()=>new u,renew:t=>(t.reset(),t)}),l=new n.default({name:"HatWindLines",initialCapacity:3,create(){const t=new i.default(o,{taper:!0,thickness:.1,bloom:0});return t.userData.path=[],t.userData.lastPosition=new e.Vector3,t.userData.velocity=new e.Vector3,t.userData.hasLastPosition=!1,t.userData.entity=null,t.userData.time=0,t.userData.delay=.25,t.userData.duration=1,t.name="hat-tip-line",t},renew(e){const a=o.entity();return a.add(t.Object3D,e).add(t.HatTipWindLineTag),e.userData.entity=a,e.userData.time=0,e.userData.delay=.25,e.userData.duration=1,e.userData.velocity.set(0,0,0),e.position.set(0,0,0),e},release(t){t.userData.entity&&(t.userData.entity.kill(),t.userData.entity=null),t.userData.hasLastPosition=!1,t.userData.path.length=0}}),c=o.view(t.HatTipPoint),p=o.view(t.HatTipWindLineTag),h=o.view(t.WrittenStanzaLineActive);let d=null,f=!1,y=null,D=0;const g=(0,r.default)(),v=()=>g.range(.5,1);let w=v(),P=((()=>g.range(.1,.1))(),0);let m=0;const b=o.view(t.ActiveEnvironmentState);return function(e){D+=e;const i=o.findTag(t.UserCharacter),n=o.findTag(t.UserTarget),r=Math.atan2(i.direction.z,i.direction.x);i.velocity.length();if(null!=y){const t=Math.abs(a.deltaAngle(r,y)),e=a.radToDeg(t),i=5;m-=m/i,m+=e/i,f&&m<1?P>=w/2&&(f=!1,w=v(),d=null,P=0):!f&&m>4&&n.forceApplied&&0===h.length&&(P=0,f=!0)}if(y=r,f&&(P+=e)>=w&&(P%=w,d=!1,f=!1,w=v(),m=0),c.length>0&&f){const e=c[0].get(t.HatTipPoint);if(!d){d=l.next();const e=b.length>0?b[0].get(t.EnvironmentState).name:null;d.userData.entity.add(t.HatTipWindLineSound,e)}const a=.1,n=a*a,r=d.userData;if(!r.hasLastPosition||r.lastPosition.distanceToSquared(e)>=n){r.hasLastPosition=!0,r.path.length<=0&&r.velocity.copy(i.velocity);const t=s.next();if(e.toArray(t.position),i.velocity.toArray(t.velocity),r.path.length>0&&(t.index=r.path[r.path.length-1].index+1),r.path.length>50){const t=r.path.shift();s.release(t)}r.path.push(t),r.path.length>4&&d.updatePath(r.path,!0),r.lastPosition.copy(e)}d.visible=r.path.length>4}p.forEach(a=>{const i=a.get(t.Object3D);d!==i&&(i.userData.time+=e);const n=Math.max(0,i.userData.time-i.userData.delay),r=1-n/i.userData.duration;if(i.material.uniforms.opacity.value=.5*r,n>=i.userData.duration)i.userData.path.forEach(t=>s.release(t)),l.release(i);else{const t=10;i.userData.path.forEach((a,i,n)=>{const r=n.length<=1?0:i/(n.length-1);a.position[0]+=a.velocity[0]*e*t*r,a.position[2]+=a.velocity[2]*e*t*r,a.position[1]+=-.5*e}),i.updatePath(i.userData.path,!0)}})}}
},{"../tags":"injP","three":"IV0r","../util/math":"Ov1X","./writing/Line3D":"OoyW","../util/ObjectPool":"iiAR","../util/Random":"LMfK"}],"AL87":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=p;var e=i(require("../tags")),t=i(require("three")),r=n(require("../util/Assets"));function n(e){return e&&e.__esModule?e:{default:e}}function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in e)if("default"!==p&&Object.prototype.hasOwnProperty.call(e,p)){var u=i?Object.getOwnPropertyDescriptor(e,p):null;u&&(u.get||u.set)?Object.defineProperty(n,p,u):n[p]=e[p]}return n.default=e,r&&r.set(e,n),n}function p(n){const a=new t.Scene,i=new t.OrthographicCamera(-1,1,1,-1,-10,10),p=(n.tag(e.Atmospherics,{scene:a,camera:i}),n.findTag(e.Renderer)),[u]=r.default.createGPUTextureTask(p,"image/data/lightray",{wrapS:t.RepeatWrapping,wrapT:t.RepeatWrapping}),o=new t.Sprite(new t.SpriteMaterial({map:u,depthTest:!1,depthWrite:!1,transparent:!0,opacity:.5,blending:t.AdditiveBlending,side:t.DoubleSide}));return o.scale.setScalar(2),o.position.set(.5,.5,0),a.add(o),e=>{}}
},{"../tags":"injP","three":"IV0r","../util/Assets":"Wm90"}],"whzg":[function(require,module,exports) {
"use strict";function r(r){var t,e=r.length,n=1,a=new Array(e);for(t=e;t>0;t--)a[t-1]=n,n*=r[t-1];return{stride:a,data:new Uint32Array(n)}}module.exports=r;
},{}],"luIz":[function(require,module,exports) {
"use strict";var t=require("./tiny-ndarray"),i=2e-14,s=Math.PI/3,e=[[0,0],[0,-1],[-1,0],[1,0],[0,1],[-1,-1],[1,-1],[-1,1],[1,1],[0,-2],[-2,0],[2,0],[0,2],[-1,-2],[1,-2],[-2,-1],[2,-1],[-2,1],[2,1],[-1,2],[1,2]],r=e.length;function n(e,r){this.width=e.shape[0],this.height=e.shape[1],this.radius=e.radius||e.minDistance,this.maxTries=Math.max(3,Math.ceil(e.tries||30)),this.rng=r||Math.random,this.squaredRadius=this.radius*this.radius,this.radiusPlusEpsilon=this.radius+i,this.cellSize=this.radius*Math.SQRT1_2,this.angleIncrement=2*Math.PI/this.maxTries,this.angleIncrementOnSuccess=s+i,this.triesIncrementOnSuccess=Math.ceil(this.angleIncrementOnSuccess/this.angleIncrement),this.processList=[],this.samplePoints=[],this.gridShape=[Math.ceil(this.width/this.cellSize),Math.ceil(this.height/this.cellSize)],this.grid=t(this.gridShape)}n.prototype.width=null,n.prototype.height=null,n.prototype.radius=null,n.prototype.radiusPlusEpsilon=null,n.prototype.squaredRadius=null,n.prototype.cellSize=null,n.prototype.angleIncrement=null,n.prototype.angleIncrementOnSuccess=null,n.prototype.triesIncrementOnSuccess=null,n.prototype.maxTries=null,n.prototype.rng=null,n.prototype.processList=null,n.prototype.samplePoints=null,n.prototype.gridShape=null,n.prototype.grid=null,n.prototype.addRandomPoint=function(){return this.directAddPoint([this.rng()*this.width,this.rng()*this.height,this.rng()*Math.PI*2,0])},n.prototype.addPoint=function(t){return 2===t.length&&t[0]>=0&&t[0]<this.width&&t[1]>=0&&t[1]<this.height?this.directAddPoint([t[0],t[1],this.rng()*Math.PI*2,0]):null},n.prototype.directAddPoint=function(t){var i=[t[0],t[1]];this.processList.push(t),this.samplePoints.push(i);var s=(t[0]/this.cellSize|0)*this.grid.stride[0]+(t[1]/this.cellSize|0);return this.grid.data[s]=this.samplePoints.length,i},n.prototype.inNeighbourhood=function(t){var i,s,n,h,o,l=this.grid.stride;for(i=0;i<r;i++){for(s=0,n=0;n<2;n++){if((h=(t[n]/this.cellSize|0)+e[i][n])<0||h>=this.gridShape[n]){s=-1;break}s+=h*l[n]}if(-1!==s&&0!==this.grid.data[s]&&(o=this.samplePoints[this.grid.data[s]-1],Math.pow(t[0]-o[0],2)+Math.pow(t[1]-o[1],2)<this.squaredRadius))return!0}return!1},n.prototype.next=function(){for(var t,i,e,r;this.processList.length>0;){var n=this.processList.length*this.rng()|0;for(e=(i=this.processList[n])[2],0===(t=i[3])&&(e+=(this.rng()-.5)*s*4);t<this.maxTries;t++){if((r=[i[0]+Math.cos(e)*this.radiusPlusEpsilon,i[1]+Math.sin(e)*this.radiusPlusEpsilon,e,0])[0]>=0&&r[0]<this.width&&r[1]>=0&&r[1]<this.height&&!this.inNeighbourhood(r))return i[2]=e+this.angleIncrementOnSuccess+this.rng()*this.angleIncrement,i[3]=t+this.triesIncrementOnSuccess,this.directAddPoint(r);e+=this.angleIncrement}if(t>=this.maxTries){const t=this.processList.pop();n<this.processList.length&&(this.processList[n]=t)}}return null},n.prototype.fill=function(){for(0===this.samplePoints.length&&this.addRandomPoint();this.next(););return this.samplePoints},n.prototype.getAllPoints=function(){return this.samplePoints},n.prototype.reset=function(){var t,i=this.grid.data;for(t=0;t<i.length;t++)i[t]=0;this.samplePoints=[],this.processList.length=0},module.exports=n;
},{"./tiny-ndarray":"whzg"}],"FZ4x":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=l;var e=u(require("../tags")),t=u(require("three")),r=i(require("fast-2d-poisson-disk-sampling")),n=i(require("../util/Random")),o=u(require("../util/ShaderManager")),a=i(require("../util/Assets"));function i(e){return e&&e.__esModule?e:{default:e}}function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}async function l(i){const s=await a.default.createGPUTexture(i.findTag(e.Renderer),"image/data/grass-1"),u=(0,n.default)(),{position:l,uv:f,index:v}=(new t.BufferGeometry,c()),d=new t.InstancedBufferGeometry;d.setAttribute("position",l),d.setAttribute("uv",f),d.setIndex(v);const p=new r.default({shape:[40,40],radius:1,tries:10},u.value).fill().map(e=>[e[0]-20,e[1]-20]),x=[];for(let e=0;e<p.length;e++){const t=p[e],r=.75;x.push(t[0],t[1],u.gaussian(r,r/2))}console.log("Instances",p.length),d.instanceCount=p.length;const m=new t.InstancedBufferAttribute(new Float32Array(x),3);d.setAttribute("offset",m);const g=o.create({uniforms:{color:{value:new t.Color("#d8ab38")},colorGround:{value:new t.Color("#B88211")},map:{value:s},aspect:{value:s.image.width/s.image.height}},fragmentShader:"\n      uniform sampler2D map;\n      uniform vec3 color;\n      uniform vec3 colorGround;\n      varying vec2 vUv;\n      void main () {\n        vec4 cData = texture2D(map, vUv);\n        vec4 outColor = vec4(mix(colorGround, color, vUv.y), 1.0);\n        // outColor.rgb += 0.1 * (cData.g * 2.0 - 1.0);\n        float mask = 1.0 - cData.r;\n        gl_FragColor = outColor;\n        if (mask < 0.5) discard;\n      }\n    ",vertexShader:"\n      attribute vec3 offset;\n      uniform float aspect;\n      varying vec2 vUv;\n      void main () {\n        vUv = uv;\n        float curScale = offset.z;\n        vec3 centerWorldPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n        vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n        vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n        vec2 scale;\n        scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n        scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n        scale *= curScale;\n\n        vec2 offsetPos = position.xy;\n        vec3 vertexWorldPos = centerWorldPos\n          + camRightWorld * offsetPos.x * scale.x * aspect \n          + camUpWorld * offsetPos.y * scale.y;\n\n        vertexWorldPos.xz += offset.xy;\n\n        // gl_Position = projectionMatrix * modelViewMatrix * vec4(transformed.xyz, 1.0);\n        gl_Position = projectionMatrix * viewMatrix * vec4(vertexWorldPos, 1.0);\n      }\n    ",side:t.DoubleSide});for(let r=0;r<9;r++){const n=Math.floor(r%3),o=Math.floor(r/3),a=new t.Mesh(d,g);i.entity().add(e.Object3D,a),a.frustumCulled=!1,a.position.x=40*(n-1.5),a.position.z=40*(o-1.5)}return e=>{}}function c(){const e=new t.PlaneBufferGeometry(1,1,1,3),r=e.attributes,n=r.position.count,o=[],a=[];for(let t=0;t<n;t++){const e=r.position.getX(t),n=r.position.getY(t)+.5;o.push(e,n);const i=r.uv.getX(t),s=r.uv.getY(t);a.push(i,s)}const i=new t.BufferAttribute(new Float32Array(o),2),s=new t.BufferAttribute(new Float32Array(a),2),u=new t.BufferAttribute(e.getIndex().array,1);return e.dispose(),{position:i,uv:s,index:u}}
},{"../tags":"injP","three":"IV0r","fast-2d-poisson-disk-sampling":"luIz","../util/Random":"LMfK","../util/ShaderManager":"igLh","../util/Assets":"Wm90"}],"WEUS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t;const e=e=>e;function t(t=0,s=1,i=0,n=.25,o=e){const r=Math.max(0,t-i);let a=0;if(r<=n)a=r/n;else if(isFinite(s)&&r>=s-n){a=1-Math.max(0,r-(s-n))/n}else a=1;return a=o(a)}
},{}],"iSWR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.setSpriteFlip=c,exports.setMeshToSprite=p,exports.createSprite=d,exports.traverseAndFixSprites=v,exports.changeToWayfinderSprite=x,exports.default=exports.WayfinderSpriteMaterial=void 0;var e=o(require("three")),t=o(require("../tags")),r=require("./materials"),a=i(require("./defined"));function i(e){return e&&e.__esModule?e:{default:e}}function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(a,o,s):a[o]=e[o]}return a.default=e,r&&r.set(e,a),a}const s=new e.PlaneGeometry(1,1,1,1);s.translate(0,.5,0);class l extends e.MeshBasicMaterial{constructor(t={}){super({...t,map:t.map||new e.Texture}),this.name=this.name||"UntitledWayfinderSprite",this.userData.type="WayfinderSpriteMaterial"}onBeforeCompile(e){e.uniforms=e.uniforms||{};const t=Boolean(this.userData.flipX);e.uniforms.flipX={value:t,type:"b"},e.uniforms.silhouette={value:!1,type:"b"},e.vertexShader="\n    #include <common>\n    varying vec2 vUv;\n    uniform bool flipX;\n    uniform bool silhouette;\n    void main () {\n      vUv = uv;\n      if (flipX) vUv.x = 1.0 - vUv.x;\n\n      vec3 centerWorldPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n      vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n      vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n      vec2 scale;\n      scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n      scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n      vec3 offsetPos = position.xyz;\n      vec3 vertexWorldPos = centerWorldPos\n        + camRightWorld * offsetPos.x * scale.x\n        + camUpWorld * offsetPos.y * scale.y;\n\n      if (silhouette) {\n        float xSkew = -60.0 * (PI/180.0);\n        float ySkew = 0.0;\n\n        // Create a transform that will skew our texture coords\n        mat3 trans = mat3(\n          1.0       , tan(xSkew), 0.0,\n          tan(ySkew), 1.0,        0.0,\n          0.0       , 0.0,        1.0\n        );\n        float yPos = vertexWorldPos.y;\n        vertexWorldPos.y *= 0.25;\n        vertexWorldPos.xyz -= camRightWorld * yPos * 0.5;\n        vertexWorldPos.z += -0.15;\n      }\n      gl_Position = projectionMatrix * viewMatrix * vec4(vertexWorldPos, 1.0);\n    }",e.fragmentShader="\n    uniform sampler2D map;\n    uniform bool silhouette;\n    // uniform vec3 color;\n    varying vec2 vUv;\n    void main () {\n      gl_FragColor = texture2D(map, vUv);\n      if (gl_FragColor.a < 0.5) discard;\n    }\n    ",this._currentShader=e,this.userData.flipX=t}getFlipX(){return Boolean(this.userData.flipX)}setFlipX(e){e=Boolean(e),this._currentShader&&(this._currentShader.uniforms.flipX.value=e),this.userData.flipX=e}}exports.WayfinderSpriteMaterial=l;class u extends e.Mesh{constructor(){super(s,h()),this.userData.type="WayfinderSprite",this.onBeforeRender=f.bind(this),this.__onImageUpdate=this.onBeforeRender}}function f(){let e=this.scale.x;const t=this.scale.y;let r=1;if(this.material&&this.material.map&&this.material.map.image){const{width:e,height:a}=this.material.map.image;r=e/a,this.scale.x=t*r}e!==this.scale.x&&this.updateMatrix()}function m(t,a,i,n=1/0,o=!1){const l=i&&i.image?i.image.width/i.image.height:1;a.geometry=s,a.material=(0,r.createSpriteMaterial)(t),a.material.uniforms.map.value=i,a.material.uniforms.repeat.value.copy(i.repeat),a.material.uniforms.offset.value.copy(i.offset),a.material.uniforms.flip.value=o?-1:1,a.material.side=o?e.BackSide:e.FrontSide,a.material.uniforms.useMapDiscard.value=!1,a.material.uniforms.aspect.value=l,a.material.uniforms.spriteHeight.value=a.scale.y}function c(t,r){t.material.uniforms.flip.value=r?-1:1,t.material.side=r?e.BackSide:e.FrontSide}function p(e,t,r=1/0){m(e,t,t.material.uniforms&&t.material.uniforms.map?t.material.uniforms.map.value:t.material.map,r,(0,a.default)(t.material.userData.flipX,t.userData.flipX))}function d(t,r,a=1,i=1/0,n=!1){const o=new e.Mesh;return o.scale.y=a,m(t,o,r,i,n),o}function v(e,t){t.traverse(t=>{t&&t.userData&&"WayfinderSprite"===t.userData.type&&p(e,t)})}function x(t){t.geometry=s;const r=new e.Texture;t.material.map&&(r.image=t.material.map.image,r.needsUpdate=!0);const a={...t.material.userData};t.material=h(r),Object.assign(t.material.userData,a),t.onBeforeRender=f.bind(t),t.__onImageUpdate=t.onBeforeRender}function h(t){return new l({map:t||new e.Texture})}exports.default=u;
},{"three":"IV0r","../tags":"injP","./materials":"phuP","./defined":"FOUO"}],"yACJ":[function(require,module,exports) {
module.exports=function(o,r){var t,e=0;for(t=0;t<o.length;t++)e+=Math.pow(o[t]-r[t],2);return e};
},{}],"nZ95":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.boundsToEdges=o,exports.boundsIntersect=s,exports.boundsInsideOther=u,exports.getBoundingCircle=c,exports.circlesIntersect=i,exports.point2DInsideBounds=d,exports.circleInsideBounds=l,exports.vertsToEdges=f,exports.boundsToVerts=p,exports.intersectLineSegmentLineSegment=a;var t=require("./math"),e=r(require("bound-points")),n=r(require("euclidean-distance/squared"));function r(t){return t&&t.__esModule?t:{default:t}}function o(t){const[e,n]=t,r=[[e[0],e[1]],[n[0],e[1]],[n[0],n[1]],[e[0],n[1]]],o=[];for(let s=0;s<r.length;s++){const t=r[s],e=r[(s+1)%r.length];o.push([t,e])}return o}function s(t,e){const[n,r]=t,[o,s]=e,[u,c]=n,[i,d]=r,[l,f]=o,[p,a]=s;return!(u>p||l>i||c>a||f>d)}function u(t,e){const[n,r]=t,[o,s]=e,u=r[0]-n[0],c=r[1]-n[1],i=n[0],d=n[1],l=s[0]-o[0],f=s[1]-o[1],p=o[0],a=o[1];return u>0&&c>0&&l>0&&f>0&&p>=i&&p+l<=i+u&&a>=d&&a+f<=d+c}function c(r,o=null){o||(o=(0,e.default)(r));const s=(0,t.lerpArray)(o[0],o[1],.5);let u=0;for(let t=0;t<r.length;t++)u=Math.max(u,(0,n.default)(r[t],s));return{center:s,radius:Math.sqrt(u)}}function i(t,e,n,r){const o=t[0]-n[0],s=t[1]-n[1],u=e+r;return o*o+s*s<=u*u}function d(t,e){const[n,r]=t,[o,s]=e;return n>=o[0]&&n<s[0]&&r>=o[1]&&r<s[1]}function l(t,e,n){const[r,o]=t,[s,u]=n;return r-e>=s[0]&&r+e<u[0]&&o-e>=s[1]&&o+e<u[1]}function f(t){const e=[];for(let n=0;n<4;n++){const r=t[n],o=t[(n+1)%t.length];e.push([r,o])}return e}function p(t){const[e,n]=t,[r,o]=e,s=n[0]-e[0],u=n[1]-e[1];return[[r,o],[r+s,o],[r+s,o+u],[r,o+u]]}function a(t,e,n,r){const o=e[0]-t[0],s=e[1]-t[1],u=r[0]-n[0],c=r[1]-n[1],i=o*c-s*u;if(0===i)return-1;const d=((t[1]-n[1])*o-(t[0]-n[0])*s)/i;if(d<0||d>1)return-1;const l=((t[1]-n[1])*u-(t[0]-n[0])*c)/i;return l<0||l>1?-1:l}
},{"./math":"Ov1X","bound-points":"T2x6","euclidean-distance/squared":"yACJ"}],"d84u":[function(require,module,exports) {
module.exports=function(r,o,v,e){var n=r[0],t=r[1],a=!1;void 0===v&&(v=0),void 0===e&&(e=o.length);for(var d=(e-v)/2,i=0,u=d-1;i<d;u=i++){var f=o[v+2*i+0],l=o[v+2*i+1],c=o[v+2*u+0],g=o[v+2*u+1];l>t!=g>t&&n<(c-f)*(t-l)/(g-l)+f&&(a=!a)}return a};
},{}],"Mq1V":[function(require,module,exports) {
module.exports=function(r,o,v,e){var n=r[0],t=r[1],a=!1;void 0===v&&(v=0),void 0===e&&(e=o.length);for(var d=e-v,i=0,u=d-1;i<d;u=i++){var f=o[i+v][0],l=o[i+v][1],c=o[u+v][0],g=o[u+v][1];l>t!=g>t&&n<(c-f)*(t-l)/(g-l)+f&&(a=!a)}return a};
},{}],"vDBG":[function(require,module,exports) {
var e=require("./flat.js"),r=require("./nested.js");module.exports=function(t,s,o,u){return s.length>0&&Array.isArray(s[0])?r(t,s,o,u):e(t,s,o,u)},module.exports.nested=r,module.exports.flat=e;
},{"./flat.js":"d84u","./nested.js":"Mq1V"}],"j8Gj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.insideWaterPolys=r,exports.getLakeObject=o;var e=require("./geometry"),n=t(require("point-in-polygon"));function t(e){return e&&e.__esModule?e:{default:e}}function r(t,r){if(!t.hasLakes)return!1;for(let o=0;o<t.lakes.length;o++){const s=t.lakes[o];if((0,e.point2DInsideBounds)(r,s.bounds)&&(0,n.default)(r,s.polygon))return!0}return!1}function o(t,r){if(!t.hasLakes)return null;for(let o=0;o<t.lakes.length;o++){const s=t.lakes[o];if((0,e.point2DInsideBounds)(r,s.bounds)&&(0,n.default)(r,s.polygon))return s}return null}
},{"./geometry":"nZ95","point-in-polygon":"vDBG"}],"jU6f":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=M;var e=v(require("../tags")),t=v(require("three")),a=y(require("../util/ObjectPool")),r=require("../util/three-util"),n=y(require("fast-2d-poisson-disk-sampling")),i=y(require("../util/ease-animate")),s=require("../util/materials"),o=require("../util/EditorWayfinderSprite"),l=require("../util/load"),u=require("./AnimationSystem"),d=y(require("../util/Random")),f=y(require("../util/Assets")),c=y(require("right-now")),p=require("eases"),g=require("../util/water-util"),m=y(require("../util/query-string")),h=y(require("../util/SpriteManager"));function y(e){return e&&e.__esModule?e:{default:e}}function w(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(w=function(e){return e?a:t})(e)}function v(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=w(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=n?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(r,i,s):r[i]=e[i]}return r.default=e,a&&a.set(e,r),r}function M(n){const l=n.view(e.HaikuInInventory),u=n.findTag(e.Renderer),f=(0,d.default)(),m={sprite:!0},y=new t.Group;let w,v;y.name="haiku-flora",n.entity().add(e.Object3D,y),(0,h.default)("spritesheets/ground-flowers",u).then(e=>{w=e,v={forest:["flower-05","flower-04","flower-01"].map(e=>w.frames.find(t=>t.name===e)),grasslands:["grasslands1","grasslands2","grasslands3"].map(e=>w.frames.find(t=>t.name===e)),tundra:["tundra1","tundra3","tundra2"].map(e=>w.frames.find(t=>t.name===e)),grasslandsWater:w.frames.filter(e=>/lily/i.test(e.name))}});const M=new t.Vector3,q=[0,0],D=(n.findTag(e.UserCharacter),n.view(e.SpawnedFlora));let x=new t.Vector3,b=!1;const S=new a.default({maxCapacity:100,create(){const e=new t.Mesh((0,s.getSpriteGeometry)(),(0,s.createSpriteMaterial)(n));return e.material.userData.flipX=f.boolean(),(0,o.setMeshToSprite)(n,e,1),e.userData._entity=null,e}});let O=0;const j=()=>f.range(.1,.2);let k=j(),_=!1,F=!1;const P=n.view(e.ActiveEnvironmentState),T=n.view([e.FloatingToken,e.FloatingTokenTargetUser]),W=n.listen(e.FinalBiomeResolution),A=n.view(e.FinalBiomeResolution),z=new t.Vector2;let C=!0;return t=>{const a=n.findTag(e.WrittenStanzaLineActive),s=P.length?P[0].get(e.EnvironmentState):null;if(!s)return;const o=A.length>0;let u;if(T.length&&!o&&(u=f.pick(T).get(e.FloatingToken)),W.added.length>0&&C){C=!1,S.maxCapacity=1/0;for(let e=0;e<150;e++){const e=-60*Math.PI/180+f.range(0,300*Math.PI/180)+f.gaussian(0,1*Math.PI/180),t=Math.cos(e),a=Math.sin(e),r=6+Math.abs(f.gaussian(0,3)),n=t*r,i=a*r,s=3.5+Math.sqrt(n*n+i*i)/12.5*2+f.range(0,1);I(z.set(n,i),"grasslands",!1,!1,s,0)}}if(u&&l.length>0&&!a){if((O+=t)>=k&&(O%=k,k=j(),_=!0),b){let e=u.position2D.x-x.x,t=u.position2D.y-x.z;e*e+t*t>=1&&(F=!0)}if(_&&(F||!b)&&u.position2D.lengthSq()>100){u.position2D.toArray(q);const e=!!s&&(0,g.insideWaterPolys)(s,q);F=!1,_=!1;const t=T.length;for(let a=0;a<t;a++)I(u.position2D,s.name,e);x.x=u.position2D.x,x.y=0,x.z=u.position2D.y,b=!0}}for(let n=0;n<D.length;n++){const a=D[n],s=a.get(e.SpawnedFlora);s.time+=t;const o=Math.max(0,s.time-s.delay),l=(0,i.default)(s.time,s.duration,s.delay,s.animateDuration,p.sineOut),u=a.get(e.Object3D),d=s.height*l;u.scale.y=1*d,u.scale.x=d*s.aspect*1,u.visible=u.scale.x>=1e-5,isFinite(s.duration)&&o>=s.duration&&((0,r.detachObject)(u),a.kill(),u.userData._entity=null,S.release(u))}};function I(t,a,i,s=!0,o=0,l=1){if(!v)return;if(i&&"grasslands"!==a)return;let d=S.next();if(!d)return;d.userData._entity=n.entity();Math.abs(f.gaussian(0,1));M.set(t.x,0,t.y),f.onCircle(f.gaussian(2,.35)*l,q),d.position.x=q[0]+M.x,d.position.z=q[1]+M.z,d.position.y=i?.05:0,y.add(d),d.userData._entity.add(e.Object3D,d).add(e.SpawnedFlora).add(e.ShaderUniformTime,{uniform:d.material.uniforms.time}),i||d.userData._entity.add(e.ShadowCaster,m);const p=d.userData._entity.get(e.SpawnedFlora),g=i?.35:"grasslands"===a?1.1:1,h=Math.min(1.25,f.gaussian(.85,.5))*g;let D;if(d.visible=!1,p.height=h,"grasslands"===a&&i)D=f.pick(i?v.grasslandsWater:v[a]);else{const e=v[a];D=e[f.rangeFloor(Math.min(e.length,T.length))]}d.material.uniforms.map.value=D.texture,(0,r.shareAtlasTexture)(u,w.atlases[0],D.texture),d.material.uniforms.offset.value.copy(D.offset),d.material.uniforms.repeat.value.copy(D.repeat);const x=D.width/D.height;p.aspect=x,p.delay=o,p.duration=s?f.range(2,5):1/0,p.spawnTime=(0,c.default)()}}
},{"../tags":"injP","three":"IV0r","../util/ObjectPool":"iiAR","../util/three-util":"bI4v","fast-2d-poisson-disk-sampling":"luIz","../util/ease-animate":"WEUS","../util/materials":"phuP","../util/EditorWayfinderSprite":"iSWR","../util/load":"OkDW","./AnimationSystem":"cUmx","../util/Random":"LMfK","../util/Assets":"Wm90","right-now":"ksES","eases":"uiPX","../util/water-util":"j8Gj","../util/query-string":"Bj6B","../util/SpriteManager":"Ffhm"}],"aPUh":[function(require,module,exports) {
module.exports=function(r,t){t||(t=[0,""]),r=String(r);var a=parseFloat(r,10);return t[0]=a,t[1]=r.match(/[\d.\-\+]*\s*(.*)/)[1]||"",t};
},{}],"Kcat":[function(require,module,exports) {
"use strict";var e=require("parse-unit");module.exports=i;var n=t("in",document.body);function r(n,r){var t=e(getComputedStyle(n).getPropertyValue(r));return t[0]*i(t[1],n)}function t(e,n){var t=document.createElement("div");t.style.height="128"+e,n.appendChild(t);var i=r(t,"height")/128;return n.removeChild(t),i}function i(u,a){if(!u)return null;switch(a=a||document.body,u=(u+""||"px").trim().toLowerCase(),a!==window&&a!==document||(a=document.body),u){case"%":return a.clientHeight/100;case"ch":case"ex":return t(u,a);case"em":return r(a,"font-size");case"rem":return r(document.body,"font-size");case"vw":return window.innerWidth/100;case"vh":return window.innerHeight/100;case"vmin":return Math.min(window.innerWidth,window.innerHeight)/100;case"vmax":return Math.max(window.innerWidth,window.innerHeight)/100;case"in":return n;case"cm":return n/2.54;case"mm":return n/25.4;case"pt":return n/72;case"pc":return n/6;case"px":return 1}var c=e(u);if(!isNaN(c[0])&&c[1]){var o=i(c[1],a);return"number"==typeof o?c[0]*o:null}return null}
},{"parse-unit":"aPUh"}],"icpc":[function(require,module,exports) {
"use strict";var e=require("to-px");function t(t,n,r){"function"==typeof t&&(r=!!n,n=t,t=window);var a=e("ex",t),i=function(e){r&&e.preventDefault();var t=e.deltaX||0,i=e.deltaY||0,d=e.deltaZ||0,o=1;switch(e.deltaMode){case 1:o=a;break;case 2:o=window.innerHeight}if(i*=o,d*=o,(t*=o)||i||d)return n(t,i,d,e)};return t.addEventListener("wheel",i),i}module.exports=t;
},{"to-px":"Kcat"}],"drV3":[function(require,module,exports) {
var process = require("process");
var e=require("process");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=c;var t=s(require("three")),r=s(require("../tags")),o=s(require("../util/math")),n=a(require("mouse-wheel")),u=a(require("../util/query-string"));function a(e){return e&&e.__esModule?e:{default:e}}function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var a=n?Object.getOwnPropertyDescriptor(e,u):null;a&&(a.get||a.set)?Object.defineProperty(o,u,a):o[u]=e[u]}return o.default=e,r&&r.set(e,o),o}function c(e,t){const a=e.entity("UserZoomEntity").add(r.UserZoom,t);let i,s=0;return u.default.zoom&&(i=(0,n.default)(e.findTag(r.Canvas),(e,t,r,o)=>{s+=t},!0)),{dispose(){i&&window.removeEventListener("wheel",i)},process:function(e){const t=a.get(r.UserZoom),{allowMouseZoom:n,distance:u,zoomPowFactor:i,zoomPixelsToWorld:c,zoomPowTarget:f,minDistance:l,maxDistance:d}=t;n&&(t.currentWheelOffset+=s);s=0;const p=Math.pow(u/f,i);t.distance+=t.currentWheelOffset*c*p,t.currentWheelOffset=0,t.distance=o.clamp(t.distance,l,d)}}}
},{"three":"IV0r","../tags":"injP","../util/math":"Ov1X","mouse-wheel":"icpc","../util/query-string":"Bj6B","process":"YOvR"}],"c4FT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=o;var e=a(require("../tags")),t=a(require("three")),r=require("../util/three-util");function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function a(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=o?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(a,u,i):a[u]=e[u]}return a.default=e,r&&r.set(e,a),a}function o(n){const a=n.findTag(e.Renderer),o=n.view(e.DebugRenderTarget),u=(n.listen(e.DebugRenderTarget),new t.OrthographicCamera),i=new t.Scene,l=new t.PlaneGeometry(1,1);return l.translate(.5,.5,0),n=>{const s=a.getSize(new t.Vector2);u.left=0,u.right=s.x,u.top=0,u.bottom=s.y,u.near=-10,u.far=10,u.updateProjectionMatrix(),(0,r.clearGroup)(i);let c=25;o.forEach((r,n)=>{const{target:a,visible:o}=r.get(e.DebugRenderTarget);if(!1===o)return;const u=150*(a.width/a.height),s=c;c+=175;const f=new t.Mesh(l,new t.MeshBasicMaterial({depthTest:!1,depthWrite:!1,map:a.texture,side:t.DoubleSide}));f.frustumCulled=!1,f.scale.set(u,-150,1),f.position.set(25,s+150,0),i.add(f)});const f=a.autoClear;a.autoClear=!1,a.render(i,u),a.autoClear=f}}
},{"../tags":"injP","three":"IV0r","../util/three-util":"bI4v"}],"Cvim":[function(require,module,exports) {
var r=4,n=.001,t=1e-7,u=10,e=11,o=1/(e-1),f="function"==typeof Float32Array;function i(r,n){return 1-3*n+3*r}function a(r,n){return 3*n-6*r}function c(r){return 3*r}function v(r,n,t){return((i(n,t)*r+a(n,t))*r+c(n))*r}function l(r,n,t){return 3*i(n,t)*r*r+2*a(n,t)*r+c(n)}function w(r,n,e,o,f){var i,a,c=0;do{(i=v(a=n+(e-n)/2,o,f)-r)>0?e=a:n=a}while(Math.abs(i)>t&&++c<u);return a}function s(n,t,u,e){for(var o=0;o<r;++o){var f=l(t,u,e);if(0===f)return t;t-=(v(t,u,e)-n)/f}return t}function y(r){return r}module.exports=function(r,t,u,i){if(!(0<=r&&r<=1&&0<=u&&u<=1))throw new Error("bezier x values must be in [0, 1] range");if(r===t&&u===i)return y;for(var a=f?new Float32Array(e):new Array(e),c=0;c<e;++c)a[c]=v(c*o,r,u);return function(f){return 0===f?0:1===f?1:v(function(t){for(var f=0,i=1,c=e-1;i!==c&&a[i]<=t;++i)f+=o;var v=f+(t-a[--i])/(a[i+1]-a[i])*o,y=l(v,r,u);return y>=n?s(t,v,r,u):0===y?v:w(t,f,f+o,r,u)}(f),t,i)}};
},{}],"r7mA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=l;var e=p(require("simplex-noise")),t=c(require("three")),o=c(require("../tags")),n=c(require("../util/math")),i=p(require("../util/tween-ticker")),a=p(require("bezier-easing")),r=p(require("../util/query-string"));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(s=function(e){return e?o:t})(e)}function c(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var o=s(t);if(o&&o.has(e))return o.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var r=i?Object.getOwnPropertyDescriptor(e,a):null;r&&(r.get||r.set)?Object.defineProperty(n,a,r):n[a]=e[a]}return n.default=e,o&&o.set(e,n),n}function p(e){return e&&e.__esModule?e:{default:e}}window.zoomLevel=1;let d=r.default.view||"2.5d";const u=new e.default(0);function l(e){const s=e.entity("UserFollowEntity").add(o.UserFollow),c=((0,a.default)(.37,.08,0,1.01),(0,a.default)(.39,.21,.05,1.04),(0,i.default)()),p=new t.Vector3,l={animatingToTarget:!1,animatingToPlayer:!1,positionStart:new t.Vector3,positionEnd:new t.Vector3,value:0,zoom:0},m=(e.listen(o.CinematicCameraMoment),e.view(o.CameraFocusOnTarget)),f=e.listen(o.CameraFocusOnTarget);let g=!0;const y=n.degToRad(-45),w=new t.Vector3(1,1,1);w.applyAxisAngle(new t.Vector3(0,1,0),y);const v=new t.Vector3;let T=[{zoom:2.5,fov:15,near:30,far:150},{zoom:1.33,fov:30,near:1,far:1e3},{zoom:2.4,fov:10,near:30,far:400}],D=T[0];r.default.zoom&&window.addEventListener("keydown",t=>{const n=t.key,i=parseInt(n,10)-1;if(0===i?d="2.5d":1===i?d="god":2===i&&(d="fp"),i>=0){const t=e.findTag(o.UserZoom);t.distance=t.defaultDistance,D=T[i<T.length?i:0]}});e.entity(),e.view(o.UserInPoemArea),e.view(o.UserCompletingPoem),e.entity();const x=new t.Frustum,M=new t.Matrix4;e.entity().add(o.MainCameraFrustum,x);let O=0;const h=e.findTag(o.AppState);return function(t){const i=s.get(o.UserFollow),a=e.findTag(o.UserZoom),r=a?a.distance:10,y=e.findTag(o.MainCamera),T=e.findEntity(o.UserTarget).get(o.UserTarget);if(i.shakeTime+=t*i.shakeSpeed,T.forceApplied?i.speedZoomDistance=n.damp(i.speedZoomDistance,i.maxSpeedZoomDistance,i.speedZoomSpringIn,t):i.speedZoomDistance=n.damp(i.speedZoomDistance,i.minSpeedZoomDistance,i.speedZoomSpringOut,t),g&&(i.currentDistance=r+i.speedZoomDistance,g=!1),f.added.forEach(e=>{const t=e.get(o.CameraFocusOnTarget);l.value=0,l.positionStart.copy(T.position),l.positionEnd.copy(t.target),l.animatingToTarget=!0,c.cancel(),c.to(l,{value:1,duration:2,ease:"sineInOut"}).on("complete",e=>{e.cancelling||(l.animatingToTarget=!1,l.animatingToPlayer=!1)})}),c.tick(t),m.length){m[0].get(o.CameraFocusOnTarget).target;p.copy(l.positionStart).lerp(l.positionEnd,l.value)}else p.copy(T.position);const z=Boolean(e.findTag(o.CameraZoomOut))?2:0;O=n.damp(O,z,2,t),i.currentDistance=n.damp(i.currentDistance,r+i.speedZoomDistance+O+.1*T.totalBoost,i.distanceSpring,t),y.position.copy(p),y.position.addScaledVector(w,D.zoom*i.currentDistance),i.currentTarget.copy(p),y.lookAt(p),y.position.add(v),"god"===d?y.position.y=70:"fp"===d&&(y.position.z+=6,y.position.y=6),y.fov=D.fov,y.near=D.near,y.far=D.far,y.matrixAutoUpdate=!1;const Z=i.shake,k=i.shakeTime;y.position.x+=u.noise3D(k,y.position.y,y.position.z)*Z,y.position.y+=u.noise3D(y.position.x,k,y.position.z)*Z,y.position.z+=u.noise3D(y.position.x,y.position.y,k)*Z;let P=1;const S=h.width/h.height/1.6;P=.9*n.clamp(.9*S,.85,1.5),y.zoom=P,y.updateMatrix(),y.updateMatrixWorld(),y.updateProjectionMatrix(),M.multiplyMatrices(y.projectionMatrix,y.matrixWorldInverse),x.setFromProjectionMatrix(M)}}
},{"simplex-noise":"KFJE","three":"IV0r","../tags":"injP","../util/math":"Ov1X","../util/tween-ticker":"KgTk","bezier-easing":"Cvim","../util/query-string":"Bj6B"}],"RNCT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=o;var e=n(require("three")),r=n(require("../tags"));function t(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,n=new WeakMap;return(t=function(e){return e?n:r})(e)}function n(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=t(r);if(n&&n.has(e))return n.get(e);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var f=i?Object.getOwnPropertyDescriptor(e,a):null;f&&(f.get||f.set)?Object.defineProperty(o,a,f):o[a]=e[a]}return o.default=e,n&&n.set(e,o),o}function o(t){t.system.info({hidden:!0});const n=t.view(r.ShaderUniformResolution),o=t.view(r.ShaderUniformTime),i=t.view(r.ShaderUniformUserTargetPosition),a=t.view(r.ShaderUniformUserCharacterPosition),f=new e.Vector2,u=(t.findTag(r.Renderer),t.findTag(r.AppState));return function(e){f.x=u.width,f.y=u.height,n.forEach(e=>{const t=e.get(r.ShaderUniformResolution);t.uniform&&t.uniform.value.set(f.x,f.y)}),o.forEach(t=>{const n=t.get(r.ShaderUniformTime);n.elapsed+=e,n.uniform&&(n.uniform.value=n.elapsed)});const s=t.findTag(r.UserTarget).position,c=t.findTag(r.UserCharacter).position;i.forEach(e=>{const t=e.get(r.ShaderUniformUserTargetPosition);t.uniform&&t.uniform.value.copy(s)}),a.forEach(e=>{const t=e.get(r.ShaderUniformUserCharacterPosition);t.uniform&&t.uniform.value.copy(c)})}}
},{"three":"IV0r","../tags":"injP"}],"z3IH":[function(require,module,exports) {
"use strict";function e(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,a=n.get(r);if(a)return a;if(Array.isArray(r)){var f=[];n.set(r,f);for(var o=0;o<r.length;o++)f[o]=e(r[o],t,n);return f}if(r instanceof Date)return new Date(r.valueOf());if(!(r instanceof Object))return r;var u={};n.set(r,u);for(var s=Object.keys(r),i=0;i<s.length;i++){u[t?t(s[i]):s[i]]=e(r[s[i]],t,n)}return u}function r(r){return function(t){return e(t,r)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e,exports.formatKeys=r,e.formatKeys=r;
},{}],"bjTg":[function(require,module,exports) {
module.exports=require("./lib").default;
},{"./lib":"z3IH"}],"F63u":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=d;var e=o(require("../tags")),t=o(require("three")),r=u(require("deep-clone")),a=require("../util/three-util"),i=require("../util/EditorWayfinderSprite"),n=require("../util/materials");function u(e){return e&&e.__esModule?e:{default:e}}function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var u=i?Object.getOwnPropertyDescriptor(e,n):null;u&&(u.get||u.set)?Object.defineProperty(a,n,u):a[n]=e[n]}return a.default=e,r&&r.set(e,a),a}async function d(u){const s=new t.Group;return u.entity().add(e.Object3D,s),{process(e){},load:async function(o){o=(0,r.default)(o),s.traverse(e=>{e.userData._entity&&(e.userData._entity.kill(),delete e.userData._entity,(0,a.pruneUserData)(e))}),(0,a.disposeTree)(s,{textures:!0});const d=new t.ObjectLoader,l=await new Promise(e=>{d.parse(o,e)});l.traverse(t=>{if((0,a.pruneUserData)(t),t.isMesh){const r=t.isSprite||"WayfinderSprite"===t.userData.type;if(r)(0,i.setMeshToSprite)(u,t),t.userData._entity=u.entity().add(e.Object3D,t).add(e.ShaderUniformTime,{uniform:t.material.uniforms.time}).add(e.ShadowCaster,{sprite:!0});else if(t.material){const r=t.material.map,a=t.userData?t.userData.tag:null,i=!!a&&(a.includes("noshadow")||a.includes("noground"));i&&(t.material.alphaTest=.5,t.material.transparent=!0),t.material=(0,n.createMeshMaterial)(u,t,{map:r,ignoreGround:i}),t.userData._entity=u.entity().add(e.Object3D,t),i||t.userData._entity.add(e.ShadowCaster,{sprite:!1})}}}),s.add(l)}}}
},{"../tags":"injP","three":"IV0r","deep-clone":"bjTg","../util/three-util":"bI4v","../util/EditorWayfinderSprite":"iSWR","../util/materials":"phuP"}],"mYyJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=c;var e=l(require("../tags")),t=l(require("three")),r=l(require("../util/math")),n=o(require("../util/SpriteManager")),i=require("../util/load"),a=require("../util/three-util"),u=o(require("../util/Assets"));function o(e){return e&&e.__esModule?e:{default:e}}function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var u=i?Object.getOwnPropertyDescriptor(e,a):null;u&&(u.get||u.set)?Object.defineProperty(n,a,u):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}const f={forest:"spritesheets/tree-anim-a",grasslands:"spritesheets/tree-anim-b",tundra:"spritesheets/tree-anim-c"};function c(t){const r=t.findTag(e.Renderer),i=t.view(e.ActiveEnvironmentState),a=t.view([e.Object3D,e.SpriteAnimation,e.SpriteAnimationOriginTreeTag]);let u,o,s=null;const l=t.view(e.EndGameState),c=t.view(e.OutroFinished);return function(t){let p;if(i.length&&(p=i[0].get(e.EnvironmentState).name)!==s&&(s=p,0===l.length&&0===c.length)){u=null;const e=f[p];(0,n.default)(e,r).then(e=>{u=e,"tundra"===p&&(o=e)})}a.forEach(t=>{const r=t.get(e.SpriteAnimation);let n=r.sheet;if(r.sheet=c.length>0?o:u,r.sheet,"tundra"===p&&(t.get(e.Object3D).position.y=-.25),r.sheet&&c.length>0){const e=r.sheet.frames.length-1,t=r.frame;r.frame=e,r.playing=!1,n===r.sheet&&t===r.frame||(r.dirty=!0)}})}}function p(e,t,n,i){if(!i&&e>=t*n)return n-1;const a=1/t*1e3,u=n;let o=t*(Math.round(1e3*e/a)*a/1e3)*1;o=r.wrap(o,0,u);let s=Math.floor(o);return s=Math.max(0,Math.min(s,n-1))}
},{"../tags":"injP","three":"IV0r","../util/math":"Ov1X","../util/SpriteManager":"Ffhm","../util/load":"OkDW","../util/three-util":"bI4v","../util/Assets":"Wm90"}],"hhCz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=s;var e=l(require("../assets/font/SilkaMono/silkamono-regularitalic-webfont.woff2")),t=o(require("../tags")),r=o(require("three")),n=l(require("../util/createPlaneSprite")),a=require("../util/three-util");function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=a?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(n,o,l):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}function l(e){return e&&e.__esModule?e:{default:e}}async function s(e){e.system.info({hidden:!0});const r=e.listen(t.TextSprite3D),n=e.view(t.TextSprite3D),i=await u();return e=>{r.added.forEach(e=>{const r=e.get(t.TextSprite3D),n=i(r.text,r.fontSize,r.x,r.y,r.culling,r.depth);r.sprite=n,r.parent&&r.parent.add(r.sprite)}),r.removing.forEach(e=>{const r=e.get(t.TextSprite3D);r.sprite&&r.sprite.parent&&(0,a.detachObject)(r.sprite)}),n.forEach(e=>{const r=e.get(t.TextSprite3D);r.sprite&&(r.sprite.material.uniforms.opacity.value=r.opacity,r.sprite.material.uniforms.color.value.copy(r.color))})}}async function u(){const t=new window.FontFace("SilkaMono",`url(${e.default})`,{family:"SilkaMono",style:"italic",weight:400});await t.load(),document.fonts.add(t);const a=new r.PlaneGeometry(1,1,1,1);return(e,t=32,i=0,o=0,l=!0,s=!0)=>{const u=document.createElement("canvas"),c=u.getContext("2d"),p=`italic ${t}px "SilkaMono", sans-serif`;c.font=p,c.textAlign="center",c.textBaseline="middle";const f=c.measureText(e).width,d=512/f,y=Math.round(f+5),m=Math.round(t+5);u.width=Math.round(y*d),u.height=Math.round(m*d),c.fillStyle="white",c.font=p,c.textAlign="center",c.textBaseline="middle",c.save(),c.scale(d,d),c.clearRect(0,0,y,m),c.fillStyle="white",c.fillText(e,y/2,m/2),c.restore();const h=new r.CanvasTexture(u);h.premultiplyAlpha=!1,h.needsUpdate=!0,h.generateMipmaps=!1,h.minFilter=r.LinearFilter;const w=(0,n.default)({geometry:a,map:h,rgba:!0,transparent:!0,opacity:1,depthTest:s,depthWrite:s,side:r.DoubleSide});w.renderOrder=20,w.material.uniforms.translate.value.x=i,w.material.uniforms.translate.value.y=o,w.frustumCulled=l;const g=y/m,x=.02*f;return w.scale.set(1,1/g,1).multiplyScalar(x),w}}
},{"../assets/font/SilkaMono/silkamono-regularitalic-webfont.woff2":"w7pf","../tags":"injP","three":"IV0r","../util/createPlaneSprite":"Jend","../util/three-util":"bI4v"}],"bdQT":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n#define GLSLIFY 1\nattribute vec2 offset;\nattribute float scale;\nattribute vec4 spriteCoords;\nattribute float spriteAspect;\nuniform bool useSpriteAtlas;\nuniform float spriteMapAspect;\nuniform sampler2D groundMap;\nuniform sampler2D worldDataMap;\nuniform sampler2D waterMap;\n// uniform sampler2D worldGrassMap;\nuniform bool worldDataMapEnabled;\nuniform float time;\nuniform float globalSpriteScale;\nuniform vec2 spriteTextureAtlasSize;\nuniform vec2 spriteTextureSize;\nuniform float spriteTextureAtlasColumns;\nuniform mat4 groundProjectionMatrix;\nuniform vec2 worldMapSize;\nuniform vec3 userTargetWorldPosition;\nuniform mat4 worldDataProjection;\nuniform mat4 worldDataView;\nvarying float vDataScale;\nvarying vec2 vDataUv;\nvarying vec3 vGroundColor;\n// varying float vSpriteIndex;\nvarying vec2 vUv;\nvarying vec2 vScreenUv;\nvarying vec2 vGroundUv;\nvarying vec2 vWorldUv;\nvarying vec2 vOriginalUv;\nvarying float vHighlight;\nvarying float gradientY;\nvarying vec3 vGrassColor;\n// #pragma glslify: noise = require('glsl-noise/simplex/3d')\n#define TRUE_FIXED_BLEND\n//returns -1.0 if x < 0, and 1.0 if x >= 0\nfloat sign01 (float x) {\n    return x < 0.0 ? -1.0 : 1.0;\n  // return step(0.0, x) * 2.0 - 1.0;\n}\nfloat hash(vec2 p)  // replace this by something better\n{\n    p  = 50.0*fract( p*0.3183099 + vec2(0.71,0.113));\n  return -1.0+2.0*fract( p.x*p.y*(p.x+p.y) );\n}\nfloat fastnoise( in vec2 p )\n{\n    vec2 i = floor( p );\n  vec2 f = fract( p );\n  vec2 u = f*f*(3.0-2.0*f);\n  return mix( mix( hash( i + vec2(0.0,0.0) ),\n                   hash( i + vec2(1.0,0.0) ), u.x),\n              mix( hash( i + vec2(0.0,1.0) ),\n                   hash( i + vec2(1.0,1.0) ), u.x), u.y);\n}\nfloat smoothCurve(float x)\n{\n  return x * x * (3.0 - 2.0 * x);\n}\nfloat triangleWave(float x)\n{\n  return abs(fract(x + 0.5) * 2.0 - 1.0);\n}\nfloat smoothTriangleWave(float x)\n{\n    // return sin(x);\nreturn smoothCurve(triangleWave(x)) * 2.0 - 1.0;\n}\nvec2 range(vec2 vmin, vec2 vmax, vec2 value) {\n    return (value - vmin) / (vmax - vmin);\n}\nfloat manhattanDistance(vec2 p1, vec2 p2) {\n    float d1 = abs(p1.x - p2.x);\n  float d2 = abs(p1.y - p2.y);\n  return d1 + d2;\n}\nfloat insideBox(vec2 v, vec2 bottomLeft, vec2 topRight) {\n    vec2 s = step(bottomLeft, v) - step(topRight, v);\n  return s.x * s.y;\n}\nvec3 opCheapBend( vec3 p, float angle )\n{\n      float c = cos(angle*p.y);\n    float s = sin(angle*p.y);\n    mat2  m = mat2(c,-s,s,c);\n    return vec3(m*p.xy,p.z);\n}\nmat3 rotationMatrix(vec3 axis, float angle)\n{\n      axis = normalize(axis);\n    float s = sin(angle);\n    float c = cos(angle);\n    float oc = 1.0 - c;\n\n    return mat3(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,\n                oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,\n                oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c);\n}\nmat3 rotation3dY(float angle) {\n    float s = sin(angle);\n  float c = cos(angle);\n  return mat3(\n      c, 0.0, -s,\n    0.0, 1.0, 0.0,\n    s, 0.0, c\n  );\n}\nmat3 rotation3dX(float angle) {\n  float s = sin(angle);\nfloat c = cos(angle);\nreturn mat3(\n  1.0, 0.0, 0.0,\n0.0, c, s,\n0.0, -s, c\n);\n}\nmat3 rotation3dZ(float angle) {\n  float s = sin(angle);\nfloat c = cos(angle);\nreturn mat3(\n  c, s, 0.0,\n-s, c, 0.0,\n0.0, 0.0, 1.0\n);\n}\nvoid main() {\n    float absScale = abs(scale);\n  vec3 offsetPos = vec3(offset.x, 0.0, offset.y);\n  vec2 spriteRepeat = useSpriteAtlas ? spriteCoords.xy : vec2(1.0);\n  vec2 spriteOffset = useSpriteAtlas ? spriteCoords.zw : vec2(0.0);\n  vec2 spriteCoord = uv;\n  if (scale < 0.0) spriteCoord.x = (1.0 - spriteCoord.x);\n  spriteCoord *= spriteRepeat;\n  spriteCoord += spriteOffset;\n  vOriginalUv = uv;\n  // if (scale < 0.0) spriteCoord.x = 1.0 - spriteCoord.x;\n  // spriteCoord.x += spriteIndex;\n  // spriteCoord.x *= 1.0 / spriteTextureAtlasColumns;\n  // if (spriteIndex < 1.5) gradientY += 0.15;\n  vec3 centerWorldPos = (modelMatrix * vec4(offsetPos, 1.0)).xyz;\n  vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n  vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n  vWorldUv = range(\n      -vec2(worldMapSize / 2.0),\n    vec2(worldMapSize / 2.0),\n    centerWorldPos.xz\n  );\n  vWorldUv.y = 1.0 - vWorldUv.y;\n  // float wdist = 0.1;\n  // float wd = distance(vWorldUv, vec2(0.5)) / wdist;\n  // float wt = 0.4;\n  // float wg = 0.1;\n  // wd = smoothstep(wt - wg, wt + wg, wd);\n  // float distFromCenter = clamp(wd, 0.0, 1.0);\n  // absScale *= distFromCenter;\n  float water = texture2D(waterMap, vWorldUv).r;\n  absScale *= 1.0 - water;\n  float wdist = 0.04;\n  float wd = distance(vWorldUv, vec2(0.5, 0.5)) / wdist;\n  float wt = 0.5;\n  float wg = 0.45;\n  wd = smoothstep(wt - wg, wt + wg, wd);\n  float distFromCenter = clamp(wd, 0.0, 1.0);\n  absScale *= distFromCenter;\n  // camRightWorld *= rotation3dZ(sin(time) * position.y);\n\n  // vec2 centerWorldUv = range(\n    //   -vec2(worldMapSize / 2.0),\n  //   vec2(worldMapSize / 2.0),\n  //   centerWorldPos.xz\n  // );\n  // centerWorldUv.y = 1.0 - centerWorldUv.y;\n  // vec2 envPosInWorldPos = (centerWorldUv * 2.0 - 1.0) * worldMapSize / 2.0;\n  vec4 vDataUvPos4 = worldDataProjection * worldDataView * vec4(centerWorldPos.xz, 0.0, 1.0);\n  vec2 vDataScreen = vDataUvPos4.xy / vDataUvPos4.w;\n  vDataUv = vDataScreen.xy * 0.5 + 0.5;\n  // vec3\n  // vec4 centerClipPos = projectionMatrix * viewMatrix * vec4(centerWorldPos, 1.0);\n  // vec2 center2D = centerClipPos.xy / centerClipPos.w;\n  // float distanceScale = manhattanDistance(center2D.xy, vec2(0.0));\n  // vec4 dataColor = texture2D(worldDataMap, centerWorldUv);\n  vec3 dCol = texture2D(worldDataMap, vDataUv).rgb;\n  // float dirAngle = (dCol.g * 2.0 - 1.0) * 3.14;\n  vec2 curDirection2D = vec2(dCol.gb) * 2.0 - 1.0;\n  vec3 curDirection = vec3(curDirection2D.x, 0.0, curDirection2D.y);\n\n  float dScale = dCol.r;\n  // float dScale = 0.0;\n  float dataScale = 1.0 + dScale * 0.0;\n  vDataScale = dScale;\n  // float dataScale = 1.0; // green is leaf growth\n  float dataMove = 1.0;\n\n  vec3 grassColor = vec3(1.0);\n  vGrassColor = grassColor;\n  // dataScale = smoothstep(1.75, 1.25, dataScale);\n  // float worldRadius = 30.0;\n  // float dataScale = 1.0 - clamp(distance(centerWorldPos, userTargetWorldPosition) / worldRadius, 0.0, 1.0);\n  // dataScale = smoothstep(0.0, 0.5, dataScale);\n  // vec3 modifiedCamUpWorld = normalize(camUpWorld + curDirection * 0.25);\n  // float aspect = 418.0/419.0;\n  // float aspect = spriteRepeat.x / spriteRepeat.y;\n  float aspect = useSpriteAtlas ? spriteAspect : spriteMapAspect;\n  float billboardSize01 = globalSpriteScale * absScale;\n  float billboardSize = dataScale * billboardSize01;\n  vec3 vertexStraightWorldPos = (centerWorldPos)\n    + camRightWorld * position.x * billboardSize * aspect\n    + camUpWorld * position.y * billboardSize;\n  float moveGradientY = clamp(vertexStraightWorldPos.y / 0.5, 0.0, 1.0);\n  gradientY = pow(clamp(vertexStraightWorldPos.y / 1.0, 0.0, 1.0), 1.25);\n  float scaleTime = time * 0.1;\n  // float noiseValue = (\n    //   smoothTriangleWave(scaleTime + centerWorldPos.x * 0.05 + centerWorldPos.z * -0.01) * 0.5 +\n  //   smoothTriangleWave(scaleTime + centerWorldPos.z * 0.05) * 0.25 +\n  //   sin(scaleTime + centerWorldPos.y * 0.1) * 0.25\n  // );\n  float noiseValue = 0.0;\n  noiseValue += cos(time * 2.0 + centerWorldPos.x * 0.5) * 0.33;\n  noiseValue += sin(time + centerWorldPos.z * 0.25) * 0.33;\n  noiseValue += sin(time + centerWorldPos.x * 0.25) * 0.33;\n  noiseValue = clamp(noiseValue, -1.0, 1.0);\n  float invDScale = 1.0;\n  camUpWorld *= rotation3dZ(noiseValue * 3.14 * 0.25 * moveGradientY * invDScale);\n  vec3 vertexWorldPos = (centerWorldPos)\n    + camRightWorld * position.x * billboardSize * aspect\n    + camUpWorld * position.y * billboardSize;\n\n  // vec3 axisDirection =\n\n  // noiseValue += sin(time * 0.75 + centerWorldPos.x * 0.2) * 0.25;\n  // noiseValue += sin(time * 0.75 + centerWorldPos.z * 0.2) * 0.25;\n  // noiseValue += sin(time * 0.85 + centerWorldPos.z * 0.2) * 0.25;\n  // noiseValue += cos(time * 0.25 + centerWorldPos.x * 0.1) * 0.25;\n  // noiseValue = smoothstep(0.2, 0.8, noiseValue * 0.5 + 0.5) * 2.0 - 1.0;\n  float skewValue = gradientY * noiseValue;\n  float skewScaled = skewValue * 0.25* invDScale;\n\n  // vertexWorldPos *= rotationMatrix(vec3(0.0, 1.0, 0.0), sin(time) * 2.0);\n  vertexWorldPos += camRightWorld * skewScaled;\n  vertexWorldPos.xyz += curDirection * 0.1 * dScale;\n  vertexWorldPos.xyz += curDirection * gradientY * 0.66 * dScale;\n  // vertexWorldPos += dScale * moveGradientY * camRightWorld * curDirection.xyz * 1.0;\n  // vertexWorldPos += dScale * moveGradientY * camRightWorld * curDirection.xyz * 0.5;\n  vec3 vertexWorldBasePos = (centerWorldPos)\n    + camRightWorld * position.x * billboardSize * aspect\n    + camUpWorld * position.y * billboardSize;\n\n  // vec3 vertexWorldBasePos = centerWorldPos;\n\n  vec4 baseClipPos = groundProjectionMatrix * viewMatrix * vec4(vertexWorldBasePos, 1.0);\n  vec4 clipPos = projectionMatrix * viewMatrix * vec4(vertexWorldPos, 1.0);\n  vGroundUv = baseClipPos.xy / baseClipPos.w * 0.5 + 0.5;\n  // vGroundUv = clamp(vGroundUv, 0.0, 1.0);\n  vGroundColor = texture2D(groundMap, vGroundUv).rgb;\n  // vGroundUv = baseClipPos.xy / baseClipPos.w * 0.5 + 0.5;\n  // vGroundUv = floor(vGroundUv / 0.05) * 0.05;\n\n  // if (absScale > 2.35) vGroundColor = vec3(1.0,0.0,0.0);\n  vUv = spriteCoord;\n  // if (scale < 0.0) vUv.x = 1.0 - vUv.x;\n  gl_Position = clipPos;\n  // vec4 mvPosition = modelViewMatrix * vec4(offsetPos, 1.0);\n  // vec2 mvScale;\n  // mvScale.x = length(modelMatrix[0].xyz);\n  // mvScale.y = length(modelMatrix[1].xyz);\n  // mvScale *= globalSpriteScale * absScale;\n  // vec2 mvOffset = mvScale * position.xy;\n  // vec3 worldPos = centerWorldPos;\n  // worldPos.xy += mvOffset;\n  // vec4 groundPoint = mvPosition;\n  // mvPosition.xy += mvOffset;\n  // mvPosition.x -= skewScaled * mvScale.x;\n  // #if defined(TRUE_BLEND)\n  // groundPoint.x += mvScale.x * position.x - skewScaled * mvScale.x;\n  // #elif defined(TRUE_FIXED_BLEND)\n  // groundPoint.x += mvScale.x * position.x;\n  // #endif\n  // vec4 screenPointSolid = groundProjectionMatrix * groundPoint;\n  // vGroundUv = screenPointSolid.xy / screenPointSolid.w * 0.5 + 0.5;\n  // gl_Position = projectionMatrix * mvPosition;\n\n  // vec3 worldPos =\n  // const x = (u * environment.size) / 2;\n  // const z = (v * environment.size) / 2;\n  // vWorldUv =\n  // inverseLerp(-environment.size / 2, environment.size / 2, position.x) *\n  //         2 -\n  //       1;\n\n  // vSpriteIndex = spriteIndex;\n  vHighlight = noiseValue * 0.5 + 0.5;\n  vScreenUv = gl_Position.xy / gl_Position.w * 0.5 + 0.5;\n}\n";
},{}],"VwcY":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n#define GLSLIFY 1\nuniform sampler2D groundMap;\nuniform sampler2D worldMap;\nuniform sampler2D worldDataMap;\nuniform sampler2D spriteMap;\nuniform vec2 spriteTextureAtlasSize;\nuniform vec3 spriteColor;\nuniform vec3 highlightColor;\nuniform bool isSplitColor;\nuniform vec2 spriteTextureSize;\nuniform float highlightFactor;\nuniform vec2 resolution;\nuniform bool worldGrassMapEnabled;\nvarying vec2 vDataUv;\nvarying float vDataScale;\nvarying vec3 vGroundColor;\nvarying vec2 vUv;\nvarying vec2 vGroundUv;\nvarying vec2 vScreenUv;\nvarying vec2 vWorldUv;\nvarying vec3 vGrassColor;\nvarying float vHighlight;\nvarying vec2 vOriginalUv;\nvarying float gradientY;\nuniform float grassTipFactor;\nuniform sampler2D map;\nfloat luma(vec3 color) {\n    return dot(color, vec3(0.299, 0.587, 0.114));\n}\nfloat luma(vec4 color) {\n    return dot(color.rgb, vec3(0.299, 0.587, 0.114));\n}\nfloat dither8x8(vec2 position, float brightness) {\n    int x = int(mod(position.x, 8.0));\n    int y = int(mod(position.y, 8.0));\n    int index = x + y * 8;\n    float limit = 0.0;\n    if (x < 8) {\n      if (index == 0) limit = 0.015625;\n      if (index == 1) limit = 0.515625;\n      if (index == 2) limit = 0.140625;\n      if (index == 3) limit = 0.640625;\n      if (index == 4) limit = 0.046875;\n      if (index == 5) limit = 0.546875;\n      if (index == 6) limit = 0.171875;\n      if (index == 7) limit = 0.671875;\n      if (index == 8) limit = 0.765625;\n      if (index == 9) limit = 0.265625;\n      if (index == 10) limit = 0.890625;\n      if (index == 11) limit = 0.390625;\n      if (index == 12) limit = 0.796875;\n      if (index == 13) limit = 0.296875;\n      if (index == 14) limit = 0.921875;\n      if (index == 15) limit = 0.421875;\n      if (index == 16) limit = 0.203125;\n      if (index == 17) limit = 0.703125;\n      if (index == 18) limit = 0.078125;\n      if (index == 19) limit = 0.578125;\n      if (index == 20) limit = 0.234375;\n      if (index == 21) limit = 0.734375;\n      if (index == 22) limit = 0.109375;\n      if (index == 23) limit = 0.609375;\n      if (index == 24) limit = 0.953125;\n      if (index == 25) limit = 0.453125;\n      if (index == 26) limit = 0.828125;\n      if (index == 27) limit = 0.328125;\n      if (index == 28) limit = 0.984375;\n      if (index == 29) limit = 0.484375;\n      if (index == 30) limit = 0.859375;\n      if (index == 31) limit = 0.359375;\n      if (index == 32) limit = 0.0625;\n      if (index == 33) limit = 0.5625;\n      if (index == 34) limit = 0.1875;\n      if (index == 35) limit = 0.6875;\n      if (index == 36) limit = 0.03125;\n      if (index == 37) limit = 0.53125;\n      if (index == 38) limit = 0.15625;\n      if (index == 39) limit = 0.65625;\n      if (index == 40) limit = 0.8125;\n      if (index == 41) limit = 0.3125;\n      if (index == 42) limit = 0.9375;\n      if (index == 43) limit = 0.4375;\n      if (index == 44) limit = 0.78125;\n      if (index == 45) limit = 0.28125;\n      if (index == 46) limit = 0.90625;\n      if (index == 47) limit = 0.40625;\n      if (index == 48) limit = 0.25;\n      if (index == 49) limit = 0.75;\n      if (index == 50) limit = 0.125;\n      if (index == 51) limit = 0.625;\n      if (index == 52) limit = 0.21875;\n      if (index == 53) limit = 0.71875;\n      if (index == 54) limit = 0.09375;\n      if (index == 55) limit = 0.59375;\n      if (index == 56) limit = 1.0;\n      if (index == 57) limit = 0.5;\n      if (index == 58) limit = 0.875;\n      if (index == 59) limit = 0.375;\n      if (index == 60) limit = 0.96875;\n      if (index == 61) limit = 0.46875;\n      if (index == 62) limit = 0.84375;\n      if (index == 63) limit = 0.34375;\n  }\n  return brightness < limit ? 0.0 : 1.0;\n}\nvec3 dither8x8(vec2 position, vec3 color) {\n    return color * dither8x8(position, luma(color));\n}\nvec4 dither8x8(vec2 position, vec4 color) {\n    return vec4(color.rgb * dither8x8(position, luma(color)), 1.0);\n}\nconst mat4 thresholdMatrix = mat4(\n    vec4(1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0),\n  vec4(13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0),\n  vec4(4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0),\n  vec4(16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0)\n);\nconst mat4 _RowAccess = mat4(\n    vec4(1.0,0.0,0.0,0.0),\n  vec4(0.0,1.0,0.0,0.0),\n  vec4(0.0,0.0,1.0,0.0),\n  vec4(0.0,0.0,0.0,1.0)\n);\nfloat aastep(float threshold, float value) {\n    float change = fwidth(value) * 0.5;\n    float lo = threshold - change;\n    float hi = threshold + change;\n    return clamp((value - lo) / (hi - lo), 0.0, 1.0);\n}\n// void main () {\n  //   float a = texture2D(map, vUv).r;\n//   if (a <= 0.5) discard;\n//   gl_FragColor.rgba = vec4(vec3(1.0), 1.0);\n// }\nvoid main () {\n    // gl_FragColor.rgba = vec4(vec3)\n  float a = texture2D(map, vUv).r;\n  if (a <= 0.5) discard;\n  // gl_FragColor.rgba = vec4(vec3(1.0), a);\n  float dScale = vDataScale;\n  vec3 groundColor = vGroundColor.rgb;\n  float K = pow(gradientY, 0.5);\n  float highlight = mix(vHighlight, 1.0, dScale);\n  gl_FragColor.rgb = mix(groundColor, groundColor * grassTipFactor, gradientY) + smoothstep(0.5, 1.0, highlight) * 0.5 * gradientY;\n  gl_FragColor.a = 1.0;\n  // gl_FragColor.rgba = clamp(gl_FragColor.rgba, 0.0, 1.0);\n  // gl_FragColor.a *= pow(gradientY, 0.1); // alpha\n}\n";
},{}],"gUAz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=g,exports.GrassTileGeometry=void 0;var e=d(require("three")),t=d(require("../../tags")),r=p(require("fast-2d-poisson-disk-sampling")),n=p(require("../../util/Random")),i=p(require("../../shaders/ground-patch-instance.vert")),a=p(require("../../shaders/ground-patch-instance.frag")),s=p(require("bound-points")),o=require("../../util/math"),u=p(require("../../util/ObjectPool")),l=d(require("../../util/ShaderManager")),c=p(require("../../util/Assets"));function p(e){return e&&e.__esModule?e:{default:e}}function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}class h extends e.InstancedBufferGeometry{constructor(t={}){super();const{position:r,index:n,uv:i}=t;this._tmpVec3=new e.Vector3,this._featureCount=1/0,this.setAttribute("position",r),this.setAttribute("uv",i),this.setIndex(n)}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new e.Box3),this._computeBox3(this.boundingBox)}_computeBox3(e){const t=this.attributes.offset;if(null!=t){e.makeEmpty(),e.min.y=0,e.max.y=1;for(let r=0;r<t.count;r++){const n=t.getX(r),i=t.getY(r);n<e.min.x&&(e.min.x=n),n>e.max.x&&(e.max.x=n),i<e.min.z&&(e.min.z=i),i>e.max.z&&(e.max.z=i)}}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new e.Sphere);const t=this.attributes.offset;if(!t)return;this.computeBoundingBox();const r=this.boundingSphere.center;this.boundingBox.getCenter(r);let n=0;const i=this._tmpVec3;for(let e=0;e<t.count;e++){const a=t.getX(e),s=0,o=t.getY(e);i.set(a,s,o),n=Math.max(n,r.distanceToSquared(i))}this.boundingSphere.radius=Math.sqrt(n)}setCount(e){this.instanceCount=Math.min(this._featureCount,e)}setFeatures(t,r){this.instanceCount=t.length,this.prefix=r,this._featureCount=t.length;const n=new Float32Array(8*t.length);for(let e=0,a=0;e<t.length;e++){const r=t[e];n[a++]=r.position[0],n[a++]=r.position[1],n[a++]=(r.flip?-1:1)*r.scale,n[a++]=r.spriteCoords[0],n[a++]=r.spriteCoords[1],n[a++]=r.spriteCoords[2],n[a++]=r.spriteCoords[3],n[a++]=r.spriteAspect}const i=new e.InstancedInterleavedBuffer(n,8);this.setAttribute("offset",new e.InterleavedBufferAttribute(i,2,0)),this.setAttribute("scale",new e.InterleavedBufferAttribute(i,1,2)),this.setAttribute("spriteCoords",new e.InterleavedBufferAttribute(i,4,3)),this.setAttribute("spriteAspect",new e.InterleavedBufferAttribute(i,1,7))}}function g(s,c={}){const p=m(),f=(0,n.default)(),d=c.samples||{},g=c.sprites,v=c.groundMap,x=c.groundProjectionMatrix,w=s.findTag(t.GroundDataRenderTarget),b=s.findTag(t.RenderLayers),y=[],A=s.findEntity(t.ActiveEnvironmentState),B=A?A.get(t.EnvironmentState).name:"";for(let e=0;e<3;e++){const e=new h({...p}),t=C(d,B);e.setFeatures(t,B),y.push(e)}const M=f.deck(y),S=new u.default({name:"GroundPatch",initialCapacity:c.initialCapacity||0,create(){const r=M.next(),n=l.create({name:"GrassGroundPatch",transparent:!1,vertexShader:i.default,fragmentShader:a.default,extensions:{derivatives:!0},uniforms:{useSpriteAtlas:{value:!0},spriteMapAspect:{value:1},waterMap:{value:new e.Texture},map:{value:g.atlases[0]},worldMapSize:{value:new e.Vector2},worldDataMap:{value:w?w.target.texture:new e.Texture},worldDataProjection:{value:w?w.projection:new e.Matrix4},worldDataView:{value:w?w.view:new e.Matrix4},globalSpriteScale:{value:1},highlightColor:{value:new e.Color("#948059")},groundProjectionMatrix:{value:x||new e.Matrix4},grassTipFactor:{value:1.5},groundMap:{value:v||new e.Texture},time:{value:0}}}),o=new e.Mesh(r,n);return o.name="ground-patch-pool",o.userData={globalSpriteScale:1},o.layers.set(b.grass),o.userData.active=!1,o.userData.entity=s.entity().add(t.ShaderUniformTime,{uniform:n.uniforms.time}).add(t.GroundPatchInstance,o),o},renew(e){e.userData.active=!0},release(e){e.userData.active=!1},dispose(e){e.userData.entity&&(e.userData.entity.kill(),e.userData.entity=null),e.userData.active=!1}});return{setPrefix(e){y.forEach(t=>{if(t.prefix!==e){const r=C(d,e);t.setFeatures(r,e)}})},next:()=>S.next(),release:e=>S.release(e)};function C(e,t="",n){const{spriteTextureAtlasColumns:i=1}=e,a=t?g.values.filter(e=>e.type===t):g.values;return function({size:e=40,spacing:t=1,scale:n=1,tries:i=10,circular:a=!1,maxSamples:s=1e3,filter:o=!0}){return f.shuffle(new r.default({shape:[e,e],radius:t,tries:i},f.value).fill().map(t=>[t[0]-e/2,t[1]-e/2])).slice(0,s)}(e).map(e=>{const t=f.pick(a);t.width,t.height;return{flip:f.boolean(),spriteCoords:t.repeat.toArray().concat(t.offset.toArray()),spriteAspect:t.width/t.height,scale:(0,o.clamp)(f.gaussian(.66,.33),.5,1.25),position:e}}).filter(e=>e.scale>=1e-5)}}function m(){const t=new e.PlaneBufferGeometry(1,1,1,4),r=t.attributes,n=r.position.count,i=[],a=[];for(let e=0;e<n;e++){const t=r.position.getX(e),n=r.position.getY(e)+.5;i.push(t,n);const s=r.uv.getX(e),o=r.uv.getY(e);a.push(s,o)}const s=new e.BufferAttribute(new Float32Array(i),2),o=new e.BufferAttribute(new Float32Array(a),2),u=new e.BufferAttribute(t.getIndex().array,1);return t.dispose(),{position:s,uv:o,index:u}}exports.GrassTileGeometry=h;
},{"three":"IV0r","../../tags":"injP","fast-2d-poisson-disk-sampling":"luIz","../../util/Random":"LMfK","../../shaders/ground-patch-instance.vert":"bdQT","../../shaders/ground-patch-instance.frag":"VwcY","bound-points":"T2x6","../../util/math":"Ov1X","../../util/ObjectPool":"iiAR","../../util/ShaderManager":"igLh","../../util/Assets":"Wm90"}],"o82o":[function(require,module,exports) {
"use strict";function e(e,t,n){const o=e.listen(t);let r=!1,s=!1;return a=>r||(o.added.forEach(o=>{if(r)return s||console.error("Warning: More than one EnvironmentState found on "+e.system.name),void(s=!0);const a=o.get(t);n(a),r=!0}),r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"Qaaz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=s;var e=o(require("three")),t=require("./math"),r=require("./three-util"),n=a(require("./ObjectPool")),i=require("./array");function a(e){return e&&e.__esModule?e:{default:e}}function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class c{constructor(){u(this,"visible",!1),u(this,"data",null),u(this,"nearby",null),u(this,"tile",[0,0])}}function s(a={}){const{size:l=30,maxCells:o=9,initialCapacity:u=9,tileHeight:s=2.5,populateTile:f=(()=>{}),releaseTile:p=((e,t)=>{(0,r.detachObject)(e)})}=a,d=new e.Group;d.name="tiling-grass-group";const b=l,x=b/2,y=Math.sqrt(9),h=(y-1)/2;let w=null;const g=new e.Box3,m=new e.Box3(new e.Vector3(-x,0,-x),new e.Vector3(x,s,x)),v=[],M=(new e.Matrix4,new e.Frustum),O=new e.Matrix4,j=new n.default({name:"TilingGridCellData",initialCapacity:u,create:()=>new c}),P=new n.default({name:"TilingGridGroup",initialCapacity:u,create:()=>new e.Group});function q(t,r,n=new e.Box3){n.copy(m);const i=C(t),a=C(r);return n.min.x+=i,n.max.x+=i,n.min.z+=a,n.max.z+=a,n}return{update:function(t,r){O.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),M.setFromProjectionMatrix(O);let n=G(r.x),a=G(r.z);null!=w&&w.x===n&&w.y===a||(w||(w=new e.Vector2),w.set(n,a));v.forEach(e=>{e.visible=!1});for(let e=0;e<y;e++)for(let t=0;t<y;t++){const r=n+(t-h),i=a+(e-h),l=v.some(e=>e.tile[0]===r&&e.tile[1]===i);q(r,i,g);const u=M.intersectsBox(g);if(!l&&u){if(v.length>=o&&_(),v.length>=o)break;const e=j.next();e.data=null,e.nearby=!0,e.visible=!0,e.tile[0]=r,e.tile[1]=i,v.push(e)}}for(let e=v.length-1;e>=0;e--){const t=v[e],[r,n]=t.tile;q(r,n,g);const a=!!t.visible||M.intersectsBox(g);if(t.nearby=Math.abs(r-w.x)<=h&&Math.abs(n-w.y)<=h,a){if(!t.data){const e=P.next();e.position.set(C(r),0,C(n)),d.add(e),t.data=e,f(e,t.tile)}}else(0,i.spliceOne)(v,e),B(t)}},group:d,cellBox:m};function B(e){e.data&&(P.release(e.data),p(e.data,e.tile),e.data=null),j.release(e)}function _(){for(let e=v.length-1;e>=0;e--){const t=v[e];if(!1===t.nearby)return v.splice(e,1),void B(t)}}function C(e){return e*b}function G(e){return Math.floor((0,t.inverseLerp)(-x,x,e))||0}}
},{"three":"IV0r","./math":"Ov1X","./three-util":"bI4v","./ObjectPool":"iiAR","./array":"ibDZ"}],"OuWA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=g;var e=f(require("../tags")),t=f(require("three")),a=p(require("./environment/createGroundPatchPool")),r=p(require("../util/waitForSingleton")),i=p(require("../util/createTilingGrid")),n=require("../util/three-util"),s=require("../util/load"),u=require("./AnimationSystem"),l=p(require("../util/SpriteManager")),o=p(require("../util/Assets")),c=require("../util/materials");function p(e){return e&&e.__esModule?e:{default:e}}function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(d=function(e){return e?a:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=d(t);if(a&&a.has(e))return a.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var s=i?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(r,n,s):r[n]=e[n]}return r.default=e,a&&a.set(e,r),r}async function g(t){const r=t.findTag(e.Renderer),s=await(0,l.default)("spritesheets/temp_grass_sprites",r),u=t.entity().add(e.GrassEditableData),o=t.findTag(e.GroundPlaneView),p=t.view(e.GroundPatchInstance),d=t.view([e.EnvironmentState,e.ActiveEnvironmentState]);let f,g,m=null;(0,c.getEmptyTexture)();return g=(0,a.default)(t,{sprites:s,groundMap:o.target.texture,groundProjectionMatrix:o.projectionMatrix,samples:{size:40},initialCapacity:9}),f=(0,i.default)({size:40,maxCells:9,initialCapacity:9,tileHeight:2.5,populateTile:(e,t)=>{const a=g.next();e.add(a),e.userData.grass=a},releaseTile:(e,t)=>{e.userData.grass&&(g.release(e.userData.grass),e.userData.grass=null),(0,n.detachObject)(e)}}),t.entity().add(e.Object3D,f.group),function(a){const r=t.findTag(e.WorldTweens);let i,n=0;r&&(n=r[0]),d.length&&(i=d[0].get(e.EnvironmentState)),m!==i&&(m=i,g.setPrefix(i?i.name:""));const l=u.get(e.GrassEditableData),o=!l.useCustomGrass,c=l.grassScale,v=o?s.atlases[0]:l.customGrassMap;p.forEach(t=>{const a=t.get(e.GroundPatchInstance),r=1-n;let s=a.userData.globalSpriteScale;if(i&&(s*=i.grassScale,a.material.uniforms.grassTipFactor.value=i.grassTipFactor,a.material.uniforms.worldMapSize.value.set(i.data.width,i.data.height),a.material.uniforms.waterMap.value=i.waterMap,a.geometry.setCount(i.grassInstanceCount)),a.material.uniforms.globalSpriteScale.value=c*r*s,a.material.uniforms.useSpriteAtlas.value=o,a.material.uniforms.map.value=v,!o){const e=a.material.uniforms.map.value;e&&e.image&&0!==e.image.height&&(a.material.uniforms.spriteMapAspect.value=e.image.width/e.image.height)}});const h=t.findTag(e.MainCamera),y=t.findTag(e.UserTarget).position;f.update(h,y)}}
},{"../tags":"injP","three":"IV0r","./environment/createGroundPatchPool":"gUAz","../util/waitForSingleton":"o82o","../util/createTilingGrid":"Qaaz","../util/three-util":"bI4v","../util/load":"OkDW","./AnimationSystem":"cUmx","../util/SpriteManager":"Ffhm","../util/Assets":"Wm90","../util/materials":"phuP"}],"yyW0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=i;var e=a(require("three")),r=a(require("../tags")),t=require("../util/addFrameTasks");function n(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(n=function(e){return e?t:r})(e)}function a(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=n(r);if(t&&t.has(e))return t.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}return a.default=e,t&&t.set(e,a),a}function i(n){const a=new e.WebGLRenderTarget(16,16),i=(new e.PerspectiveCamera,n.findTag(r.MainCamera)),o=n.findTag(r.MainScene),l=n.tag(r.GroundPlaneView,{camera:i,projectionMatrix:new e.Matrix4,target:a}),u=(n.findTag(r.GroundPlaneView),n.findTag(r.RenderLayers));n.entity().add(r.DebugRenderTarget,{visible:!1,target:a}),a.depthBuffer=!1,a.texture.generateMipmaps=!1,a.texture.minFilter=e.LinearFilter,a.texture.magFilter=e.LinearFilter,a.texture.wrapS=a.texture.wrapT=e.ClampToEdgeWrapping;n.view(r.GroundPlaneLayer);const d=new e.Color(0,0,0),s=new e.Color,p=n.findTag(r.Renderer);n.findTag(r.AppState);return(0,t.addPreRenderCallback)(function(){l.projectionMatrix.copy(i.projectionMatrix),i.layers.disableAll(),i.layers.enable(u.ground),i.layers.disable(u.goundNormalElement),i.layers.disable(u.groundDepth),s.copy(p.getClearColor()),p.setRenderTarget(a),p.setClearColor(d),p.clear(),p.render(o,i),p.setRenderTarget(null),p.setClearColor(s),i.layers.enableAll()}),function(e){const r=p.domElement,t=r.width,n=r.height;if(0===r.width||0===r.height)return;let i=t/n;a.width,a.height;const o=Math.round(128/i);128===a.width&&a.height===o||a.setSize(128,o)}}
},{"three":"IV0r","../tags":"injP","../util/addFrameTasks":"l7a6"}],"ehN6":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/brush-stroke-sdf.c5e11215.png";
},{}],"x1EI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=f;var e=d(require("../tags")),a=d(require("three")),t=c(require("../util/ObjectPool")),n=c(require("../util/Random")),r=d(require("../util/math")),i=d(require("../util/ShaderManager")),o=require("./AnimationSystem"),s=c(require("../assets/textures/brush-stroke-sdf.png")),l=require("../util/load"),u=c(require("../util/Assets"));function c(e){return e&&e.__esModule?e:{default:e}}function g(e){if("function"!=typeof WeakMap)return null;var a=new WeakMap,t=new WeakMap;return(g=function(e){return e?t:a})(e)}function d(e,a){if(!a&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=g(a);if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}async function f(o){const s=new a.Group;o.entity().add(e.Object3D,s);const l={forest:"image/data/ground-spawn-forest",grasslands:"image/data/ground-spawn-grasslands",tundra:"image/data/ground-spawn-tundra"},c=o.findTag(e.Renderer);let g;const d=new a.Texture,f=o.view([e.Object3D,e.GroundSpawningLeaf]),p=(o.listen(e.PoemLineTriggerActivated),new a.PlaneGeometry(1,1,5,5));p.vertices.forEach(e=>{const a=2*e.x*.5+.5;e.z=.2*Math.sin(a*Math.PI)});const v=new t.default({maxCapacity:50,initialCapacity:50,create(){const t=new a.Mesh(p,i.create({name:"SpawningLeaves",extensions:{derivatives:!0},fragmentShader:"\n            varying vec2 vUv;\n            uniform sampler2D map;\n            uniform vec3 color;\n            uniform float opacity;\n            float aastep(float threshold, float value) {\n              float change = fwidth(value) * 0.5;\n              float lo = threshold - change;\n              float hi = threshold + change;\n              return clamp((value - lo) / (hi - lo), 0.0, 1.0);\n            }\n\n            void main () {\n              float a = aastep(0.5, texture2D(map, vUv).a);\n              gl_FragColor.rgb = color;\n              if (!gl_FrontFacing) gl_FragColor.rgb *= 0.75;\n              gl_FragColor.a = 1.0;\n              // gl_FragColor.rgb *= opacity * a;\n              gl_FragColor.a = opacity * a;\n              // if (gl_FragColor.a < 0.1) discard;\n            }\n          ",vertexShader:"\n            varying vec2 vUv;\n            void main () {\n              vUv = uv;\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n            }\n          ",uniforms:{map:{value:d},opacity:{value:1},color:{value:new a.Color}},side:a.DoubleSide,transparent:!0})),n=o.entity();return n.add(e.GroundSpawningLeaf),n.add(e.TargetKeyTween,{active:!1,duration:1,ease:"expoOut",pauseOnModal:!0,target:t.userData,killEntityOnFinish:!1,assignFromOnStart:!0,key:"tween"}),t.userData.entity=n,t.userData.tween=0,t.userData.size=.1,t.userData.speed=0,t.userData.alpha=1,t.userData.velocity=new a.Vector3,t.userData.rotationAxis=new a.Vector3,t.userData.rotationSpeed=1,t.userData.rotationAngleOffset=0,t.name="spawning-leaves",t.frustumCulled=!1,t.matrixAutoUpdate=!1,t}});let D=new a.Vector3,y=!1;const m=[216],h=new a.Vector3,w=(new a.Vector3,[0,0]),S=[0,0,0],x=[0,0,0,0],b=(0,n.default)(),O=(o.findTag(e.EnvironmentState),new a.Color),M=o.findTag(e.UserCharacter),T=(o.findTag(e.UserTarget),o.view([e.ActiveEnvironmentState,e.EnvironmentState]));const C={tundra:new a.Color(206/255+.5,215/255+.5,219/255+.5)};let q=null,A=null;return function(t){const n=M.position,r=M.direction;if(!!Boolean(o.findTag(e.ModalStoppingUserMovement)))return;let i=null;if(T.length>0){i=T[0].get(e.EnvironmentState).name}let p="tundra"===i?.75:1;if(i!==q){let e=l[i];g!==e&&(g=e,u.default.loadGPUTexture(c,d,g)),A=C[i],q=i}const y=o.findTag(e.EnvironmentUnderPlayerState);if((!y||!y.water)&&T.length&&(!D||n.distanceToSquared(D)>=.25)){D||(D=new a.Vector3);const t=T[0].get(e.EnvironmentState),i=t.grid.getCellAt(n.x,n.z);i&&function(e,a,t,n,r){const i=r?b.rangeFloor(1,5):2;for(let o=0;o<i;o++)j(e,a,t,n,r)}(t,i,n,r),D.copy(n)}for(let a=0;a<f.length;a++){const n=f[a],r=n.get(e.TargetKeyTween),i=n.get(e.Object3D),o=i.userData.tween*i.userData.size*p;if(i.visible=i.userData.tween>1e-5,i.visible){i.scale.setScalar(o);const e=i.userData.tween*i.userData.alpha;i.material.uniforms.opacity.value=e,i.position.addScaledVector(i.userData.velocity,t*i.userData.speed),i.rotateOnWorldAxis(i.userData.rotationAxis,i.userData.rotationSpeed*t),i.updateMatrix()}r.finished&&i.userData.appearing&&(i.userData.appearing=!1,i.userData.killing=!0,P(i,0,i.userData.holdDelay)),r.finished&&i.userData.killing&&!i.userData.appearing&&(i.userData.killing=!1,i.userData.appearing=!1,s.remove(i),i.userData.entity.remove(e.Object3D),v.release(i))}};function j(a,t,n,i,o){let l;if(A)l=A;else if(y)l=O.setHSL(b.pick(m)/360,b.range(.45,.75),b.range(.45,.65));else{const e=a.colors[t.colorIndex%a.colors.length];l=e?e.color:null}if(!l)return;const u=v.next();if(u){u.visible=!1,s.add(u),u.userData.entity.add(e.Object3D,u),u.position.copy(n);let a=b.gaussian(1,6);b.gaussian(0,1)>0&&(a+=b.gaussian(0,4)),b.gaussian(0,1)>1&&(a+=b.gaussian(0,8)),b.insideCircle(b.range(1,1)+b.gaussian(0,2)+1*a*b.gaussian(0,2),w),u.position.x+=w[0],u.position.z+=w[1],t&&u.material.uniforms.color.value.set(l).offsetHSL(20*b.range(-1,1)/360,b.range(0,.25),b.range(0,.25)),u.quaternion.fromArray(b.quaternion(x)),u.userData.holdDelay=b.range(0,2),o||(u.position.y=Math.abs(b.gaussian(.25,1))),u.userData.appearing=!0,u.userData.killing=!1,u.userData.size=1.1*(.15+2*Math.abs(b.gaussian(0,.075))),u.userData.speed=r.clamp(Math.abs(b.gaussian(.5,.2)),.25,1),u.userData.tween=0,u.userData.velocity.set(0,1,0),u.quaternion.fromArray(b.quaternion(x)),u.userData.rotationAxis.fromArray(b.insideSphere(1,S)),u.userData.rotationSpeed=4,u.userData.rotationAngleOffset=b.range(-1,1)*Math.PI*2,u.userData.alpha=1,o?(b.insideCircle(1,w),h.x=w[0],h.y=b.range(0,0),h.z=w[1],h.addScaledVector(i,b.range(0,1)),h.normalize()):(h.copy(i),h.y+=b.range(0,.5),h.normalize()),u.userData.velocity.copy(h),P(u,1,o?0:b.range(0,0))}}function P(a,t,n){const r=a.userData.entity.get(e.TargetKeyTween);r.to=t,r.delay=n||0,r.elapsed=0,r.finished=!1,r.started=!1,r.active=!0}}
},{"../tags":"injP","three":"IV0r","../util/ObjectPool":"iiAR","../util/Random":"LMfK","../util/math":"Ov1X","../util/ShaderManager":"igLh","./AnimationSystem":"cUmx","../assets/textures/brush-stroke-sdf.png":"ehN6","../util/load":"OkDW","../util/Assets":"Wm90"}],"jdWh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=d;var e=g(require("../tags")),t=g(require("three")),a=g(require("../util/ShaderManager")),r=l(require("../util/ObjectPool")),n=l(require("../util/Random")),i=g(require("../util/math")),o=require("./AnimationSystem"),s=require("../util/load"),u=require("../util/three-util");function l(e){return e&&e.__esModule?e:{default:e}}function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(c=function(e){return e?a:t})(e)}function g(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=c(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=n?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(r,i,o):r[i]=e[i]}return r.default=e,a&&a.set(e,r),r}function d(o){const s=o.view([e.Object3D,e.GroundSpawningDot]),l=(o.listen(e.PoemLineTriggerActivated),(0,n.default)(175079320123)),c=new t.Group;o.entity().add(e.Object3D,c);const g=[new t.TetrahedronBufferGeometry(1,0),new t.TetrahedronBufferGeometry(1,1)],d=new t.Vector3,f=new Array(3).fill(0).map((e,a)=>{const r=new t.BufferGeometry,n=g[a%g.length],i=n.attributes.position,o=new t.Float32BufferAttribute(new Float32Array(i.array.length),3);for(let t=0;t<i.count;t++){const e=i.getX(t),a=i.getY(t),r=i.getZ(t);d.set(e,a,r);const n=d.clone().normalize(),s=d.clone().addScaledVector(n,l.gaussian(0,1/8));o.setX(t,s.x),o.setY(t,s.y),o.setZ(t,s.z)}return r.setAttribute("position",o),r.setIndex(n.getIndex()),r}),p=new r.default({maxCapacity:35,initialCapacity:35,create(){const r=a.create({name:"SpawningDots",extensions:{derivatives:!0},fragmentShader:"\n          varying vec2 vUv;\n          uniform sampler2D map;\n          uniform vec3 color;\n          uniform float opacity;\n          float aastep(float threshold, float value) {\n            float change = fwidth(value) * 0.5;\n            float lo = threshold - change;\n            float hi = threshold + change;\n            return clamp((value - lo) / (hi - lo), 0.0, 1.0);\n          }\n    \n          void main () {\n            // float a = aastep(0.5, texture2D(map, vUv).a);\n            \n            gl_FragColor.rgb = color;\n            // if (!gl_FrontFacing) gl_FragColor.rgb *= 0.75;\n            gl_FragColor.a = 1.0;\n            // gl_FragColor.rgb *= opacity * a;\n            // gl_FragColor.a = opacity * a;\n            // if (gl_FragColor.a < 0.1) discard;\n          }\n        ",vertexShader:"\n          varying vec2 vUv;\n          void main () {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n          }\n        ",uniforms:{opacity:{value:1},color:{value:new t.Color}},blending:t.AdditiveBlending}),n=new t.Mesh(l.pick(f),r),i=o.entity();return i.add(e.GroundSpawningDot),i.add(e.TargetKeyTween,{active:!1,duration:2,ease:"sineOut",pauseOnModal:!0,target:n.userData,killEntityOnFinish:!1,assignFromOnStart:!0,key:"tween"}),n.userData.entity=i,n.userData.tween=0,n.userData.size=.1,n.userData.speed=0,n.userData.alpha=1,n.userData.velocity=new t.Vector3,n.userData.rotationAxis=new t.Vector3,n.userData.rotationSpeed=1,n.userData.rotationAngleOffset=0,n.frustumCulled=!1,n.name="spawning-dots",n.matrixAutoUpdate=!1,n}}),D=new t.Vector3,y=(new t.Vector3,[0,0]),v=[0,0,0],m=[0,0,0,0],h=(new t.Color,o.findTag(e.UserTarget)),w=o.findTag(e.UserCharacter);let b=0,O=.1,x=.3,S=O;for(let e=0;e<5;e++)j(null,h.position,w.direction);const A=o.view([e.EnvironmentState,e.ActiveEnvironmentState]);return function(t){if("tundra"===(A.length?A[0].get(e.EnvironmentState).name:null))return;w.position;!function(e=0){if((b+=e)>=S){let e;b%=S,S=l.range(O,x),j(e,h.position,w.direction)}}(t);for(let a=0;a<s.length;a++){const r=s[a],n=r.get(e.TargetKeyTween),i=r.get(e.Object3D),o=i.userData.tween*i.userData.size;i.scale.setScalar(o);const l=i.userData.tween*i.userData.alpha,c=.75;i.material.uniforms.color.value.setRGB(l+c,l+c,l+c),i.material.uniforms.opacity.value=l,i.position.addScaledVector(i.userData.velocity,t*i.userData.speed),i.rotateOnWorldAxis(i.userData.rotationAxis,i.userData.rotationSpeed*t),i.visible=i.userData.tween>1e-5,i.visible&&i.updateMatrix(),n.finished&&i.userData.appearing&&(i.userData.appearing=!1,i.userData.killing=!0,M(i,0,i.userData.holdDelay)),n.finished&&i.userData.killing&&!i.userData.appearing&&(i.userData.killing=!1,i.userData.appearing=!1,i.userData.entity.remove(e.Object3D),(0,u.detachObject)(i),p.release(i))}};function j(e,t,a,r){const n=r?l.rangeFloor(1,5):1;for(let i=0;i<n;i++)C(e,t,a,r)}function C(t,a,r,n){const o=p.next();if(o){o.visible=!1,c.add(o),o.userData.entity.add(e.Object3D,o),o.position.copy(a);let t=l.gaussian(1,6);l.gaussian(0,1)>0&&(t+=l.gaussian(0,4)),l.gaussian(0,1)>1&&(t+=l.gaussian(0,8)),l.insideCircle(l.gaussian(4,2)+l.range(5,10)+l.gaussian(0,2)+1*t*l.gaussian(0,2),y),o.position.x+=y[0],o.position.z+=y[1],o.quaternion.fromArray(l.quaternion(m)),o.userData.holdDelay=l.range(0,1),o.position.y=l.range(.5,6),o.userData.appearing=!0,o.userData.killing=!1,o.userData.size=l.range(.05,.1),o.userData.speed=i.clamp(Math.abs(l.gaussian(.5,.2)),.25,1),o.userData.tween=0,o.userData.velocity.set(0,1,0),o.quaternion.fromArray(l.quaternion(m)),o.userData.rotationAxis.fromArray(l.insideSphere(1,v)),o.userData.rotationSpeed=4,o.userData.rotationAngleOffset=l.range(-1,1)*Math.PI*2,o.userData.alpha=l.range(.5,1),n?(l.insideCircle(1,y),D.x=y[0],D.y=l.range(0,0),D.z=y[1],D.addScaledVector(r,l.range(0,1)),D.normalize()):(D.copy(r),D.y+=l.range(0,.5),D.normalize()),o.userData.velocity.copy(D),M(o,1,n?0:l.range(0,1))}}function M(t,a,r){const n=t.userData.entity.get(e.TargetKeyTween);n.to=a,n.delay=r||0,n.elapsed=0,n.finished=!1,n.started=!1,n.active=!0}}
},{"../tags":"injP","three":"IV0r","../util/ShaderManager":"igLh","../util/ObjectPool":"iiAR","../util/Random":"LMfK","../util/math":"Ov1X","./AnimationSystem":"cUmx","../util/load":"OkDW","../util/three-util":"bI4v"}],"Q2iH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=g;var e=x(require("three")),t=x(require("../tags")),r=x(require("../util/math")),i=require("../util/load"),a=require("../util/three-util"),n=require("../util/array"),o=m(require("eases/sine-out")),l=m(require("eases/sine-in")),c=m(require("../util/Random")),u=m(require("../util/ObjectPool")),s=x(require("../util/ShaderManager")),d=m(require("../util/Assets")),p=require("../util/addFrameTasks"),v=require("./AnimationSystem");function m(e){return e&&e.__esModule?e:{default:e}}function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}function x(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var o=a?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=e[n]}return i.default=e,r&&r.set(e,i),i}const y="image/data/soft-circle";function g(i){const m=i.findTag(t.Renderer),[f]=d.default.createGPUTextureTask(m,y),x=(0,c.default)(),g=new e.WebGLRenderTarget(256,256);g.texture.generateMipmaps=!1,g.depthBuffer=!1,g.texture.minFilter=e.LinearFilter,g.texture.magFilter=e.LinearFilter,g.texture.wrapS=g.texture.wrapT=e.ClampToEdgeWrapping,i.entity().add(t.DebugRenderTarget,{visible:!1,target:g});const h=new e.Matrix4,w=new e.Matrix4;i.entity().add(t.GroundDataRenderTarget,{target:g,projection:h,view:w});const M=new e.OrthographicCamera(-1,1,-1,1,-100,100),P=new e.Scene;new e.CylinderGeometry(.1,.1,4,8).translate(0,2,0);const T=new e.Vector3(0,0,0),z=new e.Vector3(0,0,0),O=[],S=[0,0];let W=new e.Vector3,b=!1;const q=s.create({name:"Shader-Data-Texture",uniforms:{color:{value:new e.Color},map:{value:f},opacity:{value:0}},transparent:!0,depthWrite:!1,depthTest:!1,side:e.DoubleSide,vertexShader:"\n    #include <common>\n    varying vec2 vUv;\n\n    void main () {\n      vUv = uv;\n\n      vec3 centerWorldPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n      vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n      vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n      vec2 scale;\n      scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n      scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n      vec3 offsetPos = position.xyz;\n      vec3 vertexWorldPos = centerWorldPos\n        + camRightWorld * offsetPos.x * scale.x\n        + camUpWorld * offsetPos.y * scale.y;\n\n      gl_Position = projectionMatrix * viewMatrix * vec4(vertexWorldPos, 1.0);\n    }",fragmentShader:"\n    uniform sampler2D map;\n    uniform float opacity;\n    uniform vec3 color;\n    varying vec2 vUv;\n    void main () {\n      gl_FragColor = texture2D(map, vUv) * vec4(color, opacity);\n    }\n    "}),C=new u.default({name:"ParticlePool",initialCapacity:100,create(){const t=q,r=new e.Sprite(t);return(0,a.cloneMaterial)(r),s.push(r.material),r.userData={time:0,directionX:0,directionY:0,velocity:new e.Vector3,userSpeed:0,strength:1,delay:x.range(0,.1),duration:x.range(0,2),durationIn:x.range(1.25,1.5),durationOut:1,minSize:2,size:x.range(5,7.5),alpha:0,opacity:1,active:!1},r}});let R=0,j={value:1,tweening:!1};const D=i.listen(t.FinalBiomeResolution);return(0,p.addPreRenderCallback)(function(){z.copy(m.getClearColor()),m.setRenderTarget(g),m.setClearColor(T),m.clear(),m.render(P,M),m.setRenderTarget(null),m.setClearColor(z)}),function(e){R+=e;const c=m.domElement;c.width,c.height;if(0===c.width||0===c.height)return;D.added.length>0&&(0,v.tweenTo)(i,j,"value",0,1,"sineOut");const u=i.findTag(t.UserCharacter),s=i.findTag(t.UserTarget),d=u.position,p=s.position;if(!b||W.distanceToSquared(d)>=.25){const e=C.next(),t=e.userData;t.active=!0,t.time=0,t.alpha=0,t.directionX=u.direction.x,t.directionY=u.direction.z,t.velocity.copy(u.velocity),t.userSpeed=s.totalSpeedAlpha;const r=x.insideCircle(.5,S);e.position.set(d.x,d.z,0),e.position.x+=r[0],e.position.y+=r[1],e.position.x+=1*u.direction.x,e.position.z+=1*u.direction.z,P.add(e),O.push(e),W.copy(d),b=!0}O.forEach(t=>{const i=t.userData;i.time+=e;r.mapRange(i.velocity.x,-.15,.15,0,1,!0),r.mapRange(i.velocity.z,-.15,.15,0,1,!0);const a=r.clamp(i.velocity.x,-.15,.15),n=r.clamp(i.velocity.z,-.15,.15);t.position.x+=.2*a,t.position.z+=.2*n;const c=Math.max(0,i.time-i.delay),u=i.duration+i.durationIn+i.durationOut;if(c<i.durationIn)i.alpha=(0,o.default)(r.clamp01(c/i.durationIn));else if(c>=i.durationIn+i.duration){const e=Math.max(0,c-(i.durationIn+i.duration));i.alpha=1-(0,l.default)(r.clamp01(e/i.durationOut))}else i.alpha=1;c>=u&&(i.active=!1);t.material.uniforms.color.value.setRGB(1,.5*i.directionX+.5,.5*i.directionY+.5),t.material.uniforms.opacity.value=i.alpha*i.opacity*1*j.value,t.scale.setScalar(r.lerp(i.minSize,i.size,Math.pow(i.alpha,1)))});for(let t=O.length-1;t>=0;t--)if(!O[t].userData.active){const e=O[t];C.release(e),(0,a.detachObject)(e),(0,n.spliceOne)(O,t)}M.left=-20,M.right=20,M.top=20,M.bottom=-20,M.position.set(p.x,p.z,0),M.zoom=1,M.updateProjectionMatrix(),M.updateMatrixWorld(),h.copy(M.projectionMatrix).multiply(M.matrixWorldInverse),w.identity()}}
},{"three":"IV0r","../tags":"injP","../util/math":"Ov1X","../util/load":"OkDW","../util/three-util":"bI4v","../util/array":"ibDZ","eases/sine-out":"X6St","eases/sine-in":"YFBx","../util/Random":"LMfK","../util/ObjectPool":"iiAR","../util/ShaderManager":"igLh","../util/Assets":"Wm90","../util/addFrameTasks":"l7a6","./AnimationSystem":"cUmx"}],"Da58":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bird0.a07beac8.mp3";
},{}],"oQwi":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bird0.45fdcc0e.ogg";
},{}],"njjt":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bird1.9004fb3c.mp3";
},{}],"GZch":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bird1.938dec8b.ogg";
},{}],"vM5E":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/birdflap.8261d630.mp3";
},{}],"ALQK":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/birdflap.2573187b.ogg";
},{}],"A4Hd":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote1.93832d2f.mp3";
},{}],"k4f7":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote1.9940b6bb.ogg";
},{}],"KSMF":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote2.dfed1a17.mp3";
},{}],"ptZ4":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote2.1856889d.ogg";
},{}],"N27E":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote3.b19a09d7.mp3";
},{}],"mCoz":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote3.fd860edd.ogg";
},{}],"kvDU":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote4.dd3db39f.mp3";
},{}],"PL0d":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote4.67d244aa.ogg";
},{}],"q4xw":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote5.b61ad692.mp3";
},{}],"RrAJ":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote5.48732d42.ogg";
},{}],"YPYR":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote6.7052f8fb.mp3";
},{}],"rd8I":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote6.e1867964.ogg";
},{}],"Fkey":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote7.9a527310.mp3";
},{}],"Mkko":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/bnote7.28c0b803.ogg";
},{}],"Ttlk":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/butterfly.d1786442.mp3";
},{}],"cQYY":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/butterfly.aa21b959.ogg";
},{}],"Wir6":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/button-click.36f68fb0.mp3";
},{}],"RMHD":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/button-click.9d40b46c.ogg";
},{}],"LKiJ":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/button-hover.20d4a814.mp3";
},{}],"TkQW":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/button-hover.d11c7520.ogg";
},{}],"hy6r":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/click.99306096.mp3";
},{}],"ywUd":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/click.09a55bd2.ogg";
},{}],"KhEF":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/collect-poem.79f4d293.mp3";
},{}],"Spg1":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/collect-poem.d01da42f.ogg";
},{}],"BLWj":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/collect1.c21c87d4.mp3";
},{}],"qdWi":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/collect1.440559e0.ogg";
},{}],"eyNc":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fish.345a0ade.mp3";
},{}],"jGBK":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/fish.6af3bb36.ogg";
},{}],"iK2R":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/flash-build-up.3f02bdf2.mp3";
},{}],"WejH":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/foxhm.bd115685.mp3";
},{}],"H0Xu":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/foxhm.a6ccee93.ogg";
},{}],"GuGt":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/foxpurring.a6e6fba5.mp3";
},{}],"orqp":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/foxpurring.7a13c392.ogg";
},{}],"IH1F":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass-push1.049ecc80.mp3";
},{}],"FVjo":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass-push1.98aa3714.ogg";
},{}],"FFwY":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass-push2.d2f637d9.mp3";
},{}],"DjqY":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grass-push2.77f9b2ad.ogg";
},{}],"yH1D":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/haiku-card.7d06e46e.mp3";
},{}],"Xl2u":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/haiku-card.d150712c.ogg";
},{}],"AmWv":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ice-01.1176c34f.mp3";
},{}],"g3Vv":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ice-01.120de494.ogg";
},{}],"s4HC":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ice-02.e0df8e63.mp3";
},{}],"bHiW":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ice-02.78ff5a9c.ogg";
},{}],"F6Uv":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ice-03.5d30fd83.mp3";
},{}],"zKbh":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/ice-03.751b2832.ogg";
},{}],"ZJ3O":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/journal-open.16d6f9f7.mp3";
},{}],"SXMB":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/journal-open.8d87e6f1.ogg";
},{}],"SZa5":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaves1.18c15b2b.mp3";
},{}],"aKNl":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaves1.ee8c3074.ogg";
},{}],"w8dx":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaves2.9f2c0751.mp3";
},{}],"smtF":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaves2.2e4267ae.ogg";
},{}],"Yn6B":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaves3.77766c58.mp3";
},{}],"Fatx":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaves3.8b76bed1.ogg";
},{}],"yVf8":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaves4.72251de6.mp3";
},{}],"kssK":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/leaves4.f7b30ab2.ogg";
},{}],"dNBq":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/menu-open.8417b5ac.mp3";
},{}],"EtlA":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/menu-open.dc073d24.ogg";
},{}],"DdCq":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/movement-forest.1636e78a.mp3";
},{}],"HNJl":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/movement-forest.d7f6b16b.ogg";
},{}],"DUFK":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/music1.21713a23.mp3";
},{}],"OhC6":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/music1.d063251c.ogg";
},{}],"fwAm":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/music2.e49c4034.mp3";
},{}],"LMoV":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/music2.749381e4.ogg";
},{}],"EzMy":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/music3a.608eebff.mp3";
},{}],"yAFZ":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/music3a.42fdf31c.ogg";
},{}],"Dn1a":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/music3b.f1c7f68b.mp3";
},{}],"qEDv":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/music3b.c5667fee.ogg";
},{}],"JxWU":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nature1.fd73f230.mp3";
},{}],"fLNO":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nature1.dbb397b2.ogg";
},{}],"MwPu":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nature2-old.a2bb2725.mp3";
},{}],"IBee":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nature2-old.b0bf53c7.ogg";
},{}],"JO2O":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nature2.5a4c8c41.mp3";
},{}],"QDvh":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nature2.a64b38aa.ogg";
},{}],"nk7k":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nature3.8c54561c.mp3";
},{}],"b2u1":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/nature3.47fd5b54.ogg";
},{}],"Ep4l":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-a3.c100ed72.mp3";
},{}],"IKa5":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-a3.3c2edbcd.ogg";
},{}],"VIVE":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-c3.9bb7f072.mp3";
},{}],"bprf":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-c3.84a4a111.ogg";
},{}],"MV7c":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-c4.04f2b4a7.mp3";
},{}],"zC44":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-c4.39954217.ogg";
},{}],"EePc":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-d3.8f426485.mp3";
},{}],"jOPR":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-d3.36ddc306.ogg";
},{}],"xY4u":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-d4.7ac6d92e.mp3";
},{}],"pdow":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-d4.365d5dc3.ogg";
},{}],"JjLZ":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-e3.0619c3a5.mp3";
},{}],"HBuw":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-e3.57402d4f.ogg";
},{}],"yKkq":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-g3.ad8ed6ab.mp3";
},{}],"zpd5":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-forest-g3.8a1785e5.ogg";
},{}],"KfFT":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-grasslands-a3.0868aa91.mp3";
},{}],"O4U2":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-grasslands-a3.2044e71c.ogg";
},{}],"mx1M":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-grasslands-c3.b9de67f5.mp3";
},{}],"E8sK":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-grasslands-c4.ceba1ef9.mp3";
},{}],"DmW4":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-grasslands-d3.0212d4c2.mp3";
},{}],"M1WP":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-grasslands-d4.86fdf96e.mp3";
},{}],"ZkiR":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-grasslands-e3.934ad3fb.mp3";
},{}],"fzke":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-grasslands-g3.32d73090.mp3";
},{}],"mNK5":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-tundra-a3.f331cc1d.mp3";
},{}],"O681":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-tundra-c3.de740360.mp3";
},{}],"USQO":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-tundra-c4.ecc8eaf7.mp3";
},{}],"duUa":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-tundra-d3.5fa38bb1.mp3";
},{}],"ZTm5":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-tundra-d4.9fffffbf.mp3";
},{}],"VrsN":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-tundra-e3.a4ffb439.mp3";
},{}],"lrfS":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/note-tundra-g3.e92ce7cb.mp3";
},{}],"PHgY":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/pickup.84302357.mp3";
},{}],"cZlX":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/rain.d1055321.mp3";
},{}],"a6Jv":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/reveal01.f03d30c1.mp3";
},{}],"JaPC":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/reveal02.7bec4aec.mp3";
},{}],"v48b":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/score-haiku.0200260d.mp3";
},{}],"jWld":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/score-outro.7b14f9be.mp3";
},{}],"jvrt":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/score-restore.c63b0606.mp3";
},{}],"mjCm":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/score-start.b237717b.mp3";
},{}],"xZrC":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/score-transition.957ca985.mp3";
},{}],"vs4q":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-transition-0.a5856186.mp3";
},{}],"qOHD":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tree-transition-1.126c9a31.mp3";
},{}],"vm5q":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/water-01.686623ac.mp3";
},{}],"XLYq":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/water-02.ac43c8e5.mp3";
},{}],"XW9Z":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/writing-01.a4479c25.mp3";
},{}],"jP6F":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/writing-02.56db7b43.mp3";
},{}],"H7bk":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/writing-03.28846dc3.mp3";
},{}],"ereN":[function(require,module,exports) {
module.exports={bird0:{mp3:require("./bird0.mp3"),ogg:require("./bird0.ogg")},bird1:{mp3:require("./bird1.mp3"),ogg:require("./bird1.ogg")},birdflap:{mp3:require("./birdflap.mp3"),ogg:require("./birdflap.ogg")},bnote1:{mp3:require("./bnote1.mp3"),ogg:require("./bnote1.ogg")},bnote2:{mp3:require("./bnote2.mp3"),ogg:require("./bnote2.ogg")},bnote3:{mp3:require("./bnote3.mp3"),ogg:require("./bnote3.ogg")},bnote4:{mp3:require("./bnote4.mp3"),ogg:require("./bnote4.ogg")},bnote5:{mp3:require("./bnote5.mp3"),ogg:require("./bnote5.ogg")},bnote6:{mp3:require("./bnote6.mp3"),ogg:require("./bnote6.ogg")},bnote7:{mp3:require("./bnote7.mp3"),ogg:require("./bnote7.ogg")},butterfly:{mp3:require("./butterfly.mp3"),ogg:require("./butterfly.ogg")},"button-click":{mp3:require("./button-click.mp3"),ogg:require("./button-click.ogg")},"button-hover":{mp3:require("./button-hover.mp3"),ogg:require("./button-hover.ogg")},click:{mp3:require("./click.mp3"),ogg:require("./click.ogg")},"collect-poem":{mp3:require("./collect-poem.mp3"),ogg:require("./collect-poem.ogg")},collect1:{mp3:require("./collect1.mp3"),ogg:require("./collect1.ogg")},fish:{mp3:require("./fish.mp3"),ogg:require("./fish.ogg")},"flash-build-up":{mp3:require("./flash-build-up.mp3")},foxhm:{mp3:require("./foxhm.mp3"),ogg:require("./foxhm.ogg")},foxpurring:{mp3:require("./foxpurring.mp3"),ogg:require("./foxpurring.ogg")},"grass-push1":{mp3:require("./grass-push1.mp3"),ogg:require("./grass-push1.ogg")},"grass-push2":{mp3:require("./grass-push2.mp3"),ogg:require("./grass-push2.ogg")},"haiku-card":{mp3:require("./haiku-card.mp3"),ogg:require("./haiku-card.ogg")},"ice-01":{mp3:require("./ice-01.mp3"),ogg:require("./ice-01.ogg")},"ice-02":{mp3:require("./ice-02.mp3"),ogg:require("./ice-02.ogg")},"ice-03":{mp3:require("./ice-03.mp3"),ogg:require("./ice-03.ogg")},"journal-open":{mp3:require("./journal-open.mp3"),ogg:require("./journal-open.ogg")},leaves1:{mp3:require("./leaves1.mp3"),ogg:require("./leaves1.ogg")},leaves2:{mp3:require("./leaves2.mp3"),ogg:require("./leaves2.ogg")},leaves3:{mp3:require("./leaves3.mp3"),ogg:require("./leaves3.ogg")},leaves4:{mp3:require("./leaves4.mp3"),ogg:require("./leaves4.ogg")},"menu-open":{mp3:require("./menu-open.mp3"),ogg:require("./menu-open.ogg")},"movement-forest":{mp3:require("./movement-forest.mp3"),ogg:require("./movement-forest.ogg")},music1:{mp3:require("./music1.mp3"),ogg:require("./music1.ogg")},music2:{mp3:require("./music2.mp3"),ogg:require("./music2.ogg")},music3a:{mp3:require("./music3a.mp3"),ogg:require("./music3a.ogg")},music3b:{mp3:require("./music3b.mp3"),ogg:require("./music3b.ogg")},nature1:{mp3:require("./nature1.mp3"),ogg:require("./nature1.ogg")},"nature2-old":{mp3:require("./nature2-old.mp3"),ogg:require("./nature2-old.ogg")},nature2:{mp3:require("./nature2.mp3"),ogg:require("./nature2.ogg")},nature3:{mp3:require("./nature3.mp3"),ogg:require("./nature3.ogg")},"note-forest-a3":{mp3:require("./note-forest-a3.mp3"),ogg:require("./note-forest-a3.ogg")},"note-forest-c3":{mp3:require("./note-forest-c3.mp3"),ogg:require("./note-forest-c3.ogg")},"note-forest-c4":{mp3:require("./note-forest-c4.mp3"),ogg:require("./note-forest-c4.ogg")},"note-forest-d3":{mp3:require("./note-forest-d3.mp3"),ogg:require("./note-forest-d3.ogg")},"note-forest-d4":{mp3:require("./note-forest-d4.mp3"),ogg:require("./note-forest-d4.ogg")},"note-forest-e3":{mp3:require("./note-forest-e3.mp3"),ogg:require("./note-forest-e3.ogg")},"note-forest-g3":{mp3:require("./note-forest-g3.mp3"),ogg:require("./note-forest-g3.ogg")},"note-grasslands-a3":{mp3:require("./note-grasslands-a3.mp3"),ogg:require("./note-grasslands-a3.ogg")},"note-grasslands-c3":{mp3:require("./note-grasslands-c3.mp3")},"note-grasslands-c4":{mp3:require("./note-grasslands-c4.mp3")},"note-grasslands-d3":{mp3:require("./note-grasslands-d3.mp3")},"note-grasslands-d4":{mp3:require("./note-grasslands-d4.mp3")},"note-grasslands-e3":{mp3:require("./note-grasslands-e3.mp3")},"note-grasslands-g3":{mp3:require("./note-grasslands-g3.mp3")},"note-tundra-a3":{mp3:require("./note-tundra-a3.mp3")},"note-tundra-c3":{mp3:require("./note-tundra-c3.mp3")},"note-tundra-c4":{mp3:require("./note-tundra-c4.mp3")},"note-tundra-d3":{mp3:require("./note-tundra-d3.mp3")},"note-tundra-d4":{mp3:require("./note-tundra-d4.mp3")},"note-tundra-e3":{mp3:require("./note-tundra-e3.mp3")},"note-tundra-g3":{mp3:require("./note-tundra-g3.mp3")},pickup:{mp3:require("./pickup.mp3")},rain:{mp3:require("./rain.mp3")},reveal01:{mp3:require("./reveal01.mp3")},reveal02:{mp3:require("./reveal02.mp3")},"score-haiku":{mp3:require("./score-haiku.mp3")},"score-outro":{mp3:require("./score-outro.mp3")},"score-restore":{mp3:require("./score-restore.mp3")},"score-start":{mp3:require("./score-start.mp3")},"score-transition":{mp3:require("./score-transition.mp3")},"tree-transition-0":{mp3:require("./tree-transition-0.mp3")},"tree-transition-1":{mp3:require("./tree-transition-1.mp3")},"water-01":{mp3:require("./water-01.mp3")},"water-02":{mp3:require("./water-02.mp3")},"writing-01":{mp3:require("./writing-01.mp3")},"writing-02":{mp3:require("./writing-02.mp3")},"writing-03":{mp3:require("./writing-03.mp3")}};
},{"./bird0.mp3":"Da58","./bird0.ogg":"oQwi","./bird1.mp3":"njjt","./bird1.ogg":"GZch","./birdflap.mp3":"vM5E","./birdflap.ogg":"ALQK","./bnote1.mp3":"A4Hd","./bnote1.ogg":"k4f7","./bnote2.mp3":"KSMF","./bnote2.ogg":"ptZ4","./bnote3.mp3":"N27E","./bnote3.ogg":"mCoz","./bnote4.mp3":"kvDU","./bnote4.ogg":"PL0d","./bnote5.mp3":"q4xw","./bnote5.ogg":"RrAJ","./bnote6.mp3":"YPYR","./bnote6.ogg":"rd8I","./bnote7.mp3":"Fkey","./bnote7.ogg":"Mkko","./butterfly.mp3":"Ttlk","./butterfly.ogg":"cQYY","./button-click.mp3":"Wir6","./button-click.ogg":"RMHD","./button-hover.mp3":"LKiJ","./button-hover.ogg":"TkQW","./click.mp3":"hy6r","./click.ogg":"ywUd","./collect-poem.mp3":"KhEF","./collect-poem.ogg":"Spg1","./collect1.mp3":"BLWj","./collect1.ogg":"qdWi","./fish.mp3":"eyNc","./fish.ogg":"jGBK","./flash-build-up.mp3":"iK2R","./foxhm.mp3":"WejH","./foxhm.ogg":"H0Xu","./foxpurring.mp3":"GuGt","./foxpurring.ogg":"orqp","./grass-push1.mp3":"IH1F","./grass-push1.ogg":"FVjo","./grass-push2.mp3":"FFwY","./grass-push2.ogg":"DjqY","./haiku-card.mp3":"yH1D","./haiku-card.ogg":"Xl2u","./ice-01.mp3":"AmWv","./ice-01.ogg":"g3Vv","./ice-02.mp3":"s4HC","./ice-02.ogg":"bHiW","./ice-03.mp3":"F6Uv","./ice-03.ogg":"zKbh","./journal-open.mp3":"ZJ3O","./journal-open.ogg":"SXMB","./leaves1.mp3":"SZa5","./leaves1.ogg":"aKNl","./leaves2.mp3":"w8dx","./leaves2.ogg":"smtF","./leaves3.mp3":"Yn6B","./leaves3.ogg":"Fatx","./leaves4.mp3":"yVf8","./leaves4.ogg":"kssK","./menu-open.mp3":"dNBq","./menu-open.ogg":"EtlA","./movement-forest.mp3":"DdCq","./movement-forest.ogg":"HNJl","./music1.mp3":"DUFK","./music1.ogg":"OhC6","./music2.mp3":"fwAm","./music2.ogg":"LMoV","./music3a.mp3":"EzMy","./music3a.ogg":"yAFZ","./music3b.mp3":"Dn1a","./music3b.ogg":"qEDv","./nature1.mp3":"JxWU","./nature1.ogg":"fLNO","./nature2-old.mp3":"MwPu","./nature2-old.ogg":"IBee","./nature2.mp3":"JO2O","./nature2.ogg":"QDvh","./nature3.mp3":"nk7k","./nature3.ogg":"b2u1","./note-forest-a3.mp3":"Ep4l","./note-forest-a3.ogg":"IKa5","./note-forest-c3.mp3":"VIVE","./note-forest-c3.ogg":"bprf","./note-forest-c4.mp3":"MV7c","./note-forest-c4.ogg":"zC44","./note-forest-d3.mp3":"EePc","./note-forest-d3.ogg":"jOPR","./note-forest-d4.mp3":"xY4u","./note-forest-d4.ogg":"pdow","./note-forest-e3.mp3":"JjLZ","./note-forest-e3.ogg":"HBuw","./note-forest-g3.mp3":"yKkq","./note-forest-g3.ogg":"zpd5","./note-grasslands-a3.mp3":"KfFT","./note-grasslands-a3.ogg":"O4U2","./note-grasslands-c3.mp3":"mx1M","./note-grasslands-c4.mp3":"E8sK","./note-grasslands-d3.mp3":"DmW4","./note-grasslands-d4.mp3":"M1WP","./note-grasslands-e3.mp3":"ZkiR","./note-grasslands-g3.mp3":"fzke","./note-tundra-a3.mp3":"mNK5","./note-tundra-c3.mp3":"O681","./note-tundra-c4.mp3":"USQO","./note-tundra-d3.mp3":"duUa","./note-tundra-d4.mp3":"ZTm5","./note-tundra-e3.mp3":"VrsN","./note-tundra-g3.mp3":"lrfS","./pickup.mp3":"PHgY","./rain.mp3":"cZlX","./reveal01.mp3":"a6Jv","./reveal02.mp3":"JaPC","./score-haiku.mp3":"v48b","./score-outro.mp3":"jWld","./score-restore.mp3":"jvrt","./score-start.mp3":"mjCm","./score-transition.mp3":"xZrC","./tree-transition-0.mp3":"vs4q","./tree-transition-1.mp3":"qOHD","./water-01.mp3":"vm5q","./water-02.mp3":"XLYq","./writing-01.mp3":"XW9Z","./writing-02.mp3":"jP6F","./writing-03.mp3":"H7bk"}],"UTMB":[function(require,module,exports) {
var define;
var global = arguments[3];
var e,t=arguments[3];!function(){"use strict";var n=function(){this.init()};n.prototype={init:function(){var e=this||o;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||o;if(e=parseFloat(e),t.ctx||l(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,o.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var r=t._howls[n]._getSoundIds(),i=0;i<r.length;i++){var a=t._howls[n]._soundById(r[i]);a&&a._node&&(a._node.volume=a._volume*e)}return t}return t._volume},mute:function(e){var t=this||o;t.ctx||l(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,o.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var r=t._howls[n]._getSoundIds(),i=0;i<r.length;i++){var a=t._howls[n]._soundById(r[i]);a&&a._node&&(a._node.muted=!!e||a._muted)}return t},stop:function(){for(var e=this||o,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||o,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,l()),e},codecs:function(e){return(this||o)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||o;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(t){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||o,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(a){return e}if(!t||"function"!=typeof t.canPlayType)return e;var n=t.canPlayType("audio/mpeg;").replace(/^no$/,""),r=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),i=r&&parseInt(r[0].split("/")[1],10)<33;return e._codecs={mp3:!(i||!n&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||o;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(n){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var o=new Audio;o._unlocked=!0,e._releaseHtml5Audio(o)}catch(n){e.noAudio=!0;break}for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var i=e._howls[r]._getSoundIds(),a=0;a<i.length;a++){var s=e._howls[r]._soundById(i[a]);s&&s._node&&!s._node._unlocked&&(s._node._unlocked=!0,s._node.load())}e._autoResume();var u=e.ctx.createBufferSource();u.buffer=e._scratchBuffer,u.connect(e.ctx.destination),void 0===u.start?u.noteOn(0):u.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),u.onended=function(){u.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0);for(var n=0;n<e._howls.length;n++)e._howls[n]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),e}},_obtainHtml5Audio:function(){var e=this||o;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!=typeof Promise&&(t instanceof Promise||"function"==typeof t.then)&&t.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(e){var t=this||o;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&o.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var n=0;n<e._howls[t]._sounds.length;n++)if(!e._howls[t]._sounds[n]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}},3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&o.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then(function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var o=new n,r=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};r.prototype={init:function(e){var t=this;return o.ctx||l(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=o.usingWebAudio&&!t._html5,void 0!==o.ctx&&o.ctx&&o.autoUnlock&&o._unlockAudio(),o._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=null;if(o.noAudio)this._emit("loaderror",null,"No audio support.");else{"string"==typeof this._src&&(this._src=[this._src]);for(var t=0;t<this._src.length;t++){var n,r;if(this._format&&this._format[t])n=this._format[t];else{if("string"!=typeof(r=this._src[t])){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(n=/^data:audio\/([^;,]+);/i.exec(r))||(n=/\.([^.]+)$/.exec(r.split("?",1)[0])),n&&(n=n[1].toLowerCase())}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&o.codecs(n)){e=this._src[t];break}}if(e)return this._src=e,this._state="loading","https:"===window.location.protocol&&"http:"===e.slice(0,5)&&(this._html5=!0,this._webAudio=!1),new i(this),this._webAudio&&s(this),this;this._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var n=this,r=null;if("number"==typeof e)r=e,e=null;else{if("string"==typeof e&&"loaded"===n._state&&!n._sprite[e])return null;if(void 0===e&&(e="__default",!n._playLock)){for(var i=0,a=0;a<n._sounds.length;a++)n._sounds[a]._paused&&!n._sounds[a]._ended&&(i++,r=n._sounds[a]._id);1===i?e=null:r=null}}var s=r?n._soundById(r):n._inactiveSound();if(!s)return null;if(r&&!e&&(e=s._sprite||"__default"),"loaded"!==n._state){s._sprite=e,s._ended=!1;var u=s._id;return n._queue.push({event:"play",action:function(){n.play(u)}}),u}if(r&&!s._paused)return t||n._loadQueue("play"),s._id;n._webAudio&&o._autoResume();var d=Math.max(0,s._seek>0?s._seek:n._sprite[e][0]/1e3),_=Math.max(0,(n._sprite[e][0]+n._sprite[e][1])/1e3-d),l=1e3*_/Math.abs(s._rate),c=n._sprite[e][0]/1e3,p=(n._sprite[e][0]+n._sprite[e][1])/1e3;s._sprite=e,s._ended=!1;var f=function(){s._paused=!1,s._seek=d,s._start=c,s._stop=p,s._loop=!(!s._loop&&!n._sprite[e][2])};if(!(d>=p)){var h=s._node;if(n._webAudio){var m=function(){n._playLock=!1,f(),n._refreshBuffer(s);var e=s._muted||n._muted?0:s._volume;h.gain.setValueAtTime(e,o.ctx.currentTime),s._playStart=o.ctx.currentTime,void 0===h.bufferSource.start?s._loop?h.bufferSource.noteGrainOn(0,d,86400):h.bufferSource.noteGrainOn(0,d,_):s._loop?h.bufferSource.start(0,d,86400):h.bufferSource.start(0,d,_),l!==1/0&&(n._endTimers[s._id]=setTimeout(n._ended.bind(n,s),l)),t||setTimeout(function(){n._emit("play",s._id),n._loadQueue()},0)};"running"===o.state&&"interrupted"!==o.ctx.state?m():(n._playLock=!0,n.once("resume",m),n._clearTimer(s._id))}else{var v=function(){h.currentTime=d,h.muted=s._muted||n._muted||o._muted||h.muted,h.volume=s._volume*o.volume(),h.playbackRate=s._rate;try{var r=h.play();if(r&&"undefined"!=typeof Promise&&(r instanceof Promise||"function"==typeof r.then)?(n._playLock=!0,f(),r.then(function(){n._playLock=!1,h._unlocked=!0,t||(n._emit("play",s._id),n._loadQueue())}).catch(function(){n._playLock=!1,n._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),s._ended=!0,s._paused=!0})):t||(n._playLock=!1,f(),n._emit("play",s._id),n._loadQueue()),h.playbackRate=s._rate,h.paused)return void n._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||s._loop?n._endTimers[s._id]=setTimeout(n._ended.bind(n,s),l):(n._endTimers[s._id]=function(){n._ended(s),h.removeEventListener("ended",n._endTimers[s._id],!1)},h.addEventListener("ended",n._endTimers[s._id],!1))}catch(i){n._emit("playerror",s._id,i)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===h.src&&(h.src=n._src,h.load());var A=window&&window.ejecta||!h.readyState&&o._navigator.isCocoonJS;if(h.readyState>=3||A)v();else{n._playLock=!0;var y=function(){v(),h.removeEventListener(o._canPlayEvent,y,!1)};h.addEventListener(o._canPlayEvent,y,!1),n._clearTimer(s._id)}}return s._id}n._ended(s)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),o=0;o<n.length;o++){t._clearTimer(n[o]);var r=t._soundById(n[o]);if(r&&!r._paused&&(r._seek=t.seek(n[o]),r._rateSeek=0,r._paused=!0,t._stopFade(n[o]),r._node))if(t._webAudio){if(!r._node.bufferSource)continue;void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),t._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||t._emit("pause",r?r._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var o=n._getSoundIds(e),r=0;r<o.length;r++){n._clearTimer(o[r]);var i=n._soundById(o[r]);i&&(i._seek=i._start||0,i._rateSeek=0,i._paused=!0,i._ended=!0,n._stopFade(o[r]),i._node&&(n._webAudio?i._node.bufferSource&&(void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),n._cleanBuffer(i._node)):isNaN(i._node.duration)&&i._node.duration!==1/0||(i._node.currentTime=i._start||0,i._node.pause(),i._node.duration===1/0&&n._clearSound(i._node))),t||n._emit("stop",i._id))}return n},mute:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(e,t)}}),n;if(void 0===t){if("boolean"!=typeof e)return n._muted;n._muted=e}for(var r=n._getSoundIds(t),i=0;i<r.length;i++){var a=n._soundById(r[i]);a&&(a._muted=e,a._interval&&n._stopFade(a._id),n._webAudio&&a._node?a._node.gain.setValueAtTime(e?0:a._volume,o.ctx.currentTime):a._node&&(a._node.muted=!!o._muted||e),n._emit("mute",a._id))}return n},volume:function(){var e,t,n,r=this,i=arguments;if(0===i.length)return r._volume;if(1===i.length||2===i.length&&void 0===i[1]?r._getSoundIds().indexOf(i[0])>=0?t=parseInt(i[0],10):e=parseFloat(i[0]):i.length>=2&&(e=parseFloat(i[0]),t=parseInt(i[1],10)),!(void 0!==e&&e>=0&&e<=1))return(n=t?r._soundById(t):r._sounds[0])?n._volume:0;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,i)}}),r;void 0===t&&(r._volume=e),t=r._getSoundIds(t);for(var a=0;a<t.length;a++)(n=r._soundById(t[a]))&&(n._volume=e,i[2]||r._stopFade(t[a]),r._webAudio&&n._node&&!n._muted?n._node.gain.setValueAtTime(e,o.ctx.currentTime):n._node&&!n._muted&&(n._node.volume=e*o.volume()),r._emit("volume",n._id));return r},fade:function(e,t,n,r){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"fade",action:function(){i.fade(e,t,n,r)}}),i;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),n=parseFloat(n),i.volume(e,r);for(var a=i._getSoundIds(r),s=0;s<a.length;s++){var u=i._soundById(a[s]);if(u){if(r||i._stopFade(a[s]),i._webAudio&&!u._muted){var d=o.ctx.currentTime,_=d+n/1e3;u._volume=e,u._node.gain.setValueAtTime(e,d),u._node.gain.linearRampToValueAtTime(t,_)}i._startFadeInterval(u,e,t,n,a[s],void 0===r)}}return i},_startFadeInterval:function(e,t,n,o,r,i){var a=this,s=t,u=n-t,d=Math.abs(u/.01),_=Math.max(4,d>0?o/d:o),l=Date.now();e._fadeTo=n,e._interval=setInterval(function(){var r=(Date.now()-l)/o;l=Date.now(),s+=u*r,s=Math.round(100*s)/100,s=u<0?Math.max(n,s):Math.min(n,s),a._webAudio?e._volume=s:a.volume(s,e._id,!0),i&&(a._volume=s),(n<t&&s<=n||n>t&&s>=n)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,a.volume(n,e._id),a._emit("fade",e._id))},_)},_stopFade:function(e){var t=this._soundById(e);return t&&t._interval&&(this._webAudio&&t._node.gain.cancelScheduledValues(o.ctx.currentTime),clearInterval(t._interval),t._interval=null,this.volume(t._fadeTo,e),t._fadeTo=null,this._emit("fade",e)),this},loop:function(){var e,t,n,o=arguments;if(0===o.length)return this._loop;if(1===o.length){if("boolean"!=typeof o[0])return!!(n=this._soundById(parseInt(o[0],10)))&&n._loop;e=o[0],this._loop=e}else 2===o.length&&(e=o[0],t=parseInt(o[1],10));for(var r=this._getSoundIds(t),i=0;i<r.length;i++)(n=this._soundById(r[i]))&&(n._loop=e,this._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop)));return this},rate:function(){var e,t,n,r=this,i=arguments;if(0===i.length)t=r._sounds[0]._id;else if(1===i.length){r._getSoundIds().indexOf(i[0])>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if("number"!=typeof e)return(n=r._soundById(t))?n._rate:r._rate;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,i)}}),r;void 0===t&&(r._rate=e),t=r._getSoundIds(t);for(var a=0;a<t.length;a++)if(n=r._soundById(t[a])){r.playing(t[a])&&(n._rateSeek=r.seek(t[a]),n._playStart=r._webAudio?o.ctx.currentTime:n._playStart),n._rate=e,r._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(e,o.ctx.currentTime):n._node&&(n._node.playbackRate=e);var s=r.seek(t[a]),u=1e3*((r._sprite[n._sprite][0]+r._sprite[n._sprite][1])/1e3-s)/Math.abs(n._rate);!r._endTimers[t[a]]&&n._paused||(r._clearTimer(t[a]),r._endTimers[t[a]]=setTimeout(r._ended.bind(r,n),u)),r._emit("rate",n._id)}return r},seek:function(){var e,t,n=this,r=arguments;if(0===r.length)t=n._sounds[0]._id;else if(1===r.length){n._getSoundIds().indexOf(r[0])>=0?t=parseInt(r[0],10):n._sounds.length&&(t=n._sounds[0]._id,e=parseFloat(r[0]))}else 2===r.length&&(e=parseFloat(r[0]),t=parseInt(r[1],10));if(void 0===t)return n;if("number"==typeof e&&("loaded"!==n._state||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,r)}}),n;var i=n._soundById(t);if(i){if(!("number"==typeof e&&e>=0)){if(n._webAudio){var a=n.playing(t)?o.ctx.currentTime-i._playStart:0,s=i._rateSeek?i._rateSeek-i._seek:0;return i._seek+(s+a*Math.abs(i._rate))}return i._node.currentTime}var u=n.playing(t);u&&n.pause(t,!0),i._seek=e,i._ended=!1,n._clearTimer(t),n._webAudio||!i._node||isNaN(i._node.duration)||(i._node.currentTime=e);var d=function(){n._emit("seek",t),u&&n.play(t,!0)};if(u&&!n._webAudio){var _=function(){n._playLock?setTimeout(_,0):d()};setTimeout(_,0)}else d()}return n},playing:function(e){if("number"==typeof e){var t=this._soundById(e);return!!t&&!t._paused}for(var n=0;n<this._sounds.length;n++)if(!this._sounds[n]._paused)return!0;return!1},duration:function(e){var t=this._duration,n=this._soundById(e);return n&&(t=this._sprite[n._sprite][1]/1e3),t},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,n=0;n<t.length;n++)t[n]._paused||e.stop(t[n]._id),e._webAudio||(e._clearSound(t[n]._node),t[n]._node.removeEventListener("error",t[n]._errorFn,!1),t[n]._node.removeEventListener(o._canPlayEvent,t[n]._loadFn,!1),t[n]._node.removeEventListener("ended",t[n]._endFn,!1),o._releaseHtml5Audio(t[n]._node)),delete t[n]._node,e._clearTimer(t[n]._id);var r=o._howls.indexOf(e);r>=0&&o._howls.splice(r,1);var i=!0;for(n=0;n<o._howls.length;n++)if(o._howls[n]._src===e._src||e._src.indexOf(o._howls[n]._src)>=0){i=!1;break}return a&&i&&delete a[e._src],o.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,o){var r=this["_on"+e];return"function"==typeof t&&r.push(o?{id:n,fn:t,once:o}:{id:n,fn:t}),this},off:function(e,t,n){var o=this["_on"+e],r=0;if("number"==typeof t&&(n=t,t=null),t||n)for(r=0;r<o.length;r++){var i=n===o[r].id;if(t===o[r].fn&&i||!t&&i){o.splice(r,1);break}}else if(e)this["_on"+e]=[];else{var a=Object.keys(this);for(r=0;r<a.length;r++)0===a[r].indexOf("_on")&&Array.isArray(this[a[r]])&&(this[a[r]]=[])}return this},once:function(e,t,n){return this.on(e,t,n,1),this},_emit:function(e,t,n){for(var o=this["_on"+e],r=o.length-1;r>=0;r--)o[r].id&&o[r].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(this,o[r].fn),0),o[r].once&&this.off(e,o[r].fn,o[r].id));return this._loadQueue(e),this},_loadQueue:function(e){if(this._queue.length>0){var t=this._queue[0];t.event===e&&(this._queue.shift(),this._loadQueue()),e||t.action()}return this},_ended:function(e){var t=e._sprite;if(!this._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(this._ended.bind(this,e),100),this;var n=!(!e._loop&&!this._sprite[t][2]);if(this._emit("end",e._id),!this._webAudio&&n&&this.stop(e._id,!0).play(e._id),this._webAudio&&n){this._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=o.ctx.currentTime;var r=1e3*(e._stop-e._start)/Math.abs(e._rate);this._endTimers[e._id]=setTimeout(this._ended.bind(this,e),r)}return this._webAudio&&!n&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,this._clearTimer(e._id),this._cleanBuffer(e._node),o._autoSuspend()),this._webAudio||n||this.stop(e._id,!0),this},_clearTimer:function(e){if(this._endTimers[e]){if("function"!=typeof this._endTimers[e])clearTimeout(this._endTimers[e]);else{var t=this._soundById(e);t&&t._node&&t._node.removeEventListener("ended",this._endTimers[e],!1)}delete this._endTimers[e]}return this},_soundById:function(e){for(var t=0;t<this._sounds.length;t++)if(e===this._sounds[t]._id)return this._sounds[t];return null},_inactiveSound:function(){this._drain();for(var e=0;e<this._sounds.length;e++)if(this._sounds[e]._ended)return this._sounds[e].reset();return new i(this)},_drain:function(){var e=this._pool,t=0,n=0;if(!(this._sounds.length<e)){for(n=0;n<this._sounds.length;n++)this._sounds[n]._ended&&t++;for(n=this._sounds.length-1;n>=0;n--){if(t<=e)return;this._sounds[n]._ended&&(this._webAudio&&this._sounds[n]._node&&this._sounds[n]._node.disconnect(0),this._sounds.splice(n,1),t--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],n=0;n<this._sounds.length;n++)t.push(this._sounds[n]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=o.ctx.createBufferSource(),e._node.bufferSource.buffer=a[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,o.ctx.currentTime),this},_cleanBuffer:function(e){var t=o._navigator&&o._navigator.vendor.indexOf("Apple")>=0;if(o._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=o._scratchBuffer}catch(n){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(o._navigator&&o._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var i=function(e){this._parent=e,this.init()};i.prototype={init:function(){var e=this._parent;return this._muted=e._muted,this._loop=e._loop,this._volume=e._volume,this._rate=e._rate,this._seek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++o._counter,e._sounds.push(this),this.create(),this},create:function(){var e=this._parent,t=o._muted||this._muted||this._parent._muted?0:this._volume;return e._webAudio?(this._node=void 0===o.ctx.createGain?o.ctx.createGainNode():o.ctx.createGain(),this._node.gain.setValueAtTime(t,o.ctx.currentTime),this._node.paused=!0,this._node.connect(o.masterGain)):o.noAudio||(this._node=o._obtainHtml5Audio(),this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(o._canPlayEvent,this._loadFn,!1),this._endFn=this._endListener.bind(this),this._node.addEventListener("ended",this._endFn,!1),this._node.src=e._src,this._node.preload=!0===e._preload?"auto":e._preload,this._node.volume=t*o.volume(),this._node.load()),this},reset:function(){var e=this._parent;return this._muted=e._muted,this._loop=e._loop,this._volume=e._volume,this._rate=e._rate,this._seek=0,this._rateSeek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++o._counter,this},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0),this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var e=this._parent;e._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),this._node.removeEventListener(o._canPlayEvent,this._loadFn,!1)},_endListener:function(){var e=this._parent;e._duration===1/0&&(e._duration=Math.ceil(10*this._node.duration)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=1e3*e._duration),e._ended(this)),this._node.removeEventListener("ended",this._endFn,!1)}};var a={},s=function(e){var t=e._src;if(a[t])return e._duration=a[t].duration,void _(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),o=new Uint8Array(n.length),r=0;r<n.length;++r)o[r]=n.charCodeAt(r);d(o.buffer,e)}else{var i=new XMLHttpRequest;i.open(e._xhr.method,t,!0),i.withCredentials=e._xhr.withCredentials,i.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach(function(t){i.setRequestHeader(t,e._xhr.headers[t])}),i.onload=function(){var t=(i.status+"")[0];"0"===t||"2"===t||"3"===t?d(i.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+i.status+".")},i.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete a[t],e.load())},u(i)}},u=function(e){try{e.send()}catch(t){e.onerror()}},d=function(e,t){var n=function(){t._emit("loaderror",null,"Decoding audio data failed.")},r=function(e){e&&t._sounds.length>0?(a[t._src]=e,_(t,e)):n()};"undefined"!=typeof Promise&&1===o.ctx.decodeAudioData.length?o.ctx.decodeAudioData(e).then(r).catch(n):o.ctx.decodeAudioData(e,r,n)},_=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},l=function(){if(o.usingWebAudio){try{"undefined"!=typeof AudioContext?o.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?o.ctx=new webkitAudioContext:o.usingWebAudio=!1}catch(i){o.usingWebAudio=!1}o.ctx||(o.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(o._navigator&&o._navigator.platform),t=o._navigator&&o._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=t?parseInt(t[1],10):null;if(e&&n&&n<9){var r=/safari/.test(o._navigator&&o._navigator.userAgent.toLowerCase());o._navigator&&!r&&(o.usingWebAudio=!1)}o.usingWebAudio&&(o.masterGain=void 0===o.ctx.createGain?o.ctx.createGainNode():o.ctx.createGain(),o.masterGain.gain.setValueAtTime(o._muted?0:o._volume,o.ctx.currentTime),o.masterGain.connect(o.ctx.destination)),o._setup()}};"function"==typeof e&&e.amd&&e([],function(){return{Howler:o,Howl:r}}),"undefined"!=typeof exports&&(exports.Howler=o,exports.Howl=r),void 0!==t?(t.HowlerGlobal=n,t.Howler=o,t.Howl=r,t.Sound=i):"undefined"!=typeof window&&(window.HowlerGlobal=n,window.Howler=o,window.Howl=r,window.Sound=i)}(),function(){"use strict";var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){if(!this.ctx||!this.ctx.listener)return this;for(var t=this._howls.length-1;t>=0;t--)this._howls[t].stereo(e);return this},HowlerGlobal.prototype.pos=function(e,t,n){return this.ctx&&this.ctx.listener?(t="number"!=typeof t?this._pos[1]:t,n="number"!=typeof n?this._pos[2]:n,"number"!=typeof e?this._pos:(this._pos=[e,t,n],void 0!==this.ctx.listener.positionX?(this.ctx.listener.positionX.setTargetAtTime(this._pos[0],Howler.ctx.currentTime,.1),this.ctx.listener.positionY.setTargetAtTime(this._pos[1],Howler.ctx.currentTime,.1),this.ctx.listener.positionZ.setTargetAtTime(this._pos[2],Howler.ctx.currentTime,.1)):this.ctx.listener.setPosition(this._pos[0],this._pos[1],this._pos[2]),this)):this},HowlerGlobal.prototype.orientation=function(e,t,n,o,r,i){if(!this.ctx||!this.ctx.listener)return this;var a=this._orientation;return t="number"!=typeof t?a[1]:t,n="number"!=typeof n?a[2]:n,o="number"!=typeof o?a[3]:o,r="number"!=typeof r?a[4]:r,i="number"!=typeof i?a[5]:i,"number"!=typeof e?a:(this._orientation=[e,t,n,o,r,i],void 0!==this.ctx.listener.forwardX?(this.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),this.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),this.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),this.ctx.listener.upX.setTargetAtTime(o,Howler.ctx.currentTime,.1),this.ctx.listener.upY.setTargetAtTime(r,Howler.ctx.currentTime,.1),this.ctx.listener.upZ.setTargetAtTime(i,Howler.ctx.currentTime,.1)):this.ctx.listener.setOrientation(e,t,n,o,r,i),this)},Howl.prototype.init=(e=Howl.prototype.init,function(t){return this._orientation=t.orientation||[1,0,0],this._stereo=t.stereo||null,this._pos=t.pos||null,this._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},this._onstereo=t.onstereo?[{fn:t.onstereo}]:[],this._onpos=t.onpos?[{fn:t.onpos}]:[],this._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,n){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"stereo",action:function(){o.stereo(e,n)}}),o;var r=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===n){if("number"!=typeof e)return o._stereo;o._stereo=e,o._pos=[e,0,0]}for(var i=o._getSoundIds(n),a=0;a<i.length;a++){var s=o._soundById(i[a]);if(s){if("number"!=typeof e)return s._stereo;s._stereo=e,s._pos=[e,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",s._panner&&s._panner.pan||t(s,r),"spatial"===r?void 0!==s._panner.positionX?(s._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),s._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),s._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):s._panner.setPosition(e,0,0):s._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),o._emit("stereo",s._id)}}return o},Howl.prototype.pos=function(e,n,o,r){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"pos",action:function(){i.pos(e,n,o,r)}}),i;if(n="number"!=typeof n?0:n,o="number"!=typeof o?-.5:o,void 0===r){if("number"!=typeof e)return i._pos;i._pos=[e,n,o]}for(var a=i._getSoundIds(r),s=0;s<a.length;s++){var u=i._soundById(a[s]);if(u){if("number"!=typeof e)return u._pos;u._pos=[e,n,o],u._node&&(u._panner&&!u._panner.pan||t(u,"spatial"),void 0!==u._panner.positionX?(u._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),u._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),u._panner.positionZ.setValueAtTime(o,Howler.ctx.currentTime)):u._panner.setPosition(e,n,o)),i._emit("pos",u._id)}}return i},Howl.prototype.orientation=function(e,n,o,r){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"orientation",action:function(){i.orientation(e,n,o,r)}}),i;if(n="number"!=typeof n?i._orientation[1]:n,o="number"!=typeof o?i._orientation[2]:o,void 0===r){if("number"!=typeof e)return i._orientation;i._orientation=[e,n,o]}for(var a=i._getSoundIds(r),s=0;s<a.length;s++){var u=i._soundById(a[s]);if(u){if("number"!=typeof e)return u._orientation;u._orientation=[e,n,o],u._node&&(u._panner||(u._pos||(u._pos=i._pos||[0,0,-.5]),t(u,"spatial")),void 0!==u._panner.orientationX?(u._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),u._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),u._panner.orientationZ.setValueAtTime(o,Howler.ctx.currentTime)):u._panner.setOrientation(e,n,o)),i._emit("orientation",u._id)}}return i},Howl.prototype.pannerAttr=function(){var e,n,o,r=arguments;if(!this._webAudio)return this;if(0===r.length)return this._pannerAttr;if(1===r.length){if("object"!=typeof r[0])return(o=this._soundById(parseInt(r[0],10)))?o._pannerAttr:this._pannerAttr;e=r[0],void 0===n&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),this._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:this._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:this._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:this._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:this._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:this._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:this._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:this._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:this._panningModel})}else 2===r.length&&(e=r[0],n=parseInt(r[1],10));for(var i=this._getSoundIds(n),a=0;a<i.length;a++)if(o=this._soundById(i[a])){var s=o._pannerAttr;s={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:s.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:s.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:s.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:s.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:s.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:s.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:s.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:s.panningModel};var u=o._panner;u?(u.coneInnerAngle=s.coneInnerAngle,u.coneOuterAngle=s.coneOuterAngle,u.coneOuterGain=s.coneOuterGain,u.distanceModel=s.distanceModel,u.maxDistance=s.maxDistance,u.refDistance=s.refDistance,u.rolloffFactor=s.rolloffFactor,u.panningModel=s.panningModel):(o._pos||(o._pos=this._pos||[0,0,-.5]),t(o,"spatial"))}return this},Sound.prototype.init=function(e){return function(){var t=this._parent;this._orientation=t._orientation,this._stereo=t._stereo,this._pos=t._pos,this._pannerAttr=t._pannerAttr,e.call(this),this._stereo?t.stereo(this._stereo):this._pos&&t.pos(this._pos[0],this._pos[1],this._pos[2],this._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this._parent;return this._orientation=t._orientation,this._stereo=t._stereo,this._pos=t._pos,this._pannerAttr=t._pannerAttr,this._stereo?t.stereo(this._stereo):this._pos?t.pos(this._pos[0],this._pos[1],this._pos[2],this._id):this._panner&&(this._panner.disconnect(0),this._panner=void 0,t._refreshBuffer(this)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}();
},{}],"dYuF":[function(require,module,exports) {
module.exports={"audio/midi":["mid","midi","kar","rmi"],"audio/mp4":["mp4a","m4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx"],"audio/webm":["weba"],"audio/x-matroska":["mka"],"audio/x-mpegurl":["m3u"],"audio/wav":["wav"],"video/3gpp":["3gp"],"video/3gpp2":["3g2"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"],"video/x-f4v":["f4v"],"video/x-fli":["fli"],"video/x-flv":["flv"],"video/x-m4v":["m4v"],"video/x-matroska":["mkv","mk3d","mks"]};
},{}],"QtNt":[function(require,module,exports) {
var e=require("./mime-types.json"),r={};Object.keys(e).forEach(function(n){e[n].forEach(function(e){r[e]=n})}),module.exports=function(e){if(!e)throw new TypeError("must specify extension string");return 0===e.indexOf(".")&&(e=e.substring(1)),r[e.toLowerCase()]};
},{"./mime-types.json":"dYuF"}],"JFDM":[function(require,module,exports) {
var e,r=require("browser-media-mime-type");function t(t){if(!t)throw new TypeError("src cannot be empty");var n;if("function"==typeof t.getAttribute)n=t.getAttribute("type");else if("string"==typeof t){var i=o(t);i&&(n=r(i))}else n=t.type;if(!n)return!0;e||(e=new window.Audio);var a=e.canPlayType(n).replace(/no/,"");return Boolean(a)}function n(e){var r=new Error("This browser does not support any of the following sources:\n    "+e.join(", ")+"\nTry using an array of OGG, MP3 and WAV.");return r.type="AUDIO_FORMAT",r}function o(e){var r=e.lastIndexOf(".");if(!(r<=0||r===e.length-1))return e.substring(r+1)}module.exports=t,module.exports.createError=n;
},{"browser-media-mime-type":"QtNt"}],"ZYVA":[function(require,module,exports) {
function o(){return new(window.AudioContext||window.webkitAudioContext)}module.exports=o;
},{}],"J3Xk":[function(require,module,exports) {
var global = arguments[3];
var e,d=arguments[3];e="undefined"!=typeof window?window:void 0!==d?d:"undefined"!=typeof self?self:{},module.exports=e;
},{}],"TfiX":[function(require,module,exports) {
module.exports=t;var o=Object.prototype.toString;function t(t){if(!t)return!1;var n=o.call(t);return"[object Function]"===n||"function"==typeof t&&"[object RegExp]"!==n||"undefined"!=typeof window&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)}
},{}],"spMt":[function(require,module,exports) {
var r=function(r){return r.replace(/^\s+|\s+$/g,"")},e=function(r){return"[object Array]"===Object.prototype.toString.call(r)};module.exports=function(t){if(!t)return{};for(var n={},o=r(t).split("\n"),i=0;i<o.length;i++){var c=o[i],u=c.indexOf(":"),l=r(c.slice(0,u)).toLowerCase(),s=r(c.slice(u+1));void 0===n[l]?n[l]=s:e(n[l])?n[l].push(s):n[l]=[n[l],s]}return n};
},{}],"YxsI":[function(require,module,exports) {
module.exports=o;var r=Object.prototype.hasOwnProperty;function o(){for(var o={},t=0;t<arguments.length;t++){var e=arguments[t];for(var a in e)r.call(e,a)&&(o[a]=e[a])}return o}
},{}],"sjC2":[function(require,module,exports) {
"use strict";var e=require("global/window"),t=require("is-function"),r=require("parse-headers"),n=require("xtend");function o(e,t){for(var r=0;r<e.length;r++)t(e[r])}function s(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function u(e,r,o){var s=e;return t(r)?(o=r,"string"==typeof e&&(s={uri:e})):s=n(r,{uri:e}),s.callback=o,s}function a(e,t,r){return i(t=u(e,t,r))}function i(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,n=function(r,n,o){t||(t=!0,e.callback(r,n,o))};function o(){var e=void 0;if(e=l.response?l.response:l.responseText||d(l),R)try{e=JSON.parse(e)}catch(t){}return e}function u(e){return clearTimeout(f),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,n(e,X)}function i(){if(!c){var t;clearTimeout(f),t=e.useXDR&&void 0===l.status?200:1223===l.status?204:l.status;var s=X,u=null;return 0!==t?(s={body:o(),statusCode:t,method:m,headers:{},url:h,rawRequest:l},l.getAllResponseHeaders&&(s.headers=r(l.getAllResponseHeaders()))):u=new Error("Internal XMLHttpRequest Error"),n(u,s,s.body)}}var p,c,l=e.xhr||null;l||(l=e.cors||e.useXDR?new a.XDomainRequest:new a.XMLHttpRequest);var f,h=l.url=e.uri||e.url,m=l.method=e.method||"GET",y=e.body||e.data,w=l.headers=e.headers||{},q=!!e.sync,R=!1,X={body:void 0,headers:{},statusCode:0,method:m,url:h,rawRequest:l};if("json"in e&&!1!==e.json&&(R=!0,w.accept||w.Accept||(w.Accept="application/json"),"GET"!==m&&"HEAD"!==m&&(w["content-type"]||w["Content-Type"]||(w["Content-Type"]="application/json"),y=JSON.stringify(!0===e.json?y:e.json))),l.onreadystatechange=function(){4===l.readyState&&setTimeout(i,0)},l.onload=i,l.onerror=u,l.onprogress=function(){},l.onabort=function(){c=!0},l.ontimeout=u,l.open(m,h,!q,e.username,e.password),q||(l.withCredentials=!!e.withCredentials),!q&&e.timeout>0&&(f=setTimeout(function(){if(!c){c=!0,l.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",u(e)}},e.timeout)),l.setRequestHeader)for(p in w)w.hasOwnProperty(p)&&l.setRequestHeader(p,w[p]);else if(e.headers&&!s(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(l.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(l),l.send(y||null),l}function d(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(r){}return null}function p(){}module.exports=a,module.exports.default=a,a.XMLHttpRequest=e.XMLHttpRequest||p,a.XDomainRequest="withCredentials"in new a.XMLHttpRequest?a.XMLHttpRequest:e.XDomainRequest,o(["get","put","post","patch","head","delete"],function(e){a["delete"===e?"del":e]=function(t,r,n){return(r=u(t,r,n)).method=e.toUpperCase(),i(r)}});
},{"global/window":"J3Xk","is-function":"TfiX","parse-headers":"spMt","xtend":"YxsI"}],"MIaS":[function(require,module,exports) {
var e=require("events").EventEmitter;function t(t){var n=new e,a=!1;if(t.attachEvent)return t.attachEvent("onreadystatechange",o),n;function r(e){var t=e.lengthComputable?e.loaded/e.total:0;a||n.emit("data",t,e.total||null),a=1===t}function o(e){("load"===e.type||/^(ready|complete)$/g.test((e.currentTarget||e.srcElement).readyState))&&(a||(t.removeEventListener?(t.removeEventListener("load",o,!1),t.removeEventListener("progress",r,!1)):t.detatchEvent&&t.detatchEvent("onreadystatechange",o),n.emit("data",1,e.total||null),n.emit("done"),a=!0))}return t.addEventListener("load",o,!1),t.addEventListener("progress",r,!1),n}module.exports=t;
},{"events":"SbQi"}],"lUgl":[function(require,module,exports) {
var r=require("xhr"),e=require("xhr-progress");function o(o,t,n,u,a){var i=r({uri:t,responseType:"arraybuffer"},function(r,e,u){if(/^2/.test(e.statusCode)||(r=new Error("status code "+e.statusCode+" requesting "+t)),r)return n(r);!function(r){a(),o.decodeAudioData(r,function(r){n(null,r)},function(){var r=new Error("Error decoding audio data");r.type="DECODE_AUDIO_DATA",n(r)})}(u)});e(i).on("data",function(r,e){u(r,e)})}module.exports=o;
},{"xhr":"sjC2","xhr-progress":"MIaS"}],"Un0R":[function(require,module,exports) {
module.exports=function(e){"suspended"===e.state&&"function"==typeof e.resume&&e.resume()};
},{}],"O4yq":[function(require,module,exports) {
var process = require("process");
var e=require("process"),n=require("./can-play-src"),r=require("./audio-context"),t=require("./xhr-audio"),o=require("events").EventEmitter,u=require("right-now"),i=require("./resume-context");function c(c,f){f=f||{};var a,l,s,p=new o,m=f.context||r(),d=m.createGain(),b=null,g=null,v=0,y=!1,x=f.loop;p.play=function(){if(!y){y=!0,!1!==f.autoResume&&i(p.context),S(),(a=m.createBufferSource()).connect(p.node),a.onended=A,l&&(a.buffer=l),x&&(a.loop=!0,"number"==typeof f.loopStart&&(a.loopStart=f.loopStart),"number"==typeof f.loopEnd&&(a.loopEnd=f.loopEnd)),s&&v>s&&(v%=s);var e=v;a.start(0,e),b=u()}},p.pause=function(){y&&(y=!1,a.onended=null,a.stop(0),g=u(),v+=(g-b)/1e3)},p.stop=function(){p.pause(),A()},p.dispose=function(){S(),l=null},p.node=d,p.context=m,Object.defineProperties(p,{duration:{enumerable:!0,configurable:!0,get:function(){return s}},playing:{enumerable:!0,configurable:!0,get:function(){return y}},buffer:{enumerable:!0,configurable:!0,get:function(){return l}},volume:{enumerable:!0,configurable:!0,get:function(){return d.gain.value},set:function(e){d.gain.value=e}}}),"number"==typeof f.volume&&(p.volume=f.volume);var q=Array.isArray(c)?c:[c];if((q=q.filter(Boolean)).some(n)){var E=q.filter(n)[0];"function"==typeof E.getAttribute?E=E.getAttribute("src"):"string"==typeof E.src&&(E=E.src),function(e){t(m,e,function(e,n){if(e)return p.emit("error",e);l=n,a&&(a.buffer=l),s=l.duration,d.buffer=l,p.emit("load")},function(e,n){p.emit("progress",e,n)},function(){p.emit("decoding")})}(E)}else e.nextTick(function(){p.emit("error",n.createError(q))});return p;function A(){p.emit("end"),y=!1,v=0}function S(){a&&a.disconnect()}}module.exports=c;
},{"./can-play-src":"JFDM","./audio-context":"ZYVA","./xhr-audio":"lUgl","events":"SbQi","right-now":"ksES","./resume-context":"Un0R","process":"YOvR"}],"SJKS":[function(require,module,exports) {
"use strict";module.exports=function(t){return"object"==typeof t&&null!==t};
},{}],"pMfI":[function(require,module,exports) {
"use strict";module.exports=function(r){if(null==r)return!1;var t=Object(r);return t===t.window};
},{}],"CFgW":[function(require,module,exports) {
var e=require("is-object"),o=require("is-window");function n(n){return!(!e(n)||!o(window)||"function"!=typeof window.Node)&&("number"==typeof n.nodeType&&"string"==typeof n.nodeName)}module.exports=n;
},{"is-object":"SJKS","is-window":"pMfI"}],"eTXa":[function(require,module,exports) {
var t=require("is-dom"),e=require("browser-media-mime-type");function r(t,e,r){r=r||{},Array.isArray(e)||(e=[e]);var u=r.element||document.createElement(t);return r.loop&&u.setAttribute("loop","loop"),r.muted&&u.setAttribute("muted","muted"),r.autoplay&&u.setAttribute("autoplay","autoplay"),r.controls&&u.setAttribute("controls","controls"),r.crossOrigin&&u.setAttribute("crossorigin",r.crossOrigin),r.preload&&u.setAttribute("preload",r.preload),r.poster&&u.setAttribute("poster",r.poster),void 0!==r.volume&&u.setAttribute("volume",r.volume),(e=e.filter(Boolean)).forEach(function(t){u.appendChild(o(t))}),u}function o(r){if(t(r))return r;if("string"==typeof r&&(r={src:r}).src){var o=u(r.src);o&&(r.type=e(o))}var i=document.createElement("source");return r.src&&i.setAttribute("src",r.src),r.type&&i.setAttribute("type",r.type),i}function u(t){var e=t.lastIndexOf(".");return e<=0||e===t.length-1?null:t.substring(e+1)}module.exports.video=r.bind(null,"video"),module.exports.audio=r.bind(null,"audio");
},{"is-dom":"CFgW","browser-media-mime-type":"QtNt"}],"YOwE":[function(require,module,exports) {
"use strict";var r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,e=Object.prototype.propertyIsEnumerable;function n(r){if(null==r)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(r)}function o(){try{if(!Object.assign)return!1;var r=new String("abc");if(r[5]="de","5"===Object.getOwnPropertyNames(r)[0])return!1;for(var t={},e=0;e<10;e++)t["_"+String.fromCharCode(e)]=e;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(r){return t[r]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(r){n[r]=r}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(o){return!1}}module.exports=o()?Object.assign:function(o,c){for(var a,i,s=n(o),f=1;f<arguments.length;f++){for(var u in a=Object(arguments[f]))t.call(a,u)&&(s[u]=a[u]);if(r){i=r(a);for(var b=0;b<i.length;b++)e.call(a,i[b])&&(s[i[b]]=a[i[b]])}}return s};
},{}],"h4d1":[function(require,module,exports) {
function e(e,n,t){e.addEventListener(n,function o(i){e.removeEventListener(n,o,!1),t(i,e)},!1)}module.exports=e;
},{}],"EcVh":[function(require,module,exports) {
var process = require("process");
var e=require("process"),r=require("events").EventEmitter,n=require("simple-media-element").audio,t=require("object-assign"),o=require("./resume-context"),i=require("./audio-context"),u=require("./can-play-src"),a=require("./event-add-once");function c(c,l){l=t({},l);var m=new r;l.element||(l.element=new window.Audio);var d=l.volume;delete l.volume;var s=n(c,l),f=l.context||i(),p=f.createGain();f.createMediaElementSource(s).connect(p),s.addEventListener("ended",function(){m.emit("end")});var v=l.loopStart,g=l.loopEnd,y="number"==typeof v&&isFinite(v),b="number"==typeof g&&isFinite(g),E=!1;(y||b)&&window.requestAnimationFrame(function e(){if("number"==typeof s.duration){var r=s.currentTime,n=b?Math.min(s.duration,g):s.duration;r>(v||0)&&(E=!0),y&&E&&r<v&&(s.currentTime=v),r>=n&&b&&(s.currentTime=y?v:0),window.requestAnimationFrame(e)}}),m.element=s,m.context=f,m.node=p,m.pause=s.pause.bind(s),m.play=function(){return!1!==l.autoResume&&o(m.context),s.play()},m.dispose=function(){},m.stop=function(){var e=m.playing;s.pause(),s.currentTime=0,E=!1,e&&m.emit("end")},Object.defineProperties(m,{duration:{enumerable:!0,configurable:!0,get:function(){return s.duration}},currentTime:{enumerable:!0,configurable:!0,get:function(){return s.currentTime}},playing:{enumerable:!0,configurable:!0,get:function(){return!s.paused}},volume:{enumerable:!0,configurable:!0,get:function(){return p.gain.value},set:function(e){p.gain.value=e}}}),"number"==typeof d&&(m.volume=d);var w=Array.isArray(c)?c:[c];return(w=w.filter(Boolean)).some(u)?function(){var r=Array.prototype.slice.call(s.children),n=r.length,t=!1,o=function(e,i){t||(n--,console.warn("Error loading source: "+i.getAttribute("src")),n<=0&&(t=!0,r.forEach(function(e){e.removeEventListener("error",o,!1)}),m.emit("error",new Error("Could not play any of the supplied sources"))))},i=function(){m.emit("load")};s.readyState>=s.HAVE_ENOUGH_DATA?e.nextTick(i):(a(s,"canplay",i),a(s,"error",function(e){m.emit(new Error("Unknown error while loading <audio>"))}),r.forEach(function(e){a(e,"error",o)}));s.load()}():e.nextTick(function(){m.emit("error",u.createError(w))}),m}module.exports=c;
},{"events":"SbQi","simple-media-element":"eTXa","object-assign":"YOwE","./resume-context":"Un0R","./audio-context":"ZYVA","./can-play-src":"JFDM","./event-add-once":"h4d1","process":"YOvR"}],"lipe":[function(require,module,exports) {
var r=require("./lib/buffer-source"),e=require("./lib/media-source");function u(u,i){if(!u)throw new TypeError("must specify a src parameter");return(i=i||{}).buffer?r(u,i):e(u,i)}module.exports=u;
},{"./lib/buffer-source":"O4yq","./lib/media-source":"EcVh"}],"czFB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=k;var e=f(require("../tags")),t=f(require("three")),o=f(require("../util/math")),r=g(require("../assets/audio/*.{mp3,ogg}")),n=g(require("../util/documentVisibility")),i=require("howler"),s=g(require("web-audio-player")),a=g(require("../util/Random")),u=g(require("right-now")),l=require("../util/addFrameTasks"),d=g(require("../util/query-string")),c=g(require("../config")),p=require("../util/stores");function g(e){return e&&e.__esModule?e:{default:e}}function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(m=function(e){return e?o:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var o=m(t);if(o&&o.has(e))return o.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=n?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(r,i,s):r[i]=e[i]}return r.default=e,o&&o.set(e,r),r}const v=Boolean((0,c.default)().native),y=!1,h=v,w=!0,q=!1,T={volume:.6};Object.keys(r.default).forEach(e=>{const{mp3:t,ogg:o}=r.default[e],n=[t].filter(Boolean);r.default[e]=n});const b=window.AudioContext||window.webkitAudioContext,A=e=>{if("suspended"===e.state&&"function"==typeof e.resume)return e.resume()};function k(o){if(!b)return void console.log("No audio context, audio system skipped");const n=o.view([e.WillTriggerAudio,e.Object3D]),s=o.findTag(e.InputGestureEmitter);/(iOS|iPad|iPod|iPhone)/i.test(navigator.userAgent);p.audioState.subscribe(({muted:e,visible:t})=>{const o=e||!t;i.Howler.mute(o)});const u=o.listen(e.OriginTreeIntroSequenceStarted),c=(0,a.default)();let g=!1;const m=o.listen(e.CollectTokenOrb),f=["a3","c3","c4","d3","d4","e3","g3"],v=c.deck(f),y={},w={forest:{biome:"forest",musicId:"music1",natureId:"nature1"},grasslands:{biome:"grasslands",musicId:"music2",natureId:"nature2"},tundra:{biome:"tundra",musicId:d.default.musicA?"music3a":"music3b",natureId:"nature3"}},A=function(t){const n=t.map(({query:e,envelope:t,assets:n,options:s,condition:a,deck:u=!1,removing:l=!1})=>{const d=o.listen(e),p={...T,...s},g=!1!==p.preload,m=n.map(e=>{const t=r.default[e],o=new i.Howl({...p,src:t,autoplay:!1,preload:g});return o});let f=g;return{deck:u?c.deck(m):null,query:e,removing:l,condition:a,players:m,load(){f||(f=!0,m.forEach(e=>e.load()))},listener:d}});return{listeners:n,update(t=0){const r=!o.findTag(e.HideCharacter)&&!o.findTag(e.AnimateOutCharacter);n.forEach(e=>{const{listener:t,needsCharacter:o=!0,condition:n,players:i,removing:a=!1}=e,u=a?t.removing:t.added;if(t.changed&&u.length>0){if(o&&!r)return;n?u.forEach(t=>{n(t,e)&&s(e)}):s(e)}})}};function s(e){e.load();const t=e.deck?e.deck.next():c.pick(e.players);t.play()}}([{query:e.CollectedToken,assets:["writing-01","writing-02","writing-03"],options:{volume:.5}},{query:e.HaikuCardSaved,assets:["haiku-card"]},{query:e.HaikuCardShown,assets:["score-haiku"],options:{volume:1}},{query:e.UserHitAudioTrigger,condition:t=>{return"tree"===t.get(e.UserHitAudioTrigger).type},options:{volume:.5,allowMultiple:!0},assets:["leaves1","leaves2","leaves3","leaves4"]},{needsCharacter:!1,query:e.TriggerTreeTransitionAudio,options:{volume:.5,preload:!1},assets:["tree-transition-0"]},!q&&{query:e.UserHitAudioTrigger,condition:t=>{return"ice"===t.get(e.UserHitAudioTrigger).type},options:{volume:.5,allowMultiple:!1,preload:!1,playthrough:!0},assets:["ice-01","ice-02","ice-03"]},!q&&{query:e.UserHitAudioTrigger,condition:t=>{return"water"===t.get(e.UserHitAudioTrigger).type},envelope:{attack:.2,sustain:1,volume:[.4,.75],release:.5,delay:0},options:{volume:.5,preload:!1,allowMultiple:!0},assets:["water-01","water-02"]},!q&&{query:e.UserHitAudioTrigger,condition:t=>{return"leaf"===t.get(e.UserHitAudioTrigger).type},envelope:{attack:.2,sustain:.1,volume:[.4,.75],release:.5,delay:0},options:{volume:.11,preload:!1,allowMultiple:!0},assets:["grass-push1","grass-push2"]},{query:e.WaitingForBiomeResolution,assets:["collect-poem"],options:{preload:!1}},!q&&{query:e.HatTipWindLineSound,condition:e=>c.chance(.5),assets:["movement-forest"],options:{volume:.2,allowMultiple:!0}},{query:e.TutorialBarrenGround,removing:!0,assets:["score-start"],options:{volume:1}},{query:e.TokenIsCollecting,assets:["reveal01"],options:{volume:1}},{query:e.CompassVisible,assets:["reveal02"],options:{volume:.75}},{query:e.ButtonClick,assets:["click"],options:{volume:.75,preload:!0}},{query:e.JournalOpen,assets:["journal-open"],options:{volume:.5,preload:!1}},{query:e.AnimalSound,condition:t=>"fish"===t.get(e.AnimalSound),assets:["fish"],options:{volume:.45,preload:!1}},{query:e.AnimalSound,condition:t=>c.chance(.5)&&"birdChirp"===t.get(e.AnimalSound),assets:["bird0"],options:{volume:.4,preload:!1}},{query:e.AnimalSound,condition:t=>"birdFlap"===t.get(e.AnimalSound),assets:["birdflap"],options:{volume:.25,preload:!1}},{query:e.AnimalSound,condition:t=>"butterfly"===t.get(e.AnimalSound),assets:["butterfly"],options:{volume:1,preload:!1}},{needsCharacter:!1,query:e.ShowBiomeResolution,assets:["score-restore"],options:{volume:1,preload:!1}},{query:e.TransitionToNextBiome,condition:e=>!0,assets:["score-transition"],options:{volume:1,preload:!1}},{query:e.EndGameState,assets:["score-outro"],options:{volume:1,preload:!1}},,{query:e.FlashSound,assets:["flash-build-up"],options:{volume:.25,preload:!1}}].filter(Boolean)),k=new t.Vector2,H=new t.Vector3,S=new t.Vector2;let O,E,C=!1,x=0;const U=o.view(e.ActiveEnvironmentState),I=o.listen(e.TokenIsCollecting);h?(0,l.addFrameTask)(()=>D()):s.once("tap",()=>{D()});const j=o.listen(e.Raining);let B,M;const P=o.listen(e.FoxPurring);let F,L;const W=o.listen(e.FoxHm);let _;const V=e=>new i.Howl({volume:.55,src:r.default[e]});return function(t){if(!g)return;if(j.changed&&(j.added.length?(B||(B=new i.Howl({src:r.default.rain,loop:!0,volume:.25})),clearTimeout(M),B.stop(),B.play(),B.fade(0,.25,1e3)):j.removing.length&&B&&(B.fade(.25,0,1e3),M=setTimeout(()=>B.stop(),1e3))),P.changed&&(P.added.length?(F||(F=new i.Howl({src:r.default.foxpurring,loop:!0,volume:.18})),clearTimeout(L),F.stop(),F.play(),F.fade(0,.18,1e3)):P.removing.length&&F&&(F.fade(.18,0,1e3),L=setTimeout(()=>F.stop(),1e3))),W.changed&&(1==W.added.length?(_||(_=new i.Howl({src:r.default.foxhm,loop:!1,volume:.4})),_.stop(),_.play(),_.fade(0,.4,1)):P.removing.length&&_&&_.stop()),u.changed){const t=Boolean(o.findTag(e.OriginTreeIntroSequenceStarted));E&&E.players&&E.ids&&E.players.forEach(e=>{e.fade(t?1:0,t?0:1,500)})}const s=U.length?U[0].get(e.EnvironmentState):null,a=s&&s.name;if(U.length){if(a!==O){const e=w[a];E&&function(e){e&&e.players&&(e.players.forEach(e=>{e.stop()}),e.ids=null);E=null}(E),R(e),f.forEach(e=>{const t=`note-${a}-${e}`;t in y||(y[t]=V(t))})}O=a}if(C&&(x+=t)>=.1&&(C=!1,x=0),I.added.length>0&&v.reset(),m.added.length>0){const e=v.next(),t=`note-${a}-${e}`;t in y||(y[t]=V(t)),y[t].play()}A.update();const l=o.findTag(e.UserCharacter).position;k.set(l.x,l.z);for(let o=0;o<n.length;o++){const t=n[o],r=t.get(e.Object3D);if(r.visible){r.getWorldPosition(H),S.set(H.x,H.z);const o=2;if(k.distanceToSquared(S)<=o*o){if(!C&&!t.has(e.UserHitAudioTrigger)){C=!0,x=0,t.add(e.UserHitAudioTrigger),t.get(e.UserHitAudioTrigger).type="tree"}}else t.has(e.UserHitAudioTrigger)&&t.remove(e.UserHitAudioTrigger)}}};function D(){g=!0;let t="forest";if(U.length>0){t=U[0].get(e.EnvironmentState).name}O=t;const o=t in w?w[t]:null;o&&R(o)}function R(e){e&&(e.players||(e.players=[e.natureId,e.musicId].map(e=>new i.Howl({src:r.default[e],loop:!0,html5:!0}))),e.players.forEach(e=>e.stop()),e.ids=e.players.map(e=>e.play())),E=e}}function H(e){var t=function(o){document.removeEventListener("touchstart",t),document.removeEventListener("touchend",t),window.removeEventListener("mousedown",t),(async()=>{const t=A(e);t&&await t;var o=e.createBuffer(1,1,22050),r=e.createBufferSource();r.buffer=o,r.connect(e.destination),r.start?r.start(0):r.play?r.play(0):r.noteOn&&r.noteOn(0)})()};document.addEventListener("touchstart",t),document.addEventListener("touchend",t),window.addEventListener("mousedown",t)}
},{"../tags":"injP","three":"IV0r","../util/math":"Ov1X","../assets/audio/*.{mp3,ogg}":"ereN","../util/documentVisibility":"so68","howler":"UTMB","web-audio-player":"lipe","../util/Random":"LMfK","right-now":"ksES","../util/addFrameTasks":"l7a6","../util/query-string":"Bj6B","../config":"nZps","../util/stores":"G6DW"}],"Ghrr":[function(require,module,exports) {
"use strict";var t=Math.abs,e=Math.min;function r(r,a,n,s){var u=t(r-a);return u<=n||(u<=s*e(t(r),t(a))||r===a)}r.FLT_EPSILON=1.1920929e-7,r.DBL_EPSILON=2.220446049250313e-16,module.exports=r;
},{}],"i40d":[function(require,module,exports) {
var e=require("an-array"),r=require("almost-equal");module.exports=function(t,n,u,a){return!!(t&&n&&e(t)&&e(n))&&(t.length===n.length&&("number"!=typeof u&&(u=r.FLT_EPSILON),"number"!=typeof a&&(a=u),Array.prototype.slice.call(t).every(function(e,t){var o=n[t];return e===o||r(e,o,u,a)})))};
},{"an-array":"iS1y","almost-equal":"Ghrr"}],"d3f1":[function(require,module,exports) {
"use strict";function e(e,t,x){x=x||2;var i,u,v,y,o,p,a,l=t&&t.length,h=l?t[0]*x:e.length,s=n(e,0,h,x,!0),c=[];if(!s||s.next===s.prev)return c;if(l&&(s=f(e,t,s,x)),e.length>80*x){i=v=e[0],u=y=e[1];for(var Z=x;Z<h;Z+=x)(o=e[Z])<i&&(i=o),(p=e[Z+1])<u&&(u=p),o>v&&(v=o),p>y&&(y=p);a=0!==(a=Math.max(v-i,y-u))?1/a:0}return r(s,c,x,i,u,a),c}function n(e,n,t,r,x){var i,u;if(x===D(e,n,t,r)>0)for(i=n;i<t;i+=r)u=A(i,e[i],e[i+1],u);else for(i=t-r;i>=n;i-=r)u=A(i,e[i],e[i+1],u);return u&&w(u,u.next)&&(B(u),u=u.next),u}function t(e,n){if(!e)return e;n||(n=e);var t,r=e;do{if(t=!1,r.steiner||!w(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(B(r),(r=n=r.prev)===r.next)break;t=!0}}while(t||r!==n);return n}function r(e,n,f,y,o,p,a){if(e){!a&&p&&l(e,y,o,p);for(var h,s,c=e;e.prev!==e.next;)if(h=e.prev,s=e.next,p?i(e,y,o,p):x(e))n.push(h.i/f),n.push(e.i/f),n.push(s.i/f),B(e),e=s.next,c=s.next;else if((e=s)===c){a?1===a?r(e=u(t(e),n,f),n,f,y,o,p,2):2===a&&v(e,n,f,y,o,p):r(t(e),n,f,y,o,p,1);break}}}function x(e){var n=e.prev,t=e,r=e.next;if(g(n,t,r)>=0)return!1;for(var x=e.next.next;x!==e.prev;){if(Z(n.x,n.y,t.x,t.y,r.x,r.y,x.x,x.y)&&g(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function i(e,n,t,r){var x=e.prev,i=e,u=e.next;if(g(x,i,u)>=0)return!1;for(var v=x.x<i.x?x.x<u.x?x.x:u.x:i.x<u.x?i.x:u.x,f=x.y<i.y?x.y<u.y?x.y:u.y:i.y<u.y?i.y:u.y,y=x.x>i.x?x.x>u.x?x.x:u.x:i.x>u.x?i.x:u.x,o=x.y>i.y?x.y>u.y?x.y:u.y:i.y>u.y?i.y:u.y,p=s(v,f,n,t,r),a=s(y,o,n,t,r),l=e.prevZ,h=e.nextZ;l&&l.z>=p&&h&&h.z<=a;){if(l!==e.prev&&l!==e.next&&Z(x.x,x.y,i.x,i.y,u.x,u.y,l.x,l.y)&&g(l.prev,l,l.next)>=0)return!1;if(l=l.prevZ,h!==e.prev&&h!==e.next&&Z(x.x,x.y,i.x,i.y,u.x,u.y,h.x,h.y)&&g(h.prev,h,h.next)>=0)return!1;h=h.nextZ}for(;l&&l.z>=p;){if(l!==e.prev&&l!==e.next&&Z(x.x,x.y,i.x,i.y,u.x,u.y,l.x,l.y)&&g(l.prev,l,l.next)>=0)return!1;l=l.prevZ}for(;h&&h.z<=a;){if(h!==e.prev&&h!==e.next&&Z(x.x,x.y,i.x,i.y,u.x,u.y,h.x,h.y)&&g(h.prev,h,h.next)>=0)return!1;h=h.nextZ}return!0}function u(e,n,r){var x=e;do{var i=x.prev,u=x.next.next;!w(i,u)&&M(i,x,x.next,u)&&k(i,u)&&k(u,i)&&(n.push(i.i/r),n.push(x.i/r),n.push(u.i/r),B(x),B(x.next),x=e=u),x=x.next}while(x!==e);return t(x)}function v(e,n,x,i,u,v){var f=e;do{for(var y=f.next.next;y!==f.prev;){if(f.i!==y.i&&d(f,y)){var o=q(f,y);return f=t(f,f.next),o=t(o,o.next),r(f,n,x,i,u,v),void r(o,n,x,i,u,v)}y=y.next}f=f.next}while(f!==e)}function f(e,r,x,i){var u,v,f,p=[];for(u=0,v=r.length;u<v;u++)(f=n(e,r[u]*i,u<v-1?r[u+1]*i:e.length,i,!1))===f.next&&(f.steiner=!0),p.push(c(f));for(p.sort(y),u=0;u<p.length;u++)o(p[u],x),x=t(x,x.next);return x}function y(e,n){return e.x-n.x}function o(e,n){if(n=p(e,n)){var r=q(n,e);t(n,n.next),t(r,r.next)}}function p(e,n){var t,r=n,x=e.x,i=e.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var v=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(v<=x&&v>u){if(u=v,v===x){if(i===r.y)return r;if(i===r.next.y)return r.next}t=r.x<r.next.x?r:r.next}}r=r.next}while(r!==n);if(!t)return null;if(x===u)return t;var f,y=t,o=t.x,p=t.y,l=1/0;r=t;do{x>=r.x&&r.x>=o&&x!==r.x&&Z(i<p?x:u,i,o,p,i<p?u:x,i,r.x,r.y)&&(f=Math.abs(i-r.y)/(x-r.x),k(r,e)&&(f<l||f===l&&(r.x>t.x||r.x===t.x&&a(t,r)))&&(t=r,l=f)),r=r.next}while(r!==y);return t}function a(e,n){return g(e.prev,e,n.prev)<0&&g(n.next,e,e.next)<0}function l(e,n,t,r){var x=e;do{null===x.z&&(x.z=s(x.x,x.y,n,t,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,h(x)}function h(e){var n,t,r,x,i,u,v,f,y=1;do{for(t=e,e=null,i=null,u=0;t;){for(u++,r=t,v=0,n=0;n<y&&(v++,r=r.nextZ);n++);for(f=y;v>0||f>0&&r;)0!==v&&(0===f||!r||t.z<=r.z)?(x=t,t=t.nextZ,v--):(x=r,r=r.nextZ,f--),i?i.nextZ=x:e=x,x.prevZ=i,i=x;t=r}i.nextZ=null,y*=2}while(u>1);return e}function s(e,n,t,r,x){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-t)*x)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-r)*x)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function c(e){var n=e,t=e;do{(n.x<t.x||n.x===t.x&&n.y<t.y)&&(t=n),n=n.next}while(n!==e);return t}function Z(e,n,t,r,x,i,u,v){return(x-u)*(n-v)-(e-u)*(i-v)>=0&&(e-u)*(r-v)-(t-u)*(n-v)>=0&&(t-u)*(i-v)-(x-u)*(r-v)>=0}function d(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!b(e,n)&&(k(e,n)&&k(n,e)&&j(e,n)&&(g(e.prev,e,n.prev)||g(e,n.prev,n))||w(e,n)&&g(e.prev,e,e.next)>0&&g(n.prev,n,n.next)>0)}function g(e,n,t){return(n.y-e.y)*(t.x-n.x)-(n.x-e.x)*(t.y-n.y)}function w(e,n){return e.x===n.x&&e.y===n.y}function M(e,n,t,r){var x=m(g(e,n,t)),i=m(g(e,n,r)),u=m(g(t,r,e)),v=m(g(t,r,n));return x!==i&&u!==v||(!(0!==x||!z(e,t,n))||(!(0!==i||!z(e,r,n))||(!(0!==u||!z(t,e,r))||!(0!==v||!z(t,n,r)))))}function z(e,n,t){return n.x<=Math.max(e.x,t.x)&&n.x>=Math.min(e.x,t.x)&&n.y<=Math.max(e.y,t.y)&&n.y>=Math.min(e.y,t.y)}function m(e){return e>0?1:e<0?-1:0}function b(e,n){var t=e;do{if(t.i!==e.i&&t.next.i!==e.i&&t.i!==n.i&&t.next.i!==n.i&&M(t,t.next,e,n))return!0;t=t.next}while(t!==e);return!1}function k(e,n){return g(e.prev,e,e.next)<0?g(e,n,e.next)>=0&&g(e,e.prev,n)>=0:g(e,n,e.prev)<0||g(e,e.next,n)<0}function j(e,n){var t=e,r=!1,x=(e.x+n.x)/2,i=(e.y+n.y)/2;do{t.y>i!=t.next.y>i&&t.next.y!==t.y&&x<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next}while(t!==e);return r}function q(e,n){var t=new C(e.i,e.x,e.y),r=new C(n.i,n.x,n.y),x=e.next,i=n.prev;return e.next=n,n.prev=e,t.next=x,x.prev=t,r.next=t,t.prev=r,i.next=r,r.prev=i,r}function A(e,n,t,r){var x=new C(e,n,t);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function B(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function C(e,n,t){this.i=e,this.x=n,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function D(e,n,t,r){for(var x=0,i=n,u=t-r;i<t;i+=r)x+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return x}module.exports=e,module.exports.default=e,e.deviation=function(e,n,t,r){var x=n&&n.length,i=x?n[0]*t:e.length,u=Math.abs(D(e,0,i,t));if(x)for(var v=0,f=n.length;v<f;v++){var y=n[v]*t,o=v<f-1?n[v+1]*t:e.length;u-=Math.abs(D(e,y,o,t))}var p=0;for(v=0;v<r.length;v+=3){var a=r[v]*t,l=r[v+1]*t,h=r[v+2]*t;p+=Math.abs((e[a]-e[h])*(e[l+1]-e[a+1])-(e[a]-e[l])*(e[h+1]-e[a+1]))}return 0===u&&0===p?0:Math.abs((p-u)/u)},e.flatten=function(e){for(var n=e[0][0].length,t={vertices:[],holes:[],dimensions:n},r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)for(var u=0;u<n;u++)t.vertices.push(e[x][i][u]);x>0&&(r+=e[x-1].length,t.holes.push(r))}return t};
},{}],"N4w3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.multiLineSegments2D=d,exports.multiPoly2D=h,exports.filledPoly2D=w,exports.filledMultiPoly2D=m,exports.multiPoints2D=g,exports.circleHelper2D=v,exports.boundsHelper2D=y,exports.curveHelper=M,exports.spheresAlongCurve=x,exports.pointsToSpheres=P,exports.animatedWindLineCurve=b;var e=u(require("../tags")),t=u(require("three")),n=l(require("array-almost-equal")),r=require("./three-util"),o=l(require("bound-points")),a=require("canvas-sketch-util/math"),i=l(require("earcut")),s=u(require("./geometry"));function l(e){return e&&e.__esModule?e:{default:e}}function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(r,a,i):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}let f,p;function d(e,n={}){const r=new t.Geometry,o=new t.LineSegments(r,new t.LineBasicMaterial({color:"white",...n}));return o.updateData=a,e&&a(e),o;function a(e){r.vertices.length=0,e.forEach(e=>{e.forEach(e=>{r.vertices.push(new t.Vector3(e[0],0,e[1]))})}),r.verticesNeedUpdate=!0}}function h(e=[],r={}){const{closed:o=!0}=r,a=new t.Geometry,i=new t.LineSegments(a,new t.LineBasicMaterial({color:"white",...r}));return i.updateData=s,e&&s(e),i;function s(e){a.vertices.length=0,e.forEach(e=>{!(0,n.default)(e[0],e[e.length-1])&&o&&(e=e.slice()).push(e[0]);for(let n=0;n<e.length-1;n++){const r=e[n],o=e[n+1];a.vertices.push(new t.Vector3(r[0],0,r[1])),a.vertices.push(new t.Vector3(o[0],0,o[1]))}}),a.verticesNeedUpdate=!0}}function w(e=[],n={}){const{vertices:r,holes:s,dimensions:l}=i.default.flatten([e]),c=(0,i.default)(r,s,l),[u,f]=n.bounds||(0,o.default)(e),p=new t.BufferGeometry;p.setIndex(new t.Uint16BufferAttribute(c,1)),p.setAttribute("position",new t.Float32BufferAttribute(e.map(e=>[e[0],0,e[1]]).flat(1/0),3)),p.setAttribute("uv",new t.Float32BufferAttribute(e.map(e=>[(0,a.inverseLerp)(u[0],f[0],e[0]),(0,a.inverseLerp)(u[1],f[1],e[1])]).flat(1/0),2));const d={...n};return delete d.bounds,new t.Mesh(p,new t.MeshBasicMaterial({...d,side:t.DoubleSide}))}function m(e=[],r={}){const{closed:o=!0,color:a="white"}=r,i=new t.Geometry,s=new t.Mesh(i,new t.MeshBasicMaterial({color:a,side:t.DoubleSide,...r}));return s.updateData=l,e&&l(e),s;function l(e){i.vertices.length=0,polygons.forEach(e=>{!(0,n.default)(e[0],e[e.length-1])&&o&&(e=e.slice()).push(e[0]);for(let n=0;n<e.length-1;n++){const r=e[n],o=e[n+1];i.vertices.push(new t.Vector3(r[0],0,r[1])),i.vertices.push(new t.Vector3(o[0],0,o[1]))}}),i.verticesNeedUpdate=!0}}function g(e=[],n={}){const o=new t.BufferGeometry,a=new t.Points(o,new t.PointsMaterial({color:"white",size:1,sizeAttenuation:!0,...n}));return a.updateData=i,e&&i(e),a;function i(e){(0,r.setPointsToBufferPosition)(o,e.map(e=>new t.Vector3(e[0],0,e[1])))}}function v(e,n,r="white",o=32){f||((f=new t.Geometry).vertices=(0,a.linspace)(o,!0).map(e=>{const n=e*Math.PI*2;return new t.Vector3(1*Math.cos(n),0,1*Math.sin(n))}));const i=new t.Line(f,new t.LineBasicMaterial({color:r}));return i.position.x=e[0],i.position.z=e[1],i.scale.setScalar(n),i}function y(e,n={}){const r=s.boundsToVerts(e),o=new t.Geometry;return o.vertices=r.map(e=>new t.Vector3(e[0],0,e[1])),new t.LineLoop(o,new t.LineBasicMaterial({...n}))}function M(e,n={}){const{divisions:r=50}=n,o=e.getPoints(r),a=new t.Geometry;return a.vertices=o,new t.Line(a,new t.LineBasicMaterial({...n}))}function x(e,n={}){let{count:r,spaced:o=!0,spacing:a}=n;null==r&&a&&(r=Math.max(2,Math.round(e.getLength()/a))),r=Math.max(2,r);const i={...n};delete i.count,delete i.spaced,delete i.spacing,delete i.scale;const s=o?e.getSpacedPoints(r-1):e.getPoints(r-1);p||(p=new t.SphereGeometry(1,32,32));const l=new t.Group;return s.map(e=>{const r=new t.Mesh(p,new t.MeshBasicMaterial(i)),o=null!=n.scale?n.scale:.5;r.scale.setScalar(o),r.position.copy(e),l.add(r)}),l}function P(e,n={}){p||(p=new t.SphereGeometry(1,32,32));const r=new t.Group,o={...n};return delete o.scale,e.map(e=>{const a=new t.Mesh(p,new t.MeshBasicMaterial(o)),i=null!=n.scale?n.scale:.5;a.scale.setScalar(i),a.position.copy(e),r.add(a)}),r}function b(n,r,o={}){const{divisions:a=25}=o,i=r.getPoints(a-1),s=new t.BufferGeometry;s.setAttribute("position",new t.Float32BufferAttribute(i.map(e=>e.toArray()).flat(1/0),3)),s.setAttribute("coord",new t.Float32BufferAttribute(i.map((e,t,n)=>{return n.length<=1?.5:t/(n.length-1)}).flat(1/0),1));const l=new t.Line(s,new t.ShaderMaterial({name:"helperWindLine",transparent:!0,fragmentShader:"\n        const float PI = 3.14159265359;\n        const float TWO_PI = 6.28318530718;\n\n        float repeat(float t, float length) {\n          return t - floor(t / length) * length;\n        }\n\n        float deltaAngle(float current, float target) {\n          float num = repeat(target - current, TWO_PI);\n          if (num > PI) num -= TWO_PI;\n          return num;\n        }\n\n        float wrapAngle(float angle) {\n          float n = repeat(angle, TWO_PI);\n          if (n > PI) n -= TWO_PI;\n          return n;\n        }\n\n        float ToroidalDistance (float x1, float x2)\n        {\n            float dx = abs(x2 - x1);\n            if (dx > 0.5) dx = 1.0 - dx;\n            return sqrt(dx*dx);\n        }\n        \n        uniform vec3 color;\n        uniform float opacity;\n        uniform float time;\n        varying float vCoord;\n        void main () {\n          float alpha = opacity;\n          float progress = mod(time, 1.0);\n          \n          // float smoothness = 0.1;\n          // float target = mix(-0.5, 1.5, progress);\n          // alpha *= smoothstep(target - smoothness, target + smoothness, vCoord);\n          alpha *= pow(sin(vCoord * 10.0 + time * -3.0) * 0.5 + 0.5, 2.0);\n          gl_FragColor = vec4(color, alpha);\n        }\n      ",vertexShader:"\n        attribute float coord;\n        varying float vCoord;\n        void main () {\n          vCoord = coord;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n        }\n      ",uniforms:{color:{value:new t.Color(o.color||"white")},opacity:{value:1},time:{value:0}}}));return n.tag(e.ShaderUniformTime,{uniform:l.material.uniforms.time}),l}
},{"../tags":"injP","three":"IV0r","array-almost-equal":"i40d","./three-util":"bI4v","bound-points":"T2x6","canvas-sketch-util/math":"RN3r","earcut":"d3f1","./geometry":"nZ95"}],"xGSp":[function(require,module,exports) {
"use strict";function e(e){for(var t,r=-1,o=e.length,u=e[o-1],n=0;++r<o;)t=u,u=e[r],n+=t[1]*u[0]-t[0]*u[1];return n/2}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"ySB4":[function(require,module,exports) {
"use strict";function e(e){for(var t,r,o=-1,u=e.length,n=0,s=0,f=e[u-1],l=0;++o<u;)t=f,f=e[o],l+=r=t[0]*f[1]-f[0]*t[1],n+=(t[0]+f[0])*r,s+=(t[1]+f[1])*r;return[n/(l*=3),s/l]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"Q4Lv":[function(require,module,exports) {
"use strict";function e(e,t,r){return(t[0]-e[0])*(r[1]-e[1])-(t[1]-e[1])*(r[0]-e[0])}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"tgjV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=r(require("./cross.js"));function r(e){return e&&e.__esModule?e:{default:e}}function t(e,r){return e[0]-r[0]||e[1]-r[1]}function n(r){const t=r.length,n=[0,1];let u,o=2;for(u=2;u<t;++u){for(;o>1&&(0,e.default)(r[n[o-2]],r[n[o-1]],r[u])<=0;)--o;n[o++]=u}return n.slice(0,o)}function u(e){if((u=e.length)<3)return null;var r,u,o=new Array(u),l=new Array(u);for(r=0;r<u;++r)o[r]=[+e[r][0],+e[r][1],r];for(o.sort(t),r=0;r<u;++r)l[r]=[o[r][0],-o[r][1]];var f=n(o),s=n(l),a=s[0]===f[0],c=s[s.length-1]===f[f.length-1],i=[];for(r=f.length-1;r>=0;--r)i.push(e[o[f[r]][2]]);for(r=+a;r<s.length-c;++r)i.push(e[o[s[r]][2]]);return i}
},{"./cross.js":"Q4Lv"}],"pcph":[function(require,module,exports) {
"use strict";function e(e,t){for(var r,o,u=e.length,n=e[u-1],s=t[0],f=t[1],l=n[0],a=n[1],c=!1,d=0;d<u;++d)r=(n=e[d])[0],(o=n[1])>f!=a>f&&s<(l-r)*(f-o)/(a-o)+r&&(c=!c),l=r,a=o;return c}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"naEA":[function(require,module,exports) {
"use strict";function e(e){for(var t,r,o=-1,u=e.length,n=e[u-1],s=n[0],a=n[1],f=0;++o<u;)t=s,r=a,t-=s=(n=e[o])[0],r-=a=n[1],f+=Math.hypot(t,r);return f}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"QnuL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"polygonArea",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(exports,"polygonCentroid",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(exports,"polygonHull",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(exports,"polygonContains",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(exports,"polygonLength",{enumerable:!0,get:function(){return o.default}});var e=u(require("./area.js")),r=u(require("./centroid.js")),t=u(require("./hull.js")),n=u(require("./contains.js")),o=u(require("./length.js"));function u(e){return e&&e.__esModule?e:{default:e}}
},{"./area.js":"xGSp","./centroid.js":"ySB4","./hull.js":"tgjV","./contains.js":"pcph","./length.js":"naEA"}],"W1EL":[function(require,module,exports) {
var r=require("./squared");module.exports=function(e,t){return Math.sqrt(r(e,t))};
},{"./squared":"yACJ"}],"k9sZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMinimumSpanningTree=t;const e=require("euclidean-distance");function t(t,o,i={}){const{maxSteps:s=1/0}=i;if(t.length<=1)return[];o=o||e;let c=new Map;t.forEach((e,t)=>{c.set(e,t)});let r=new Set(t.slice(0,1)),l=new Set(t.slice(1)),a=new Map,f=0,u=[];for(;0!=l.size&&f++<s;){f>s-1&&console.warn("Infinite loop");const e=n(r,l,o);if(!e||!isFinite(e.distance))continue;const{from:t,to:i,distance:d}=e;let p=[c.get(t),c.get(i)];const g=p.slice();p.sort();const m=p.join(":");a.has(m)||(a.set(m,!0),u.push({...e,indices:g,key:m}),r.add(i),l.delete(i))}return u}function n(e,t,n){let o,i,s=1/0;for(let c of e)for(let e of t){let t=n(c,e);t<s&&(s=t,o=c,i=e)}return{from:o,to:i,distance:s}}
},{"euclidean-distance":"W1EL"}],"lNUO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sum=o,exports.sum_three=s,exports.scale=n,exports.negate=u,exports.estimate=l,exports.vec=p,exports.resulterrbound=exports.splitter=exports.epsilon=void 0;const e=1.1102230246251565e-16;exports.epsilon=e;const t=134217729;exports.splitter=t;const r=(3+8*e)*e;function o(e,t,r,o,s){let n,u,l,p,i=t[0],f=o[0],c=0,x=0;f>i==f>-i?(n=i,i=t[++c]):(n=f,f=o[++x]);let a=0;if(c<e&&x<r)for(f>i==f>-i?(l=n-((u=i+n)-i),i=t[++c]):(l=n-((u=f+n)-f),f=o[++x]),n=u,0!==l&&(s[a++]=l);c<e&&x<r;)f>i==f>-i?(l=n-((u=n+i)-(p=u-n))+(i-p),i=t[++c]):(l=n-((u=n+f)-(p=u-n))+(f-p),f=o[++x]),n=u,0!==l&&(s[a++]=l);for(;c<e;)l=n-((u=n+i)-(p=u-n))+(i-p),i=t[++c],n=u,0!==l&&(s[a++]=l);for(;x<r;)l=n-((u=n+f)-(p=u-n))+(f-p),f=o[++x],n=u,0!==l&&(s[a++]=l);return 0===n&&0!==a||(s[a++]=n),a}function s(e,t,r,s,n,u,l,p){return o(o(e,t,r,s,l),l,n,u,p)}function n(e,r,o,s){let n,u,l,p,i,f,c,x,a,d,b;b=o-(d=(c=t*o)-(c-o));let m=r[0],v=0;0!==(l=(a=m-(x=(c=t*m)-(c-m)))*b-((n=m*o)-x*d-a*d-x*b))&&(s[v++]=l);for(let _=1;_<e;_++)0!==(l=n-((u=n+(i=(a=(m=r[_])-(x=(c=t*m)-(c-m)))*b-((p=m*o)-x*d-a*d-x*b)))-(f=u-n))+(i-f))&&(s[v++]=l),0!==(l=u-((n=p+u)-p))&&(s[v++]=l);return 0===n&&0!==v||(s[v++]=n),v}function u(e,t){for(let r=0;r<e;r++)t[r]=-t[r];return e}function l(e,t){let r=t[0];for(let o=1;o<e;o++)r+=t[o];return r}function p(e){return new Float64Array(e)}exports.resulterrbound=r;
},{}],"qhtR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.orient2d=c,exports.orient2dfast=a;var t=require("./util.js");const e=(3+16*t.epsilon)*t.epsilon,s=(2+12*t.epsilon)*t.epsilon,r=(9+64*t.epsilon)*t.epsilon*t.epsilon,i=(0,t.vec)(4),n=(0,t.vec)(8),l=(0,t.vec)(12),p=(0,t.vec)(16),o=(0,t.vec)(4);function u(e,u,c,a,f,v,b){let d,m,M,h,x,j,_,q,y,O,P,g,k,w,z,A,B,C;const D=e-f,E=c-f,F=u-v,G=a-v;w=D*G,A=F*E,x=(z=(q=D-(_=(j=t.splitter*D)-(j-D)))*(O=G-(y=(j=t.splitter*G)-(j-G)))-(w-_*y-q*y-_*O))-(P=z-(B=(q=F-(_=(j=t.splitter*F)-(j-F)))*(O=E-(y=(j=t.splitter*E)-(j-E)))-(A-_*y-q*y-_*O))),i[0]=z-(P+x)+(x-B),x=(k=w-((g=w+P)-(x=g-w))+(P-x))-(P=k-A),i[1]=k-(P+x)+(x-A),x=(C=g+P)-g,i[2]=g-(C-x)+(P-x),i[3]=C;let H=(0,t.estimate)(4,i),I=s*b;if(H>=I||-H>=I)return H;if(d=e-(D+(x=e-D))+(x-f),M=c-(E+(x=c-E))+(x-f),m=u-(F+(x=u-F))+(x-v),h=a-(G+(x=a-G))+(x-v),0===d&&0===m&&0===M&&0===h)return H;if(I=r*b+t.resulterrbound*Math.abs(H),(H+=D*h+G*d-(F*M+E*m))>=I||-H>=I)return H;w=d*G,A=m*E,x=(z=(q=d-(_=(j=t.splitter*d)-(j-d)))*(O=G-(y=(j=t.splitter*G)-(j-G)))-(w-_*y-q*y-_*O))-(P=z-(B=(q=m-(_=(j=t.splitter*m)-(j-m)))*(O=E-(y=(j=t.splitter*E)-(j-E)))-(A-_*y-q*y-_*O))),o[0]=z-(P+x)+(x-B),x=(k=w-((g=w+P)-(x=g-w))+(P-x))-(P=k-A),o[1]=k-(P+x)+(x-A),x=(C=g+P)-g,o[2]=g-(C-x)+(P-x),o[3]=C;const J=(0,t.sum)(4,i,4,o,n);w=D*h,A=F*M,x=(z=(q=D-(_=(j=t.splitter*D)-(j-D)))*(O=h-(y=(j=t.splitter*h)-(j-h)))-(w-_*y-q*y-_*O))-(P=z-(B=(q=F-(_=(j=t.splitter*F)-(j-F)))*(O=M-(y=(j=t.splitter*M)-(j-M)))-(A-_*y-q*y-_*O))),o[0]=z-(P+x)+(x-B),x=(k=w-((g=w+P)-(x=g-w))+(P-x))-(P=k-A),o[1]=k-(P+x)+(x-A),x=(C=g+P)-g,o[2]=g-(C-x)+(P-x),o[3]=C;const K=(0,t.sum)(J,n,4,o,l);w=d*h,A=m*M,x=(z=(q=d-(_=(j=t.splitter*d)-(j-d)))*(O=h-(y=(j=t.splitter*h)-(j-h)))-(w-_*y-q*y-_*O))-(P=z-(B=(q=m-(_=(j=t.splitter*m)-(j-m)))*(O=M-(y=(j=t.splitter*M)-(j-M)))-(A-_*y-q*y-_*O))),o[0]=z-(P+x)+(x-B),x=(k=w-((g=w+P)-(x=g-w))+(P-x))-(P=k-A),o[1]=k-(P+x)+(x-A),x=(C=g+P)-g,o[2]=g-(C-x)+(P-x),o[3]=C;const L=(0,t.sum)(K,l,4,o,p);return p[L-1]}function c(t,s,r,i,n,l){const p=(s-l)*(r-n),o=(t-n)*(i-l),c=p-o;if(0===p||0===o||p>0!=o>0)return c;const a=Math.abs(p+o);return Math.abs(c)>=e*a?c:-u(t,s,r,i,n,l,a)}function a(t,e,s,r,i,n){return(e-n)*(s-i)-(t-i)*(r-n)}
},{"./util.js":"lNUO"}],"XMo1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.orient3d=k,exports.orient3dfast=w;var t=require("./util.js");const e=(7+56*t.epsilon)*t.epsilon,s=(3+28*t.epsilon)*t.epsilon,r=(26+288*t.epsilon)*t.epsilon*t.epsilon,l=(0,t.vec)(4),i=(0,t.vec)(4),c=(0,t.vec)(4),p=(0,t.vec)(4),n=(0,t.vec)(4),a=(0,t.vec)(4),o=(0,t.vec)(4),u=(0,t.vec)(4),v=(0,t.vec)(4),b=(0,t.vec)(8),f=(0,t.vec)(8),M=(0,t.vec)(8),h=(0,t.vec)(4),m=(0,t.vec)(8),d=(0,t.vec)(8),x=(0,t.vec)(8),j=(0,t.vec)(12);let _=(0,t.vec)(192),q=(0,t.vec)(192);function y(e,s,r){e=(0,t.sum)(e,_,s,r,q);const l=_;return _=q,q=l,e}function O(e,s,r,l,i,c,p,n){let a,o,u,v,b,f,M,h,m,d,x,j,_,q,y;return 0===e?0===s?(p[0]=0,n[0]=0,1):(d=(y=-s)*r,v=y-(u=(o=t.splitter*y)-(o-y)),f=r-(b=(o=t.splitter*r)-(o-r)),p[0]=v*f-(d-u*b-v*b-u*f),p[1]=d,d=s*i,v=s-(u=(o=t.splitter*s)-(o-s)),f=i-(b=(o=t.splitter*i)-(o-i)),n[0]=v*f-(d-u*b-v*b-u*f),n[1]=d,2):0===s?(d=e*l,v=e-(u=(o=t.splitter*e)-(o-e)),f=l-(b=(o=t.splitter*l)-(o-l)),p[0]=v*f-(d-u*b-v*b-u*f),p[1]=d,d=(y=-e)*c,v=y-(u=(o=t.splitter*y)-(o-y)),f=c-(b=(o=t.splitter*c)-(o-c)),n[0]=v*f-(d-u*b-v*b-u*f),n[1]=d,2):(d=e*l,j=s*r,a=(x=(v=e-(u=(o=t.splitter*e)-(o-e)))*(f=l-(b=(o=t.splitter*l)-(o-l)))-(d-u*b-v*b-u*f))-(M=x-(_=(v=s-(u=(o=t.splitter*s)-(o-s)))*(f=r-(b=(o=t.splitter*r)-(o-r)))-(j-u*b-v*b-u*f))),p[0]=x-(M+a)+(a-_),a=(m=d-((h=d+M)-(a=h-d))+(M-a))-(M=m-j),p[1]=m-(M+a)+(a-j),a=(q=h+M)-h,p[2]=h-(q-a)+(M-a),p[3]=q,d=s*i,j=e*c,a=(x=(v=s-(u=(o=t.splitter*s)-(o-s)))*(f=i-(b=(o=t.splitter*i)-(o-i)))-(d-u*b-v*b-u*f))-(M=x-(_=(v=e-(u=(o=t.splitter*e)-(o-e)))*(f=c-(b=(o=t.splitter*c)-(o-c)))-(j-u*b-v*b-u*f))),n[0]=x-(M+a)+(a-_),a=(m=d-((h=d+M)-(a=h-d))+(M-a))-(M=m-j),n[1]=m-(M+a)+(a-j),a=(q=h+M)-h,n[2]=h-(q-a)+(M-a),n[3]=q,4)}function P(e,s,r,l,i){let c,p,n,a,o,u,v,b,f,M,m,d,x;return m=s*r,d=(a=s-(n=(p=t.splitter*s)-(p-s)))*(u=r-(o=(p=t.splitter*r)-(p-r)))-(m-n*o-a*o-n*u),u=l-(o=(p=t.splitter*l)-(p-l)),v=d*l,a=d-(n=(p=t.splitter*d)-(p-d)),h[0]=a*u-(v-n*o-a*o-n*u),b=m*l,c=(f=v+(M=(a=m-(n=(p=t.splitter*m)-(p-m)))*u-(b-n*o-a*o-n*u)))-v,h[1]=v-(f-c)+(M-c),x=b+f,h[2]=f-(x-b),h[3]=x,e=y(e,4,h),0!==i&&(u=i-(o=(p=t.splitter*i)-(p-i)),v=d*i,a=d-(n=(p=t.splitter*d)-(p-d)),h[0]=a*u-(v-n*o-a*o-n*u),b=m*i,c=(f=v+(M=(a=m-(n=(p=t.splitter*m)-(p-m)))*u-(b-n*o-a*o-n*u)))-v,h[1]=v-(f-c)+(M-c),x=b+f,h[2]=f-(x-b),h[3]=x,e=y(e,4,h)),e}function g(e,h,q,g,k,w,z,A,B,C,D,E,F){let G,H,I,J,K,L,N,Q,R,S,T,U,V,W,X,Y,Z,$,tt,et,st,rt,lt,it;const ct=e-C,pt=g-C,nt=z-C,at=h-D,ot=k-D,ut=A-D,vt=q-E,bt=w-E,ft=B-E;et=pt*ut,rt=nt*ot,T=(st=(W=pt-(V=(U=t.splitter*pt)-(U-pt)))*(Y=ut-(X=(U=t.splitter*ut)-(U-ut)))-(et-V*X-W*X-V*Y))-(Z=st-(lt=(W=nt-(V=(U=t.splitter*nt)-(U-nt)))*(Y=ot-(X=(U=t.splitter*ot)-(U-ot)))-(rt-V*X-W*X-V*Y))),l[0]=st-(Z+T)+(T-lt),T=(tt=et-(($=et+Z)-(T=$-et))+(Z-T))-(Z=tt-rt),l[1]=tt-(Z+T)+(T-rt),T=(it=$+Z)-$,l[2]=$-(it-T)+(Z-T),l[3]=it,et=nt*at,rt=ct*ut,T=(st=(W=nt-(V=(U=t.splitter*nt)-(U-nt)))*(Y=at-(X=(U=t.splitter*at)-(U-at)))-(et-V*X-W*X-V*Y))-(Z=st-(lt=(W=ct-(V=(U=t.splitter*ct)-(U-ct)))*(Y=ut-(X=(U=t.splitter*ut)-(U-ut)))-(rt-V*X-W*X-V*Y))),i[0]=st-(Z+T)+(T-lt),T=(tt=et-(($=et+Z)-(T=$-et))+(Z-T))-(Z=tt-rt),i[1]=tt-(Z+T)+(T-rt),T=(it=$+Z)-$,i[2]=$-(it-T)+(Z-T),i[3]=it,et=ct*ot,rt=pt*at,T=(st=(W=ct-(V=(U=t.splitter*ct)-(U-ct)))*(Y=ot-(X=(U=t.splitter*ot)-(U-ot)))-(et-V*X-W*X-V*Y))-(Z=st-(lt=(W=pt-(V=(U=t.splitter*pt)-(U-pt)))*(Y=at-(X=(U=t.splitter*at)-(U-at)))-(rt-V*X-W*X-V*Y))),c[0]=st-(Z+T)+(T-lt),T=(tt=et-(($=et+Z)-(T=$-et))+(Z-T))-(Z=tt-rt),c[1]=tt-(Z+T)+(T-rt),T=(it=$+Z)-$,c[2]=$-(it-T)+(Z-T),c[3]=it,G=(0,t.sum)((0,t.sum)((0,t.scale)(4,l,vt,m),m,(0,t.scale)(4,i,bt,d),d,x),x,(0,t.scale)(4,c,ft,m),m,_);let Mt=(0,t.estimate)(G,_),ht=s*F;if(Mt>=ht||-Mt>=ht)return Mt;if(H=e-(ct+(T=e-ct))+(T-C),I=g-(pt+(T=g-pt))+(T-C),J=z-(nt+(T=z-nt))+(T-C),K=h-(at+(T=h-at))+(T-D),L=k-(ot+(T=k-ot))+(T-D),N=A-(ut+(T=A-ut))+(T-D),Q=q-(vt+(T=q-vt))+(T-E),R=w-(bt+(T=w-bt))+(T-E),S=B-(ft+(T=B-ft))+(T-E),0===H&&0===I&&0===J&&0===K&&0===L&&0===N&&0===Q&&0===R&&0===S)return Mt;if(ht=r*F+t.resulterrbound*Math.abs(Mt),(Mt+=vt*(pt*N+ut*I-(ot*J+nt*L))+Q*(pt*ut-ot*nt)+bt*(nt*K+at*J-(ut*H+ct*N))+R*(nt*at-ut*ct)+ft*(ct*L+ot*H-(at*I+pt*K))+S*(ct*ot-at*pt))>=ht||-Mt>=ht)return Mt;const mt=O(H,K,pt,ot,nt,ut,p,n),dt=O(I,L,nt,ut,ct,at,a,o),xt=O(J,N,ct,at,pt,ot,u,v),jt=(0,t.sum)(dt,a,xt,v,b);G=y(G,(0,t.scale)(jt,b,vt,x),x);const _t=(0,t.sum)(xt,u,mt,n,f);G=y(G,(0,t.scale)(_t,f,bt,x),x);const qt=(0,t.sum)(mt,p,dt,o,M);return G=y(G,(0,t.scale)(qt,M,ft,x),x),0!==Q&&(G=y(G,(0,t.scale)(4,l,Q,j),j),G=y(G,(0,t.scale)(jt,b,Q,x),x)),0!==R&&(G=y(G,(0,t.scale)(4,i,R,j),j),G=y(G,(0,t.scale)(_t,f,R,x),x)),0!==S&&(G=y(G,(0,t.scale)(4,c,S,j),j),G=y(G,(0,t.scale)(qt,M,S,x),x)),0!==H&&(0!==L&&(G=P(G,H,L,ft,S)),0!==N&&(G=P(G,-H,N,bt,R))),0!==I&&(0!==N&&(G=P(G,I,N,vt,Q)),0!==K&&(G=P(G,-I,K,ft,S))),0!==J&&(0!==K&&(G=P(G,J,K,bt,R)),0!==L&&(G=P(G,-J,L,vt,Q))),_[G-1]}function k(t,s,r,l,i,c,p,n,a,o,u,v){const b=t-o,f=l-o,M=p-o,h=s-u,m=i-u,d=n-u,x=r-v,j=c-v,_=a-v,q=f*d,y=M*m,O=M*h,P=b*d,k=b*m,w=f*h,z=x*(q-y)+j*(O-P)+_*(k-w),A=(Math.abs(q)+Math.abs(y))*Math.abs(x)+(Math.abs(O)+Math.abs(P))*Math.abs(j)+(Math.abs(k)+Math.abs(w))*Math.abs(_),B=e*A;return z>B||-z>B?z:g(t,s,r,l,i,c,p,n,a,o,u,v,A)}function w(t,e,s,r,l,i,c,p,n,a,o,u){const v=e-o,b=l-o,f=p-o,M=s-u,h=i-u,m=n-u;return(t-a)*(b*m-h*f)+(r-a)*(f*M-m*v)+(c-a)*(v*h-M*b)}
},{"./util.js":"lNUO"}],"KfyZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.incircle=G,exports.incirclefast=H;var e=require("./util.js");const s=(10+96*e.epsilon)*e.epsilon,l=(4+48*e.epsilon)*e.epsilon,t=(44+576*e.epsilon)*e.epsilon*e.epsilon,c=(0,e.vec)(4),a=(0,e.vec)(4),r=(0,e.vec)(4),i=(0,e.vec)(4),p=(0,e.vec)(4),u=(0,e.vec)(4),n=(0,e.vec)(4),o=(0,e.vec)(4),v=(0,e.vec)(8),m=(0,e.vec)(8),h=(0,e.vec)(8),f=(0,e.vec)(8),_=(0,e.vec)(8),b=(0,e.vec)(8),M=(0,e.vec)(8),d=(0,e.vec)(8),x=(0,e.vec)(8),j=(0,e.vec)(4),q=(0,e.vec)(4),y=(0,e.vec)(4),O=(0,e.vec)(8),P=(0,e.vec)(16),g=(0,e.vec)(16),k=(0,e.vec)(16),w=(0,e.vec)(32),z=(0,e.vec)(32),A=(0,e.vec)(48),B=(0,e.vec)(64);let C=(0,e.vec)(1152),D=(0,e.vec)(1152);function E(s,l,t){s=(0,e.sum)(s,C,l,t,D);const c=C;return C=D,D=c,s}function F(s,D,F,G,H,I,J,K,L){let N,Q,R,S,T,U,V,W,X,Y,Z,$,ee,se,le,te,ce,ae,re,ie,pe,ue,ne,oe,ve,me,he,fe,_e,be,Me,de,xe,je,qe;const ye=s-J,Oe=F-J,Pe=H-J,ge=D-K,ke=G-K,we=I-K;Me=Oe*we,xe=Pe*ke,ue=(de=(ve=Oe-(oe=(ne=e.splitter*Oe)-(ne-Oe)))*(he=we-(me=(ne=e.splitter*we)-(ne-we)))-(Me-oe*me-ve*me-oe*he))-(fe=de-(je=(ve=Pe-(oe=(ne=e.splitter*Pe)-(ne-Pe)))*(he=ke-(me=(ne=e.splitter*ke)-(ne-ke)))-(xe-oe*me-ve*me-oe*he))),c[0]=de-(fe+ue)+(ue-je),ue=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))-(fe=be-xe),c[1]=be-(fe+ue)+(ue-xe),ue=(qe=_e+fe)-_e,c[2]=_e-(qe-ue)+(fe-ue),c[3]=qe,Me=Pe*ge,xe=ye*we,ue=(de=(ve=Pe-(oe=(ne=e.splitter*Pe)-(ne-Pe)))*(he=ge-(me=(ne=e.splitter*ge)-(ne-ge)))-(Me-oe*me-ve*me-oe*he))-(fe=de-(je=(ve=ye-(oe=(ne=e.splitter*ye)-(ne-ye)))*(he=we-(me=(ne=e.splitter*we)-(ne-we)))-(xe-oe*me-ve*me-oe*he))),a[0]=de-(fe+ue)+(ue-je),ue=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))-(fe=be-xe),a[1]=be-(fe+ue)+(ue-xe),ue=(qe=_e+fe)-_e,a[2]=_e-(qe-ue)+(fe-ue),a[3]=qe,Me=ye*ke,xe=Oe*ge,ue=(de=(ve=ye-(oe=(ne=e.splitter*ye)-(ne-ye)))*(he=ke-(me=(ne=e.splitter*ke)-(ne-ke)))-(Me-oe*me-ve*me-oe*he))-(fe=de-(je=(ve=Oe-(oe=(ne=e.splitter*Oe)-(ne-Oe)))*(he=ge-(me=(ne=e.splitter*ge)-(ne-ge)))-(xe-oe*me-ve*me-oe*he))),r[0]=de-(fe+ue)+(ue-je),ue=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))-(fe=be-xe),r[1]=be-(fe+ue)+(ue-xe),ue=(qe=_e+fe)-_e,r[2]=_e-(qe-ue)+(fe-ue),r[3]=qe,N=(0,e.sum)((0,e.sum)((0,e.sum)((0,e.scale)((0,e.scale)(4,c,ye,O),O,ye,P),P,(0,e.scale)((0,e.scale)(4,c,ge,O),O,ge,g),g,w),w,(0,e.sum)((0,e.scale)((0,e.scale)(4,a,Oe,O),O,Oe,P),P,(0,e.scale)((0,e.scale)(4,a,ke,O),O,ke,g),g,z),z,B),B,(0,e.sum)((0,e.scale)((0,e.scale)(4,r,Pe,O),O,Pe,P),P,(0,e.scale)((0,e.scale)(4,r,we,O),O,we,g),g,w),w,C);let ze=(0,e.estimate)(N,C),Ae=l*L;if(ze>=Ae||-ze>=Ae)return ze;if(Q=s-(ye+(ue=s-ye))+(ue-J),T=D-(ge+(ue=D-ge))+(ue-K),R=F-(Oe+(ue=F-Oe))+(ue-J),U=G-(ke+(ue=G-ke))+(ue-K),S=H-(Pe+(ue=H-Pe))+(ue-J),V=I-(we+(ue=I-we))+(ue-K),0===Q&&0===R&&0===S&&0===T&&0===U&&0===V)return ze;if(Ae=t*L+e.resulterrbound*Math.abs(ze),(ze+=(ye*ye+ge*ge)*(Oe*V+we*R-(ke*S+Pe*U))+2*(ye*Q+ge*T)*(Oe*we-ke*Pe)+((Oe*Oe+ke*ke)*(Pe*T+ge*S-(we*Q+ye*V))+2*(Oe*R+ke*U)*(Pe*ge-we*ye))+((Pe*Pe+we*we)*(ye*U+ke*Q-(ge*R+Oe*T))+2*(Pe*S+we*V)*(ye*ke-ge*Oe)))>=Ae||-ze>=Ae)return ze;if(0===R&&0===U&&0===S&&0===V||(Me=ye*ye,xe=ge*ge,ue=(fe=(de=(ve=ye-(oe=(ne=e.splitter*ye)-(ne-ye)))*ve-(Me-oe*oe-(oe+oe)*ve))+(je=(ve=ge-(oe=(ne=e.splitter*ge)-(ne-ge)))*ve-(xe-oe*oe-(oe+oe)*ve)))-de,i[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,i[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,i[2]=_e-(qe-ue)+(fe-ue),i[3]=qe),0===S&&0===V&&0===Q&&0===T||(Me=Oe*Oe,xe=ke*ke,ue=(fe=(de=(ve=Oe-(oe=(ne=e.splitter*Oe)-(ne-Oe)))*ve-(Me-oe*oe-(oe+oe)*ve))+(je=(ve=ke-(oe=(ne=e.splitter*ke)-(ne-ke)))*ve-(xe-oe*oe-(oe+oe)*ve)))-de,p[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,p[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,p[2]=_e-(qe-ue)+(fe-ue),p[3]=qe),0===Q&&0===T&&0===R&&0===U||(Me=Pe*Pe,xe=we*we,ue=(fe=(de=(ve=Pe-(oe=(ne=e.splitter*Pe)-(ne-Pe)))*ve-(Me-oe*oe-(oe+oe)*ve))+(je=(ve=we-(oe=(ne=e.splitter*we)-(ne-we)))*ve-(xe-oe*oe-(oe+oe)*ve)))-de,u[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,u[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,u[2]=_e-(qe-ue)+(fe-ue),u[3]=qe),0!==Q&&(W=(0,e.scale)(4,c,Q,v),N=E(N,(0,e.sum_three)((0,e.scale)(W,v,2*ye,P),P,(0,e.scale)((0,e.scale)(4,u,Q,O),O,ke,g),g,(0,e.scale)((0,e.scale)(4,p,Q,O),O,-we,k),k,w,A),A)),0!==T&&(X=(0,e.scale)(4,c,T,m),N=E(N,(0,e.sum_three)((0,e.scale)(X,m,2*ge,P),P,(0,e.scale)((0,e.scale)(4,p,T,O),O,Pe,g),g,(0,e.scale)((0,e.scale)(4,u,T,O),O,-Oe,k),k,w,A),A)),0!==R&&(Y=(0,e.scale)(4,a,R,h),N=E(N,(0,e.sum_three)((0,e.scale)(Y,h,2*Oe,P),P,(0,e.scale)((0,e.scale)(4,i,R,O),O,we,g),g,(0,e.scale)((0,e.scale)(4,u,R,O),O,-ge,k),k,w,A),A)),0!==U&&(Z=(0,e.scale)(4,a,U,f),N=E(N,(0,e.sum_three)((0,e.scale)(Z,f,2*ke,P),P,(0,e.scale)((0,e.scale)(4,u,U,O),O,ye,g),g,(0,e.scale)((0,e.scale)(4,i,U,O),O,-Pe,k),k,w,A),A)),0!==S&&($=(0,e.scale)(4,r,S,_),N=E(N,(0,e.sum_three)((0,e.scale)($,_,2*Pe,P),P,(0,e.scale)((0,e.scale)(4,p,S,O),O,ge,g),g,(0,e.scale)((0,e.scale)(4,i,S,O),O,-ke,k),k,w,A),A)),0!==V&&(ee=(0,e.scale)(4,r,V,b),N=E(N,(0,e.sum_three)((0,e.scale)(ee,b,2*we,P),P,(0,e.scale)((0,e.scale)(4,i,V,O),O,Oe,g),g,(0,e.scale)((0,e.scale)(4,p,V,O),O,-ye,k),k,w,A),A)),0!==Q||0!==T){if(0!==R||0!==U||0!==S||0!==V?(Me=R*we,xe=Oe*V,ue=(fe=(de=(ve=R-(oe=(ne=e.splitter*R)-(ne-R)))*(he=we-(me=(ne=e.splitter*we)-(ne-we)))-(Me-oe*me-ve*me-oe*he))+(je=(ve=Oe-(oe=(ne=e.splitter*Oe)-(ne-Oe)))*(he=V-(me=(ne=e.splitter*V)-(ne-V)))-(xe-oe*me-ve*me-oe*he)))-de,n[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,n[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,n[2]=_e-(qe-ue)+(fe-ue),n[3]=qe,Me=S*-ke,xe=Pe*-U,ue=(fe=(de=(ve=S-(oe=(ne=e.splitter*S)-(ne-S)))*(he=-ke-(me=(ne=e.splitter*-ke)-(ne- -ke)))-(Me-oe*me-ve*me-oe*he))+(je=(ve=Pe-(oe=(ne=e.splitter*Pe)-(ne-Pe)))*(he=-U-(me=(ne=e.splitter*-U)-(ne- -U)))-(xe-oe*me-ve*me-oe*he)))-de,o[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,o[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,o[2]=_e-(qe-ue)+(fe-ue),o[3]=qe,le=(0,e.sum)(4,n,4,o,d),Me=R*V,xe=S*U,ue=(de=(ve=R-(oe=(ne=e.splitter*R)-(ne-R)))*(he=V-(me=(ne=e.splitter*V)-(ne-V)))-(Me-oe*me-ve*me-oe*he))-(fe=de-(je=(ve=S-(oe=(ne=e.splitter*S)-(ne-S)))*(he=U-(me=(ne=e.splitter*U)-(ne-U)))-(xe-oe*me-ve*me-oe*he))),q[0]=de-(fe+ue)+(ue-je),ue=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))-(fe=be-xe),q[1]=be-(fe+ue)+(ue-xe),ue=(qe=_e+fe)-_e,q[2]=_e-(qe-ue)+(fe-ue),q[3]=qe,ae=4):(d[0]=0,le=1,q[0]=0,ae=1),0!==Q){const s=(0,e.scale)(le,d,Q,k);N=E(N,(0,e.sum)((0,e.scale)(W,v,Q,P),P,(0,e.scale)(s,k,2*ye,w),w,A),A);const l=(0,e.scale)(ae,q,Q,O);N=E(N,(0,e.sum_three)((0,e.scale)(l,O,2*ye,P),P,(0,e.scale)(l,O,Q,g),g,(0,e.scale)(s,k,Q,w),w,z,B),B),0!==U&&(N=E(N,(0,e.scale)((0,e.scale)(4,u,Q,O),O,U,P),P)),0!==V&&(N=E(N,(0,e.scale)((0,e.scale)(4,p,-Q,O),O,V,P),P))}if(0!==T){const s=(0,e.scale)(le,d,T,k);N=E(N,(0,e.sum)((0,e.scale)(X,m,T,P),P,(0,e.scale)(s,k,2*ge,w),w,A),A);const l=(0,e.scale)(ae,q,T,O);N=E(N,(0,e.sum_three)((0,e.scale)(l,O,2*ge,P),P,(0,e.scale)(l,O,T,g),g,(0,e.scale)(s,k,T,w),w,z,B),B)}}if(0!==R||0!==U){if(0!==S||0!==V||0!==Q||0!==T?(Me=S*ge,xe=Pe*T,ue=(fe=(de=(ve=S-(oe=(ne=e.splitter*S)-(ne-S)))*(he=ge-(me=(ne=e.splitter*ge)-(ne-ge)))-(Me-oe*me-ve*me-oe*he))+(je=(ve=Pe-(oe=(ne=e.splitter*Pe)-(ne-Pe)))*(he=T-(me=(ne=e.splitter*T)-(ne-T)))-(xe-oe*me-ve*me-oe*he)))-de,n[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,n[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,n[2]=_e-(qe-ue)+(fe-ue),n[3]=qe,Me=Q*(ie=-we),xe=ye*(pe=-V),ue=(fe=(de=(ve=Q-(oe=(ne=e.splitter*Q)-(ne-Q)))*(he=ie-(me=(ne=e.splitter*ie)-(ne-ie)))-(Me-oe*me-ve*me-oe*he))+(je=(ve=ye-(oe=(ne=e.splitter*ye)-(ne-ye)))*(he=pe-(me=(ne=e.splitter*pe)-(ne-pe)))-(xe-oe*me-ve*me-oe*he)))-de,o[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,o[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,o[2]=_e-(qe-ue)+(fe-ue),o[3]=qe,te=(0,e.sum)(4,n,4,o,x),Me=S*T,xe=Q*V,ue=(de=(ve=S-(oe=(ne=e.splitter*S)-(ne-S)))*(he=T-(me=(ne=e.splitter*T)-(ne-T)))-(Me-oe*me-ve*me-oe*he))-(fe=de-(je=(ve=Q-(oe=(ne=e.splitter*Q)-(ne-Q)))*(he=V-(me=(ne=e.splitter*V)-(ne-V)))-(xe-oe*me-ve*me-oe*he))),y[0]=de-(fe+ue)+(ue-je),ue=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))-(fe=be-xe),y[1]=be-(fe+ue)+(ue-xe),ue=(qe=_e+fe)-_e,y[2]=_e-(qe-ue)+(fe-ue),y[3]=qe,re=4):(x[0]=0,te=1,y[0]=0,re=1),0!==R){const s=(0,e.scale)(te,x,R,k);N=E(N,(0,e.sum)((0,e.scale)(Y,h,R,P),P,(0,e.scale)(s,k,2*Oe,w),w,A),A);const l=(0,e.scale)(re,y,R,O);N=E(N,(0,e.sum_three)((0,e.scale)(l,O,2*Oe,P),P,(0,e.scale)(l,O,R,g),g,(0,e.scale)(s,k,R,w),w,z,B),B),0!==V&&(N=E(N,(0,e.scale)((0,e.scale)(4,i,R,O),O,V,P),P)),0!==T&&(N=E(N,(0,e.scale)((0,e.scale)(4,u,-R,O),O,T,P),P))}if(0!==U){const s=(0,e.scale)(te,x,U,k);N=E(N,(0,e.sum)((0,e.scale)(Z,f,U,P),P,(0,e.scale)(s,k,2*ke,w),w,A),A);const l=(0,e.scale)(re,y,U,O);N=E(N,(0,e.sum_three)((0,e.scale)(l,O,2*ke,P),P,(0,e.scale)(l,O,U,g),g,(0,e.scale)(s,k,U,w),w,z,B),B)}}if(0!==S||0!==V){if(0!==Q||0!==T||0!==R||0!==U?(Me=Q*ke,xe=ye*U,ue=(fe=(de=(ve=Q-(oe=(ne=e.splitter*Q)-(ne-Q)))*(he=ke-(me=(ne=e.splitter*ke)-(ne-ke)))-(Me-oe*me-ve*me-oe*he))+(je=(ve=ye-(oe=(ne=e.splitter*ye)-(ne-ye)))*(he=U-(me=(ne=e.splitter*U)-(ne-U)))-(xe-oe*me-ve*me-oe*he)))-de,n[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,n[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,n[2]=_e-(qe-ue)+(fe-ue),n[3]=qe,Me=R*(ie=-ge),xe=Oe*(pe=-T),ue=(fe=(de=(ve=R-(oe=(ne=e.splitter*R)-(ne-R)))*(he=ie-(me=(ne=e.splitter*ie)-(ne-ie)))-(Me-oe*me-ve*me-oe*he))+(je=(ve=Oe-(oe=(ne=e.splitter*Oe)-(ne-Oe)))*(he=pe-(me=(ne=e.splitter*pe)-(ne-pe)))-(xe-oe*me-ve*me-oe*he)))-de,o[0]=de-(fe-ue)+(je-ue),ue=(fe=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))+xe)-be,o[1]=be-(fe-ue)+(xe-ue),ue=(qe=_e+fe)-_e,o[2]=_e-(qe-ue)+(fe-ue),o[3]=qe,se=(0,e.sum)(4,n,4,o,M),Me=Q*U,xe=R*T,ue=(de=(ve=Q-(oe=(ne=e.splitter*Q)-(ne-Q)))*(he=U-(me=(ne=e.splitter*U)-(ne-U)))-(Me-oe*me-ve*me-oe*he))-(fe=de-(je=(ve=R-(oe=(ne=e.splitter*R)-(ne-R)))*(he=T-(me=(ne=e.splitter*T)-(ne-T)))-(xe-oe*me-ve*me-oe*he))),j[0]=de-(fe+ue)+(ue-je),ue=(be=Me-((_e=Me+fe)-(ue=_e-Me))+(fe-ue))-(fe=be-xe),j[1]=be-(fe+ue)+(ue-xe),ue=(qe=_e+fe)-_e,j[2]=_e-(qe-ue)+(fe-ue),j[3]=qe,ce=4):(M[0]=0,se=1,j[0]=0,ce=1),0!==S){const s=(0,e.scale)(se,M,S,k);N=E(N,(0,e.sum)((0,e.scale)($,_,S,P),P,(0,e.scale)(s,k,2*Pe,w),w,A),A);const l=(0,e.scale)(ce,j,S,O);N=E(N,(0,e.sum_three)((0,e.scale)(l,O,2*Pe,P),P,(0,e.scale)(l,O,S,g),g,(0,e.scale)(s,k,S,w),w,z,B),B),0!==T&&(N=E(N,(0,e.scale)((0,e.scale)(4,p,S,O),O,T,P),P)),0!==U&&(N=E(N,(0,e.scale)((0,e.scale)(4,i,-S,O),O,U,P),P))}if(0!==V){const s=(0,e.scale)(se,M,V,k);N=E(N,(0,e.sum)((0,e.scale)(ee,b,V,P),P,(0,e.scale)(s,k,2*we,w),w,A),A);const l=(0,e.scale)(ce,j,V,O);N=E(N,(0,e.sum_three)((0,e.scale)(l,O,2*we,P),P,(0,e.scale)(l,O,V,g),g,(0,e.scale)(s,k,V,w),w,z,B),B)}}return C[N-1]}function G(e,l,t,c,a,r,i,p){const u=e-i,n=t-i,o=a-i,v=l-p,m=c-p,h=r-p,f=n*h,_=o*m,b=u*u+v*v,M=o*v,d=u*h,x=n*n+m*m,j=u*m,q=n*v,y=o*o+h*h,O=b*(f-_)+x*(M-d)+y*(j-q),P=(Math.abs(f)+Math.abs(_))*b+(Math.abs(M)+Math.abs(d))*x+(Math.abs(j)+Math.abs(q))*y,g=s*P;return O>g||-O>g?O:F(e,l,t,c,a,r,i,p,P)}function H(e,s,l,t,c,a,r,i){const p=e-r,u=s-i,n=l-r,o=t-i,v=c-r,m=a-i;return(p*p+u*u)*(n*m-v*o)+(n*n+o*o)*(v*u-p*m)+(v*v+m*m)*(p*o-n*u)}
},{"./util.js":"lNUO"}],"DeKC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.insphere=et,exports.inspherefast=st;var t=require("./util.js");const e=(16+224*t.epsilon)*t.epsilon,s=(5+72*t.epsilon)*t.epsilon,r=(71+1408*t.epsilon)*t.epsilon*t.epsilon,l=(0,t.vec)(4),i=(0,t.vec)(4),c=(0,t.vec)(4),p=(0,t.vec)(4),a=(0,t.vec)(4),v=(0,t.vec)(4),n=(0,t.vec)(4),u=(0,t.vec)(4),o=(0,t.vec)(4),h=(0,t.vec)(4),b=(0,t.vec)(24),M=(0,t.vec)(24),m=(0,t.vec)(24),f=(0,t.vec)(24),_=(0,t.vec)(24),d=(0,t.vec)(24),g=(0,t.vec)(24),x=(0,t.vec)(24),j=(0,t.vec)(24),q=(0,t.vec)(24),y=(0,t.vec)(1152),O=(0,t.vec)(1152),P=(0,t.vec)(1152),k=(0,t.vec)(1152),w=(0,t.vec)(1152),z=(0,t.vec)(2304),A=(0,t.vec)(2304),B=(0,t.vec)(3456),C=(0,t.vec)(5760),D=(0,t.vec)(8),E=(0,t.vec)(8),F=(0,t.vec)(8),G=(0,t.vec)(16),H=(0,t.vec)(24),I=(0,t.vec)(48),J=(0,t.vec)(48),K=(0,t.vec)(96),L=(0,t.vec)(192),N=(0,t.vec)(384),Q=(0,t.vec)(384),R=(0,t.vec)(384),S=(0,t.vec)(768);function T(e,s,r,l,i,c,p){return(0,t.sum_three)((0,t.scale)(4,e,l,D),D,(0,t.scale)(4,s,i,E),E,(0,t.scale)(4,r,c,F),F,G,p)}function U(e,s,r,l,i,c,p,a,v,n,u,o){const h=(0,t.sum)((0,t.sum)(e,s,r,l,I),I,(0,t.negate)((0,t.sum)(i,c,p,a,J),J),J,K);return(0,t.sum_three)((0,t.scale)((0,t.scale)(h,K,v,L),L,v,N),N,(0,t.scale)((0,t.scale)(h,K,n,L),L,n,Q),Q,(0,t.scale)((0,t.scale)(h,K,u,L),L,u,R),R,S,o)}function V(e,s,r,D,E,F,G,H,I,J,K,L,N,Q,R){let S,V,W,X,Y,Z,$,tt,et,st,rt,lt,it,ct;st=e*E,lt=D*s,S=(rt=(X=e-(W=(V=t.splitter*e)-(V-e)))*(Z=E-(Y=(V=t.splitter*E)-(V-E)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=D-(W=(V=t.splitter*D)-(V-D)))*(Z=s-(Y=(V=t.splitter*s)-(V-s)))-(lt-W*Y-X*Y-W*Z))),l[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),l[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,l[2]=tt-(ct-S)+($-S),l[3]=ct,st=D*H,lt=G*E,S=(rt=(X=D-(W=(V=t.splitter*D)-(V-D)))*(Z=H-(Y=(V=t.splitter*H)-(V-H)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=G-(W=(V=t.splitter*G)-(V-G)))*(Z=E-(Y=(V=t.splitter*E)-(V-E)))-(lt-W*Y-X*Y-W*Z))),i[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),i[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,i[2]=tt-(ct-S)+($-S),i[3]=ct,st=G*K,lt=J*H,S=(rt=(X=G-(W=(V=t.splitter*G)-(V-G)))*(Z=K-(Y=(V=t.splitter*K)-(V-K)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=J-(W=(V=t.splitter*J)-(V-J)))*(Z=H-(Y=(V=t.splitter*H)-(V-H)))-(lt-W*Y-X*Y-W*Z))),c[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),c[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,c[2]=tt-(ct-S)+($-S),c[3]=ct,st=J*Q,lt=N*K,S=(rt=(X=J-(W=(V=t.splitter*J)-(V-J)))*(Z=Q-(Y=(V=t.splitter*Q)-(V-Q)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=N-(W=(V=t.splitter*N)-(V-N)))*(Z=K-(Y=(V=t.splitter*K)-(V-K)))-(lt-W*Y-X*Y-W*Z))),p[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),p[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,p[2]=tt-(ct-S)+($-S),p[3]=ct,st=N*s,lt=e*Q,S=(rt=(X=N-(W=(V=t.splitter*N)-(V-N)))*(Z=s-(Y=(V=t.splitter*s)-(V-s)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=e-(W=(V=t.splitter*e)-(V-e)))*(Z=Q-(Y=(V=t.splitter*Q)-(V-Q)))-(lt-W*Y-X*Y-W*Z))),a[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),a[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,a[2]=tt-(ct-S)+($-S),a[3]=ct,st=e*H,lt=G*s,S=(rt=(X=e-(W=(V=t.splitter*e)-(V-e)))*(Z=H-(Y=(V=t.splitter*H)-(V-H)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=G-(W=(V=t.splitter*G)-(V-G)))*(Z=s-(Y=(V=t.splitter*s)-(V-s)))-(lt-W*Y-X*Y-W*Z))),v[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),v[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,v[2]=tt-(ct-S)+($-S),v[3]=ct,st=D*K,lt=J*E,S=(rt=(X=D-(W=(V=t.splitter*D)-(V-D)))*(Z=K-(Y=(V=t.splitter*K)-(V-K)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=J-(W=(V=t.splitter*J)-(V-J)))*(Z=E-(Y=(V=t.splitter*E)-(V-E)))-(lt-W*Y-X*Y-W*Z))),n[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),n[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,n[2]=tt-(ct-S)+($-S),n[3]=ct,st=G*Q,lt=N*H,S=(rt=(X=G-(W=(V=t.splitter*G)-(V-G)))*(Z=Q-(Y=(V=t.splitter*Q)-(V-Q)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=N-(W=(V=t.splitter*N)-(V-N)))*(Z=H-(Y=(V=t.splitter*H)-(V-H)))-(lt-W*Y-X*Y-W*Z))),u[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),u[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,u[2]=tt-(ct-S)+($-S),u[3]=ct,st=J*s,lt=e*K,S=(rt=(X=J-(W=(V=t.splitter*J)-(V-J)))*(Z=s-(Y=(V=t.splitter*s)-(V-s)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=e-(W=(V=t.splitter*e)-(V-e)))*(Z=K-(Y=(V=t.splitter*K)-(V-K)))-(lt-W*Y-X*Y-W*Z))),o[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),o[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,o[2]=tt-(ct-S)+($-S),o[3]=ct,st=N*E,lt=D*Q,S=(rt=(X=N-(W=(V=t.splitter*N)-(V-N)))*(Z=E-(Y=(V=t.splitter*E)-(V-E)))-(st-W*Y-X*Y-W*Z))-($=rt-(it=(X=D-(W=(V=t.splitter*D)-(V-D)))*(Z=Q-(Y=(V=t.splitter*Q)-(V-Q)))-(lt-W*Y-X*Y-W*Z))),h[0]=rt-($+S)+(S-it),S=(et=st-((tt=st+$)-(S=tt-st))+($-S))-($=et-lt),h[1]=et-($+S)+(S-lt),S=(ct=tt+$)-tt,h[2]=tt-(ct-S)+($-S),h[3]=ct;const pt=T(l,i,v,I,r,-F,b),at=T(i,c,n,L,F,-I,M),vt=T(c,p,u,R,I,-L,m),nt=T(p,a,o,r,L,-R,f),ut=T(a,l,h,F,R,-r,_),ot=T(l,n,o,L,r,F,d),ht=T(i,u,h,R,F,I,g),bt=T(c,o,v,r,I,L,x),Mt=T(p,h,n,F,L,R,j),mt=T(a,v,u,I,R,r,q),ft=(0,t.sum_three)(U(vt,m,ht,g,Mt,j,at,M,e,s,r,y),y,U(nt,f,bt,x,mt,q,vt,m,D,E,F,O),O,(0,t.sum_three)(U(ut,_,Mt,j,ot,d,nt,f,G,H,I,P),P,U(pt,b,mt,q,ht,g,ut,_,J,K,L,k),k,U(at,M,ot,d,bt,x,pt,b,N,Q,R,w),w,A,B),B,z,C);return C[ft-1]}const W=(0,t.vec)(96),X=(0,t.vec)(96),Y=(0,t.vec)(96),Z=(0,t.vec)(1152);function $(e,s,r,l,i,c,p,a,v,n){const u=T(e,s,r,l,i,c,H);return(0,t.sum_three)((0,t.scale)((0,t.scale)(u,H,p,I),I,p,W),W,(0,t.scale)((0,t.scale)(u,H,a,I),I,a,X),X,(0,t.scale)((0,t.scale)(u,H,v,I),I,v,Y),Y,L,n)}function tt(e,p,a,u,h,b,M,m,f,_,d,g,x,j,q,w){let B,C,D,E,F,G,H,I,J,K,L,N,Q,R,S,T,U,W,X,Y,tt,et,st,rt,lt,it,ct,pt,at,vt,nt;const ut=e-x,ot=u-x,ht=M-x,bt=_-x,Mt=p-j,mt=h-j,ft=m-j,_t=d-j,dt=a-q,gt=b-q,xt=f-q,jt=g-q;pt=ut*mt,vt=ot*Mt,X=(at=(et=ut-(tt=(Y=t.splitter*ut)-(Y-ut)))*(rt=mt-(st=(Y=t.splitter*mt)-(Y-mt)))-(pt-tt*st-et*st-tt*rt))-(lt=at-(nt=(et=ot-(tt=(Y=t.splitter*ot)-(Y-ot)))*(rt=Mt-(st=(Y=t.splitter*Mt)-(Y-Mt)))-(vt-tt*st-et*st-tt*rt))),l[0]=at-(lt+X)+(X-nt),X=(ct=pt-((it=pt+lt)-(X=it-pt))+(lt-X))-(lt=ct-vt),l[1]=ct-(lt+X)+(X-vt),X=(B=it+lt)-it,l[2]=it-(B-X)+(lt-X),l[3]=B,pt=ot*ft,vt=ht*mt,X=(at=(et=ot-(tt=(Y=t.splitter*ot)-(Y-ot)))*(rt=ft-(st=(Y=t.splitter*ft)-(Y-ft)))-(pt-tt*st-et*st-tt*rt))-(lt=at-(nt=(et=ht-(tt=(Y=t.splitter*ht)-(Y-ht)))*(rt=mt-(st=(Y=t.splitter*mt)-(Y-mt)))-(vt-tt*st-et*st-tt*rt))),i[0]=at-(lt+X)+(X-nt),X=(ct=pt-((it=pt+lt)-(X=it-pt))+(lt-X))-(lt=ct-vt),i[1]=ct-(lt+X)+(X-vt),X=(C=it+lt)-it,i[2]=it-(C-X)+(lt-X),i[3]=C,pt=ht*_t,vt=bt*ft,X=(at=(et=ht-(tt=(Y=t.splitter*ht)-(Y-ht)))*(rt=_t-(st=(Y=t.splitter*_t)-(Y-_t)))-(pt-tt*st-et*st-tt*rt))-(lt=at-(nt=(et=bt-(tt=(Y=t.splitter*bt)-(Y-bt)))*(rt=ft-(st=(Y=t.splitter*ft)-(Y-ft)))-(vt-tt*st-et*st-tt*rt))),c[0]=at-(lt+X)+(X-nt),X=(ct=pt-((it=pt+lt)-(X=it-pt))+(lt-X))-(lt=ct-vt),c[1]=ct-(lt+X)+(X-vt),X=(D=it+lt)-it,c[2]=it-(D-X)+(lt-X),c[3]=D,pt=bt*Mt,vt=ut*_t,X=(at=(et=bt-(tt=(Y=t.splitter*bt)-(Y-bt)))*(rt=Mt-(st=(Y=t.splitter*Mt)-(Y-Mt)))-(pt-tt*st-et*st-tt*rt))-(lt=at-(nt=(et=ut-(tt=(Y=t.splitter*ut)-(Y-ut)))*(rt=_t-(st=(Y=t.splitter*_t)-(Y-_t)))-(vt-tt*st-et*st-tt*rt))),o[0]=at-(lt+X)+(X-nt),X=(ct=pt-((it=pt+lt)-(X=it-pt))+(lt-X))-(lt=ct-vt),o[1]=ct-(lt+X)+(X-vt),X=(E=it+lt)-it,o[2]=it-(E-X)+(lt-X),o[3]=E,pt=ut*ft,vt=ht*Mt,X=(at=(et=ut-(tt=(Y=t.splitter*ut)-(Y-ut)))*(rt=ft-(st=(Y=t.splitter*ft)-(Y-ft)))-(pt-tt*st-et*st-tt*rt))-(lt=at-(nt=(et=ht-(tt=(Y=t.splitter*ht)-(Y-ht)))*(rt=Mt-(st=(Y=t.splitter*Mt)-(Y-Mt)))-(vt-tt*st-et*st-tt*rt))),v[0]=at-(lt+X)+(X-nt),X=(ct=pt-((it=pt+lt)-(X=it-pt))+(lt-X))-(lt=ct-vt),v[1]=ct-(lt+X)+(X-vt),X=(F=it+lt)-it,v[2]=it-(F-X)+(lt-X),v[3]=F,pt=ot*_t,vt=bt*mt,X=(at=(et=ot-(tt=(Y=t.splitter*ot)-(Y-ot)))*(rt=_t-(st=(Y=t.splitter*_t)-(Y-_t)))-(pt-tt*st-et*st-tt*rt))-(lt=at-(nt=(et=bt-(tt=(Y=t.splitter*bt)-(Y-bt)))*(rt=mt-(st=(Y=t.splitter*mt)-(Y-mt)))-(vt-tt*st-et*st-tt*rt))),n[0]=at-(lt+X)+(X-nt),X=(ct=pt-((it=pt+lt)-(X=it-pt))+(lt-X))-(lt=ct-vt),n[1]=ct-(lt+X)+(X-vt),X=(G=it+lt)-it,n[2]=it-(G-X)+(lt-X),n[3]=G;const qt=(0,t.sum)((0,t.sum)((0,t.negate)($(i,c,n,jt,gt,-xt,ut,Mt,dt,y),y),y,$(c,o,v,dt,xt,jt,ot,mt,gt,O),O,z),z,(0,t.sum)((0,t.negate)($(o,l,n,gt,jt,dt,ht,ft,xt,P),P),P,$(l,i,v,xt,dt,-gt,bt,_t,jt,k),k,A),A,Z);let yt=(0,t.estimate)(qt,Z),Ot=s*w;if(yt>=Ot||-yt>=Ot)return yt;if(H=e-(ut+(X=e-ut))+(X-x),L=p-(Mt+(X=p-Mt))+(X-j),S=a-(dt+(X=a-dt))+(X-q),I=u-(ot+(X=u-ot))+(X-x),N=h-(mt+(X=h-mt))+(X-j),T=b-(gt+(X=b-gt))+(X-q),J=M-(ht+(X=M-ht))+(X-x),Q=m-(ft+(X=m-ft))+(X-j),U=f-(xt+(X=f-xt))+(X-q),K=_-(bt+(X=_-bt))+(X-x),R=d-(_t+(X=d-_t))+(X-j),W=g-(jt+(X=g-jt))+(X-q),0===H&&0===L&&0===S&&0===I&&0===N&&0===T&&0===J&&0===Q&&0===U&&0===K&&0===R&&0===W)return yt;Ot=r*w+t.resulterrbound*Math.abs(yt);const Pt=ut*N+mt*H-(Mt*I+ot*L),kt=ot*Q+ft*I-(mt*J+ht*N),wt=ht*R+_t*J-(ft*K+bt*Q),zt=bt*L+Mt*K-(_t*H+ut*R),At=ut*Q+ft*H-(Mt*J+ht*L),Bt=ot*R+_t*I-(mt*K+bt*N);return(yt+=(ot*ot+mt*mt+gt*gt)*(xt*zt+jt*At+dt*wt+(U*E+W*F+S*D))+(bt*bt+_t*_t+jt*jt)*(dt*kt-gt*At+xt*Pt+(S*C-T*F+U*B))-((ut*ut+Mt*Mt+dt*dt)*(gt*wt-xt*Bt+jt*kt+(T*D-U*G+W*C))+(ht*ht+ft*ft+xt*xt)*(jt*Pt+dt*Bt+gt*zt+(W*B+S*G+T*E)))+2*((ot*I+mt*N+gt*T)*(xt*E+jt*F+dt*D)+(bt*K+_t*R+jt*W)*(dt*C-gt*F+xt*B)-((ut*H+Mt*L+dt*S)*(gt*D-xt*G+jt*C)+(ht*J+ft*Q+xt*U)*(jt*B+dt*G+gt*E))))>=Ot||-yt>=Ot?yt:V(e,p,a,u,h,b,M,m,f,_,d,g,x,j,q)}function et(t,s,r,l,i,c,p,a,v,n,u,o,h,b,M){const m=t-h,f=l-h,_=p-h,d=n-h,g=s-b,x=i-b,j=a-b,q=u-b,y=r-M,O=c-M,P=v-M,k=o-M,w=m*x,z=f*g,A=w-z,B=f*j,C=_*x,D=B-C,E=_*q,F=d*j,G=E-F,H=d*g,I=m*q,J=H-I,K=m*j,L=_*g,N=K-L,Q=f*q,R=d*x,S=Q-R,T=m*m+g*g+y*y,U=f*f+x*x+O*O,V=_*_+j*j+P*P,W=d*d+q*q+k*k,X=V*(k*A+y*S+O*J)-W*(y*D-O*N+P*A)+(T*(O*G-P*S+k*D)-U*(P*J+k*N+y*G)),Y=Math.abs(y),Z=Math.abs(O),$=Math.abs(P),et=Math.abs(k),st=Math.abs(w),rt=Math.abs(z),lt=Math.abs(B),it=Math.abs(C),ct=Math.abs(E),pt=Math.abs(F),at=Math.abs(H),vt=Math.abs(I),nt=Math.abs(K),ut=Math.abs(L),ot=Math.abs(Q),ht=Math.abs(R),bt=((ct+pt)*Z+(ht+ot)*$+(lt+it)*et)*T+((at+vt)*$+(nt+ut)*et+(ct+pt)*Y)*U+((st+rt)*et+(ot+ht)*Y+(at+vt)*Z)*V+((lt+it)*Y+(ut+nt)*Z+(st+rt)*$)*W,Mt=e*bt;return X>Mt||-X>Mt?X:-tt(t,s,r,l,i,c,p,a,v,n,u,o,h,b,M,bt)}function st(t,e,s,r,l,i,c,p,a,v,n,u,o,h,b){const M=t-o,m=r-o,f=c-o,_=v-o,d=e-h,g=l-h,x=p-h,j=n-h,q=s-b,y=i-b,O=a-b,P=u-b,k=M*g-m*d,w=m*x-f*g,z=f*j-_*x,A=_*d-M*j,B=M*x-f*d,C=m*j-_*g;return(f*f+x*x+O*O)*(P*k+q*C+y*A)-(_*_+j*j+P*P)*(q*w-y*B+O*k)+((M*M+d*d+q*q)*(y*z-O*C+P*w)-(m*m+g*g+y*y)*(O*A+P*B+q*z))}
},{"./util.js":"lNUO"}],"GTd0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"orient2d",{enumerable:!0,get:function(){return e.orient2d}}),Object.defineProperty(exports,"orient2dfast",{enumerable:!0,get:function(){return e.orient2dfast}}),Object.defineProperty(exports,"orient3d",{enumerable:!0,get:function(){return r.orient3d}}),Object.defineProperty(exports,"orient3dfast",{enumerable:!0,get:function(){return r.orient3dfast}}),Object.defineProperty(exports,"incircle",{enumerable:!0,get:function(){return t.incircle}}),Object.defineProperty(exports,"incirclefast",{enumerable:!0,get:function(){return t.incirclefast}}),Object.defineProperty(exports,"insphere",{enumerable:!0,get:function(){return n.insphere}}),Object.defineProperty(exports,"inspherefast",{enumerable:!0,get:function(){return n.inspherefast}});var e=require("./esm/orient2d.js"),r=require("./esm/orient3d.js"),t=require("./esm/incircle.js"),n=require("./esm/insphere.js");
},{"./esm/orient2d.js":"qhtR","./esm/orient3d.js":"XMo1","./esm/incircle.js":"KfyZ","./esm/insphere.js":"DeKC"}],"HpL9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("robust-predicates");const i=Math.pow(2,-52),s=new Uint32Array(512);class e{static from(t,i=c,s=u){const h=t.length,n=new Float64Array(2*h);for(let e=0;e<h;e++){const h=t[e];n[2*e]=i(h),n[2*e+1]=s(h)}return new e(n)}constructor(t){const i=t.length>>1;if(i>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const s=Math.max(2*i-5,0);this._triangles=new Uint32Array(3*s),this._halfedges=new Int32Array(3*s),this._hashSize=Math.ceil(Math.sqrt(i)),this._hullPrev=new Uint32Array(i),this._hullNext=new Uint32Array(i),this._hullTri=new Uint32Array(i),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(i),this._dists=new Float64Array(i),this.update()}update(){const{coords:s,_hullPrev:e,_hullNext:h,_hullTri:r,_hullHash:_}=this,c=s.length>>1;let u=1/0,f=1/0,d=-1/0,g=-1/0;for(let t=0;t<c;t++){const i=s[2*t],e=s[2*t+1];i<u&&(u=i),e<f&&(f=e),i>d&&(d=i),e>g&&(g=e),this._ids[t]=t}const y=(u+d)/2,w=(f+g)/2;let b,A,k,x=1/0;for(let t=0;t<c;t++){const i=n(y,w,s[2*t],s[2*t+1]);i<x&&(b=t,x=i)}const S=s[2*b],p=s[2*b+1];x=1/0;for(let t=0;t<c;t++){if(t===b)continue;const i=n(S,p,s[2*t],s[2*t+1]);i<x&&i>0&&(A=t,x=i)}let z=s[2*A],M=s[2*A+1],U=1/0;for(let t=0;t<c;t++){if(t===b||t===A)continue;const i=l(S,p,z,M,s[2*t],s[2*t+1]);i<U&&(k=t,U=i)}let T=s[2*k],v=s[2*k+1];if(U===1/0){for(let e=0;e<c;e++)this._dists[e]=s[2*e]-s[0]||s[2*e+1]-s[1];o(this._ids,this._dists,0,c-1);const t=new Uint32Array(c);let i=0;for(let s=0,e=-1/0;s<c;s++){const h=this._ids[s];this._dists[h]>e&&(t[i++]=h,e=this._dists[h])}return this.hull=t.subarray(0,i),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if((0,t.orient2d)(S,p,z,M,T,v)<0){const t=A,i=z,s=M;A=k,z=T,M=v,k=t,T=i,v=s}const K=a(S,p,z,M,T,v);this._cx=K.x,this._cy=K.y;for(let t=0;t<c;t++)this._dists[t]=n(s[2*t],s[2*t+1],K.x,K.y);o(this._ids,this._dists,0,c-1),this._hullStart=b;let L=3;h[b]=e[k]=A,h[A]=e[b]=k,h[k]=e[A]=b,r[b]=0,r[A]=1,r[k]=2,_.fill(-1),_[this._hashKey(S,p)]=b,_[this._hashKey(z,M)]=A,_[this._hashKey(T,v)]=k,this.trianglesLen=0,this._addTriangle(b,A,k,-1,-1,-1);for(let n,l,a=0;a<this._ids.length;a++){const o=this._ids[a],c=s[2*o],u=s[2*o+1];if(a>0&&Math.abs(c-n)<=i&&Math.abs(u-l)<=i)continue;if(n=c,l=u,o===b||o===A||o===k)continue;let f=0;for(let t=0,i=this._hashKey(c,u);t<this._hashSize&&(-1===(f=_[(i+t)%this._hashSize])||f===h[f]);t++);let d,g=f=e[f];for(;d=h[g],(0,t.orient2d)(c,u,s[2*g],s[2*g+1],s[2*d],s[2*d+1])>=0;)if((g=d)===f){g=-1;break}if(-1===g)continue;let y=this._addTriangle(g,o,h[g],-1,-1,r[g]);r[o]=this._legalize(y+2),r[g]=y,L++;let w=h[g];for(;d=h[w],(0,t.orient2d)(c,u,s[2*w],s[2*w+1],s[2*d],s[2*d+1])<0;)y=this._addTriangle(w,o,d,r[o],-1,r[w]),r[o]=this._legalize(y+2),h[w]=w,L--,w=d;if(g===f)for(;d=e[g],(0,t.orient2d)(c,u,s[2*d],s[2*d+1],s[2*g],s[2*g+1])<0;)y=this._addTriangle(d,o,g,-1,r[g],r[d]),this._legalize(y+2),r[d]=y,h[g]=g,L--,g=d;this._hullStart=e[o]=g,h[g]=e[w]=o,h[o]=w,_[this._hashKey(c,u)]=o,_[this._hashKey(s[2*g],s[2*g+1])]=g}this.hull=new Uint32Array(L);for(let t=0,i=this._hullStart;t<L;t++)this.hull[t]=i,i=h[i];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,i){return Math.floor(h(t-this._cx,i-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:i,_halfedges:e,coords:h}=this;let n=0,l=0;for(;;){const a=e[t],o=t-t%3;if(l=o+(t+2)%3,-1===a){if(0===n)break;t=s[--n];continue}const _=a-a%3,c=o+(t+1)%3,u=_+(a+2)%3,f=i[l],d=i[t],g=i[c],y=i[u];if(r(h[2*f],h[2*f+1],h[2*d],h[2*d+1],h[2*g],h[2*g+1],h[2*y],h[2*y+1])){i[t]=y,i[a]=f;const h=e[u];if(-1===h){let i=this._hullStart;do{if(this._hullTri[i]===u){this._hullTri[i]=t;break}i=this._hullPrev[i]}while(i!==this._hullStart)}this._link(t,h),this._link(a,e[l]),this._link(l,u);const r=_+(a+1)%3;n<s.length&&(s[n++]=r)}else{if(0===n)break;t=s[--n]}}return l}_link(t,i){this._halfedges[t]=i,-1!==i&&(this._halfedges[i]=t)}_addTriangle(t,i,s,e,h,n){const r=this.trianglesLen;return this._triangles[r]=t,this._triangles[r+1]=i,this._triangles[r+2]=s,this._link(r,e),this._link(r+1,h),this._link(r+2,n),this.trianglesLen+=3,r}}function h(t,i){const s=t/(Math.abs(t)+Math.abs(i));return(i>0?3-s:1+s)/4}function n(t,i,s,e){const h=t-s,n=i-e;return h*h+n*n}function r(t,i,s,e,h,n,r,l){const a=t-r,o=i-l,_=s-r,c=e-l,u=h-r,f=n-l,d=_*_+c*c,g=u*u+f*f;return a*(c*g-d*f)-o*(_*g-d*u)+(a*a+o*o)*(_*f-c*u)<0}function l(t,i,s,e,h,n){const r=s-t,l=e-i,a=h-t,o=n-i,_=r*r+l*l,c=a*a+o*o,u=.5/(r*o-l*a),f=(o*_-l*c)*u,d=(r*c-a*_)*u;return f*f+d*d}function a(t,i,s,e,h,n){const r=s-t,l=e-i,a=h-t,o=n-i,_=r*r+l*l,c=a*a+o*o,u=.5/(r*o-l*a);return{x:t+(o*_-l*c)*u,y:i+(r*c-a*_)*u}}function o(t,i,s,e){if(e-s<=20)for(let h=s+1;h<=e;h++){const e=t[h],n=i[e];let r=h-1;for(;r>=s&&i[t[r]]>n;)t[r+1]=t[r--];t[r+1]=e}else{let h=s+1,n=e;_(t,s+e>>1,h),i[t[s]]>i[t[e]]&&_(t,s,e),i[t[h]]>i[t[e]]&&_(t,h,e),i[t[s]]>i[t[h]]&&_(t,s,h);const r=t[h],l=i[r];for(;;){do{h++}while(i[t[h]]<l);do{n--}while(i[t[n]]>l);if(n<h)break;_(t,h,n)}t[s+1]=t[n],t[n]=r,e-h+1>=n-s?(o(t,i,h,e),o(t,i,s,n-1)):(o(t,i,s,n-1),o(t,i,h,e))}}function _(t,i,s){const e=t[i];t[i]=t[s],t[s]=e}function c(t){return t[0]}function u(t){return t[1]}exports.default=e;
},{"robust-predicates":"GTd0"}],"Jacx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const t=1e-6;class s{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,s){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+s}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,s){this._+=`L${this._x1=+t},${this._y1=+s}`}arc(s,i,h){const _=(s=+s)+(h=+h),e=i=+i;if(h<0)throw new Error("negative radius");null===this._x1?this._+=`M${_},${e}`:(Math.abs(this._x1-_)>t||Math.abs(this._y1-e)>t)&&(this._+="L"+_+","+e),h&&(this._+=`A${h},${h},0,1,1,${s-h},${i}A${h},${h},0,1,1,${this._x1=_},${this._y1=e}`)}rect(t,s,i,h){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+s}h${+i}v${+h}h${-i}Z`}value(){return this._||null}}exports.default=s;
},{}],"DMUE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class s{constructor(){this._=[]}moveTo(s,t){this._.push([s,t])}closePath(){this._.push(this._[0].slice())}lineTo(s,t){this._.push([s,t])}value(){return this._.length?this._:null}}exports.default=s;
},{}],"j03y":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=i(require("./path.js")),e=i(require("./polygon.js"));function i(t){return t&&t.__esModule?t:{default:t}}class n{constructor(t,[e,i,n,s]=[0,0,960,500]){if(!((n=+n)>=(e=+e)&&(s=+s)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=n,this.xmin=e,this.ymax=s,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:i},vectors:n}=this,s=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let m,x,d=0,f=0,g=i.length;d<g;d+=3,f+=2){const e=2*i[d],n=2*i[d+1],h=2*i[d+2],l=t[e],r=t[e+1],o=t[n],a=t[n+1],c=t[h],u=t[h+1],g=o-l,y=a-r,_=c-l,p=u-r,v=2*(g*p-y*_);if(Math.abs(v)<1e-9){let e=1e9;const n=2*i[0];m=(l+c)/2-(e*=Math.sign((t[n]-l)*p-(t[n+1]-r)*_))*p,x=(r+u)/2+e*_}else{const t=1/v,e=g*g+y*y,i=_*_+p*p;m=l+(p*e-y*i)*t,x=r+(g*i-_*e)*t}s[f]=m,s[f+1]=x}let h,l,r,o=e[e.length-1],a=4*o,c=t[2*o],u=t[2*o+1];n.fill(0);for(let m=0;m<e.length;++m)h=a,l=c,r=u,a=4*(o=e[m]),c=t[2*o],u=t[2*o+1],n[h+2]=n[a]=r-u,n[h+3]=n[a+1]=c-l}render(e){const i=null==e?e=new t.default:void 0,{delaunay:{halfedges:n,inedges:s,hull:h},circumcenters:l,vectors:r}=this;if(h.length<=1)return null;for(let t=0,c=n.length;t<c;++t){const i=n[t];if(i<t)continue;const s=2*Math.floor(t/3),h=2*Math.floor(i/3),r=l[s],o=l[s+1],a=l[h],c=l[h+1];this._renderSegment(r,o,a,c,e)}let o,a=h[h.length-1];for(let t=0;t<h.length;++t){o=a,a=h[t];const i=2*Math.floor(s[a]/3),n=l[i],c=l[i+1],u=4*o,m=this._project(n,c,r[u+2],r[u+3]);m&&this._renderSegment(n,c,m[0],m[1],e)}return i&&i.value()}renderBounds(e){const i=null==e?e=new t.default:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),i&&i.value()}renderCell(e,i){const n=null==i?i=new t.default:void 0,s=this._clip(e);if(null===s||!s.length)return;i.moveTo(s[0],s[1]);let h=s.length;for(;s[0]===s[h-2]&&s[1]===s[h-1]&&h>1;)h-=2;for(let t=2;t<h;t+=2)s[t]===s[t-2]&&s[t+1]===s[t-1]||i.lineTo(s[t],s[t+1]);return i.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,i=t.length/2;e<i;++e){const t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){const i=new e.default;return this.renderCell(t,i),i.value()}_renderSegment(t,e,i,n,s){let h;const l=this._regioncode(t,e),r=this._regioncode(i,n);0===l&&0===r?(s.moveTo(t,e),s.lineTo(i,n)):(h=this._clipSegment(t,e,i,n,l,r))&&(s.moveTo(h[0],h[1]),s.lineTo(h[2],h[3]))}contains(t,e,i){return(e=+e)==e&&(i=+i)==i&&this.delaunay._step(t,e,i)===t}*neighbors(t){const e=this._clip(t);if(e)for(const i of this.delaunay.neighbors(t)){const t=this._clip(i);if(t)t:for(let n=0,s=e.length;n<s;n+=2)for(let h=0,l=t.length;h<l;h+=2)if(e[n]==t[h]&&e[n+1]==t[h+1]&&e[(n+2)%s]==t[(h+l-2)%l]&&e[(n+3)%s]==t[(h+l-1)%l]){yield i;break t}}}_cell(t){const{circumcenters:e,delaunay:{inedges:i,halfedges:n,triangles:s}}=this,h=i[t];if(-1===h)return null;const l=[];let r=h;do{const i=Math.floor(r/3);if(l.push(e[2*i],e[2*i+1]),s[r=r%3==2?r-2:r+1]!==t)break;r=n[r]}while(r!==h&&-1!==r);return l}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(null===e)return null;const{vectors:i}=this,n=4*t;return i[n]||i[n+1]?this._clipInfinite(t,e,i[n],i[n+1],i[n+2],i[n+3]):this._clipFinite(t,e)}_clipFinite(t,e){const i=e.length;let n,s,h,l,r=null,o=e[i-2],a=e[i-1],c=this._regioncode(o,a),u=0;for(let m=0;m<i;m+=2)if(n=o,s=a,o=e[m],a=e[m+1],h=c,c=this._regioncode(o,a),0===h&&0===c)l=u,u=0,r?r.push(o,a):r=[o,a];else{let e,i,m,x,d;if(0===h){if(null===(e=this._clipSegment(n,s,o,a,h,c)))continue;[i,m,x,d]=e}else{if(null===(e=this._clipSegment(o,a,n,s,c,h)))continue;[x,d,i,m]=e,l=u,u=this._edgecode(i,m),l&&u&&this._edge(t,l,u,r,r.length),r?r.push(i,m):r=[i,m]}l=u,u=this._edgecode(x,d),l&&u&&this._edge(t,l,u,r,r.length),r?r.push(x,d):r=[x,d]}if(r)l=u,u=this._edgecode(r[0],r[1]),l&&u&&this._edge(t,l,u,r,r.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(t,e,i,n,s,h){for(;;){if(0===s&&0===h)return[t,e,i,n];if(s&h)return null;let l,r,o=s||h;8&o?(l=t+(i-t)*(this.ymax-e)/(n-e),r=this.ymax):4&o?(l=t+(i-t)*(this.ymin-e)/(n-e),r=this.ymin):2&o?(r=e+(n-e)*(this.xmax-t)/(i-t),l=this.xmax):(r=e+(n-e)*(this.xmin-t)/(i-t),l=this.xmin),s?(t=l,e=r,s=this._regioncode(t,e)):(i=l,n=r,h=this._regioncode(i,n))}}_clipInfinite(t,e,i,n,s,h){let l,r=Array.from(e);if((l=this._project(r[0],r[1],i,n))&&r.unshift(l[0],l[1]),(l=this._project(r[r.length-2],r[r.length-1],s,h))&&r.push(l[0],l[1]),r=this._clipFinite(t,r))for(let o,a=0,c=r.length,u=this._edgecode(r[c-2],r[c-1]);a<c;a+=2)o=u,u=this._edgecode(r[a],r[a+1]),o&&u&&(a=this._edge(t,o,u,r,a),c=r.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(r=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return r}_edge(t,e,i,n,s){for(;e!==i;){let i,h;switch(e){case 5:e=4;continue;case 4:e=6,i=this.xmax,h=this.ymin;break;case 6:e=2;continue;case 2:e=10,i=this.xmax,h=this.ymax;break;case 10:e=8;continue;case 8:e=9,i=this.xmin,h=this.ymax;break;case 9:e=1;continue;case 1:e=5,i=this.xmin,h=this.ymin}n[s]===i&&n[s+1]===h||!this.contains(t,i,h)||(n.splice(s,0,i,h),s+=2)}if(n.length>4)for(let h=0;h<n.length;h+=2){const t=(h+2)%n.length,e=(h+4)%n.length;(n[h]===n[t]&&n[t]===n[e]||n[h+1]===n[t+1]&&n[t+1]===n[e+1])&&(n.splice(t,2),h-=2)}return s}_project(t,e,i,n){let s,h,l,r=1/0;if(n<0){if(e<=this.ymin)return null;(s=(this.ymin-e)/n)<r&&(l=this.ymin,h=t+(r=s)*i)}else if(n>0){if(e>=this.ymax)return null;(s=(this.ymax-e)/n)<r&&(l=this.ymax,h=t+(r=s)*i)}if(i>0){if(t>=this.xmax)return null;(s=(this.xmax-t)/i)<r&&(h=this.xmax,l=e+(r=s)*n)}else if(i<0){if(t<=this.xmin)return null;(s=(this.xmin-t)/i)<r&&(h=this.xmin,l=e+(r=s)*n)}return[h,l]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}}exports.default=n;
},{"./path.js":"Jacx","./polygon.js":"DMUE"}],"UFGE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=r(require("delaunator")),e=r(require("./path.js")),n=r(require("./polygon.js")),l=r(require("./voronoi.js"));function r(t){return t&&t.__esModule?t:{default:t}}const i=2*Math.PI,o=Math.pow;function s(t){return t[0]}function h(t){return t[1]}function a(t){const{triangles:e,coords:n}=t;for(let l=0;l<e.length;l+=3){const t=2*e[l],r=2*e[l+1],i=2*e[l+2];if((n[i]-n[t])*(n[r+1]-n[t+1])-(n[r]-n[t])*(n[i+1]-n[t+1])>1e-10)return!1}return!0}function u(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class d{static from(t,e=s,n=h,l){return new d("length"in t?c(t,e,n,l):Float64Array.from(f(t,e,n,l)))}constructor(e){this._delaunator=new t.default(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,n=this.points;if(e.hull&&e.hull.length>2&&a(e)){this.collinear=Int32Array.from({length:n.length/2},(t,e)=>e).sort((t,e)=>n[2*t]-n[2*e]||n[2*t+1]-n[2*e+1]);const e=this.collinear[0],l=this.collinear[this.collinear.length-1],r=[n[2*e],n[2*e+1],n[2*l],n[2*l+1]],i=1e-8*Math.hypot(r[3]-r[1],r[2]-r[0]);for(let t=0,o=n.length/2;t<o;++t){const e=u(n[2*t],n[2*t+1],i);n[2*t]=e[0],n[2*t+1]=e[1]}this._delaunator=new t.default(n)}else delete this.collinear;const l=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),s=this._hullIndex.fill(-1);for(let t=0,h=l.length;t<h;++t){const e=i[t%3==2?t-2:t+1];-1!==l[t]&&-1!==o[e]||(o[e]=t)}for(let t=0,h=r.length;t<h;++t)s[r[t]]=t;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],o[r[0]]=1,2===r.length&&(o[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(t){return new l.default(this,t)}*neighbors(t){const{inedges:e,hull:n,_hullIndex:l,halfedges:r,triangles:i,collinear:o}=this;if(o){const e=o.indexOf(t);return e>0&&(yield o[e-1]),void(e<o.length-1&&(yield o[e+1]))}const s=e[t];if(-1===s)return;let h=s,a=-1;do{if(yield a=i[h],i[h=h%3==2?h-2:h+1]!==t)return;if(-1===(h=r[h])){const e=n[(l[t]+1)%n.length];return void(e!==a&&(yield e))}}while(h!==s)}find(t,e,n=0){if((t=+t)!=t||(e=+e)!=e)return-1;const l=n;let r;for(;(r=this._step(n,t,e))>=0&&r!==n&&r!==l;)n=r;return r}_step(t,e,n){const{inedges:l,hull:r,_hullIndex:i,halfedges:s,triangles:h,points:a}=this;if(-1===l[t]||!a.length)return(t+1)%(a.length>>1);let u=t,d=o(e-a[2*t],2)+o(n-a[2*t+1],2);const c=l[t];let f=c;do{let l=h[f];const c=o(e-a[2*l],2)+o(n-a[2*l+1],2);if(c<d&&(d=c,u=l),h[f=f%3==2?f-2:f+1]!==t)break;if(-1===(f=s[f])){if((f=r[(i[t]+1)%r.length])!==l&&o(e-a[2*f],2)+o(n-a[2*f+1],2)<d)return f;break}}while(f!==c);return u}render(t){const n=null==t?t=new e.default:void 0,{points:l,halfedges:r,triangles:i}=this;for(let e=0,o=r.length;e<o;++e){const n=r[e];if(n<e)continue;const o=2*i[e],s=2*i[n];t.moveTo(l[o],l[o+1]),t.lineTo(l[s],l[s+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n){void 0!==n||t&&"function"==typeof t.moveTo||(n=t,t=null),n=null==n?2:+n;const l=null==t?t=new e.default:void 0,{points:r}=this;for(let e=0,o=r.length;e<o;e+=2){const l=r[e],o=r[e+1];t.moveTo(l+n,o),t.arc(l,o,n,0,i)}return l&&l.value()}renderHull(t){const n=null==t?t=new e.default:void 0,{hull:l,points:r}=this,i=2*l[0],o=l.length;t.moveTo(r[i],r[i+1]);for(let e=1;e<o;++e){const n=2*l[e];t.lineTo(r[n],r[n+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new n.default;return this.renderHull(t),t.value()}renderTriangle(t,n){const l=null==n?n=new e.default:void 0,{points:r,triangles:i}=this,o=2*i[t*=3],s=2*i[t+1],h=2*i[t+2];return n.moveTo(r[o],r[o+1]),n.lineTo(r[s],r[s+1]),n.lineTo(r[h],r[h+1]),n.closePath(),l&&l.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,n=t.length/3;e<n;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new n.default;return this.renderTriangle(t,e),e.value()}}function c(t,e,n,l){const r=t.length,i=new Float64Array(2*r);for(let o=0;o<r;++o){const r=t[o];i[2*o]=e.call(l,r,o,t),i[2*o+1]=n.call(l,r,o,t)}return i}function*f(t,e,n,l){let r=0;for(const i of t)yield e.call(l,i,r,t),yield n.call(l,i,r,t),++r}exports.default=d;
},{"delaunator":"HpL9","./path.js":"Jacx","./polygon.js":"DMUE","./voronoi.js":"j03y"}],"V5JR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"Delaunay",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(exports,"Voronoi",{enumerable:!0,get:function(){return r.default}});var e=t(require("./delaunay.js")),r=t(require("./voronoi.js"));function t(e){return e&&e.__esModule?e:{default:e}}
},{"./delaunay.js":"UFGE","./voronoi.js":"j03y"}],"OeIr":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/coin.31c26154.gltf";
},{}],"eQs2":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/forest.247e38a1.glb";
},{}],"ZDQM":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/hat.309be9d2.gltf";
},{}],"M19K":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-00B8F4D4-0788-4589-8990-30392276A9A1.d9d9972f.jpg";
},{}],"Hn38":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/grasslands.240dd99b.glb";
},{}],"HRIK":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-09C359C3-EA97-43FD-8453-EC9CA692A632.cbad7768.jpg";
},{}],"v7AO":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-0A3C840A-1259-4342-94A8-476258923E0C.315a2ad2.jpg";
},{}],"r8Gx":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-0F0FDE45-D79C-4BED-8435-BC4ADA9274CA.bb723613.jpg";
},{}],"obJI":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-0DB6312F-078E-464F-9597-198B12899E4D.9ac46303.jpg";
},{}],"Z1K7":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-10C9B800-5663-492A-8F3A-BE6D7256387E.b9387781.jpg";
},{}],"J9Fr":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-10D47B3C-0A63-471C-BA7B-CB47E7D02180.c754c91f.jpg";
},{}],"SvX6":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-12A4C996-D2CC-4C87-8C3C-1F3795F690FB.35a3ca9c.jpg";
},{}],"e29E":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-19306294-F575-479A-AA37-C2DB5020A469.09418ed7.jpg";
},{}],"v4Za":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-1CCAE968-184E-480C-B5E3-F1BF49531917.eed52536.jpg";
},{}],"G1XX":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-21E564F9-6E87-423E-9BE9-F74AB206E92D.465b935c.jpg";
},{}],"z31m":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-32B3FAB6-DD31-48C9-8334-B07DE3E51145.e09b154f.jpg";
},{}],"jWN2":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-34A27C29-E664-4773-8598-BB5919C98FA6.3adc548e.jpg";
},{}],"n5iF":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-3CA1D1C7-F1C1-46A4-9892-094F299AA6FE.5db2e7ea.jpg";
},{}],"sWRj":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-3FA184EE-7612-4BE8-908B-7DCE43853884.37eb300e.jpg";
},{}],"J4aQ":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-52E899C7-8989-4282-947A-CC2F59CA3980.07d6981b.jpg";
},{}],"Z9o6":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-554D4548-E3F4-4F92-8137-887B88B2E0AD.6cb16c0e.jpg";
},{}],"NPm3":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-5B229F00-724F-42B0-A8B3-3F24E3FDD766.b1fa2fc0.jpg";
},{}],"YBfy":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-5E463828-72AC-4402-93B9-F1A30FBAF1A9.eec010f9.jpg";
},{}],"A8Qn":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-61639B10-AEB3-4390-AAFD-BA15E257F174.53217ebf.jpg";
},{}],"F70r":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-63F6AD0F-C910-4ACE-8E44-42C6AD977BDF.87e64d0f.jpg";
},{}],"t4wm":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-78AFFC78-486E-4369-ABE7-32A4EA5AA0B8.b5aa1f16.jpg";
},{}],"jHXo":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-7C18C970-2A9B-4102-B055-FACA22831659.a6d74558.jpg";
},{}],"v181":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-7CBCAA02-EA17-46A5-AA34-45B2B1C117CE.9d4e7c3d.jpg";
},{}],"et5O":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-7CE59BFE-2800-46A8-95EB-F3DD37D8656E.1b4eb24e.jpg";
},{}],"HTJ4":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-7E450930-809E-4C4D-ACDD-16ABB44DF03C.27fc5c8e.jpg";
},{}],"Xwz1":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-8079CEBE-B133-4A1C-A355-AA739C744021.7926acb1.jpg";
},{}],"CaDr":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-83109ECA-248E-4D88-86C5-3981E0207C79.5446f222.jpg";
},{}],"rQ89":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-84EECF42-EC52-4843-9D60-A84F2B2F189A.4b607883.jpg";
},{}],"XYjf":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-8A5767B2-5854-4C51-B601-B218F4B1CAB3.9be6ba14.jpg";
},{}],"Y6CR":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-8BE18773-E490-48B0-8799-F10071581689.beea8466.jpg";
},{}],"QI0B":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-91224C69-27C4-4875-B813-A4A02152F1C4.2bde5a44.jpg";
},{}],"qiHp":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-95E4709A-A35D-4B74-9CF9-3A00E8805100.98935ece.jpg";
},{}],"Lazj":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-9A24D72F-C314-4B3D-83E0-1633769C4335.e5421807.jpg";
},{}],"n0g6":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-B1791F03-1745-4A58-B1B2-E66309AA223F.e3bcd8f5.jpg";
},{}],"yISE":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-BFDA12FA-DBE0-4406-9958-86911E2D7B18.dfec83b2.jpg";
},{}],"vfYJ":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-C2C4D224-8C13-475F-9702-5A70F0E3EBD7.46c7c386.jpg";
},{}],"khDl":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-C3A29B8B-24E5-467A-8E02-EDF6666B9D3F.aa5393bf.jpg";
},{}],"VzTT":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-C5543422-F445-4649-AFCD-B5B391712333.243b2866.jpg";
},{}],"ccHh":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-C5F3CC47-6F6E-45E0-9016-57EF27C34A9B.e3ac6874.jpg";
},{}],"fjG6":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-CC23E800-B7E8-4754-BA53-2189F4137B27.59d88847.jpg";
},{}],"VSbE":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-CC6E3490-F52C-48B8-8FC3-E8E0D99C8C34.8d93a8ae.jpg";
},{}],"ryPM":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-CFA60390-A98D-4E16-8F6D-09215731619C.645e4d63.jpg";
},{}],"i5w0":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-D0FAACB8-0AB8-457C-81AC-68C561327489.b6a0d659.jpg";
},{}],"dlRv":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-D36B22A7-881B-408C-9904-A7473F83F16B.79ec212c.jpg";
},{}],"LzI5":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-D6FDDBD0-F9B3-45FC-8FB8-A64B16B5303C.109702c3.jpg";
},{}],"Kuh4":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-E9EACF7C-BD3B-4052-8366-C50F0FC1E6DA.329a9bd6.jpg";
},{}],"QxZJ":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/map-EEA7E9C1-3CBF-442E-A1AD-977ED4F0EB3A.e7e15f7e.jpg";
},{}],"tfG7":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/origin.f79198b4.glb";
},{}],"vpjo":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/sprites-forest-0.d9df067b.png";
},{}],"wkPH":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/sprites-forest-1.847c4a33.png";
},{}],"e0nd":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/sprites-grasslands-0.71b33a1e.png";
},{}],"E5Pn":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/sprites-origin-0.76951a78.png";
},{}],"MwS9":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/sprites-tundra-0.7a7b3335.png";
},{}],"S6FY":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/tundra.b5961f14.glb";
},{}],"BoYG":[function(require,module,exports) {
module.exports={coin:{gltf:require("./coin.gltf")},forest:{glb:require("./forest.glb")},hat:{gltf:require("./hat.gltf")},"map-00B8F4D4-0788-4589-8990-30392276A9A1":{jpg:require("./map-00B8F4D4-0788-4589-8990-30392276A9A1.jpg")},grasslands:{glb:require("./grasslands.glb")},"map-09C359C3-EA97-43FD-8453-EC9CA692A632":{jpg:require("./map-09C359C3-EA97-43FD-8453-EC9CA692A632.jpg")},"map-0A3C840A-1259-4342-94A8-476258923E0C":{jpg:require("./map-0A3C840A-1259-4342-94A8-476258923E0C.jpg")},"map-0F0FDE45-D79C-4BED-8435-BC4ADA9274CA":{jpg:require("./map-0F0FDE45-D79C-4BED-8435-BC4ADA9274CA.jpg")},"map-0DB6312F-078E-464F-9597-198B12899E4D":{jpg:require("./map-0DB6312F-078E-464F-9597-198B12899E4D.jpg")},"map-10C9B800-5663-492A-8F3A-BE6D7256387E":{jpg:require("./map-10C9B800-5663-492A-8F3A-BE6D7256387E.jpg")},"map-10D47B3C-0A63-471C-BA7B-CB47E7D02180":{jpg:require("./map-10D47B3C-0A63-471C-BA7B-CB47E7D02180.jpg")},"map-12A4C996-D2CC-4C87-8C3C-1F3795F690FB":{jpg:require("./map-12A4C996-D2CC-4C87-8C3C-1F3795F690FB.jpg")},"map-19306294-F575-479A-AA37-C2DB5020A469":{jpg:require("./map-19306294-F575-479A-AA37-C2DB5020A469.jpg")},"map-1CCAE968-184E-480C-B5E3-F1BF49531917":{jpg:require("./map-1CCAE968-184E-480C-B5E3-F1BF49531917.jpg")},"map-21E564F9-6E87-423E-9BE9-F74AB206E92D":{jpg:require("./map-21E564F9-6E87-423E-9BE9-F74AB206E92D.jpg")},"map-32B3FAB6-DD31-48C9-8334-B07DE3E51145":{jpg:require("./map-32B3FAB6-DD31-48C9-8334-B07DE3E51145.jpg")},"map-34A27C29-E664-4773-8598-BB5919C98FA6":{jpg:require("./map-34A27C29-E664-4773-8598-BB5919C98FA6.jpg")},"map-3CA1D1C7-F1C1-46A4-9892-094F299AA6FE":{jpg:require("./map-3CA1D1C7-F1C1-46A4-9892-094F299AA6FE.jpg")},"map-3FA184EE-7612-4BE8-908B-7DCE43853884":{jpg:require("./map-3FA184EE-7612-4BE8-908B-7DCE43853884.jpg")},"map-52E899C7-8989-4282-947A-CC2F59CA3980":{jpg:require("./map-52E899C7-8989-4282-947A-CC2F59CA3980.jpg")},"map-554D4548-E3F4-4F92-8137-887B88B2E0AD":{jpg:require("./map-554D4548-E3F4-4F92-8137-887B88B2E0AD.jpg")},"map-5B229F00-724F-42B0-A8B3-3F24E3FDD766":{jpg:require("./map-5B229F00-724F-42B0-A8B3-3F24E3FDD766.jpg")},"map-5E463828-72AC-4402-93B9-F1A30FBAF1A9":{jpg:require("./map-5E463828-72AC-4402-93B9-F1A30FBAF1A9.jpg")},"map-61639B10-AEB3-4390-AAFD-BA15E257F174":{jpg:require("./map-61639B10-AEB3-4390-AAFD-BA15E257F174.jpg")},"map-63F6AD0F-C910-4ACE-8E44-42C6AD977BDF":{jpg:require("./map-63F6AD0F-C910-4ACE-8E44-42C6AD977BDF.jpg")},"map-78AFFC78-486E-4369-ABE7-32A4EA5AA0B8":{jpg:require("./map-78AFFC78-486E-4369-ABE7-32A4EA5AA0B8.jpg")},"map-7C18C970-2A9B-4102-B055-FACA22831659":{jpg:require("./map-7C18C970-2A9B-4102-B055-FACA22831659.jpg")},"map-7CBCAA02-EA17-46A5-AA34-45B2B1C117CE":{jpg:require("./map-7CBCAA02-EA17-46A5-AA34-45B2B1C117CE.jpg")},"map-7CE59BFE-2800-46A8-95EB-F3DD37D8656E":{jpg:require("./map-7CE59BFE-2800-46A8-95EB-F3DD37D8656E.jpg")},"map-7E450930-809E-4C4D-ACDD-16ABB44DF03C":{jpg:require("./map-7E450930-809E-4C4D-ACDD-16ABB44DF03C.jpg")},"map-8079CEBE-B133-4A1C-A355-AA739C744021":{jpg:require("./map-8079CEBE-B133-4A1C-A355-AA739C744021.jpg")},"map-83109ECA-248E-4D88-86C5-3981E0207C79":{jpg:require("./map-83109ECA-248E-4D88-86C5-3981E0207C79.jpg")},"map-84EECF42-EC52-4843-9D60-A84F2B2F189A":{jpg:require("./map-84EECF42-EC52-4843-9D60-A84F2B2F189A.jpg")},"map-8A5767B2-5854-4C51-B601-B218F4B1CAB3":{jpg:require("./map-8A5767B2-5854-4C51-B601-B218F4B1CAB3.jpg")},"map-8BE18773-E490-48B0-8799-F10071581689":{jpg:require("./map-8BE18773-E490-48B0-8799-F10071581689.jpg")},"map-91224C69-27C4-4875-B813-A4A02152F1C4":{jpg:require("./map-91224C69-27C4-4875-B813-A4A02152F1C4.jpg")},"map-95E4709A-A35D-4B74-9CF9-3A00E8805100":{jpg:require("./map-95E4709A-A35D-4B74-9CF9-3A00E8805100.jpg")},"map-9A24D72F-C314-4B3D-83E0-1633769C4335":{jpg:require("./map-9A24D72F-C314-4B3D-83E0-1633769C4335.jpg")},"map-B1791F03-1745-4A58-B1B2-E66309AA223F":{jpg:require("./map-B1791F03-1745-4A58-B1B2-E66309AA223F.jpg")},"map-BFDA12FA-DBE0-4406-9958-86911E2D7B18":{jpg:require("./map-BFDA12FA-DBE0-4406-9958-86911E2D7B18.jpg")},"map-C2C4D224-8C13-475F-9702-5A70F0E3EBD7":{jpg:require("./map-C2C4D224-8C13-475F-9702-5A70F0E3EBD7.jpg")},"map-C3A29B8B-24E5-467A-8E02-EDF6666B9D3F":{jpg:require("./map-C3A29B8B-24E5-467A-8E02-EDF6666B9D3F.jpg")},"map-C5543422-F445-4649-AFCD-B5B391712333":{jpg:require("./map-C5543422-F445-4649-AFCD-B5B391712333.jpg")},"map-C5F3CC47-6F6E-45E0-9016-57EF27C34A9B":{jpg:require("./map-C5F3CC47-6F6E-45E0-9016-57EF27C34A9B.jpg")},"map-CC23E800-B7E8-4754-BA53-2189F4137B27":{jpg:require("./map-CC23E800-B7E8-4754-BA53-2189F4137B27.jpg")},"map-CC6E3490-F52C-48B8-8FC3-E8E0D99C8C34":{jpg:require("./map-CC6E3490-F52C-48B8-8FC3-E8E0D99C8C34.jpg")},"map-CFA60390-A98D-4E16-8F6D-09215731619C":{jpg:require("./map-CFA60390-A98D-4E16-8F6D-09215731619C.jpg")},"map-D0FAACB8-0AB8-457C-81AC-68C561327489":{jpg:require("./map-D0FAACB8-0AB8-457C-81AC-68C561327489.jpg")},"map-D36B22A7-881B-408C-9904-A7473F83F16B":{jpg:require("./map-D36B22A7-881B-408C-9904-A7473F83F16B.jpg")},"map-D6FDDBD0-F9B3-45FC-8FB8-A64B16B5303C":{jpg:require("./map-D6FDDBD0-F9B3-45FC-8FB8-A64B16B5303C.jpg")},"map-E9EACF7C-BD3B-4052-8366-C50F0FC1E6DA":{jpg:require("./map-E9EACF7C-BD3B-4052-8366-C50F0FC1E6DA.jpg")},"map-EEA7E9C1-3CBF-442E-A1AD-977ED4F0EB3A":{jpg:require("./map-EEA7E9C1-3CBF-442E-A1AD-977ED4F0EB3A.jpg")},origin:{glb:require("./origin.glb")},"sprites-forest-0":{png:require("./sprites-forest-0.png")},"sprites-forest-1":{png:require("./sprites-forest-1.png")},"sprites-grasslands-0":{png:require("./sprites-grasslands-0.png")},"sprites-origin-0":{png:require("./sprites-origin-0.png")},"sprites-tundra-0":{png:require("./sprites-tundra-0.png")},tundra:{glb:require("./tundra.glb")}};
},{"./coin.gltf":"OeIr","./forest.glb":"eQs2","./hat.gltf":"ZDQM","./map-00B8F4D4-0788-4589-8990-30392276A9A1.jpg":"M19K","./grasslands.glb":"Hn38","./map-09C359C3-EA97-43FD-8453-EC9CA692A632.jpg":"HRIK","./map-0A3C840A-1259-4342-94A8-476258923E0C.jpg":"v7AO","./map-0F0FDE45-D79C-4BED-8435-BC4ADA9274CA.jpg":"r8Gx","./map-0DB6312F-078E-464F-9597-198B12899E4D.jpg":"obJI","./map-10C9B800-5663-492A-8F3A-BE6D7256387E.jpg":"Z1K7","./map-10D47B3C-0A63-471C-BA7B-CB47E7D02180.jpg":"J9Fr","./map-12A4C996-D2CC-4C87-8C3C-1F3795F690FB.jpg":"SvX6","./map-19306294-F575-479A-AA37-C2DB5020A469.jpg":"e29E","./map-1CCAE968-184E-480C-B5E3-F1BF49531917.jpg":"v4Za","./map-21E564F9-6E87-423E-9BE9-F74AB206E92D.jpg":"G1XX","./map-32B3FAB6-DD31-48C9-8334-B07DE3E51145.jpg":"z31m","./map-34A27C29-E664-4773-8598-BB5919C98FA6.jpg":"jWN2","./map-3CA1D1C7-F1C1-46A4-9892-094F299AA6FE.jpg":"n5iF","./map-3FA184EE-7612-4BE8-908B-7DCE43853884.jpg":"sWRj","./map-52E899C7-8989-4282-947A-CC2F59CA3980.jpg":"J4aQ","./map-554D4548-E3F4-4F92-8137-887B88B2E0AD.jpg":"Z9o6","./map-5B229F00-724F-42B0-A8B3-3F24E3FDD766.jpg":"NPm3","./map-5E463828-72AC-4402-93B9-F1A30FBAF1A9.jpg":"YBfy","./map-61639B10-AEB3-4390-AAFD-BA15E257F174.jpg":"A8Qn","./map-63F6AD0F-C910-4ACE-8E44-42C6AD977BDF.jpg":"F70r","./map-78AFFC78-486E-4369-ABE7-32A4EA5AA0B8.jpg":"t4wm","./map-7C18C970-2A9B-4102-B055-FACA22831659.jpg":"jHXo","./map-7CBCAA02-EA17-46A5-AA34-45B2B1C117CE.jpg":"v181","./map-7CE59BFE-2800-46A8-95EB-F3DD37D8656E.jpg":"et5O","./map-7E450930-809E-4C4D-ACDD-16ABB44DF03C.jpg":"HTJ4","./map-8079CEBE-B133-4A1C-A355-AA739C744021.jpg":"Xwz1","./map-83109ECA-248E-4D88-86C5-3981E0207C79.jpg":"CaDr","./map-84EECF42-EC52-4843-9D60-A84F2B2F189A.jpg":"rQ89","./map-8A5767B2-5854-4C51-B601-B218F4B1CAB3.jpg":"XYjf","./map-8BE18773-E490-48B0-8799-F10071581689.jpg":"Y6CR","./map-91224C69-27C4-4875-B813-A4A02152F1C4.jpg":"QI0B","./map-95E4709A-A35D-4B74-9CF9-3A00E8805100.jpg":"qiHp","./map-9A24D72F-C314-4B3D-83E0-1633769C4335.jpg":"Lazj","./map-B1791F03-1745-4A58-B1B2-E66309AA223F.jpg":"n0g6","./map-BFDA12FA-DBE0-4406-9958-86911E2D7B18.jpg":"yISE","./map-C2C4D224-8C13-475F-9702-5A70F0E3EBD7.jpg":"vfYJ","./map-C3A29B8B-24E5-467A-8E02-EDF6666B9D3F.jpg":"khDl","./map-C5543422-F445-4649-AFCD-B5B391712333.jpg":"VzTT","./map-C5F3CC47-6F6E-45E0-9016-57EF27C34A9B.jpg":"ccHh","./map-CC23E800-B7E8-4754-BA53-2189F4137B27.jpg":"fjG6","./map-CC6E3490-F52C-48B8-8FC3-E8E0D99C8C34.jpg":"VSbE","./map-CFA60390-A98D-4E16-8F6D-09215731619C.jpg":"ryPM","./map-D0FAACB8-0AB8-457C-81AC-68C561327489.jpg":"i5w0","./map-D36B22A7-881B-408C-9904-A7473F83F16B.jpg":"dlRv","./map-D6FDDBD0-F9B3-45FC-8FB8-A64B16B5303C.jpg":"LzI5","./map-E9EACF7C-BD3B-4052-8366-C50F0FC1E6DA.jpg":"Kuh4","./map-EEA7E9C1-3CBF-442E-A1AD-977ED4F0EB3A.jpg":"QxZJ","./origin.glb":"tfG7","./sprites-forest-0.png":"vpjo","./sprites-forest-1.png":"wkPH","./sprites-grasslands-0.png":"e0nd","./sprites-origin-0.png":"E5Pn","./sprites-tundra-0.png":"MwS9","./tundra.glb":"S6FY"}],"oB7B":[function(require,module,exports) {
module.exports=module.exports={"forest-items-autumn":{type:"forest",boundingBox:[[-15.075365,-.201858,-9.123892],[15.075365,10.988423,9.123892]],boundingCircle:{center:[0,0],radius:17.62135168228842}},"forest-items-dry":{type:"forest",boundingBox:[[-20.1001245,-.166717,-11.677783],[20.1001245,10.988423,11.677783]],boundingCircle:{center:[0,0],radius:23.246195833094696}},"forest-items-triangle":{type:"forest",boundingBox:[[-16.3033225,-.166717,-9.929113000000001],[16.3033225,10.988423,9.929113000000001]],boundingCircle:{center:[0,0],radius:19.088887068285967}},"forest-patch-01":{type:"forest",boundingBox:[[-4.282827470550442,-.225994,-5.5629157463329975],[4.282827470550442,16.013626,5.5629157463329975]],boundingCircle:{center:[0,0],radius:7.020587065431289}},"forest-patch-02":{type:"forest",boundingBox:[[-5.679010180449813,-.8172855571679642,-4.018972643388868],[5.679010180449813,13.773834,4.018972643388867]],boundingCircle:{center:[0,-8.881784197001252e-16],radius:6.9572478565852975}},"forest-patch-03":{type:"forest",boundingBox:[[-7.050933692768162,-2.0237250280074877,-6.357039456992861],[7.05093369277567,16.096272,6.357039456992576]],boundingCircle:{center:[3.754330180072429e-12,-1.4299672557172016e-13],radius:9.493556583158309}},"forest-patch-04":{type:"forest",boundingBox:[[-11.78628,-1.5445471634768424,-7.587937542475294],[11.78628,15.291956,7.5879377151416705]],boundingCircle:{center:[0,8.63331885980756e-8],radius:14.01760299398894}},"forest-patch-05":{type:"forest",boundingBox:[[-12.62494825,-1.5445471634768424,-11.368848],[12.62494825,14.61118,11.368848]],boundingCircle:{center:[0,0],radius:16.989409146944517}},"forest-patch-06":{type:"forest",boundingBox:[[-10.70346825,-1.5445471634768424,-11.918848],[10.70346825,14.61118,11.918848]],boundingCircle:{center:[0,0],radius:16.019462232729975}},"forest-patch-07":{type:"forest",boundingBox:[[-14.5646979992935,-.3694360944802759,-17.295879783627747],[14.564697999293498,20.0170325,17.295879783627747]],boundingCircle:{center:[0,0],radius:22.6114547364898}},"forest-patch-08":{type:"forest",boundingBox:[[-18.971581498912506,-.327765,-18.083026509657323],[18.971581498912506,1.856911,18.083026509657323]],boundingCircle:{center:[0,0],radius:26.209096747481567}},"forest-patch-09":{type:"forest",boundingBox:[[-8.731351668853138,-.327765,-6.684054056717754],[8.73135166885314,1.486463,6.684054056717753]],boundingCircle:{center:[1.7763568394002505e-15,0],radius:10.996048408328765}},"forest-patch-10":{type:"forest",boundingBox:[[-11.197153498005997,-.268145,-7.866099509657324],[11.197153498006,1.856911,7.866099509657323]],boundingCircle:{center:[1.7763568394002505e-15,-8.881784197001252e-16],radius:13.683996782875212}},"forest-patch-11":{type:"forest",boundingBox:[[-8.983995498912504,-.268145,-7.866099509657324],[8.983995498912506,1.486463,7.866099509657323]],boundingCircle:{center:[1.7763568394002505e-15,-8.881784197001252e-16],radius:11.941009028566695}},"forest-patch-12":{type:"forest",boundingBox:[[-7.330616433621152,-.3694360944802759,-8.510333287792683],[7.330616433621153,14.043758,8.510333287792681]],boundingCircle:{center:[0,0],radius:11.232262014669562}},"forest-patch-13":{type:"forest",boundingBox:[[-14.2951739443525,-.6105425455860001,-8.432619685039],[14.2951739443525,14.967650787505,8.432619685039]],boundingCircle:{center:[0,0],radius:16.597019999138457}},"forest-patch-14":{type:"forest",boundingBox:[[-9.470601411567001,-.6105425455860001,-7.050573921378],[9.470601411567,13.472909359065,7.050573921378]],boundingCircle:{center:[-1.7763568394002505e-15,0],radius:11.806899835163776}},"forest-patch-15":{type:"forest",boundingBox:[[-6.347426777728752,-.34234517972188266,-8.205905287232017],[6.347426777728751,14.967650787505,8.205905287232017]],boundingCircle:{center:[-8.881784197001252e-16,0],radius:10.37432929309892}},"forest-patch-16":{type:"forest",boundingBox:[[-13.431709136212001,-.6105425455860001,-8.432619685039],[13.431709136212001,14.967650787505,8.432619685039]],boundingCircle:{center:[0,0],radius:15.859378457944317}},"forest-patch-17":{type:"forest",boundingBox:[[-7.59376126906725,-.6105425455860001,-7.050573921378],[7.593761269067249,14.482444680213,7.050573921378]],boundingCircle:{center:[-8.881784197001252e-16,0],radius:10.3622296265042}},"forest-patch-18":{type:"forest",boundingBox:[[-5.5603789513075,-.03805385048043891,-8.205905287232017],[5.560378951307501,14.967650787505,8.205905287232017]],boundingCircle:{center:[0,0],radius:9.912350662943975}},"origin-patch-0":{type:"origin",boundingBox:[[-5.280339000000001,-.2832338416705871,-5.668591315287967],[5.001145,10.19964,3.65937712011832]],boundingCircle:{center:[-.1395970000000002,-1.004607097584823],radius:6.941179805591266}},"tundra-items-basic":{type:"tundra",boundingBox:[[-8.8325125,-.13764725184078516,-11.163409000000001],[8.8325125,3.927917,11.163409000000001]],boundingCircle:{center:[0,0],radius:14.23499130888169}},"tundra-items-ice":{type:"tundra",boundingBox:[[-10.259167378689172,-.4111513000239432,-8.718396812160492],[10.25916737868917,1.1697286148071289,8.718396812160492]],boundingCircle:{center:[-1.7763568394002505e-15,0],radius:13.463318991922097}},"tundra-patch-rock-01":{type:"tundra",boundingBox:[[-8.469741291864153,-.22670792279715837,-11.065931719579186],[8.469741291864157,6.068279626955509,11.065931719579186]],boundingCircle:{center:[1.7763568394002505e-15,0],radius:13.935256092856616}},"tundra-patch-rock-02":{type:"tundra",boundingBox:[[-16.520271783891413,-.6568209019796876,-11.133370217871766],[16.52027178389141,10.381391628779411,11.133370217871768]],boundingCircle:{center:[-3.552713678800501e-15,1.7763568394002505e-15],radius:19.92162925620876}},"tundra-patch-rock-03":{type:"tundra",boundingBox:[[-10.268560327452711,-3.6310188780527115,-9.497291529625407],[10.018307334331904,4.905083811461026,9.49729152966382]],boundingCircle:{center:[-.1251264965604033,1.9205970147595508e-11],radius:13.895603487461416}},"tundra-patch-rock-04":{type:"tundra",boundingBox:[[-7.87126668514793,-2.1669320795611555,-8.236571820530331],[7.871266685387804,2.4768795429526858,8.236571820530333]],boundingCircle:{center:[1.199369492610458e-10,1.7763568394002505e-15],radius:11.392890528104013}},"tundra-patch-rock-05":{type:"tundra",boundingBox:[[-9.35049296050986,-3.0744205886997986,-8.983492483035336],[9.350493216352906,4.3417406702058505,8.983492484233793]],boundingCircle:{center:[1.279215222638186e-7,5.992273344190835e-10],radius:12.966682621253662}},"tundra-patch-rock-06":{type:"tundra",boundingBox:[[-14.893484516967165,-5.467920771498083,-14.308852236946258],[14.063264769059757,6.345591006819735,13.383327007132198]],boundingCircle:{center:[-.41510987395370513,-.46276261490702986],radius:20.033410346843034}},"tundra-patch-rock-07":{type:"tundra",boundingBox:[[-14.407030459073379,-5.467920771498083,-9.779526112076555],[13.576810711165969,5.790646771498082,9.779526112076555]],boundingCircle:{center:[-.41510987395370513,0],radius:17.070822260133895}},"tundra-patch-rock-08":{type:"tundra",boundingBox:[[-11.606490749999999,-4.038116878052712,-8.678903948533314],[11.60649075,4.8079788993186945,8.678903704277717]],boundingCircle:{center:[0,-1.2212779765263804e-7],radius:14.49254978110587}},"grasslands-items-field":{type:"grasslands",boundingBox:[[-7.623313964143387,-.174038,-10.987582973752348],[7.623313964143387,2.62681,10.98758297375235]],boundingCircle:{center:[0,1.7763568394002505e-15],radius:13.373178208675606}},"grasslands-items-water":{type:"grasslands",boundingBox:[[-4.323165250000001,-.0691744677450005,-2.7235592888081],[4.32316525,1.8051,2.7235592888081]],boundingCircle:{center:[0,0],radius:5.109553109466663}},"grasslands-items-wet":{type:"grasslands",boundingBox:[[-7.412936621334076,0,-9.3358775],[7.412936621334076,1.887006,9.3358775]],boundingCircle:{center:[0,0],radius:11.920999876139675}},"grasslands-items-yellow":{type:"grasslands",boundingBox:[[-9.128126714143386,-.05953242321757357,-10.987582973752348],[9.128126714143386,1.847419,10.98758297375235]],boundingCircle:{center:[0,1.7763568394002505e-15],radius:14.284595791080358}},"grasslands-patch-01":{type:"grasslands",boundingBox:[[-14.959938216016791,-3.6909649259600004,-15.666905179722484],[14.959938216016791,4.328240447011341,15.666905179722482]],boundingCircle:{center:[0,0],radius:21.66221755355289}},"grasslands-patch-02":{type:"grasslands",boundingBox:[[-15.080166880418545,-.7677941213827133,-15.51645185207366],[15.080166880418542,4.411131786013842,15.51645185207366]],boundingCircle:{center:[-1.7763568394002505e-15,0],radius:21.63727596577241}},"grasslands-patch-03":{type:"grasslands",boundingBox:[[-14.960831770021974,-.7677941213827133,-9.253754335327436],[14.960831770021972,4.411131786013842,9.253754335327436]],boundingCircle:{center:[-1.7763568394002505e-15,0],radius:17.59143133885046}},"grasslands-patch-04":{type:"grasslands",boundingBox:[[-11.609907879139005,-.7408588420858384,-10.60802881274413],[11.609907879139005,5.171772259669173,10.60802881274413]],boundingCircle:{center:[0,0],radius:15.726418417875813}},"grasslands-patch-05":{type:"grasslands",boundingBox:[[-10.771474194501113,-1.108371,-9.920363270294326],[10.771474194501112,4.488878414156625,9.920363270294327]],boundingCircle:{center:[0,1.7763568394002505e-15],radius:14.643710722948887}},"grasslands-patch-06":{type:"grasslands",boundingBox:[[-8.876350413088124,-.360653,-8.983931123813939],[8.876350413088124,3.158583462026596,8.983931123813939]],boundingCircle:{center:[0,0],radius:12.629355292071029}},"grasslands-patch-07":{type:"grasslands",boundingBox:[[-15.12404227126358,-.437882,-15.125275886896539],[15.12404227126358,2.64724140059495,15.125275886896539]],boundingCircle:{center:[0,0],radius:21.389498013691238}},"grasslands-patch-08":{type:"grasslands",boundingBox:[[-15.495199489332597,-.437882,-15.53378018801633],[15.495199489332599,2.64724140059495,15.533780188016332]],boundingCircle:{center:[1.7763568394002505e-15,0],radius:21.940818903218307}},"grasslands-patch-09":{type:"grasslands",boundingBox:[[-15.495199489332597,-.437882,-15.53378018801633],[15.495199489332599,2.64724140059495,15.533780188016332]],boundingCircle:{center:[1.7763568394002505e-15,0],radius:21.940818903218307}},"grasslands-patch-10":{type:"grasslands",boundingBox:[[-15.204815010466952,-.437882,-15.125275886896539],[15.204815010466952,1.4065690000000002,15.125275886896539]],boundingCircle:{center:[0,0],radius:21.446686694155233}},"grasslands-patch-11":{type:"grasslands",boundingBox:[[-6.212267913747341,-.053716637376036436,-7.429459542071392],[6.2122679137473416,4.328240447011341,7.429459542071392]],boundingCircle:{center:[8.881784197001252e-16,0],radius:9.684479424287627}},"grasslands-patch-wetlands-01":{type:"grasslands",boundingBox:[[-7.17840425,-.477838,-4.578204980444312],[7.17840425,1.893844,4.578204980444312]],boundingCircle:{center:[0,0],radius:8.514073550268588}},"grasslands-patch-wetlands-02":{type:"grasslands",boundingBox:[[-6.306689158825398,-.743551,-4.0401339732815025],[6.306689158825398,1.893844,4.0401339732815025]],boundingCircle:{center:[0,0],radius:7.489793766727438}},"grasslands-patch-wetlands-03":{type:"grasslands",boundingBox:[[-7.119687073700281,-.477838,-4.3895528552785725],[7.119687073700281,3.1333588074259757,4.389552855278571]],boundingCircle:{center:[0,-8.881784197001252e-16],radius:8.364096980349949}},"grasslands-patch-wetlands-04":{type:"grasslands",boundingBox:[[-5.479535,-.1604245623280853,-3.483777072610855],[5.479535,2.1422665485835077,3.483777072610855]],boundingCircle:{center:[0,0],radius:6.493227741876459}},"grasslands-patch-wetlands-05":{type:"grasslands",boundingBox:[[-6.196706936844499,-.477838,-5.6178066792835],[6.1967069368445,1.893844,5.617806679283499]],boundingCircle:{center:[8.881784197001252e-16,-8.881784197001252e-16],radius:8.364145428370973}},"grasslands-patch-wetlands-06":{type:"grasslands",boundingBox:[[-9.886904918619768,-.477838,-6.46925514625175],[9.886904918619766,1.929008,6.469255146251749]],boundingCircle:{center:[-1.7763568394002505e-15,-8.881784197001252e-16],radius:11.815335417038844}},"grasslands-patch-wetlands-07":{type:"grasslands",boundingBox:[[-6.402575567778268,-.477838,-5.982054236971601],[6.402575567778268,1.929008,5.982054236971601]],boundingCircle:{center:[0,0],radius:8.762302596645535}}};
},{}],"rtNM":[function(require,module,exports) {
module.exports=module.exports={name:"sprites-forest",frames:[[{id:"67294C14-EF1A-4AF8-BB5F-8931621A01F8",x:2,y:2,w:706,h:256},{id:"D3023B91-0D14-4C90-8F6D-2CA9E616804A",x:2,y:260,w:706,h:256},{id:"15FDCF1E-B75B-4AD5-9A1F-51462126B983",x:2,y:518,w:660,h:256},{id:"D0C25487-3087-47CD-B9C8-FC37D7E87396",x:664,y:518,w:660,h:256},{id:"9F9AFA55-44A5-4539-8066-786C33BFA3CF",x:710,y:2,w:580,h:154},{id:"694CC69A-37B1-4108-BD6B-BD6D80C765A5",x:710,y:158,w:580,h:154},{id:"3C4AE536-1BCE-48D7-90E0-6EA95120DB56",x:2,y:776,w:319,h:512},{id:"200B1345-E245-4BD6-A133-D362B8C79468",x:323,y:776,w:284,h:512},{id:"7FD2B13D-374A-4FBA-B0B8-6AFF6D0AD473",x:609,y:776,w:255,h:512},{id:"5200A118-22E4-446B-B07F-E1AB2D8275D7",x:866,y:776,w:243,h:512},{id:"474D93F1-70A8-4B81-BAB1-83CDEF88983B",x:2,y:1290,w:280,h:512},{id:"FB1FE2FA-8594-492D-8A27-7C3268B0302B",x:284,y:1290,w:354,h:512},{id:"76635BA8-2B70-45C0-8284-5009E6C13D3A",x:640,y:1290,w:354,h:512},{id:"BB410FB3-19E2-42EC-B23A-1A065363C543",x:996,y:1290,w:243,h:512},{id:"64135345-B589-4847-9449-CE88B327F315",x:1111,y:776,w:150,h:512},{id:"E113EB20-B7F7-46BD-9065-A91588D2A1EC",x:1241,y:1290,w:169,h:512},{id:"B7B3A496-E705-4973-B0FF-BA1D43B42F4F",x:1263,y:776,w:256,h:512},{id:"6FDC8BD1-0459-49DA-A212-611A7E9F607F",x:1412,y:1290,w:312,h:501},{id:"6A045629-CB5F-45ED-974F-7F4F5EEC138D",x:1292,y:2,w:312,h:501},{id:"A4FD1645-A4D5-4A87-95BB-DE692A857F7B",x:1521,y:505,w:312,h:501},{id:"7946261F-3A99-4652-802B-58EDAC13FB69",x:710,y:314,w:472,h:125},{id:"C9587649-B939-45E8-9097-F909053FD963",x:2,y:1804,w:472,h:125},{id:"E409C6F3-5350-473F-9957-CC005E66DA10",x:1521,y:1008,w:333,h:256},{id:"D5E397E9-F9CC-4430-8403-CD74DDB4A09A",x:1606,y:2,w:214,h:256},{id:"4DEBC28F-CC95-4631-B620-86E50A2282D1",x:1326,y:505,w:184,h:256},{id:"9B20BD15-62FA-4669-8829-13981D18F6FE",x:1726,y:1266,w:113,h:256},{id:"7E224099-CB10-480E-AA42-BDA2C5EE2DCE",x:1606,y:260,w:151,h:181},{id:"72C6CB9C-EF46-46E5-B277-D4A082D0C704",x:1856,y:2,w:151,h:181},{id:"7A047DBE-B785-4A6F-A7D1-18654BEC802F",x:476,y:1804,w:52,h:106},{id:"C5F6AD70-D605-40AD-8055-143DAC798B46",x:530,y:1804,w:60,h:83},{id:"C342A4B3-66C6-45E5-A39F-FBC4FE5A085E",x:592,y:1804,w:60,h:83}],[{id:"E44FE03F-EC29-4753-AF0E-895B951AFD42",x:2,y:2,w:488,h:256},{id:"34E60BA5-7E9D-4BDA-B6E5-19E474F18C84",x:2,y:260,w:488,h:256},{id:"1F644C9D-CE32-4667-A423-212879544372",x:492,y:2,w:431,h:143},{id:"77BF338F-5948-4A23-900D-652440F7C5A7",x:492,y:147,w:348,h:185},{id:"4F18AF0D-5A0E-43BD-B5DC-D7AB1AE2F51B",x:492,y:334,w:300,h:175},{id:"2150843C-15A9-4274-980E-3244D20CAA59",x:2,y:518,w:292,h:256},{id:"A65F86AF-621C-4D69-9383-232F4A045463",x:296,y:518,w:286,h:256},{id:"531C91F2-2508-469A-8117-E2E981EA6A33",x:584,y:511,w:257,h:203},{id:"35B446D4-87AC-452F-AC6C-F88D4F38CD8A",x:2,y:776,w:214,h:256},{id:"3111DE17-2B61-4EBE-8BA4-D7EC477AD571",x:218,y:776,w:213,h:256},{id:"55DFC82B-9970-44B3-A887-654CA5BB772D",x:433,y:776,w:233,h:256},{id:"A32211DA-F0B6-4449-A465-66015AC5ABE5",x:668,y:716,w:249,h:256}]],images:[{width:2010,height:1931},{width:925,height:1034}]};
},{}],"Ovqv":[function(require,module,exports) {
module.exports=module.exports={name:"sprites-grasslands",frames:[[{id:"272CEE5F-A472-4CA5-A600-88C97949B9D1",x:2,y:2,w:613,h:256},{id:"92C81C7F-4C91-4A70-BA1B-B2B2B1E47A9B",x:2,y:260,w:564,h:256},{id:"FE57E7C9-22FB-44A6-93B4-2045102DDF6B",x:2,y:518,w:462,h:256},{id:"6FA38119-6C0C-44F3-889F-496E8D51D25A",x:617,y:2,w:379,h:248},{id:"14D5CD8C-26D1-4B3E-B5CB-6268B7F2910D",x:466,y:518,w:319,h:256},{id:"C1A7A698-9EBB-4B24-932E-72D6120A3FFB",x:568,y:260,w:319,h:256},{id:"447CCD67-AA9F-4D4D-831E-2D4B4AC39FA3",x:2,y:776,w:319,h:256},{id:"BB607FAF-EF57-4EC6-853B-4F8AA9D94099",x:323,y:776,w:319,h:256},{id:"87C25A5F-357A-4ED4-AE02-C3BC9A00B125",x:644,y:776,w:284,h:197},{id:"4282A509-F0EE-4B3A-8A0A-3716682CBA18",x:787,y:518,w:59,h:256},{id:"26F6F112-A247-43B6-A304-A096C69397C3",x:848,y:518,w:59,h:256},{id:"38583CBC-4C68-47B6-8AC2-762F789EC3A5",x:889,y:252,w:77,h:256},{id:"656660D5-68B2-4509-854E-A6FA2D70D809",x:998,y:2,w:129,h:256},{id:"8225022F-694B-4EE7-AE15-A87FB613D243",x:909,y:510,w:151,h:256},{id:"10476B9E-A1C7-4BA0-BC31-B580E3A2D252",x:930,y:768,w:151,h:256},{id:"997789AE-F835-4778-95A7-A35CD2E43E4D",x:2,y:1034,w:128,h:256},{id:"2D285696-01B4-4459-AD74-4BB85BA63FCF",x:132,y:1034,w:224,h:256},{id:"4A747DC3-EF7B-492A-96DD-F862FBDBFDB5",x:358,y:1034,w:140,h:256},{id:"159F5249-279B-4252-82C4-C41A0F0B7BC0",x:500,y:1034,w:179,h:256},{id:"177F1D36-0623-4ACF-91FF-3D7119452232",x:681,y:1026,w:150,h:256},{id:"39B9478E-3AAE-4D2B-93B6-CB8C4EECFC80",x:833,y:1026,w:224,h:256},{id:"AD1BF24C-4FD3-4FCF-93EA-09E93B2E313B",x:1129,y:2,w:215,h:256},{id:"F342F4E7-C2C0-4E3C-9FB7-93349C420A46",x:968,y:252,w:25,h:256},{id:"8D0A87D9-B1F6-48C1-8F04-CD1F59BE22F3",x:1059,y:1026,w:215,h:256},{id:"4895E2C7-D5D5-4D02-88CE-77E1BBA9913D",x:1083,y:260,w:88,h:256},{id:"E55BD68A-8FD1-45D1-A01F-43CB85807C59",x:1276,y:260,w:47,h:256},{id:"4E515EB2-B904-442B-BCDB-7D671447F7C6",x:1173,y:260,w:88,h:256},{id:"14B6073B-71AD-4486-B074-1FC52F371FDB",x:1083,y:518,w:173,h:256},{id:"8CBE7088-0036-4A84-90B3-F8A42FE538B8",x:2,y:1292,w:248,h:256},{id:"DA1E3CE8-278B-47B9-BF7B-438E5F5BF687",x:252,y:1292,w:176,h:256},{id:"66A3A3B8-1F1A-4CFF-8D90-CA6045326BBD",x:430,y:1292,w:113,h:256},{id:"28B0D1BD-9F16-4B35-8B58-B4AEAD15134D",x:545,y:1292,w:214,h:256},{id:"C9DAEE46-E76B-4E1F-9FA5-D4B631BE3BB0",x:761,y:1284,w:190,h:256},{id:"C17EE260-68CC-4154-8486-E556444748A0",x:953,y:1284,w:224,h:256},{id:"78B40147-FE41-47F1-A198-08E7F1666C6F",x:1179,y:1284,w:113,h:256},{id:"845BAF92-DAA7-4D5B-AC73-5F1FCB0D98A2",x:1346,y:2,w:176,h:256},{id:"4A3A388F-7316-46A6-A459-79BB449DE3BF",x:1294,y:518,w:224,h:256},{id:"FF97616C-0E3F-4DD7-B21D-9C62E034E1C5",x:1325,y:260,w:100,h:256},{id:"829BF8AC-A4B1-4BF8-8376-04162F33CD76",x:1294,y:776,w:153,h:256},{id:"596C0606-0D9C-436F-9760-75258E264B0D",x:1294,y:1034,w:153,h:256},{id:"42343ABE-D860-4F4D-B74D-1E2809226F61",x:1294,y:1292,w:100,h:256},{id:"DB5AFCB3-5F84-4E19-93B6-30A3C6C12959",x:1427,y:260,w:173,h:256},{id:"B28BDFF1-A351-4EB0-B74D-25BD39CBF590",x:1396,y:1292,w:125,h:256},{id:"328AD96F-C60B-4B4E-A543-0AD2A427204E",x:1524,y:2,w:145,h:256},{id:"99136B7E-AD50-43D6-BB49-3F35B179353B",x:1083,y:776,w:188,h:238},{id:"9FB4FF7E-DD1E-485D-9E08-270C3CC75DCF",x:1449,y:776,w:188,h:238},{id:"6DD1ADCB-DC65-4F60-994B-2A2769506F72",x:1449,y:1016,w:188,h:238},{id:"C407E6EC-8BC1-4588-B03A-045C6D2214E3",x:1523,y:1256,w:158,h:216},{id:"37870464-078A-456E-BEDB-B1F56233DF2A",x:995,y:260,w:72,h:186},{id:"E1E25202-78F2-48E4-9326-31ECF38B57F2",x:1520,y:518,w:118,h:179},{id:"7F355756-B79B-420F-827A-88185C25E4B9",x:2,y:1550,w:118,h:179},{id:"83586F94-349F-48B1-8E6F-31A2D035C3FB",x:122,y:1550,w:118,h:179},{id:"23B4A43A-76A1-4364-B844-2E22D6C7C7AD",x:242,y:1550,w:118,h:179},{id:"F7A31617-D992-4797-AD56-01D72E9C7A57",x:1523,y:1474,w:173,h:107},{id:"FB695BDB-085E-4533-85EA-35CA6927534D",x:1520,y:699,w:157,h:69},{id:"0D478784-C3EB-4028-AA86-1999670A0885",x:1602,y:260,w:84,h:149},{id:"CE380EE5-CBF2-41E8-A056-B91DC3B7AE14",x:362,y:1583,w:146,h:69},{id:"157E3CF4-FEB6-4558-A985-9F59E0CF9DF1",x:510,y:1583,w:73,h:124}]],images:[{width:1699,height:1731}]};
},{}],"Xrn7":[function(require,module,exports) {
module.exports=module.exports={name:"sprites-origin",frames:[[{id:"C814F21A-DCEF-47F0-A4B1-5D18493C9FCD",x:2,y:2,w:512,h:512}]],images:[{width:516,height:516}]};
},{}],"Sni6":[function(require,module,exports) {
module.exports=module.exports={name:"sprites-tundra",frames:[[{id:"2ADEE4BA-D634-4AE2-9E34-847720036905",x:2,y:2,w:423,h:256},{id:"0C1AFF0C-B255-4053-8F3E-7978F605B5D0",x:2,y:260,w:397,h:256},{id:"EBD22B3A-DD03-4BB8-ACB3-01749D82A483",x:401,y:260,w:372,h:256},{id:"5E4192AF-6D8D-4989-AC17-D590045E491B",x:427,y:2,w:288,h:256},{id:"8EEE2A15-69BE-4517-BF3B-3BC21A9CB6D8",x:2,y:518,w:288,h:256},{id:"B1F97040-C8B3-43B4-AEDC-62832559C2A5",x:292,y:518,w:285,h:256},{id:"22F536A6-14AD-49CC-8E3D-EE8D9FC21E0E",x:579,y:518,w:164,h:256},{id:"F6608748-5508-4CB3-BF1E-92DB889FDDAC",x:2,y:776,w:102,h:256},{id:"07A77C07-3CEA-42C3-8F5A-80A3CF6C0207",x:106,y:776,w:112,h:256},{id:"051EF604-6EA1-467A-BEE6-65416C43E48D",x:220,y:776,w:157,h:256},{id:"775CCE63-C68E-4A1E-BEEB-85C25EA90573",x:379,y:776,w:95,h:256},{id:"AF28AE6A-0DC7-4939-8D49-80B5D2289AE5",x:476,y:776,w:141,h:256},{id:"49E1172E-8FE2-42F3-9E51-71527EC1051E",x:619,y:776,w:161,h:256},{id:"E1B090AE-7227-4E22-9F91-3523A71E9852",x:717,y:2,w:147,h:256},{id:"247C70CB-47F4-41AB-99A6-870C24E6D8B5",x:745,y:518,w:147,h:256},{id:"F6BC2B99-0869-4309-A283-F101EF7F1DF0",x:775,y:260,w:105,h:256},{id:"82F07511-B165-43BB-82A0-3DCB8CED9CB6",x:782,y:776,w:163,h:256},{id:"B7BF4F8D-67AE-474B-B7A9-621D961AF81D",x:866,y:2,w:159,h:256},{id:"AC17F6A7-D39E-4EC7-AD53-3DB7F7382C0B",x:882,y:260,w:158,h:256},{id:"BE472EC6-4177-4DE5-A8AE-B9179F5FD73D",x:894,y:518,w:207,h:256},{id:"682EEA65-3EEB-4D5B-9A15-C29397F47783",x:2,y:1034,w:204,h:256},{id:"24B4566B-D599-4096-B720-8E81B15BA4CF",x:208,y:1034,w:205,h:256},{id:"2A08376C-C912-40B9-A013-A505DE480FD3",x:415,y:1034,w:204,h:256},{id:"5096DBF2-2498-4053-BBC6-56DCE99A4CFA",x:621,y:1034,w:105,h:256},{id:"FDE9698A-B5C6-4669-8849-FA2740AFA2F5",x:728,y:1034,w:105,h:256},{id:"209C5714-30A8-4438-A5F5-2ADF19A061EA",x:835,y:1034,w:105,h:256},{id:"B67B0A7A-A20F-41BB-8678-B7E2D8FF17B5",x:942,y:1034,w:105,h:256},{id:"9D1E1373-0BD4-489E-928B-B14480890D02",x:947,y:776,w:105,h:256},{id:"0460DCAA-ED7A-4F59-A337-B1622C92E62D",x:1027,y:2,w:105,h:256},{id:"2B3AD1B2-0277-4C92-8105-48A1B395C9E9",x:1049,y:1034,w:232,h:256},{id:"8ADAC56A-2108-4C19-8D4A-2815DC1B82E2",x:1042,y:260,w:232,h:256},{id:"A5B847C2-6951-4E21-9055-520B0EC7F1AD",x:1054,y:776,w:215,h:256},{id:"E438792C-F36B-4D86-91B1-980207835107",x:1134,y:2,w:232,h:256},{id:"206B9D1C-15C0-4887-9E46-9DB46E052C84",x:1103,y:518,w:161,h:256},{id:"B8F11F36-5A33-4DA4-8DC7-3C3461C64EA0",x:2,y:1292,w:204,h:256},{id:"446682BA-30CD-472C-A05C-87863D6CA8B4",x:1266,y:518,w:113,h:239},{id:"8E5EC789-52F4-4603-9835-1726FEF2835A",x:208,y:1292,w:188,h:238},{id:"41441AC2-F2C2-4A8F-860F-63EE69FBF3D4",x:398,y:1292,w:188,h:238},{id:"044B0250-2E97-4675-A25F-DEF4933070CB",x:588,y:1292,w:226,h:159},{id:"EFE8E349-BB06-45B0-8C90-CEFF7C91DDF1",x:816,y:1292,w:204,h:141},{id:"2547E4A8-05BC-4344-A43D-D57E894FD4FF",x:1283,y:759,w:123,h:185},{id:"EA3AD5F2-3868-4FA3-B74D-6C8D15220124",x:1283,y:946,w:118,h:179},{id:"0E194309-4864-4FDF-A71E-FDE2C49EF348",x:1283,y:1127,w:118,h:179},{id:"4601ADDE-E3F7-4B72-9123-5B44D27B8DDF",x:1276,y:260,w:118,h:179},{id:"382F966C-0A31-43CB-9357-0E0E7EF699FA",x:1381,y:441,w:68,h:160},{id:"0DC724E1-ED07-43DA-AC37-E68D4C992BF1",x:1381,y:603,w:59,h:123},{id:"3E434D3C-6022-4C03-9174-DF575F0394E4",x:1396,y:2,w:52,h:118},{id:"B5718C69-661D-4F3B-83D1-54D0F5696911",x:1022,y:1308,w:100,h:114},{id:"EAE51B1B-A07D-41CF-8ADE-C0912D41367C",x:588,y:1453,w:109,h:95},{id:"B4FAE2BF-E183-463D-8FF1-E46A1264B55E",x:1368,y:122,w:66,h:58}]],images:[{width:1452,height:1550}]};
},{}],"xH5H":[function(require,module,exports) {
module.exports={forest:require("./sprites-forest.json"),grasslands:require("./sprites-grasslands.json"),origin:require("./sprites-origin.json"),tundra:require("./sprites-tundra.json")};
},{"./sprites-forest.json":"rtNM","./sprites-grasslands.json":"Ovqv","./sprites-origin.json":"Xrn7","./sprites-tundra.json":"Sni6"}],"SiSu":[function(require,module,exports) {
module.exports={"forest-0":require("./sprites-forest-0.png"),"forest-1":require("./sprites-forest-1.png"),"grasslands-0":require("./sprites-grasslands-0.png"),"origin-0":require("./sprites-origin-0.png"),"tundra-0":require("./sprites-tundra-0.png")};
},{"./sprites-forest-0.png":"vpjo","./sprites-forest-1.png":"wkPH","./sprites-grasslands-0.png":"e0nd","./sprites-origin-0.png":"E5Pn","./sprites-tundra-0.png":"MwS9"}],"ESOc":[function(require,module,exports) {
"use strict";function e(e,t){if(t)for(let o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}Object.defineProperty(exports,"__esModule",{value:!0}),exports.fastAssign=e;
},{}],"kGvY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getWeightedSets=o,exports.addSampleData=s;var e=n(require("../../tags")),t=require("../../util/objects");function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function n(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var i=o?Object.getOwnPropertyDescriptor(e,s):null;i&&(i.get||i.set)?Object.defineProperty(a,s,i):a[s]=e[s]}return a.default=e,n&&n.set(e,a),a}const a={flower:50,tree:75,twig:25,acorns:10,stump:25,shroom:25,rock:50,"flower-patch":10,sapling:20};function o(e){const t=new Map;e.filter(e=>e.userData.tag).map(e=>{const r=e.userData.tag;let n;return t.has(r)?n=t.get(r):(n=[],t.set(r,n)),n.push(e),{tag:r,child:e}});return Array.from(t.entries()).map(([e,t])=>{return{value:t,weight:e in a?a[e]:50,tag:e}})}function s(t,r,n,a,o){if(!r)return;if(!r.has(a))return void console.warn(`No cell class by key ${a}`);const s=r.get(a);if(!s||!s.sets||!s.sets.length)return void console.warn(`Cell not yet ready ${a}`);const i=o.weightedSet(s.sets),u=s.next(o.pick(i));if(!u||!u.userData.tag)return void(u&&console.warn("no tag for",u.name,a));const c=u.uuid;n.add(e.GroundAssetData);const l=n.get(e.GroundAssetData);return l.key=c,l.variance=o.gaussian(0,1),l.rotation=o.range(-1,1)*Math.PI*2,l.flip=o.boolean(),l.instance=u,l.audio=u.scale.y>5,l.ignoreFlip="tree"===u.userData.tag,u}
},{"../../tags":"injP","../../util/objects":"ESOc"}],"zcH5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=_,exports.MetaData=void 0;var e=w(require("../tags")),t=w(require("three")),a=require("../util/GLTFLoader"),r=g(require("../assets/gltf/*.{gltf,glb,png,jpg}")),n=require("./materials"),s=require("./load"),i=require("./EditorWayfinderSprite"),o=g(require("../assets/gltf/meta.json")),u=w(require("./helpers")),l=g(require("../util/Assets")),c=g(require("../assets/gltf/sprites-*.json")),f=g(require("../assets/gltf/sprites-*.png")),d=require("./three-util"),p=require("../systems/environment/asset-types"),m=g(require("./ObjectPool")),y=require("./addFrameTasks");function g(e){return e&&e.__esModule?e:{default:e}}function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(h=function(e){return e?a:t})(e)}function w(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=h(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var i=n?Object.getOwnPropertyDescriptor(e,s):null;i&&(i.get||i.set)?Object.defineProperty(r,s,i):r[s]=e[s]}return r.default=e,a&&a.set(e,r),r}let D={};Object.keys(f.default).forEach(e=>{const t=f.default[e],a=e.match(/([^\-]+)\-/);let r=a?a[1]:"";const n=parseInt(e.replace(/[^\d]+/g,""),10);if(r in D||(D[r]=[]),D[r][n]=t,"forest"===r){const e=l.default.urlToID(t);l.default.prepare(e)}});const b=x(r.default,["jpg","png"],"map-"),O=x(r.default,["gltf","glb"]),M=19;Object.keys(o.default).forEach(e=>{o.default[e].boundingBox[0][1]=0,o.default[e].boundingBox[1][1]+=19});const j=o.default;async function _(a){const r=new Map,u=new Map,f=new Map,y=(new t.BufferGeometry,(0,n.getEmptyTexture)()),g=new t.Vector3,h=a.findTag(e.Renderer),w=new Map,M={};for(let[e,t]of Object.entries(D))M[e]=t.map(e=>{const t=l.default.urlToID(e);return l.default.createGPUTextureTask(h,t)});Object.entries(c.default).forEach(([e,a])=>{const r=M[e];a.frames.forEach((e,n)=>{e.forEach(e=>{if(w.has(e.id))console.error("WARN: Clashing UUIDs in GLTF sprite sheet data");else{const{width:s,height:i}=a.images[n],o=new t.Vector2,u=new t.Vector2;o.set(e.w/s,e.h/i),u.x=e.x/s,u.y=1-e.h/i-e.y/i;const l=r[n],c={...e,repeat:o,offset:u,atlas:l[0],atlasPromise:l[1],sheetIndex:n};delete c.id,w.set(e.id,c)}})})});const j=new Map,_=new Map;return await Promise.all(["forest-items-dry","forest-items-autumn","forest-items-triangle","grasslands-items-water","grasslands-items-yellow","grasslands-items-wet","grasslands-items-field","tundra-items-basic","tundra-items-ice"].map(async e=>{const t=await S(e,!1,!1),a=e.replace(/^items\-/i,""),r=(0,p.getWeightedSets)(t.children),n=function(e){return{sets:e,getPool:x,next:e=>(function(e){return x(e).next()})(e)}}(r);_.set(a,n),r.forEach(e=>{e.value.forEach(e=>{n.getPool(e,10)})})})),a.entity().add(e.GLTFSpawnItemsMap,_),{killEntities:v,nextPooledByName:function(e,t){return S(e,!0,t)},loadSceneByName:S};function x(t,r=1){let n;return j.has(t)?n=j.get(t):(n=function(t,r=1){const n=t.name;return new m.default({initialCapacity:r,name:`GLTFMesh-${n}`,create(){const e=k(t);return e.userData._pool=this,e},renew(t){return t.userData&&(t.userData._pool=this),t.traverse(t=>{t.isMesh&&function(t){const r=t.isSprite||"WayfinderSprite"===t.userData.type;t.userData._entity&&(t.userData._entity.kill(),console.error("ERROR: Entity already existed on child, removing it.")),t.layers.set(a.findTag(e.RenderLayers).groundNormalElement);const n=t.userData?t.userData.tag:null,s=!!n&&n.includes("noshadow");if(r){const r=t.getWorldScale(g).y;t.userData._entity=a.entity().add(e.Object3D,t).add(e.Object3DKeepAlive).add(e.ShaderUniformTime,{uniform:t.material.uniforms.time}),s||t.userData._entity.add(e.ShadowCaster,{sprite:!0}),n&&"origin_tree"===n&&(t.userData._entity.add(e.SpriteAnimation,{key:t.userData.tag}),t.userData._entity.add(e.SpriteAnimationOriginTreeTag)),"origin_tree"!==n&&r>5&&t.userData._entity.add(e.WillTriggerAudio)}else t.userData._entity=a.entity().add(e.Object3D,t).add(e.Object3DKeepAlive),s||t.userData._entity.add(e.ShadowCaster,{sprite:!1});n&&"fox"===n&&t.userData._entity.add(e.FoxSpriteTag)}(t)}),t},release(e){e.userData&&(e.userData._pool=null),v(e)}})}(t,r),j.set(t,n)),n}function v(e){e.traverse(e=>{e.userData&&e.userData._entity&&(e.userData._entity.kill(),e.userData._entity=null)})}async function S(e,a,r){let n;if(f.has(e))n=f.get(e);else{const a=e.match(/([^\-]+)\-/);let r=a?a[1]:"";const s=await async function(e){if(!e||!O.has(e))return console.warn(`No scene by ID prefix ${e}`),null;const t=O.get(e);let a;return u.has(t)?a=u.get(t):(a=T(t).then(e=>{const t={};return e.scenes.forEach(e=>{t[e.name]=e}),t}),u.set(t,a)),a}(r);if(!s)return console.warn(`No scene by ID prefix ${r}`),new t.Scene;if(!(e in s))return console.warn(`Missing patch ${e} in ${r}`),new t.Scene;n=s[e];const i=o.default[e];i||console.warn(`No Meta for ${e}`),await async function(e,t){const a=[];return e.traverse(e=>{e.isMesh&&a.push(e)}),await Promise.all(a.map(async e=>{const a=e.isSprite||"WayfinderSprite"===e.userData.type;if(e.userData.$m){const t=await q(e.userData.$m);e.material.uniforms?e.material.uniforms.map.value=t:e.material.map=t,!a&&t&&(t.flipY=!1),delete e.userData.$m}E(e,t)})),e}(n,i),f.set(e,n)}if(a){return x(n).next()}return k(n)}function k(e){const t=e.clone(!0),a=e.name,r=a in o.default?o.default[a]:null;return t.traverse(e=>{e.isMesh&&E(e,r)}),t}async function q(e){if(r.has(e))return r.get(e);if(w.has(e)){const a=w.get(e);await a.atlasPromise;const r=new t.Texture;return r.repeat.copy(a.repeat),r.offset.copy(a.offset),(0,d.shareAtlasTexture)(h,a.atlas,r),r}if(!b.has(e))return console.warn(`Could not find map by UUID ${e}`),y;const a=b.get(e),n=(0,s.loadTexture)(a);return r.set(e,n),n}function E(e,r){const s=e.isSprite||"WayfinderSprite"===e.userData.type;if(r&&"origin"===r.type&&e.name&&e.name.endsWith("origin-0-ORIGIN_TREE")&&(e.userData.animation="origin-0"),s)(0,i.setMeshToSprite)(a,e);else{const r=e.material.uniforms&&e.material.uniforms.map?e.material.uniforms.map.value:e.material.map,s=e.userData?e.userData.tag:null,i=!!s&&(s.includes("noshadow")||s.includes("noground"));i&&(e.material.alphaTest=.5,e.material.transparent=!0),e.material=(0,n.createMeshMaterial)(a,e,{map:r,ignoreGround:i}),r.minFilter=t.LinearFilter,r.generateMipmaps=!1}}}async function T(e){return new Promise(r=>{const n=new t.LoadingManager,s=new a.GLTFLoader(n);s.setCrossOrigin("anonymous"),s.load(e,e=>{r(e)})})}function x(e,t,a){return t=[].concat(t),Object.keys(e).filter(r=>!(a&&!r.startsWith(a))&&Object.keys(e[r]).some(e=>t.includes(e))).reduce((t,a)=>{const r=a.replace(/^map\-/,"").replace(/^geometry\-/,"").replace(/^scene\-/,""),n=e[a],s=Object.keys(n)[0];return s?t.set(r,n[s]):console.warn("Object does not have any URL keys"),Object.keys(n).length>1&&console.log("Object has more than one URL key"),t},new Map)}exports.MetaData=j;
},{"../tags":"injP","three":"IV0r","../util/GLTFLoader":"IGrR","../assets/gltf/*.{gltf,glb,png,jpg}":"BoYG","./materials":"phuP","./load":"OkDW","./EditorWayfinderSprite":"iSWR","../assets/gltf/meta.json":"oB7B","./helpers":"N4w3","../util/Assets":"Wm90","../assets/gltf/sprites-*.json":"xH5H","../assets/gltf/sprites-*.png":"SiSu","./three-util":"bI4v","../systems/environment/asset-types":"kGvY","./ObjectPool":"iiAR","./addFrameTasks":"l7a6"}],"c4hk":[function(require,module,exports) {
"use strict";function r(r){const l=+this._x.call(null,r),e=+this._y.call(null,r);return t(this.cover(l,e),l,e,r)}function t(r,t,l,e){if(isNaN(t)||isNaN(l))return r;var n,a,i,o,u,s,_,c,f,h=r._root,y={data:e},d=r._x0,x=r._y0,N=r._x1,v=r._y1;if(!h)return r._root=y,r;for(;h.length;)if((s=t>=(a=(d+N)/2))?d=a:N=a,(_=l>=(i=(x+v)/2))?x=i:v=i,n=h,!(h=h[c=_<<1|s]))return n[c]=y,r;if(o=+r._x.call(null,h.data),u=+r._y.call(null,h.data),t===o&&l===u)return y.next=h,n?n[c]=y:r._root=y,r;do{n=n?n[c]=new Array(4):r._root=new Array(4),(s=t>=(a=(d+N)/2))?d=a:N=a,(_=l>=(i=(x+v)/2))?x=i:v=i}while((c=_<<1|s)==(f=(u>=i)<<1|o>=a));return n[f]=h,n[c]=y,r}function l(r){var l,e,n,a,i=r.length,o=new Array(i),u=new Array(i),s=1/0,_=1/0,c=-1/0,f=-1/0;for(e=0;e<i;++e)isNaN(n=+this._x.call(null,l=r[e]))||isNaN(a=+this._y.call(null,l))||(o[e]=n,u[e]=a,n<s&&(s=n),n>c&&(c=n),a<_&&(_=a),a>f&&(f=a));if(s>c||_>f)return this;for(this.cover(s,_).cover(c,f),e=0;e<i;++e)t(this,o[e],u[e],r[e]);return this}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=r,exports.addAll=l;
},{}],"DeJI":[function(require,module,exports) {
"use strict";function t(t,s){if(isNaN(t=+t)||isNaN(s=+s))return this;var e=this._x0,i=this._y0,r=this._x1,h=this._y1;if(isNaN(e))r=(e=Math.floor(t))+1,h=(i=Math.floor(s))+1;else{for(var o,a,_=r-e||1,c=this._root;e>t||t>=r||i>s||s>=h;)switch(a=(s<i)<<1|t<e,(o=new Array(4))[a]=c,c=o,_*=2,a){case 0:r=e+_,h=i+_;break;case 1:e=r-_,h=i+_;break;case 2:r=e+_,i=h-_;break;case 3:e=r-_,i=h-_}this._root&&this._root.length&&(this._root=c)}return this._x0=e,this._y0=i,this._x1=r,this._y1=h,this}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t;
},{}],"HTBh":[function(require,module,exports) {
"use strict";function e(){var e=[];return this.visit(function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)}),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"JRL4":[function(require,module,exports) {
"use strict";function t(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t;
},{}],"BPLw":[function(require,module,exports) {
"use strict";function t(t,e,s,i,o){this.node=t,this.x0=e,this.y0=s,this.x1=i,this.y1=o}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t;
},{}],"t1gW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=l;var e=t(require("./quad.js"));function t(e){return e&&e.__esModule?e:{default:e}}function l(t,l,a){var u,n,r,s,d,h,i,f=this._x0,o=this._y0,_=this._x1,p=this._y1,x=[],c=this._root;for(c&&x.push(new e.default(c,f,o,_,p)),null==a?a=1/0:(f=t-a,o=l-a,_=t+a,p=l+a,a*=a);h=x.pop();)if(!(!(c=h.node)||(n=h.x0)>_||(r=h.y0)>p||(s=h.x1)<f||(d=h.y1)<o))if(c.length){var v=(n+s)/2,y=(r+d)/2;x.push(new e.default(c[3],v,y,s,d),new e.default(c[2],n,y,v,d),new e.default(c[1],v,r,s,y),new e.default(c[0],n,r,v,y)),(i=(l>=y)<<1|t>=v)&&(h=x[x.length-1],x[x.length-1]=x[x.length-1-i],x[x.length-1-i]=h)}else{var g=t-+this._x.call(null,c.data),w=l-+this._y.call(null,c.data),q=g*g+w*w;if(q<a){var M=Math.sqrt(a=q);f=t-M,o=l-M,_=t+M,p=l+M,u=c.data}}return u}
},{"./quad.js":"BPLw"}],"wnjT":[function(require,module,exports) {
"use strict";function t(t){if(isNaN(h=+this._x.call(null,t))||isNaN(n=+this._y.call(null,t)))return this;var e,i,r,s,h,n,l,o,u,f,a,x,_=this._root,d=this._x0,c=this._y0,v=this._x1,g=this._y1;if(!_)return this;if(_.length)for(;;){if((u=h>=(l=(d+v)/2))?d=l:v=l,(f=n>=(o=(c+g)/2))?c=o:g=o,e=_,!(_=_[a=f<<1|u]))return this;if(!_.length)break;(e[a+1&3]||e[a+2&3]||e[a+3&3])&&(i=e,x=a)}for(;_.data!==t;)if(r=_,!(_=_.next))return this;return(s=_.next)&&delete _.next,r?(s?r.next=s:delete r.next,this):e?(s?e[a]=s:delete e[a],(_=e[0]||e[1]||e[2]||e[3])&&_===(e[3]||e[2]||e[1]||e[0])&&!_.length&&(i?i[x]=_:this._root=_),this):(this._root=s,this)}function e(t){for(var e=0,i=t.length;e<i;++e)this.remove(t[e]);return this}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t,exports.removeAll=e;
},{}],"aU2q":[function(require,module,exports) {
"use strict";function e(){return this._root}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"PC8q":[function(require,module,exports) {
"use strict";function e(){var e=0;return this.visit(function(t){if(!t.length)do{++e}while(t=t.next)}),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"MOvE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=t(require("./quad.js"));function t(e){return e&&e.__esModule?e:{default:e}}function u(t){var u,s,r,n,a,d,f=[],h=this._root;for(h&&f.push(new e.default(h,this._x0,this._y0,this._x1,this._y1));u=f.pop();)if(!t(h=u.node,r=u.x0,n=u.y0,a=u.x1,d=u.y1)&&h.length){var i=(r+a)/2,o=(n+d)/2;(s=h[3])&&f.push(new e.default(s,i,o,a,d)),(s=h[2])&&f.push(new e.default(s,r,o,i,d)),(s=h[1])&&f.push(new e.default(s,i,n,a,o)),(s=h[0])&&f.push(new e.default(s,r,n,i,o))}return this}
},{"./quad.js":"BPLw"}],"EdvS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=t(require("./quad.js"));function t(e){return e&&e.__esModule?e:{default:e}}function u(t){var u,s=[],r=[];for(this._root&&s.push(new e.default(this._root,this._x0,this._y0,this._x1,this._y1));u=s.pop();){var o=u.node;if(o.length){var n,h=u.x0,a=u.y0,d=u.x1,f=u.y1,i=(h+d)/2,p=(a+f)/2;(n=o[0])&&s.push(new e.default(n,h,a,i,p)),(n=o[1])&&s.push(new e.default(n,i,a,d,p)),(n=o[2])&&s.push(new e.default(n,h,p,i,f)),(n=o[3])&&s.push(new e.default(n,i,p,d,f))}r.push(u)}for(;u=r.pop();)t(u.node,u.x0,u.y0,u.x1,u.y1);return this}
},{"./quad.js":"BPLw"}],"yqgF":[function(require,module,exports) {
"use strict";function t(t){return t[0]}function e(t){return arguments.length?(this._x=t,this):this._x}Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultX=t,exports.default=e;
},{}],"FeNP":[function(require,module,exports) {
"use strict";function t(t){return t[1]}function e(t){return arguments.length?(this._y=t,this):this._y}Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultY=t,exports.default=e;
},{}],"HCic":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=y;var e=v(require("./add.js")),t=c(require("./cover.js")),r=c(require("./data.js")),u=c(require("./extent.js")),a=c(require("./find.js")),i=v(require("./remove.js")),o=c(require("./root.js")),n=c(require("./size.js")),f=c(require("./visit.js")),l=c(require("./visitAfter.js")),s=v(require("./x.js")),d=v(require("./y.js"));function c(e){return e&&e.__esModule?e:{default:e}}function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}function v(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var u={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=a?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(u,i,o):u[i]=e[i]}return u.default=e,r&&r.set(e,u),u}function y(e,t,r){var u=new _(null==t?s.defaultX:t,null==r?d.defaultY:r,NaN,NaN,NaN,NaN);return null==e?u:u.addAll(e)}function _(e,t,r,u,a,i){this._x=e,this._y=t,this._x0=r,this._y0=u,this._x1=a,this._y1=i,this._root=void 0}function h(e){for(var t={data:e.data},r=t;e=e.next;)r=r.next={data:e.data};return t}var j=y.prototype=_.prototype;j.copy=function(){var e,t,r=new _(this._x,this._y,this._x0,this._y0,this._x1,this._y1),u=this._root;if(!u)return r;if(!u.length)return r._root=h(u),r;for(e=[{source:u,target:r._root=new Array(4)}];u=e.pop();)for(var a=0;a<4;++a)(t=u.source[a])&&(t.length?e.push({source:t,target:u.target[a]=new Array(4)}):u.target[a]=h(t));return r},j.add=e.default,j.addAll=e.addAll,j.cover=t.default,j.data=r.default,j.extent=u.default,j.find=a.default,j.remove=i.default,j.removeAll=i.removeAll,j.root=o.default,j.size=n.default,j.visit=f.default,j.visitAfter=l.default,j.x=s.default,j.y=d.default;
},{"./add.js":"c4hk","./cover.js":"DeJI","./data.js":"HTBh","./extent.js":"JRL4","./find.js":"t1gW","./remove.js":"wnjT","./root.js":"aU2q","./size.js":"PC8q","./visit.js":"MOvE","./visitAfter.js":"EdvS","./x.js":"yqgF","./y.js":"FeNP"}],"oxc3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"quadtree",{enumerable:!0,get:function(){return e.default}});var e=r(require("./quadtree.js"));function r(e){return e&&e.__esModule?e:{default:e}}
},{"./quadtree.js":"HCic"}],"ViKw":[function(require,module,exports) {
module.exports={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};
},{}],"ua1d":[function(require,module,exports) {
function r(r){var e,n,o,t,u,f=r[0],a=r[1],i=r[2];if(0===a)return[u=i,u,u];e=2*i-(n=i<.5?i*(1+a):i+a-i*a),t=[0,0,0];for(var v=0;v<3;v++)(o=f+1/3*-(v-1))<0&&o++,o>1&&o--,u=6*o<1?e+6*(n-e)*o:2*o<1?n:3*o<2?e+(n-e)*(2/3-o)*6:e,t[v]=u;return t}module.exports=r;
},{}],"K3Ha":[function(require,module,exports) {
function t(t){var a,n,m=t[0],r=t[1],e=t[2],h=Math.min(m,r,e),i=Math.max(m,r,e),o=i-h;return i===h?a=0:m===i?a=(r-e)/o:r===i?a=2+(e-m)/o:e===i&&(a=4+(m-r)/o),(a=Math.min(60*a,360))<0&&(a+=360),n=(h+i)/2,[a/360,i===h?0:n<=.5?o/(i+h):o/(2-i-h),n]}module.exports=t;
},{}],"c5Xu":[function(require,module,exports) {
var a=require("float-hsl2rgb"),t=require("float-rgb2hsl"),r=require("./wrap");function h(a){var r=t([a[0]/255,a[1]/255,a[2]/255]);return[Math.max(0,Math.min(360,Math.round(360*r[0]))),Math.max(0,Math.min(100,Math.round(100*r[1]))),Math.max(0,Math.min(100,Math.round(100*r[2]))),a[3]]}function n(t){var h=r(t[0],0,360),n=a([h/360,t[1]/100,t[2]/100]);return[Math.max(0,Math.min(255,Math.round(255*n[0]))),Math.max(0,Math.min(255,Math.round(255*n[1]))),Math.max(0,Math.min(255,Math.round(255*n[2]))),t[3]]}module.exports.RGBAToHSLA=h,module.exports.HSLAToRGBA=n;
},{"float-hsl2rgb":"ua1d","float-rgb2hsl":"K3Ha","./wrap":"sQb4"}],"n6d6":[function(require,module,exports) {
function e(e){if("string"!=typeof e)throw new TypeError("Hex code parsing must be performed on a string parameter");if(e=e.toLowerCase(),!/^#[a-f0-9]+$/.test(e))return null;var r=e.replace(/^#/,""),t=1;8===r.length&&(t=parseInt(r.slice(6,8),16)/255,r=r.slice(0,6)),4===r.length&&(t=parseInt(r.slice(3,4).repeat(2),16)/255,r=r.slice(0,3)),3===r.length&&(r=r[0]+r[0]+r[1]+r[1]+r[2]+r[2]);var n=parseInt(r,16);return[n>>16,n>>8&255,255&n,t]}module.exports=e;
},{}],"mMMB":[function(require,module,exports) {
function t(t){if(!t||!Array.isArray(t))throw new TypeError("Must specify an array to convert into a hex code");var a=Math.max(0,Math.min(255,Math.round(t[0]||0))),r=Math.max(0,Math.min(255,Math.round(t[1]||0))),n=Math.max(0,Math.min(255,Math.round(t[2]||0))),i=t[3];void 0!==i&&isFinite(i)||(i=1);var o=Math.max(0,Math.min(255,Math.round(255*i))),h=255===o?"":(256|o).toString(16).slice(1);return"#"+((n|r<<8|a<<16|1<<24).toString(16).slice(1)+h)}module.exports=t;
},{}],"fPl0":[function(require,module,exports) {
var r=require("./css-color-names.json"),a=require("./hsl"),e=require("./hex-to-rgba"),t=require("./rgba-to-hex"),n=require("./wrap");function i(i){if("string"!=typeof i)throw new TypeError("Color parsing must be performed on a string parameter");var s,o,h;if((i=i.toLowerCase())in r?i=r[i]:"transparent"===i&&(i="#00000000"),/^#[a-f0-9]+$/.test(i))s=e(i),h=t(s),o=a.RGBAToHSLA(s);else{var l=/^((?:rgb|hsl)a?)\s*\(([^)]*)\)/.exec(i);if(!l)return null;var u=l[1].replace(/a$/,""),m=l[2].replace(/^\s+|\s+$/g,"").split(/\s*,\s*/).map(function(r,a){return a<=2?Math.round(parseFloat(r)||0):("number"==typeof(r=parseFloat(r))&&isFinite(r)||(r=1),r)});void 0!==m[3]&&isFinite(m[3])||(m[3]=1),"rgb"===u?(o=a.RGBAToHSLA(m),s=m):"hsl"===u&&(s=a.HSLAToRGBA(m),m[0]=n(m[0],0,360),o=m),h=t(s)}return s||h||o?{hex:h,alpha:s[3],rgb:s.slice(0,3),rgba:s,hsl:o.slice(0,3),hsla:o}:null}function s(r){return"string"==typeof r?i(r):Array.isArray(r)&&r.length>=3?i(h(r[0],r[1],r[2],r[3])):r&&"object"==typeof r&&(r.hex?a=r.hex:r.rgba?a=h(r.rgba[0],r.rgba[1],r.rgba[2],r.rgba[3]):r.hsla?a=l(r.hsla[0],r.hsla[1],r.hsla[2],r.hsla[3]):r.rgb?a=h(r.rgb[0],r.rgb[1],r.rgb[2]):r.hsl&&(a=l(r.hsl[0],r.hsl[1],r.hsl[2])),a)?i(a):null;var a}function o(r){var a=module.exports.parse(r);if(a){var e=a.rgba;return h(e[0],e[1],e[2],e[3])}return null}function h(r,a,e,t){return r=Math.max(0,Math.min(255,Math.round(r))),a=Math.max(0,Math.min(255,Math.round(a))),e=Math.max(0,Math.min(255,Math.round(e))),1!==t&&isFinite(t)&&void 0!==t?"rgba("+[r,a,e,t=Math.max(0,Math.min(1,t))].join(", ")+")":"rgb("+[r,a,e].join(", ")+")"}function l(r,a,e,t){return r=n(r,0,360),r=Math.max(0,Math.min(360,Math.round(r))),a=Math.max(0,Math.min(100,Math.round(a))),e=Math.max(0,Math.min(100,Math.round(e))),1!==t&&isFinite(t)&&void 0!==t?"hsla("+[r,a,e,t=Math.max(0,Math.min(1,t))].join(", ")+")":"hsl("+[r,a,e].join(", ")+")"}module.exports.parse=s,module.exports.style=o;
},{"./css-color-names.json":"ViKw","./hsl":"c5Xu","./hex-to-rgba":"n6d6","./rgba-to-hex":"mMMB","./wrap":"sQb4"}],"hO7m":[function(require,module,exports) {
var r=.2126,n=.7152,t=.0722,o=1/12.92;function u(r){return Math.pow((r+.055)/1.055,2.4)}function e(e){var a=e[0]/255,c=e[1]/255,f=e[2]/255,i=a<=.03928?a*o:u(a),p=c<=.03928?c*o:u(c),v=f<=.03928?f*o:u(f);return i*r+p*n+v*t}module.exports=e;
},{}],"fy0v":[function(require,module,exports) {
var e=require("./lib/css-color"),r=require("./lib/css-color-names.json"),o=require("./lib/relative-luminance"),l=require("./lib/hsl"),t=require("./lib/hex-to-rgba"),a=require("./lib/rgba-to-hex");module.exports.parse=e.parse,module.exports.style=e.style,module.exports.names=r,module.exports.relativeLuminance=function(e){var r=module.exports.parse(e);return r?o(r.rgb):null},module.exports.contrastRatio=function(e,r){var o=module.exports.relativeLuminance(e),l=module.exports.relativeLuminance(r);return null==o||null==l?null:(Math.max(o,l)+.05)/(Math.min(o,l)+.05)},module.exports.offsetHSL=function(e,r,o,l){var t=module.exports.parse(e);return t?(t.hsla[0]+=r||0,t.hsla[1]=Math.max(0,Math.min(100,t.hsla[1]+(o||0))),t.hsla[2]=Math.max(0,Math.min(100,t.hsla[2]+(l||0))),module.exports.parse({hsla:t.hsla})):null},module.exports.blend=function(e,r,o){var l=module.exports.parse(e),t=module.exports.parse(r);if(null==l||null==t)return null;var a=l.rgba,u=t.rgba,s=(o="number"==typeof o&&isFinite(o)?o:1)*u[3];if(s>=1)return t;for(var n=0;n<3;n++)u[n]=u[n]*s+a[n]*(a[3]*(1-s));return u[3]=Math.max(0,Math.min(1,s+a[3]*(1-s))),module.exports.parse(u)},module.exports.hexToRGBA=t,module.exports.RGBAToHex=a,module.exports.RGBAToHSLA=l.RGBAToHSLA,module.exports.HSLAToRGBA=l.HSLAToRGBA;
},{"./lib/css-color":"fPl0","./lib/css-color-names.json":"ViKw","./lib/relative-luminance":"hO7m","./lib/hsl":"c5Xu","./lib/hex-to-rgba":"n6d6","./lib/rgba-to-hex":"mMMB"}],"xyPh":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n#define GLSLIFY 1\nvarying vec2 vUv;\nvarying vec2 vTextureUv;\nvarying vec2 vSurfUv;\nvarying vec3 vWorldPosition;\nuniform sampler2D worldDataMap;\nuniform vec3 centroidPosition;\nuniform sampler2D waterDistortMap;\nuniform sampler2D waterNoiseMap;\nuniform sampler2D dataMapColor;\nuniform sampler2D dataMapLake;\nuniform sampler2D dataMapLakeBlur;\nuniform sampler2D groundMap;\nuniform vec3 colorA;\nuniform vec3 colorB;\nuniform float lakeSize;\nuniform float time;\nvarying float vAngle;\nvarying vec2 vDataUv;\nvarying vec2 vGroundUv;\n#define distortionScale 1.0\n#define waterScale 2.5\n// #define WATER 1\nvoid main2 () {\n    float lake = 1.0-texture2D(dataMapLake, vUv).r;\n  float lakeBlur = 1.0-texture2D(dataMapLakeBlur, vUv).r;\n  vec3 groundColor = texture2D(dataMapColor, vUv).rgb;\n  vec4 wakeData = texture2D(worldDataMap, vDataUv).rgba;\n  vec4 tex = texture2D(waterNoiseMap, vTextureUv * waterScale).rgba;\n  gl_FragColor = vec4(vec3(colorB.rgb), 1.0);\n}\nvoid main () {\n    // float lake = texture2D(dataMapLake, vUv).r;\n  float lake = 1.0-texture2D(dataMapLake, vUv).r;\n  float lakeBlur = 1.0-texture2D(dataMapLakeBlur, vUv).r;\n  // vec3 groundColor = texture2D(dataMapColor, vUv).rgb;\n  vec3 groundColor = texture2D(groundMap, vGroundUv).rgb;\n  vec4 wakeData = texture2D(worldDataMap, vDataUv).rgba;\n  // float foam = smoothstep(1.0, 0.85, lake);\n  // float ld = 0.2 + sin(time + vAngle) * 0.1;\n  // float foam = smoothstep(1.0, ld, lake);\n  // gl_FragColor = vec4(color + vec3(foam), 1.0);\n  float dst = smoothstep(0.0, 0.5, lake);\n  // float off = 0.0;\n  // // float off = sin(vAngle + time) * (1.0 / steps) * 0.1;\n  // dst = abs(fract((dst + 0.05 * time + off) * steps) - 0.5)*2.0;\n  // dst *= smoothstep(0.1, 0.75, lake);\n  vec2 uvDistort = vec2(0.0);\n  float wakeStrength = wakeData.r;\n\n  #ifdef WATER\n  vec2 wakeDirection = wakeData.gb * 0.2 * wakeStrength;\n  uvDistort -= wakeDirection;\n  float timeOff = time;\n  #else\n  vec2 wakeDirection = vec2(0.0);\n  float timeOff = 0.0;\n  #endif\n  vec2 uvDistortOff = vec2(timeOff * 0.1, timeOff * -0.1);\n  vec2 distortion = texture2D(waterDistortMap, uvDistortOff + vTextureUv * distortionScale).rg * 2.0 - 1.0;\n  uvDistort += distortion.rg * 0.05;\n  vec4 waterColorMap = texture2D(waterNoiseMap, vTextureUv * waterScale + uvDistort);\n  float foam = waterColorMap.r;\n  float lakeCentroidDepth = distance(centroidPosition, vWorldPosition)/lakeSize;\n  lakeCentroidDepth = smoothstep(0.0, 1.0, lakeCentroidDepth);\n  float lakeBlurDepth = lakeBlur;\n  // float lakeBlurDepth = smoothstep(0.0, 1.0, lakeBlur);\n  float depth = smoothstep(0.0, 0.75, lake);\n  vec3 col = mix(colorA, colorB, lakeBlurDepth);\n  vec2 edgeOff2D = texture2D(waterDistortMap, vec2(0.0, 0.0) + vTextureUv * distortionScale + distortion.rg * 0.02 - wakeDirection).rg * 2.0 - 1.0;\n  float edgeOff = edgeOff2D.r;\n  float strongEdge = smoothstep(0.4, 0.55, lake + edgeOff2D.g * 0.05);\n  float ft0 = 0.4;\n  float ftf = 0.3;\n  // float edgeFalloff = 1.0 - smoothstep(0.8, 0.0, lake);\n  float edgeFalloff = smoothstep(ft0-ftf, ft0+ftf, lake + edgeOff2D.r * 0.05);\n  #ifdef WATER\n  col += foam * 0.1 * lakeBlurDepth + foam * 0.2 * wakeStrength;\n  col = mix(col, groundColor, edgeFalloff);\n  #else\n  col += foam * mix(0.0, 0.1, lakeBlurDepth) + foam * 0.2 * wakeStrength;\n  col = mix(col, groundColor, edgeFalloff);\n  #endif\n  col *= (1.0 - wakeStrength * 0.05);\n  // col = mix(col, groundColor, strongEdge);\n  // col = mix(col, col + 0.1, strongEdge);\n\n  float steps = 4.0 + edgeOff2D.g * 0.2;\n  // float waves = sin(distortion.r * 0.25 + edgeOff2D. + timeOff * -0.05);\n  float worldOff = 0.0;\n  float waves = fract(edgeOff2D.r * 0.1 + edgeOff2D.g * 0.1 + timeOff * 0.1 + worldOff);\n  // waves -= sin(length(vUv - 0.5) * 10.0 + timeOff);\n  float movingDst = smoothstep(0.0, 0.7, lake + edgeOff2D.r * 0.05);\n  movingDst = smoothstep(0.5, 0.0, abs(fract((movingDst + waves) * steps) - 0.5) * 2.0);\n  movingDst *= depth;\n  // movingDst *= sin(length(vUv - 0.5) * 10.0 + timeOff);\n  // movingDst = mix(movingDst, 1.0, strongEdge);\n  // movingDst = mix(movingDst, 1.0, smoothstep(0.5, 0.55, lake + edgeOff2D.g * 0.05));\n  float et = 0.4;\n  float ef = 0.05;\n  float sharpFoam = smoothstep(et-ef,et+ef, movingDst + edgeOff2D.r * 0.6) * smoothstep(et-ef,et+ef, movingDst + edgeOff2D.g * 0.6);\n  sharpFoam = clamp(sharpFoam, 0.0, 1.0);\n  // sharpFoam *= smoothstep(-0.2, -0.0, edgeOff2D.r);\n  // sharpFoam *= smoothstep(-0.3, -0.2, edgeOff2D.g);\n  #ifdef WATER\n  float et0 = 0.4;\n  float ef0 = 0.05;\n  col = mix(col, vec3(col + 0.4 *(edgeOff2D.r*0.5+0.5)), (1.0-strongEdge) * sharpFoam);\n  #else\n  float et0 = 0.4;\n  float ef0 = 0.05;\n  col += 1.0 * mix(col, vec3(col + 0.4 *(edgeOff2D.r*0.5+0.5)), (1.0-strongEdge) * sharpFoam) * foam;\n  #endif\n  // col = mix(col, mix(col, vec3(0.8), smoothstep(et0+ef0, et0-ef0, lake)), sharpFoam);\n\n  float strongEdge2 = smoothstep(0.4, 0.55, lake +edgeOff2D.r * 0.1);\n  // col = mix(col, groundColor, strongEdge2);\n\n  // col += sharpFoam * 0.5 * (smoothstep(0.5, 0.3, lake));\n  // col += step(0.4, lake + edgeOff2D.r * 0.6) * step(0.4, lake + edgeOff2D.g * 0.6);\n  // col += smoothstep(et-ef, et+ef, edgeOff2D.g) * movingDst * depth;\n  // col = vec3(movingDst);\n  // col += step(0.6, lake + edgeOff);\n  // float edgeFoam01 = step(0.5, lake + distortion.r);\n  // float edgeFoam02 = step(0.5, lake + distortion.g);\n  // col += edgeFoam01 * edgeFoam02;\n  // col = vec3(smoothstep(0.0, 0.7, lake));\n  // col += smoothstep(0.1, 0.5, lake);\n  // col = vec3(lakeBlurDepth);\n\n  #ifdef WATER\n  ft0 = 0.5;\n  ftf = 0.1;\n  float edgeAlpha = smoothstep(ft0+ftf, ft0-ftf, lake + edgeOff2D.r * 0.05);\n  gl_FragColor = vec4(mix(groundColor, col, edgeAlpha), 1.0);\n  #else\n  ftf = 0.4;\n  ft0 = 0.1;\n  float edgeAlpha = smoothstep(ftf+ft0, ftf-ft0, lake + (waterColorMap.g*2.0-1.0) * 0.25);\n  // gl_FragColor = vec4(vec3(step(0.25, lake)), 1.0);\n  gl_FragColor = vec4(col, edgeAlpha);\n  // gl_FragColor = vec4(mix(groundColor, col, edgeAlpha), 1.0);\n  #endif\n\n  // gl_FragColor = vec4(vec3(col), edgeAlpha);\n  gl_FragColor = clamp(gl_FragColor.rgba, 0.0, 1.0);\n  // vec3 distortion = texture2D(mapWaterNormal, vTextureUv * distortionScale).rgb * 2.0 - 1.0;\n  // gl_FragColor = vec4(vec3(wakeData.r), 1.0);\n  // dst *= sin(vTextureUv.x * 4.0 + timeOff);\n  // gl_FragColor = vec4(vec3(distortion.r), 1.0);\n  // gl_FragColor = vec4(vec3(1.0-lake), 1.0);\n}\n";
},{}],"XGea":[function(require,module,exports) {
var define;
var t;!function(i,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof t&&t.amd?t(n):(i=i||self).RBush=n()}(this,function(){"use strict";function t(t,r,e,a,h){!function t(n,r,e,a,h){for(;a>e;){if(a-e>600){var o=a-e+1,s=r-e+1,l=Math.log(o),f=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*f*(o-f)/o)*(s-o/2<0?-1:1);t(n,r,Math.max(e,Math.floor(r-s*f/o+u)),Math.min(a,Math.floor(r+(o-s)*f/o+u)),h)}var m=n[r],c=e,p=a;for(i(n,e,r),h(n[a],m)>0&&i(n,e,a);c<p;){for(i(n,c,p),c++,p--;h(n[c],m)<0;)c++;for(;h(n[p],m)>0;)p--}0===h(n[e],m)?i(n,e,p):i(n,++p,a),p<=r&&(e=p+1),r<=p&&(a=p-1)}}(t,r,e||0,a||t.length-1,h||n)}function i(t,i,n){var r=t[i];t[i]=t[n],t[n]=r}function n(t,i){return t<i?-1:t>i?1:0}var r=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function e(t,i,n){if(!n)return i.indexOf(t);for(var r=0;r<i.length;r++)if(n(t,i[r]))return r;return-1}function a(t,i){h(t,0,t.children.length,i,t)}function h(t,i,n,r,e){e||(e=p(null)),e.minX=1/0,e.minY=1/0,e.maxX=-1/0,e.maxY=-1/0;for(var a=i;a<n;a++){var h=t.children[a];o(e,t.leaf?r(h):h)}return e}function o(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function s(t,i){return t.minX-i.minX}function l(t,i){return t.minY-i.minY}function f(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function m(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function c(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function d(i,n,r,e,a){for(var h=[n,r];h.length;)if(!((r=h.pop())-(n=h.pop())<=e)){var o=n+Math.ceil((r-n)/e/2)*e;t(i,o,n,r,a),h.push(n,o,o,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(t){var i=this.data,n=[];if(!c(t,i))return n;for(var r=this.toBBox,e=[];i;){for(var a=0;a<i.children.length;a++){var h=i.children[a],o=i.leaf?r(h):h;c(t,o)&&(i.leaf?n.push(h):m(t,o)?this._all(h,n):e.push(h))}i=e.pop()}return n},r.prototype.collides=function(t){var i=this.data;if(!c(t,i))return!1;for(var n=[];i;){for(var r=0;r<i.children.length;r++){var e=i.children[r],a=i.leaf?this.toBBox(e):e;if(c(t,a)){if(i.leaf||m(t,a))return!0;n.push(e)}}i=n.pop()}return!1},r.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0;i<t.length;i++)this.insert(t[i]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},r.prototype.clear=function(){return this.data=p([]),this},r.prototype.remove=function(t,i){if(!t)return this;for(var n,r,a,h=this.data,o=this.toBBox(t),s=[],l=[];h||s.length;){if(h||(h=s.pop(),r=s[s.length-1],n=l.pop(),a=!0),h.leaf){var f=e(t,h.children,i);if(-1!==f)return h.children.splice(f,1),s.push(h),this._condense(s),this}a||h.leaf||!m(h,o)?r?(n++,h=r.children[n],a=!1):h=null:(s.push(h),l.push(n),n=0,r=h,h=h.children[0])}return this},r.prototype.toBBox=function(t){return t},r.prototype.compareMinX=function(t,i){return t.minX-i.minX},r.prototype.compareMinY=function(t,i){return t.minY-i.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(t){return this.data=t,this},r.prototype._all=function(t,i){for(var n=[];t;)t.leaf?i.push.apply(i,t.children):n.push.apply(n,t.children),t=n.pop();return i},r.prototype._build=function(t,i,n,r){var e,h=n-i+1,o=this._maxEntries;if(h<=o)return a(e=p(t.slice(i,n+1)),this.toBBox),e;r||(r=Math.ceil(Math.log(h)/Math.log(o)),o=Math.ceil(h/Math.pow(o,r-1))),(e=p([])).leaf=!1,e.height=r;var s=Math.ceil(h/o),l=s*Math.ceil(Math.sqrt(o));d(t,i,n,l,this.compareMinX);for(var f=i;f<=n;f+=l){var u=Math.min(f+l-1,n);d(t,f,u,s,this.compareMinY);for(var m=f;m<=u;m+=s){var c=Math.min(m+s-1,u);e.children.push(this._build(t,m,c,r-1))}}return a(e,this.toBBox),e},r.prototype._chooseSubtree=function(t,i,n,r){for(;r.push(i),!i.leaf&&r.length-1!==n;){for(var e=1/0,a=1/0,h=void 0,o=0;o<i.children.length;o++){var s=i.children[o],l=f(s),u=(m=t,c=s,(Math.max(c.maxX,m.maxX)-Math.min(c.minX,m.minX))*(Math.max(c.maxY,m.maxY)-Math.min(c.minY,m.minY))-l);u<a?(a=u,e=l<e?l:e,h=s):u===a&&l<e&&(e=l,h=s)}i=h||i.children[0]}var m,c;return i},r.prototype._insert=function(t,i,n){var r=n?t:this.toBBox(t),e=[],a=this._chooseSubtree(r,this.data,i,e);for(a.children.push(t),o(a,r);i>=0&&e[i].children.length>this._maxEntries;)this._split(e,i),i--;this._adjustParentBBoxes(r,e,i)},r.prototype._split=function(t,i){var n=t[i],r=n.children.length,e=this._minEntries;this._chooseSplitAxis(n,e,r);var h=this._chooseSplitIndex(n,e,r),o=p(n.children.splice(h,n.children.length-h));o.height=n.height,o.leaf=n.leaf,a(n,this.toBBox),a(o,this.toBBox),i?t[i-1].children.push(o):this._splitRoot(n,o)},r.prototype._splitRoot=function(t,i){this.data=p([t,i]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(t,i,n){for(var r,e,a,o,s,l,u,m=1/0,c=1/0,p=i;p<=n-i;p++){var d=h(t,0,p,this.toBBox),x=h(t,p,n,this.toBBox),v=(e=d,a=x,void 0,void 0,void 0,void 0,o=Math.max(e.minX,a.minX),s=Math.max(e.minY,a.minY),l=Math.min(e.maxX,a.maxX),u=Math.min(e.maxY,a.maxY),Math.max(0,l-o)*Math.max(0,u-s)),M=f(d)+f(x);v<m?(m=v,r=p,c=M<c?M:c):v===m&&M<c&&(c=M,r=p)}return r||n-i},r.prototype._chooseSplitAxis=function(t,i,n){var r=t.leaf?this.compareMinX:s,e=t.leaf?this.compareMinY:l;this._allDistMargin(t,i,n,r)<this._allDistMargin(t,i,n,e)&&t.children.sort(r)},r.prototype._allDistMargin=function(t,i,n,r){t.children.sort(r);for(var e=this.toBBox,a=h(t,0,i,e),s=h(t,n-i,n,e),l=u(a)+u(s),f=i;f<n-i;f++){var m=t.children[f];o(a,t.leaf?e(m):m),l+=u(a)}for(var c=n-i-1;c>=i;c--){var p=t.children[c];o(s,t.leaf?e(p):p),l+=u(s)}return l},r.prototype._adjustParentBBoxes=function(t,i,n){for(var r=n;r>=0;r--)o(i[r],t)},r.prototype._condense=function(t){for(var i=t.length-1,n=void 0;i>=0;i--)0===t[i].children.length?i>0?(n=t[i-1].children).splice(n.indexOf(t[i]),1):this.clear():a(t[i],this.toBBox)},r});
},{}],"s4g9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class t{constructor(t=[],e=s){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:e}=this,h=s[t];for(;t>0;){const i=t-1>>1,a=s[i];if(e(h,a)>=0)break;s[t]=a,t=i}s[t]=h}_down(t){const{data:s,compare:e}=this,h=this.length>>1,i=s[t];for(;t<h;){let h=1+(t<<1),a=s[h];const n=h+1;if(n<this.length&&e(s[n],a)<0&&(h=n,a=s[n]),e(a,i)>=0)break;s[t]=a,t=h}s[t]=i}}function s(t,s){return t<s?-1:t>s?1:0}exports.default=t;
},{}],"cnAj":[function(require,module,exports) {
var define;
var t;!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof t&&t.amd?t(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).predicates={})}(this,function(t){"use strict";const e=134217729;function n(t,e,n,o,r){let f,u,i,s,c=e[0],a=o[0],l=0,d=0;a>c==a>-c?(f=c,c=e[++l]):(f=a,a=o[++d]);let p=0;if(l<t&&d<n)for(a>c==a>-c?(i=f-((u=c+f)-c),c=e[++l]):(i=f-((u=a+f)-a),a=o[++d]),f=u,0!==i&&(r[p++]=i);l<t&&d<n;)a>c==a>-c?(i=f-((u=f+c)-(s=u-f))+(c-s),c=e[++l]):(i=f-((u=f+a)-(s=u-f))+(a-s),a=o[++d]),f=u,0!==i&&(r[p++]=i);for(;l<t;)i=f-((u=f+c)-(s=u-f))+(c-s),c=e[++l],f=u,0!==i&&(r[p++]=i);for(;d<n;)i=f-((u=f+a)-(s=u-f))+(a-s),a=o[++d],f=u,0!==i&&(r[p++]=i);return 0===f&&0!==p||(r[p++]=f),p}function o(t){return new Float64Array(t)}const r=o(4),f=o(8),u=o(12),i=o(16),s=o(4);t.orient2d=function(t,o,c,a,l,d){const p=(o-d)*(c-l),b=(t-l)*(a-d),h=p-b;if(0===p||0===b||p>0!=b>0)return h;const y=Math.abs(p+b);return Math.abs(h)>=3.3306690738754716e-16*y?h:-function(t,o,c,a,l,d,p){let b,h,y,M,x,g,j,m,v,T,_,w,A,F,O,P,k,q;const z=t-l,B=c-l,C=o-d,D=a-d;x=(O=(m=z-(j=(g=e*z)-(g-z)))*(T=D-(v=(g=e*D)-(g-D)))-((F=z*D)-j*v-m*v-j*T))-(_=O-(k=(m=C-(j=(g=e*C)-(g-C)))*(T=B-(v=(g=e*B)-(g-B)))-((P=C*B)-j*v-m*v-j*T))),r[0]=O-(_+x)+(x-k),x=(A=F-((w=F+_)-(x=w-F))+(_-x))-(_=A-P),r[1]=A-(_+x)+(x-P),x=(q=w+_)-w,r[2]=w-(q-x)+(_-x),r[3]=q;let E=function(t,e){let n=e[0];for(let o=1;o<4;o++)n+=e[o];return n}(0,r),G=2.2204460492503146e-16*p;if(E>=G||-E>=G)return E;if(b=t-(z+(x=t-z))+(x-l),y=c-(B+(x=c-B))+(x-l),h=o-(C+(x=o-C))+(x-d),M=a-(D+(x=a-D))+(x-d),0===b&&0===h&&0===y&&0===M)return E;if(G=1.1093356479670487e-31*p+3.3306690738754706e-16*Math.abs(E),(E+=z*M+D*b-(C*y+B*h))>=G||-E>=G)return E;x=(O=(m=b-(j=(g=e*b)-(g-b)))*(T=D-(v=(g=e*D)-(g-D)))-((F=b*D)-j*v-m*v-j*T))-(_=O-(k=(m=h-(j=(g=e*h)-(g-h)))*(T=B-(v=(g=e*B)-(g-B)))-((P=h*B)-j*v-m*v-j*T))),s[0]=O-(_+x)+(x-k),x=(A=F-((w=F+_)-(x=w-F))+(_-x))-(_=A-P),s[1]=A-(_+x)+(x-P),x=(q=w+_)-w,s[2]=w-(q-x)+(_-x),s[3]=q;const H=n(4,r,4,s,f);x=(O=(m=z-(j=(g=e*z)-(g-z)))*(T=M-(v=(g=e*M)-(g-M)))-((F=z*M)-j*v-m*v-j*T))-(_=O-(k=(m=C-(j=(g=e*C)-(g-C)))*(T=y-(v=(g=e*y)-(g-y)))-((P=C*y)-j*v-m*v-j*T))),s[0]=O-(_+x)+(x-k),x=(A=F-((w=F+_)-(x=w-F))+(_-x))-(_=A-P),s[1]=A-(_+x)+(x-P),x=(q=w+_)-w,s[2]=w-(q-x)+(_-x),s[3]=q;const I=n(H,f,4,s,u);x=(O=(m=b-(j=(g=e*b)-(g-b)))*(T=M-(v=(g=e*M)-(g-M)))-((F=b*M)-j*v-m*v-j*T))-(_=O-(k=(m=h-(j=(g=e*h)-(g-h)))*(T=y-(v=(g=e*y)-(g-y)))-((P=h*y)-j*v-m*v-j*T))),s[0]=O-(_+x)+(x-k),x=(A=F-((w=F+_)-(x=w-F))+(_-x))-(_=A-P),s[1]=A-(_+x)+(x-P),x=(q=w+_)-w,s[2]=w-(q-x)+(_-x),s[3]=q;const J=n(I,u,4,s,i);return i[J-1]}(t,o,c,a,l,d,y)},t.orient2dfast=function(t,e,n,o,r,f){return(e-f)*(n-r)-(t-r)*(o-f)},Object.defineProperty(t,"__esModule",{value:!0})});
},{}],"jw7w":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fastConvexHull=g,exports.default=void 0;var n=u(require("rbush")),r=u(require("tinyqueue")),e=u(require("point-in-polygon")),t=i(require("robust-predicates/umd/orient2d.min.js"));function a(n){if("function"!=typeof WeakMap)return null;var r=new WeakMap,e=new WeakMap;return(a=function(n){return n?e:r})(n)}function i(n,r){if(!r&&n&&n.__esModule)return n;if(null===n||"object"!=typeof n&&"function"!=typeof n)return{default:n};var e=a(r);if(e&&e.has(n))return e.get(n);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in n)if("default"!==u&&Object.prototype.hasOwnProperty.call(n,u)){var o=i?Object.getOwnPropertyDescriptor(n,u):null;o&&(o.get||o.set)?Object.defineProperty(t,u,o):t[u]=n[u]}return t.default=n,e&&e.set(n,t),t}function u(n){return n&&n.__esModule?n:{default:n}}const o=t.orient2d;var f=p;function p(r,e,t){e=Math.max(0,void 0===e?2:e),t=t||0;var a=g(r),i=new n.default(16);i.toBBox=function(n){return{minX:n[0],minY:n[1],maxX:n[0],maxY:n[1]}},i.compareMinX=function(n,r){return n[0]-r[0]},i.compareMinY=function(n,r){return n[1]-r[1]},i.load(r);for(var u,o=[],f=0;f<a.length;f++){var p=a[f];i.remove(p),u=M(p,u),o.push(u)}var m=new n.default(16);for(f=0;f<o.length;f++)m.insert(d(o[f]));for(var v=e*e,c=t*t;o.length;){var h=o.shift(),s=h.p,x=h.next.p,Y=X(s,x);if(!(Y<c)){var y=Y/v;(p=l(i,h.prev.p,s,x,h.next.next.p,y,m))&&Math.min(X(p,s),X(p,x))<=y&&(o.push(h),o.push(M(p,h)),i.remove(p),m.remove(h),m.insert(d(h)),m.insert(d(h.next)))}}h=u;var b=[];do{b.push(h.p),h=h.next}while(h!==u);return b.push(h.p),b}function l(n,e,t,a,i,u,o){for(var f=new r.default([],m),p=n.data;p;){for(var l=0;l<p.children.length;l++){var c=p.children[l],s=p.leaf?Y(c,t,a):v(t,a,c);s>u||f.push({node:c,dist:s})}for(;f.length&&!f.peek().node.children;){var x=f.pop(),d=x.node,g=Y(d,e,t),M=Y(d,a,i);if(x.dist<g&&x.dist<M&&h(t,d,o)&&h(a,d,o))return d}(p=f.pop())&&(p=p.node)}return null}function m(n,r){return n.dist-r.dist}function v(n,r,e){if(c(n,e)||c(r,e))return 0;var t=y(n[0],n[1],r[0],r[1],e.minX,e.minY,e.maxX,e.minY);if(0===t)return 0;var a=y(n[0],n[1],r[0],r[1],e.minX,e.minY,e.minX,e.maxY);if(0===a)return 0;var i=y(n[0],n[1],r[0],r[1],e.maxX,e.minY,e.maxX,e.maxY);if(0===i)return 0;var u=y(n[0],n[1],r[0],r[1],e.minX,e.maxY,e.maxX,e.maxY);return 0===u?0:Math.min(t,a,i,u)}function c(n,r){return n[0]>=r.minX&&n[0]<=r.maxX&&n[1]>=r.minY&&n[1]<=r.maxY}function h(n,r,e){for(var t=Math.min(n[0],r[0]),a=Math.min(n[1],r[1]),i=Math.max(n[0],r[0]),u=Math.max(n[1],r[1]),o=e.search({minX:t,minY:a,maxX:i,maxY:u}),f=0;f<o.length;f++)if(x(o[f].p,o[f].next.p,n,r))return!1;return!0}function s(n,r,e){return o(n[0],n[1],r[0],r[1],e[0],e[1])}function x(n,r,e,t){return n!==t&&r!==e&&s(n,r,e)>0!=s(n,r,t)>0&&s(e,t,n)>0!=s(e,t,r)>0}function d(n){var r=n.p,e=n.next.p;return n.minX=Math.min(r[0],e[0]),n.minY=Math.min(r[1],e[1]),n.maxX=Math.max(r[0],e[0]),n.maxY=Math.max(r[1],e[1]),n}function g(n){for(var r=n[0],t=n[0],a=n[0],i=n[0],u=0;u<n.length;u++){var o=n[u];o[0]<r[0]&&(r=o),o[0]>a[0]&&(a=o),o[1]<t[1]&&(t=o),o[1]>i[1]&&(i=o)}var f=[r,t,a,i],p=f.slice();for(u=0;u<n.length;u++)(0,e.default)(n[u],f)||p.push(n[u]);return w(p)}function M(n,r){var e={p:n,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return r?(e.next=r.next,e.prev=r,r.next.prev=e,r.next=e):(e.prev=e,e.next=e),e}function X(n,r){var e=n[0]-r[0],t=n[1]-r[1];return e*e+t*t}function Y(n,r,e){var t=r[0],a=r[1],i=e[0]-t,u=e[1]-a;if(0!==i||0!==u){var o=((n[0]-t)*i+(n[1]-a)*u)/(i*i+u*u);o>1?(t=e[0],a=e[1]):o>0&&(t+=i*o,a+=u*o)}return(i=n[0]-t)*i+(u=n[1]-a)*u}function y(n,r,e,t,a,i,u,o){var f,p,l,m,v=e-n,c=t-r,h=u-a,s=o-i,x=n-a,d=r-i,g=v*v+c*c,M=v*h+c*s,X=h*h+s*s,Y=v*x+c*d,y=h*x+s*d,b=g*X-M*M,w=b,O=b;0===b?(p=0,w=1,m=y,O=X):(m=g*y-M*Y,(p=M*y-X*Y)<0?(p=0,m=y,O=X):p>w&&(p=w,m=y+M,O=X)),m<0?(m=0,-Y<0?p=0:-Y>g?p=w:(p=-Y,w=g)):m>O&&(m=O,-Y+M<0?p=0:-Y+M>g?p=w:(p=-Y+M,w=g));var j=(1-(l=0===m?0:m/O))*a+l*u-((1-(f=0===p?0:p/w))*n+f*e),P=(1-l)*i+l*o-((1-f)*r+f*t);return j*j+P*P}function b(n,r){return n[0]===r[0]?n[1]-r[1]:n[0]-r[0]}function w(n){n.sort(b);for(var r=[],e=0;e<n.length;e++){for(;r.length>=2&&s(r[r.length-2],r[r.length-1],n[e])<=0;)r.pop();r.push(n[e])}for(var t=[],a=n.length-1;a>=0;a--){for(;t.length>=2&&s(t[t.length-2],t[t.length-1],n[a])<=0;)t.pop();t.push(n[a])}return t.pop(),r.pop(),r.concat(t)}exports.default=f;
},{"rbush":"XGea","tinyqueue":"s4g9","point-in-polygon":"vDBG","robust-predicates/umd/orient2d.min.js":"cnAj"}],"DuIB":[function(require,module,exports) {
function e(e,n,o,r){return e[0]=n[0]+o[0]*r,e[1]=n[1]+o[1]*r,e}module.exports=e;
},{}],"rrZM":[function(require,module,exports) {
function t(t,n,o){var r=Math.cos(o),a=Math.sin(o),e=n[0],s=n[1];return t[0]=e*r-s*a,t[1]=e*a+s*r,t}module.exports=t;
},{}],"pe3v":[function(require,module,exports) {
var r=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],n=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function t(t,e,f,o){if(!(isNaN(o)||o<1)){var x,b,g,i,l,s,u,h,v,c,w,N,d,m,p,j,k,q,y,z,A,B,C,D,E=(o|=0)+o+1,F=e-1,G=f-1,H=o+1,I=H*(H+1)/2,J=new a,K=J;for(g=1;g<E;g++)if(K=K.next=new a,g==H)var L=K;K.next=J;var M=null,O=null;u=s=0;var P=r[o],Q=n[o];for(b=0;b<f;b++){for(j=k=q=y=h=v=c=w=0,N=H*(z=t[s]),d=H*(A=t[s+1]),m=H*(B=t[s+2]),p=H*(C=t[s+3]),h+=I*z,v+=I*A,c+=I*B,w+=I*C,K=J,g=0;g<H;g++)K.r=z,K.g=A,K.b=B,K.a=C,K=K.next;for(g=1;g<H;g++)i=s+((F<g?F:g)<<2),h+=(K.r=z=t[i])*(D=H-g),v+=(K.g=A=t[i+1])*D,c+=(K.b=B=t[i+2])*D,w+=(K.a=C=t[i+3])*D,j+=z,k+=A,q+=B,y+=C,K=K.next;for(M=J,O=L,x=0;x<e;x++)t[s+3]=C=w*P>>Q,0!=C?(C=255/C,t[s]=(h*P>>Q)*C,t[s+1]=(v*P>>Q)*C,t[s+2]=(c*P>>Q)*C):t[s]=t[s+1]=t[s+2]=0,h-=N,v-=d,c-=m,w-=p,N-=M.r,d-=M.g,m-=M.b,p-=M.a,i=u+((i=x+o+1)<F?i:F)<<2,h+=j+=M.r=t[i],v+=k+=M.g=t[i+1],c+=q+=M.b=t[i+2],w+=y+=M.a=t[i+3],M=M.next,N+=z=O.r,d+=A=O.g,m+=B=O.b,p+=C=O.a,j-=z,k-=A,q-=B,y-=C,O=O.next,s+=4;u+=e}for(x=0;x<e;x++){for(k=q=y=j=v=c=w=h=0,N=H*(z=t[s=x<<2]),d=H*(A=t[s+1]),m=H*(B=t[s+2]),p=H*(C=t[s+3]),h+=I*z,v+=I*A,c+=I*B,w+=I*C,K=J,g=0;g<H;g++)K.r=z,K.g=A,K.b=B,K.a=C,K=K.next;for(l=e,g=1;g<=o;g++)s=l+x<<2,h+=(K.r=z=t[s])*(D=H-g),v+=(K.g=A=t[s+1])*D,c+=(K.b=B=t[s+2])*D,w+=(K.a=C=t[s+3])*D,j+=z,k+=A,q+=B,y+=C,K=K.next,g<G&&(l+=e);for(s=x,M=J,O=L,b=0;b<f;b++)t[(i=s<<2)+3]=C=w*P>>Q,C>0?(C=255/C,t[i]=(h*P>>Q)*C,t[i+1]=(v*P>>Q)*C,t[i+2]=(c*P>>Q)*C):t[i]=t[i+1]=t[i+2]=0,h-=N,v-=d,c-=m,w-=p,N-=M.r,d-=M.g,m-=M.b,p-=M.a,i=x+((i=b+H)<G?i:G)*e<<2,h+=j+=M.r=t[i],v+=k+=M.g=t[i+1],c+=q+=M.b=t[i+2],w+=y+=M.a=t[i+3],M=M.next,N+=z=O.r,d+=A=O.g,m+=B=O.b,p+=C=O.a,j-=z,k-=A,q-=B,y-=C,O=O.next,s+=e}}}function a(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}module.exports=t;
},{}],"qc3d":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EnvironmentGrid=exports.GridBounds=exports.EnvironmentCell=void 0;var i=o(require("../../util/math")),s=e(require("../../util/Random"));function e(i){return i&&i.__esModule?i:{default:i}}function t(i){if("function"!=typeof WeakMap)return null;var s=new WeakMap,e=new WeakMap;return(t=function(i){return i?e:s})(i)}function o(i,s){if(!s&&i&&i.__esModule)return i;if(null===i||"object"!=typeof i&&"function"!=typeof i)return{default:i};var e=t(s);if(e&&e.has(i))return e.get(i);var o={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in i)if("default"!==r&&Object.prototype.hasOwnProperty.call(i,r)){var n=l?Object.getOwnPropertyDescriptor(i,r):null;n&&(n.get||n.set)?Object.defineProperty(o,r,n):o[r]=i[r]}return o.default=i,e&&e.set(i,o),o}class l{constructor(i,s,e,t,o){this.samples=[],this.waterSamples=[],this.patches=[],this.tokens=[],this.seed=i,this.moisture=0,this.elevation=0,this.path=0,this.colorIndex=0,this.x=s,this.y=e,this.cx=t,this.cy=o,this.entity=null}}exports.EnvironmentCell=l;class r{constructor(i,s,e,t){this.minX=i,this.minY=s,this.maxX=e,this.maxY=t}}exports.GridBounds=r;class n{constructor(i,s,e,t,o){this.size=e,this.cellDivisions=Math.ceil(this.size/t),this.colorDivisions=Math.ceil(this.size/o),this.cellTileSize=this.size/this.cellDivisions,this.colorTileSize=this.size/this.colorDivisions,this.colors=s,this.colorIndices=new Uint8Array(this.colorDivisions*this.colorDivisions),this.cells=new Array(this.cellDivisions*this.cellDivisions);for(let r=0;r<this.cells.length;r++){const s=new Uint16Array(4);for(let l=0;l<4;l++)s[l]=65536*i.value();const e=Math.floor(r%this.cellDivisions),t=Math.floor(r/this.cellDivisions),o=-this.size/2+e*this.cellTileSize+this.cellTileSize/2,n=-this.size/2+t*this.cellTileSize+this.cellTileSize/2;this.cells[r]=new l(s,e,t,o,n)}}box3ToBounds(s,e=new r){const t=s.min,o=s.max,l=i.inverseLerp(-this.size/2,this.size/2,t.x),n=i.inverseLerp(-this.size/2,this.size/2,t.z),h=i.inverseLerp(-this.size/2,this.size/2,o.x),c=i.inverseLerp(-this.size/2,this.size/2,o.z);return e.minX=i.clamp(Math.floor(l*this.cellDivisions),0,this.cellDivisions-1),e.minY=i.clamp(Math.floor(n*this.cellDivisions),0,this.cellDivisions-1),e.maxX=i.clamp(Math.floor(h*this.cellDivisions),0,this.cellDivisions-1),e.maxY=i.clamp(Math.floor(c*this.cellDivisions),0,this.cellDivisions-1),e}forEachCellInBounds(i,s){const{maxX:e,maxY:t,minX:o,minY:l}=i;for(let r=o;r<=e;r++)for(let i=l;i<=t;i++){const e=r+i*this.cellDivisions;s(this.cells[e])}}isCellInBounds(i,s){const{maxX:e,maxY:t,minX:o,minY:l}=s;return i.x>=o&&i.x<=e&&i.y>=l&&i.y<=t}getCellAt(s,e){const t=i.inverseLerp(-this.size/2,this.size/2,s),o=i.inverseLerp(-this.size/2,this.size/2,e),l=Math.floor(t*this.cellDivisions)+Math.floor(o*this.cellDivisions)*this.cellDivisions;return this.cells[l]}getColorAt(s,e){const t=i.inverseLerp(-this.size/2,this.size/2,s),o=i.inverseLerp(-this.size/2,this.size/2,e),l=Math.floor(t*this.colorDivisions)+Math.floor(o*this.colorDivisions)*this.colorDivisions;return this.colors[this.colorIndices[l]%this.colors.length]}}exports.EnvironmentGrid=n;
},{"../../util/math":"Ov1X","../../util/Random":"LMfK"}],"oBk9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=R;var e=B(require("../../tags")),t=B(require("three")),n=require("d3-polygon"),o=E(require("canvas-sketch-util/color")),r=E(require("fast-2d-poisson-disk-sampling")),a=E(require("../../shaders/water.frag")),i=E(require("../../util/Random")),s=require("../../util/mst"),l=E(require("euclidean-distance/squared")),u=require("d3-delaunay"),c=E(require("simplex-noise")),d=E(require("../../util/concaveman")),f=B(require("../../util/helpers")),p=E(require("simplify-path")),h=E(require("point-in-polygon")),m=E(require("bound-points")),g=E(require("gl-vec2/scaleAndAdd")),v=E(require("gl-vec2/rotate")),w=E(require("stackblur")),M=require("../../util/geometry"),k=B(require("../../util/ShaderManager")),y=require("../../util/RefGLTFLoader"),D=require("d3-quadtree"),b=E(require("earcut")),q=B(require("../../util/math")),x=E(require("euclidean-distance")),A=require("../../util/load"),S=require("./EnvironmentGrid"),C=require("../../util/tokens");function E(e){return e&&e.__esModule?e:{default:e}}function P(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(P=function(e){return e?n:t})(e)}function B(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=P(t);if(n&&n.has(e))return n.get(e);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var i=r?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(o,a,i):o[a]=e[a]}return o.default=e,n&&n.set(e,o),o}const I=25,T=45,L=2025;function R(o,{biome:f="forest",biomeData:A,width:E,height:P,bounds:B,renderer:T,uvMat:R,repeatX:_,repeatY:G,mapGround:F,mapOverlay:j,mapGroundPath:V,waterDistortMap:U,waterNoiseMap:H,waterVertexShader:W}){const N=[0,0],z=A[f],J=z.hasLakes,X=z.hasIce,Y=z.colors,$=z.waterColors,K=new Uint16Array(z.seed),Q=(0,i.default)(K),Z=new c.default(Q.value),ee=new c.default(Q.value),te=new t.Group;te.name=`Environment-${f}`;const ne=function(e,o,r,a,i,c){let d=o.shuffle(Te(E,P,r,o)).map(e=>{const t=e.slice(),n=o.insideCircle(.5*r,N);return t[0]+=n[0],t[1]+=n[1],{center:e,radius:r,position:t}});const f=4*r,h=f;let g=[];a&&(g=Te(E,P,f,o),g=o.shuffle(g.filter(e=>(0,x.default)(e,[0,0])>4*r)).slice(0,8));d=d.filter(e=>{(0,x.default)(e.position,[0,0]);for(let o=0;o<g.length;o++){const t=(0,x.default)(e.position,g[o]);if(t<h/2)return!1}const t=Math.abs(e.position[0]),n=Math.abs(e.position[1]);return t<E/2*.95&&n<P/2*.95});const v=(0,s.getMinimumSpanningTree)(d.map(e=>e.position),(e,t)=>(0,l.default)(e,t)).map(e=>e.indices),w=v.map(e=>{const t=e.map(e=>d[e]);return t.map(e=>e.position)}),M=B.flat(),k=w.map(e=>{const t=o.rangeFloor(5,5),n=[];for(let a=0;a<t;a++){const i=a/t,s=q.lerpArray(e[0],e[1],i);o.insideCircle(r/8,N),s[0]+=N[0],s[1]+=N[1],n.push(s)}return n}).flat(),y=function(e,t,n,o){const r=Math.max(1,Math.ceil(e/n)),a=Math.max(1,Math.ceil(t/n)),i=Math.round(5*Math.max(r,a));return q.linspace(i).map(()=>[o.range(-e/2,e/2),o.range(-t/2,t/2)])}(E,P,1,o),D=u.Delaunay.from(y);for(let t=0;t<2;t++)Ie(M,D,.5);const b=D.voronoi(M),A=Array.from(b.cellPolygons()).map((e,t)=>{const n=e.index;return n!==t&&console.error("ERR! poly index doesn't match"),e=Array.from(e).slice(0,e.length-1)}),S=A.map(e=>(0,n.polygonCentroid)(e)),C=S.map(e=>Be(e[0],e[1],k,r)),I=S.map(e=>Be(e[0],e[1],g,h/4,1,1.5)),T=A.map((e,t)=>{const n=S[t],{elevation:o,moisture:r}=O(E,P,i,c,n[0],n[1]),a=C[t],s=I[t];return{polygon:e,connections:v,segments:w,distance:a,lakeDistance:s,moisture:r,elevation:o}});Pe(T,"moisture"),Pe(T,"elevation"),Pe(T,"lakeDistance"),Pe(T,"distance");const L=new Set;T.forEach((e,t)=>{const{distance:n,moisture:o,elevation:r,lakeDistance:i}=e,s=o,l=r,u=(0,x.default)([0,0],S[t]);e.centroid=S[t],e.lengthFromCenter=u,a&&u>40&&n<.25&&(s>.5&&l<.5||i>.5)&&L.add(t)});const R=function(e,t){const n=new Set,o=new Set;return t.forEach(r=>{if(!n.has(r)){const a=function(e,t,n,o){const r=new Set,a=[n];for(;a.length>0;){const n=a.shift();r.add(n);for(let i of e.neighbors(n))!t.has(i)||r.has(i)||o.has(i)||(r.add(i),a.push(i))}return r}(e,t,r,n);a.forEach(e=>{n.add(e)}),o.add([...a])}}),[...o]}(b,L).filter(e=>e.length>2).map(e=>Ee(T,e)).map(e=>{const t=(0,p.default)(e,1);return t.length&&t.pop(),t}).filter(e=>e.length>4).map(e=>{const n=e.map(e=>new t.Vector3(e[0],0,e[1]));return new t.CatmullRomCurve3(n,!0,"chordal",.5).getSpacedPoints(8*e.length).map(e=>[e.x,e.z])});return{lakes:R,lakeBounds:R.map(e=>(0,m.default)(e)),tokens:d,segments:w,cells:T}}(0,Q,20,J,Z,ee);!function(e){e.cells.forEach(n=>{const{distance:o,moisture:r,elevation:a,lakeDistance:i}=n,s=r,l=a;let u=0;if(J){const t=10;u=n.lengthFromCenter>t&&(Se(e,n.centroid,t)||n.polygon.some(o=>Se(e,n.centroid,t)))?3:s<.5&&l>=.5?0:s<.5&&l<.5?1:2}else u=s<.5&&l>=.5?0:s<.5&&l<.5?1:s>=.5&&l>=.5?2:3;n.colorIndex=u;const c=new t.Color;c.set(Y[n.colorIndex%Y.length].color),c.offsetHSL(0,0,.05*(2*n.elevation-1)),c.offsetHSL(0,0,.1*(2*n.moisture-1)),c.offsetHSL(.01*Q.range(-1,1),.01*Q.range(-1,1),.1*(2*q.smoothstep(0,1,n.distance)-1)),n.color=c})}(ne);const oe=Q.shuffle(ne.tokens.filter(e=>{const t=(0,l.default)(e.position,[0,0]);return Q.chance(.7)&&t>=L})),re=Math.round(.75*oe.length),ae=[],ie=new S.EnvironmentGrid(Q,Y,Math.min(E,P),40,10),se=(0,D.quadtree)().x(e=>e.centroid[0]).y(e=>e.centroid[1]);se.extent(B),se.addAll(ne.cells),function(e,t){for(let n=0;n<t.colorDivisions;n++)for(let o=0;o<t.colorDivisions;o++){const r=o/(t.colorDivisions-1),a=n/(t.colorDivisions-1),i=q.lerp(-E/2,E/2,r),s=q.lerp(-P/2,P/2,a),l=e.find(i,s);t.colorIndices[o+n*t.colorDivisions]=l.colorIndex}}(se,ie);const le=Object.keys(y.MetaData).filter(e=>y.MetaData[e].type===f&&!e.includes("items")),ue=Q.deck(le);for(let e=0;e<oe.length&&ae.length<re;e++){const t=oe[e];if(!Se(ne,t.position,4)){const e=t.position.slice(),n=(ie.getColorAt(e[0],e[1]),ue.current),o=y.MetaData[n];if(q.linspace(8).map(t=>{const n=2*Math.PI*t;return[Math.cos(n)*o.boundingCircle.radius+e[0],Math.sin(n)*o.boundingCircle.radius+e[1]]}).some(e=>Se(ne,e,4)))continue;const r={name:n,position:e};ae.push(r);const a=.85*o.boundingCircle.radius;t.position[1]+=a,ue.next()}}const ce=oe.filter(e=>!1!==e.active&&(0,M.point2DInsideBounds)(e.position,B)&&!Se(ne,e.position,4));let de=function(e,t,n,o,a,i){const s=new r.default({shape:[E,P],tries:10,radius:3},o.value),u=[0,0],c=[0,0],d=[0,0],f=[0,0],p=[0,0],h=[0,0];t.segments.forEach(([e,t])=>{!function(e=[],t,n){let o=n[0]-t[0],r=n[1]-t[1];const a=o*o+r*r;if(0!==a){const e=Math.sqrt(a);o/=e,r/=e}e[0]=o,e[1]=r}(u,e,t),function(e=[],t){e[0]=-t[1],e[1]=t[0]}(c,u);const n=(0,x.default)(e,t),{elevation:r,moisture:l}=O(E,P,a,i,(e[0]+t[0])/2,(e[1]+t[1])/2),m=q.lerp(.25,20,r),w=Math.max(2,Math.ceil(n/m));for(let a=0;a<w;a++){let n=a/(w-1);n=q.lerp(0,1,n);const r=o.rangeFloor(1,6);for(let a=0;a<r;a++){const r=q.lerpArray(e,t,n,d);r[0]+=E/2,r[1]+=P/2;const a=Math.abs(o.gaussian(1,1));(0,g.default)(r,r,o.insideCircle(a,h),1);const i=o.range(15,20)+Math.abs(o.gaussian(0,5));for(let e=0;e<2;e++){const t=0===e?-1:1,n=45;(0,v.default)(p,c,q.degToRad(o.range(-n,n))),(0,g.default)(f,r,p,i*t),s.inNeighbourhood(f)||((0,g.default)(f,f,o.insideCircle(o.range(0,1.5),h),1),s.addPoint(f))}}}});const m=I*I;return s.samplePoints.map(e=>[-E/2+e[0],-P/2+e[1]]).filter(t=>{return!n.some(e=>(0,l.default)(e.position,t)<16)&&!e.some(e=>{const n=e.name in y.MetaData&&y.MetaData[e.name];if(n){const o=n.boundingCircle.radius;return(0,M.circlesIntersect)(t,1,e.position,o)}return!1})&&(0,l.default)(t,[0,0])>m})}(ae,ne,ce,Q,Z,ee),fe=[],pe=[];de.forEach(e=>{if(Se(ne,e,1));else{if(X&&Q.chance(.5))return;fe.push(e)}}),J&&ne.lakeBounds.forEach((e,t)=>{const[n,o]=e,a=o[0]-n[0],i=o[1]-n[1];new r.default({shape:[a,i],tries:10,radius:10},Q.value).fill().map(e=>[n[0]+e[0],n[1]+e[1]]).filter(n=>{if((0,M.point2DInsideBounds)(n,e)&&(0,h.default)(n,ne.lakes[t])){const e=2.5,o=e*e;if(!ne.lakes[t].some(e=>(0,l.default)(e,n)<o))return!0}return!1}).forEach(e=>{pe.push(e)})});const he=function(e,n,o,r){const a=document.createElement("canvas"),i=a.getContext("2d");return[0,1,2,3,4].map((s,l)=>{let u=s>=2?256:512;4===s&&(u=128),a.width=u,a.height=u,function(e,t,n,o){t.fillStyle="black",t.clearRect(0,0,n,n),t.fillRect(0,0,n,n);const[r,a]=B,i=a[0]-r[0],s=a[1]-r[1],l=e.width/i,u=e.height/s;t.save(),t.scale(l,u),t.translate(E/2,P/2),t.scale(1,1),o({context:t,canvas:e}),t.restore()}(a,i,u,({canvas:e,context:a})=>(function({c:e,i:n,canvas:o,context:r,geo:a,groundColors:i,waterColors:s}){const l=new t.Color;0===e||1===e?a.cells.forEach(t=>{let n;if(0===e){const e=.2*Q.range(-1,1),o=.2*Q.range(-1,1),r=.2*Q.range(-1,1);l.setRGB(q.clamp01(t.moisture+e),q.clamp01(t.elevation+o),q.clamp01(t.distance+r)),n=l.getStyle()}else n=t.color.getStyle();r.fillStyle=r.strokeStyle=n,r.beginPath(),t.polygon.forEach(e=>r.lineTo(...e)),r.lineJoin="round",r.lineWidth=1,r.fill(),r.stroke()}):a.lakes.forEach((t,n)=>{r.fillStyle="white",r.strokeStyle=4===e?"white":"black",r.beginPath(),t.forEach(e=>r.lineTo(...e)),r.lineJoin="round",r.closePath(),r.lineWidth=4===e?.5:2,r.fill(),r.stroke()})})({c:s,i:l,canvas:e,context:a,geo:n,groundColors:o,waterColors:r}));let c=2,d=4;2===s?(c=1,d=2):3===s?(c=2,d=8):4===s&&(c=0,d=0),c>0&&function(e,t,n,o=1,r=8){const a=e.getImageData(0,0,t,n);for(let i=0;i<o;i++)(0,w.default)(a.data,t,n,r);e.putImageData(a,0,0)}(i,u,u,c,d);const f=new t.Texture(a);return f.needsUpdate=!0,e.initTexture(f),f.image=null,f})}(T,ne,Y,$),[me,ge,ve,we,Me]=he,ke=function(r,i){const s=o.findTag(e.GroundDataRenderTarget),l=o.findTag(e.GroundPlaneView);return ne.lakes.map((r,u)=>{const[c,d]=ne.lakeBounds[u],f=d[0]-c[0],p=d[1]-c[1],h=Math.sqrt(f*f+p*p)/2,m=(0,n.polygonCentroid)(r),g=r.flat(1/0),v=(0,b.default)(g,[],2),w=new t.BufferGeometry,M=[],y=[],D=[],x=[];r.forEach((e,t,n)=>{D.push(t/(n.length-1)*Math.PI*2),y.push(e[0],0,e[1]);const o=q.inverseLerp(-E/2,E/2,e[0]),r=q.inverseLerp(P/2,-P/2,e[1]);M.push(o,r);const a=q.inverseLerp(c[0],d[0],e[0]),i=q.inverseLerp(c[1],d[1],e[1]);x.push(a,i)}),w.setAttribute("position",new t.Float32BufferAttribute(y,3)),w.setAttribute("uv",new t.Float32BufferAttribute(M,2)),w.setAttribute("surfUv",new t.Float32BufferAttribute(x,2)),w.setAttribute("angle",new t.Float32BufferAttribute(D,1)),w.setIndex(new t.Uint16BufferAttribute(v,1));const A=k.create({name:"WaterShader",uniforms:{uvScale:{value:new t.Vector2(_,G)},time:{value:0},centroidPosition:{value:new t.Vector3(m[0],0,m[1])},uvTransform:{value:R},environmentSize:{value:new t.Vector2(E,P)},worldDataMap:{value:s?s.target.texture:getEmptyTexture()},worldDataProjection:{value:s?s.projection:new t.Matrix4},worldDataView:{value:s?s.view:new t.Matrix4},waterDistortMap:{value:U},waterNoiseMap:{value:H},lakeSize:{value:h},colorA:{value:new t.Color(X?"#698193":"#163d84")},colorB:{value:new t.Color(X?"#a8bec4":"#49c2ff")},groundMap:{value:l.target.texture},dataMapBiome:{value:i[0]},dataMapColor:{value:i[1]},dataMapLake:{value:i[2]},dataMapLakeBlur:{value:i[3]},uvRepeatScale:{value:1}},side:t.BackSide,vertexShader:W,transparent:!0,defines:{WATER:!X,HAS_GROUND_MAP:!0,HAS_DATA_MAP:!0,HAS_ANGLE:!0,HAS_SURF_UV:!0},fragmentShader:a.default}),S=new t.Mesh(w,A);return S.userData.colorA=A.uniforms.colorA.value.clone(),S.userData.colorB=A.uniforms.colorB.value.clone(),te.add(S),o.entity().add(e.ShaderUniformTime,{uniform:A.uniforms.time}),S.layers.set(o.findTag(e.RenderLayers).water),S.renderOrder=-1,S.position.y=.05,S})}(0,he);!function(e,t,n,o){n.forEach((e,n)=>{const o=t.getCellAt(e[0],e[1]);o&&o.samples.push(n)}),o.forEach((e,n)=>{const o=t.getCellAt(e[0],e[1]);o&&o.waterSamples.push(n)});for(let r=0;r<t.cellDivisions;r++)for(let n=0;n<t.cellDivisions;n++){const o=n/(t.cellDivisions-1),a=r/(t.cellDivisions-1),i=q.lerp(-E/2,E/2,o),s=q.lerp(-P/2,P/2,a),l=e.find(i,s),u=t.cells[n+r*t.cellDivisions];u.elevation=l.elevation,u.moisture=l.moisture,u.path=l.distance,u.colorIndex=l.colorIndex}}(se,ie,fe,pe);const ye=C.BiomeFeatures[f].tokens,De=ce.filter(e=>{const[t,n]=B;return Math.abs(e.position[0]-t[0])>15&&Math.abs(e.position[1]-t[1])>15&&Math.abs(e.position[0]-n[0])>15&&Math.abs(e.position[1]-n[1])>15}).map(e=>({position:e.position,type:Q.pick(ye)})),be=ae.filter(e=>{const t=(0,x.default)(e.position,[0,0]);return t>=25&&t<192}),qe=Q.pick(be),xe=y.MetaData[qe.name],Ae=new t.Vector3(qe.position[0]-.75*xe.boundingCircle.radius,0,qe.position[1]-.75*xe.boundingCircle.radius);return De.forEach((e,t)=>{const[n,o]=e.position;ie.getCellAt(n,o).tokens.push(t)}),ae.push({name:"origin-patch-0",position:[0,0]}),ae.forEach((e,t)=>{const[n,o]=e.position;ie.getCellAt(n,o).patches.push(t)}),o.entity().add(e.EnvironmentState,{...z,data:{width:E,height:P},waterMeshes:ke,name:f,haikusTotal:z.haikusTotal,patches:ae,tokens:De,group:te,lakes:ne.lakes.map((e,t)=>({bounds:ne.lakeBounds[t],polygon:e})),idleViewPoint:Ae,colors:Y,textures:he,waterMap:Me,grid:ie,samples:fe,waterSamples:pe});function Se(e,t,n=2){for(let o=0;o<e.lakeBounds.length;o++)if(Ce(e,t,o,n))return!0;return!1}function Ce(e,t,n,o=2){const r=o*o,a=e.lakeBounds[n];return!(!(0,M.point2DInsideBounds)(t,a)||!(0,h.default)(t,e.lakes[n]))||!!e.lakes[n].some(e=>(0,l.default)(e,t)<r)}function Ee(e,t){const n=[];return t.forEach(t=>{const[o,r]=(0,m.default)(e[t].polygon),a=r[0]-o[0],i=r[1]-o[1],s=.5*Math.min(a,i),l=Q.range(-1,1)*Math.PI*2;q.linspace(8).map(e=>{const t=2*e*Math.PI+l,r=o[0]+a/2+Math.cos(t)*s,u=o[1]+i/2+Math.sin(t)*s;n.push([r,u])})}),(0,d.default)(n)}function Pe(e,t){const n=e.reduce((e,n)=>Math.max(e,n[t]),-1/0),o=e.reduce((e,n)=>Math.min(e,n[t]),1/0);n!==o&&e.forEach(e=>{e[t]=q.mapRange(e[t],o,n,0,1,!0)})}function Be(e,t,n,o,r=1,a=1.5,i=.5){let s=0;for(let l=0;l<n.length;l++){const u=n[l],c=e-u[0],d=t-u[1],f=c*c+d*d;let p=0===f?0:Math.sqrt(f);const h=o*r,m=o*a,g=q.clamp01(q.inverseLerp(h,m,p));s+=1-Math.pow(g,i)}return s}function Ie(e,t,o=.5){const r=t.voronoi(e);for(let a=0;a<t.points.length;a+=2){const e=r.cellPolygon(a>>1);if(null===e)continue;const i=t.points[a],s=t.points[a+1],[l,u]=(0,n.polygonCentroid)(e);t.points[a]=i+(l-i)*o,t.points[a+1]=s+(u-s)}t.update()}function Te(e,t,n,o){const a=new r.default({shape:[e,t],tries:10,radius:2*n},o.value);return a.addPoint([e/2,t/2]),a.fill().map(n=>[-e/2+n[0],-t/2+n[1]])}}function O(e,t,n,o,r,a){const{t1:i,f1:s,k1:l,t2:u,f2:c,k2:d}={f1:2,t1:4,k1:.5,f2:2,t2:4,k2:.25},f=e/t;let p=q.inverseLerp(-e/2,e/2,r),h=q.inverseLerp(-t/2,t/2,a);return p*=f,{elevation:q.lerp(Math.pow(_(n,p,h,0,i),1.2),.5*n.noise2D(p*s,h*s)+.5,l),moisture:q.lerp(Math.pow(_(o,p,h,0,u),1),.5*o.noise2D(p*c,h*c)+.5,d)}}function _(e,t,n,o=0,r=.1){const a=t*r,i=n*r;let s=1*(.5*e.noise3D(1*a,1*i,o)+.5)+.5*(.5*e.noise3D(2*a,2*i,o)+.5)+.25*(.5*e.noise3D(4*a,4*i,o)+.5)+.13*(.5*e.noise3D(8*a,8*i,o)+.5)+.06*(.5*e.noise3D(16*a,16*i,o)+.5)+.03*(.5*e.noise3D(32*a,32*i,o)+.5);return s/=1.97}
},{"../../tags":"injP","three":"IV0r","d3-polygon":"QnuL","canvas-sketch-util/color":"fy0v","fast-2d-poisson-disk-sampling":"luIz","../../shaders/water.frag":"xyPh","../../util/Random":"LMfK","../../util/mst":"k9sZ","euclidean-distance/squared":"yACJ","d3-delaunay":"V5JR","simplex-noise":"KFJE","../../util/concaveman":"jw7w","../../util/helpers":"N4w3","simplify-path":"AUVL","point-in-polygon":"vDBG","bound-points":"T2x6","gl-vec2/scaleAndAdd":"DuIB","gl-vec2/rotate":"rrZM","stackblur":"pe3v","../../util/geometry":"nZ95","../../util/ShaderManager":"igLh","../../util/RefGLTFLoader":"zcH5","d3-quadtree":"oxc3","earcut":"d3f1","../../util/math":"Ov1X","euclidean-distance":"W1EL","../../util/load":"OkDW","./EnvironmentGrid":"qc3d","../../util/tokens":"kL9I"}],"h25C":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n#define GLSLIFY 1\nvarying vec2 vUv;\nvarying vec2 vTextureUv;\n#ifdef HAS_ANGLE\nattribute float angle;\nvarying float vAngle;\n#endif\n#ifdef HAS_GROUND_MAP\nvarying vec2 vGroundUv;\n#endif\n#ifdef HAS_SURF_UV\nattribute vec2 surfUv;\nvarying vec2 vSurfUv;\n#endif\nvarying vec3 vWorldPosition;\n#ifdef HAS_DATA_MAP\nvarying vec2 vDataUv;\nuniform mat4 worldDataProjection;\nuniform mat4 worldDataView;\nuniform vec2 environmentSize;\n#endif\n#ifdef HAS_SHADOW_MAP\nvarying vec2 vShadowUv;\nvarying vec3 vShadowClipPos;\nuniform mat4 shadowProjection;\n#endif\nuniform mat3 uvTransform;\nuniform vec2 uvScale;\nuniform float uvRepeatScale;\nvoid main () {\n    vec4 worldPos = modelMatrix * vec4(position.xyz, 1.0);\n    #ifdef HAS_ANGLE\n    vAngle = angle;\n    #endif\n    #ifdef HAS_SURF_UV\n    vSurfUv = surfUv;\n    #endif\n    #ifdef HAS_SHADOW_MAP\n    // vec4 vShadowPos = shadowProjection * vec4(position.xyz, 1.0);\n    // vec2 vShadowScreen = vShadowPos.xy / vShadowPos.w;\n    // vShadowUv = vShadowScreen.xy * 0.5 + 0.5;\n    vec4 baseClipPos = shadowProjection * vec4(worldPos.xyz, 1.0);\n    vShadowClipPos = vec3(baseClipPos.xy, baseClipPos.w);\n    // vShadowUv = (baseClipPos.xy / baseClipPos.w) * 0.5 + 0.5;\n    #endif\n    #ifdef HAS_DATA_MAP\n    vec2 worldPosUV = uv;\n    worldPosUV.y = 1.0 - worldPosUV.y;\n    vec2 dataWorldPos = (worldPosUV * 2.0 - 1.0) * environmentSize / 2.0;\n    vec4 vDataUvPos4 = worldDataProjection * worldDataView * vec4(dataWorldPos.xy, 0.0, 1.0);\n    vec2 vDataScreen = vDataUvPos4.xy / vDataUvPos4.w;\n    vDataUv = vDataScreen.xy * 0.5 + 0.5;\n    #endif\n    vUv = uv;\n    vTextureUv = uv * uvScale * uvRepeatScale;\n    vTextureUv = (uvTransform * vec3(vTextureUv, 1.0)).xy;\n    vWorldPosition = worldPos.xyz;\n    gl_Position = projectionMatrix * viewMatrix * worldPos;\n    #ifdef HAS_GROUND_MAP\n    vGroundUv = gl_Position.xy / gl_Position.w * 0.5 + 0.5;\n    #endif\n}\n";
},{}],"Y2ru":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\n  #define GLSLIFY 1\n\n  float blendSoftLight(float base, float blend) {\n    return (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n  }\n    vec3 blendSoftLight(vec3 base, vec3 blend) {\n    return vec3(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b));\n  }\n    vec3 blendSoftLight(vec3 base, vec3 blend, float opacity) {\n    return (blendSoftLight(base, blend) * opacity + base * (1.0 - opacity));\n  }\n    float blendOverlay(float base, float blend) {\n    return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n  }\n    vec3 blendOverlay(vec3 base, vec3 blend) {\n    return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n  }\n    vec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n    return (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n  }\n    float luma(vec3 color) {\n        return dot(color, vec3(0.299, 0.587, 0.114));\n    }\n    float luma(vec4 color) {\n        return dot(color.rgb, vec3(0.299, 0.587, 0.114));\n    }\n    varying vec2 vUv;\n    varying vec2 vDataUv;\n    varying vec2 vShadowUv;\n    varying vec2 vTextureUv;\n    varying vec3 vShadowClipPos;\n    uniform sampler2D dataMapBiome;\n    uniform sampler2D dataMapColor;\n    uniform sampler2D dataMapLake;\n    uniform float overlayOpacity;\n    uniform float time;\n    #ifdef USE_MAP_OVERRIDE\n    uniform sampler2D overrideMap;\n    #endif\n    uniform sampler2D shadowMap;\n    uniform mat4 worldFogProjection;\n    uniform sampler2D worldFogMap;\n    uniform vec3 clearColor;\n    #ifdef USE_MAP_OVERRIDE\n    uniform bool useOverrideMap;\n    #endif\n    uniform bool useOverrideColor;\n    uniform vec3 overrideColor;\n    uniform float solved;\n    uniform vec3 originColor;\n    uniform sampler2D worldDataMap;\n    // uniform sampler2D map0;\n    // uniform sampler2D map1;\n    // uniform sampler2D map2;\n    // uniform sampler2D map3;\n    // uniform sampler2D mapPath;\n    uniform sampler2D mapGround;\n    uniform sampler2D mapGroundPath;\n    uniform sampler2D mapOverlay;\n    uniform float tutorial;\n    // vec3 blend(vec4 texture1, float a1, vec4 texture2, float a2) {\n      //     float depth = 0.2;\n    //     float ma = max(texture1.a + a1, texture2.a + a2) - depth;\n    //     float b1 = max(texture1.a + a1 - ma, 0);\n    //     float b2 = max(texture2.a + a2 - ma, 0);\n    //     return (texture1.rgb * b1 + texture2.rgb * b2) / (b1 + b2);\n    // }\n    vec3 blend(vec4 texture1, float a1, vec4 texture2, float a2) {\n        return texture1.a > texture2.a ? texture1.rgb : texture2.rgb;\n  }\n    vec4 textureLuma(sampler2D tex, vec2 uv) {\n        vec3 rgb = texture2D(tex, uv).rgb;\n      float d = dot(rgb, vec3(0.299, 0.587, 0.114));\n      return vec4(rgb, d);\n  }\n    // vec3 splat (float m, float e, float p, vec2 uv) {\n      //   vec3 tex0 = texture2D(map0, uv).rgb;\n    //   vec3 tex1 = texture2D(map1, uv).rgb;\n    //   vec3 tex2 = texture2D(map2, uv).rgb;\n    //   vec3 tex3 = texture2D(map3, uv).rgb;\n    //   vec3 texPath = texture2D(mapPath, uv).rgb;\n    //   //   mix(tex0, tex1, m),\n    //   //   mix(tex2, tex3, e),\n    //   //   p);\n    //   // return tex;\n    //   // vec3 tex;\n    //   // if (m < 0.5 && e >= 0.5) {\n      //   //   // dry, high\n    //   //   tex = tex0;\n    //   // } else if (m < 0.5 && e < 0.5) {\n      //   //   // dry, low\n    //   //   tex = tex1;\n    //   // } else if (m >= 0.5 && e >= 0.5) {\n      //   //   // wet, high\n    //   //   tex = tex2;\n    //   // } else {\n      //   //   // wet, low\n    //   //   tex = tex3;\n    //   // }\n    //   // return mix(tex, texPath, step(0.4, p));\n    //   float w0 = 0.0;\n    //   float w1 = 0.0;\n    //   float w2 = 0.0;\n    //   float w3 = 0.0;\n    //   float feather = 0.1;\n    //   float t = 0.5;\n    //   w0 = smoothstep(t + feather, t - feather, m) * smoothstep(t - feather, t + feather, e);\n    //   w1 = smoothstep(t + feather, t - feather, m) * smoothstep(t + feather, t - feather, e);\n    //   w2 = smoothstep(t - feather, t + feather, m) * smoothstep(t - feather, t + feather, e);\n    //   w3 = smoothstep(t - feather, t + feather, m) * smoothstep(t + feather, t - feather, e);\n    //   vec3 tex = vec3(0.0);\n    //   // tex = tex0 * w0;\n    //   tex += tex0 * w0 + tex1 * w1;\n    //   tex += tex2 * w2 + tex3 * w3;\n    //   float pt = 0.35;\n    //   float pf = 0.5;\n    //   return mix(tex * 0.5, tex, smoothstep(pt - pf, pt + pf, p));\n    //   // return mix(mix(tex, texPath.r * tex, 0.15), tex, smoothstep(pt - pf, pt + pf, p));\n    //   // return mix(tex, texPath.rgb, smoothstep(pt - pf, pt + pf, p));\n    // }\n    // void main () {\n      //   vec3 dataColor = texture2D(worldDataMap, vDataUv).rgb;\n    //   vec3 biome = texture2D(dataMapBiome, vUv).rgb;\n    //   vec3 worldColor = texture2D(dataMapColor, vUv).rgb;\n    //   if (useOverrideColor) {\n      //     worldColor = overrideColor;\n    //   }\n    //   vec3 overlay = texture2D(mapOverlay, vTextureUv).rgb;\n    //   vec3 groundTex = texture2D(mapGround, vTextureUv).rgb;\n    //   vec3 pathTex = texture2D(mapGroundPath, vTextureUv * 2.0).rgb;\n    //   gl_FragColor.rgb = vec3(worldColor);\n    //   vec3 worldFogColor = texture2D(worldFogMap, vUv).rgb;\n    //   gl_FragColor.rgb *= worldFogColor;\n    //   gl_FragColor.a = 1.0;\n    // }\n    float sdBox( in vec2 p, in vec2 b )\n    {\n          vec2 d = abs(p)-b;\n        return length(max(d,0.0)) + min(max(d.x,d.y),0.0);\n  }\n    void main2 () {\n        vec3 dataColor = texture2D(worldDataMap, vDataUv).rgb;\n      vec3 biome = texture2D(dataMapBiome, vUv).rgb;\n      vec3 worldColor = texture2D(dataMapColor, vUv).rgb;\n      gl_FragColor.rgb = worldColor;\n      gl_FragColor.a = 1.0;\n  }\n    void main () {\n        vec3 dataColor = texture2D(worldDataMap, vDataUv).rgb;\n      vec3 biome = texture2D(dataMapBiome, vUv).rgb;\n      vec3 worldColor = texture2D(dataMapColor, vUv).rgb;\n      vec3 oWorldColor = worldColor;\n      if (useOverrideColor) {\n          worldColor = overrideColor;\n    }\n      vec3 overlay = texture2D(mapOverlay, vTextureUv).rgb;\n      vec3 groundTex = texture2D(mapGround, vTextureUv).rgb;\n      vec3 pathTex = texture2D(mapGroundPath, vTextureUv * 2.0).rgb;\n      float wdist = 0.04;\n      float wd = distance(vUv, vec2(0.5, 0.5)) / wdist;\n      float wt = 0.5 + ((groundTex.x*2.0-1.0) * 0.5) + ((pathTex.x*2.0-1.0) * 0.5);\n      float wg = 0.45;\n      wd = smoothstep(wt - wg, wt + wg, wd);\n      float distFromCenter = 1.0 - clamp(wd, 0.0, 1.0);\n      // worldColor = mix(worldColor, vec3(0.45), distFromCenter);\n      worldColor = mix(mix(worldColor, vec3(originColor), tutorial), vec3(originColor), distFromCenter);\n      // worldColor = mix(worldColor, vec3(originColor), distFromCenter);\n\n      // float boxLen = abs(vUv.x - 0.5) + abs(vUv.y - 0.5);\n      float edgeThreshold = 0.5;\n      float edgeGlow = 0.025;\n      // worldColor = vec3(boxLen);\n      // worldColor *= step(boxLen, 0.48);\n      float edge0 = smoothstep(edgeThreshold, edgeThreshold-edgeGlow, abs(vUv.x - 0.5));\n      float edge1 = smoothstep(edgeThreshold, edgeThreshold-edgeGlow, abs(vUv.y - 0.5));\n      // worldColor = originColor;\n      // worldColor = mix(originColor, worldColor, distFromCenter);\n      // vec3 worldFogColor = texture2D(worldFogMap, vUv).rgb;\n      // worldColor.rgb *= mix(1.0, 0.0, (1.0-distFromCenter) * (1.0-worldFogColor.r));\n      float lake = texture2D(dataMapLake, vUv).r;\n      float pathEdge = smoothstep(0.4, 0.75, biome.b + (biome.r * 2.0 - 1.0) * 0.1);\n      pathEdge = clamp(pathEdge, 0.0, 1.0);\n      vec3 tex = mix(groundTex, pathTex, pathEdge);\n      vec3 col = worldColor;\n      // #ifdef USE_MAP_OVERRIDE\n      // vec3 overrideRGB = texture2D(overrideMap, vTextureUv).rgb;\n      // if (useOverrideMap) {\n        //   col *= overrideRGB;\n      // } else {\n          float darken = 0.45; //0.66;\n        col = blendSoftLight(col, col + overlay, overlayOpacity * 0.3 * biome.b * (1.0 - darken * dataColor.r));\n        col = mix(col, col * (1.0 - overlay), 0.075 * (biome.b));\n        //blendSoftLight(col, col + overlay, overlayOpacity * biome.b * (1.0 - darken * dataColor.r));\n        col = blendSoftLight(col, tex, 1.0 - darken * dataColor.r);\n        // col = blendSoftLight(col, col + overlay, overlayOpacity * biome.b * 0.075);\n        // col = blendSoftLight(col, tex, 1.0);\n      // }\n      // col = vec3(gl_FragCoord.x / 800.0);\n      // vec2 shadowUv = (vShadowClipPos.xy / vShadowClipPos.z) * 0.5 + 0.5;\n      // col *= 1.0 - 0.25 * texture2D(shadowMap, shadowUv).r;\n\n      // col = texture2D(mapGround, vShadowUv).rgb;\n      // float pt = 0.4;\n      // float pf = 0.4;\n      // float pathEdge = smoothstep(pt-pf, pt+pf, biome.b  );\n      // col = mix(col * 0.75, col * 1.0, pathEdge);\n      // col = vec3(pathEdge);\n      gl_FragColor = vec4(vec3(col), 1.0);\n      gl_FragColor = clamp(gl_FragColor, 0.0, 1.0);\n      gl_FragColor.rgb = mix(clearColor, gl_FragColor.rgb, edge0 * edge1);\n      // gl_FragColor.rgb = vec3(edge0);\n      // gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(1.0), lake);\n  }\n";
},{}],"NYVa":[function(require,module,exports) {
var process = require("process");
var e=require("process");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=U;var t=P(require("../tags")),a=P(require("three")),r=P(require("../util/helpers")),o=require("d3-polygon"),n=A(require("fast-2d-poisson-disk-sampling")),i=A(require("../util/Random")),l=require("../util/mst"),s=A(require("euclidean-distance/squared")),u=require("d3-delaunay"),d=A(require("simplex-noise")),m=A(require("simplify-path")),c=A(require("point-in-polygon")),v=A(require("../util/query-string")),f=P(require("../util/ShaderManager")),p=require("../util/RefGLTFLoader"),g=require("d3-quadtree"),h=A(require("bound-points")),w=A(require("earcut")),T=require("../util/load"),y=A(require("../config")),M=A(require("./environment/createEnvironmentEntity")),O=A(require("../shaders/ground-simple.vert")),S=A(require("../shaders/ground-simple.frag")),E=require("../util/three-util"),b=A(require("../util/Assets")),q=require("../util/materials"),C=P(require("../util/resetPlayerPos")),D=require("./AnimationSystem"),x=require("../nfb");function A(e){return e&&e.__esModule?e:{default:e}}function G(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(G=function(e){return e?a:t})(e)}function P(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=G(t);if(a&&a.has(e))return a.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=o?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(r,n,i):r[n]=e[n]}return r.default=e,a&&a.set(e,r),r}const j="image/data/water-distort",k="image/data/water-noise",R="image/opaque/ice",B="image/opaque/floor-overlay",W="image/opaque/floor-path",L="image/opaque/floor",F="image/opaque/floor-tundra";function U(e){const r=e.findTag(t.Renderer),o=new a.Texture,n=new a.Texture,i={wrapS:a.RepeatWrapping,wrapT:a.RepeatWrapping},[l,s,u]=[L,B,W].map(e=>{const[t]=b.default.createGPUTextureTask(r,e,{wrapS:a.RepeatWrapping,wrapT:a.RepeatWrapping});return t});let d=!1;const m=e.listen([t.EndGameState,t.ResetToCameraDrift]),c=new a.PlaneBufferGeometry(1,1,1,1);c.rotateX(-Math.PI/2);const p=512,g=512,h=[[-p/2,-g/2],[p/2,g/2]],w=new a.Matrix3,T=1024/60*1,A=1/(p/g)*(1024/60)*-1;w.setUvTransform(0,0,1,1,a.MathUtils.degToRad(-45),0,0);const G=(0,y.default)().haikusPerBiome,P={forest:{grassInstanceCount:700,grassScale:.6,grassTipFactor:1.5,colors:[{name:"forest-items-triangle",color:"#9D9166"},{name:"forest-items-dry",color:"#59622a"},{name:"forest-items-autumn",color:"#745C13"},{name:"forest-items-triangle",color:"#766D43"}],waterId:"forest-items-water",haikusTotal:G,waterColors:[],seed:[18632,45808,21972,11421],hasLakes:!1},grasslands:{grassInstanceCount:1e3,grassScale:1,grassTipFactor:1.5,hasLakes:!0,haikusTotal:G,seed:[23005,20871,29486,37533],colors:[{name:"grasslands-items-field",color:"#556325"},{name:"grasslands-items-yellow",color:"#8D7721"},{name:"grasslands-items-field",color:"#486b25"},{name:"grasslands-items-wet",color:"#605e41"}],waterId:"grasslands-items-water",waterColors:[{name:"lake",color:"#072d17"}]},tundra:{grassInstanceCount:500,grassScale:.6,grassTipFactor:.5,hasLakes:!0,hasIce:!0,haikusTotal:G,seed:[13005,27871,29486,37533],overlayOpacity:0,colors:[{name:"tundra-items-basic",color:"#797f84"}],waterId:"tundra-items-ice",waterColors:[{name:"lake",color:"#072d17"}]}},U=new a.Mesh(c,new a.MeshBasicMaterial({colorWrite:!1}));U.layers.set(e.findTag(t.RenderLayers).groundDepth),U.scale.set(p,1,g),U.position.y=0,U.name="env-depth-mesh",e.entity().add(t.Object3D,U);const V=function(){const r=e.findTag(t.GroundDataRenderTarget),o=f.create({depthWrite:!1,depthTest:!1,name:"GroundShader",uniforms:{solved:{value:0},uvRepeatScale:{value:1},clearColor:{value:new a.Color("#130904")},uvScale:{value:new a.Vector2(T,A)},uvTransform:{value:w},environmentSize:{value:new a.Vector2(p,g)},worldDataMap:{value:r?r.target.texture:(0,q.getEmptyTexture)()},worldDataProjection:{value:r?r.projection:new a.Matrix4},worldDataView:{value:r?r.view:new a.Matrix4},dataMapBiome:{value:(0,q.getEmptyTexture)()},dataMapColor:{value:(0,q.getEmptyTexture)()},dataMapLake:{value:(0,q.getEmptyTexture)()},overrideColor:{value:new a.Color("red")},originColor:{value:new a.Color("#969492")},useOverrideColor:{value:!0,type:"b"},useOverrideMap:{value:!0,type:"b"},overrideMap:{value:(0,q.getEmptyTexture)()},time:{value:0},tutorial:{value:0},outro:{value:0},mapOverlay:{value:s},mapGroundPath:{value:u},mapGround:{value:l},overlayOpacity:{value:.3}},defines:{HAS_DATA_MAP:!0},fragmentShader:S.default,vertexShader:O.default}),n=new a.Mesh(c,o);return n.scale.set(p,1,g),n.layers.set(e.findTag(t.RenderLayers).ground),n.name="ground-quad",e.entity().add(t.Object3D,n).add(t.ShaderUniformTime,{uniform:n.material.uniforms.time}).add(t.GroundMeshEditableData).add(t.GroundPlaneLayer,n)}(),I=(0,y.default)(),N=!1,_=e.listen(t.TutorialBarrenGround),X={value:0,lastValue:0,colorA:V.get(t.Object3D).material.uniforms.originColor.value.clone(),colorB:new a.Color("#59622a")},Y=e.listen(t.FinalBiomeResolution),z=e.view([t.GroundAsset,t.GroundAssetData]),H=e.view(t.EnvironmentCell),K=(e.view([t.GroundAsset,t.GroundAssetData]),e.view(t.GLTFRefAsset)),J=e.view(t.EnvironmentState),Q=e.view([t.EnvironmentState,t.ActiveEnvironmentState]),Z=["forest","grasslands","tundra"],$={};let ee=null,te="forest";"grasslands"===v.default.biome?te="grasslands":"tundra"===v.default.biome&&(te="tundra");let ae=null;setTimeout(()=>{let e;window.swapEnv=(()=>{(e=e||function(){const e=ae,a=se("grasslands");let r=e;return e.name="forest",a.name="grasslands",()=>{const o=r===e?a:e;r.remove(t.ActiveEnvironmentState),o.add(t.ActiveEnvironmentState),r=o}}())()})},0);const re=e.view(t.SafeToSwapBiomes),oe=(e.view(t.ShadowCaster),e.listen(t.TransitionToNextBiome)),ne=e.view([t.TransitionToNextBiome,t.CameraStopUserMovement]);le();let ie=null;return{process:function(a){oe.added.forEach(e=>{e.add(t.CameraStopUserMovement)}),m.added.length>0&&e.entity().add(t.TransitionToNextBiome).add(t.SafeToSwapBiomes);if(re.length>0){ne.forEach(e=>{e.remove(t.CameraStopUserMovement)}),re.forEach(e=>{e.remove(t.SafeToSwapBiomes)}),(0,C.default)(e),ie=null;const a=Q.length?Q[0]:null,r=a?a.get(t.EnvironmentState).name:"forest",o=Z.indexOf(r);if(o>=0){let a=o+1;if(a>=Z.length&&(a=1),a<Z.length){const r=Z[a];H.forEach(e=>e.kill()),z.forEach(e=>e.kill()),J.forEach(e=>e.kill());const o=se(r);o.add(t.ActiveEnvironmentState),e.query(t.TransitionToNextBiome).entities.forEach(e=>{e.remove(t.TransitionToNextBiome)}),$[r]||($[r]=!0,(0,x.sendAnalytics)({event:"biome_visited",eventLabel:r}))}else console.log("VIEW LAYER END STATE")}}const r=V.get(t.Object3D),o=V.get(t.GroundMeshEditableData);r.material.uniforms.uvRepeatScale.value=o.uvRepeatScale,r.material.uniforms.useOverrideColor.value=o.useOverrideColor,r.material.uniforms.useOverrideMap.value=o.useOverrideMap,r.material.uniforms.overrideMap.value=o.overrideMap,ie!==o.overrideColor&&(r.material.uniforms.overrideColor.value.set(o.overrideColor),ie=o.overrideColor);let i=null;if(Q.length>0){const e=Q[0],a=e.get(t.EnvironmentState);i=e,r.material.uniforms.solved.value=N||I.embed?1:a.solved,r.material.uniforms.dataMapBiome.value=a.textures[0],r.material.uniforms.dataMapColor.value=a.textures[1],r.material.uniforms.dataMapLake.value=a.textures[2],r.material.uniforms.overlayOpacity.value=a.overlayOpacity;for(let t=0;t<a.waterMeshes.length;t++){const e=a.waterMeshes[t];e.material.uniforms.waterNoiseMap.value=o.useOverrideWater?o.overrideWater:n,e.material.uniforms.colorA.value.set(o.useOverrideWaterColor?o.overrideWaterColorA:e.userData.colorA),e.material.uniforms.colorB.value.set(o.useOverrideWaterColor?o.overrideWaterColorB:e.userData.colorB)}}if(i!==ee){if(ee&&ee.has(t.Object3D)){const e=ee.get(t.Object3D);(0,E.detachObject)(e),console.log("Killing previous environment"),ee.remove(t.Object3D)}if(ee=i,i){const a=i.get(t.EnvironmentState),r=a.group;i.add(t.Object3D,r),K.forEach(e=>{const r=e.get(t.GLTFRefAsset);r.biome!==a.name&&e.kill()}),a.patches.forEach(r=>{e.entity().add(t.GLTFRefAsset,{position:r.position,name:r.name,biome:a.name})})}}if(Y.changed){const a=V.get(t.Object3D).material.uniforms,r=a.tutorial;Y.added.length>0?(X.colorA.copy(a.originColor.value),(0,D.tweenFromTo)(e,X,"value",0,1,8,"sineOut"),(0,D.tweenFromTo)(e,r,"value",r.value,1,8,"sineOut")):Y.removing.length>0&&(X.value=0,r.value=0)}if(X.value!==X.lastValue){X.lastValue=X.value;const e=V.get(t.Object3D).material.uniforms;e.originColor.value.copy(X.colorA).lerp(X.colorB,X.value)}if(_.changed)if(_.added.length>0)V.has(t.Object3D)&&(V.get(t.Object3D).material.uniforms.tutorial.value=1);else if(_.removing.length>0&&V.has(t.Object3D)){const a=V.get(t.Object3D).material.uniforms.tutorial;(0,D.tweenFromTo)(e,a,"value",a.value,0,2,"sineOut")}},createInitialEnvironment:le};function le(){if(!ae)if((ae=se(te)).add(t.ActiveEnvironmentState),v.default.testwater){const r=ae.get(t.EnvironmentState).lakes;if(r&&r.length){const t=r[Math.floor(Math.random()*r.length)].polygon,o=t[Math.floor(Math.random()*t.length)];(0,C.setPlayerPos)(e,new a.Vector3(o[0],0,o[1]))}}else if(v.default.testfox){const r=ae.get(t.EnvironmentState).patches.find(e=>e.name.includes("patch-17"));r&&(0,C.setPlayerPos)(e,new a.Vector3(r.position[0],0,r.position[1]))}}function se(t){return"grasslands"!==t&&"tundra"!==t||d||(d=!0,b.default.loadGPUTexture(r,o,j,i)),"grasslands"===t?b.default.loadGPUTexture(r,n,k,i):"tundra"===t&&(console.log("CREATE ENV"),b.default.loadGPUTexture(r,n,R,i),b.default.loadGPUTexture(r,l,F,i)),(0,M.default)(e,{biome:t,biomeData:P,width:p,height:g,bounds:h,renderer:r,uvMat:w,waterVertexShader:O.default,repeatX:T,repeatY:A,mapGround:l,mapOverlay:s,mapGroundPath:u,waterDistortMap:o,waterNoiseMap:n})}}b.default.prepare([L,W,B]);
},{"../tags":"injP","three":"IV0r","../util/helpers":"N4w3","d3-polygon":"QnuL","fast-2d-poisson-disk-sampling":"luIz","../util/Random":"LMfK","../util/mst":"k9sZ","euclidean-distance/squared":"yACJ","d3-delaunay":"V5JR","simplex-noise":"KFJE","simplify-path":"AUVL","point-in-polygon":"vDBG","../util/query-string":"Bj6B","../util/ShaderManager":"igLh","../util/RefGLTFLoader":"zcH5","d3-quadtree":"oxc3","bound-points":"T2x6","earcut":"d3f1","../util/load":"OkDW","../config":"nZps","./environment/createEnvironmentEntity":"oBk9","../shaders/ground-simple.vert":"h25C","../shaders/ground-simple.frag":"Y2ru","../util/three-util":"bI4v","../util/Assets":"Wm90","../util/materials":"phuP","../util/resetPlayerPos":"quSS","./AnimationSystem":"cUmx","../nfb":"Xlf9","process":"YOvR"}],"fGhj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=s;var e=u(require("../tags")),t=u(require("three")),n=l(require("../util/Random")),r=l(require("../util/ObjectPool")),i=require("../util/three-util"),a=require("./environment/EnvironmentGrid"),o=require("../util/water-util");function l(e){return e&&e.__esModule?e:{default:e}}function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function s(i){const l=i.view([e.ActiveEnvironmentState,e.EnvironmentState]),c=new Uint16Array(4),u=new r.default({initialCapacity:12,create:()=>(0,n.default)(c)}),s=[0,0],d=new t.Box3,f=new t.Raycaster,m=new t.Plane(new t.Vector3(-0,-1,-0),-0),p=new t.Vector2,v=new t.Vector3,y=new t.Vector3,w=[[-1,1],[1,1],[1,-1],[-1,-1]],g=i.view(e.EnvironmentCell),h=i.tag(e.EnvironmentUnderPlayerState),x=new a.GridBounds;return function(n){const r=i.findTag(e.UserTarget).position,a=i.findTag(e.MainCamera);a.updateProjectionMatrix();d.makeEmpty();for(let e=0;e<w.length;e++){const t=w[e];if(p.fromArray(t),f.setFromCamera(p,a),!f.ray.intersectPlane(m,v))return;const n=y.copy(v).sub(r),i=n.length();0!==i&&n.divideScalar(i),i>80&&v.copy(r).addScaledVector(y,80),d.expandByPoint(v)}if(d.min.y=0,d.max.y=12,h.water=!1,h.lake=null,l.length>0){!function(n){const r=n.grid;r.box3ToBounds(d,x);x.minX=t.MathUtils.clamp(x.minX-0,0,r.cellDivisions-1),x.minY=t.MathUtils.clamp(x.minY-0,0,r.cellDivisions-1),x.maxX=t.MathUtils.clamp(x.maxX+0,0,r.cellDivisions-1),x.maxY=t.MathUtils.clamp(x.maxY+0+1,0,r.cellDivisions-1),g.forEach(t=>{const i=t.get(e.EnvironmentCell);i.environmentState===n&&r.isCellInBounds(i.cell,x)||(u.release(i.random),i.cell.entity=null,i.environmentState=null,i.cell=null,t.kill())});r.forEachCellInBounds(x,t=>{if(0,!t.entity){t.entity=i.entity().add(e.EnvironmentCell);const r=t.entity.get(e.EnvironmentCell);r.cell=t,r.environmentState=n,r.random=u.next(),r.random.seed(t.seed)}});const a=i.findTag(e.UserCharacter).position;s[0]=a.x,s[1]=a.z;const l=!i.findTag(e.HideCharacter)&&!i.findTag(e.AnimateOutCharacter);if(!h.water&&l){const e=(0,o.getLakeObject)(n,s);h.water=Boolean(e),h.lake=e}}(l[0].get(e.EnvironmentState))}}}
},{"../tags":"injP","three":"IV0r","../util/Random":"LMfK","../util/ObjectPool":"iiAR","../util/three-util":"bI4v","./environment/EnvironmentGrid":"qc3d","../util/water-util":"j8Gj"}],"dqga":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=S;var e=c(require("../../tags")),i=c(require("three")),a=l(require("../../util/ObjectPool")),t=l(require("../../util/SpriteManager")),r=require("../../util/three-util"),s=require("../../util/load"),n=c(require("../../util/math")),o=require("../AnimationSystem"),d=require("../../util/materials");function l(e){return e&&e.__esModule?e:{default:e}}function u(e){if("function"!=typeof WeakMap)return null;var i=new WeakMap,a=new WeakMap;return(u=function(e){return e?a:i})(e)}function c(e,i){if(!i&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=u(i);if(a&&a.has(e))return a.get(e);var t={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var n=r?Object.getOwnPropertyDescriptor(e,s):null;n&&(n.get||n.set)?Object.defineProperty(t,s,n):t[s]=e[s]}return t.default=e,a&&a.set(e,t),t}const p=20,h={height:15},f={tree_naked2:{...h,ignoreFlip:!0,shadow:!0,shadowScale:.7,shadowOffsetX:-.35,shadowOffsetY:.05,varianceStd:.5,useMapDiscard:!0},"forest-twig1":{minSize:.5,maxSize:.75},"forest-twig2":{minSize:.5,maxSize:.75},"forest-twig3":{minSize:.5,maxSize:.75},tree1:{...h,ignoreFlip:!0,minSize:8,useMapDiscard:!0},tree2:{...h,ignoreFlip:!0,useMapDiscard:!0},"origin-tree":{ignoreFlip:!0,height:10,useMapDiscard:!0},tree3:{...h,ignoreFlip:!0,useMapDiscard:!0},tree5:{...h,ignoreFlip:!0,varianceStd:.25,useMapDiscard:!0},acorns1:{height:.5},fallen_wood1:{height:.5},fallen_wood2:{height:.5},tree_naked1:{...h,ignoreFlip:!0,shadow:!0,shadowScale:.7,shadowOffsetX:-.3,shadowOffsetY:-.6,varianceStd:.5},tree_naked3:{...h,ignoreFlip:!0,height:7,shadow:!0,shadowScale:.5,shadowOffsetX:-.2,varianceStd:.5,useMapDiscard:!0},smalltree1:{useMapDiscard:!1,minSize:3},tree_naked2:{...h,ignoreFlip:!0,shadow:!0,shadowScale:.6,shadowOffsetX:-.35,shadowOffsetY:.1,varianceStd:.5,useMapDiscard:!0},decayed_stump1:{ignoreFlip:!0,height:1.5,minSize:1.5,maxSize:2.25,varianceStd:.25,shadow:!0,shadowScale:1,shadowOffsetX:-.25,shadowOffsetY:-.5,useMapDiscard:!0},decayed_twig1:{minSize:1,height:1.25,maxSize:1.5,useMapDiscard:!1},decayed_twig2:{minSize:1,height:1.25,maxSize:1.5,useMapDiscard:!1},decayed_twig3:{minSize:1,height:1.25,maxSize:1.5,useMapDiscard:!1},decayed_twig4:{minSize:1,height:1.25,maxSize:1.5,useMapDiscard:!1},"oat-shadow1":{minSize:1,height:1.5,maxSize:2,useMapDiscard:!1,ignoreFlip:!0},"small-rock1":{minSize:.35,height:.5,maxSize:.65,useMapDiscard:!1,ignoreFlip:!0},"small-rock2":{minSize:.35,height:.5,maxSize:.65,useMapDiscard:!1,ignoreFlip:!0},"wetland-plant1":{minSize:1,height:1.25,maxSize:1.5,useMapDiscard:!1},"wetland-plant2":{minSize:1,height:1.25,maxSize:1.5,useMapDiscard:!1},"wetland-grass1":{minSize:1,height:1.25,maxSize:1.5,useMapDiscard:!1}},m={...h,ignoreFlip:!0,minSize:8,useMapDiscard:!0},g={minSize:1.5,height:1.5,maxSize:2.25,useMapDiscard:!1};async function S(a){a.findTag(e.Renderer),a.findTag(e.GroundDataRenderTarget),a.findTag(e.GroundPlaneView),(0,d.getEmptyTexture)(),(0,d.getSpriteGeometry)();return{next:function(a){if(!a.has(e.GroundAssetData))return;const t=a.get(e.GroundAsset),r=t.cellEntity.get(e.EnvironmentCell),s=a.get(e.GroundAssetData),o=(r.random,s.instance);if(!o)return;o.position.set(t.x,0,t.z);const d=o.isMesh&&"WayfinderSprite"===o.userData.type;let l=n.clamp(Math.abs(s.variance),.95,1.05);if(o.scale.multiplyScalar(l),s.scale.copy(o.scale),d){const a=s.flip&&!s.ignoreFlip;o.material.uniforms.flip.value=a?-1:1,o.material.side=a?i.BackSide:i.FrontSide;let t=!1;"boolean"==typeof s.useMapDiscard&&(t=s.useMapDiscard),o.material.uniforms.useMapDiscard.value=t;const r=o.scale.x/o.scale.y;o.material.uniforms.aspect.value=r,o.material.uniforms.spriteHeight.value=o.scale.y;const n=o.userData._entity;if(n){n.has(e.ShaderUniformTime)||n.add(e.ShaderUniformTime);const i=n.get(e.ShaderUniformTime);i.uniform=o.material.uniforms.time}}else o.rotation.y=s.rotation},release(i){const a=i.get(e.GroundAssetData);a.instance&&a.instance.userData._pool&&a.instance.userData._pool.release(a.instance),(0,r.detachObject)(a.instance),a.instance=null},update(i){i.has(e.Object3D)}}}
},{"../../tags":"injP","three":"IV0r","../../util/ObjectPool":"iiAR","../../util/SpriteManager":"Ffhm","../../util/three-util":"bI4v","../../util/load":"OkDW","../../util/math":"Ov1X","../AnimationSystem":"cUmx","../../util/materials":"phuP"}],"ChEb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=m;var e=d(require("../tags")),t=d(require("three")),n=l(require("./environment/AssetSprites")),r=require("./environment/asset-types"),s=require("../util/three-util"),o=require("./AnimationSystem"),a=d(require("../util/math")),i=l(require("../util/Random"));function l(e){return e&&e.__esModule?e:{default:e}}function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}const u=new t.Box3,p=new t.Vector3;function g(e,t){t.getWorldScale(p);const n=p.y;e.max.y+=.4*n,e.min.x-=2,e.max.x+=0}async function m(l){const c=await(0,n.default)(l);const d=new t.Group;d.name="assets",l.entity().add(e.Object3D,d);l.view(e.EnvironmentCell);const u=l.listen(e.EnvironmentCell),p=l.findTag(e.MainCameraFrustum),m=l.listen([e.GroundAsset,e.GroundAssetData]),f=l.view([e.GroundAsset,e.GroundAssetData]),h=l.view([e.GroundAsset,e.GroundAssetData,e.Object3D]),y=(Boolean(void 0),new t.Vector2),v=new t.Box3,G=l.findTag(e.GLTFSpawnItemsMap),A=(0,i.default)(),D=l.listen(e.TutorialBarrenGround),w=l.listen(e.FinalBiomeResolution),O=l.view(e.TutorialBarrenGround),F=l.listen(e.ActiveEnvironmentState);let b=0;return function(t){F.changed,b+=t;for(let n=0;n<u.added.length;n++){const t=u.added[n],s=t.get(e.EnvironmentCell),o=s.cell,a=s.random,i=s.environmentState.colors[o.colorIndex%s.environmentState.colors.length],c=i?i.name:null;s.children.length=0;for(let n=0;n<o.samples.length;n++){const i=o.samples[n],u=l.entity().add(e.GroundAsset),p=u.get(e.GroundAsset),g=s.environmentState.samples[i];p.x=g[0],p.z=g[1],p.cellEntity=t;const m=(0,r.addSampleData)(d,G,u,c,a);m&&u.add(e.Object3D,m),s.children.push(u)}for(let n=0;n<o.waterSamples.length;n++){const i=o.waterSamples[n],c=l.entity().add(e.GroundAsset),u=c.get(e.GroundAsset),p=s.environmentState.waterSamples[i];if(u.x=p[0],u.z=p[1],u.cellEntity=t,a.chance(.5)){const t=(0,r.addSampleData)(d,G,c,s.environmentState.waterId,a);t&&c.add(e.Object3D,t)}else c.add(e.WaterFishPlaceholderTag);s.children.push(c)}for(let n=0;n<o.tokens.length;n++){const r=o.tokens[n],a=l.entity().add(e.GroundAsset).add(e.GroundAssetData).add(e.GroundAssetToken);a.get(e.GroundAssetData).type="token";const i=s.environmentState.tokens[r];a.get(e.GroundAssetToken).type=i.type;const c=a.get(e.GroundAsset);c.x=i.position[0],c.z=i.position[1],c.cellEntity=t,s.children.push(a)}}for(let n=0;n<m.added.length;n++){const t=m.added[n],r=t.get(e.GroundAsset),s=t.get(e.GroundAssetData);r.cellEntity.get(e.EnvironmentCell);O.length>0&&(s.sizeFactor=0),"sprite"===s.type&&c.next(t)}for(let n=0;n<h.length;n++){const t=h[n],r=(t.get(e.GroundAsset),t.get(e.GroundAssetData));if("patch"!==r.type){const n=t.get(e.Object3D);v.setFromObject(n),"sprite"===r.type&&g(v,n);const s=p.intersectsBox(v),o=t.has(e.GroundAssetInsideFrustum);o!==s&&(s&&!o?t.add(e.GroundAssetInsideFrustum):!s&&o&&t.remove(e.GroundAssetInsideFrustum))}}w.changed&&(w.added.length>0?f.forEach(t=>{const n=t.get(e.GroundAssetData);if("token"!==n.type&&"patch"!==n.type&&n.sizeFactor>0){const r=t.get(e.GroundAsset),s=1*a.clamp01(y.set(r.x,r.z).length()/50)+A.range(0,.5);(0,o.tweenFromTo)(l,n,"sizeFactor",n.sizeFactor,0,1,"sineOut",s)}}):w.removing.length>0&&f.forEach(t=>{const n=t.get(e.GroundAssetData);"token"!==n.type&&"patch"!==n.type&&n.sizeFactor>0&&(n.sizeFactor=1)})),D.changed&&(D.added.length>0?f.forEach(t=>{t.get(e.GroundAssetData).sizeFactor=0}):D.removing.length>0&&f.forEach(t=>{const n=t.get(e.GroundAssetData);if("token"!==n.type&&"patch"!==n.type&&n.sizeFactor<=0){const r=t.get(e.GroundAsset),s=1*a.clamp01(y.set(r.x,r.z).length()/50)+A.range(0,.5);(0,o.tweenFromTo)(l,n,"sizeFactor",0,1,1,"sineOut",s)}}));for(let n=0;n<f.length;n++){const t=f[n],r=t.get(e.GroundAssetData);if("sprite"===r.type&&c.update(t),"token"!==r.type&&"patch"!==r.type){const e=r.sizeFactor,t=r.instance;t&&t.material&&t.material.uniforms.spin&&(t.material.uniforms.spin.value=1-e),t.scale.copy(r.scale).multiplyScalar(e)}if("patch"!==r.type&&t.has(e.Object3D)){t.get(e.Object3D).visible=t.has(e.GroundAssetInsideFrustum)}}for(let n=0;n<m.removing.length;n++){const t=m.removing[n];"sprite"===t.get(e.GroundAssetData).type&&c.release(t)}for(let n=0;n<u.removing.length;n++){const t=u.removing[n].get(e.EnvironmentCell);t.children.forEach(t=>{if(t.alive){if(t.has(e.Object3D)){const n=t.get(e.Object3D);(0,s.detachObject)(n)}t.kill()}}),t.children.length=0}}}function f(e,t){}
},{"../tags":"injP","three":"IV0r","./environment/AssetSprites":"dqga","./environment/asset-types":"kGvY","../util/three-util":"bI4v","./AnimationSystem":"cUmx","../util/math":"Ov1X","../util/Random":"LMfK"}],"ETzy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=l;var e=i(require("../tags")),r=i(require("three")),a=require("../util/materials"),t=require("../util/three-util"),n=i(require("../util/ShaderManager"));function o(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,a=new WeakMap;return(o=function(e){return e?a:r})(e)}function i(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=o(r);if(a&&a.has(e))return a.get(e);var t={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var l=n?Object.getOwnPropertyDescriptor(e,i):null;l&&(l.get||l.set)?Object.defineProperty(t,i,l):t[i]=e[i]}return t.default=e,a&&a.set(e,t),t}function l(a){a.view([e.Object3D,e.ShadowCaster]);const o=a.listen([e.Object3D,e.ShadowCaster]),i=a.findTag(e.RenderLayers),l=(new r.Vector3(0,0,0),new r.Vector3(0,0,0),new r.PerspectiveCamera),c=new r.Matrix4,s=new r.Matrix4,d=n.create({name:"ShadowSilhouetteMesh",vertexShader:"\n      #include <common>\n      uniform mat4 projection;\n      uniform mat4 view;\n      varying vec3 vCenterPos;\n      varying vec3 vRealWorldPos;\n\n      void main () {\n        vec4 realWorldPos = modelMatrix * vec4(position.xyz, 1.0);\n        vRealWorldPos = realWorldPos.xyz;\n        vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n        vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n        vec3 camBack = cross(camUpWorld, camRightWorld);\n        float xSkew = -60.0 * (PI/180.0);\n        float ySkew = 0.0;\n\n        // Create a transform that will skew our texture coords\n        mat3 trans = mat3(\n          1.0       , tan(xSkew), 0.0,\n          tan(ySkew), 1.0,        0.0,\n          0.0       , 0.0,        1.0\n        );\n        \n        vec4 worldSpace = modelMatrix * vec4(position.xyz, 1.0);\n        worldSpace.y *= 0.25;\n        // worldSpace.xyz *= trans;\n        worldSpace.xyz += realWorldPos.y * camRightWorld * -0.5;\n\n        worldSpace.z += -0.25;\n        worldSpace.x += -0.1;\n        vec4 camSpace = view * worldSpace;\n\n        vCenterPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n\n        gl_Position = projectionMatrix * viewMatrix * worldSpace;\n        // gl_Position.y += 0.4;\n        // gl_Position.x -= 0.4;\n      }\n    ",fragmentShader:"\n      uniform float opacity;\n      uniform vec3 color;\n      varying vec3 vCenterPos;\n      varying vec3 vRealWorldPos;\n      void main () {\n        gl_FragColor = vec4(color, 1.0);\n\n        // float falloff = 1.0 - clamp(pow(distance(vRealWorldPos, vCenterPos) / 1.0, 0.5), 0.0, 1.0);\n        float falloff = 1.0 - clamp(pow(vRealWorldPos.y / 2.0, 1.0), 0.0, 1.0);\n        float shadowOpacity = 0.25;\n        gl_FragColor.rgb = mix(vec3(1.0), gl_FragColor.rgb, shadowOpacity * falloff);\n      }\n    ",transparent:!0,depthWrite:!1,side:r.DoubleSide,blending:r.MultiplyBlending,uniforms:{color:{value:new r.Color("#280422")},projection:{value:c},view:{value:s}}});(new r.Vector3).set(1,1,.25).normalize();return function(r){o.added.forEach(r=>{const a=r.get(e.ShadowCaster).sprite;r.get(e.Object3D).traverse(e=>{e.layers&&e.layers.enable(i.shadow),e.isMesh&&(e.userData.__shadowEnabled=!0,e.userData.__shadowMaterial=a?e.material:d)})});const n=a.findTag(e.MainCamera);(0,t.fastCopyCameraData)(n,l);a.findTag(e.UserFollow).currentTarget;l.updateProjectionMatrix(),l.updateMatrixWorld(),c.copy(l.projectionMatrix),s.copy(l.matrixWorldInverse)}}
},{"../tags":"injP","three":"IV0r","../util/materials":"phuP","../util/three-util":"bI4v","../util/ShaderManager":"igLh"}],"g3gH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=d;var e=f(require("../tags")),t=f(require("three")),r=f(require("../util/helpers")),o=l(require("deep-clone")),n=require("../util/three-util"),u=require("../util/EditorWayfinderSprite"),a=f(require("../util/RefGLTFLoader")),i=l(require("../util/Random")),s=require("../util/geometry"),c=l(require("../util/ObjectPool"));function l(e){return e&&e.__esModule?e:{default:e}}function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var a=n?Object.getOwnPropertyDescriptor(e,u):null;a&&(a.get||a.set)?Object.defineProperty(o,u,a):o[u]=e[u]}return o.default=e,r&&r.set(e,o),o}async function d(r){const o=new t.Group;o.name="loadrefgroup",r.entity().add(e.Object3D,o);const u=await(0,a.default)(r),i=r.listen(e.GLTFRefAsset),l=r.listen(e.ActiveEnvironmentState),p=r.view(e.GLTFRefAsset),f=(r.findTag(e.MainCameraFrustum),new t.Box3,new t.Vector3,[0,0]),d=new t.Box3,g=new c.default({initialCapacity:50,create(){const e=new t.Group;return e.userData._pool=this,e},release(e){(0,n.clearGroup)(e)}});return function(t){if(!r.findTag(e.AppState).ready)return;const o=r.findTag(e.UserTarget).position;f[0]=o.x,f[1]=o.z,l.changed&&p.forEach(t=>{const r=t.get(e.GLTFRefAsset);b(t,r),p.forEach(e=>e.kill())}),i.removing.forEach(t=>{const r=t.get(e.GLTFRefAsset);if(t.has(e.Object3D)){const r=t.get(e.Object3D);(0,n.detachObject)(r),t.remove(e.Object3D)}r.group&&(r.group.parent&&console.warn("GLTF Ref still has parent"),m(r.group),r.group=null)}),p.forEach(t=>{const r=t.get(e.GLTFRefAsset),o=r.position,i=r.name,c=a.MetaData[i],l=o[0],p=o[1],O=c.boundingCircle.radius;let h=!1;if((0,s.circlesIntersect)(o,O,f,50)&&(h=!0),h!==t.has(e.IsInFrustum)&&(h?t.add(e.IsInFrustum):t.has(e.IsInFrustum)&&(t.remove(e.IsInFrustum),b(t,r)),t.has(e.IsInFrustum)&&(t.has(e.Object3D)||function(t,r,o,a,i){r.group&&(console.error("Group already exists"),m(r.group),(0,n.detachObject)(r.group));const s=g.next();r.group=s,s.name=o,r.promise=u.nextPooledByName(o,!0).then(e=>{if(!r.group)return console.log("Early release",e),m(e),null;const t=r.group;return t.position.x=a,t.position.z=i,t.add(e),d.setFromObject(t),r.boundsMin.copy(d.min),r.boundsMax.copy(d.max),r.boundsSet=!0,e});const c=r.group;t.add(e.Object3D,c)}(t,r,i,l,p)),t.has(e.Object3D))){t.get(e.Object3D).visible=h}})};function b(t,r){if(r.group&&m(r.group),t.has(e.Object3D)){const r=t.get(e.Object3D);(0,n.detachObject)(r),t.remove(e.Object3D)}r.promise&&r.promise.then(m),r.group=null,r.promise=null}function m(e){e&&e.userData._pool&&e.userData._pool.release(e)}}
},{"../tags":"injP","three":"IV0r","../util/helpers":"N4w3","deep-clone":"bjTg","../util/three-util":"bI4v","../util/EditorWayfinderSprite":"iSWR","../util/RefGLTFLoader":"zcH5","../util/Random":"LMfK","../util/geometry":"nZ95","../util/ObjectPool":"iiAR"}],"ARSc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=o;var e=n(require("../tags")),t=require("svelte/store");function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function n(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var o={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var a=u?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(o,i,a):o[i]=e[i]}return o.default=e,n&&n.set(e,o),o}function o(t){t.entity().add(e.ViewLayer,{id:"poem-collection"})}
},{"../tags":"injP","svelte/store":"nBdo"}],"oL33":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=g;var e=u(require("../tags")),t=u(require("three")),n=require("../util/locale"),o=c(require("../util/haikugen")),i=require("./AnimationSystem"),a=c(require("../util/query-string")),r=require("../util/tokens"),d=c(require("../util/Random")),s=u(require("../util/resetPlayerPos")),l=require("../nfb");function c(e){return e&&e.__esModule?e:{default:e}}function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var r=i?Object.getOwnPropertyDescriptor(e,a):null;r&&(r.get||r.set)?Object.defineProperty(o,a,r):o[a]=e[a]}return o.default=e,n&&n.set(e,o),o}function g(t){const c=(0,d.default)();window.addPoem=((n,i)=>{const a=(0,o.default)();n||(n=c.shuffle(r.AllTokens).slice(0,3)),i=i||n.map((e,t)=>a.generateStanza({stanza:t,token:e})),console.log(i,n);t.entity().add(e.FinishedPoem,{lines:i.slice(),tokens:n.slice()});console.log(n),console.log(i.map(e=>e.en).join(" / "))}),window.addTestPoem=(()=>{window.addPoem(c.shuffle(r.AllTokens).slice(0,3))});const f=t.listen(e.FinishedPoem),u=(t.listen(e.HaikuInInventory),t.view(e.HaikuAddingToInventory)),g=t.view(e.HaikuInInventory),m=t.entity(),v=t.listen(e.HaikuCardSaved);let O;const p=t.view(e.ActiveEnvironmentState),T=t.listen(e.ActiveEnvironmentState),h=t.view([e.SpriteAnimation,e.SpriteAnimationOriginTreeTag]);let y=!1,M=!1,k=0,w=0,A=!1;t.view(e.EndGameState);let E=!1;const C=t.view(e.TextHint);setTimeout(()=>{const e=a.default.poems;if("number"==typeof e)for(let t=0;t<e;t++)window.addTestPoem()},0);const S=t.listen(e.ResetToCameraDrift),F=t.view(e.AutoRemoveCapeMagicalEffect);return function(o){const r=p[0],d=r?r.get(e.EnvironmentState):null,c=d?d.name:null;if(S.changed&&S.added.length>0){m.remove(e.FinalBiomeResolution);const n=t.findEntity(e.ActiveEnvironmentState);if(n){const o=n.get(e.EnvironmentState);(0,s.setPlayerPos)(t,o.idleViewPoint)}m.tagOff(e.DirectUserToOrigin),m.tagOff(e.CapeMagicalEffect),m.tagOff(e.AutoRemoveCapeMagicalEffect),m.tagOff(e.WaitingForBiomeResolution),m.tagOff(e.ShowBiomeResolution),m.tagOff(e.CameraFocusOnTarget),m.tagOff(e.MoveUserToOrigin);const o=t.entity();o.tagOn(e.GameLandingCameraDrift),o.tagOn(e.CameraZoomOut),o.tagOn(e.BlockTokenCollection),o.tagOn(e.HideCharacter),o.tagOn(e.HideHUD),o.tagOn(e.BlockUserMove),o.tagOn(e.CameraStopUserMovement),o.tagOn(e.ModalStoppingUserMovement);const i=t.entity().add(e.ScreenFade).get(e.ScreenFade);i.from=1,i.to=0}T.changed&&(m.remove(e.DirectUserToOrigin),m.tagOff(e.CapeMagicalEffect),m.tagOff(e.AutoRemoveCapeMagicalEffect),m.remove(e.WaitingForBiomeResolution),m.remove(e.ShowBiomeResolution),m.remove(e.CameraFocusOnTarget),m.remove(e.MoveUserToOrigin),m.remove(e.TriggerTreeTransitionAudio),g.forEach(t=>{t.remove(e.HaikuInInventory)}),h.forEach(t=>{t.get(e.SpriteAnimation).reset()}),O=c,C.forEach(e=>e.kill()));const R=d?d.haikusTotal:2,I=g.length;if(f.changed){const t=Math.max(0,R-I);for(let n=0;n<t&&n<f.added.length;n++)f.added[n].add(e.HaikuAddingToInventory)}u.forEach(t=>{const n=t.get(e.HaikuAddingToInventory);n.time+=o,n.time>=n.delay&&(t.remove(e.HaikuAddingToInventory),t.add(e.HaikuInInventory))}),g.length>=R&&(m.has(e.DirectUserToOrigin)||(m.add(e.DirectUserToOrigin),F.forEach(t=>{t.get(e.AutoRemoveCapeMagicalEffect).elapsed=0,t.remove(e.AutoRemoveCapeMagicalEffect)}),m.add(e.CapeMagicalEffect),m.add(e.WaitingForBiomeResolution)));const P=!t.findTag(e.IsGameUIActive);if(Boolean(t.findTag(e.DirectUserToOrigin))&&P&&v.added.length&&v.changed&&!E&&(a.default.resolve||(E=!0,t.entity().add(e.TutorialMessage,{id:"resolve",message:n.localize.get().tutorialResolve,iconMode:"tree",delay:0,duration:6}))),d&&m.has(e.DirectUserToOrigin)&&P&&m.has(e.WaitingForBiomeResolution)){const n=20,o=n*n;if(t.findTag(e.UserCharacter).position.lengthSq()<o){(0,i.tweenFromTo)(t,d,"solved",0,1,4,"sineInOut",0),m.remove(e.WaitingForBiomeResolution),m.add(e.CameraFocusOnTarget),m.add(e.MoveUserToOrigin),m.add(e.ShowBiomeResolution),m.tagOff(e.CapeMagicalEffect),m.tagOff(e.AutoRemoveCapeMagicalEffect),"tundra"===c&&(A=!0,m.add(e.FinalBiomeResolution)),m.get(e.CameraFocusOnTarget).target.set(0,4,0),M=!0,y=!0,k=0,w=0}}if(y){(k+=o)>=("tundra"===c?17:4)&&(y=!1,h.forEach(t=>{t.get(e.SpriteAnimation).start()}),m.add(e.TriggerTreeTransitionAudio))}if(M){if(w+=o,A&&w>=3&&(A=!1,m.add(e.AnimateOutCharacter)),w>=("tundra"===c?23:10))if(M=!1,g.forEach(t=>{t.remove(e.HaikuInInventory)}),"tundra"===c){const n=t.entity();n.add(e.EndGameState);const o=t.entity().add(e.ScreenFade).get(e.ScreenFade);o.from=0,o.to=1,o.callbackOnFinish=(()=>{n.add(e.ResetToCameraDrift),n.add(e.OutroFinished)}),(0,l.sendAnalytics)({event:"completed",eventLabel:"end"})}else m.add(e.TransitionToNextBiome)}}}
},{"../tags":"injP","three":"IV0r","../util/locale":"dkeN","../util/haikugen":"iilj","./AnimationSystem":"cUmx","../util/query-string":"Bj6B","../util/tokens":"kL9I","../util/Random":"LMfK","../util/resetPlayerPos":"quSS","../nfb":"Xlf9"}],"uomW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=l;var e=c(require("../tags")),t=c(require("three")),r=require("../util/materials"),a=require("../util/EditorWayfinderSprite"),i=require("../util/load"),n=require("./AnimationSystem"),u=s(require("../util/Random")),o=s(require("../util/Assets"));function s(e){return e&&e.__esModule?e:{default:e}}function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}function c(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var u=i?Object.getOwnPropertyDescriptor(e,n):null;u&&(u.get||u.set)?Object.defineProperty(a,n,u):a[n]=e[n]}return a.default=e,r&&r.set(e,a),a}function l(t){const r=(0,u.default)(),i=["GRASSLAND-FLOWER-1","GRASSLAND-FLOWER-2","GRASSLAND-FLOWER-white-1","GRASSLAND-FLOWER-white-2"].map(e=>`image/stanza-spawn/${e}`),s=t.findTag(e.Renderer),f=i.map(e=>{const[t]=o.default.createGPUTextureTask(s,e);return t}),c=t.view(e.StanzaLineSpawningAsset),l=t.listen(e.StanzaLineSpawningAsset);return function(i){l.added.forEach(i=>{const u=i.get(e.StanzaLineSpawningAsset),o=r.gaussian(1,.25),s=r.pick(f);if(s&&s.image&&s.image.width>0&&s.image.height>0){const f=(0,a.createSprite)(t,s,o);f.position.set(u.x,0,u.z),f.scale.y=0,i.add(e.Object3D,f).add(e.ShaderUniformTime,{uniform:f.material.uniforms.time}).add(e.ShadowCaster,{sprite:!0}),(0,n.tweenFromTo)(t,f.scale,"y",0,o,1,"sineOut",r.range(0,1))}}),c.forEach(t=>{if(t.has(e.Object3D)){const r=t.get(e.Object3D),a=r.material.uniforms.map.value,i=a.image.width/a.image.height,n=r.scale.y*i;r.scale.x=n}})}}
},{"../tags":"injP","three":"IV0r","../util/materials":"phuP","../util/EditorWayfinderSprite":"iSWR","../util/load":"OkDW","./AnimationSystem":"cUmx","../util/Random":"LMfK","../util/Assets":"Wm90"}],"SJEY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=s;var e=l(require("../util/math")),t=l(require("../tags")),r=l(require("three")),a=n(require("../util/ObjectPool")),i=n(require("../util/Random"));function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var l=i?Object.getOwnPropertyDescriptor(e,n):null;l&&(l.get||l.set)?Object.defineProperty(a,n,l):a[n]=e[n]}return a.default=e,r&&r.set(e,a),a}function s(n){const o=n.findTag(t.EnvironmentUnderPlayerState),l=n.entity(),s=(0,i.default)(),u=new r.SphereBufferGeometry(1,8,8),c=new r.SphereBufferGeometry(1,8,8);c.scale(1,.75,1);const d=new r.Color("#3ea7e0"),f=new r.MeshBasicMaterial({}),g=new r.Mesh(u,f),p=new a.default({maxCapacity:100,initialCapacity:50,create(){const e=g.clone();e.geometry=s.boolean()?u:c,e.material=f.clone(),e.userData.velocity=new r.Vector3,e.material.color.copy(d),e.material.color.offsetHSL(0*s.range(-1,1),0*s.range(-1,1),.1*s.range(-1,1)),e.material.color.multiplyScalar(s.range(.2,1));return e.material.color.r+=1,e.material.color.g+=1,e.material.color.b+=1,e.userData.time=0,e.userData.scale=1,e.userData.duration=1,e.userData.delay=1,e.userData.speed=1,e.visible=!1,e},renew(e){e.visible=!0},release(e){}}),y=()=>s.range(.1,.2);let m=y(),v=s.range(0,m);const D=[0,0],w=[0,0,0,0],h=n.view(t.WaterFollowParticle),b=()=>s.range(1,2);let P=b(),M=0;const O=n.view([t.EnvironmentState,t.ActiveEnvironmentState]),S=n.entity(),j=n.view(t.ParticleEmit);let E=null;return function(a){o.water&&!l.has(t.UserCarryingTokenCollectionFeature)&&l.add(t.UserCarryingTokenCollectionFeature);const i=n.findTag(t.UserCharacter),u=i.velocity,c=i.position,d=!E||c.distanceToSquared(E)>=4;S.has(t.UserHitAudioTrigger)&&(M+=a)>=P&&(M%=P,P=b(),S.remove(t.UserHitAudioTrigger));const f=o.water,g=j.length>0;if(f){if((v+=a)>=m){v%=m,m=y();const e=s.rangeFloor(1,5);for(let t=0;t<e&&T(c,u);t++);}if(d&&f&&!S.has(t.UserHitAudioTrigger)){E||(E=new r.Vector3),E.copy(c),S.add(t.UserHitAudioTrigger);const e=S.get(t.UserHitAudioTrigger),a=!!O.length&&"tundra"===O[0].get(t.EnvironmentState).name;e.type=a?"ice":"water"}}else if(g&&(v+=a)>=m){v%=m,m=y();e:for(let e=0;e<j.length;e++){j[e].get(t.ParticleEmit).position;const r=s.rangeFloor(1,5);for(let e=0;e<r;e++)if(!T(c,u,!0))break e}}j.forEach(e=>{const r=e.get(t.ParticleEmit);r.elapsed+=a,r.elapsed>=r.duration&&e.tagOff(t.ParticleEmit)}),h.forEach(r=>{const i=r.get(t.Object3D);i.userData.time+=a;const n=i.userData.time-i.userData.delay;!i.visible&&n>=0&&(i.visible=!0);const o=Math.max(0,n),l=e.clamp01(o/i.userData.duration),s=Math.max(1e-5,Math.sin(l*Math.PI));i.scale.setScalar(i.userData.scale*s),i.position.addScaledVector(i.userData.velocity,i.userData.speed),i.position.y+=a,o>=i.userData.duration&&(i.visible=!1,r.kill(),i.userData._entity=null,p.release(i))})};function T(e,r,a){const i=p.next();return!!i&&(i.userData._entity=n.entity().add(t.WaterFollowParticle).add(t.Object3D,i),i.userData.velocity.copy(r),i.quaternion.fromArray(s.quaternion(w)),i.position.copy(e),s.insideCircle(s.range(1,2),D),i.position.x+=D[0],i.position.z+=D[1],i.position.y=s.range(.01,.25),i.visible=!1,i.userData.scale=(a?.6:.4)*s.gaussian(.1,.1/3),i.userData.time=0,i.userData.delay=s.range(0,.5),i.userData.speed=s.range(.05,.5),i.userData.duration=s.range(1,1.5),i)}}
},{"../util/math":"Ov1X","../tags":"injP","three":"IV0r","../util/ObjectPool":"iiAR","../util/Random":"LMfK"}],"E7By":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=c;var e=i(require("../tags")),t=i(require("three")),r=n(require("../util/Random"));function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var u=i?Object.getOwnPropertyDescriptor(e,a):null;u&&(u.get||u.set)?Object.defineProperty(n,a,u):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class u extends e.Data{}function c(n){let o=0;const i=new t.MeshBasicMaterial,a=new t.BoxGeometry(1,1,1),c=(0,r.default)(),s=n.view([e.Object3D,u]),f=n.listen(u);return r=>{(o+=r)>=1&&(o%=1,function(){const r=n.findTag(e.UserCharacter).position,o=new t.Mesh(a,i);o.position.copy(r),o.quaternion.fromArray(c.quaternion());const s=n.entity();s.add(e.Object3D,o);const f=c.range(1,2);s.add(u,{speed:f})}()),f.added.forEach(e=>{console.log("Box initialized")}),s.forEach(t=>{const n=t.get(e.Object3D),o=t.get(u);n.position.y+=o.speed*r,n.position.y>5&&t.kill()}),f.removing.forEach(e=>{console.log("Removing box")})}}a(u,"data",{speed:e.Types.Ref(1)});
},{"../tags":"injP","three":"IV0r","../util/Random":"LMfK"}],"cYdV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("three");function t(){}const i="\n#include <common>\nvarying vec2 vUv;\nuniform bool uLeft;\nuniform float uRotation;\n\nvoid main() {\n\n\n  // vec3 centerWorldPos = (modelMatrix * vec4(vec3(0.0), 1.0)).xyz;\n  // vec3 camRightWorld = vec3(viewMatrix[0].x, viewMatrix[1].x, viewMatrix[2].x);\n  // vec3 camUpWorld = vec3(viewMatrix[0].y, viewMatrix[1].y, viewMatrix[2].y);\n\n  // vec2 scale;\n  // scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n  // scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n  \n  // vec3 vertexWorldPos = centerWorldPos\n  //   + camRightWorld * position.x * scale.x\n  //   + camUpWorld * position.y * scale.y;\n\n  vec2 center = vec2(0.5);\n  vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n  if (uLeft) scale.x *= -1.0;\n\n  vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n  vec2 rotatedPosition;\n  float rot = uRotation * (uLeft ? -1.0 : 1.0);\n  rotatedPosition.x = cos( rot ) * alignedPosition.x - sin( rot ) * alignedPosition.y;\n  rotatedPosition.y = sin( rot ) * alignedPosition.x + cos( rot ) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n\n  gl_Position = projectionMatrix * mvPosition;\n  vUv = uv;\n  // if (uLeft) vUv.x = 1.0 - vUv.x;\n}\n",r="\nuniform sampler2D tSprite;\n\nuniform vec2 uSize;\nuniform vec2 uOffset;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n  // get single sprite UV\n  vec2 newUV = vUv * uSize;\n  newUV += uOffset;\n  newUV.y -= uSize.y;\n\n  vec4 spriteColor = texture2D(tSprite, newUV);\n\n  if ( spriteColor.a < 0.5 ) discard;\n\n  gl_FragColor = vec4(spriteColor.rgb, spriteColor.a);\n}\n",a=new e.TextureLoader;class n{constructor(e,t,i){this.data=e,this.spriteURL=t,this.texture=null,this.isLoaded=!1,this.isPlaying=!0,this.elapsed=0,this.framerate=i&&i.framerate||1/12,this.loop=i&&i.loop||!0,this.skipFrames=i&&i.skipFrames||[],this.currentFrame=0,this.currentFrameData=this.data.frames[0],this.material=null,window.addEventListener("keyup",()=>{})}async load(){return new Promise((e,i)=>{a.load(this.spriteURL,t=>{this.texture=t,this.onLoaded(),e()},t,e=>{i(e)})})}onLoaded(){this.isLoaded=!0,this.material=this.makeMaterial()}play(){this.isPlaying=!0}pause(){this.isPlaying=!1}stop(){this.pause(),this.currentFrame=0}gotoFrame(e){this.currentFrame=e}update(e){if(!this.isPlaying)return;let t=!1;this.elapsed+=e;const i=this.data.frames.length,r=this.loop&&this.loopEnd?this.loopEnd:i-1;this.elapsed>=this.framerate&&(this.elapsed=0,this.currentFrame++,t=!0,this.isFrameValid(this.currentFrame)&&(this.currentFrameData=this.data.frames[this.currentFrame])),this.currentFrame>=r&&this.loop&&(this.currentFrame=this.loopStart?this.loopStart:0,this.currentFrameData=this.data.frames[this.currentFrame]),this.currentFrame=Math.max(0,Math.min(this.currentFrame,i));const a=this.data,n=this.currentFrameData;return n&&0!=this.currentFrame&&(this.material.uniforms.uSize.value.x=n.sourceSize.w/a.meta.size.w,this.material.uniforms.uSize.value.y=n.sourceSize.h/a.meta.size.h,this.material.uniforms.uOffset.value.x=n.frame.x/a.meta.size.w,this.material.uniforms.uOffset.value.y=1-n.frame.y/a.meta.size.h),t}isFrameValid(e){let t=!0;for(let i=0;i<this.skipFrames.length;i++)this.skipFrames[i]==e&&(t=!1);return t}makeMaterial(){this.texture.minFilter=e.LinearFilter,this.texture.magFilter=e.LinearFilter;const t=new e.ShaderMaterial({uniforms:{tSprite:{value:this.texture},uSize:{value:new e.Vector2},uOffset:{value:new e.Vector2},uFlip:{value:0},uRotation:{value:0},uLeft:{value:!0,type:"i"}},side:e.DoubleSide,vertexShader:i,fragmentShader:r});return this.material=t,t}getMaterial(){return this.material}}var s=n;exports.default=s;
},{"three":"IV0r"}],"WDBn":[function(require,module,exports) {
module.exports=module.exports={frames:[{filename:"BIRD_FLY_1_0000.png",frame:{x:1,y:1,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0001.png",frame:{x:166,y:1,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0002.png",frame:{x:331,y:1,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0003.png",frame:{x:1,y:166,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0004.png",frame:{x:166,y:166,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0005.png",frame:{x:331,y:166,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0006.png",frame:{x:1,y:331,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0007.png",frame:{x:166,y:331,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0008.png",frame:{x:331,y:331,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0009.png",frame:{x:1,y:496,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0010.png",frame:{x:166,y:496,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0011.png",frame:{x:166,y:1,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0012.png",frame:{x:331,y:1,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0013.png",frame:{x:331,y:496,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0014.png",frame:{x:1,y:661,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0015.png",frame:{x:166,y:661,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0016.png",frame:{x:331,y:661,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0017.png",frame:{x:166,y:331,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0018.png",frame:{x:331,y:331,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0019.png",frame:{x:1,y:496,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}},{filename:"BIRD_FLY_1_0020.png",frame:{x:1,y:1,w:163,h:163},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:163,h:163},sourceSize:{w:163,h:163}}],meta:{app:"https://www.codeandweb.com/texturepacker",version:"1.0",image:"bird-fly.png",format:"RGBA8888",size:{w:495,h:825},scale:"0.25",smartupdate:"$TexturePacker:SmartUpdate:f0f421fcb3358c8b88a64ecc25121c3b:72b4781501fa14a996a7799bb788d834:7c301bb00a7c24e9cfe7ed7518c7859d$"}};
},{}],"Ddzx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=y;var e=l(require("../tags")),t=l(require("three")),n=s(require("../util/Random")),r=s(require("../assets/spritesheets/bird_fly.png")),i=l(require("../util/math")),a=s(require("../util/SpriteAnimation")),o=s(require("../assets/spritesheets/bird_fly.sheet"));function s(e){return e&&e.__esModule?e:{default:e}}function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const f=()=>{},d=new t.TextureLoader;class p extends e.Data{}async function y(s){const u=await async function(e){return new Promise((t,n)=>{d.load(e,e=>{t(e)},f,e=>{n(e)})})}(r.default),l=new t.PlaneBufferGeometry(1,1),c=(0,n.default)(),y=s.view([e.Object3D,p]),g=(s.listen(p),s.listen([e.Object3D,e.UserHitAudioTrigger])),m=new t.Vector3,b=new t.Box3;let T=0,v=null;return function(n){s.findTag(e.MainCamera);const r=s.findTag(e.MainCameraFrustum),f=Boolean(s.findTag(e.ShowBiomeResolution)||s.findTag(e.WrittenStanzaLineActive)||s.findTag(e.HaikuAddingToInventory));T+=n,g.added.forEach(n=>{if(f)return;const r=n.get(e.UserHitAudioTrigger).type,i=y.length<4,d=null==v||T-v>=2;if("tree"===r&&c.chance(.5)&&i&&d){const r=n.get(e.Object3D);m.copy(r.position);const i=Math.min(r.scale.y,c.range(4,5));m.y+=i,function(n,r){const i=new a.default(o.default,null);i.texture=u,i.makeMaterial();i.getMaterial();const f=new t.Mesh(l,i.getMaterial());f.position.copy(r);const d=s.entity();d.add(e.Object3D,f),d.add(e.AnimalSound,"birdChirp");d.add(p);const y=d.get(p),g=c.boolean();y.animation=i,y.velocity.set(g?-.5:.5,.25,-.5).normalize(),y.left=g,y.size=2,y.speed=7}(0,m),v=T}}),y.forEach(t=>{const a=t.get(p),o=a.speed,s=t.get(e.Object3D),u=s.material;a.animation.update(n),a.time+=n;const l=i.clamp01(a.time/a.animateInDuration);s.scale.setScalar(l*a.size),s.position.addScaledVector(a.velocity,n*o),u.uniforms.uLeft.value=a.left,u.uniforms.uRotation.value=i.degToRad(0),b.setFromObject(s),r.intersectsBox(b)||t.kill()})}}c(p,"data",{time:e.Types.Ref(0),animateInDuration:e.Types.Ref(.25),size:e.Types.Ref(.6),animation:e.Types.Ref(null),left:e.Types.Ref(!1),speed:e.Types.Ref(1),velocity:e.Types.Vector3()});
},{"../tags":"injP","three":"IV0r","../util/Random":"LMfK","../assets/spritesheets/bird_fly.png":"rmot","../util/math":"Ov1X","../util/SpriteAnimation":"cYdV","../assets/spritesheets/bird_fly.sheet":"WDBn"}],"JMYJ":[function(require,module,exports) {
module.exports=module.exports={frames:[{filename:"BIRD-STILL-0000.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0001.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0002.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0003.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0004.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0005.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0006.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0007.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0008.png",frame:{x:0,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0009.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0010.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0011.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0012.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0013.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0014.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0015.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0016.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0017.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0018.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0019.png",frame:{x:0,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0020.png",frame:{x:160,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0021.png",frame:{x:160,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0022.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0023.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0024.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0025.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0026.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0027.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0028.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0029.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0030.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0031.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0032.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0033.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0034.png",frame:{x:160,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0035.png",frame:{x:320,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0036.png",frame:{x:320,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0037.png",frame:{x:320,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0038.png",frame:{x:320,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0039.png",frame:{x:320,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0040.png",frame:{x:320,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0041.png",frame:{x:320,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0042.png",frame:{x:320,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0043.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0044.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0045.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0046.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0047.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0048.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0049.png",frame:{x:0,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0050.png",frame:{x:320,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0051.png",frame:{x:320,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0052.png",frame:{x:320,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0053.png",frame:{x:320,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0054.png",frame:{x:480,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0055.png",frame:{x:480,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0056.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0057.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0058.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0059.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0060.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0061.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0062.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0063.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0064.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0065.png",frame:{x:480,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0066.png",frame:{x:640,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0067.png",frame:{x:800,y:0,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0068.png",frame:{x:640,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0069.png",frame:{x:320,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0070.png",frame:{x:320,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0071.png",frame:{x:320,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0072.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0073.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0074.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0075.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0076.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0077.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0078.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0079.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0080.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0081.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0082.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0083.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0084.png",frame:{x:640,y:300,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0085.png",frame:{x:800,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0086.png",frame:{x:800,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0087.png",frame:{x:800,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}},{filename:"BIRD-STILL-0088.png",frame:{x:800,y:150,w:160,h:150},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:160,h:150},sourceSize:{w:160,h:150}}],meta:{app:"https://www.codeandweb.com/texturepacker",version:"1.0",image:"bird_still.png",format:"RGBA8888",size:{w:960,h:450},scale:"1",smartupdate:"$TexturePacker:SmartUpdate:1c195fab3f9fa70597046d6840707ff0:134ce8759e0ad3bea10d9e63432d9745:851287a48f709fb1b9488bdebbcefbcb$"}};
},{}],"BHeo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=b;var e=d(require("../util/math")),t=d(require("../tags")),i=d(require("three")),n=c(require("../util/Random")),a=c(require("../assets/spritesheets/bird_still.png")),r=c(require("../assets/spritesheets/bird_fly.png")),o=c(require("../util/SpriteAnimation")),l=require("../util/water-util"),s=c(require("../assets/spritesheets/bird_still.sheet")),u=c(require("../assets/spritesheets/bird_fly.sheet"));function c(e){return e&&e.__esModule?e:{default:e}}function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(f=function(e){return e?i:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var i=f(t);if(i&&i.has(e))return i.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=a?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,i&&i.set(e,n),n}function p(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const m=()=>{},y=new i.TextureLoader;class g extends t.Data{}async function b(l){const c=new i.Box3,f=new i.PlaneBufferGeometry(1,1),d=await O(a.default),p=await O(r.default),b=l.findTag(t.MainCameraFrustum),v=(0,n.default)(),h=l.view([t.Object3D,g]),w=l.listen(g),A=l.listen(t.AnimalSpawn),M=l.listen(t.ActiveEnvironmentState);return function(n){A.added.forEach(e=>{const n=e.get(t.AnimalSpawn);h.length<2&&"forest"===n.biome&&"bird"===n.animal&&!n.lake&&(!function(e){const n=new o.default(s.default,null,{skipFrames:[67]});n.texture=d,n.makeMaterial();const a=new o.default(u.default,null);a.texture=p,a.makeMaterial();const r=n.getMaterial(),c=(n.currentFrameData.sourceSize.w,n.currentFrameData.sourceSize.h,new i.Mesh(f,r)),m=l.entity();m.add(t.Object3D,c),m.add(g),m.add(t.Animal);const y=m.get(g);y.idleAnimation=n,y.flyingAnimation=a,function(e,i){const n=v.boolean(),a=e.get(g);a.state="idle",a.velocity.set(0,0,0),a.left=n;const r=a.idleAnimation,o=a.flyingAnimation;r.currentFrame=Math.floor(v.range(0,20)),o.currentFrame=Math.floor(v.range(0,20)),o.elapsed=0,r.elapsed=0;const l=e.get(t.Object3D);l.material=r.getMaterial(),l.position.copy(i),l.position.y+=.5,l.material.uniforms.uLeft.value=n}(m,e)}(n.position),e.kill())}),M.changed&&h.forEach(e=>e.kill());const a=l.findTag(t.UserCharacter).position;h.forEach(i=>{const r=i.get(t.Object3D),o=i.get(g);if(o.time+=n,r.position.distanceTo(a)<4&&"idle"==o.state){i.add(t.AnimalSound,"birdFlap"),o.state="flying",r.material=o.flyingAnimation.getMaterial(),r.material.uniforms.uRotation.value=e.degToRad(0);const n=o.left;r.material.uniforms.uLeft.value=n,o.velocity.x=n?-.5:.5,o.velocity.y=.25,o.velocity.z=-.5,o.velocity.normalize(),o.size=2}("idle"==o.state?o.idleAnimation:o.flyingAnimation).update(n);o.time+=n;const l=e.clamp01(o.time/o.animateInDuration);r.scale.setScalar(l*o.size),r.position.addScaledVector(o.velocity,n*o.speed),o.time>=o.duration&&(c.setFromObject(r),b.intersectsBox(c)||i.kill())}),w.removing.forEach(e=>{})};async function O(e){return new Promise((t,i)=>{y.load(e,e=>{t(e)},m,e=>{i(e)})})}}p(g,"data",{time:t.Types.Ref(0),size:t.Types.Ref(1.4),animateInDuration:t.Types.Ref(.25),duration:t.Types.Ref(5),speed:t.Types.Ref(7),left:t.Types.Ref(!0),state:t.Types.Ref("idle"),idleAnimation:t.Types.Ref(null),flyingAnimation:t.Types.Ref(null),velocity:t.Types.Vector3(0,0,0)});
},{"../util/math":"Ov1X","../tags":"injP","three":"IV0r","../util/Random":"LMfK","../assets/spritesheets/bird_still.png":"cq2t","../assets/spritesheets/bird_fly.png":"rmot","../util/SpriteAnimation":"cYdV","../util/water-util":"j8Gj","../assets/spritesheets/bird_still.sheet":"JMYJ","../assets/spritesheets/bird_fly.sheet":"WDBn"}],"fuNY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=P;var e=c(require("simplex-noise")),t=p(require("../../tags")),n=p(require("three")),i=c(require("../../util/Random")),a=c(require("../../util/SpriteAnimation")),o=c(require("../../assets/spritesheets/butterfly.png")),s=c(require("../../assets/spritesheets/butterfly.sheet")),r=require("canvas-sketch-util/math"),l=p(require("../../util/math")),d=require("../../util/EditorWayfinderSprite");function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}function p(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}function c(e){return e&&e.__esModule?e:{default:e}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const y=()=>{},g=new n.TextureLoader,m=new n.Vector3,h=new n.Vector3,S=new n.Vector3;let T=new n.Color("hsl(50, 100%, 100%)");class R extends t.Data{}async function P(a){const s=new n.Box3,u=(new n.PlaneBufferGeometry(1,1),await async function(e){return new Promise((t,n)=>{g.load(e,e=>{t(e)},y,e=>{n(e)})})}(o.default),(0,i.default)()),p=(new e.default(u.value),a.view([t.Object3D,R])),c=(a.listen(R),new n.Vector3(-10,0,-10),a.listen(t.AnimalSpawn)),f=a.entity(),S=a.listen(t.ActiveEnvironmentState);return e=>{S.changed&&p.forEach(e=>e.kill()),c.added.forEach(e=>{const i=e.get(t.AnimalSpawn);p.length<25&&"grasslands"===i.biome&&"butterfly"===i.animal&&!i.lake&&(!function(e){const i=u.rangeFloor(3,8),o=u.pick([0,30,50,330]),s=o/360,r=330===o?.5:.75;for(let p=0;p<i;p++){const i=(0,d.createSprite)(a,new n.Texture);i.position.set(e.x,0,e.z);const o=a.entity().add(t.Object3D,i).add(t.ShaderUniformTime,{uniform:i.material.uniforms.time}).add(t.ShadowCaster,{sprite:!0}).add(t.Animal).add(R),c=o.get(R);c.left=p%2==0,c.state="flying",(0,d.setSpriteFlip)(i,c.left);const f=u.range(0,2*Math.PI);c.angle=f,c.angleSpeed=u.range(-2,2),c.angleRadius=u.range(.3,1);const y=u.range(.8,1.2);c.restPosition.y=1,c.restPosition.x-=u.range(-y,y),c.restPosition.z-=u.range(-y,y),c.restPosition.add(e),c.tgtPosition.x=0,c.tgtPosition.y=1,c.tgtPosition.z=0,c.tgtPosition.add(e),c.fleeThreshold=u.range(1.5,2),c.followSpeed=u.range(1,2);const g=u.range(.4,.65);c.size=g,i.scale.x=g,i.scale.y=g,o.add(t.SpriteAnimation);const m=o.get(t.SpriteAnimation);m.looping=!0;const h=o.get(t.Object3D),S=u.range(-20,20)/360,P=u.range(0,.1);T.setHSL(l.mod(s+S,1),r,.5+P),h.material.uniforms.tintColor.value.copy(T),c.canGetAnnoyed=u.chance(.5),o.add(t.SpriteAnimationLazyLoadSheet);const w=o.get(t.SpriteAnimationLazyLoadSheet);w.id="spritesheets/butterfly"}}(i.position),e.kill())});const i=a.findTag(t.MainCameraFrustum),o=a.findTag(t.UserCharacter).position;let y=!1;p.forEach(n=>{const a=n.get(t.Object3D),u=n.get(R);u.time+=e;const p=a.position.distanceTo(o),c=u.restPosition.distanceToSquared(o);p<=4&&(y=!0),c<=16?u.inRadiusElapsed+=e:u.inRadiusElapsed*=.5,u.inRadiusElapsed>=1&&u.canGetAnnoyed&&!u.isAnnoyed&&c<=16&&(u.isAnnoyed=!0),u.isAnnoyed&&c>16&&(u.annoyedElapsed+=e,u.annoyedElapsed>2&&(u.isAnnoyed=!1,u.annoyedElapsed=0));const f=u.fleeThreshold;let g=(0,r.mapRange)(p/f,0,f,5,1);g=Math.max(1,g),u.angle+=u.angleSpeed*e,u.tgtPosition.x=u.restPosition.x+Math.cos(u.angle)*u.angleRadius,u.tgtPosition.z=u.restPosition.z+Math.sin(u.angle)*u.angleRadius,u.isAnnoyed&&(u.tgtPosition.x=o.x+Math.cos(u.angle)*u.angleRadius,u.tgtPosition.z=o.z+Math.sin(u.angle)*u.angleRadius);const S=l.clamp01(u.time/u.animateInDuration);a.scale.setScalar(S*u.size),m.copy(u.tgtPosition),m.sub(a.position);const T=Math.min(6,m.length());m.normalize(),m.multiplyScalar(.01*T*u.followSpeed);const P=u.fleeThreshold;let w=(0,r.mapRange)(p/P,0,P,.15,0);w=Math.max(0,Math.min(.08,w)),h.copy(a.position),h.sub(o),h.normalize(),h.multiplyScalar(w),m.add(h),a.position.add(m),a.position.y=1+.4*Math.sin(u.time*u.angleSpeed),(0,d.setSpriteFlip)(a,u.left),u.time>=u.duration&&(s.setFromObject(a),i.intersectsBox(s)||(u.outOfScreenElapsed+=e,u.outOfScreenElapsed>u.outOfScreenLimit&&n.kill()))}),y?f.has(t.AnimalSound)||f.add(t.AnimalSound,"butterfly"):f.tagOff(t.AnimalSound)}}f(R,"data",{time:t.Types.Ref(0),animateInDuration:t.Types.Ref(.25),duration:t.Types.Ref(5),outOfScreenElapsed:t.Types.Ref(0),outOfScreenLimit:t.Types.Ref(5),size:t.Types.Ref(.65),state:t.Types.Ref("flying"),flyingAnimation:t.Types.Ref(null),velocity:t.Types.Vector3(0,0,0),left:t.Types.Ref(!1),restPosition:t.Types.Vector3(0,0,0),tgtPosition:t.Types.Vector3(0,0,0),tgtAngle:t.Types.Ref(0),tgtSpeed:t.Types.Ref(0),tgtAngleRadius:t.Types.Ref(0),fleeThreshold:t.Types.Ref(0),followSpeed:t.Types.Ref(0),inRadiusElapsed:t.Types.Ref(0),canGetAnnoyed:t.Types.Ref(!1),isAnnoyed:t.Types.Ref(!1),annoyedElapsed:t.Types.Ref(0)});
},{"simplex-noise":"KFJE","../../tags":"injP","three":"IV0r","../../util/Random":"LMfK","../../util/SpriteAnimation":"cYdV","../../assets/spritesheets/butterfly.png":"liUq","../../assets/spritesheets/butterfly.sheet":"Ixuw","canvas-sketch-util/math":"RN3r","../../util/math":"Ov1X","../../util/EditorWayfinderSprite":"iSWR"}],"VYSB":[function(require,module,exports) {
module.exports=module.exports={frames:[{filename:"rabbit.png",frame:{x:1,y:1,w:128,h:130},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:128,h:130},sourceSize:{w:128,h:130}}],meta:{app:"https://www.codeandweb.com/texturepacker",version:"1.0",image:"rabbit.png",format:"RGBA8888",size:{w:130,h:132},scale:"0.125",smartupdate:"$TexturePacker:SmartUpdate:08b128059a6a4415147d59821ae0430b:9bf3f0adc5d3336c983fe6c591567cb0:728f3986df73c95a11c23983e61158cd$"}};
},{}],"oauB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=m;var e=l(require("../../tags")),t=l(require("three")),n=s(require("../../util/Random")),a=s(require("../../assets/spritesheets/rabbit.png")),i=l(require("../../util/math")),r=s(require("../../util/SpriteAnimation")),o=s(require("../../assets/spritesheets/rabbit.sheet.json"));function s(e){return e&&e.__esModule?e:{default:e}}function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(a,r,o):a[r]=e[r]}return a.default=e,n&&n.set(e,a),a}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const c=()=>{},d=new t.TextureLoader;class p extends e.Data{}async function m(s){const u=await async function(e){return new Promise((t,n)=>{d.load(e,e=>{t(e)},c,e=>{n(e)})})}(a.default),l=new t.PlaneBufferGeometry(1,1),f=(0,n.default)(),m=s.view([e.Object3D,p]);s.listen(p),new t.Box3;let y=0;const b=s.listen(e.AnimalSpawn);new t.Vector3(-8,1,-6);return function(n){s.findTag(e.MainCamera),s.findTag(e.MainCameraFrustum);b.added.forEach(n=>{const a=n.get(e.AnimalSpawn);m.length<20&&"grasslands"===a.biome&&"rabbit"===a.animal&&!a.lake&&(!function(n,a){const i=new r.default(o.default,null);i.texture=u,i.makeMaterial();i.getMaterial();const c=new t.Mesh(l,i.getMaterial());c.position.copy(a),c.position.y+=.5;const d=s.entity();d.add(e.Object3D,c);d.add(p);const m=d.get(p),y=f.boolean();m.animation=i,m.velocity.set(y?-.1:.1,0,-.1).normalize(),m.left=y,m.speed=7}(0,a.position),n.kill())});Boolean(s.findTag(e.ShowBiomeResolution)||s.findTag(e.WrittenStanzaLineActive)||s.findTag(e.HaikuAddingToInventory));y+=n,m.forEach(t=>{const a=t.get(p),r=(a.speed,t.get(e.Object3D)),o=r.material;a.animation.update(n),a.time+=n;const s=i.clamp01(a.time/a.animateInDuration);r.scale.setScalar(s*a.size),o.uniforms.uLeft.value=a.left,o.uniforms.uRotation.value=i.degToRad(0)})}}f(p,"data",{time:e.Types.Ref(0),animateInDuration:e.Types.Ref(.25),size:e.Types.Ref(1.2),animation:e.Types.Ref(null),left:e.Types.Ref(!1),speed:e.Types.Ref(1),velocity:e.Types.Vector3(),state:e.Types.Ref("")});
},{"../../tags":"injP","three":"IV0r","../../util/Random":"LMfK","../../assets/spritesheets/rabbit.png":"iyjm","../../util/math":"Ov1X","../../util/SpriteAnimation":"cYdV","../../assets/spritesheets/rabbit.sheet.json":"VYSB"}],"SYNx":[function(require,module,exports) {
module.exports=module.exports={frames:[{filename:"seal_1.png",frame:{x:1,y:1,w:103,h:75},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:103,h:75},sourceSize:{w:103,h:75}}],meta:{app:"https://www.codeandweb.com/texturepacker",version:"1.0",image:"seal.png",format:"RGBA8888",size:{w:105,h:77},scale:"0.125",smartupdate:"$TexturePacker:SmartUpdate:4459159640a2f3aa7d478805520d49fb:a1c6057bb18b47b8b1c34c942fb3eb96:77441584f386b1802c776f35e0e1106e$"}};
},{}],"LVu2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=y;var e=f(require("../../tags")),t=f(require("three")),n=u(require("../../util/Random")),a=require("../../util/materials"),r=u(require("../../assets/spritesheets/seal.png")),i=f(require("../../util/math")),o=u(require("../../util/SpriteAnimation")),s=u(require("../../assets/spritesheets/seal.sheet.json"));function u(e){return e&&e.__esModule?e:{default:e}}function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(a,i,o):a[i]=e[i]}return a.default=e,n&&n.set(e,a),a}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const p=()=>{},d=new t.TextureLoader;class m extends e.Data{}async function y(u){const l=await async function(e){return new Promise((t,n)=>{d.load(e,e=>{t(e)},p,e=>{n(e)})})}(r.default),f=new t.PlaneBufferGeometry(.642,.77*.6),c=(0,n.default)(),y=u.view([e.Object3D,m]);u.listen(m),new t.Box3;let g=0;const w=u.listen(e.AnimalSpawn);new t.Vector3(-10,1,-10);return function(n){u.findTag(e.MainCamera),u.findTag(e.MainCameraFrustum);w.added.forEach(n=>{const r=n.get(e.AnimalSpawn);y.length<20&&"grasslands"===r.biome&&"seal"===r.animal&&!r.lake&&(!function(n,r){const i=new o.default(s.default,null);i.texture=l,i.makeMaterial();const p=u.findTag(e.UserCharacter).position,d=new t.Mesh(f,(0,a.createSpriteMaterial)(u));d.material.uniforms.map.value=l,d.position.copy(p),d.position.y=1;const y=u.entity();y.add(e.Object3D,d);y.add(m);const g=y.get(m),w=c.boolean();g.animation=i,g.velocity.set(w?-.1:.1,0,-.1).normalize(),g.left=w,g.speed=7}(0,r.position),n.kill())});Boolean(u.findTag(e.ShowBiomeResolution)||u.findTag(e.WrittenStanzaLineActive)||u.findTag(e.HaikuAddingToInventory));g+=n,y.forEach(t=>{const a=t.get(m),r=(a.speed,t.get(e.Object3D));r.material;a.animation.update(n),a.time+=n;const o=i.clamp01(a.time/a.animateInDuration);r.scale.setScalar(o*a.size)})}}c(m,"data",{time:e.Types.Ref(0),animateInDuration:e.Types.Ref(.25),size:e.Types.Ref(2),animation:e.Types.Ref(null),left:e.Types.Ref(!1),speed:e.Types.Ref(1),velocity:e.Types.Vector3(),state:e.Types.Ref("")});
},{"../../tags":"injP","three":"IV0r","../../util/Random":"LMfK","../../util/materials":"phuP","../../assets/spritesheets/seal.png":"EFLP","../../util/math":"Ov1X","../../util/SpriteAnimation":"cYdV","../../assets/spritesheets/seal.sheet.json":"SYNx"}],"ZFiB":[function(require,module,exports) {
module.exports=module.exports={frames:[{filename:"OWL-1_0000.png",frame:{x:1,y:1,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}}],meta:{app:"https://www.codeandweb.com/texturepacker",version:"1.0",image:"owl_sleep.png",format:"RGBA8888",size:{w:142,h:142},scale:"1",smartupdate:"$TexturePacker:SmartUpdate:21eaf86d4169e0ddc4011243b75b342b:dcc49444f38700aee47bfd37a7041e0a:6bc02c8c74c6acf003ca8634b6b6245d$"}};
},{}],"Yl6K":[function(require,module,exports) {
module.exports=module.exports={frames:[{filename:"OWL-1_0000.png",frame:{x:1,y:1,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0001.png",frame:{x:143,y:1,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0002.png",frame:{x:285,y:1,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0003.png",frame:{x:1,y:143,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0004.png",frame:{x:143,y:143,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0005.png",frame:{x:285,y:143,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0006.png",frame:{x:1,y:285,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0007.png",frame:{x:143,y:285,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0008.png",frame:{x:285,y:285,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0009.png",frame:{x:1,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0010.png",frame:{x:1,y:1,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0011.png",frame:{x:143,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0012.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0013.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0014.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0015.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0016.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0017.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0018.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0019.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0020.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0021.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0022.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0023.png",frame:{x:285,y:427,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0024.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0025.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0026.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0027.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0028.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0029.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0030.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0031.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0032.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0033.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0034.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0035.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0036.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0037.png",frame:{x:1,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0038.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0039.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0040.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0041.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0042.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0043.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0044.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0045.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0046.png",frame:{x:143,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0047.png",frame:{x:285,y:569,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}},{filename:"OWL-1_0048.png",frame:{x:1,y:1,w:140,h:140},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:140,h:140},sourceSize:{w:140,h:140}}],meta:{app:"https://www.codeandweb.com/texturepacker",version:"1.0",image:"owl_wakeup.png",format:"RGBA8888",size:{w:426,h:710},scale:"1",smartupdate:"$TexturePacker:SmartUpdate:72e1158335e3a375f958ba9c57f12e1b:7ae100e830d5001477212dfd1b1f81c1:4803889c0639208641360bc38f21b5a2$"}};
},{}],"PhLV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=y;var e=p(require("../../tags")),t=p(require("three")),n=l(require("../../util/Random")),a=l(require("../../assets/spritesheets/owl_sleep.png")),i=l(require("../../assets/spritesheets/owl_wakeup.png")),r=p(require("../../util/math")),o=l(require("../../util/SpriteAnimation")),s=l(require("../../assets/spritesheets/owl_sleep.sheet.json")),u=l(require("../../assets/spritesheets/owl_wakeup.sheet.json"));function l(e){return e&&e.__esModule?e:{default:e}}function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function p(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(a,r,o):a[r]=e[r]}return a.default=e,n&&n.set(e,a),a}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const m=()=>{},d=new t.TextureLoader;class w extends e.Data{}async function y(l){const c=await h(i.default),p=await h(a.default),f=new t.PlaneBufferGeometry(1,1),y=(0,n.default)(),g=l.view([e.Object3D,w]);l.listen(w),new t.Box3;let A=0;const T=l.listen(e.AnimalSpawn);new t.Vector3(-5,1,-5);return function(n){l.findTag(e.MainCamera),l.findTag(e.MainCameraFrustum);const a=l.findTag(e.UserCharacter).position;T.added.forEach(n=>{const a=n.get(e.AnimalSpawn);g.length<20&&"owl"===a.animal&&!a.lake&&(!function(n,a){const i=new o.default(s.default,null);i.texture=p,i.makeMaterial();const r=new o.default(u.default,null);r.texture=c,r.loop=!1,r.makeMaterial();const m=new t.Mesh(f,i.getMaterial());m.position.copy(a),m.position.y+=.5;const d=l.entity();d.add(e.Object3D,m);d.add(w);const g=d.get(w);g.state="sleep";const A=y.boolean();g.sleepAnimation=i,g.wakeupAnimation=r,g.currentAnimation=i,g.left=A,g.speed=7}(0,a.position),n.kill())});Boolean(l.findTag(e.ShowBiomeResolution)||l.findTag(e.WrittenStanzaLineActive)||l.findTag(e.HaikuAddingToInventory));A+=n,g.forEach(t=>{const i=t.get(w),o=t.get(e.Object3D),s=o.position.distanceTo(a);s<14&&"sleep"==i.state?(i.state="wakeup",i.currentAnimation=i.wakeupAnimation,i.currentAnimation.stop(),i.currentAnimation.play(),o.material=i.currentAnimation.getMaterial()):s>4&&"wakeup"==i.state&&i.currentAnimation.currentFrame>47&&(i.state="sleep",i.currentAnimation=i.sleepAnimation,i.currentAnimation.stop(),i.currentAnimation.play(),o.material=i.currentAnimation.getMaterial()),i.currentAnimation.update(n),i.time+=n;const u=r.clamp01(i.time/i.animateInDuration);o.scale.setScalar(u*i.size);const l=o.material;l.uniforms.uLeft.value=i.left,l.uniforms.uRotation.value=r.degToRad(0)})};async function h(e){return new Promise((t,n)=>{d.load(e,e=>{t(e)},m,e=>{n(e)})})}}f(w,"data",{time:e.Types.Ref(0),animateInDuration:e.Types.Ref(.25),size:e.Types.Ref(1),left:e.Types.Ref(!1),state:e.Types.Ref("sleep"),currentAnimation:e.Types.Ref(null),sleepAnimation:e.Types.Ref(null),wakeupAnimation:e.Types.Ref(null)});
},{"../../tags":"injP","three":"IV0r","../../util/Random":"LMfK","../../assets/spritesheets/owl_sleep.png":"vNQX","../../assets/spritesheets/owl_wakeup.png":"HDAB","../../util/math":"Ov1X","../../util/SpriteAnimation":"cYdV","../../assets/spritesheets/owl_sleep.sheet.json":"ZFiB","../../assets/spritesheets/owl_wakeup.sheet.json":"Yl6K"}],"fssW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=m;var e=l(require("../../tags")),t=l(require("three")),r=i(require("../../util/Random")),o=l(require("../../util/math")),n=i(require("../../util/SpriteAnimation")),a=require("../../util/EditorWayfinderSprite");function i(e){return e&&e.__esModule?e:{default:e}}function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var i=n?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(o,a,i):o[a]=e[a]}return o.default=e,r&&r.set(e,o),o}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const c=new t.Vector3,d=new t.Vector3;class p extends e.Data{}let f;function m(o){const n=(0,r.default)(),i=o.listen([e.Object3D,e.FoxSpriteTag]),u=o.view([e.Object3D,e.FoxSpriteTag]),l=(o.listen(e.FoxHm),o.findTag(e.UserCharacter)),s=new t.Box3;return function(t){i.added.forEach((t,r)=>{const o=t.get(e.Object3D);t.add(p),(0,a.setSpriteFlip)(o,n.boolean()),o.scale.y=1.5,t.add(e.SpriteAnimation);const i=t.get(e.SpriteAnimation);i.looping=!0,i.loopStart=0,i.loopEnd=29,t.add(e.SpriteAnimationLazyLoadSheet),t.get(e.SpriteAnimationLazyLoadSheet).id="spritesheets/fox"});const r=o.findTag(e.MainCameraFrustum),m=l.position;c.x=m.x,c.z=m.z,u.forEach((t,o)=>{const n=t.get(e.Object3D),a=t.get(e.SpriteAnimation),i=t.get(p);d.setFromMatrixPosition(n.matrixWorld);const u=c.x-d.x,l=c.z-d.z;u*u+l*l<169?(i.state="awake",a.loopStart=29,a.loopEnd=68,a.frame>=30&&a.frame<=33&&i.canPlayHmSound&&(i.canPlayHmSound=!1,t.add(e.FoxHm),t.remove(e.FoxPurring),f=setTimeout(()=>{t.remove(e.FoxHm),i.canPlayHmSound=!0},5e3))):(i.state="sleep",a.loopStart=0,a.loopEnd=29,s.setFromObject(n),r.intersectsBox(s)?t.add(e.FoxPurring):(t.remove(e.FoxHm),t.remove(e.FoxPurring)))})}}s(p,"data",{state:e.Types.Ref("sleep"),canPlayHmSound:e.Types.Ref(!0)});
},{"../../tags":"injP","three":"IV0r","../../util/Random":"LMfK","../../util/math":"Ov1X","../../util/SpriteAnimation":"cYdV","../../util/EditorWayfinderSprite":"iSWR"}],"YtQY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=c;var e=d(require("../../tags")),t=d(require("three")),r=o(require("../../util/Random")),i=o(require("../../assets/spritesheets/fish.png")),n=d(require("../../util/math")),a=o(require("../../util/SpriteAnimation")),s=require("../../util/EditorWayfinderSprite");function o(e){return e&&e.__esModule?e:{default:e}}function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=n?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(i,a,s):i[a]=e[a]}return i.default=e,r&&r.set(e,i),i}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class l extends e.Data{}f(l,"data",{spawnEntity:e.Types.Ref(null)});class p extends e.Tag{}function c(i){const n=(0,r.default)(),a=i.view(e.WaterFishPlaceholderTag),o=i.findTag(e.UserCharacter),u=i.view([e.SpriteAnimation,l]),d=i.view([e.EnvironmentState,e.ActiveEnvironmentState]);return function(r){if(d.length&&"grasslands"!==d[0].get(e.EnvironmentState).name)return;const f=o.position;u.forEach(t=>{t.get(e.SpriteAnimation).finished&&(t.get(l).spawnEntity.remove(p),t.kill())}),a.forEach(r=>{const a=r.get(e.GroundAsset),o=a.x-f.x,u=a.z-f.z;o*o+u*u<=64?r.has(e.UserHasHit)||(r.add(e.UserHasHit),r.has(p)||(r.add(p),function(r,a,o){const u=(0,s.createSprite)(i,new t.Texture);u.position.set(a,0,o);const d=i.entity().add(e.Object3D,u).add(e.ShaderUniformTime,{uniform:u.material.uniforms.time}).add(e.ShadowCaster,{sprite:!0}).add(e.AnimalSound,"fish").add(l,{spawnEntity:r});(0,s.setSpriteFlip)(u,n.boolean());u.scale.x=4,u.scale.y=2.6664,d.add(e.SpriteAnimation);d.get(e.SpriteAnimation);d.add(e.SpriteAnimationLazyLoadSheet),d.get(e.SpriteAnimationLazyLoadSheet).id="spritesheets/fish"}(r,a.x,a.z))):r.has(e.UserHasHit)&&r.remove(e.UserHasHit)})}}
},{"../../tags":"injP","three":"IV0r","../../util/Random":"LMfK","../../assets/spritesheets/fish.png":"kPW1","../../util/math":"Ov1X","../../util/SpriteAnimation":"cYdV","../../util/EditorWayfinderSprite":"iSWR"}],"YGiR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=y;var e=u(require("../../util/math")),t=u(require("../../tags")),n=u(require("three")),i=s(require("../../util/Random")),r=require("../../util/water-util"),o=require("canvas-sketch-util/math"),a=require("../../util/EditorWayfinderSprite");function s(e){return e&&e.__esModule?e:{default:e}}function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const f=new n.Vector3,d=()=>{},c=new n.TextureLoader,m=new n.Color("#ffffff");class g extends t.Data{}async function y(r){const o=new n.Box3,s=(new n.Box3,new n.PlaneBufferGeometry(1,1),r.findTag(t.MainCameraFrustum)),l=(0,i.default)(),u=r.view([t.Object3D,g]),p=r.view([t.GroundAsset,t.GroundAssetData]),d=r.listen(t.AnimalSpawn);return function(i){d.added.forEach(e=>{const i=e.get(t.AnimalSpawn);if(u.length<10&&"tundra"===i.biome&&"jumpingrabbit"===i.animal&&!i.lake){let o=!0;p.forEach((e,n)=>{const r=e.get(t.GroundAsset);f.x=r.x,f.z=r.z,f.distanceTo(i.position)<5&&(o=!1)}),l.chance(.4)&&function(e){const i=(0,a.createSprite)(r,new n.Texture);i.position.set(e.x,0,e.z);const o=r.entity().add(t.Object3D,i).add(t.ShaderUniformTime,{uniform:i.material.uniforms.time}).add(t.ShadowCaster,{sprite:!0}).add(g),s=o.get(g);s.left=l.boolean(),(0,a.setSpriteFlip)(i,s.left);i.scale.x=4,i.scale.y*=62/128,s.jumpSpeed=l.range(3,4.5),o.add(t.SpriteAnimation);const u=o.get(t.SpriteAnimation);u.looping=!0,u.loopStart=0,u.loopEnd=18;const p=o.get(t.Object3D);p.material.uniforms.tintColor.value.r=m.r,p.material.uniforms.tintColor.value.g=m.g,p.material.uniforms.tintColor.value.b=m.b,p.material.needsUpdate=!0,u.onLoopEnd=(e=>{const n=e.get(t.Object3D),i=e.get(t.SpriteAnimation),r=e.get(g),o=i.frame>=18&&i.frame<35;o&&(n.position.x+=r.left?.43*r.size:.43*-r.size),"jumping"===r.state?(i.loopStart=18,i.loopEnd=35):"idle"===r.state&&(i.loopStart=0,i.loopEnd=18),i.frame=i.loopStart,i.dirty=!0,r.left!==r.newLeft&&(r.left=r.newLeft,(0,a.setSpriteFlip)(n,r.left),n.position.x+=r.left?.43*r.size:.43*-r.size)}),o.add(t.SpriteAnimationLazyLoadSheet),o.get(t.SpriteAnimationLazyLoadSheet).id="spritesheets/jumpingrabbit"}(i.position),e.kill()}});const c=r.findTag(t.UserCharacter).position;u.forEach(n=>{const r=n.get(t.Object3D),a=n.get(g),l=n.get(t.SpriteAnimation);a.time+=i;const u=l.frame>=18&&l.frame<35;l.speed=u?a.jumpSpeed:1;const d=r.position.distanceTo(c);let m=c.x-r.position.x>0?1:-1;p.forEach((e,n)=>{e.get(t.GroundAsset);const i=e.get(t.Object3D);if(i.geometry&&i.geometry.boundingSphere){f.x=i.matrixWorld.elements[12],f.z=i.matrixWorld.elements[14],f.distanceTo(r.position)<(i.geometry?2*i.geometry.boundingSphere.radius:4)&&(m*=-1)}}),a.newLeft=1!=m,d<10&&"idle"==a.state&&(console.log("start running away"),a.state="jumping",l.loopStart=18,l.loopEnd=35,l.frame=l.loopStart,l.dirty=!0),"jumping"===a.state&&d>10&&(a.state="idle");const y=e.clamp01(a.time/a.animateInDuration);r.scale.setScalar(y*a.size),r.scale.y*=62/128,a.time>=a.duration&&(o.setFromObject(r),s.intersectsBox(o)||n.kill())})}}p(g,"data",{time:t.Types.Ref(0),size:t.Types.Ref(2.5),animateInDuration:t.Types.Ref(.25),duration:t.Types.Ref(10),speed:t.Types.Ref(7),left:t.Types.Ref(!0),newLeft:t.Types.Ref(null),state:t.Types.Ref("idle"),animation:t.Types.Ref(null),jumpSpeed:t.Types.Ref(1)});
},{"../../util/math":"Ov1X","../../tags":"injP","three":"IV0r","../../util/Random":"LMfK","../../util/water-util":"j8Gj","canvas-sketch-util/math":"RN3r","../../util/EditorWayfinderSprite":"iSWR"}],"aiva":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=v;var t=f(require("../tags")),e=f(require("three")),n=f(require("../util/math")),o=c(require("../util/Random")),a=c(require("../util/Assets")),r=f(require("../util/ShaderManager")),i=require("../util/array"),s=c(require("../util/query-string")),l=require("../util/resetPlayerPos");function c(t){return t&&t.__esModule?t:{default:t}}function u(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(u=function(t){return t?n:e})(t)}function f(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var n=u(e);if(n&&n.has(t))return n.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var i=a?Object.getOwnPropertyDescriptor(t,r):null;i&&(i.get||i.set)?Object.defineProperty(o,r,i):o[r]=t[r]}return o.default=t,n&&n.set(t,o),o}function m(){this.position=new e.Vector3(0,0,0),this.velocity=new e.Vector3(0,0,0),this.lastPosition=new e.Vector3(0,0,0),this.speed=1,this.scale=1,this.timeScale=1,this.currentRotation=new e.Quaternion(0,0,0,0),this.spinRotation=new e.Quaternion(0,0,0,0),this.flatRotation=new e.Quaternion(0,0,0,0),this.rotationAxis=new e.Vector3(0,0,0),this.rotationSpeed=1,this.rotationAngleOffset=0}function v(s){const l=(0,o.default)(),c=[0,0],u=new e.Vector3(0,0,0),f=new e.Vector3(0,0,0),v=[0,0,0],p=s.findTag(t.Renderer),d=Math.min(8,p.capabilities.getMaxAnisotropy()),[g]=a.default.createGPUTextureTask(p,"image/ui/ico_about",{anisotropy:d}),y=new e.Quaternion(0,0,0,1);new e.Quaternion(0,0,0,1).setFromEuler(new e.Euler(-Math.PI/2,0,0));const h=1e3,w=new e.Group,b=()=>l.range(.1,.3);let A=b(),x=0;const S=new e.PlaneBufferGeometry(1,1,4,4),R=new e.InstancedBufferGeometry;R.instanceCount=h,R.setAttribute("position",S.getAttribute("position")),R.setAttribute("normal",S.getAttribute("normal")),R.setAttribute("uv",S.getAttribute("uv")),R.setIndex(S.getIndex());const C=new Float32Array(3e3),M=new Float32Array(4e3),q=new Float32Array(3e3),z=new Float32Array(2e3),O=new e.Quaternion,N=new e.Color,P=new e.Color("hsl(40, 100%, 50%)"),T=(0,i.newArray)(h).map((t,o)=>{N.copy(P).offsetHSL(l.range(-1,1)*(5/360),.05*l.range(-1,0),.1*l.range(-1,1)),N.r=n.clamp(N.r,0,1),N.g=n.clamp(N.g,0,1),N.b=n.clamp(N.b,0,1);const a=l.range(0,h),[r,i]=l.onCircle(l.gaussian(7,2),c),s=new m;s.timeScale=l.range(1,1),s.position.set(r,l.range(0,4),i),s.rotationAxis.fromArray(l.insideSphere(1,v)),s.rotationAngleOffset=l.range(-1,1)*Math.PI*2,s.rotationSpeed=l.range(.1,1);const u=new e.Euler(0,0,0);return u.x=-Math.PI/2+.1*l.range(-1,1),u.z=l.range(-1,1)*Math.PI*2,O.setFromEuler(u),s.spinRotation.copy(O),s.flatRotation.copy(O),s.currentRotation.copy(O),s.speed=l.range(.5,1.5),s.scale=Math.abs(l.gaussian(.75,.1)),s.velocity.copy(s.position).normalize().multiplyScalar(l.gaussian(1,.25)),q[3*o+0]=N.r,q[3*o+1]=N.g,q[3*o+2]=N.b,z[2*o+0]=s.scale,z[2*o+1]=a,{body:s}});R.setAttribute("instanceColor",new e.InstancedBufferAttribute(q,3));const F=new e.InstancedBufferAttribute(C,3);R.setAttribute("instancePosition",F);const _=new e.InstancedBufferAttribute(M,4);R.setAttribute("instanceRotation",_),R.setAttribute("instanceScaleAndTime",new e.InstancedBufferAttribute(z,2));const U=function(t={}){const{map:n,color:o="white",opacity:a=1,timeOffset:i=0,time:s=0,minY:l,spriteRadius:c}=t;return delete(t={...t}).time,delete t.opacity,delete t.color,delete t.map,delete t.spriteRadius,delete t.minY,delete t.timeOffset,r.create({name:"origin-tree-leaves",uniforms:{color:{value:new e.Color(o)},map:{value:n},time:{value:s},globalScale:{value:1},opacity:{value:a},straighten:{value:0},minY:{value:l},spriteRadius:{value:c},fadeAway:{value:0},timeOffset:{value:i}},...t,vertexShader:"\n        attribute vec3 instancePosition;\n        attribute vec4 instanceRotation;\n        attribute vec3 instanceColor;\n        attribute vec2 instanceScaleAndTime;\n        varying vec2 vUv;\n        varying vec3 vNormal;\n        uniform float mapScale;\n        // uniform float timeOffset;\n        uniform float time;\n        // uniform float straighten;\n        varying float vStraighten;\n        uniform float globalScale;\n        uniform float spriteRadius;\n        uniform float minY;\n        uniform float fadeAway;\n        varying vec3 vColor;\n\n        mat3 rotation3dY(float angle) {\n        \tfloat s = sin(angle);\n        \tfloat c = cos(angle);\n\n        \treturn mat3(\n        \t\tc, 0.0, -s,\n        \t\t0.0, 1.0, 0.0,\n        \t\ts, 0.0, c\n        \t);\n        }\n\n        float invLerp (float minV, float maxV, float t) {\n          return (t - minV) / (maxV - minV);\n        }\n\n        vec3 rotate_vector( vec4 quat, vec3 vec ) {\n          return vec + 2.0 * cross( cross( vec, quat.xyz ) + quat.w * vec, quat.xyz );\n        }\n\n        float ease (float t) {\n          return 1.0 - pow(2.0, -10.0 * t);\n        }\n\n        // http://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/,\n        vec3 applyTRS( vec3 position, vec3 translation, vec4 quaternion, vec3 scale ) {\n        \tposition *= scale;\n        \tposition += 2.0 * cross( quaternion.xyz, cross( quaternion.xyz, position ) + quaternion.w * position );\n        \treturn position + translation;\n        }\n\n        void main () {\n          vUv = uv;\n          vec3 transformed = position.xyz;\n\n          vColor = instanceColor;\n          vec3 worldCenter = (modelMatrix * vec4(vec3(instancePosition), 1.0)).xyz;\n\n          float straighten = 1.0 - clamp(invLerp(minY, 1.0, worldCenter.y - spriteRadius), 0.0, 1.0);\n          vStraighten = straighten;\n\n          float timeOffset = instanceScaleAndTime.y;\n          float angle = 3.14 * sin(time + timeOffset + position.x);\n          transformed *= rotation3dY(angle * (1.0 - straighten));\n\n          vec3 transformedNormal = normal;\n          vec4 invQuat = vec4(-instanceRotation.xyz, instanceRotation.w);\n          float nAngle = (3.14 / -1.0 + 3.14 * sin(position.x)) * (1.0 - straighten);\n          transformedNormal = normalize(transformedNormal * rotation3dY(nAngle));\n          transformedNormal = normalize(rotate_vector(invQuat, transformedNormal));\n          transformedNormal = normalize(normalMatrix * transformedNormal);\n\n          vNormal = transformedNormal;\n\n          float dFromCenter = 1.0 - length(instancePosition.xz) / 20.0;\n          float disappear = 1.0 - min(1.0, ease(max(fadeAway - dFromCenter * 2.0, 0.0) / (4.0)));\n          transformed = applyTRS(transformed, instancePosition, instanceRotation, vec3(disappear * globalScale * instanceScaleAndTime.x));\n\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(transformed, 1.0);\n        }\n      ",fragmentShader:"\n        varying vec2 vUv;\n        varying float vStraighten;\n        varying vec3 vNormal;\n        varying vec3 vColor;\n        uniform sampler2D map;\n        uniform float opacity;\n        // uniform vec3 color;\n        void main () {\n          gl_FragColor = vec4(vColor, opacity) * texture2D(map, vUv);\n          // gl_FragColor.rgb *= 1.0 - (1.0 - (vNormal.y * 0.5 + 0.5)) * 0.25;\n          // gl_FragColor.rgb += (1.0 - (vNormal.y * 0.5 + 0.5)) * 1.0 * (1.0 - vStraighten);\n          float grad = (1.0 - (vNormal.y * 0.5 + 0.5));\n          gl_FragColor.rgb += (1.0 - vStraighten) * 0.25 + grad * 0.5;\n          if (!gl_FrontFacing) gl_FragColor.rgb *= 0.5;\n\n          // gl_FragColor = vec4(vec3((1.0-(vNormal.y * 0.5 + 0.5))), 1.0);\n          // gl_FragColor = vec4(vec3(vNormal.y * 0.5 + 0.5), 1.0);\n          if (gl_FragColor.a < 0.5) discard;\n        }\n      "})}({minY:.1,spriteRadius:.1,map:g,time:0,timeOffset:0,side:e.DoubleSide}),V=new e.Mesh(R,U);w.add(V),w.name="origin-tree-leaves",V.frustumCulled=!1;var j=15*Math.PI*15/1e4;const I=new e.Vector3(1,1,1),D=s.entity();D.add(t.Object3D,w);const Y=s.entity();let Q=0;return function(e){if(!s.findTag(t.AppState).ready)return;const o=s.findTag(t.CameraStopUserMovement);let a=!1;Y.has(t.UserHitAudioTrigger)&&(a=!0,(x+=e)>=A&&(a=!1,x%=A,A=b(),Y.remove(t.UserHitAudioTrigger)));const r=s.findTag(t.UserCharacter),i=s.findTag(t.UserTarget),c=r.position,m=r.velocity,p=m.lengthSq(),d=Math.sqrt(p),g=i.position.length(),h=1-n.clamp01(n.smoothstep(40,45,g));let S=!0;g>=45?(D.has(t.Object3D)&&D.remove(t.Object3D),S=!1):D.has(t.Object3D)||D.add(t.Object3D,w);let R=0;s.findTag(t.FinalBiomeResolution)?(Q+=e,U.uniforms.fadeAway.value=-2+Q):U.uniforms.fadeAway.value=0;for(let t=0;S&&t<T.length;t++){const r=T[t].body;if(!o&&p>1e-6){const t=r.position.distanceToSquared(c);if(t<=4){d>.05&&!a&&R++;const e=Math.sqrt(t);n.clamp01(e/2);r.velocity.x+=m.x*I.x,r.velocity.z+=m.z*I.z,r.position.y-.1<=.100001&&(r.position.y=.200001);const o=1-n.clamp01(n.inverseLerp(.1,1,r.position.y-.1));r.velocity.y+=l.range(0,1)*I.y*d*o,u.fromArray(l.insideSphere(1,v)),r.velocity.addScaledVector(u,l.range(.5,1))}}r.velocity.x=n.clamp(r.velocity.x,-4,4),r.velocity.y=n.clamp(r.velocity.y,-4,4),r.velocity.z=n.clamp(r.velocity.z,-4,4);let i=!1;if(r.position.y-.1<.1&&(i=!0,r.position.y=.200001),i){const t=r.velocity.lengthSq();if(t>1e-6){const e=Math.sqrt(t);f.set(1,-1,1);const n=.25;f.multiplyScalar(e*n),0!==e&&r.velocity.divideScalar(e),r.velocity.multiply(f)}}var q=r.velocity.x,z=r.velocity.y,O=r.velocity.z,N=-.235*j*1.22*q*q*q/Math.abs(q),P=-.235*j*1.22*z*z*z/Math.abs(z),B=-.235*j*1.22*O*O*O/Math.abs(O),H=(N=isNaN(N)?0:N)/.05,k=(P=isNaN(P)?0:P)/.05,L=(B=isNaN(B)?0:B)/.05;k+=.1*-9.81,r.velocity.x+=H*e,r.velocity.y+=k*e,r.velocity.z+=L*e;const s=r.speed;r.position.x+=r.velocity.x*e*s,r.position.y+=r.velocity.y*e*s,r.position.z+=r.velocity.z*e*s;const g=n.clamp(r.velocity.length()/.1,0,7.5),h=1-n.clamp01(n.inverseLerp(.1,.5,r.position.y-.1));y.setFromAxisAngle(r.rotationAxis,g*r.rotationSpeed*e),r.spinRotation.premultiply(y),r.spinRotation.slerp(r.flatRotation,.5*h),r.currentRotation.copy(r.spinRotation),C[3*t+0]=r.position.x,C[3*t+1]=r.position.y,C[3*t+2]=r.position.z,M[4*t+0]=r.currentRotation.x,M[4*t+1]=r.currentRotation.y,M[4*t+2]=r.currentRotation.z,M[4*t+3]=r.currentRotation.w}if(S&&(_.needsUpdate=!0,F.needsUpdate=!0,U.uniforms.time.value+=e,U.uniforms.globalScale.value=h),V.visible=S,R>5&&(a=!0,!Y.has(t.UserHitAudioTrigger))){Y.add(t.UserHitAudioTrigger),Y.get(t.UserHitAudioTrigger).type="leaf"}}}
},{"../tags":"injP","three":"IV0r","../util/math":"Ov1X","../util/Random":"LMfK","../util/Assets":"Wm90","../util/ShaderManager":"igLh","../util/array":"ibDZ","../util/query-string":"Bj6B","../util/resetPlayerPos":"quSS"}],"JVNI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=require("svelte"),n=require("svelte/store"),i=require("../nfb"),a=require("../animations/transitions"),o=u(require("../components/AnimatedTextSpan.svelte")),r=require("../util/locale"),s=u(require("../components/ImageButton.svelte")),d=require("../util/globalIntroVideo"),l=u(require("../util/objectFit"));function u(e){return e&&e.__esModule?e:{default:e}}const{window:c}=e.globals;function p(t){let n,i,o,r,s,d=t[5][t[1][0].key]+"";return{c(){n=(0,e.element)("div"),i=(0,e.text)(d),(0,e.attr)(n,"class","text-container svelte-qit7e6")},m(t,a){(0,e.insert)(t,n,a),(0,e.append)(n,i),s=!0},p(t,n){(!s||34&n)&&d!==(d=t[5][t[1][0].key]+"")&&(0,e.set_data)(i,d)},i(t){s||((0,e.add_render_callback)(()=>{r&&r.end(1),o||(o=(0,e.create_in_transition)(n,a.fadeInTransition,{duration:1e3,delay:0})),o.start()}),s=!0)},o(t){o&&o.invalidate(),r=(0,e.create_out_transition)(n,a.fadeInTransition,{duration:1e3,delay:0}),s=!1},d(t){t&&(0,e.detach)(n),t&&r&&r.end()}}}function _(t){let n,i,o,r,s,d=t[5][t[1][1].key]+"";return{c(){n=(0,e.element)("div"),i=(0,e.text)(d),(0,e.attr)(n,"class","text-container svelte-qit7e6")},m(t,a){(0,e.insert)(t,n,a),(0,e.append)(n,i),s=!0},p(t,n){(!s||34&n)&&d!==(d=t[5][t[1][1].key]+"")&&(0,e.set_data)(i,d)},i(t){s||((0,e.add_render_callback)(()=>{r&&r.end(1),o||(o=(0,e.create_in_transition)(n,a.fadeInTransition,{duration:1e3,delay:0})),o.start()}),s=!0)},o(t){o&&o.invalidate(),r=(0,e.create_out_transition)(n,a.fadeInTransition,{duration:1e3,delay:0}),s=!1},d(t){t&&(0,e.detach)(n),t&&r&&r.end()}}}function v(t){let n,i,o,r,s,d=t[5][t[1][2].key]+"";return{c(){n=(0,e.element)("div"),i=(0,e.text)(d),(0,e.attr)(n,"class","text-container svelte-qit7e6")},m(t,a){(0,e.insert)(t,n,a),(0,e.append)(n,i),s=!0},p(t,n){(!s||34&n)&&d!==(d=t[5][t[1][2].key]+"")&&(0,e.set_data)(i,d)},i(t){s||((0,e.add_render_callback)(()=>{r&&r.end(1),o||(o=(0,e.create_in_transition)(n,a.fadeInTransition,{duration:1e3,delay:0})),o.start()}),s=!0)},o(t){o&&o.invalidate(),r=(0,e.create_out_transition)(n,a.fadeInTransition,{duration:1e3,delay:0}),s=!1},d(t){t&&(0,e.detach)(n),t&&r&&r.end()}}}function m(t){let n,i;return{c(){n=(0,e.element)("div"),(0,e.attr)(n,"class","white-overlay svelte-qit7e6")},m(t,i){(0,e.insert)(t,n,i)},i(t){i||(0,e.add_render_callback)(()=>{(i=(0,e.create_in_transition)(n,a.fadeInTransition,{opacity:0,delay:0,duration:500,y:0})).start()})},o:e.noop,d(t){t&&(0,e.detach)(n)}}}function f(t){let n,i,o,r,d,l,u,f,y,h,b,g,k,q,T,x,$,w=t[1][0].visible&&p(t),I=t[1][1].visible&&_(t),V=t[1][2].visible&&v(t);(g=new s.default({props:{inTransition:(0,a.transition)(a.fadeInTransition,{delay:2500}),mode:"normal_small",text:t[5].skipButton}})).$on("click",t[13]);let A=t[2]&&m(t);return{c(){n=(0,e.element)("div"),i=(0,e.element)("div"),r=(0,e.space)(),d=(0,e.element)("div"),u=(0,e.space)(),w&&w.c(),f=(0,e.space)(),I&&I.c(),y=(0,e.space)(),V&&V.c(),h=(0,e.space)(),b=(0,e.element)("div"),(0,e.create_component)(g.$$.fragment),k=(0,e.space)(),A&&A.c(),(0,e.attr)(i,"class","black-overlay svelte-qit7e6"),(0,e.attr)(d,"class","intro-video-container svelte-qit7e6"),(0,e.attr)(b,"class","button-container svelte-qit7e6"),(0,e.attr)(n,"class","intro svelte-qit7e6")},m(a,o){(0,e.insert)(a,n,o),(0,e.append)(n,i),t[10](i),(0,e.append)(n,r),(0,e.append)(n,d),t[12](d),(0,e.append)(n,u),w&&w.m(n,null),(0,e.append)(n,f),I&&I.m(n,null),(0,e.append)(n,y),V&&V.m(n,null),(0,e.append)(n,h),(0,e.append)(n,b),(0,e.mount_component)(g,b,null),(0,e.append)(n,k),A&&A.m(n,null),T=!0,x||($=[(0,e.listen)(c,"resize",t[6],{passive:!0}),(0,e.listen)(i,"introend",t[11]),(0,e.listen)(n,"outrostart",t[14]),(0,e.listen)(n,"outroend",t[15])],x=!0)},p(t,[i]){t[1][0].visible?w?(w.p(t,i),2&i&&(0,e.transition_in)(w,1)):((w=p(t)).c(),(0,e.transition_in)(w,1),w.m(n,f)):w&&((0,e.group_outros)(),(0,e.transition_out)(w,1,1,()=>{w=null}),(0,e.check_outros)()),t[1][1].visible?I?(I.p(t,i),2&i&&(0,e.transition_in)(I,1)):((I=_(t)).c(),(0,e.transition_in)(I,1),I.m(n,y)):I&&((0,e.group_outros)(),(0,e.transition_out)(I,1,1,()=>{I=null}),(0,e.check_outros)()),t[1][2].visible?V?(V.p(t,i),2&i&&(0,e.transition_in)(V,1)):((V=v(t)).c(),(0,e.transition_in)(V,1),V.m(n,h)):V&&((0,e.group_outros)(),(0,e.transition_out)(V,1,1,()=>{V=null}),(0,e.check_outros)());const a={};32&i&&(a.text=t[5].skipButton),g.$set(a),t[2]?A?4&i&&(0,e.transition_in)(A,1):((A=m(t)).c(),(0,e.transition_in)(A,1),A.m(n,null)):A&&(A.d(1),A=null)},i(t){T||(o||(0,e.add_render_callback)(()=>{(o=(0,e.create_in_transition)(i,a.fadeInTransition,{delay:0,duration:1e3,y:0})).start()}),l||(0,e.add_render_callback)(()=>{(l=(0,e.create_in_transition)(d,a.fadeOpacityTransition,{delay:1e3,duration:500})).start()}),(0,e.transition_in)(w),(0,e.transition_in)(I),(0,e.transition_in)(V),(0,e.transition_in)(g.$$.fragment,t),(0,e.transition_in)(A),q&&q.end(1),T=!0)},o(t){(0,e.transition_out)(w),(0,e.transition_out)(I),(0,e.transition_out)(V),(0,e.transition_out)(g.$$.fragment,t),q=(0,e.create_out_transition)(n,a.fadeOpacityTransition,{delay:1250,duration:1500}),T=!1},d(i){i&&(0,e.detach)(n),t[10](null),t[12](null),w&&w.d(),I&&I.d(),V&&V.d(),(0,e.destroy_component)(g),A&&A.d(),i&&q&&q.end(),x=!1,(0,e.run_all)($)}}}let y=!1,h=0;function b(e){console.log("kill",e)}function g(n,a,o){let s;(0,e.component_subscribe)(n,r.localize,e=>o(5,s=e));let{store:u}=a,{delay:c=0}=a,{duration:p=33}=a;/(Android|iOS|iPad|iPod|iPhone)/i.test(navigator.userAgent);let _,v,m,f,y=[{visible:!1,key:"introVideoLine0",timestamp:2e3,delay:0,duration:4250},{visible:!1,key:"introVideoLine1",timestamp:14e3,duration:4500,delay:0},{visible:!1,key:"introVideoLine2",timestamp:23e3,duration:5e3,delay:0}],h=!1,b=u.subscribe(e=>{v=e.visible});function g(){window.innerWidth,window.innerHeight;const e=(0,d.hasVideo)()?(0,d.getVideo)():null;if(e){const[t,n,i,a]=(0,l.default)({parentWidth:window.innerWidth,parentHeight:window.innerHeight,childWidth:e.videoWidth,childHeight:e.videoHeight,fit:"cover"});Object.assign(e.style,{left:`${t}px`,top:`${n}px`,width:`${i}px`,height:`${a}px`})}}function k(){o(2,h=!0),(0,d.pauseVideo)(),clearTimeout(m),u.update(e=>({...e,visible:!1}))}y.forEach((e,t)=>{setTimeout(()=>{o(1,y[t].visible=!0,y),o(1,y),setTimeout(()=>{o(1,y[t].visible=!1,y),o(1,y)},e.duration)},e.timestamp)}),(0,t.onMount)(()=>{if(_){const e=(0,d.getVideo)();_.appendChild(e),e.style.visibility="",(0,d.getMetadata)().then(()=>{g()})}return m=setTimeout(()=>{(0,i.sendAnalytics)({event:"intro_finish",eventLabel:"finish"}),k()},1e3*p),()=>{b(),(0,d.unmountVideo)(),clearTimeout(void 0),clearTimeout(m)}});return n.$$set=(e=>{"store"in e&&o(0,u=e.store),"delay"in e&&o(8,c=e.delay),"duration"in e&&o(9,p=e.duration)}),[u,y,h,_,f,s,function(){if(!(0,d.hasVideo)())return;(0,d.getVideo)().readyState<=0?(0,d.getMetadata)().then(()=>g()):g()},k,c,p,function(t){e.binding_callbacks[t?"unshift":"push"](()=>{o(4,f=t)})},()=>u.update(e=>({...e,covering:!0})),function(t){e.binding_callbacks[t?"unshift":"push"](()=>{o(3,_=t)})},()=>{(0,i.sendAnalytics)({event:"intro_skip",eventLabel:"skip"}),k()},()=>u.update(e=>({...e,covering:!1})),()=>u.update(e=>({...e,finished:!0}))]}class k extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,g,f,e.safe_not_equal,{store:0,delay:8,duration:9})}}var q=k;exports.default=q;
},{"svelte/internal":"xeIE","svelte":"XHT5","svelte/store":"nBdo","../nfb":"Xlf9","../animations/transitions":"bvJy","../components/AnimatedTextSpan.svelte":"FmP3","../util/locale":"dkeN","../components/ImageButton.svelte":"HO9o","../util/globalIntroVideo":"M4mV","../util/objectFit":"Z2Ty"}],"ZGAK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=v;var e=p(require("../tags")),t=p(require("three")),r=p(require("../util/math")),n=O(require("../util/Random")),a=O(require("../util/Assets")),i=p(require("../util/ShaderManager")),o=require("../util/array"),u=O(require("../util/query-string")),s=p(require("../util/resetPlayerPos")),f=O(require("../overlays/OriginTreeIntroOverlay.svelte")),g=require("./AnimationSystem"),d=require("svelte/store"),l=require("../nfb");function O(e){return e&&e.__esModule?e:{default:e}}function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}function p(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=a?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}function v(t){const r=t.entity(),n=t.listen(e.GameStarted);if(u.default.nointroseq||u.default.nolanding)r.tagOn(e.CanSetIntroTags);else{const n=t.findEntity(e.ActiveEnvironmentState);if(n){const r=n.get(e.EnvironmentState);(0,s.setPlayerPos)(t,r.idleViewPoint)}r.add(e.OriginTreeIntroSequence),r.add(e.GameLandingCameraDrift),r.tagOn(e.CameraZoomOut),r.tagOn(e.HideCharacter),r.tagOn(e.LetterboxBars),r.tagOn(e.HideHUD),r.tagOn(e.BlockUserMove),r.tagOn(e.CameraStopUserMovement),r.tagOn(e.ModalStoppingUserMovement),r.tagOn(e.ClearInputPress)}t.view(e.ScreenFade);const a=(0,d.writable)({finished:!1,covering:!1,visible:!1}),i=t.findTag(e.AppState);a.subscribe(t=>{t.covering?i.running=!1:i.running=!0,!t.visible&&r.has(e.ViewLayer)&&(r.remove(e.ViewLayer),i.running=!0,r.tagOn(e.CanSetIntroTags),r.tagOff(e.HideHUD),r.tagOff(e.OriginTreeIntroSequence),r.tagOff(e.CameraStopUserMovement),r.tagOff(e.OriginTreeIntroSequenceStarted),r.tagOff(e.GameLandingCameraDrift),r.tagOn(e.ClearInputPress)),t.finished&&(r.tagOff(e.HideCharacter),r.tagOff(e.CameraZoomOut),r.tagOff(e.LetterboxBars),r.tagOff(e.BlockUserMove),r.tagOff(e.CameraStopUserMovement),r.tagOff(e.ModalStoppingUserMovement),r.tagOn(e.ClearInputPress),r.tagOn(e.AnimateInCharacter),(0,l.sendAnalytics)({event:"playing",eventLabel:"playing"}))});return function(i){t.findTag(e.CameraStopUserMovement);t.findTag(e.AppState).ready&&r.has(e.OriginTreeIntroSequence)&&n.changed&&n.added.length>0&&((0,l.hideHeader)(),r.add(e.OriginTreeIntroSequenceStarted),r.add(e.ViewLayer,{component:f.default,id:"origin-tree-intro-overlay",props:{delay:1250,store:a}}),a.update(e=>({...e,visible:!0})))}}
},{"../tags":"injP","three":"IV0r","../util/math":"Ov1X","../util/Random":"LMfK","../util/Assets":"Wm90","../util/ShaderManager":"igLh","../util/array":"ibDZ","../util/query-string":"Bj6B","../util/resetPlayerPos":"quSS","../overlays/OriginTreeIntroOverlay.svelte":"JVNI","./AnimationSystem":"cUmx","svelte/store":"nBdo","../nfb":"Xlf9"}],"V4p7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=d;var e=f(require("../tags")),t=f(require("three")),r=u(require("../util/resetPlayerPos")),n=require("./AnimationSystem"),i=u(require("./writing/Line3D")),o=require("../util/locale"),a=u(require("../util/Assets")),l=u(require("../util/query-string"));function u(e){return e&&e.__esModule?e:{default:e}}function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}function d(r){const n=r.entity();/(iOS|Android|iPhone|iPad)/i.test(navigator.userAgent);let i=!1,a=!1,u=!1;let s=0,f=!1,d=!1,c=!1;const g=new t.Vector3,p=r.view(e.TutorialMessage),O=r.listen(e.FinishedPoem);r.listen(e.DirectUserToOrigin),r.listen(e.HaikuCardSaved);const T=(t={})=>r.entity().add(e.TutorialMessage,t);return l.default.resolve&&(c=!0),t=>{const y=r.findTag(e.UserTarget),v=y.position,m=r.findTag(e.CanSetIntroTags);!a&&m&&(a=!0,r.findTag(e.UserTarget).position.set(0,0,0),n.tagOn(e.BlockTokenCollection),n.tagOn(e.TutorialState),n.tagOn(e.CameraZoomOut),n.tagOn(e.TutorialBarrenGround),n.tagOn(e.ClearInputPress));const P=r.findTag(e.GameStarted)&&m&&!r.findTag(e.OriginTreeIntroSequence);if(!i&&P&&(i=!0,u=!0),u&&(s+=t)>=2&&(s=0,u=!1,f=!0,c||T({id:"tap-to-move",message:o.localize.get().tutorialTapHold,iconMode:"finger",delay:1})),f&&y.forceApplied&&(n.tagOff(e.CameraZoomOut),f=!1,d=!0),d){(y.position.lengthSq()>=100||l.default.resolve)&&(d=!1,n.tagOff(e.TutorialBarrenGround),n.tagOff(e.TutorialState),n.tagOff(e.BlockTokenCollection),g.copy(v),c||T({id:"find-token",message:o.localize.get().tutorialCollect,iconMode:"token-random",delay:3,duration:6}))}O.changed&&(c=!0,p.forEach(e=>e.kill()))}}
},{"../tags":"injP","three":"IV0r","../util/resetPlayerPos":"quSS","./AnimationSystem":"cUmx","./writing/Line3D":"OoyW","../util/locale":"dkeN","../util/Assets":"Wm90","../util/query-string":"Bj6B"}],"O7ht":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=a(require("eases")),i=require("svelte/transition");function a(e){return e&&e.__esModule?e:{default:e}}function n(t){let a,n,r,s,l,d;return{c(){a=(0,e.element)("div"),r=(0,e.space)(),s=(0,e.element)("div"),(0,e.attr)(a,"class","letterbox top svelte-1ui17ha"),(0,e.set_style)(a,"height",t[2]+"px"),(0,e.attr)(s,"class","letterbox bottom svelte-1ui17ha"),(0,e.set_style)(s,"height",t[2]+"px")},m(t,i){(0,e.insert)(t,a,i),(0,e.insert)(t,r,i),(0,e.insert)(t,s,i),d=!0},p(i,[n]){t=i,(!d||4&n)&&(0,e.set_style)(a,"height",t[2]+"px"),(!d||4&n)&&(0,e.set_style)(s,"height",t[2]+"px")},i(r){d||((0,e.add_render_callback)(()=>{n||(n=(0,e.create_bidirectional_transition)(a,i.fly,{delay:t[1],easing:t[3],duration:t[0],y:-t[2],opacity:1},!0)),n.run(1)}),(0,e.add_render_callback)(()=>{l||(l=(0,e.create_bidirectional_transition)(s,i.fly,{delay:t[1],easing:t[3],duration:t[0],y:t[2],opacity:1},!0)),l.run(1)}),d=!0)},o(r){n||(n=(0,e.create_bidirectional_transition)(a,i.fly,{delay:t[1],easing:t[3],duration:t[0],y:-t[2],opacity:1},!1)),n.run(0),l||(l=(0,e.create_bidirectional_transition)(s,i.fly,{delay:t[1],easing:t[3],duration:t[0],y:t[2],opacity:1},!1)),l.run(0),d=!1},d(t){t&&(0,e.detach)(a),t&&n&&n.end(),t&&(0,e.detach)(r),t&&(0,e.detach)(s),t&&l&&l.end()}}}function r(e,i,a){let{duration:n=1e3}=i,{delay:r=0}=i,{height:s=12.5}=i,{easing:l=t.default.quartOut}=i;return e.$$set=(e=>{"duration"in e&&a(0,n=e.duration),"delay"in e&&a(1,r=e.delay),"height"in e&&a(2,s=e.height),"easing"in e&&a(3,l=e.easing)}),[n,r,s,l]}class s extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,r,n,e.safe_not_equal,{duration:0,delay:1,height:2,easing:3})}}var l=s;exports.default=l;
},{"svelte/internal":"xeIE","eases":"uiPX","svelte/transition":"ly0Q"}],"FvUK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=a(require("../tags")),t=a(require("three")),r=n(require("../overlays/LetterboxBarsOverlay.svelte"));function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function a(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var f=a?Object.getOwnPropertyDescriptor(e,u):null;f&&(f.get||f.set)?Object.defineProperty(n,u,f):n[u]=e[u]}return n.default=e,r&&r.set(e,n),n}function u(t){const r=t.entity(),n=t.view(e.LetterboxBars);return o=>{t.findTag(e.ShowBiomeResolution)?r.tagOn(e.LetterboxBars):r.tagOff(e.LetterboxBars),n.length>0?(r.tagOn(e.CameraZoomOut),r.has(e.ViewLayer)):(r.tagOff(e.CameraZoomOut),r.remove(e.ViewLayer))}}
},{"../tags":"injP","three":"IV0r","../overlays/LetterboxBarsOverlay.svelte":"O7ht"}],"MP78":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=l;var e=o(require("../tags")),t=o(require("three")),n=require("../util/water-util"),r=i(require("../util/Random"));function i(e){return e&&e.__esModule?e:{default:e}}function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=i?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(r,o,l):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}function l(i){let a=0;const o={forest:["bird"],grasslands:["seal","butterfly","owl"],tundra:["jumpingrabbit"]},l=(0,r.default)(),u=()=>l.range(5,5);let c=u();const f=i.view(e.ActiveEnvironmentState),s=new t.Vector3,d=[0,0],p=(i.view(e.Animal),i.view(e.AnimalSpawn)),g=i.findTag(e.EnvironmentUnderPlayerState),m=i.findTag(e.UserTarget);let w=null;return r=>{const y=f.length?f[0].get(e.EnvironmentState):null,v=y&&y.name;if(!v||!o[v].length)return;let b=g.water;const S=i.findTag(e.GameLandingCameraDrift),O=!w||m.position.distanceToSquared(w)>=16;if(!b&&!S&&O&&(a+=r)>=c&&(a%=c,c=u(),w||(w=new t.Vector3),w.copy(m.position),!i.findTag(e.TutorialState))){let t,r=!1,a=!1;if(s.copy(m.position).addScaledVector(m.direction,25),d[0]=s.x,d[1]=s.z,r=!0,s.x*s.x+s.z*s.z<225&&(r=!1),r&&(0,n.insideWaterPolys)(y,d)&&(r=!1),r&&(t=l.pick(o[v])),r&&t){console.log("Spawning animals!",t,a);const n=i.entity();n.add(e.AnimalSpawn);const r=n.get(e.AnimalSpawn);r.position.copy(s),r.lake=a,r.biome=v,r.animal=t}}p.forEach(t=>{const n=t.get(e.AnimalSpawn);n.time+=r,n.time>=n.duration&&t.kill()})}}
},{"../tags":"injP","three":"IV0r","../util/water-util":"j8Gj","../util/Random":"LMfK"}],"tMTn":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var n={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},e={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},t=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],r={CSS:{},springs:{}};function a(n,e,t){return Math.min(Math.max(n,e),t)}function u(n,e){return n.indexOf(e)>-1}function o(n,e){return n.apply(null,e)}var i={arr:function(n){return Array.isArray(n)},obj:function(n){return u(Object.prototype.toString.call(n),"Object")},pth:function(n){return i.obj(n)&&n.hasOwnProperty("totalLength")},svg:function(n){return n instanceof SVGElement},inp:function(n){return n instanceof HTMLInputElement},dom:function(n){return n.nodeType||i.svg(n)},str:function(n){return"string"==typeof n},fnc:function(n){return"function"==typeof n},und:function(n){return void 0===n},nil:function(n){return i.und(n)||null===n},hex:function(n){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n)},rgb:function(n){return/^rgb/.test(n)},hsl:function(n){return/^hsl/.test(n)},col:function(n){return i.hex(n)||i.rgb(n)||i.hsl(n)},key:function(t){return!n.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&"targets"!==t&&"keyframes"!==t}};function c(n){var e=/\(([^)]+)\)/.exec(n);return e?e[1].split(",").map(function(n){return parseFloat(n)}):[]}function s(n,e){var t=c(n),u=a(i.und(t[0])?1:t[0],.1,100),o=a(i.und(t[1])?100:t[1],.1,100),s=a(i.und(t[2])?10:t[2],.1,100),f=a(i.und(t[3])?0:t[3],.1,100),l=Math.sqrt(o/u),d=s/(2*Math.sqrt(o*u)),p=d<1?l*Math.sqrt(1-d*d):0,v=1,h=d<1?(d*l-f)/p:-f+l;function g(n){var t=e?e*n/1e3:n;return t=d<1?Math.exp(-t*d*l)*(v*Math.cos(p*t)+h*Math.sin(p*t)):(v+h*t)*Math.exp(-t*l),0===n||1===n?n:1-t}return e?g:function(){var e=r.springs[n];if(e)return e;for(var t=0,a=0;;)if(1===g(t+=1/6)){if(++a>=16)break}else a=0;var u=t*(1/6)*1e3;return r.springs[n]=u,u}}function f(n){return void 0===n&&(n=10),function(e){return Math.ceil(a(e,1e-6,1)*n)*(1/n)}}var l=function(){var n=11,e=1/(n-1);function t(n,e){return 1-3*e+3*n}function r(n,e){return 3*e-6*n}function a(n){return 3*n}function u(n,e,u){return((t(e,u)*n+r(e,u))*n+a(e))*n}function o(n,e,u){return 3*t(e,u)*n*n+2*r(e,u)*n+a(e)}return function(t,r,a,i){if(0<=t&&t<=1&&0<=a&&a<=1){var c=new Float32Array(n);if(t!==r||a!==i)for(var s=0;s<n;++s)c[s]=u(s*e,t,a);return function(n){return t===r&&a===i?n:0===n||1===n?n:u(f(n),r,i)}}function f(r){for(var i=0,s=1,f=n-1;s!==f&&c[s]<=r;++s)i+=e;var l=i+(r-c[--s])/(c[s+1]-c[s])*e,d=o(l,t,a);return d>=.001?function(n,e,t,r){for(var a=0;a<4;++a){var i=o(e,t,r);if(0===i)return e;e-=(u(e,t,r)-n)/i}return e}(r,l,t,a):0===d?l:function(n,e,t,r,a){var o,i,c=0;do{(o=u(i=e+(t-e)/2,r,a)-n)>0?t=i:e=i}while(Math.abs(o)>1e-7&&++c<10);return i}(r,i,i+e,t,a)}}}(),d=function(){var n={linear:function(){return function(n){return n}}},e={Sine:function(){return function(n){return 1-Math.cos(n*Math.PI/2)}},Circ:function(){return function(n){return 1-Math.sqrt(1-n*n)}},Back:function(){return function(n){return n*n*(3*n-2)}},Bounce:function(){return function(n){for(var e,t=4;n<((e=Math.pow(2,--t))-1)/11;);return 1/Math.pow(4,3-t)-7.5625*Math.pow((3*e-2)/22-n,2)}},Elastic:function(n,e){void 0===n&&(n=1),void 0===e&&(e=.5);var t=a(n,1,10),r=a(e,.1,2);return function(n){return 0===n||1===n?n:-t*Math.pow(2,10*(n-1))*Math.sin((n-1-r/(2*Math.PI)*Math.asin(1/t))*(2*Math.PI)/r)}}};return["Quad","Cubic","Quart","Quint","Expo"].forEach(function(n,t){e[n]=function(){return function(n){return Math.pow(n,t+2)}}}),Object.keys(e).forEach(function(t){var r=e[t];n["easeIn"+t]=r,n["easeOut"+t]=function(n,e){return function(t){return 1-r(n,e)(1-t)}},n["easeInOut"+t]=function(n,e){return function(t){return t<.5?r(n,e)(2*t)/2:1-r(n,e)(-2*t+2)/2}},n["easeOutIn"+t]=function(n,e){return function(t){return t<.5?(1-r(n,e)(1-2*t))/2:(r(n,e)(2*t-1)+1)/2}}}),n}();function p(n,e){if(i.fnc(n))return n;var t=n.split("(")[0],r=d[t],a=c(n);switch(t){case"spring":return s(n,e);case"cubicBezier":return o(l,a);case"steps":return o(f,a);default:return o(r,a)}}function v(n){try{return document.querySelectorAll(n)}catch(e){return}}function h(n,e){for(var t=n.length,r=arguments.length>=2?arguments[1]:void 0,a=[],u=0;u<t;u++)if(u in n){var o=n[u];e.call(r,o,u,n)&&a.push(o)}return a}function g(n){return n.reduce(function(n,e){return n.concat(i.arr(e)?g(e):e)},[])}function m(n){return i.arr(n)?n:(i.str(n)&&(n=v(n)||n),n instanceof NodeList||n instanceof HTMLCollection?[].slice.call(n):[n])}function y(n,e){return n.some(function(n){return n===e})}function b(n){var e={};for(var t in n)e[t]=n[t];return e}function M(n,e){var t=b(n);for(var r in n)t[r]=e.hasOwnProperty(r)?e[r]:n[r];return t}function x(n,e){var t=b(n);for(var r in e)t[r]=i.und(n[r])?e[r]:n[r];return t}function w(n){var e=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(n);return e?"rgba("+e[1]+",1)":n}function O(n){var e=n.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(n,e,t,r){return e+e+t+t+r+r}),t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return"rgba("+parseInt(t[1],16)+","+parseInt(t[2],16)+","+parseInt(t[3],16)+",1)"}function k(n){var e,t,r,a=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(n)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(n),u=parseInt(a[1],10)/360,o=parseInt(a[2],10)/100,i=parseInt(a[3],10)/100,c=a[4]||1;function s(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+(e-n)*(2/3-t)*6:n}if(0==o)e=t=r=i;else{var f=i<.5?i*(1+o):i+o-i*o,l=2*i-f;e=s(l,f,u+1/3),t=s(l,f,u),r=s(l,f,u-1/3)}return"rgba("+255*e+","+255*t+","+255*r+","+c+")"}function P(n){return i.rgb(n)?w(n):i.hex(n)?O(n):i.hsl(n)?k(n):void 0}function C(n){var e=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(n);if(e)return e[1]}function I(n){return u(n,"translate")||"perspective"===n?"px":u(n,"rotate")||u(n,"skew")?"deg":void 0}function D(n,e){return i.fnc(n)?n(e.target,e.id,e.total):n}function B(n,e){return n.getAttribute(e)}function T(n,e,t){if(y([t,"deg","rad","turn"],C(e)))return e;var a=r.CSS[e+t];if(!i.und(a))return a;var u=document.createElement(n.tagName),o=n.parentNode&&n.parentNode!==document?n.parentNode:document.body;o.appendChild(u),u.style.position="absolute",u.style.width=100+t;var c=100/u.offsetWidth;o.removeChild(u);var s=c*parseFloat(e);return r.CSS[e+t]=s,s}function E(n,e,t){if(e in n.style){var r=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),a=n.style[e]||getComputedStyle(n).getPropertyValue(r)||"0";return t?T(n,a,t):a}}function F(n,e){return i.dom(n)&&!i.inp(n)&&(!i.nil(B(n,e))||i.svg(n)&&n[e])?"attribute":i.dom(n)&&y(t,e)?"transform":i.dom(n)&&"transform"!==e&&E(n,e)?"css":null!=n[e]?"object":void 0}function A(n){if(i.dom(n)){for(var e,t=n.style.transform||"",r=/(\w+)\(([^)]*)\)/g,a=new Map;e=r.exec(t);)a.set(e[1],e[2]);return a}}function N(n,e,t,r){var a=u(e,"scale")?1:0+I(e),o=A(n).get(e)||a;return t&&(t.transforms.list.set(e,o),t.transforms.last=e),r?T(n,o,r):o}function S(n,e,t,r){switch(F(n,e)){case"transform":return N(n,e,r,t);case"css":return E(n,e,t);case"attribute":return B(n,e);default:return n[e]||0}}function L(n,e){var t=/^(\*=|\+=|-=)/.exec(n);if(!t)return n;var r=C(n)||0,a=parseFloat(e),u=parseFloat(n.replace(t[0],""));switch(t[0][0]){case"+":return a+u+r;case"-":return a-u+r;case"*":return a*u+r}}function j(n,e){if(i.col(n))return P(n);if(/\s/g.test(n))return n;var t=C(n),r=t?n.substr(0,n.length-t.length):n;return e?r+e:r}function q(n,e){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function H(n){return 2*Math.PI*B(n,"r")}function V(n){return 2*B(n,"width")+2*B(n,"height")}function $(n){return q({x:B(n,"x1"),y:B(n,"y1")},{x:B(n,"x2"),y:B(n,"y2")})}function W(n){for(var e,t=n.points,r=0,a=0;a<t.numberOfItems;a++){var u=t.getItem(a);a>0&&(r+=q(e,u)),e=u}return r}function X(n){var e=n.points;return W(n)+q(e.getItem(e.numberOfItems-1),e.getItem(0))}function Y(n){if(n.getTotalLength)return n.getTotalLength();switch(n.tagName.toLowerCase()){case"circle":return H(n);case"rect":return V(n);case"line":return $(n);case"polyline":return W(n);case"polygon":return X(n)}}function Z(n){var e=Y(n);return n.setAttribute("stroke-dasharray",e),e}function _(n){for(var e=n.parentNode;i.svg(e)&&i.svg(e.parentNode);)e=e.parentNode;return e}function G(n,e){var t=e||{},r=t.el||_(n),a=r.getBoundingClientRect(),u=B(r,"viewBox"),o=a.width,i=a.height,c=t.viewBox||(u?u.split(" "):[0,0,o,i]);return{el:r,viewBox:c,x:c[0]/1,y:c[1]/1,w:o,h:i,vW:c[2],vH:c[3]}}function Q(n,e){var t=i.str(n)?v(n)[0]:n,r=e||100;return function(n){return{property:n,el:t,svg:G(t),totalLength:Y(t)*(r/100)}}}function z(n,e,t){function r(t){void 0===t&&(t=0);var r=e+t>=1?e+t:0;return n.el.getPointAtLength(r)}var a=G(n.el,n.svg),u=r(),o=r(-1),i=r(1),c=t?1:a.w/a.vW,s=t?1:a.h/a.vH;switch(n.property){case"x":return(u.x-a.x)*c;case"y":return(u.y-a.y)*s;case"angle":return 180*Math.atan2(i.y-o.y,i.x-o.x)/Math.PI}}function R(n,e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=j(i.pth(n)?n.totalLength:n,e)+"";return{original:r,numbers:r.match(t)?r.match(t).map(Number):[0],strings:i.str(n)||e?r.split(t):[]}}function J(n){return h(n?g(i.arr(n)?n.map(m):m(n)):[],function(n,e,t){return t.indexOf(n)===e})}function K(n){var e=J(n);return e.map(function(n,t){return{target:n,id:t,total:e.length,transforms:{list:A(n)}}})}function U(n,e){var t=b(e);if(/^spring/.test(t.easing)&&(t.duration=s(t.easing)),i.arr(n)){var r=n.length;2===r&&!i.obj(n[0])?n={value:n}:i.fnc(e.duration)||(t.duration=e.duration/r)}var a=i.arr(n)?n:[n];return a.map(function(n,t){var r=i.obj(n)&&!i.pth(n)?n:{value:n};return i.und(r.delay)&&(r.delay=t?0:e.delay),i.und(r.endDelay)&&(r.endDelay=t===a.length-1?e.endDelay:0),r}).map(function(n){return x(n,t)})}function nn(n){for(var e=h(g(n.map(function(n){return Object.keys(n)})),function(n){return i.key(n)}).reduce(function(n,e){return n.indexOf(e)<0&&n.push(e),n},[]),t={},r=function(r){var a=e[r];t[a]=n.map(function(n){var e={};for(var t in n)i.key(t)?t==a&&(e.value=n[t]):e[t]=n[t];return e})},a=0;a<e.length;a++)r(a);return t}function en(n,e){var t=[],r=e.keyframes;for(var a in r&&(e=x(nn(r),e)),e)i.key(a)&&t.push({name:a,tweens:U(e[a],n)});return t}function tn(n,e){var t={};for(var r in n){var a=D(n[r],e);i.arr(a)&&1===(a=a.map(function(n){return D(n,e)})).length&&(a=a[0]),t[r]=a}return t.duration=parseFloat(t.duration),t.delay=parseFloat(t.delay),t}function rn(n,e){var t;return n.tweens.map(function(r){var a=tn(r,e),u=a.value,o=i.arr(u)?u[1]:u,c=C(o),s=S(e.target,n.name,c,e),f=t?t.to.original:s,l=i.arr(u)?u[0]:f,d=C(l)||C(s),v=c||d;return i.und(o)&&(o=f),a.from=R(l,v),a.to=R(L(o,l),v),a.start=t?t.end:0,a.end=a.start+a.delay+a.duration+a.endDelay,a.easing=p(a.easing,a.duration),a.isPath=i.pth(u),a.isPathTargetInsideSVG=a.isPath&&i.svg(e.target),a.isColor=i.col(a.from.original),a.isColor&&(a.round=1),t=a,a})}var an={css:function(n,e,t){return n.style[e]=t},attribute:function(n,e,t){return n.setAttribute(e,t)},object:function(n,e,t){return n[e]=t},transform:function(n,e,t,r,a){if(r.list.set(e,t),e===r.last||a){var u="";r.list.forEach(function(n,e){u+=e+"("+n+") "}),n.style.transform=u}}};function un(n,e){K(n).forEach(function(n){for(var t in e){var r=D(e[t],n),a=n.target,u=C(r),o=S(a,t,u,n),i=L(j(r,u||C(o)),o),c=F(a,t);an[c](a,t,i,n.transforms,!0)}})}function on(n,e){var t=F(n.target,e.name);if(t){var r=rn(e,n),a=r[r.length-1];return{type:t,property:e.name,animatable:n,tweens:r,duration:a.end,delay:r[0].delay,endDelay:a.endDelay}}}function cn(n,e){return h(g(n.map(function(n){return e.map(function(e){return on(n,e)})})),function(n){return!i.und(n)})}function sn(n,e){var t=n.length,r=function(n){return n.timelineOffset?n.timelineOffset:0},a={};return a.duration=t?Math.max.apply(Math,n.map(function(n){return r(n)+n.duration})):e.duration,a.delay=t?Math.min.apply(Math,n.map(function(n){return r(n)+n.delay})):e.delay,a.endDelay=t?a.duration-Math.max.apply(Math,n.map(function(n){return r(n)+n.duration-n.endDelay})):e.endDelay,a}var fn=0;function ln(t){var r=M(n,t),a=M(e,t),u=en(a,t),o=K(t.targets),i=cn(o,u),c=sn(i,a),s=fn;return fn++,x(r,{id:s,children:[],animatables:o,animations:i,duration:c.duration,delay:c.delay,endDelay:c.endDelay})}var dn=[],pn=function(){var n;function e(t){for(var r=dn.length,a=0;a<r;){var u=dn[a];u.paused?(dn.splice(a,1),r--):(u.tick(t),a++)}n=a>0?requestAnimationFrame(e):void 0}return"undefined"!=typeof document&&document.addEventListener("visibilitychange",function(){hn.suspendWhenDocumentHidden&&(vn()?n=cancelAnimationFrame(n):(dn.forEach(function(n){return n._onDocumentVisibility()}),pn()))}),function(){n||vn()&&hn.suspendWhenDocumentHidden||!(dn.length>0)||(n=requestAnimationFrame(e))}}();function vn(){return!!document&&document.hidden}function hn(n){void 0===n&&(n={});var e,t=0,r=0,u=0,o=0,i=null;function c(n){var e=window.Promise&&new Promise(function(n){return i=n});return n.finished=e,e}var s=ln(n);c(s);function f(){var n=s.direction;"alternate"!==n&&(s.direction="normal"!==n?"normal":"reverse"),s.reversed=!s.reversed,e.forEach(function(n){return n.reversed=s.reversed})}function l(n){return s.reversed?s.duration-n:n}function d(){t=0,r=l(s.currentTime)*(1/hn.speed)}function p(n,e){e&&e.seek(n-e.timelineOffset)}function v(n){for(var e=0,t=s.animations,r=t.length;e<r;){var u=t[e],o=u.animatable,i=u.tweens,c=i.length-1,f=i[c];c&&(f=h(i,function(e){return n<e.end})[0]||f);for(var l=a(n-f.start-f.delay,0,f.duration)/f.duration,d=isNaN(l)?1:f.easing(l),p=f.to.strings,v=f.round,g=[],m=f.to.numbers.length,y=void 0,b=0;b<m;b++){var M=void 0,x=f.to.numbers[b],w=f.from.numbers[b]||0;M=f.isPath?z(f.value,d*x,f.isPathTargetInsideSVG):w+d*(x-w),v&&(f.isColor&&b>2||(M=Math.round(M*v)/v)),g.push(M)}var O=p.length;if(O){y=p[0];for(var k=0;k<O;k++){p[k];var P=p[k+1],C=g[k];isNaN(C)||(y+=P?C+P:C+" ")}}else y=g[0];an[u.type](o.target,u.property,y,o.transforms),u.currentValue=y,e++}}function g(n){s[n]&&!s.passThrough&&s[n](s)}function m(n){var d=s.duration,h=s.delay,m=d-s.endDelay,y=l(n);s.progress=a(y/d*100,0,100),s.reversePlayback=y<s.currentTime,e&&function(n){if(s.reversePlayback)for(var t=o;t--;)p(n,e[t]);else for(var r=0;r<o;r++)p(n,e[r])}(y),!s.began&&s.currentTime>0&&(s.began=!0,g("begin")),!s.loopBegan&&s.currentTime>0&&(s.loopBegan=!0,g("loopBegin")),y<=h&&0!==s.currentTime&&v(0),(y>=m&&s.currentTime!==d||!d)&&v(d),y>h&&y<m?(s.changeBegan||(s.changeBegan=!0,s.changeCompleted=!1,g("changeBegin")),g("change"),v(y)):s.changeBegan&&(s.changeCompleted=!0,s.changeBegan=!1,g("changeComplete")),s.currentTime=a(y,0,d),s.began&&g("update"),n>=d&&(r=0,s.remaining&&!0!==s.remaining&&s.remaining--,s.remaining?(t=u,g("loopComplete"),s.loopBegan=!1,"alternate"===s.direction&&f()):(s.paused=!0,s.completed||(s.completed=!0,g("loopComplete"),g("complete"),!s.passThrough&&"Promise"in window&&(i(),c(s)))))}return s.reset=function(){var n=s.direction;s.passThrough=!1,s.currentTime=0,s.progress=0,s.paused=!0,s.began=!1,s.loopBegan=!1,s.changeBegan=!1,s.completed=!1,s.changeCompleted=!1,s.reversePlayback=!1,s.reversed="reverse"===n,s.remaining=s.loop,e=s.children;for(var t=o=e.length;t--;)s.children[t].reset();(s.reversed&&!0!==s.loop||"alternate"===n&&1===s.loop)&&s.remaining++,v(s.reversed?s.duration:0)},s._onDocumentVisibility=d,s.set=function(n,e){return un(n,e),s},s.tick=function(n){u=n,t||(t=u),m((u+(r-t))*hn.speed)},s.seek=function(n){m(l(n))},s.pause=function(){s.paused=!0,d()},s.play=function(){s.paused&&(s.completed&&s.reset(),s.paused=!1,dn.push(s),d(),pn())},s.reverse=function(){f(),s.completed=!s.reversed,d()},s.restart=function(){s.reset(),s.play()},s.remove=function(n){mn(J(n),s)},s.reset(),s.autoplay&&s.play(),s}function gn(n,e){for(var t=e.length;t--;)y(n,e[t].animatable.target)&&e.splice(t,1)}function mn(n,e){var t=e.animations,r=e.children;gn(n,t);for(var a=r.length;a--;){var u=r[a],o=u.animations;gn(n,o),o.length||u.children.length||r.splice(a,1)}t.length||r.length||e.pause()}function yn(n){for(var e=J(n),t=dn.length;t--;){mn(e,dn[t])}}function bn(n,e){void 0===e&&(e={});var t=e.direction||"normal",r=e.easing?p(e.easing):null,a=e.grid,u=e.axis,o=e.from||0,c="first"===o,s="center"===o,f="last"===o,l=i.arr(n),d=l?parseFloat(n[0]):parseFloat(n),v=l?parseFloat(n[1]):0,h=C(l?n[1]:n)||0,g=e.start||0+(l?d:0),m=[],y=0;return function(n,e,i){if(c&&(o=0),s&&(o=(i-1)/2),f&&(o=i-1),!m.length){for(var p=0;p<i;p++){if(a){var b=s?(a[0]-1)/2:o%a[0],M=s?(a[1]-1)/2:Math.floor(o/a[0]),x=b-p%a[0],w=M-Math.floor(p/a[0]),O=Math.sqrt(x*x+w*w);"x"===u&&(O=-x),"y"===u&&(O=-w),m.push(O)}else m.push(Math.abs(o-p));y=Math.max.apply(Math,m)}r&&(m=m.map(function(n){return r(n/y)*y})),"reverse"===t&&(m=m.map(function(n){return u?n<0?-1*n:-n:Math.abs(y-n)}))}return g+(l?(v-d)/y:d)*(Math.round(100*m[e])/100)+h}}function Mn(n){void 0===n&&(n={});var t=hn(n);return t.duration=0,t.add=function(r,a){var u=dn.indexOf(t),o=t.children;function c(n){n.passThrough=!0}u>-1&&dn.splice(u,1);for(var s=0;s<o.length;s++)c(o[s]);var f=x(r,M(e,n));f.targets=f.targets||n.targets;var l=t.duration;f.autoplay=!1,f.direction=t.direction,f.timelineOffset=i.und(a)?l:L(a,l),c(t),t.seek(f.timelineOffset);var d=hn(f);c(d),o.push(d);var p=sn(o,n);return t.delay=p.delay,t.endDelay=p.endDelay,t.duration=p.duration,t.seek(0),t.reset(),t.autoplay&&t.play(),t},t}hn.version="3.2.1",hn.speed=1,hn.suspendWhenDocumentHidden=!0,hn.running=dn,hn.remove=yn,hn.get=S,hn.set=un,hn.convertPx=T,hn.path=Q,hn.setDashoffset=Z,hn.stagger=bn,hn.timeline=Mn,hn.easing=p,hn.penner=d,hn.random=function(n,e){return Math.floor(Math.random()*(e-n+1))+n};var xn=hn;exports.default=xn;
},{}],"AkV5":[function(require,module,exports) {
module.exports="/SB-Playgrounds/games/nfb-wayfinder/coins.4a511e46.jpg";
},{}],"t3rF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=G;var e=S(require("simplex-noise")),t=S(require("animejs")),a=v(require("../tags")),n=v(require("three")),i=S(require("../util/resetPlayerPos")),r=require("./AnimationSystem"),o=S(require("./writing/Line3D")),l=require("../util/locale"),s=S(require("../util/Assets")),u=S(require("../util/query-string")),c=S(require("../assets/textures/coins.jpg")),d=S(require("../assets/gltf/coin.gltf")),f=require("../util/GLTFLoader"),g=v(require("../util/ShaderManager")),p=S(require("../util/Random")),y=require("canvas-sketch-util/math");function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(m=function(e){return e?a:t})(e)}function v(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=m(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,a&&a.set(e,n),n}function S(e){return e&&e.__esModule?e:{default:e}}const h=()=>{},w=new n.TextureLoader,O=new n.PlaneBufferGeometry(2,2),I=(0,p.default)(),M=new e.default(I.value),b=g.create({name:"coinShader",uniforms:{uTime:{value:0},tMap:{value:new n.Texture},uOffset:{value:new n.Vector2},uGlowIntensity:{value:1}},vertexShader:"\n    attribute vec2 aOffset;\n    attribute float aGlowDelay;\n\n    uniform float uTime;\n    \n    varying vec2 vUv;\n    varying vec2 vOffset;\n    varying float vGlowDelay;\n    \n    void main() {\n      \n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n      \n      vUv = uv;\n      vOffset = aOffset;\n      vGlowDelay = aGlowDelay;\n    }\n  ",fragmentShader:"\n    uniform sampler2D tMap;\n    uniform float uGlowIntensity;\n    varying float vGlowDelay;\n\n    varying vec2 vUv;\n    varying vec2 vOffset;\n\n    void main() {\n\n      vec2 uv = vec2(vUv.x, 1. - vUv.y);\n      uv *= .5;\n\n      uv += vOffset;\n      float glow = uGlowIntensity - vGlowDelay;\n      glow = clamp(glow, 1., 3.);\n      vec3 color = texture2D(tMap, uv).rgb * glow;\n\n      gl_FragColor = vec4(color, 1.);\n    }\n  "}),P=g.create({name:"coinShader",uniforms:{uOpacity:{value:0}},transparent:!0,depthTest:!1,depthWrite:!1,vertexShader:"\n    void main() {\n      gl_Position = vec4( position, 1.0 );\n    }\n  ",fragmentShader:"\n    uniform float uOpacity;\n    void main() {\n      gl_FragColor = vec4(1., 1.0, 1.0, uOpacity);\n    }\n  "});function k(e){return new Promise((t,a)=>{w.load(e,e=>{t(e)},h,e=>{a(e)})})}const D={yOffset:0,magicalEffect:0,capeSpeed:.2,glowIntensity:1,glowIntensity2:1,coinScl:.001,coinGlow:1,shakeSpeed:.5,flash:0,coinSpinSpeed:1,coinAngularSpeed:.1,camDistance:15,camShake:0,camShakeSpeed:1};function G(e){let i=!1,r=0,o=0,l=!1,s=!1,u=!1;const g=new n.Group;g.name="coins",e.entity().add(a.Object3D,g);let p=null;const m=e.findTag(a.UserCharacter),v=e.findTag(a.UserZoom),S=e.findTag(a.UserFollow),h=e.listen(a.FinalBiomeResolution);let w=new n.Vector3;const M=new n.LoadingManager,G=new f.GLTFLoader(M),q=[];let A=null;return G.load(d.default,function(e){p=e.scene.children[0].geometry,function(){const e=2*Math.PI/3;let t=0;for(let a=0;a<3;a++){const i=a%2,r=1-Math.floor(a/2),o=p.clone(),l=new Float32Array(2*o.attributes.position.count),s=new Float32Array(o.attributes.position.count);for(let e=0;e<l.length;e+=2)l[e]=.5*i,l[e+1]=.5*r;for(let e=0;e<s.length;e++)s[e]=2*a;o.setAttribute("aOffset",new n.BufferAttribute(l,2)),o.setAttribute("aGlowDelay",new n.BufferAttribute(s,1));const u=new n.Mesh(o,b);u.scale.setScalar(.5),t+=e,u.position.x=2*Math.cos(t),u.position.z=2*Math.sin(t),g.add(u),u.rotateX(2*Math.PI*I.range(0,1)),u.rotateY(2*Math.PI*I.range(0,1)),u.rotateZ(2*Math.PI*I.range(0,1)),u.time=I.range(0,3),u.scaleDelay=.5*a,u.angularPos=t,u.angularSpeed=1,u.radius=I.range(5,6),q.push(u)}}(),(A=new n.Mesh(O,P)).frustumCulled=!1,A.renderOrder=1e10,g.add(A),i=!0}),t=>{if(!i)return;r+=t,l&&(o+=t);e.findTag(a.UserCharacter);q.forEach((e,a)=>{e.rotateX(.015*D.coinSpinSpeed),e.rotateY(.015*D.coinSpinSpeed),e.rotateZ(.015*D.coinSpinSpeed);let n=D.coinScl-e.scaleDelay;n=(0,y.clamp)(n,.001,.5),e.scale.setScalar(n),e.time+=2*t;const i=(0,y.mapRange)(D.coinAngularSpeed,1,20,.7,.1);e.position.y=3+1.5*a+Math.cos(e.time)*i,e.angularPos+=t*e.angularSpeed*D.coinAngularSpeed,e.position.x=w.x+Math.cos(e.angularPos)*(e.radius-(0,y.mapRange)(D.coinAngularSpeed,1,20,0,1)),e.position.z=w.z-.5+Math.sin(e.angularPos)*(e.radius-(0,y.mapRange)(D.coinAngularSpeed,1,20,0,1)),e.material.uniforms.uGlowIntensity.value=D.coinGlow}),A.material.uniforms.uOpacity.value=D.flash,A.material.uniforms.uOpacity.value=D.flash,o>9.7&&!s&&(s=!0,e.entity().add(a.FlashSound,"flash-build-up")),o>12.4&&!u&&(u=!0,e.entity().add(a.FinalBiomeResolutionLines)),h.added.forEach(t=>{l=!0;const n=e.view([a.SpriteAnimation,a.SpriteAnimationOriginTreeTag]);w=n[0].get(a.Object3D).position,k(c.default).then(e=>{q.forEach((t,a)=>{t.material.uniforms.tMap.value=e})}),x()})};function x(){(0,t.default)({targets:D,magicalEffect:10,capeSpeed:2,duration:1e3,delay:0,easing:"easeInQuart",update:function(){m.magicalEffect=D.magicalEffect,m.capeSpeed=D.capeSpeed}}),(0,t.default)({targets:D,glowIntensity:20,duration:6e3,delay:0,easing:"easeInOutSine",update:function(){m.glowIntensity=D.glowIntensity}}),(0,t.default)({targets:D,yOffset:3,duration:5e3,delay:3e3,easing:"easeInOutSine",update:function(){m.yOffset=D.yOffset}}),(0,t.default)({targets:D,coinScl:1.5,duration:1300,delay:7e3,easing:"easeOutSine"}),(0,t.default)({targets:D,coinGlow:80,duration:6e3,delay:9500,easing:"easeInSine",complete:()=>{}}),(0,t.default)({targets:D,coinSpinSpeed:10,duration:4500,delay:8e3,easing:"easeInSine"}),(0,t.default)({targets:D,coinAngularSpeed:20,duration:4e3,delay:9e3,easing:"easeInQuart"}),(0,t.default)({targets:D,glowIntensity2:2,duration:2e3,delay:12e3,easing:"easeInSine",update:function(){m.glowIntensity2=D.glowIntensity2},complete:()=>{D.glowIntensity2=1,m.glowIntensity2=D.glowIntensity2,S.shake=0,S.shakeSpeed=1}}),(0,t.default)({targets:D,flash:1,duration:500,delay:12800,easing:"easeOutSine",update:()=>{m.glowIntensity-=1.5*D.flash,m.magicalEffect-=.5*D.flash},complete:()=>{q.forEach(e=>{e.visible=!1}),e.pause(),a.pause(),n.pause(),D.capeSpeed=.2,D.glowIntensity2=1,m.glowIntensity2=D.glowIntensity2,S.shake=0,S.shakeSpeed=0,v.distance=15,(0,t.default)({targets:D,flash:0,duration:3e3,delay:1500,easing:"easeOutSine"})}});const e=(0,t.default)({targets:D,camDistance:12,duration:9e3,delay:5e3,easing:"easeInOutSine",update:function(){v.distance=D.camDistance}}),a=(0,t.default)({targets:D,camShake:2,duration:3e3,delay:12e3,easing:"easeInOutSine",update:function(){S.shake=D.camShake,S.shakeSpeed=D.camShakeSpeed}}),n=(0,t.default)({targets:D,camShakeSpeed:5,duration:2e3,delay:11e3,easing:"easeInOutSine",update:function(){S.shakeSpeed=D.camShakeSpeed}})}}
},{"simplex-noise":"KFJE","animejs":"tMTn","../tags":"injP","three":"IV0r","../util/resetPlayerPos":"quSS","./AnimationSystem":"cUmx","./writing/Line3D":"OoyW","../util/locale":"dkeN","../util/Assets":"Wm90","../util/query-string":"Bj6B","../assets/textures/coins.jpg":"AkV5","../assets/gltf/coin.gltf":"OeIr","../util/GLTFLoader":"IGrR","../util/ShaderManager":"igLh","../util/Random":"LMfK","canvas-sketch-util/math":"RN3r"}],"HAc3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal");function t(t){let n;return{c(){(n=(0,e.element)("main")).innerHTML='<div class="svelte-1wrnee7"><p>Your browser does not support WebGL, or it has been disabled.</p> \n\n    <p>Try viewing this experience in latest Chrome, Safari or FireFox. You may\n      need to go into the browser settings and enable WebGL and hardware\n      acceleration in order to play.</p></div>',(0,e.attr)(n,"class","svelte-1wrnee7")},m(t,r){(0,e.insert)(t,n,r)},p:e.noop,i:e.noop,o:e.noop,d(t){t&&(0,e.detach)(n)}}}class n extends e.SvelteComponent{constructor(n){super(),(0,e.init)(this,n,null,t,e.safe_not_equal,{})}}var r=n;exports.default=r;
},{"svelte/internal":"xeIE"}],"u4I9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=p;var e=u(require("../tags")),t=u(require("three")),r=u(require("../util/math")),a=s(require("../util/SpriteManager")),n=require("../util/load"),i=require("../util/three-util"),o=s(require("../util/Assets"));function s(e){return e&&e.__esModule?e:{default:e}}function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var a={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=n?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(a,i,o):a[i]=e[i]}return a.default=e,r&&r.set(e,a),a}const f={forest:"spritesheets/tree-anim-a",grasslands:"spritesheets/tree-anim-b",tundra:"spritesheets/tree-anim-b"};async function p(t){const r=t.findTag(e.Renderer);const n=t.view([e.Object3D,e.SpriteAnimation]),o=t.view([e.SpriteAnimation,e.SpriteAnimationLazyLoadSheet]),s={};return function(t){o.forEach(t=>{const n=t.get(e.SpriteAnimationLazyLoadSheet),i=t.get(e.SpriteAnimation),o=n.id;if(o in s){const r=s[o];r&&r.loaded&&(i.sheet=r.sheet,n.playOnLoad&&!i.playing&&i.start(),t.remove(e.SpriteAnimationLazyLoadSheet))}else s[o]={sheet:null,loaded:!1,promise:(0,a.default)(o,r).then(e=>{s[o].loaded=!0,s[o].sheet=e})}}),n.forEach(r=>{const a=r.get(e.SpriteAnimation),n=a.sheet,i=r.get(e.Object3D);if(null==a.lastFrame&&n){const e=n.frames[0];l(i,e,a.fixSpriteAspect),a.lastFrame=e,a.frame=0,a.dirty=!1}if(i.material.visible=Boolean(n),a.playing&&n){const e=n.frames.length;if(a.elapsed+=t*a.speed,a.elapsed>=a.delay&&a.elapsed-a.delay>=1/12){a.elapsed=a.delay,a.frame++;const t=a.looping&&null!=a.loopEnd?a.loopEnd:e;a.frame>=t&&(a.looping?(null!=a.loopStart?a.frame=a.loopStart:a.frame=0,a.currentLoop++):(a.frame=e-1,a.playing=!1,a.finished=!0),a.onLoopEnd&&a.onLoopEnd(r)),a.dirty=!0}}if(a.dirty&&n){a.dirty=!1;const e=n.frames[a.frame];l(i,e,a.fixSpriteAspect),a.lastFrame=e}})};function l(e,t,a){const n=e.material,o=n.uniforms.map.value;if((0,i.shareAtlasTexture)(r,t.atlas,o),n.uniforms.repeat.value.copy(t.repeat),n.uniforms.offset.value.copy(t.offset),a){const r=t.width/t.height;e.scale.x=e.scale.y*r}}}
},{"../tags":"injP","three":"IV0r","../util/math":"Ov1X","../util/SpriteManager":"Ffhm","../util/load":"OkDW","../util/three-util":"bI4v","../util/Assets":"Wm90"}],"xisT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=u(require("../assets/image/ui/hint-card-left.png")),n=u(require("../assets/image/ui/hint-card-middle.png")),a=u(require("../assets/image/ui/hint-card-right.png")),r=require("svelte"),i=require("../util/locale"),s=require("../util/tokens"),l=u(require("../util/Random")),c=u(require("../assets/image/ui/touch-inv.png")),d=u(require("../assets/image/ui/tree-inv.png"));function u(e){return e&&e.__esModule?e:{default:e}}function o(t){let n,a,r;return{c(){n=(0,e.element)("div"),(a=(0,e.element)("img")).src!==(r=t[2])&&(0,e.attr)(a,"src",r),(0,e.attr)(a,"alt",""),(0,e.attr)(a,"class","token-image svelte-1c19bb0"),(0,e.attr)(n,"class","icon-container svelte-1c19bb0")},m(t,r){(0,e.insert)(t,n,r),(0,e.append)(n,a)},p(t,n){4&n&&a.src!==(r=t[2])&&(0,e.attr)(a,"src",r)},d(t){t&&(0,e.detach)(n)}}}function p(t){let n,a=t[0][i.language.get()]+"";return{c(){n=(0,e.text)(a)},m(t,a){(0,e.insert)(t,n,a)},p(t,r){1&r&&a!==(a=t[0][i.language.get()]+"")&&(0,e.set_data)(n,a)},d(t){t&&(0,e.detach)(n)}}}function m(t){let n;return{c(){n=(0,e.text)(t[0])},m(t,a){(0,e.insert)(t,n,a)},p(t,a){1&a&&(0,e.set_data)(n,t[0])},d(t){t&&(0,e.detach)(n)}}}function g(r){let i,s,l,c,d,u,g,v,f,b,h,k,x,_,q,M=r[2]&&o(r);function $(e,t){return e[0]&&"string"==typeof e[0]?m:e[0]&&"en"in e[0]?p:void 0}let y=$(r),w=y&&y(r);return{c(){i=(0,e.element)("div"),s=(0,e.element)("div"),l=(0,e.element)("img"),d=(0,e.space)(),u=(0,e.element)("div"),g=(0,e.space)(),v=(0,e.element)("img"),b=(0,e.space)(),h=(0,e.element)("div"),M&&M.c(),k=(0,e.space)(),x=(0,e.element)("div"),w&&w.c(),(0,e.attr)(l,"class","card-hint-image slice-0 svelte-1c19bb0"),(0,e.attr)(l,"alt",""),l.src!==(c=t.default)&&(0,e.attr)(l,"src",c),(0,e.attr)(u,"class","card-hint-image slice-1 svelte-1c19bb0"),(0,e.set_style)(u,"background-image","url('"+n.default+"')"),(0,e.attr)(v,"class","card-hint-image slice-2 svelte-1c19bb0"),(0,e.attr)(v,"alt",""),v.src!==(f=a.default)&&(0,e.attr)(v,"src",f),(0,e.attr)(s,"class","card-box svelte-1c19bb0"),(0,e.set_style)(s,"width",r[3]+"px"),(0,e.attr)(x,"class","card-text svelte-1c19bb0"),(0,e.attr)(h,"class","card-content svelte-1c19bb0"),(0,e.attr)(i,"class","card-hint-container svelte-1c19bb0")},m(t,n){(0,e.insert)(t,i,n),(0,e.append)(i,s),(0,e.append)(s,l),(0,e.append)(s,d),(0,e.append)(s,u),(0,e.append)(s,g),(0,e.append)(s,v),(0,e.append)(i,b),(0,e.append)(i,h),M&&M.m(h,null),(0,e.append)(h,k),(0,e.append)(h,x),w&&w.m(x,null),r[9](x),_||(q=[(0,e.listen)(window,"resize",r[4],{passive:!0}),(0,e.listen)(i,"click",r[5])],_=!0)},p(t,[n]){8&n&&(0,e.set_style)(s,"width",t[3]+"px"),t[2]?M?M.p(t,n):((M=o(t)).c(),M.m(h,k)):M&&(M.d(1),M=null),y===(y=$(t))&&w?w.p(t,n):(w&&w.d(1),(w=y&&y(t))&&(w.c(),w.m(x,null)))},i:e.noop,o:e.noop,d(t){t&&(0,e.detach)(i),M&&M.d(),w&&w.d(),r[9](null),_=!1,(0,e.run_all)(q)}}}function v(e,t){const n=e.getBoundingClientRect();return Math.max(270,n.width+10+24+40)}function f(t,n,a){const i=(0,r.createEventDispatcher)();let u,o,p,{text:m=""}=n,{iconMode:g=null}=n,{token:f=""}=n;const b=(0,l.default)();let h;const k=()=>{a(8,h=s.InvertedTokenURLs[b.pick(s.AllTokens)]),"token-random"===g&&a(2,u=h)};function x(){a(3,p=v(o,m))}return k(),(0,r.onMount)(()=>{let e;x();let t=setTimeout(()=>{e=setInterval(k,1e3)},1e3);return()=>{clearTimeout(t),clearInterval(e)}}),t.$$set=(e=>{"text"in e&&a(0,m=e.text),"iconMode"in e&&a(6,g=e.iconMode),"token"in e&&a(7,f=e.token)}),t.$$.update=(()=>{3&t.$$.dirty&&o&&m&&a(3,p=v(o,m)),448&t.$$.dirty&&("token-random"===g?a(2,u=h):"finger"===g?a(2,u=c.default):"tree"===g?a(2,u=d.default):"token"===g&&a(2,u=s.InvertedTokenURLs[f]))}),[m,o,u,p,x,function(){i("close")},g,f,h,function(t){e.binding_callbacks[t?"unshift":"push"](()=>{a(1,o=t)})}]}class b extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,f,g,e.safe_not_equal,{text:0,iconMode:6,token:7})}}var h=b;exports.default=h;
},{"svelte/internal":"xeIE","../assets/image/ui/hint-card-left.png":"WG1w","../assets/image/ui/hint-card-middle.png":"i4hq","../assets/image/ui/hint-card-right.png":"BYcb","svelte":"XHT5","../util/locale":"dkeN","../util/tokens":"kL9I","../util/Random":"LMfK","../assets/image/ui/touch-inv.png":"xMHm","../assets/image/ui/tree-inv.png":"b9rk"}],"iIxD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=require("svelte/transition"),n=require("svelte"),o=require("../alec-svelte"),r=_(require("../tags")),i=f(require("../config")),a=f(require("../components/AnimatedTextSpan.svelte")),s=require("../animations/transitions"),u=require("../util/tokens"),c=f(require("../components/Image.svelte")),l=f(require("../util/Random")),d=f(require("../components/CardHint.svelte"));function f(e){return e&&e.__esModule?e:{default:e}}function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}function _(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var a=r?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(o,i,a):o[i]=e[i]}return o.default=e,n&&n.set(e,o),o}function v(t){let n,o;return(n=new d.default({props:{token:t[3],iconMode:t[2],text:t[1]}})).$on("close",t[6]),{c(){(0,e.create_component)(n.$$.fragment)},m(t,r){(0,e.mount_component)(n,t,r),o=!0},p(e,t){const o={};8&t&&(o.token=e[3]),4&t&&(o.iconMode=e[2]),2&t&&(o.text=e[1]),n.$set(o)},i(t){o||((0,e.transition_in)(n.$$.fragment,t),o=!0)},o(t){(0,e.transition_out)(n.$$.fragment,t),o=!1},d(t){(0,e.destroy_component)(n,t)}}}function m(t){let n,o,r,i,a,u,c=t[4]&&v(t);return{c(){n=(0,e.element)("div"),c&&c.c(),(0,e.attr)(n,"class","container svelte-1lvhwzd"),(0,e.toggle_class)(n,"ignorePointer",g)},m(t,o){(0,e.insert)(t,n,o),c&&c.m(n,null),i=!0,a||(u=(0,e.listen)(n,"introin",y),a=!0)},p(t,[o]){t[4]?c?(c.p(t,o),16&o&&(0,e.transition_in)(c,1)):((c=v(t)).c(),(0,e.transition_in)(c,1),c.m(n,null)):c&&((0,e.group_outros)(),(0,e.transition_out)(c,1,1,()=>{c=null}),(0,e.check_outros)()),0&o&&(0,e.toggle_class)(n,"ignorePointer",g)},i(t){i||((0,e.transition_in)(c),(0,e.add_render_callback)(()=>{r&&r.end(1),o||(o=(0,e.create_in_transition)(n,s.fadeInTransition,{delay:0,duration:1e3})),o.start()}),i=!0)},o(t){(0,e.transition_out)(c),o&&o.invalidate(),r=(0,e.create_out_transition)(n,s.fadeInTransition,{delay:0,duration:1e3}),i=!1},d(t){t&&(0,e.detach)(n),c&&c.d(),t&&r&&r.end(),a=!1,u()}}}let g=!0;const y=()=>{};function k(t,r,i){let a,s=e.noop,u=()=>(s(),s=(0,e.subscribe)(d,e=>i(4,a=e)),d);t.$$.on_destroy.push(()=>s());const{entity:c}=(0,o.context)(),l=c.ref();let{canShow:d}=r;u();let{text:f=""}=r,{iconMode:p=!1}=r,{token:_=""}=r;(0,n.onMount)(()=>()=>{});return t.$$set=(e=>{"canShow"in e&&u(i(0,d=e.canShow)),"text"in e&&i(1,f=e.text),"iconMode"in e&&i(2,p=e.iconMode),"token"in e&&i(3,_=e.token)}),[d,f,p,_,a,l,()=>{l.kill()}]}class q extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,k,m,e.safe_not_equal,{canShow:0,text:1,iconMode:2,token:3})}}var M=q;exports.default=M;
},{"svelte/internal":"xeIE","svelte/transition":"ly0Q","svelte":"XHT5","../alec-svelte":"M3eo","../tags":"injP","../config":"nZps","../components/AnimatedTextSpan.svelte":"FmP3","../animations/transitions":"bvJy","../util/tokens":"kL9I","../components/Image.svelte":"q18m","../util/Random":"LMfK","../components/CardHint.svelte":"xisT"}],"Y5MC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=i(require("../tags")),t=i(require("three")),r=o(require("../overlays/TutorialMessage.svelte")),n=require("svelte/store");function o(e){return e&&e.__esModule?e:{default:e}}function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var u=o?Object.getOwnPropertyDescriptor(e,i):null;u&&(u.get||u.set)?Object.defineProperty(n,i,u):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}function u(t){const o=t.view(e.TutorialMessage);let a=!Boolean(t.findTag(e.IsGameUIActive));const i=(0,n.writable)(a);return i.subscribe(e=>{a=e}),function(n){const u=!Boolean(t.findTag(e.IsGameUIActive));u!==a&&(a=u,i.update(e=>a)),a&&o.forEach(t=>{const o=t.get(e.TutorialMessage);o.time+=n,o.time>=o.delay&&!t.has(e.ViewLayer)&&t.add(e.ViewLayer,{component:r.default,id:o.id,props:{canShow:i,token:o.token,iconMode:o.iconMode,text:o.message}}),Math.max(0,o.time-o.delay)>=o.duration&&t.kill()})}}
},{"../tags":"injP","three":"IV0r","../overlays/TutorialMessage.svelte":"iIxD","svelte/store":"nBdo"}],"bE7e":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=l;var e=s(require("../tags")),t=s(require("three")),n=o(require("../util/Random")),i=o(require("./writing/Line3D")),r=require("./AnimationSystem"),a=o(require("../util/ease-animate"));function o(e){return e&&e.__esModule?e:{default:e}}function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=r?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(i,a,o):i[a]=e[a]}return i.default=e,n&&n.set(e,i),i}function l(t){const r=(0,n.default)(),o=t.listen(e.FinalBiomeResolutionLines),u=t.view(e.FloatingEndLine);return function(n){o.added.length>0&&Array(50).fill().map(()=>{const n=new i.default(t,{thickness:1}),[a,o]=r.onCircle(r.range(2.5,15));n.userData._lineThickness=1,n.position.x=a,n.position.y=r.range(2,10),n.position.z=o,n.updatePath([[0,-1,0],[0,0,0],[0,1,0]],!1,!1),n.userData._entity=t.entity().add(e.Object3D,n).add(e.FloatingEndLine);const u=n.userData._entity.get(e.FloatingEndLine);return u.duration=r.range(2,3.5),u.delay=2+r.range(0,2),u.animateDuration=.5,u.speed=r.range(.5,2),n}),u.forEach(t=>{const i=t.get(e.FloatingEndLine);i.time+=n;const r=Math.max(0,i.time-i.delay),o=(0,a.default)(i.time,i.duration,i.delay,i.animateDuration,i.ease),u=t.get(e.Object3D);u.material.uniforms.thickness.value=u.userData._lineThickness*o,u.material.uniforms.opacity.value=o,u.position.y+=n*i.speed,r>=i.duration&&t.kill()})}}
},{"../tags":"injP","three":"IV0r","../util/Random":"LMfK","./writing/Line3D":"OoyW","./AnimationSystem":"cUmx","../util/ease-animate":"WEUS"}],"VuYM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=D;var e=k(require("../tags")),t=k(require("../util/math")),r=k(require("three")),a=require("./AnimationSystem"),n=y(require("./writing/Line3D")),i=y(require("../util/tween-ticker")),o=require("../util/tokens"),s=require("../util/load"),l=require("../nfb"),u=require("../util/geometry"),c=y(require("../util/haikugen")),d=k(require("../util/ShaderManager")),f=require("../util/materials"),g=y(require("../util/Assets")),p=y(require("../util/ObjectPool")),h=require("../util/locale"),m=y(require("../util/Random"));function y(e){return e&&e.__esModule?e:{default:e}}function T(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(T=function(e){return e?r:t})(e)}function k(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=T(t);if(r&&r.has(e))return r.get(e);var a={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=n?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(a,i,o):a[i]=e[i]}return a.default=e,r&&r.set(e,a),a}const w=1.25;function D(a){const n=.666,s=a.findTag(e.RenderLayers),l=a.findTag(e.Renderer),d=(new r.Color(1,1,1),new r.Color(1+n,1+n,1+n),.1),h=new r.Color("#000"),y=((0,c.default)(),(0,i.default)()),[T]=g.default.createGPUTextureTask(l,"image/data/soft-circle"),k=new p.default({initialCapacity:10,create:()=>(function(){const e=new r.Mesh((0,f.getSpriteGeometry)(),(0,f.createTokenMaterial)(n,!1));e.layers.set(s.groundNormalElement),e.renderOrder=10,e.userData.alpha=1,e.name="token";const t=new r.Sprite(new r.SpriteMaterial({map:T,depthTest:!1,depthWrite:!1,color:h,opacity:d,transparent:!0}));t.scale.set(2,.66,1).multiplyScalar(.75),t.layers.disableAll(),t.layers.enable(s.shadow);const a=new r.Group;return a.add(e),a.add(t),a.userData.sprite=e,a.userData.shadow=t,a})(),renew(e){},release(e){}}),w=(Object.keys(o.TokenURLs),a.view([e.GroundAsset,e.GroundAssetToken,e.Object3D])),D=a.view(e.TokenIsCollecting),v=a.view(e.TriggerTokenLine),O=a.listen(e.GroundAssetToken),b=(a.listen(e.HaikuCardSaved),a.view(e.FinishedPoem),a.view(e.CollectedToken)),q=a.listen(e.CollectedToken),S=a.view(e.TutorialMessage),j=(a.view([e.WrittenStanzaLine]),[0,0]),M=[0,0],C=a.tag(e.TokensDiscoveredSet,new Set),G=a.listen(e.ActiveEnvironmentState),A=a.findTag(e.UserCharacter);new r.SphereBufferGeometry(1,16,16);let P=!1,E=0;(0,m.default)();return function(r){y.tick(r);const i=A.position;j[0]=i.x,j[1]=i.z,G.changed&&(C.clear(),b.forEach(e=>e.kill()),D.forEach(t=>t.tagOff(e.TokenIsCollecting)),v.forEach(t=>t.tagOff(e.TriggerTokenLine))),O.added.forEach(t=>{const r=t.get(e.GroundAsset),a=t.get(e.GroundAssetToken),n=k.next(),i=n.userData.sprite;(0,f.setSpriteToken)(l,i,a.type,1.25);i.userData.startY=1,i.userData.endY=i.userData.startY+1,i.position.x=r.x,i.position.z=r.z,i.position.y=i.userData.startY,i.userData.show=null;const o=n.userData.shadow;o.position.copy(i.position),o.position.y=0,n.visible=!1,t.add(e.Object3D,n),t.add(e.ShaderUniformTime),t.get(e.ShaderUniformTime).uniform=i.material.uniforms.time}),O.removing.forEach(t=>{if(t.has(e.Object3D)){const r=t.get(e.Object3D);k.release(r)}});const o=Boolean(a.findTag(e.DirectUserToOrigin)),s=Boolean(a.findTag(e.OriginTreeIntroSequence)),c=Boolean(a.findTag(e.BlockTokenCollection)),g=!s&&b.length<3&&!o&&!c,p=D.length>0,h=v.length>0,m=p||h;if(w.forEach(r=>{const a=r.get(e.GroundAsset),i=r.get(e.GroundAssetToken),o=r.get(e.Object3D),s=o.userData.sprite,l=o.userData.shadow,c=s.userData.show,f=!C.has(i.type),p=s.material.uniforms.map.value,h=Boolean(p),T=g&&f&&h&&!m;T!==c&&(s.userData.show=T,y.to(s.position,{y:T?s.userData.startY:s.userData.endY,ease:"sineOut",duration:1}),y.to(s.userData,{alpha:T?1:0,ease:"sineOut",duration:1}).on("update",e=>{const r=s.userData.alpha;s.material.uniforms.opacity.value=r;const a=t.lerp(1,1+n,r);s.material.uniforms.color.value.setRGB(a,a,a),s.material.visible=r>=1e-5,l.material.opacity=r*d}).on("complete",e=>{e.cancelling||T||(o.visible=!1)})),M[0]=a.x,M[1]=a.z;f&&T&&(0,u.circlesIntersect)(M,2,j,1)&&(r.tagOn(e.TriggerTokenLine),S.forEach(e=>e.kill()))}),q.added.length>0){const t=q.query.entities,r=q.added[q.added.length-1];if(t.length<3){const t=a.entity().add(e.TutorialMessage),n=r.get(e.CollectedToken),i=t.get(e.TutorialMessage);i.iconMode="token",i.token=n.type,i.message=n.stanza,i.id=n.type,i.delay=.5,i.duration=6}!P&&t.length>=3&&(P=!0,E=0)}if(P&&(E+=r)>=1){P=!1;const t=a.entity().add(e.FinishedPoem).get(e.FinishedPoem),r=q.query.entities;for(let a=0;a<3;a++){const n=r[a].get(e.CollectedToken);t.lines[a]=n.stanza,t.tokens[a]=n.type}b.forEach(e=>e.kill())}}}
},{"../tags":"injP","../util/math":"Ov1X","three":"IV0r","./AnimationSystem":"cUmx","./writing/Line3D":"OoyW","../util/tween-ticker":"KgTk","../util/tokens":"kL9I","../util/load":"OkDW","../nfb":"Xlf9","../util/geometry":"nZ95","../util/haikugen":"iilj","../util/ShaderManager":"igLh","../util/materials":"phuP","../util/Assets":"Wm90","../util/ObjectPool":"iiAR","../util/locale":"dkeN","../util/Random":"LMfK"}],"LiG7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=j;var e=T(require("../tags")),t=T(require("../util/math")),n=T(require("three")),r=T(require("../util/helpers")),a=require("./AnimationSystem"),i=D(require("./writing/Line3D")),o=D(require("../util/tween-ticker")),s=require("../util/tokens"),l=require("../util/load"),u=require("../util/geometry"),c=D(require("../util/haikugen")),d=T(require("../util/ShaderManager")),p=require("../util/materials"),g=D(require("../util/Assets")),h=D(require("../util/ObjectPool")),f=require("../util/locale"),m=D(require("../util/Random")),k=require("../util/three-util"),y=D(require("../util/query-string")),w=require("../nfb");function D(e){return e&&e.__esModule?e:{default:e}}function O(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(O=function(e){return e?n:t})(e)}function T(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=O(t);if(n&&n.has(e))return n.get(e);var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=a?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(r,i,o):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}const b=1.25,v=2.5,x=6.25;function C(e){const t=e.split(" "),n=[];return t.forEach(e=>{e.split("-").forEach((e,t,r)=>{let a=e;t<r.length-1&&(a+="-"),a&&n.push(a)})}),n}function j(r){const s=r.findTag(e.RenderLayers),l=r.findTag(e.Renderer),d=new n.Color(1,1,1),y=(new n.Color(1.666,1.666,1.666),new n.Color("#280422").lerp(d,.9)),w=(0,c.default)(),D=(0,o.default)(),O=1.75,T=2.25,v=new n.PlaneBufferGeometry(1,1,1,1),j=r.listen([e.GroundAsset,e.GroundAssetToken,e.Object3D,e.TriggerTokenLine]),z=r.view(e.FinishedPoem),S=r.view(e.CollectedToken),_=(r.listen(e.CollectedToken),r.view(e.HaikuInInventory),r.findTag(e.TokensDiscoveredSet)),q=[0,0],P=r.listen(e.ActiveEnvironmentState),E=r.findTag(e.UserCharacter),M=(0,m.default)(),A=r.view(e.TokenChildren),[V]=g.default.createGPUTextureTask(l,"image/data/compass-dot"),F=new h.default({initialCapacity:12,name:"orbs",create(){const e=new n.Mesh(v,(0,p.createTokenMaterial)(1,!1));return e.material.uniforms.map.value=V,e.renderOrder=10,e.position.y=b,e.userData.smallScale=0,e.userData.bigScale=.45,e.userData.alpha=1,e.userData.visibility=0,e.userData.finalScale=1,e.userData._entity=null,B(e),e.layers.set(s.groundNormalElement),e},renew(e){e.userData._pool=this},release(e){e.userData._pool=null,e.userData._entity&&(e.userData._entity.kill(),e.userData._entity=null)}}),I=(r.view(e.DirectUserToOrigin),r.listen(e.DirectUserToOrigin),r.view([e.Object3D,e.MusicalOrb]));new n.Vector3,new n.Vector3;return function(t){D.tick(t);const o=E.position;q[0]=o.x,q[1]=o.z,I.forEach(t=>{const n=t.get(e.MusicalOrb),r=t.get(e.Object3D);if(!n.killing&&!n.killing&&!n.hit){const a=r.position.x-q[0],i=r.position.z-q[1];if(a*a+i*i<=x){n.hit=!0,t.tagOff(e.CollectTokenOrb),t.tagOn(e.CollectTokenOrb),t.add(e.ParticleEmit),t.get(e.ParticleEmit).position.copy(r.position),n.killing=!0,((e,t=!1)=>{e&&(e.userData._pool&&F.release(e),t&&e.userData._entity&&(e.userData._entity.kill(),e.userData._entity=null),(0,k.detachObject)(e)),D.to(e.userData,{alpha:0,duration:1,ease:"expoOut"}).on("update",()=>{B(e)}).on("complete",()=>{e&&(e.userData._pool&&F.release(e),t&&e.userData._entity&&(e.userData._entity.kill(),e.userData._entity=null),(0,k.detachObject)(e))})})(r,!0)}}}),j.added.forEach(t=>{const o=t.get(e.GroundAsset),l=t.get(e.GroundAssetToken);t.get(e.Object3D);t.tagOff(e.TriggerTokenLine),function(t,o){const l=Math.atan2(E.direction.z,E.direction.x),c=r.entity().add(e.TokenChildren);c.add(e.TokenIsCollecting);const d=c.get(e.TokenChildren),p=new n.Group;d.group=p;const g=l,h=Math.cos(g),m=Math.sin(g),k=new n.Vector3(o.x,0,o.z).addScaledVector(new n.Vector3(h,0,m),4),O=z.map(t=>t.get(e.FinishedPoem).lines),T=S.slice(0,2).map(t=>t.get(e.CollectedToken).stanza),v=S.length,x=w.generateStanza({stanza:v,token:t,ignore:O,state:T});d.x=o.x,d.z=o.z,d.type=t,d.stanzaIndex=v,d.stanza=x;const j=C(x[f.language.get()]),_=[],q=S.length;for(let e=0;e<j.length;e++){_.push(j[e]);for(let t=0;t<q;t++)e<j.length-1&&_.push(null)}const P=j.length,A=5*P,V=M.sign(),I=k.clone().addScaledVector(new n.Vector3(h,0,m),A),G=k.clone().lerp(I,.25),R=k.clone().lerp(I,.75),L=new n.Vector2(k.x,k.z).sub(new n.Vector2(I.x,I.z)).normalize(),U=new n.Vector2(-L.y,L.x);let W;const H=new n.Vector3(U.x,0,U.y);P>3?(G.addScaledVector(H,-A/2*V),R.addScaledVector(H,A/2*V),W=new n.CubicBezierCurve3(k,G,R,I)):(G.addScaledVector(H,A/2*V),W=new n.QuadraticBezierCurve3(k,G,I));const K=new i.default(r,{taper:!0,thickness:.35,dotted:!0,filling:!1,draw:1,depthWrite:!1,depthTest:!1}),N=new i.default(r,{bloom:0,thickness:.75,blending:n.MultiplyBlending,color:y,geometry:K.geometry});N.layers.set(s.shadow),N.userData.thickness=N.material.uniforms.thickness.value;const Q=j.map((e,t,r)=>{const a=r.length<=1?.5:t/(r.length-1),i=new n.Vector3;return W.getPointAt(a,i),i}),J=new n.CatmullRomCurve3(Q,!1,"catmullrom",.5);d.markers.length=0;const X=_;for(let e=0;e<X.length;e++){const t=X[e],n=X.length<=1?.5:e/(X.length-1),r=F.next();console.log(F.log()),J.getPointAt(n,r.position),r.position.y=b,r.userData.alpha=1,r.userData.visibility=0,r.userData.finalScale=1,p.add(r),B(r),0===e&&D.to(r.userData,{visibility:1,duration:1,ease:"expoOut"}).on("update",()=>B(r)),d.markers.push({hit:!1,word:t,sphere:r,position:r.position})}const Y=d.markers.map(e=>{const t=e.position;return t}),Z=(0,u.getBoundingCircle)(Y.map(e=>[e.x,e.z]));d.center=Z.center,d.radius=Z.radius,K.updatePath(J.getSpacedPoints(30),!1,!0);const $=K.material.uniforms.thickness.value;(0,a.tweenFromTo)(r,K.material.uniforms.thickness,"value",0,$,1,"sineOut"),K.material.uniforms.filling.value=!0,N.material.uniforms.filling.value=!0,(0,a.tweenFromTo)(r,K.material.uniforms.draw,"value",0,1,1,"sineOut"),(0,a.tweenFromTo)(r,N.material.uniforms.draw,"value",0,1,1,"sineOut"),p.add(K),p.add(N),K.position.y=b,d.line=K,d.shadow=N,c.add(e.Object3D,p)}(l.type,o)}),A.forEach(n=>{const i=n.get(e.TokenChildren);if(i.complete||i.killing)return;const o=(0,u.circlesIntersect)(q,5,i.center,i.radius);i.removing||o?i.removing&&o&&(i.removing=!1,console.log("token back in range")):(console.log("token out of range"),i.removeTime=0,i.removing=!0),i.removing&&(i.removeTime+=t,i.removeTime>=i.removeDelay&&(i.killing=!0,i.removing=!0,function(t,n){!function(t){if(!t.has(e.TokenChildren))return;const n=t.get(e.TokenChildren);n.markers.forEach(t=>{t.text&&function(t){if(t.has(e.Object3D)){const n=t.get(e.Object3D);n&&n.userData.tweenA&&(n.userData.tweenA.kill(),n.userData.tweenB.kill());const i=t.get(e.TextSprite3D);(0,a.tweenTo)(r,n.position,"y",O,1,"expoOut");(0,a.setEntityTweenFromTo)(t,i,"opacity",1,0,1,"sineOut");const o=t.get(e.TargetKeyTween);o.killEntityOnFinish=!0,o.assignFromOnStart=!0}}(t.text);const n=t.sphere;D.to(t.sphere.userData,{finalScale:0,duration:1,ease:"sineOut"}).on("update",()=>B(t.sphere)).on("complete",()=>{n.userData._pool&&F.release(n),(0,k.detachObject)(n)})}),D.to(n.line.material.uniforms.thickness,{value:0,duration:1,ease:"sineOut"}),D.to(n.shadow.material.uniforms.thickness,{value:0,duration:1,ease:"sineOut"}).on("complete",()=>{console.log("dispose"),n.line.geometry.dispose(),n.shadow.geometry.dispose(),(0,k.detachObject)(n.line),(0,k.detachObject)(n.shadow),(0,k.detachObject)(n.group),t.kill()})}(t)}(n))),i.complete||i.killing||i.removing||function(t,n){for(let a=0;a<n.markers.length;a++){const i=n.markers[a];if(!i.hit){const o=a>0&&n.markers.length>1?n.markers[a-1]:null;if(o&&!o.hit)break;const s=i.position.x-q[0],l=i.position.z-q[1],u=s*s+l*l;if(u<=x){i.hit=!0,t.tagOff(e.CollectTokenOrb),t.tagOn(e.CollectTokenOrb),t.add(e.ParticleEmit);const o=t.get(e.ParticleEmit);o.position.copy(i.position),i.word&&(i.text=G(i.word,i.sphere.position));n.markers.length<=1||n.markers.length;D.to(i.sphere.userData,{alpha:0,duration:1,ease:"expoOut"}).on("update",()=>{B(i.sphere)}).on("complete",()=>{i.sphere&&(i.sphere.userData._pool&&F.release(i.sphere),(0,k.detachObject)(i.sphere))});const s=a<n.markers.length-1?n.markers[a+1]:null;if(s&&D.to(s.sphere.userData,{visibility:1,duration:1,ease:"expoOut"}).on("update",()=>{B(s.sphere)}),a===n.markers.length-1){n.complete=!0,_.add(n.type),t.tagOff(e.TokenIsCollecting);const a=r.entity().add(e.CollectedToken),i=a.get(e.CollectedToken);a.add(e.CapeMagicalEffect),a.add(e.AutoRemoveCapeMagicalEffect),i.x=n.x,i.z=n.z,i.type=n.type,i.stanza=n.stanza,i.stanzaIndex=n.stanzaIndex,D.to(n.line.material.uniforms.dottedFill,{value:1,duration:1,ease:"quadInOut"})}}}}}(n,i)}),P.changed&&A.forEach(t=>{!function(t){if(!t.has(e.TokenChildren))return;const n=t.get(e.TokenChildren);n.markers.forEach(t=>{t.text&&function(t){if(t.has(e.Object3D)){const n=t.get(e.Object3D);n&&n.userData.tweenA&&(n.userData.tweenA.kill(),n.userData.tweenB.kill())}t.kill()}(t.text),t.sphere&&(t.sphere.userData._pool&&F.release(t.sphere),(0,k.detachObject)(t.sphere))}),n.line.geometry.dispose(),n.shadow.geometry.dispose(),(0,k.detachObject)(n.line),(0,k.detachObject)(n.shadow),(0,k.detachObject)(n.group),t.kill()}(t)})};function B(e){const n=t.lerp(e.userData.smallScale,e.userData.bigScale,e.userData.alpha)*e.userData.visibility*e.userData.finalScale;e.visible=n>1e-14,e.scale.setScalar(Math.max(n,1e-14))}function G(t,i){const o=new n.Group;o.position.copy(i),o.position.y=O;const s=r.entity().add(e.TextSprite3D).add(e.Object3D,o),l=s.get(e.TextSprite3D);l.text=t,l.depth=!1,l.parent=o,l.fontSize=16,l.opacity=0;const u=(0,a.tweenTo)(r,o.position,"y",T,2,"expoOut"),c=(0,a.tweenTo)(r,l,"opacity",1,1,"sineOut");return o.userData.tweenA=u.ref(),o.userData.tweenB=c.ref(),s}}
},{"../tags":"injP","../util/math":"Ov1X","three":"IV0r","../util/helpers":"N4w3","./AnimationSystem":"cUmx","./writing/Line3D":"OoyW","../util/tween-ticker":"KgTk","../util/tokens":"kL9I","../util/load":"OkDW","../util/geometry":"nZ95","../util/haikugen":"iilj","../util/ShaderManager":"igLh","../util/materials":"phuP","../util/Assets":"Wm90","../util/ObjectPool":"iiAR","../util/locale":"dkeN","../util/Random":"LMfK","../util/three-util":"bI4v","../util/query-string":"Bj6B","../nfb":"Xlf9"}],"PJip":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=be;var e=ve(require("../tags")),t=ve(require("three")),r=ge(require("../util/query-string")),a=ge(require("./SnowAtmosphereSystem")),d=ge(require("./DOMTextSystem")),i=ge(require("./GameUISystem")),s=ge(require("./CanvasSystem")),u=ge(require("./TokenPaperFollowSystem")),n=ge(require("./SceneSystem")),o=ge(require("./InputSystem")),m=ge(require("./CompassSystem")),l=ge(require("./ScreenCompassSystem")),y=ge(require("./UserMoveSystem")),S=ge(require("./WindAtmosphereSystem")),f=ge(require("./RainAtmosphereSystem")),q=ge(require("./CharacterSystem")),c=ge(require("./HatWindLineSystem")),p=ge(require("./AtmosphericsSystem")),g=ge(require("./TallGrassSystem")),w=ge(require("./HaikuFloraSystem")),v=ge(require("./UserZoomSystem")),b=ge(require("./RenderDebugTargetsSystem")),P=ge(require("./UserFollowSystem")),T=ge(require("./ShaderUniformSystem")),h=ge(require("./LoadJSONSystem")),O=ge(require("./TreeSpriteAnimationSystem")),M=ge(require("./TextSpriteSystem")),A=ge(require("./EnvironmentGrassSystem")),_=ge(require("./EnvironmentGroundRenderTextureSystem")),F=ge(require("./SubmitFrameSystem")),L=ge(require("./AnimationSystem")),k=ge(require("./ProceduralSpawningLeaves")),x=ge(require("./ProceduralSpawningDots")),C=ge(require("./EnvironmentGroundDataTextureSystem")),U=ge(require("./AudioSystem")),D=ge(require("./SimpleEnvironmentSystem")),E=ge(require("./SimpleEnvironmentCellSystem")),G=ge(require("./SimpleEnvironmentAssetsSystem")),R=ge(require("./ShadowMapSystem")),j=ge(require("./LoadRefGLTFSystem")),H=ge(require("./PoemCollectionSystem")),I=ge(require("./HaikuCollectionSystem")),W=ge(require("./StanzaLineSpawningGrowthSystem")),V=ge(require("./WaterCollectionSystem")),B=ge(require("./DevTutorialSystem")),z=ge(require("./BirdFlyingSystem")),J=ge(require("./GroundBirdsSystem")),N=ge(require("./animals/ButterflySystem")),Q=ge(require("./animals/RabbitSystem")),Z=ge(require("./animals/SealSystem")),K=ge(require("./animals/OwlSystem")),X=ge(require("./animals/FoxSystem")),Y=ge(require("./animals/FishSystem")),$=ge(require("./animals/JumpingRabbitSystem")),ee=ge(require("./OriginTreeSystem")),te=ge(require("./OriginTreeIntroSystem")),re=ge(require("./IntroTutorialSystem")),ae=ge(require("./LetterboxBarsSystem")),de=ge(require("./AnimalSpawnSystem")),ie=ge(require("./OutroSystem")),se=require("../util/globalIntroVideo"),ue=ve(require("../config")),ne=ve(require("../util/resetPlayerPos")),oe=ge(require("../util/Assets")),me=ge(require("../overlays/NotSupportedOverlay.svelte")),le=ge(require("./SpriteSheetAnimationSystem")),ye=ge(require("./TutorialMessageSystem")),Se=require("../nfb"),fe=ge(require("./FloatingEndLines")),qe=ge(require("./TokenPlacementSystem")),ce=ge(require("./TokenConstellationSystem")),pe=require("../util/tokens");function ge(e){return e&&e.__esModule?e:{default:e}}function we(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(we=function(e){return e?r:t})(e)}function ve(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=we(t);if(r&&r.has(e))return r.get(e);var a={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=d?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(a,i,s):a[i]=e[i]}return a.default=e,r&&r.set(e,a),a}async function be(t){const a=(0,ue.default)();let u;window.world=t,window.Tags=e;const n=new Promise(e=>{u=e});await Pe(),t.addSystem(s.default,{context:a.context});const o=t.findTag(e.AppState);o.rendering=!1,t.root.process(1/60);const m=t.getSystem(s.default).instance;m.running=!0,m.show(),m.step();let l=Promise.resolve();t.addSystem(d.default),t.addSystem(i.default,{readyToInitialize:function(){console.log("[init] Initialize Game Systems"),oe.default.prepare(["spritesheets/temp_grass_sprites"]),l=Te(t);oe.default.loadQueued()},readyToShowEngine:async function(){await l,(0,Se.sendAnalytics)({event:"finished_loading",label:"FinishedLoading"}),console.log("[init] Start Rendering Engine"),o.rendering=!0,t.root.process(1/60),requestAnimationFrame(()=>{y.remove(e.HideHUD),t.entity().add(e.ScreenFade,{duration:3,from:1,to:0}),y.remove(e.MoveUserToOrigin),y.remove(e.CameraStopUserMovement),u()})}}),(0,ue.hideLoader)();const y=t.entity();y.add(e.CameraStopUserMovement),y.add(e.HideHUD),y.add(e.MoveUserToOrigin),oe.default.prepare(["image/ui/close-button","image/ui/ico_resume","image/ui/btn_start","image/ui/btn_about","image/ui/hint-card-left","image/ui/hint-card-middle","image/ui/hint-card-right","image/ui/ico_paperJournal1-rotated"]),r.default.nolanding||(console.log("[video] Loading video"),(0,se.getVideo)().load());const S=t.findTag(e.Renderer);return await Promise.all([oe.default.loadQueued(),(0,pe.loadTokenSprites)(S)]),n}function Pe(){return Promise.all(["image/svg/nfblogo"].map(e=>oe.default.load(e)))}async function Te(d,i){const s=(0,ue.default)();if(d.entity().add(e.RenderLayers),d.addSystem(n.default),d.addSystem(o.default),d.addSystem(T.default),d.addSystem(y.default),d.addSystem(q.default),d.addSystem(c.default),d.addSystem(v.default,{allowMouseZoom:!1,maxDistance:400}),d.addSystem(P.default),d.addSystem(L.default),d.addSystem(C.default),d.addSystem(_.default),d.addSystem(R.default),s.embed||await d.addSystem(j.default),d.addSystem(D.default),await d.addSystem(A.default),d.addSystem(E.default),await d.addSystem(G.default),d.addSystem(le.default),d.addSystem(O.default),s.embed&&await d.addSystem(h.default),await d.addSystem(k.default),d.addSystem(x.default),s.embed||d.addSystem(ee.default),s.embed||d.addSystem(te.default),d.addSystem(ye.default),s.embed||r.default.notutorial||d.addSystem(re.default),d.addSystem(qe.default),d.addSystem(ce.default),d.addSystem(u.default),d.addSystem(V.default),d.addSystem(f.default),d.addSystem(S.default),d.addSystem(a.default),d.addSystem(de.default),d.addSystem(w.default),d.addSystem(m.default),d.addSystem(z.default),d.addSystem(J.default),d.addSystem(N.default),d.addSystem(Z.default),d.addSystem(K.default),d.addSystem(X.default),d.addSystem(Y.default),d.addSystem($.default),d.addSystem(fe.default),d.addSystem(ie.default),s.embed||d.addSystem(ae.default),s.embed||d.addSystem(I.default),s.embed||d.addSystem(U.default),await d.addSystem(F.default,{fade:s.embed?0:1}),r.default.nointroseq&&(0,ne.default)(d),s.embed&&(0,ne.setPlayerPos)(d,new t.Vector3(-20.625336223781655,0,-7.556151890652441)),r.default.resolve){(0,ne.setPlayerPos)(d,new t.Vector3(25,0,-25));for(let e=0;e<3;e++)window.addPoem()}if(r.default.testtoken){const e=new t.Vector3(-71.4775163757554,0,-34.91576302604653);(0,ne.setPlayerPos)(d,e)}}
},{"../tags":"injP","three":"IV0r","../util/query-string":"Bj6B","./SnowAtmosphereSystem":"SXfE","./DOMTextSystem":"hoeu","./GameUISystem":"YKgE","./CanvasSystem":"YlL4","./TokenPaperFollowSystem":"KTkA","./SceneSystem":"MT5l","./InputSystem":"HsE3","./CompassSystem":"ryhr","./ScreenCompassSystem":"lpwT","./UserMoveSystem":"e7jH","./WindAtmosphereSystem":"kzPg","./RainAtmosphereSystem":"hVXC","./CharacterSystem":"i2kq","./HatWindLineSystem":"ELXm","./AtmosphericsSystem":"AL87","./TallGrassSystem":"FZ4x","./HaikuFloraSystem":"jU6f","./UserZoomSystem":"drV3","./RenderDebugTargetsSystem":"c4FT","./UserFollowSystem":"r7mA","./ShaderUniformSystem":"RNCT","./LoadJSONSystem":"F63u","./TreeSpriteAnimationSystem":"mYyJ","./TextSpriteSystem":"hhCz","./EnvironmentGrassSystem":"OuWA","./EnvironmentGroundRenderTextureSystem":"yyW0","./SubmitFrameSystem":"olzJ","./AnimationSystem":"cUmx","./ProceduralSpawningLeaves":"x1EI","./ProceduralSpawningDots":"jdWh","./EnvironmentGroundDataTextureSystem":"Q2iH","./AudioSystem":"czFB","./SimpleEnvironmentSystem":"NYVa","./SimpleEnvironmentCellSystem":"fGhj","./SimpleEnvironmentAssetsSystem":"ChEb","./ShadowMapSystem":"ETzy","./LoadRefGLTFSystem":"g3gH","./PoemCollectionSystem":"ARSc","./HaikuCollectionSystem":"oL33","./StanzaLineSpawningGrowthSystem":"uomW","./WaterCollectionSystem":"SJEY","./DevTutorialSystem":"E7By","./BirdFlyingSystem":"Ddzx","./GroundBirdsSystem":"BHeo","./animals/ButterflySystem":"fuNY","./animals/RabbitSystem":"oauB","./animals/SealSystem":"LVu2","./animals/OwlSystem":"PhLV","./animals/FoxSystem":"fssW","./animals/FishSystem":"YtQY","./animals/JumpingRabbitSystem":"YGiR","./OriginTreeSystem":"aiva","./OriginTreeIntroSystem":"ZGAK","./IntroTutorialSystem":"V4p7","./LetterboxBarsSystem":"FvUK","./AnimalSpawnSystem":"MP78","./OutroSystem":"t3rF","../util/globalIntroVideo":"M4mV","../config":"nZps","../util/resetPlayerPos":"quSS","../util/Assets":"Wm90","../overlays/NotSupportedOverlay.svelte":"HAc3","./SpriteSheetAnimationSystem":"u4I9","./TutorialMessageSystem":"Y5MC","../nfb":"Xlf9","./FloatingEndLines":"bE7e","./TokenPlacementSystem":"VuYM","./TokenConstellationSystem":"LiG7","../util/tokens":"kL9I"}],"qNxl":[function(require,module,exports) {
var define;
var t;!function(){"use strict";function e(t,n){var i;if(n=n||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=n.touchBoundary||10,this.layer=t,this.tapDelay=n.tapDelay||200,this.tapTimeout=n.tapTimeout||700,!e.notNeeded(t)){for(var r=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],a=0,s=r.length;a<s;a++)this[r[a]]=c(this[r[a]],this);o&&(t.addEventListener("mouseover",this.onMouse,{passive:!0}),t.addEventListener("mousedown",this.onMouse,{passive:!0}),t.addEventListener("mouseup",this.onMouse,{passive:!0})),t.addEventListener("click",this.onClick,{passive:!0}),t.addEventListener("touchstart",this.onTouchStart,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove,{passive:!1}),t.addEventListener("touchend",this.onTouchEnd,{passive:!1}),t.addEventListener("touchcancel",this.onTouchCancel,{passive:!1}),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,n,o){var i=Node.prototype.removeEventListener;"click"===e?i.call(t,e,n.hijacked||n,o):i.call(t,e,n,o)},t.addEventListener=function(e,n,o){var i=Node.prototype.addEventListener;"click"===e?i.call(t,e,n.hijacked||(n.hijacked=function(t){t.propagationStopped||n(t)}),o):i.call(t,e,n,o)}),"function"==typeof t.onclick&&(i=t.onclick,t.addEventListener("click",function(t){i(t)},!1),t.onclick=null)}function c(t,e){return function(){return t.apply(e,arguments)}}}var n=navigator.userAgent.indexOf("Windows Phone")>=0,o=navigator.userAgent.indexOf("Android")>0&&!n,i=/iP(ad|hone|od)/.test(navigator.userAgent)&&!n,r=i&&/OS 4_\d(_\d)?/.test(navigator.userAgent),a=i&&/OS [6-7]_\d/.test(navigator.userAgent),s=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(t){switch(t.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(t.disabled)return!0;break;case"input":if(i&&"file"===t.type||t.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(t.className)},e.prototype.needsFocus=function(t){switch(t.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!o;case"input":switch(t.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!t.disabled&&!t.readOnly;default:return/\bneedsfocus\b/.test(t.className)}},e.prototype.sendClick=function(t,e){var n,o;document.activeElement&&document.activeElement!==t&&document.activeElement.blur(),o=e.changedTouches[0],(n=document.createEvent("MouseEvents")).initMouseEvent(this.determineEventType(t),!0,!0,window,1,o.screenX,o.screenY,o.clientX,o.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,t.dispatchEvent(n)},e.prototype.determineEventType=function(t){return o&&"select"===t.tagName.toLowerCase()?"mousedown":"click"},e.prototype.focus=function(t){var e;i&&t.setSelectionRange&&0!==t.type.indexOf("date")&&"time"!==t.type&&"month"!==t.type?(e=t.value.length,t.setSelectionRange(e,e)):t.focus()},e.prototype.updateScrollParent=function(t){var e,n;if(!(e=t.fastClickScrollParent)||!e.contains(t)){n=t;do{if(n.scrollHeight>n.offsetHeight){e=n,t.fastClickScrollParent=n;break}n=n.parentElement}while(n)}e&&(e.fastClickLastScrollTop=e.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(t){return t.nodeType===Node.TEXT_NODE?t.parentNode:t},e.prototype.onTouchStart=function(t){var e,n,o;if(t.targetTouches.length>1)return!0;if(e=this.getTargetElementFromEventTarget(t.target),n=t.targetTouches[0],i){if((o=window.getSelection()).rangeCount&&!o.isCollapsed)return!0;if(!r){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return t.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(e)}}return this.trackingClick=!0,this.trackingClickStart=t.timeStamp,this.targetElement=e,this.touchStartX=n.pageX,this.touchStartY=n.pageY,t.timeStamp-this.lastClickTime<this.tapDelay&&t.preventDefault(),!0},e.prototype.touchHasMoved=function(t){var e=t.changedTouches[0],n=this.touchBoundary;return Math.abs(e.pageX-this.touchStartX)>n||Math.abs(e.pageY-this.touchStartY)>n},e.prototype.onTouchMove=function(t){return!this.trackingClick||((this.targetElement!==this.getTargetElementFromEventTarget(t.target)||this.touchHasMoved(t))&&(this.trackingClick=!1,this.targetElement=null),!0)},e.prototype.findControl=function(t){return void 0!==t.control?t.control:t.htmlFor?document.getElementById(t.htmlFor):t.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(t){var e,n,s,c,u,l=this.targetElement;if(!this.trackingClick)return!0;if(t.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(t.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=t.timeStamp,n=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,a&&(u=t.changedTouches[0],(l=document.elementFromPoint(u.pageX-window.pageXOffset,u.pageY-window.pageYOffset)||l).fastClickScrollParent=this.targetElement.fastClickScrollParent),"label"===(s=l.tagName.toLowerCase())){if(e=this.findControl(l)){if(this.focus(l),o)return!1;l=e}}else if(this.needsFocus(l))return t.timeStamp-n>100||i&&window.top!==window&&"input"===s?(this.targetElement=null,!1):(this.focus(l),this.sendClick(l,t),i&&"select"===s||(this.targetElement=null,t.preventDefault()),!1);return!(!i||r||!(c=l.fastClickScrollParent)||c.fastClickLastScrollTop===c.scrollTop)||(this.needsClick(l)||(t.preventDefault(),this.sendClick(l,t)),!1)},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(t){return!this.targetElement||(!!t.forwardedTouchEvent||(!t.cancelable||(!(!this.needsClick(this.targetElement)||this.cancelNextClick)||(t.stopImmediatePropagation?t.stopImmediatePropagation():t.propagationStopped=!0,t.stopPropagation(),t.preventDefault(),!1))))},e.prototype.onClick=function(t){var e;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===t.target.type&&0===t.detail||((e=this.onMouse(t))||(this.targetElement=null),e)},e.prototype.destroy=function(){var t=this.layer;o&&(t.removeEventListener("mouseover",this.onMouse,!0),t.removeEventListener("mousedown",this.onMouse,!0),t.removeEventListener("mouseup",this.onMouse,!0)),t.removeEventListener("click",this.onClick,!0),t.removeEventListener("touchstart",this.onTouchStart,!1),t.removeEventListener("touchmove",this.onTouchMove,!1),t.removeEventListener("touchend",this.onTouchEnd,!1),t.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(t){var e,n,i;if(void 0===window.ontouchstart)return!0;if(n=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!o)return!0;if(e=document.querySelector("meta[name=viewport]")){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(n>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(s&&(i=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/))[1]>=10&&i[2]>=3&&(e=document.querySelector("meta[name=viewport]"))){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===t.style.msTouchAction||"manipulation"===t.style.touchAction||(!!(+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]>=27&&(e=document.querySelector("meta[name=viewport]"))&&(-1!==e.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))||("none"===t.style.touchAction||"manipulation"===t.style.touchAction))},e.attach=function(t,n){return new e(t,n)},"function"==typeof t&&"object"==typeof t.amd&&t.amd?t(function(){return e}):"undefined"!=typeof module&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e}();
},{}],"CZkL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("svelte/internal"),e=require("./"),n=require("svelte");function o(e){let n,o,r;const s=[e[0]];var i=e[1];function p(e){let n={};for(let o=0;o<s.length;o+=1)n=(0,t.assign)(n,s[o]);return{props:n}}return i&&(n=new i(p())),{c(){n&&(0,t.create_component)(n.$$.fragment),o=(0,t.empty)()},m(e,s){n&&(0,t.mount_component)(n,e,s),(0,t.insert)(e,o,s),r=!0},p(e,[r]){const c=1&r?(0,t.get_spread_update)(s,[(0,t.get_spread_object)(e[0])]):{};if(i!==(i=e[1])){if(n){(0,t.group_outros)();const e=n;(0,t.transition_out)(e.$$.fragment,1,0,()=>{(0,t.destroy_component)(e,1)}),(0,t.check_outros)()}i?(n=new i(p()),(0,t.create_component)(n.$$.fragment),(0,t.transition_in)(n.$$.fragment,1),(0,t.mount_component)(n,o.parentNode,o)):n=null}else i&&n.$set(c)},i(e){r||(n&&(0,t.transition_in)(n.$$.fragment,e),r=!0)},o(e){n&&(0,t.transition_out)(n.$$.fragment,e),r=!1},d(e){e&&(0,t.detach)(o),n&&(0,t.destroy_component)(n,e)}}}function r(t,o,r){let{entity:s}=o,{props:i}=o,{component:p}=o;const c=(0,n.getContext)(e.CONTEXT_KEY_NODE);return(0,n.setContext)(e.CONTEXT_KEY_NODE,{...c,entity:s}),t.$$set=(t=>{"entity"in t&&r(2,s=t.entity),"props"in t&&r(0,i=t.props),"component"in t&&r(1,p=t.component)}),[i,p,s]}class s extends t.SvelteComponent{constructor(e){super(),(0,t.init)(this,e,r,o,t.safe_not_equal,{entity:2,props:0,component:1})}}var i=s;exports.default=i;
},{"svelte/internal":"xeIE","./":"M3eo","svelte":"XHT5"}],"FPuJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=r(require("./LayeredViewComponent.svelte")),n=require("./");function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n){const r=e.slice();return r[1]=t[n],r}function i(r,o){let i,s,a;return s=new t.default({props:{props:o[1].get(n.ViewLayer).props,component:o[1].get(n.ViewLayer).component,entity:o[1]}}),{key:r,first:null,c(){i=(0,e.empty)(),(0,e.create_component)(s.$$.fragment),this.first=i},m(t,n){(0,e.insert)(t,i,n),(0,e.mount_component)(s,t,n),a=!0},p(e,t){const r={};1&t&&(r.props=e[1].get(n.ViewLayer).props),1&t&&(r.component=e[1].get(n.ViewLayer).component),1&t&&(r.entity=e[1]),s.$set(r)},i(t){a||((0,e.transition_in)(s.$$.fragment,t),a=!0)},o(t){(0,e.transition_out)(s.$$.fragment,t),a=!1},d(t){t&&(0,e.detach)(i),(0,e.destroy_component)(s,t)}}}function s(t){let r,s,a=[],l=new Map,c=t[0];const u=e=>e[1].get(n.ViewLayer).id;for(let e=0;e<c.length;e+=1){let n=o(t,c,e),r=u(n);l.set(r,a[e]=i(r,n))}return{c(){for(let e=0;e<a.length;e+=1)a[e].c();r=(0,e.empty)()},m(t,n){for(let e=0;e<a.length;e+=1)a[e].m(t,n);(0,e.insert)(t,r,n),s=!0},p(t,[n]){if(1&n){const s=t[0];(0,e.group_outros)(),a=(0,e.update_keyed_each)(a,n,u,1,t,s,l,r.parentNode,e.outro_and_destroy_block,i,r,o),(0,e.check_outros)()}},i(t){if(!s){for(let t=0;t<c.length;t+=1)(0,e.transition_in)(a[t]);s=!0}},o(t){for(let n=0;n<a.length;n+=1)(0,e.transition_out)(a[n]);s=!1},d(t){for(let e=0;e<a.length;e+=1)a[e].d(t);t&&(0,e.detach)(r)}}}function a(e,t,r){let{layers:o=[]}=t;return e.$$set=(e=>{"layers"in e&&r(0,o=e.layers)}),e.$$.update=(()=>{if(1&e.$$.dirty){const e=new Set;o.forEach(t=>{const r=t.get(n.ViewLayer).id;if(!r)throw new Error(`Must specify an ID for ViewLayer ${t.name} ${t.get(n.ViewLayer).component.name}`);if(e.has(r))throw new Error(`You already added the view layer with ID ${r}`);e.add(r)})}}),[o]}class l extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,a,s,e.safe_not_equal,{layers:0})}}var c=l;exports.default=c;
},{"svelte/internal":"xeIE","./LayeredViewComponent.svelte":"CZkL","./":"M3eo"}],"boSy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("svelte/internal"),t=require("."),n=require("svelte"),r=s(require("./LayeredView.svelte")),o=a(require("../config")),i=s(require("../overlays/NotSupportedOverlay.svelte"));function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}function a(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var a=o?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(r,i,a):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}function s(e){return e&&e.__esModule?e:{default:e}}function c(t){let n,o;return n=new r.default({props:{layers:t[2]}}),{c(){(0,e.create_component)(n.$$.fragment)},m(t,r){(0,e.mount_component)(n,t,r),o=!0},p(e,t){const r={};4&t&&(r.layers=e[2]),n.$set(r)},i(t){o||((0,e.transition_in)(n.$$.fragment,t),o=!0)},o(t){(0,e.transition_out)(n.$$.fragment,t),o=!1},d(t){(0,e.destroy_component)(n,t)}}}function l(t){let n,r;return n=new i.default({}),{c(){(0,e.create_component)(n.$$.fragment)},m(t,o){(0,e.mount_component)(n,t,o),r=!0},p:e.noop,i(t){r||((0,e.transition_in)(n.$$.fragment,t),r=!0)},o(t){(0,e.transition_out)(n.$$.fragment,t),r=!1},d(t){(0,e.destroy_component)(n,t)}}}function f(t){let n,r,o,i,u,a;const s=[l,c],f=[];function d(e,t){return e[0]?e[1]?1:-1:0}return~(n=d(t))&&(r=f[n]=s[n](t)),{c(){r&&r.c(),o=(0,e.empty)()},m(t,r){~n&&f[n].m(t,r),(0,e.insert)(t,o,r),i=!0,u||(a=(0,e.listen)(window,"contextmenu",p),u=!0)},p(t,[i]){let u=n;(n=d(t))===u?~n&&f[n].p(t,i):(r&&((0,e.group_outros)(),(0,e.transition_out)(f[u],1,1,()=>{f[u]=null}),(0,e.check_outros)()),~n?((r=f[n])?r.p(t,i):(r=f[n]=s[n](t)).c(),(0,e.transition_in)(r,1),r.m(o.parentNode,o)):r=null)},i(t){i||((0,e.transition_in)(r),i=!0)},o(t){(0,e.transition_out)(r),i=!1},d(t){~n&&f[n].d(t),t&&(0,e.detach)(o),u=!1,a()}}}const p=e=>e.preventDefault();function d(e,r,i){let{onCreate:u=(()=>{})}=r;const{world:a,viewLayerStore:s}=(0,t.createRootWorld)(),c=(0,o.default)(),l={world:a};(0,n.setContext)(t.CONTEXT_KEY_NODE,l);let f,p=!0,d=!1;return(0,n.onMount)(()=>{!async function(){i(1,d=!0),c.context?u(a):(i(0,p=!1),(0,o.hideLoader)())}()}),s.subscribe(e=>{i(2,f=e)}),e.$$set=(e=>{"onCreate"in e&&i(3,u=e.onCreate)}),[p,d,f,u]}class _ extends e.SvelteComponent{constructor(t){super(),(0,e.init)(this,t,d,f,e.safe_not_equal,{onCreate:3})}}var m=_;exports.default=m;
},{"svelte/internal":"xeIE",".":"M3eo","svelte":"XHT5","./LayeredView.svelte":"FPuJ","../config":"nZps","../overlays/NotSupportedOverlay.svelte":"HAc3"}],"H99C":[function(require,module,exports) {
"use strict";require("./polyfills");var e=c(require("./systems/initialize")),t=c(require("./util/query-string")),r=f(require("./tags")),n=c(require("./util/Assets")),u=c(require("./vendor/fastclick")),i=c(require("./alec-svelte/GameApp.svelte")),a=c(require("./config")),s=c(require("./systems/CanvasSystem")),o=c(require("./systems/LoadJSONSystem"));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var a=u?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(n,i,a):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}function c(e){return e&&e.__esModule?e:{default:e}}(0,u.default)(document.body);const d=(0,a.default)();let y;function p(){return y||(y=new Promise(t=>{const n=d.container||document.querySelector("main.content");new i.default({target:n,props:{onCreate:async function(n){await(0,e.default)(n);const u=n.hasSystem(s.default)?n.getSystem(s.default).instance:null;let i;n.hasSystem(o.default)&&(i=n.getSystem(o.default).instance);d.stop=(()=>{u&&(u.running=!1)}),d.start=(()=>{u&&(u.running=!0)}),d.load=(e=>{i&&i.load(e)}),d.world=n,d.Tags=r,t()}}})}))}d.init=p,!1!==d.autoInit&&window.requestAnimationFrame(()=>{d.init()});
},{"./polyfills":"lDF4","./systems/initialize":"PJip","./util/query-string":"Bj6B","./tags":"injP","./util/Assets":"Wm90","./vendor/fastclick":"qNxl","./alec-svelte/GameApp.svelte":"boSy","./config":"nZps","./systems/CanvasSystem":"YlL4","./systems/LoadJSONSystem":"F63u"}]},{},["H99C"], null)
//# sourceMappingURL=/SB-Playgrounds/games/nfb-wayfinder/src.c71a5c94.js.map
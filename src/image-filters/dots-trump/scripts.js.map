{"version":3,"sources":["../../../../src/image-filters/dots-trump/scripts.js"],"names":["utils","getBase64FromImageUrl","url","onSuccess","img","Image","setAttribute","onload","canvas","document","createElement","width","height","ctx","getContext","drawImage","dataURL","toDataURL","src","setImageBackground","$target","urlString","style","backgroundImage","canvasFilters","dottify","source","options","w","h","sourceCanvas","sourceCtx","putImageData","filteredCanvas","filteredCtx","step","xPoints","yPoints","i","j","x","y","data","getImageData","color","fillStyle","fillRect","filtered","grayscale","ImageData","filteredData","sourceData","length","r","g","b","v","contrast","adjust","Math","pow","brightness","floor","DotsTrump","prototype","pipe","task","value","dotsTrump","Project","initialize","$sourceImage","querySelector","$filteredImage","$uploadImageBtn","$downloadImageBtn","config","defaultImagePath","states","imageName","sourceImage","filteredImage","filterOptions","dotscale","mount","mountDefaultImage","mountImageUploader","mountImageDownloader","updateStates","key","isSilent","sourceToFilteredImage","self","split","pop","replace","input","appendChild","addEventListener","click","onUploadNewImage","bind","onDownloadFilteredImage","sourceImageData","filteredImageData","event","files","target","file","reader","window","FileReader","name","URL","createObjectURL","readAsDataURL","link","download","href","project"],"mappings":"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","file":"scripts.js","sourcesContent":["void function () {\n  /**\n   * utils\n   */\n  var utils = {}\n\n  utils.getBase64FromImageUrl = function (url, onSuccess) {\n    var img = new Image()\n    img.setAttribute('crossOrigin', 'anonymous')\n    img.onload = function () {\n      var canvas = document.createElement('canvas')\n      canvas.width = this.width\n      canvas.height = this.height\n      var ctx = canvas.getContext('2d')\n      ctx.drawImage(this, 0, 0)\n      var dataURL = canvas.toDataURL('image/png')\n      onSuccess && onSuccess(dataURL, canvas)\n    }\n    img.src = url\n  }\n\n  utils.setImageBackground = function ($target, url) {\n    var urlString = 'url(' + url + ')'\n    $target.style.backgroundImage = urlString\n  }\n\n  /**\n   * canvasFilters\n   */\n  var canvasFilters = {}\n\n  // TODO: Support config & image recognition\n  canvasFilters.dottify = function (source, options) {\n    var w = source.width\n    var h = source.height\n\n    var sourceCanvas = document.createElement('canvas')\n    var sourceCtx = sourceCanvas.getContext('2d')\n    sourceCanvas.width = w\n    sourceCanvas.height = h\n    sourceCtx.putImageData(source, 0, 0)\n\n    var filteredCanvas = document.createElement('canvas')\n    var filteredCtx = filteredCanvas.getContext('2d')\n    filteredCanvas.width = w\n    filteredCanvas.height = h\n\n    var step = 4\n    var xPoints = w / step\n    var yPoints = h / step\n    for(var i = 0; i <= xPoints; i++){\n      for(var j = 0; j <= yPoints; j++){\n        var x = i * step\n        var y = j * step\n        var data = sourceCtx.getImageData(x, y, 1, 1).data\n        var color = 'rgb(' + data[0] + ',' + data[1] + ',' + data[2] + ')'\n        filteredCtx.fillStyle = color\n        filteredCtx.fillRect(x, y, 1, 1)\n      }\n    }\n\n    var filtered = filteredCtx.getImageData(0, 0, source.width, source.height)\n    return filtered\n  }\n\n  canvasFilters.grayscale = function (source, options) {\n    var filtered = new ImageData(source.width, source.height)\n    var filteredData = filtered.data\n    var sourceData = source.data\n    for (var i = 0; i < sourceData.length; i+=4) {\n      var r = sourceData[i]\n      var g = sourceData[i+1]\n      var b = sourceData[i+2]\n      var v = 0.3*r + 0.59*g + 0.11*b\n      filteredData[i] = filteredData[i+1] = filteredData[i+2] = v\n      filteredData[i+3] = sourceData[i+3]\n    }\n    return filtered\n  }\n\n  canvasFilters.contrast = function (source, options) {\n    var adjust = 40\n    adjust = Math.pow((adjust + 100) / 100, 2)\n    var filtered = new ImageData(source.width, source.height)\n    var filteredData = filtered.data\n    var sourceData = source.data\n    for (var i = 0; i < sourceData.length; i+=4) {\n      var r = sourceData[i]\n      var g = sourceData[i+1]\n      var b = sourceData[i+2]\n      filteredData[i] = (((r / 255) - 0.5) * adjust + 0.5) * 255\n      filteredData[i+1] = (((g / 255) - 0.5) * adjust + 0.5) * 255\n      filteredData[i+2] = (((b / 255) - 0.5) * adjust + 0.5) * 255\n      filteredData[i+3] = sourceData[i+3]\n    }\n    return filtered\n  }\n\n  canvasFilters.brightness = function (source, options) {\n    var adjust = 40\n    adjust = Math.floor(255 * (adjust / 100))\n    var filtered = new ImageData(source.width, source.height)\n    var filteredData = filtered.data\n    var sourceData = source.data\n    for (var i = 0; i < sourceData.length; i+=4) {\n      var r = sourceData[i]\n      var g = sourceData[i+1]\n      var b = sourceData[i+2]\n      filteredData[i] = r + adjust\n      filteredData[i+1] = g + adjust\n      filteredData[i+2] = b + adjust\n      filteredData[i+3] = sourceData[i+3]\n    }\n    return filtered\n  }\n\n  /**\n   * DotsTrump Class\n   */\n  var DotsTrump = function () {\n    this.source = null // ImageData\n    this.filtered = null\n  }\n\n  DotsTrump.prototype.src = function (source) {\n    this.source = source\n    this.filtered = source\n    return this\n  }\n\n  DotsTrump.prototype.pipe = function (task, options) {\n    if (typeof task !== 'function') return this\n    this.filtered = task(this.filtered, options)\n    return this\n  }\n\n  DotsTrump.prototype.value = function () {\n    return this.filtered\n  }\n\n  var dotsTrump = new DotsTrump()\n\n  /**\n   * Project Class\n   */\n  var Project = function () {\n    this.initialize()\n  }\n\n  Project.prototype.initialize = function () {\n    this.$sourceImage = document.querySelector('.source-image')\n    this.$filteredImage = document.querySelector('.filtered-image')\n    this.$uploadImageBtn = document.querySelector('.upload-image')\n    this.$downloadImageBtn = document.querySelector('.download-image')\n\n    this.config = { // Static\n      defaultImagePath: '../../assets/brown-bear.jpg'\n    }\n\n    this.states = { // Dynamic\n      imageName: null,\n      sourceImage: null,\n      filteredImage: null,\n      filterOptions: {\n        grayscale: 100,\n        dotscale: 50\n      },\n    }\n\n    this.mount()\n  }\n\n  Project.prototype.mount = function () {\n    this.mountDefaultImage()\n    this.mountImageUploader()\n    this.mountImageDownloader()\n  }\n\n  Project.prototype.updateStates = function (key, value, isSilent) {\n    this.states[key] = value\n    if (isSilent) return\n    switch (key) {\n      case 'sourceImage':\n        utils.setImageBackground(this.$sourceImage, value)\n        this.sourceToFilteredImage()\n        break\n      case 'filteredImage':\n        utils.setImageBackground(this.$filteredImage, value)\n        break\n    }\n  }\n\n  Project.prototype.mountDefaultImage = function () {\n    var self = this\n    utils.getBase64FromImageUrl(this.config.defaultImagePath, function (dataURL) {\n      var imageName = self.config.defaultImagePath.split('/')\n      imageName = imageName.pop().replace(/\\.(.[^\\.]*)?$/, '')\n      self.updateStates('imageName', imageName)\n      self.updateStates('sourceImage', dataURL)\n    })\n  }\n\n  Project.prototype.mountImageUploader = function () {\n    var input = document.createElement('input')\n    input.setAttribute('type', 'file')\n    input.setAttribute('accept', 'image/png,image/gif,image/jpeg')\n    input.setAttribute('style', 'display: none;')\n\n    this.$uploadImageBtn.appendChild(input)\n    this.$uploadImageBtn.addEventListener('click', function () { input.click() }, false)\n    input.addEventListener('change', this.onUploadNewImage.bind(this), false)\n  }\n\n  Project.prototype.mountImageDownloader = function () {\n    this.$downloadImageBtn.addEventListener('click', this.onDownloadFilteredImage.bind(this), false)\n  }\n\n  Project.prototype.sourceToFilteredImage = function () {\n    var self = this\n    utils.getBase64FromImageUrl(this.states.sourceImage, function (url, canvas) {\n      var sourceImageData = canvas.getContext('2d').getImageData(0, 0, canvas.width, canvas.height)\n      var filteredImageData = dotsTrump\n        .src(sourceImageData)\n        .pipe(canvasFilters.grayscale, self.states.filterOptions)\n        .pipe(canvasFilters.contrast, self.states.filterOptions)\n        .pipe(canvasFilters.brightness, self.states.filterOptions)\n        .pipe(canvasFilters.dottify, self.states.filterOptions)\n        .value()\n      canvas.getContext('2d').putImageData(filteredImageData, 0, 0)\n      var filteredImage = canvas.toDataURL('image/png')\n      self.updateStates('filteredImage', filteredImage)\n    })\n  }\n\n  Project.prototype.onUploadNewImage = function (event) {\n    var self = this\n    var files = event.target.files\n    for (var i = 0; i < files.length; i++) {\n      var file = files[i]\n      var reader = new window.FileReader()\n      if (!file) return\n      reader.onload = function () {\n        self.updateStates('imageName', file.name)\n        self.updateStates('sourceImage', window.URL.createObjectURL(file))\n      }\n      reader.readAsDataURL(file)\n    }\n  }\n\n  Project.prototype.onDownloadFilteredImage = function () {\n    var link = document.createElement('a')\n    link.download = '[Dottify] ' + this.states.imageName\n    link.href = this.states.filteredImage\n    link.click()\n  }\n\n  var project = new Project()\n}()\n"]}